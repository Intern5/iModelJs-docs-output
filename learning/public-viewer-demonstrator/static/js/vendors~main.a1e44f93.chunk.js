(window.webpackJsonp=window.webpackJsonp||[]).push([[2],[function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(392)),n(r(393)),n(r(118)),n(r(394)),n(r(395)),n(r(396)),n(r(397)),n(r(398)),n(r(399)),n(r(400)),n(r(221)),n(r(222)),n(r(401)),n(r(402)),n(r(162)),n(r(403)),n(r(404))},function(e,t,r){"use strict";e.exports=r(387)},function(e,t,r){var n;!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var o=typeof n;if("string"===o||"number"===o)e.push(n);else if(Array.isArray(n)&&n.length){var s=i.apply(null,n);s&&e.push(s)}else if("object"===o)for(var a in n)r.call(n,a)&&n[a]&&e.push(a)}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}()},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(13)),n(r(6)),n(r(24)),n(r(9)),n(r(10)),n(r(23)),n(r(37)),n(r(251)),n(r(101)),n(r(165)),n(r(454)),n(r(21)),n(r(257)),n(r(22)),n(r(5)),n(r(16)),n(r(258)),n(r(84)),n(r(455)),n(r(168)),n(r(169)),n(r(259)),n(r(260)),n(r(456)),n(r(126)),n(r(457)),n(r(458)),n(r(19)),n(r(99)),n(r(459)),n(r(262)),n(r(166)),n(r(460)),n(r(83)),n(r(167)),n(r(461)),n(r(462)),n(r(60)),n(r(263)),n(r(33)),n(r(39)),n(r(127)),n(r(128)),n(r(264)),n(r(463)),n(r(38)),n(r(49)),n(r(265)),n(r(50)),n(r(252)),n(r(51)),n(r(14)),n(r(266)),n(r(72)),n(r(267)),n(r(268)),n(r(269)),n(r(270)),n(r(273)),n(r(274)),n(r(61)),n(r(275)),n(r(129)),n(r(276)),n(r(100)),n(r(256)),n(r(277)),n(r(278)),n(r(124)),n(r(272)),n(r(130)),n(r(271)),n(r(465)),n(r(170)),n(r(131))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(249)),n(r(58)),n(r(450)),n(r(250)),n(r(451)),n(r(466)),n(r(467)),n(r(279)),n(r(468)),n(r(42)),n(r(40)),n(r(281)),n(r(43)),n(r(15)),n(r(282)),n(r(470)),n(r(471)),n(r(472)),n(r(283)),n(r(473)),n(r(474)),n(r(173)),n(r(284)),n(r(280)),n(r(475)),n(r(286)),n(r(171)),n(r(285)),n(r(25)),n(r(62)),n(r(172)),n(r(73)),n(r(85)),n(r(75)),n(r(102)),n(r(74)),n(r(476)),n(r(477)),n(r(479)),n(r(174)),n(r(175)),n(r(485)),n(r(290)),n(r(487)),n(r(488)),n(r(489))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(6);!function(e){e[e.XYZ=0]="XYZ",e[e.YZX=1]="YZX",e[e.ZXY=2]="ZXY",e[e.XZY=4]="XZY",e[e.YXZ=5]="YXZ",e[e.ZYX=6]="ZYX"}(t.AxisOrder||(t.AxisOrder={})),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(t.AxisIndex||(t.AxisIndex={})),function(e){e[e.Top=1]="Top",e[e.Bottom=2]="Bottom",e[e.Left=3]="Left",e[e.Right=4]="Right",e[e.Front=5]="Front",e[e.Back=6]="Back",e[e.Iso=7]="Iso",e[e.RightIso=8]="RightIso"}(t.StandardViewIndex||(t.StandardViewIndex={})),function(e){e[e.Unit=0]="Unit",e[e.LongestRangeDirection=1]="LongestRangeDirection",e[e.NonUniformRangeContainment=2]="NonUniformRangeContainment"}(t.AxisScaleSelect||(t.AxisScaleSelect={}));class Geometry{static correctSmallMetricDistance(e,t=0){return Math.abs(e)<Geometry.smallMetricDistance?t:e}static inverseMetricDistance(e){return Math.abs(e)<=Geometry.smallMetricDistance?void 0:1/e}static inverseMetricDistanceSquared(e){return Math.abs(e)<=Geometry.smallMetricDistanceSquared?void 0:1/e}static isSameCoordinate(e,t,r){return r?Math.abs(e-t)<Math.abs(r):Math.abs(e-t)<Geometry.smallMetricDistance}static isSameCoordinateSquared(e,t){return Math.abs(Math.sqrt(e)-Math.sqrt(t))<Geometry.smallMetricDistance}static isSamePoint3d(e,t){return e.distance(t)<Geometry.smallMetricDistance}static isSameXYZ(e,t){return e.distance(t)<Geometry.smallMetricDistance}static isSamePoint3dXY(e,t){return e.distanceXY(t)<Geometry.smallMetricDistance}static isSameVector3d(e,t){return e.distance(t)<Geometry.smallMetricDistance}static isSamePoint2d(e,t){return e.distance(t)<Geometry.smallMetricDistance}static isSameVector2d(e,t){return e.distance(t)<Geometry.smallMetricDistance}static lexicalXYLessThan(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}static lexicalYXLessThan(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}static lexicalXYZLessThan(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:e.z<t.z?-1:e.z>t.z?1:0}static isSmallRelative(e){return Math.abs(e)<Geometry.smallAngleRadians}static isSmallAngleRadians(e){return Math.abs(e)<Geometry.smallAngleRadians}static isAlmostEqualNumber(e,t){const r=1+Math.abs(e)+Math.abs(t);return Math.abs(e-t)<=Geometry.smallAngleRadians*r}static isDistanceWithinTol(e,t){return Math.abs(e)<=Math.abs(t)}static isSmallMetricDistance(e){return Math.abs(e)<=Geometry.smallMetricDistance}static isSmallMetricDistanceSquared(e){return Math.abs(e)<=Geometry.smallMetricDistanceSquared}static cyclic3dAxis(e){if(e>=0)return e<3?e:e<6?e-3:e%3;const t=e+3;return t>=0?t:2-(-e-1)%3}static axisIndexToRightHandedAxisOrder(e){return 0===e?0:1===e?1:2===e?2:Geometry.axisIndexToRightHandedAxisOrder(Geometry.cyclic3dAxis(e))}static maxAbsDiff(e,t,r){return Math.max(Math.abs(e-t),Math.abs(e-r))}static maxAbsXYZ(e,t,r){return Geometry.maxXYZ(Math.abs(e),Math.abs(t),Math.abs(r))}static maxAbsXY(e,t){return Geometry.maxXY(Math.abs(e),Math.abs(t))}static maxXYZ(e,t,r){let n=e;return t>n&&(n=t),r>n&&(n=r),n}static maxXY(e,t){let r=e;return t>r&&(r=t),r}static hypotenuseXY(e,t){return Math.sqrt(e*e+t*t)}static hypotenuseSquaredXY(e,t){return e*e+t*t}static square(e){return e*e}static hypotenuseXYZ(e,t,r){return Math.sqrt(e*e+t*t+r*r)}static hypotenuseSquaredXYZ(e,t,r){return e*e+t*t+r*r}static hypotenuseXYZW(e,t,r,n){return Math.sqrt(e*e+t*t+r*r+n*n)}static hypotenuseSquaredXYZW(e,t,r,n){return e*e+t*t+r*r+n*n}static distanceXYXY(e,t,r,n){return Geometry.hypotenuseXY(r-e,n-t)}static distanceXYZXYZ(e,t,r,n,i,o){return Geometry.hypotenuseXYZ(n-e,i-t,o-r)}static tripleProduct(e,t,r,n,i,o,s,a,c){return e*(i*c-o*a)+t*(o*s-n*c)+r*(n*a-i*s)}static curvatureMagnitude(e,t,r,n,i,o){let s=t*o-r*i,a=s*s;a+=(s=r*n-e*o)*s,a+=(s=e*i-t*n)*s;const c=Math.sqrt(e*e+t*t+r*r),l=Math.sqrt(a),u=c*c*c;return u>Geometry.smallAngleRadians*l?l/u:0}static tripleProductXYW(e,t,r,n,i,o){return Geometry.tripleProduct(e.x,r.x,i.x,e.y,r.y,i.y,t,n,o)}static tripleProductPoint4dXYW(e,t,r){return Geometry.tripleProduct(e.x,t.x,r.x,e.y,t.y,r.y,e.w,t.w,r.w)}static crossProductXYXY(e,t,r,n){return e*n-t*r}static crossProductXYZXYZ(e,t,r,n,o,s,a){return i.Vector3d.create(t*s-r*o,r*n-e*s,e*o-t*n,a)}static crossProductMagnitude(e,t,r,n,i,o){return Geometry.hypotenuseXYZ(t*o-r*i,r*n-e*o,e*i-t*n)}static dotProductXYZXYZ(e,t,r,n,i,o){return e*n+t*i+r*o}static clampToStartEnd(e,t,r){return t>r?Geometry.clampToStartEnd(e,r,t):e<t?t:r<e?r:e}static clamp(e,t,r){return Math.max(t,Math.min(r,e))}static interpolate(e,t,r){return t<=.5?e+t*(r-e):r-(1-t)*(r-e)}static axisOrderToAxis(e,t){const r=e<=2?e+t:e-4-t;return Geometry.cyclic3dAxis(r)}static modulo(e,t){if(t<=0)return 0===t?e:-Geometry.modulo(-e,-t);if(e>=0){if(e<t)return e;if(e<2*t)return e-t}else if((e+=t)>0)return e;return e-Math.floor(e/t)*t}static defined01(e){return void 0===e?0:1}static conditionalDivideFraction(e,t){if(Math.abs(t)*Geometry.largeFractionResult>Math.abs(e))return e/t}static solveTrigForm(e,t,r){{const i=t*t+r*r;let o;if(i>0){const s=-e/i,a=1-e*e/i;if(a>=0){const e=Math.sqrt(a/i),c=s*t,l=s*r;o=[n.Vector2d.create(c-e*r,l+e*t),n.Vector2d.create(c+e*r,l-e*t)]}}return o}}static safeDivideFraction(e,t,r){const n=Geometry.conditionalDivideFraction(e,t);return void 0!==n?n:r}static inverseInterpolate(e,t,r,n,i=0,o){const s=Geometry.conditionalDivideFraction(i-t,n-t);return s?Geometry.interpolate(e,s,r):o}static inverseInterpolate01(e,t,r=0){return Geometry.conditionalDivideFraction(r-e,t-e)}static isNumberArray(e,t=0){if(Array.isArray(e)&&e.length>=t){let t;for(t of e)if(!Number.isFinite(t))return!1;return!0}return!1}static isArrayOfNumberArray(e,t,r=0){if(Array.isArray(e)&&e.length>=t){let t;for(t of e)if(!Geometry.isNumberArray(t,r))return!1;return!0}return!1}static stepCount(e,t,r=1,n=101){if(e<=0)return r;if(e>=t)return r;const i=Math.floor((t+.999999*e)/e);return i<r?r:i>n?n:i}static isIn01(e,t=!0){return!t||e>=0&&e<=1}static isIn01WithTolerance(e,t){return e+t>=0&&e-t<=1}static restrictToInterval(e,t,r){return t<=r?e<t?t:e>r?r:e:e<r?r:e>t?t:e}}Geometry.smallMetricDistance=1e-6,Geometry.smallMetricDistanceSquared=1e-12,Geometry.smallAngleRadians=1e-12,Geometry.smallAngleRadiansSquared=1e-24,Geometry.largeFractionResult=1e10,Geometry.fullCircleRadiansMinusSmallAngle=2*Math.PI-1e-12,t.Geometry=Geometry},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(16),o=r(21);class XYZ{set(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}setZero(){this.x=0,this.y=0,this.z=0}constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}static isXAndY(e){return void 0!==e.x&&void 0!==e.y}static hasZ(e){return void 0!==e.z}static isXYAndZ(e){return this.isXAndY(e)&&this.hasZ(e)}setFrom(e){XYZ.isXAndY(e)?(this.x=e.x,this.y=e.y,this.z=XYZ.hasZ(e)?e.z:0):(this.x=e[0],this.y=e[1],this.z=e[2])}setFromPoint3d(e){this.x=e.x,this.y=e.y,this.z=e.z}setFromVector3d(e){this.x=e.x,this.y=e.y,this.z=e.z}isAlmostEqual(e,t){return n.Geometry.isSameCoordinate(this.x,e.x,t)&&n.Geometry.isSameCoordinate(this.y,e.y,t)&&n.Geometry.isSameCoordinate(this.z,e.z,t)}isAlmostEqualXYZ(e,t,r,i){return n.Geometry.isSameCoordinate(this.x,e,i)&&n.Geometry.isSameCoordinate(this.y,t,i)&&n.Geometry.isSameCoordinate(this.z,r,i)}isAlmostEqualXY(e,t){return n.Geometry.isSameCoordinate(this.x,e.x,t)&&n.Geometry.isSameCoordinate(this.y,e.y,t)}toJSON(){return[this.x,this.y,this.z]}toJSONXYZ(){return{x:this.x,y:this.y,z:this.z}}toFloat64Array(){return Float64Array.of(this.x,this.y,this.z)}setFromJSON(e){Array.isArray(e)?this.set(e[0]||0,e[1]||0,e[2]||0):e?this.set(e.x||0,e.y||0,e.z||0):this.set(0,0,0)}distance(e){const t=e.x-this.x,r=e.y-this.y,n=e.z-this.z;return Math.sqrt(t*t+r*r+n*n)}distanceSquared(e){const t=e.x-this.x,r=e.y-this.y,n=e.z-this.z;return t*t+r*r+n*n}distanceXY(e){const t=e.x-this.x,r=e.y-this.y;return Math.sqrt(t*t+r*r)}distanceSquaredXY(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r}maxDiff(e){return Math.max(Math.abs(this.x-e.x),Math.abs(this.y-e.y),Math.abs(this.z-e.z))}at(e){return e<.5?this.x:e>1.5?this.z:this.y}indexOfMaxAbs(){let e=0,t=Math.abs(this.x),r=Math.abs(this.y);return r>t&&(e=1,t=r),(r=Math.abs(this.z))>t&&(e=2,t=r),e}get isAlmostZero(){return n.Geometry.isSmallMetricDistance(this.x)&&n.Geometry.isSmallMetricDistance(this.y)&&n.Geometry.isSmallMetricDistance(this.z)}maxAbs(){return Math.max(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}magnitude(){return Math.hypot(this.x,this.y,this.z)}magnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}magnitudeXY(){return Math.hypot(this.x,this.y)}magnitudeSquaredXY(){return this.x*this.x+this.y*this.y}isExactEqual(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}isAlmostEqualMetric(e){return this.maxDiff(e)<=n.Geometry.smallMetricDistance}addInPlace(e){this.x+=e.x,this.y+=e.y,this.z+=e.z}addScaledInPlace(e,t){this.x+=t*e.x,this.y+=t*e.y,this.z+=t*e.z}scaleInPlace(e){this.x*=e,this.y*=e,this.z*=e}cloneAsPoint3d(){return Point3d.create(this.x,this.y,this.z)}vectorTo(e,t){return Vector3d.create(e.x-this.x,e.y-this.y,e.z-this.z,t)}scaledVectorTo(e,t,r){return Vector3d.create(t*(e.x-this.x),t*(e.y-this.y),t*(e.z-this.z),r)}unitVectorTo(e,t){return this.vectorTo(e,t).normalize(t)}freeze(){Object.freeze(this)}}t.XYZ=XYZ;class Point3d extends XYZ{constructor(e=0,t=0,r=0){super(e,t,r)}static fromJSON(e){const t=new Point3d;return t.setFromJSON(e),t}clone(e){return Point3d.create(this.x,this.y,this.z,e)}static create(e=0,t=0,r=0,n){return n?(n.x=e,n.y=t,n.z=r,n):new Point3d(e,t,r)}static createFrom(e,t){return e instanceof Float64Array?e.length>=3?Point3d.create(e[0],e[1],e[2],t):e.length>=2?Point3d.create(e[0],e[1],0,t):e.length>=1?Point3d.create(e[0],0,0,t):Point3d.create(0,0,0,t):Point3d.create(e.x,e.y,XYZ.hasZ(e)?e.z:0,t)}static createFromPacked(e,t,r){const n=3*t;if(n>=0&&n+2<e.length)return Point3d.create(e[n],e[n+1],e[n+2],r)}static createFromPackedXYZW(e,t,r){const i=4*t;if(i>=0&&i+3<e.length){const t=e[i+3];if(!n.Geometry.isSmallMetricDistance(t)){const n=1/t;return Point3d.create(n*e[i],n*e[i+1],n*e[i+2],r)}}}static createZero(e){return Point3d.create(0,0,0,e)}crossProductToPoints(e,t,r){return Vector3d.createCrossProduct(e.x-this.x,e.y-this.y,e.z-this.z,t.x-this.x,t.y-this.y,t.z-this.z,r)}tripleProductToPoints(e,t,r){return n.Geometry.tripleProduct(e.x-this.x,e.y-this.y,e.z-this.z,t.x-this.x,t.y-this.y,t.z-this.z,r.x-this.x,r.y-this.y,r.z-this.z)}crossProductToPointsXY(e,t){return n.Geometry.crossProductXYXY(e.x-this.x,e.y-this.y,t.x-this.x,t.y-this.y)}interpolate(e,t,r){if(e<=.5)return Point3d.create(this.x+e*(t.x-this.x),this.y+e*(t.y-this.y),this.z+e*(t.z-this.z),r);const n=e-1;return Point3d.create(t.x+n*(t.x-this.x),t.y+n*(t.y-this.y),t.z+n*(t.z-this.z),r)}interpolatePointAndTangent(e,t,r,n){n=n||o.Ray3d.createZero();const i=t.x-this.x,s=t.y-this.y,a=t.z-this.z;if(n.direction.set(r*i,r*s,r*a),e<=.5)n.origin.set(this.x+e*i,this.y+e*s,this.z+e*a);else{const r=e-1;n.origin.set(t.x+r*i,t.y+r*s,t.z+r*a)}return n}interpolateXYZ(e,t,r,i,o){return Point3d.create(n.Geometry.interpolate(this.x,e,i.x),n.Geometry.interpolate(this.y,t,i.y),n.Geometry.interpolate(this.z,r,i.z),o)}interpolatePerpendicularXY(e,t,r,n){n=n||new Point3d;const i=t.minus(this);return this.interpolate(e,t,n),n.x-=r*i.y,n.y+=r*i.x,n}minus(e,t){return Point3d.create(this.x-e.x,this.y-e.y,this.z-e.z,t)}plus(e,t){return Point3d.create(this.x+e.x,this.y+e.y,this.z+e.z,t)}plusXYZ(e=0,t=0,r=0,n){return Point3d.create(this.x+e,this.y+t,this.z+r,n)}plusScaled(e,t,r){return Point3d.create(this.x+e.x*t,this.y+e.y*t,this.z+e.z*t,r)}plus2Scaled(e,t,r,n,i){return Point3d.create(this.x+e.x*t+r.x*n,this.y+e.y*t+r.y*n,this.z+e.z*t+r.z*n,i)}plus3Scaled(e,t,r,n,i,o,s){return Point3d.create(this.x+e.x*t+r.x*n+i.x*o,this.y+e.y*t+r.y*n+i.y*o,this.z+e.z*t+r.z*n+i.z*o,s)}static createScale(e,t,r){return Point3d.create(e.x*t,e.y*t,e.z*t,r)}static createAdd2Scaled(e,t,r,n,i){return Point3d.create(e.x*t+r.x*n,e.y*t+r.y*n,e.z*t+r.z*n,i)}static createAdd3Scaled(e,t,r,n,i,o,s){return Point3d.create(e.x*t+r.x*n+i.x*o,e.y*t+r.y*n+i.y*o,e.z*t+r.z*n+i.z*o,s)}dotVectorsToTargets(e,t){return(e.x-this.x)*(t.x-this.x)+(e.y-this.y)*(t.y-this.y)+(e.z-this.z)*(t.z-this.z)}fractionOfProjectionToLine(e,t,r=0){const i=e.distanceSquared(t);return i<n.Geometry.smallMetricDistanceSquared?r:e.dotVectorsToTargets(t,this)/i}}t.Point3d=Point3d;class Vector3d extends XYZ{constructor(e=0,t=0,r=0){super(e,t,r)}clone(e){return Vector3d.create(this.x,this.y,this.z,e)}static create(e=0,t=0,r=0,n){return n?(n.x=e,n.y=t,n.z=r,n):new Vector3d(e,t,r)}static createCrossProduct(e,t,r,n,i,o,s){return Vector3d.create(t*o-r*i,r*n-e*o,e*i-t*n,s)}addCrossProductToTargetsInPlace(e,t,r,n,i,o,s,a,c){const l=n-e,u=i-t,d=o-r,h=s-e,p=a-t,f=c-r;this.x+=u*f-d*p,this.y+=d*h-l*f,this.z+=l*p-u*h}static createCrossProductToPoints(e,t,r,n){return Vector3d.createCrossProduct(t.x-e.x,t.y-e.y,t.z-e.z,r.x-e.x,r.y-e.y,r.z-e.z,n)}static createPolar(e,t,r){return Vector3d.create(e*t.cos(),e*t.sin(),r)}static createSpherical(e,t,r){const n=r.cos();return Vector3d.create(n*e*t.cos(),n*e*t.sin(),r.sin())}static fromJSON(e){const t=new Vector3d;return t.setFromJSON(e),t}static createFrom(e,t){return e instanceof Float64Array?e.length>=3?Vector3d.create(e[0],e[1],e[2]):e.length>=2?Vector3d.create(e[0],e[1],0):e.length>=1?Vector3d.create(e[0],0,0):Vector3d.create(0,0,0):Vector3d.create(e.x,e.y,XYZ.hasZ(e)?e.z:0,t)}static createStartEnd(e,t,r){return r?(r.set(t.x-e.x,t.y-e.y,t.z-e.z),r):new Vector3d(t.x-e.x,t.y-e.y,t.z-e.z)}static createStartEndXYZXYZ(e,t,r,n,i,o,s){return s?(s.set(n-e,i-t,o-r),s):new Vector3d(n-e,i-t,o-r)}static createRotateVectorAroundVector(e,t,r){const n=t.normalize();if(n){const t=n.crossProduct(e);if(r){const i=r.cos(),o=r.sin();return Vector3d.createAdd3Scaled(e,i,t,o,n,n.dotProduct(e)*(1-i))}return e.plusScaled(n,n.dotProduct(e))}}setStartEnd(e,t){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}static createZero(e){return Vector3d.create(0,0,0,e)}static unitX(e=1){return new Vector3d(e,0,0)}static unitY(e=1){return new Vector3d(0,e,0)}static unitZ(e=1){return new Vector3d(0,0,e)}safeDivideOrNull(e,t){if(0!==e)return this.scale(1/e,t)}normalizeWithLength(e){const t=n.Geometry.correctSmallMetricDistance(this.magnitude());return e=e||new Vector3d,{v:this.safeDivideOrNull(t,e),mag:t}}normalize(e){return this.normalizeWithLength(e).v}normalizeInPlace(){const e=n.Geometry.inverseMetricDistance(this.magnitude());return!!e&&(this.x*=e,this.y*=e,this.z*=e,!0)}fractionOfProjectionToVector(e,t=0){const r=this.dotProduct(e),i=e.magnitudeSquared();return i<n.Geometry.smallMetricDistanceSquared?t:r/i}negate(e){return(e=e||new Vector3d).x=-this.x,e.y=-this.y,e.z=-this.z,e}rotate90CCWXY(e){e=e||new Vector3d;const t=this.x,r=this.y;return e.x=-r,e.y=t,e.z=this.z,e}unitPerpendicularXY(e){e=e||new Vector3d;const t=this.x,r=this.y;e.x=-r,e.y=t,e.z=0;const n=t*t+r*r;if(0!==n){const t=1/Math.sqrt(n);e.x*=t,e.y*=t}return e}rotateXY(e,t){const r=e.sin(),n=e.cos(),i=this.x,o=this.y;return(t=t||new Vector3d).x=i*n-o*r,t.y=i*r+o*n,t.z=this.z,t}rotate90Towards(e,t){const r=this.crossProduct(e).normalize();return r?r.crossProduct(this,t):void 0}rotate90Around(e,t){const r=e.normalize();return r?r.crossProduct(this).plusScaled(r,r.dotProduct(this),t):void 0}interpolate(e,t,r){if(r=r||new Vector3d,e<=.5)r.x=this.x+e*(t.x-this.x),r.y=this.y+e*(t.y-this.y),r.z=this.z+e*(t.z-this.z);else{const n=e-1;r.x=t.x+n*(t.x-this.x),r.y=t.y+n*(t.y-this.y),r.z=t.z+n*(t.z-this.z)}return r}plus(e,t){return(t=t||new Vector3d).x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t}minus(e,t){return(t=t||new Vector3d).x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t}plusScaled(e,t,r){return(r=r||new Vector3d).x=this.x+e.x*t,r.y=this.y+e.y*t,r.z=this.z+e.z*t,r}plus2Scaled(e,t,r,n,i){return(i=i||new Vector3d).x=this.x+e.x*t+r.x*n,i.y=this.y+e.y*t+r.y*n,i.z=this.z+e.z*t+r.z*n,i}plus3Scaled(e,t,r,n,i,o,s){return(s=s||new Vector3d).x=this.x+e.x*t+r.x*n+i.x*o,s.y=this.y+e.y*t+r.y*n+i.y*o,s.z=this.z+e.z*t+r.z*n+i.z*o,s}static createAdd2Scaled(e,t,r,n,i){return Vector3d.create(e.x*t+r.x*n,e.y*t+r.y*n,e.z*t+r.z*n,i)}static createAdd2ScaledXYZ(e,t,r,n,i,o,s,a,c){return Vector3d.create(e*n+i*a,t*n+o*a,r*n+s*a,c)}static createAdd3Scaled(e,t,r,n,i,o,s){return Vector3d.create(e.x*t+r.x*n+i.x*o,e.y*t+r.y*n+i.y*o,e.z*t+r.z*n+i.z*o,s)}scale(e,t){return(t=t||new Vector3d).x=this.x*e,t.y=this.y*e,t.z=this.z*e,t}scaleToLength(e,t){const r=n.Geometry.correctSmallMetricDistance(this.magnitude());return 0===r?new Vector3d:this.scale(e/r,t)}unitCrossProduct(e,t){return this.crossProduct(e,t).normalize(t)}unitCrossProductWithDefault(e,t,r,n,i){const o=this.crossProduct(e,i).normalize(i);return void 0===o?Vector3d.create(t,r,n,i):o}normalizeWithDefault(e,t,r,n){const i=this.normalize(n);return i||Vector3d.create(e,t,r,n)}tryNormalizeInPlace(e=n.Geometry.smallMetricDistance){const t=this.magnitude();return!(t<e||0===t)&&(this.scaleInPlace(1/t),!0)}sizedCrossProduct(e,t,r){if((r=this.crossProduct(e,r)).tryNormalizeInPlace())return r.scaleInPlace(t),r}crossProductMagnitudeSquared(e){const t=this.y*e.z-this.z*e.y,r=this.z*e.x-this.x*e.z,n=this.x*e.y-this.y*e.x;return t*t+r*r+n*n}crossProductMagnitude(e){return Math.sqrt(this.crossProductMagnitudeSquared(e))}dotProduct(e){return this.x*e.x+this.y*e.y+this.z*e.z}dotProductStartEnd(e,t){return this.x*(t.x-e.x)+this.y*(t.y-e.y)+this.z*(t.z-e.z)}dotProductStart3dEnd4d(e,t){const r=t.w;return this.x*(t.x-e.x*r)+this.y*(t.y-e.y*r)+this.z*(t.z-e.z*r)}crossProductStartEnd(e,t,r){return Vector3d.createCrossProduct(this.x,this.y,this.z,t.x-e.x,t.y-e.y,t.z-e.z,r)}crossProductStartEndXY(e,t){return n.Geometry.crossProductXYXY(this.x,this.y,t.x-e.x,t.y-e.y)}dotProductStartEndXYZ(e,t,r,n){return this.x*(t-e.x)+this.y*(r-e.y)+this.z*(n-e.z)}dotProductStartEndXYZW(e,t,r,i,o){if(n.Geometry.isSmallMetricDistance(o))return 0;const s=1/o;return this.x*(s*t-e.x)+this.y*(s*r-e.y)+this.z*(s*i-e.z)}dotProductXY(e){return this.x*e.x+this.y*e.y}dotProductXYZ(e,t,r=0){return this.x*e+this.y*t+this.z*r}tripleProduct(e,t){return n.Geometry.tripleProduct(this.x,this.y,this.z,e.x,e.y,e.z,t.x,t.y,t.z)}crossProductXY(e){return this.x*e.y-this.y*e.x}crossProduct(e,t){return Vector3d.createCrossProduct(this.x,this.y,this.z,e.x,e.y,e.z,t)}angleTo(e){return i.Angle.createAtan2(this.crossProductMagnitude(e),this.dotProduct(e))}angleToXY(e){return i.Angle.createAtan2(this.crossProductXY(e),this.dotProductXY(e))}planarRadiansTo(e,t){const r=t.dotProduct(t);if(0===r)return 0;const n=1/r,i=this.plusScaled(t,-this.dotProduct(t)*n),o=e.plusScaled(t,-e.dotProduct(t)*n);return i.signedRadiansTo(o,t)}planarAngleTo(e,t){return i.Angle.createRadians(this.planarRadiansTo(e,t))}signedRadiansTo(e,t){const r=this.crossProduct(e),n=Math.atan2(r.magnitude(),this.dotProduct(e));return t.dotProduct(r)<0?-n:n}signedAngleTo(e,t){return i.Angle.createRadians(this.signedRadiansTo(e,t))}isParallelTo(e,t=!1,r=!1){const i=this.magnitudeSquared(),o=e.magnitudeSquared();return i<n.Geometry.smallMetricDistanceSquared||o<n.Geometry.smallMetricDistanceSquared?r:this.dotProduct(e)<0&&!t?r:this.crossProductMagnitudeSquared(e)<=n.Geometry.smallAngleRadiansSquared*i*o}isPerpendicularTo(e,t=!1){const r=this.magnitudeSquared();if(r<n.Geometry.smallMetricDistanceSquared)return t;const i=e.magnitudeSquared();if(i<n.Geometry.smallMetricDistanceSquared)return t;const o=this.dotProduct(e);return o*o<=n.Geometry.smallAngleRadiansSquared*r*i}}t.Vector3d=Vector3d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(3),o=r(26),s=r(295),a=r(299),c=r(53),l=r(105),u=r(143),d=r(0),h=r(524),p=r(8),f=r(140),g=r(141),m=r(298),y=r(41),v=r(11),_=r(541),w=r(542),S=r(139),b=r(543),x=r(89),P=r(187),C=r(44),T=r(107),M=r(544),E=r(34);!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Success=1]="Success",e[e.Error=2]="Error"}(t.ContextState||(t.ContextState={})),function(e){e[e.TextureUnsignedByte=0]="TextureUnsignedByte",e[e.TextureHalfFloat=1]="TextureHalfFloat",e[e.TextureFloat=2]="TextureFloat"}(t.RenderType||(t.RenderType={})),function(e){e[e.RenderBufferUnsignedShort16=0]="RenderBufferUnsignedShort16",e[e.TextureUnsignedInt24Stencil8=1]="TextureUnsignedInt24Stencil8",e[e.TextureUnsignedInt32=2]="TextureUnsignedInt32"}(t.DepthType||(t.DepthType={}));const I=!1,A=!1,R=!1;class Capabilities{constructor(){this._maxRenderType=0,this._maxDepthType=0,this._maxTextureSize=0,this._maxColorAttachments=0,this._maxDrawBuffers=0,this._maxFragTextureUnits=0,this._maxVertTextureUnits=0,this._maxVertAttribs=0,this._maxVertUniformVectors=0,this._maxVaryingVectors=0,this._maxFragUniformVectors=0,this._extensionMap={}}get maxRenderType(){return this._maxRenderType}get maxDepthType(){return this._maxDepthType}get maxTextureSize(){return this._maxTextureSize}get maxColorAttachments(){return this._maxColorAttachments}get maxDrawBuffers(){return this._maxDrawBuffers}get maxFragTextureUnits(){return this._maxFragTextureUnits}get maxVertTextureUnits(){return this._maxVertTextureUnits}get maxVertAttribs(){return this._maxVertAttribs}get maxVertUniformVectors(){return this._maxVertUniformVectors}get maxVaryingVectors(){return this._maxVaryingVectors}get maxFragUniformVectors(){return this._maxFragUniformVectors}get supportsNonPowerOf2Textures(){return!1}get supportsDrawBuffers(){return void 0!==this.queryExtensionObject("WEBGL_draw_buffers")}get supports32BitElementIndex(){return void 0!==this.queryExtensionObject("OES_element_index_uint")}get supportsTextureFloat(){return void 0!==this.queryExtensionObject("OES_texture_float")}get supportsTextureHalfFloat(){return void 0!==this.queryExtensionObject("OES_texture_half_float")}get supportsShaderTextureLOD(){return void 0!==this.queryExtensionObject("EXT_shader_texture_lod")}get supportsMRTTransparency(){return this.maxColorAttachments>=2}get supportsMRTPickShaders(){return this.maxColorAttachments>=4}queryExtensionObject(e){const t=this._extensionMap[e];return null!==t?t:void 0}init(e){this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._maxFragTextureUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._maxVertTextureUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxVertAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this._maxVertUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this._maxVaryingVectors=e.getParameter(e.MAX_VARYING_VECTORS),this._maxFragUniformVectors=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS);const t=e.getSupportedExtensions();if(t)for(const n of t)if(!I&&"WEBGL_draw_buffers"===n||"OES_element_index_uint"===n||!A&&"OES_texture_float"===n||"OES_texture_half_float"===n||"WEBGL_depth_texture"===n||"EXT_color_buffer_float"===n||"EXT_shader_texture_lod"===n){const t=e.getExtension(n);null!==t&&(this._extensionMap[n]=t)}const r=this.queryExtensionObject("WEBGL_draw_buffers");if(this._maxColorAttachments=void 0!==r?e.getParameter(r.MAX_COLOR_ATTACHMENTS_WEBGL):1,this._maxDrawBuffers=void 0!==r?e.getParameter(r.MAX_DRAW_BUFFERS_WEBGL):1,!A&&this.isTextureRenderable(e,e.FLOAT))this._maxRenderType=2;else{const t=this.queryExtensionObject("OES_texture_half_float");this._maxRenderType=void 0!==t&&this.isTextureRenderable(e,t.HALF_FLOAT_OES)?1:0}return this._maxDepthType=void 0!==this.queryExtensionObject("WEBGL_depth_texture")?1:0,this.debugPrint(e),this._hasRequiredFeatures&&this._hasRequiredTextureUnits}static create(e){const t=new Capabilities;return t.init(e)?t:void 0}isTextureRenderable(e,t){const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null);const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER);return e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(n),e.deleteTexture(r),e.getError(),i===e.FRAMEBUFFER_COMPLETE}get _hasRequiredFeatures(){return this.supports32BitElementIndex}get _hasRequiredTextureUnits(){return this.maxFragTextureUnits>4&&this.maxVertTextureUnits>5}debugPrint(e){this._hasRequiredFeatures,this._hasRequiredTextureUnits,e.getParameter(e.VERSION),e.getParameter(e.VENDOR),e.getParameter(e.RENDERER),this.maxTextureSize,this.maxColorAttachments,this.maxDrawBuffers,this.maxFragTextureUnits,this.maxVertTextureUnits,this.supportsNonPowerOf2Textures,this.supportsDrawBuffers,this.supports32BitElementIndex,this.supportsTextureFloat,this.supportsTextureHalfFloat,this.supportsShaderTextureLOD,this.maxRenderType,this.maxDepthType}}t.Capabilities=Capabilities;class IdMap{constructor(){this.materials=new Map,this.textures=new Map,this.gradients=new d.Dictionary(n.Gradient.Symb.compareSymb),this.clipVolumes=new Map}dispose(){const e=Array.from(this.textures.values()),t=this.gradients.extractArrays().values,r=Array.from(this.clipVolumes.values());for(const n of e)d.dispose(n);for(const n of t)d.dispose(n);for(const n of r)d.dispose(n);this.textures.clear(),this.gradients.clear(),this.clipVolumes.clear()}addMaterial(e){e.key&&this.materials.set(e.key,e)}addTexture(e){e.key&&this.textures.set(e.key,e)}addGradient(e,t){this.gradients.set(e,t)}findMaterial(e){return this.materials.get(e)}findGradient(e){return this.gradients.get(e)}getMaterial(e){if(!e.key)return new P.Material(e);let t=this.materials.get(e.key);return t||(t=new P.Material(e),this.materials.set(e.key,t)),t}createTexture(e,t){if(void 0===t)return;const r=new y.Texture(e,t);return this.addTexture(r),r}createTextureFromImageBuffer(e,t){return this.createTexture(t,y.TextureHandle.createForImageBuffer(e,t.type))}createTextureFromImage(e,t,r){return this.createTexture(r,y.TextureHandle.createForImage(e,t,r.type))}createTextureFromCubeImages(e,t,r,n,i,o,s){return this.createTexture(s,y.TextureHandle.createForCubeImages(e,t,r,n,i,o))}findTexture(e){return void 0!==e?this.textures.get(e):void 0}getTexture(e,t){const r=this.findTexture(t.key);return void 0!==r?r:this.createTextureFromImageBuffer(e,t)}getTextureFromImage(e,t,r){const n=this.findTexture(r.key);return void 0!==n?n:this.createTextureFromImage(e,t,r)}getTextureFromCubeImages(e,t,r,n,i,o,s){return this.createTextureFromCubeImages(e,t,r,n,i,o,s)}getGradient(e){const t=this.gradients.get(e);if(t)return t;const r=e.getImage(256,256),n=y.TextureHandle.createForImageBuffer(r,0);if(!n)return;const i=new y.Texture.Params(void 0,0,!0),o=new y.Texture(i,n);return this.addGradient(e,o),o}getClipVolume(e){const t=this.clipVolumes.get(e);if(t)return t;let r=M.ClipMaskVolume.create(e);return void 0===r&&(r=M.ClipPlanesVolume.create(e)),void 0!==r&&this.clipVolumes.set(e,r),r}}t.IdMap=IdMap;class TextureStats{constructor(){this._allocated=new Set,this._maxSize=0}onTextureCreated(e){this._allocated.has(e);const t=e.width*e.height;this._maxSize=Math.max(t,this._maxSize),this._allocated.add(e)}onTextureDisposed(e){if(this._allocated.has(e),this._allocated.delete(e),!(e.width*e.height<this._maxSize)){this._maxSize=0;for(const e of this._allocated)this._maxSize=Math.max(this._maxSize,e.width*e.height)}}}class System extends o.RenderSystem{constructor(e,t,r){super(),this.currentRenderState=new f.RenderState,this.frameBufferStack=new g.FrameBufferStack,this._textureBindings=[],this.canvas=e,this.context=t,this.capabilities=r,this._drawBuffersExtension=r.queryExtensionObject("WEBGL_draw_buffers"),this.resourceCache=new Map,u.IModelConnection.onClose.addListener(this.removeIModelMap.bind(this)),R&&(this._textureStats=new TextureStats,y.TextureHandle.monitor=this._textureStats)}static get instance(){return p.IModelApp.renderSystem}get isValid(){return void 0!==this.canvas}get lineCodeTexture(){return this._lineCodeTexture}get techniques(){return this._techniques}get maxTextureSize(){return this.capabilities.maxTextureSize}setDrawBuffers(e){void 0!==this._drawBuffersExtension&&this._drawBuffersExtension.drawBuffersWEBGL(e)}static create(){const e=document.createElement("canvas");if(null===e)throw new n.IModelError(32768,"Failed to obtain HTMLCanvasElement");let t=e.getContext("webgl");if(null===t&&null===(t=e.getContext("experimental-webgl")))throw new n.IModelError(32768,"Failed to obtain WebGL context");const r=Capabilities.create(t);if(void 0===r)throw new n.IModelError(32768,"Failed to initialize rendering capabilities");return new System(e,t,r)}dispose(){d.dispose(this.techniques),this.resourceCache.forEach(e=>{d.dispose(e)}),this.resourceCache.clear(),u.IModelConnection.onClose.removeListener(this.removeIModelMap)}onInitialized(){this._techniques=h.Techniques.create(this.context),this._lineCodeTexture=y.TextureHandle.createForData(x.LineCode.size,x.LineCode.count,new Uint8Array(x.LineCode.lineCodeData),!1,v.GL.Texture.WrapMode.Repeat,v.GL.Texture.Format.Luminance),this._lineCodeTexture}createTarget(e){return new s.OnScreenTarget(e)}createOffscreenTarget(e){return new s.OffScreenTarget(e)}createGraphicBuilder(e,t,r,n){return new a.PrimitiveBuilder(this,t,r,e,n)}createMesh(e){return S.MeshGraphic.create(e)}createPolyline(e){return _.PolylinePrimitive.create(e)}createPointString(e){return w.PointStringPrimitive.create(e)}createPointCloud(e){return b.PointCloudPrimitive.create(e)}createGraphicList(e){return new l.GraphicsArray(e)}createBranch(e,t,r){return new l.Branch(e,t,r)}createBatch(e,t,r){return new l.Batch(e,t,r)}createSkyBox(e){if(void 0!==e.cube){const t=C.SkyBoxQuadsGeometry.create(e.cube);return void 0!==t?new T.SkyBoxPrimitive(t):void 0}{void 0!==e.sphere||e.gradient;const t=C.SkySphereViewportQuadGeometry.createGeometry(e);return void 0!==t?new T.SkySpherePrimitive(t):void 0}}applyRenderState(e){e.apply(this.currentRenderState),this.currentRenderState.copyFrom(e)}createDepthBuffer(e,t){switch(this.capabilities.maxDepthType){case 0:return m.RenderBuffer.create(e,t);case 2:return y.TextureHandle.createForAttachment(e,t,v.GL.Texture.Format.DepthComponent,v.GL.Texture.DataType.UnsignedInt);case 1:{const r=this.capabilities.queryExtensionObject("WEBGL_depth_texture");return y.TextureHandle.createForAttachment(e,t,v.GL.Texture.Format.DepthStencil,r.UNSIGNED_INT_24_8_WEBGL)}default:return}}createIModelMap(e){let t=this.resourceCache.get(e);return t||(t=new IdMap,this.resourceCache.set(e,t)),t}removeIModelMap(e){const t=this.resourceCache.get(e);void 0!==t&&(d.dispose(t),this.resourceCache.delete(e))}createMaterial(e,t){return this.getIdMap(t).getMaterial(e)}findMaterial(e,t){const r=this.resourceCache.get(t);if(r)return r.findMaterial(e)}createTextureFromImageBuffer(e,t,r){return this.getIdMap(t).getTexture(e,r)}createTextureFromImage(e,t,r,n){if(void 0===r){const r=y.TextureHandle.createForImage(e,t,n.type);return void 0!==r?new y.Texture(n,r):void 0}return this.getIdMap(r).getTextureFromImage(e,t,n)}createTextureFromCubeImages(e,t,r,n,i,o,s,a){return this.getIdMap(s).getTextureFromCubeImages(e,t,r,n,i,o,a)}getGradientTexture(e,t){return this.getIdMap(t).getGradient(e)}findTexture(e,t){const r=this.resourceCache.get(t);if(r)return r.findTexture(e)}getClipVolume(e,t){return this.getIdMap(t).getClipVolume(e)}getIdMap(e){const t=this.resourceCache.get(e);return void 0!==t?t:this.createIModelMap(e)}createSheetTilePolyfaces(e,t){const r=[],n=i.Range3d.createArray(e),o=1/(n.high.x-n.low.x),s=n.low;let a;if(0===(a=void 0!==t?i.ClipUtilities.clipPolygonToClipShape(e,t.clips[0]):[e]).length)return r;const c=new i.StrokeOptions;c.needParams=!0,c.shouldTriangulate=!0;const l=i.PolyfaceBuilder.create(c);for(const u of a)if(!(u.length<3))if(3===u.length){const e=[];for(const t of u){const r=t.minus(s);e.push(i.Point2d.create(r.x*o,r.y*o))}l.addTriangleFacet(u,e)}else if(4===u.length){const e=[];for(const t of u){const r=t.minus(s);e.push(i.Point2d.create(r.x*o,r.y*o))}l.addQuadFacet(u,e)}else{const e=i.Triangulator.earcutSingleLoop(u);i.Triangulator.cleanupTriangulation(e),e.announceFaceLoops((e,t)=>{if(!t.isMaskSet(1)){const e=[],r=[];t.collectAroundFace(t=>{const n=i.Point3d.create(t.x,t.y,.5);e.push(n);const a=n.minus(s);r.push(i.Point2d.create(a.x*o,a.y*o))}),e.length,l.addTriangleFacet(e,r)}return!0})}return r.push(l.claimPolyface()),r}createSheetTile(e,t,r){const o=[];for(const s of t){const t=s.data.param;if(void 0===t)return o;const a=new c.MeshArgs,l=s.data.point.getPoint3dArray();a.points=new n.QPoint3dList(n.QParams3d.fromRange(i.Range3d.createArray(l)));for(const e of l)a.points.push(n.QPoint3d.create(e,a.points.params));const u=[];for(const e of t)u.push(e.clone());const d=[],h=[],p=i.IndexedPolyfaceVisitor.create(s,0);for(;p.moveToNextFacet();)for(let e=0;e<3;e++)d.push(p.clientPointIndex(e)),h.push(p.clientParamIndex(e));let f=0;const g=[];for(const e of d)g[e]=u[h[f++]];a.textureUv=g,a.vertIndices=d,a.texture=e,a.material=void 0,a.isPlanar=!0,a.colors.initUniform(r);const m=this.createTriMesh(a);void 0!==m&&o.push(m)}return o}bindTexture(e,t,r){const n=e-E.TextureUnit.Zero;this._textureBindings[n]!==r&&(this._textureBindings[n]=r,this.context.activeTexture(e),this.context.bindTexture(t,void 0!==r?r:null))}bindTexture2d(e,t){this.bindTexture(e,v.GL.Texture.Target.TwoDee,t)}bindTextureCubeMap(e,t){this.bindTexture(e,v.GL.Texture.Target.CubeMap,t)}ensureSamplerBound(e,t){const r=t-E.TextureUnit.Zero;void 0===this._textureBindings[r]?this.lineCodeTexture.bindSampler(e,t):e.setUniform1i(r)}disposeTexture(e){System.instance.context.deleteTexture(e);for(let t=0;t<this._textureBindings.length;t++)if(this._textureBindings[t]===e){this._textureBindings[t]=void 0;break}}}t.System=System},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(69),o=r(4),s=r(490),a=r(76),c=r(161),l=r(103),u=r(135),d=r(293),h=r(7),p=r(317),f=r(30),g=r(134),m=r(318),y=r(320),v=r(321),_=r(146);class IModelApp{static get renderSystem(){return IModelApp._renderSystem}static get initialized(){return IModelApp._initialized}static get iModelClient(){return this._imodelClient||(this._imodelClient=new i.IModelHubClient),this._imodelClient}static set iModelClient(e){this._imodelClient=e}static get hasRenderSystem(){return void 0!==this._renderSystem&&this._renderSystem.isValid}static startup(e){if(IModelApp._initialized)throw new o.IModelError(65537,"startup may only be called once");IModelApp._initialized=!0,void 0!==e&&(this._imodelClient=e),IModelApp.i18n=new s.I18N(["iModelJs"],"iModelJs",this.supplyI18NOptions());const t=IModelApp.tools,r=IModelApp.i18n.registerNamespace("CoreTools");t.registerModule(v,r),t.registerModule(y,r),t.registerModule(_,r),this.onStartup(),IModelApp.applicationId||(IModelApp.applicationId="IModelJsApp"),IModelApp.settings||(IModelApp.settings=new i.ConnectSettingsClient(IModelApp.applicationId)),IModelApp._renderSystem||(IModelApp._renderSystem=this.supplyRenderSystem()),IModelApp.viewManager||(IModelApp.viewManager=new m.ViewManager),IModelApp.notifications||(IModelApp.notifications=new u.NotificationManager),IModelApp.toolAdmin||(IModelApp.toolAdmin=new g.ToolAdmin),IModelApp.accuDraw||(IModelApp.accuDraw=new c.AccuDraw),IModelApp.accuSnap||(IModelApp.accuSnap=new a.AccuSnap),IModelApp.locateManager||(IModelApp.locateManager=new l.ElementLocateManager),IModelApp.tentativePoint||(IModelApp.tentativePoint=new p.TentativePoint),IModelApp.quantityFormatter||(IModelApp.quantityFormatter=new d.QuantityFormatter),IModelApp._renderSystem.onInitialized(),IModelApp.viewManager.onInitialized(),IModelApp.toolAdmin.onInitialized(),IModelApp.accuDraw.onInitialized(),IModelApp.accuSnap.onInitialized(),IModelApp.locateManager.onInitialized(),IModelApp.tentativePoint.onInitialized()}static shutdown(){IModelApp.toolAdmin.onShutDown(),IModelApp.viewManager.onShutDown(),IModelApp._renderSystem=n.dispose(IModelApp._renderSystem),IModelApp._initialized=!1}static onStartup(){}static supplyI18NOptions(){}static supplyRenderSystem(){return h.System.create()}}IModelApp._initialized=!1,IModelApp.features=new o.FeatureGates,IModelApp.tools=new f.ToolRegistry,t.IModelApp=IModelApp},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(19),o=r(23),s=r(13),a=r(6),c=r(10);class Transform{constructor(e,t){this._origin=e,this._matrix=t}static get identity(){return void 0===this._identity&&(this._identity=Transform.createIdentity(),this._identity.freeze()),this._identity}freeze(){Object.freeze(this),Object.freeze(this._origin),this._matrix.freeze()}setFrom(e){this._origin.setFrom(e._origin),this._matrix.setFrom(e._matrix)}setIdentity(){this._origin.setZero(),this._matrix.setIdentity()}setFromJSON(e){if(e){if(e instanceof Object&&e.origin&&e.matrix)return this._origin.setFromJSON(e.origin),void this._matrix.setFromJSON(e.matrix);if(n.Geometry.isArrayOfNumberArray(e,3,4)){const t=e;return this._matrix.setRowValues(t[0][0],t[0][1],t[0][2],t[1][0],t[1][1],t[1][2],t[2][0],t[2][1],t[2][2]),void this._origin.set(t[0][3],t[1][3],t[2][3])}}this.setIdentity()}isAlmostEqual(e){return this._origin.isAlmostEqual(e._origin)&&this._matrix.isAlmostEqual(e._matrix)}toJSON(){return[[this._matrix.coffs[0],this._matrix.coffs[1],this._matrix.coffs[2],this._origin.x],[this._matrix.coffs[3],this._matrix.coffs[4],this._matrix.coffs[5],this._origin.y],[this._matrix.coffs[6],this._matrix.coffs[7],this._matrix.coffs[8],this._origin.z]]}static fromJSON(e){const t=Transform.createIdentity();return t.setFromJSON(e),t}clone(e){return e?(e._matrix.setFrom(this._matrix),e._origin.setFrom(this._origin),e):new Transform(a.Point3d.createFrom(this._origin),this._matrix.clone())}cloneRigid(e=0){const t=c.Matrix3d.createRigidFromMatrix3d(this.matrix,e);if(t)return new Transform(this.origin.cloneAsPoint3d(),t)}static createRefs(e,t,r){return r?(r._origin=e,r._matrix=t,r):new Transform(e,t)}static createRowValues(e,t,r,n,i,o,s,l,u,d,h,p,f){return f?(f._origin.set(n,l,p),f._matrix.setRowValues(e,t,r,i,o,s,u,d,h),f):new Transform(a.Point3d.create(n,l,p),c.Matrix3d.createRowValues(e,t,r,i,o,s,u,d,h))}static createTranslationXYZ(e=0,t=0,r=0,n){return Transform.createRefs(a.Vector3d.create(e,t,r),c.Matrix3d.createIdentity(),n)}static createTranslation(e,t){return Transform.createRefs(e,c.Matrix3d.createIdentity(),t)}get matrix(){return this._matrix}get origin(){return this._origin}getOrigin(){return a.Point3d.createFrom(this._origin)}getTranslation(){return a.Vector3d.createFrom(this._origin)}get isIdentity(){return this._matrix.isIdentity&&this._origin.isAlmostZero}static createIdentity(e){return e?(e._origin.setZero(),e._matrix.setIdentity(),e):Transform.createRefs(a.Point3d.createZero(),c.Matrix3d.createIdentity())}static createOriginAndMatrix(e,t,r){return Transform.createRefs(e?e.cloneAsPoint3d():a.Point3d.createZero(),void 0===t?c.Matrix3d.createIdentity():t.clone(),r)}static createOriginAndMatrixColumns(e,t,r,n,i){return i?i.setOriginAndMatrixColumns(e,t,r,n):i=Transform.createRefs(a.Vector3d.createFrom(e),c.Matrix3d.createColumns(t,r,n)),i}setOriginAndMatrixColumns(e,t,r,n){this._origin.setFrom(e),this._matrix.setColumns(t,r,n)}static createFixedPointAndMatrix(e,t,r){const n=c.Matrix3d.XYZMinusMatrixTimesXYZ(e,t,e);return Transform.createRefs(n,t.clone(),r)}static createScaleAboutPoint(e,t,r){const n=c.Matrix3d.createScale(t,t,t),i=c.Matrix3d.XYZMinusMatrixTimesXYZ(e,n,e);return Transform.createRefs(i,n,r)}multiplyPoint2d(e,t){return c.Matrix3d.XYPlusMatrixTimesXY(this._origin,this._matrix,e,t)}multiplyPoint3d(e,t){return c.Matrix3d.XYZPlusMatrixTimesXYZ(this._origin,this._matrix,e,t)}multiplyXYZ(e,t,r,n){return c.Matrix3d.XYZPlusMatrixTimesCoordinates(this._origin,this._matrix,e,t,r,n)}multiplyComponentXYZ(e,t,r,n){const i=this._matrix.coffs,o=3*e;return this.origin.at(e)+i[o]*t+i[o+1]*r+i[o+2]*n}multiplyComponentXYZW(e,t,r,n,i){const o=this._matrix.coffs,s=3*e;return this.origin.at(e)*i+o[s]*t+o[s+1]*r+o[s+2]*n}multiplyXYZW(e,t,r,n,i){return c.Matrix3d.XYZPlusMatrixTimesWeightedCoordinates(this._origin,this._matrix,e,t,r,n,i)}multiplyXYZWToFloat64Array(e,t,r,n,i){return c.Matrix3d.XYZPlusMatrixTimesWeightedCoordinatesToFloat64Array(this._origin,this._matrix,e,t,r,n,i)}multiplyXYZToFloat64Array(e,t,r,n){return c.Matrix3d.XYZPlusMatrixTimesCoordinatesToFloat64Array(this._origin,this._matrix,e,t,r,n)}multiplyTransposeXYZW(e,t,r,n,o){const s=this._matrix.coffs,a=this._origin;return i.Point4d.create(e*s[0]+t*s[3]+r*s[6],e*s[1]+t*s[4]+r*s[7],e*s[2]+t*s[5]+r*s[8],e*a.x+t*a.y+r*a.z+n,o)}multiplyPoint3dArrayInPlace(e){let t;for(t of e)c.Matrix3d.XYZPlusMatrixTimesXYZ(this._origin,this._matrix,t,t)}multiplyInversePoint3d(e,t){return this._matrix.multiplyInverseXYZAsPoint3d(e.x-this._origin.x,e.y-this._origin.y,e.z-this._origin.z,t)}multiplyInversePoint3dArray(e,t){if(!this._matrix.computeCachedInverse(!0))return;const r=this.origin.x,n=this.origin.y,i=this.origin.z;if(t){const o=Transform.matchArrayLengths(e,t,a.Point3d.createZero);for(let s=0;s<o;s++)this._matrix.multiplyInverseXYZAsPoint3d(e[s].x-r,e[s].y-n,e[s].z-i,t[s])}t=[];for(const o of e)t.push(this._matrix.multiplyInverseXYZAsPoint3d(o.x-r,o.y-n,o.z-i));return t}multiplyInversePoint3dArrayInPlace(e){if(!this._matrix.computeCachedInverse(!0))return;const t=this.origin.x,r=this.origin.y,n=this.origin.z,i=e.length;for(let o=0;o<i;o++)this._matrix.multiplyInverseXYZAsPoint3d(e[o].x-t,e[o].y-r,e[o].z-n,e[o])}static matchArrayLengths(e,t,r){const n=e.length,i=t.length;if(n>i)for(let o=i;o<n;o++)t.push(r());else i>n&&(t.length=n);return n}multiplyPoint2dArray(e,t){if(t){const r=Transform.matchArrayLengths(e,t,s.Point2d.createZero);for(let n=0;n<r;n++)c.Matrix3d.XYPlusMatrixTimesXY(this._origin,this._matrix,e[n],t[n]);return t}t=[];for(const r of e)t.push(c.Matrix3d.XYPlusMatrixTimesXY(this._origin,this._matrix,r));return t}multiplyPoint3dArray(e,t){if(t){const r=Transform.matchArrayLengths(e,t,a.Point3d.createZero);for(let n=0;n<r;n++)c.Matrix3d.XYZPlusMatrixTimesXYZ(this._origin,this._matrix,e[n],t[n]);return t}t=[];for(const r of e)t.push(c.Matrix3d.XYZPlusMatrixTimesXYZ(this._origin,this._matrix,r));return t}multiplyVector(e,t){return this._matrix.multiplyVector(e,t)}multiplyVectorXYZ(e,t,r,n){return this._matrix.multiplyXYZ(e,t,r,n)}multiplyTransformTransform(e,t){return t?(t.setMultiplyTransformTransform(this,e),t):Transform.createRefs(c.Matrix3d.XYZPlusMatrixTimesXYZ(this._origin,this._matrix,e._origin),this._matrix.multiplyMatrixMatrix(e._matrix))}setMultiplyTransformTransform(e,t){void 0===Transform._scratchPoint&&(Transform._scratchPoint=a.Point3d.create()),c.Matrix3d.XYZPlusMatrixTimesXYZ(e._origin,e._matrix,t._origin,Transform._scratchPoint),this._origin.setFrom(Transform._scratchPoint),e._matrix.multiplyMatrixMatrix(t._matrix,this._matrix)}multiplyTransformMatrix3d(e,t){return t?(this._matrix.multiplyMatrixMatrix(e,t._matrix),t._origin.setFrom(this._origin),t):Transform.createRefs(this._origin.cloneAsPoint3d(),this._matrix.multiplyMatrixMatrix(e))}multiplyRange(e,t){const r=e.low.x,n=e.low.y,i=e.low.z,s=e.high.x,a=e.high.y,c=e.high.z;return(t=o.Range3d.createNull(t)).extendTransformedXYZ(this,r,n,i),t.extendTransformedXYZ(this,s,n,i),t.extendTransformedXYZ(this,r,a,i),t.extendTransformedXYZ(this,s,a,i),t.extendTransformedXYZ(this,r,n,c),t.extendTransformedXYZ(this,s,n,c),t.extendTransformedXYZ(this,r,a,c),t.extendTransformedXYZ(this,s,a,c),t}inverse(){const e=this._matrix.inverse();if(e)return Transform.createRefs(e.multiplyXYZ(-this._origin.x,-this._origin.y,-this._origin.z),e)}static initFromRange(e,t,r,n){const i=t.minus(e);0===i.x&&(i.x=1),0===i.y&&(i.y=1),0===i.z&&(i.z=1);const o=new c.Matrix3d;if(r&&(c.Matrix3d.createScale(i.x,i.y,i.z,o),Transform.createOriginAndMatrix(e,o,r)),n){const t=new a.Point3d(-e.x/i.x,-e.y/i.y,-e.z/i.z);c.Matrix3d.createScale(1/i.x,1/i.y,1/i.z,o),Transform.createOriginAndMatrix(t,o,n)}}}t.Transform=Transform},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(16),o=r(19),s=r(13),a=r(6),c=r(9);class PackedMatrix3dOps{static loadMatrix(e,t,r,n,i,o,s,a,c,l){e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=c,e[8]=l}static multiplyMatrixMatrix(e,t,r){return r||(r=new Float64Array(9)),PackedMatrix3dOps.loadMatrix(r,e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]),r}static multiplyMatrixMatrixTranspose(e,t,r){return r||(r=new Float64Array(9)),PackedMatrix3dOps.loadMatrix(r,e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[0]*t[3]+e[1]*t[4]+e[2]*t[5],e[0]*t[6]+e[1]*t[7]+e[2]*t[8],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[3]*t[3]+e[4]*t[4]+e[5]*t[5],e[3]*t[6]+e[4]*t[7]+e[5]*t[8],e[6]*t[0]+e[7]*t[1]+e[8]*t[2],e[6]*t[3]+e[7]*t[4]+e[8]*t[5],e[6]*t[6]+e[7]*t[7]+e[8]*t[8]),r}static multiplyMatrixTransposeMatrix(e,t,r){return r||(r=new Float64Array(9)),PackedMatrix3dOps.loadMatrix(r,e[0]*t[0]+e[3]*t[3]+e[6]*t[6],e[0]*t[1]+e[3]*t[4]+e[6]*t[7],e[0]*t[2]+e[3]*t[5]+e[6]*t[8],e[1]*t[0]+e[4]*t[3]+e[7]*t[6],e[1]*t[1]+e[4]*t[4]+e[7]*t[7],e[1]*t[2]+e[4]*t[5]+e[7]*t[8],e[2]*t[0]+e[5]*t[3]+e[8]*t[6],e[2]*t[1]+e[5]*t[4]+e[8]*t[7],e[2]*t[2]+e[5]*t[5]+e[8]*t[8]),r}static transposeInPlace(e){let t=e[1];e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t}static copyTransposed(e,t){return t===e?PackedMatrix3dOps.transposeInPlace(e):(t||(t=new Float64Array(9)),t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]),t}}var l;!function(e){e[e.unknown=0]="unknown",e[e.inverseStored=1]="inverseStored",e[e.singular=2]="singular"}(l=t.InverseMatrixState||(t.InverseMatrixState={}));class Matrix3d{constructor(e){this.coffs=e||new Float64Array(9),this.inverseCoffs=void 0,this.inverseState=l.unknown}static get identity(){return void 0===this._identity&&(this._identity=Matrix3d.createIdentity(),this._identity.freeze()),this._identity}freeze(){this.computeCachedInverse(!0),Object.freeze(this)}toJSON(){return[[this.coffs[0],this.coffs[1],this.coffs[2]],[this.coffs[3],this.coffs[4],this.coffs[5]],[this.coffs[6],this.coffs[7],this.coffs[8]]]}setFromJSON(e){if(this.inverseCoffs=void 0,e)if(Array.isArray(e)){if(n.Geometry.isArrayOfNumberArray(e,3,3)){const t=e;this.setRowValues(t[0][0],t[0][1],t[0][2],t[1][0],t[1][1],t[1][2],t[2][0],t[2][1],t[2][2])}else if(9===e.length){const t=e;this.setRowValues(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}else if(4===e.length){const t=e;this.setRowValues(t[0],t[1],0,t[2],t[3],0,0,0,1)}}else e instanceof Matrix3d&&this.setFrom(e);else this.setRowValues(0,0,0,0,0,0,0,0,0)}static fromJSON(e){const t=Matrix3d.createIdentity();return t.setFromJSON(e),t}isAlmostEqual(e,t){return t?n.Geometry.isDistanceWithinTol(this.maxDiff(e),t):n.Geometry.isSmallMetricDistance(this.maxDiff(e))}isExactEqual(e){return 0===this.maxDiff(e)}get isXY(){return 0===this.coffs[2]&&0===this.coffs[5]&&0===this.coffs[6]&&0===this.coffs[7]&&1===this.coffs[8]}static _create(e){return e||new Matrix3d}static createRowValues(e,t,r,n,i,o,s,a,c,u){return(u=u||new Matrix3d).inverseState=l.unknown,u.coffs[0]=e,u.coffs[1]=t,u.coffs[2]=r,u.coffs[3]=n,u.coffs[4]=i,u.coffs[5]=o,u.coffs[6]=s,u.coffs[7]=a,u.coffs[8]=c,u}static createCapture(e,t){const r=new Matrix3d(e);return t?(r.inverseCoffs=t,r.inverseState=l.inverseStored):r.inverseState=l.unknown,r}static createColumnsInAxisOrder(e,t,r,n,i){return i||(i=new Matrix3d),0===e?i.setColumns(t,r,n):1===e?i.setColumns(r,n,t):2===e?i.setColumns(n,t,r):4===e?i.setColumns(t,n,r):5===e?i.setColumns(r,t,n):6===e?i.setColumns(n,r,t):i.setColumns(t,r,n),i}setRowValues(e,t,r,n,i,o,s,a,c){this.coffs[0]=e,this.coffs[1]=t,this.coffs[2]=r,this.coffs[3]=n,this.coffs[4]=i,this.coffs[5]=o,this.coffs[6]=s,this.coffs[7]=a,this.coffs[8]=c,this.inverseState=l.unknown}setIdentity(){this.setRowValues(1,0,0,0,1,0,0,0,1),this.setupInverseTranspose()}setZero(){this.setRowValues(0,0,0,0,0,0,0,0,0),this.inverseState=l.singular}setFrom(e){for(let t=0;t<9;t++)this.coffs[t]=e.coffs[t];this.inverseState=l.unknown}clone(e){return(e=e||new Matrix3d).setFrom(this),e}static createZero(){const e=new Matrix3d;return e.inverseState=l.singular,e}static createIdentity(e){return(e=e||new Matrix3d).setIdentity(),e}static createUniformScale(e){return Matrix3d.createScale(e,e,e)}static createRigidHeadsUp(e,t=2,r){const n=Matrix3d.createPerpendicularVectorFavorXYPlane(e),i=Matrix3d.createRigidFromColumns(e,n,t,r);return i?(i.setupInverseTranspose(),i):Matrix3d.createIdentity(r)}static createPerpendicularVectorFavorXYPlane(e,t){const r=e.magnitude()/64;return Math.abs(e.x)<r&&Math.abs(e.y)<r?a.Vector3d.createCrossProduct(e.x,e.y,e.z,0,-1,0,t):a.Vector3d.createCrossProduct(0,0,1,e.x,e.y,e.z,t)}static createPerpendicularVectorFavorPlaneContainingZ(e,t){return t=Matrix3d.createPerpendicularVectorFavorXYPlane(e,t),e.crossProduct(t,t)}static createScale(e,t,r,n){return n?n.setZero():n=new Matrix3d,n.coffs[0]=e,n.coffs[4]=t,n.coffs[8]=r,0===e||0===t||0===r?n.inverseState=l.singular:(n.inverseState=l.inverseStored,n.inverseCoffs=Float64Array.from([1/e,0,0,0,1/t,0,0,0,1/r])),n}static createRotationAroundVector(e,t,r){const n=t.cos(),i=t.sin(),o=1-n,s=e.normalize();if(s){const e=Matrix3d.createRowValues(s.x*s.x*o+n,s.x*s.y*o-i*s.z,s.x*s.z*o+i*s.y,s.y*s.x*o+i*s.z,s.y*s.y*o+n,s.y*s.z*o-i*s.x,s.z*s.x*o-i*s.y,s.z*s.y*o+i*s.x,s.z*s.z*o+n,r);return e.setupInverseTranspose(),e}}static createRotationAroundAxisIndex(e,t,r){const n=t.cos(),i=t.sin();let o;return(o=0===e?Matrix3d.createRowValues(1,0,0,0,n,-i,0,i,n,r):1===e?Matrix3d.createRowValues(n,0,i,0,1,0,-i,0,n,r):Matrix3d.createRowValues(n,-i,0,i,n,0,0,0,1,r)).setupInverseTranspose(),o}static createViewedAxes(e,t,r=0,n=0){const o=e.crossProduct(t);if(o.normalizeInPlace()){const s=Matrix3d.createColumns(e,t,o);if(0!==r){let e=Math.sqrt(.5),t=r<0?-e:e;if(1!==Math.abs(r)){const n=i.Angle.degreesToRadians(45*r);e=Math.cos(n),t=Math.sin(n)}s.applyGivensColumnOp(2,0,e,t)}if(0!==n){const e=n*Math.atan(Math.sqrt(.5)),t=Math.cos(e),r=Math.sin(e);s.applyGivensColumnOp(1,2,t,-r)}return s}}static createStandardWorldToView(e,t=!1,r){switch(e){case 1:r=Matrix3d.createIdentity(r);break;case 2:r=Matrix3d.createRowValues(1,0,0,0,-1,0,0,0,-1);break;case 3:r=Matrix3d.createRowValues(0,-1,0,0,0,1,-1,0,0);break;case 4:r=Matrix3d.createRowValues(0,1,0,0,0,1,1,0,0);break;case 5:r=Matrix3d.createRowValues(1,0,0,0,0,1,0,-1,0);break;case 6:r=Matrix3d.createRowValues(-1,0,0,0,0,1,0,1,0);break;case 7:r=Matrix3d.createRowValues(.707106781186548,-.7071067811865476,0,.408248290463863,.408248290463863,.816496580927726,-.577350269189626,-.5773502691896257,.5773502691896257);break;case 8:r=Matrix3d.createRowValues(.707106781186548,.7071067811865476,0,-.408248290463863,.408248290463863,.816496580927726,.577350269189626,-.5773502691896257,.5773502691896257);break;default:r=Matrix3d.createIdentity(r)}return t&&r.transposeInPlace(),r}getAxisAndAngleOfRotation(){const e=this.coffs[0]+this.coffs[4]+this.coffs[8],t=this.coffs[3]-this.coffs[1],r=this.coffs[7]-this.coffs[5],o=this.coffs[2]-this.coffs[6],s=(e-1)/2,c=n.Geometry.hypotenuseXYZ(t,r,o)/2,l=s*s+c*c-1;if(Math.abs(l)>n.Geometry.smallAngleRadians)return{axis:a.Vector3d.create(0,0,1),angle:i.Angle.createRadians(0),ok:!1};if(Math.abs(c)<n.Geometry.smallAngleRadians){if(s>0)return{axis:a.Vector3d.create(0,0,1),angle:i.Angle.createRadians(0),ok:!0};const e=this.coffs[0],t=this.coffs[4],r=this.coffs[8],o=i.Angle.createDegrees(180);if(n.Geometry.isAlmostEqualNumber(-1,t)&&n.Geometry.isAlmostEqualNumber(-1,r))return{axis:a.Vector3d.create(1,0,0),angle:o,ok:!0};if(n.Geometry.isAlmostEqualNumber(-1,e)&&n.Geometry.isAlmostEqualNumber(-1,r))return{axis:a.Vector3d.create(0,1,0),angle:o,ok:!0};if(n.Geometry.isAlmostEqualNumber(-1,e)&&n.Geometry.isAlmostEqualNumber(-1,t))return{axis:a.Vector3d.create(0,0,1),angle:o,ok:!0};const c=Matrix3d.createIdentity(),l=a.Vector3d.create(0,0,0);return this.fastSymmetricEigenvalues(c,l)?n.Geometry.isAlmostEqualNumber(1,l.x)?{axis:c.getColumn(0),angle:o,ok:!0}:n.Geometry.isAlmostEqualNumber(1,l.y)?{axis:c.getColumn(1),angle:o,ok:!0}:n.Geometry.isAlmostEqualNumber(1,l.z)?{axis:c.getColumn(2),angle:o,ok:!0}:{axis:a.Vector3d.create(0,0,1),angle:i.Angle.createRadians(0),ok:!1}:{axis:a.Vector3d.create(0,0,1),angle:i.Angle.createRadians(0),ok:!1}}const u=1/(2*c);return{axis:a.Vector3d.create(r*u,o*u,t*u),angle:i.Angle.createAtan2(c,s),ok:!0}}static createRotationVectorToVector(e,t,r){return this.createPartialRotationVectorToVector(e,1,t,r)}static createPartialRotationVectorToVector(e,t,r,o){let s=e.unitCrossProduct(r);return s?Matrix3d.createRotationAroundVector(s,i.Angle.createRadians(t*e.planarAngleTo(r,s).radians)):n.Geometry.isSmallMetricDistance(e.magnitude())||n.Geometry.isSmallMetricDistance(r.magnitude())?void 0:e.dotProduct(r)>0?Matrix3d.createIdentity(o):(s=Matrix3d.createPerpendicularVectorFavorPlaneContainingZ(e,s),Matrix3d.createRotationAroundVector(s,i.Angle.createRadians(t*Math.PI)))}static create90DegreeRotationAroundAxis(e){if(0===(e=n.Geometry.cyclic3dAxis(e))){const e=Matrix3d.createRowValues(1,0,0,0,0,-1,0,1,0);return e.setupInverseTranspose(),e}if(1===e){const e=Matrix3d.createRowValues(0,0,1,0,1,0,-1,0,0);return e.setupInverseTranspose(),e}{const e=Matrix3d.createRowValues(0,-1,0,1,0,0,0,0,1);return e.setupInverseTranspose(),e}}columnX(e){return a.Vector3d.create(this.coffs[0],this.coffs[3],this.coffs[6],e)}columnY(e){return a.Vector3d.create(this.coffs[1],this.coffs[4],this.coffs[7],e)}columnZ(e){return a.Vector3d.create(this.coffs[2],this.coffs[5],this.coffs[8],e)}columnXMagnitudeSquared(){return n.Geometry.hypotenuseSquaredXYZ(this.coffs[0],this.coffs[3],this.coffs[6])}columnYMagnitudeSquared(){return n.Geometry.hypotenuseSquaredXYZ(this.coffs[1],this.coffs[4],this.coffs[7])}columnZMagnitudeSquared(){return n.Geometry.hypotenuseSquaredXYZ(this.coffs[2],this.coffs[5],this.coffs[8])}columnXMagnitude(){return Math.hypot(this.coffs[0],this.coffs[3],this.coffs[6])}columnYMagnitude(){return Math.hypot(this.coffs[1],this.coffs[4],this.coffs[7])}columnZMagnitude(){return Math.hypot(this.coffs[2],this.coffs[5],this.coffs[8])}columnXYCrossProductMagnitude(){return n.Geometry.crossProductMagnitude(this.coffs[0],this.coffs[3],this.coffs[6],this.coffs[1],this.coffs[4],this.coffs[7])}rowXMagnitude(){return Math.hypot(this.coffs[0],this.coffs[1],this.coffs[2])}rowYMagnitude(){return Math.hypot(this.coffs[3],this.coffs[4],this.coffs[5])}rowZMagnitude(){return Math.hypot(this.coffs[6],this.coffs[7],this.coffs[8])}columnXDotColumnY(){return this.coffs[0]*this.coffs[1]+this.coffs[3]*this.coffs[4]+this.coffs[6]*this.coffs[7]}rowX(e){return a.Vector3d.create(this.coffs[0],this.coffs[1],this.coffs[2],e)}rowY(e){return a.Vector3d.create(this.coffs[3],this.coffs[4],this.coffs[5],e)}rowZ(e){return a.Vector3d.create(this.coffs[6],this.coffs[7],this.coffs[8],e)}dotColumnX(e){return e.x*this.coffs[0]+e.y*this.coffs[3]+e.z*this.coffs[6]}dotColumnY(e){return e.x*this.coffs[1]+e.y*this.coffs[4]+e.z*this.coffs[7]}dotColumnZ(e){return e.x*this.coffs[2]+e.y*this.coffs[5]+e.z*this.coffs[8]}dotRowX(e){return e.x*this.coffs[0]+e.y*this.coffs[1]+e.z*this.coffs[2]}dotRowY(e){return e.x*this.coffs[3]+e.y*this.coffs[4]+e.z*this.coffs[5]}dotRowZ(e){return e.x*this.coffs[6]+e.y*this.coffs[7]+e.z*this.coffs[8]}dotRowXXYZ(e,t,r){return e*this.coffs[0]+t*this.coffs[1]+r*this.coffs[2]}dotRowYXYZ(e,t,r){return e*this.coffs[3]+t*this.coffs[4]+r*this.coffs[5]}dotRowZXYZ(e,t,r){return e*this.coffs[6]+t*this.coffs[7]+r*this.coffs[8]}columnZCrossVector(e,t){return n.Geometry.crossProductXYZXYZ(this.coffs[2],this.coffs[5],this.coffs[8],e.x,e.y,e.z,t)}applyGivensRowOp(e,t,r,n){let i=3*e,o=3*t;const s=i+3;for(;i<s;i++,o++){const e=this.coffs[i],t=this.coffs[o];this.coffs[i]=e*r+t*n,this.coffs[o]=-e*n+t*r}}applyGivensColumnOp(e,t,r,n){const i=e+9;for(;e<i;e+=3,t+=3){const i=this.coffs[e],o=this.coffs[t];this.coffs[e]=i*r+o*n,this.coffs[t]=-i*n+o*r}}static createRigidViewAxesZTowardsEye(e,t,r,i){i=Matrix3d.createIdentity(i);const o=n.Geometry.hypotenuseXY(e,t);if(n.Geometry.isSmallMetricDistance(o))r<0&&i.scaleColumnsInPlace(1,-1,-1);else{const s=e/o,a=t/o;if(i.setRowValues(-a,0,s,s,0,a,0,1,0),0!==r){const s=n.Geometry.hypotenuseXYZ(e,t,r),a=r/s,c=o/s;i.applyGivensColumnOp(1,2,c,-a)}}return i}applyJacobiColumnRotation(e,t,r){const n=this.coffs[e]*this.coffs[e]+this.coffs[e+3]*this.coffs[e+3]+this.coffs[e+6]*this.coffs[e+6],o=this.coffs[t]*this.coffs[t]+this.coffs[t+3]*this.coffs[t+3]+this.coffs[t+6]*this.coffs[t+6],s=this.coffs[e]*this.coffs[t]+this.coffs[e+3]*this.coffs[t+3]+this.coffs[e+6]*this.coffs[t+6],a=i.Angle.trigValuesToHalfAngleTrigValues(n-o,2*s);return Math.abs(a.s)<2e-15?0:(this.applyGivensColumnOp(e,t,a.c,a.s),r.applyGivensRowOp(e,t,a.c,a.s),Math.abs(s))}factorPerpendicularColumns(e,t){e.setFrom(this),t.setIdentity();const r=1e-12*this.sumSquares();for(let n=0;n<7;n++){if(e.applyJacobiColumnRotation(0,1,t)+e.applyJacobiColumnRotation(0,2,t)+e.applyJacobiColumnRotation(1,2,t)<r)return!0}return!1}applySymmetricJacobi(e,t,r){const n=r.at(e,e),o=r.at(t,t),s=r.at(e,t);if(Math.abs(s)<1e-15*(n+o))return 0;const a=i.Angle.trigValuesToHalfAngleTrigValues(n-o,2*s);return Math.abs(a.s)<2e-15?0:(this.applyGivensColumnOp(e,t,a.c,a.s),r.applyGivensRowOp(e,t,a.c,a.s),r.applyGivensColumnOp(e,t,a.c,a.s),Math.abs(s))}symmetricEigenvalues(e,t){const r=this.clone();e.setIdentity(),r.coffs[3]=r.coffs[1],r.coffs[6]=r.coffs[2],r.coffs[7]=r.coffs[5];const n=1e-12*this.sumSquares();for(let i=0;i<7;i++){if(e.applySymmetricJacobi(0,1,r)+e.applySymmetricJacobi(0,2,r)+e.applySymmetricJacobi(1,2,r)<n)return t.set(r.at(0,0),r.at(1,1),r.at(2,2)),!0}return!1}applyFastSymmetricJacobiUpdate(e,t,r,n){const o=4*e,s=4*t,a=3*e+t,c=3*e+r,l=3*t+r,u=this.coffs[o],d=this.coffs[s],h=this.coffs[a],p=i.Angle.trigValuesToHalfAngleTrigValues(u-d,2*h);if(Math.abs(h)<1e-15*(u+d))return 0;const f=p.c,g=p.s,m=f*f,y=g*g,v=2*f*g;this.coffs[o]=m*u+v*h+y*d,this.coffs[s]=y*u-v*h+m*d,this.coffs[a]=0;const _=this.coffs[c],w=this.coffs[l];return this.coffs[c]=_*f+w*g,this.coffs[l]=-g*_+f*w,this.coffs[3*t+e]=0,this.coffs[3*r+e]=this.coffs[c],this.coffs[3*r+t]=this.coffs[l],n.applyGivensColumnOp(e,t,f,g),Math.abs(h)}fastSymmetricEigenvalues(e,t){const r=this.clone();e.setIdentity();const n=1e-12*this.sumSquares();for(let i=0;i<7;i++){if(r.applyFastSymmetricJacobiUpdate(0,1,2,e)+r.applyFastSymmetricJacobiUpdate(0,2,1,e)+r.applyFastSymmetricJacobiUpdate(1,2,0,e)<n)return t.set(r.at(0,0),r.at(1,1),r.at(2,2)),!0}return!1}static createColumns(e,t,r,n){return Matrix3d.createRowValues(e.x,t.x,r.x,e.y,t.y,r.y,e.z,t.z,r.z,n)}static createColumnsXYW(e,t,r,n,i,o,s){return Matrix3d.createRowValues(e.x,r.x,i.x,e.y,r.y,i.y,t,n,o,s)}setColumnsPoint4dXYZ(e,t,r){this.setRowValues(e.x,t.x,r.x,e.y,t.y,r.y,e.z,t.z,r.z)}setColumn(e,t){const r=n.Geometry.cyclic3dAxis(e);t?(this.coffs[r]=t.x,this.coffs[r+3]=t.y,this.coffs[r+6]=t.z):(this.coffs[r]=0,this.coffs[r+3]=0,this.coffs[r+6]=0)}setColumns(e,t,r){this.setColumn(0,e),this.setColumn(1,t),this.setColumn(2,r)}setRow(e,t){const r=3*n.Geometry.cyclic3dAxis(e);this.coffs[r]=t.x,this.coffs[r+1]=t.y,this.coffs[r+2]=t.z,this.inverseState=l.unknown}getColumn(e,t){const r=n.Geometry.cyclic3dAxis(e);return a.Vector3d.create(this.coffs[r],this.coffs[r+3],this.coffs[r+6],t)}getRow(e,t){const r=3*n.Geometry.cyclic3dAxis(e);return a.Vector3d.create(this.coffs[r],this.coffs[r+1],this.coffs[r+2],t)}static createShuffledColumns(e,t,r,i,o){const s=Matrix3d._create(o);return s.setColumn(n.Geometry.axisOrderToAxis(i,0),e),s.setColumn(n.Geometry.axisOrderToAxis(i,1),t),s.setColumn(n.Geometry.axisOrderToAxis(i,2),r),s}static createRows(e,t,r,n){return Matrix3d.createRowValues(e.x,e.y,e.z,t.x,t.y,t.z,r.x,r.y,r.z,n)}static createDirectionalScale(e,t,r){const n=e.normalize();if(n){const e=n.x,i=n.y,o=n.z,s=t-1;return Matrix3d.createRowValues(1+s*e*e,s*e*i,s*e*o,s*i*e,1+s*i*i,s*i*o,s*o*e,s*o*i,1+s*o*o,r)}return Matrix3d.createUniformScale(t)}multiplyVector(e,t){const r=e.x,n=e.y,i=e.z;return a.Vector3d.create(this.coffs[0]*r+this.coffs[1]*n+this.coffs[2]*i,this.coffs[3]*r+this.coffs[4]*n+this.coffs[5]*i,this.coffs[6]*r+this.coffs[7]*n+this.coffs[8]*i,t)}multiplyVectorArrayInPlace(e){for(const t of e)t.set(this.coffs[0]*t.x+this.coffs[1]*t.y+this.coffs[2]*t.z,this.coffs[3]*t.x+this.coffs[4]*t.y+this.coffs[5]*t.z,this.coffs[6]*t.x+this.coffs[7]*t.y+this.coffs[8]*t.z)}static XYZMinusMatrixTimesXYZ(e,t,r,n){const i=r.x,o=r.y,s=r.z;return a.Point3d.create(e.x-(t.coffs[0]*i+t.coffs[1]*o+t.coffs[2]*s),e.y-(t.coffs[3]*i+t.coffs[4]*o+t.coffs[5]*s),e.z-(t.coffs[6]*i+t.coffs[7]*o+t.coffs[8]*s),n)}static XYPlusMatrixTimesXY(e,t,r,n){const i=r.x,o=r.y;return s.Point2d.create(e.x+t.coffs[0]*i+t.coffs[1]*o,e.y+t.coffs[3]*i+t.coffs[4]*o,n)}static XYZPlusMatrixTimesXYZ(e,t,r,n){const i=r.x,o=r.y,s=r.z;return a.Point3d.create(e.x+t.coffs[0]*i+t.coffs[1]*o+t.coffs[2]*s,e.y+t.coffs[3]*i+t.coffs[4]*o+t.coffs[5]*s,e.z+t.coffs[6]*i+t.coffs[7]*o+t.coffs[8]*s,n)}static XYZPlusMatrixTimesCoordinates(e,t,r,n,i,o){return a.Point3d.create(e.x+t.coffs[0]*r+t.coffs[1]*n+t.coffs[2]*i,e.y+t.coffs[3]*r+t.coffs[4]*n+t.coffs[5]*i,e.z+t.coffs[6]*r+t.coffs[7]*n+t.coffs[8]*i,o)}static XYZPlusMatrixTimesWeightedCoordinates(e,t,r,n,i,s,a){return o.Point4d.create(s*e.x+t.coffs[0]*r+t.coffs[1]*n+t.coffs[2]*i,s*e.y+t.coffs[3]*r+t.coffs[4]*n+t.coffs[5]*i,s*e.z+t.coffs[6]*r+t.coffs[7]*n+t.coffs[8]*i,s,a)}static XYZPlusMatrixTimesWeightedCoordinatesToFloat64Array(e,t,r,n,i,o,s){return s||(s=new Float64Array(4)),s[0]=o*e.x+t.coffs[0]*r+t.coffs[1]*n+t.coffs[2]*i,s[1]=o*e.y+t.coffs[3]*r+t.coffs[4]*n+t.coffs[5]*i,s[2]=o*e.z+t.coffs[6]*r+t.coffs[7]*n+t.coffs[8]*i,s[3]=o,s}static XYZPlusMatrixTimesCoordinatesToFloat64Array(e,t,r,n,i,o){return o||(o=new Float64Array(3)),o[0]=e.x+t.coffs[0]*r+t.coffs[1]*n+t.coffs[2]*i,o[1]=e.y+t.coffs[3]*r+t.coffs[4]*n+t.coffs[5]*i,o[2]=e.z+t.coffs[6]*r+t.coffs[7]*n+t.coffs[8]*i,o}multiplyTransposeVector(e,t){t=t||new a.Vector3d;const r=e.x,n=e.y,i=e.z;return t.x=this.coffs[0]*r+this.coffs[3]*n+this.coffs[6]*i,t.y=this.coffs[1]*r+this.coffs[4]*n+this.coffs[7]*i,t.z=this.coffs[2]*r+this.coffs[5]*n+this.coffs[8]*i,t}multiplyXYZ(e,t,r,n){return(n=n||new a.Vector3d).x=this.coffs[0]*e+this.coffs[1]*t+this.coffs[2]*r,n.y=this.coffs[3]*e+this.coffs[4]*t+this.coffs[5]*r,n.z=this.coffs[6]*e+this.coffs[7]*t+this.coffs[8]*r,n}multiplyXYZtoXYZ(e,t){const r=e.x,n=e.y,i=e.z;return t.x=this.coffs[0]*r+this.coffs[1]*n+this.coffs[2]*i,t.y=this.coffs[3]*r+this.coffs[4]*n+this.coffs[5]*i,t.z=this.coffs[6]*r+this.coffs[7]*n+this.coffs[8]*i,t}multiplyXY(e,t,r){return(r=r||new a.Vector3d).x=this.coffs[0]*e+this.coffs[1]*t,r.y=this.coffs[3]*e+this.coffs[4]*t,r.z=this.coffs[6]*e+this.coffs[7]*t,r}originPlusMatrixTimesXY(e,t,r,n){return a.Point3d.create(e.x+this.coffs[0]*t+this.coffs[1]*r,e.y+this.coffs[3]*t+this.coffs[4]*r,e.z+this.coffs[6]*t+this.coffs[7]*r,n)}multiplyVectorInPlace(e){const t=e.x,r=e.y,n=e.z,i=this.coffs;e.x=i[0]*t+i[1]*r+i[2]*n,e.y=i[3]*t+i[4]*r+i[5]*n,e.z=i[6]*t+i[7]*r+i[8]*n}multiplyTransposeVectorInPlace(e){const t=e.x,r=e.y,n=e.z,i=this.coffs;e.x=i[0]*t+i[3]*r+i[6]*n,e.y=i[1]*t+i[4]*r+i[7]*n,e.z=i[2]*t+i[5]*r+i[8]*n}multiplyTransposeXYZ(e,t,r,n){return(n=n||new a.Vector3d).x=this.coffs[0]*e+this.coffs[3]*t+this.coffs[6]*r,n.y=this.coffs[1]*e+this.coffs[4]*t+this.coffs[7]*r,n.z=this.coffs[2]*e+this.coffs[5]*t+this.coffs[8]*r,n}multiplyInverse(e,t){if(this.computeCachedInverse(!0),this.inverseCoffs){const r=e.x,n=e.y,i=e.z;return a.Vector3d.create(this.inverseCoffs[0]*r+this.inverseCoffs[1]*n+this.inverseCoffs[2]*i,this.inverseCoffs[3]*r+this.inverseCoffs[4]*n+this.inverseCoffs[5]*i,this.inverseCoffs[6]*r+this.inverseCoffs[7]*n+this.inverseCoffs[8]*i,t)}}multiplyInverseTranspose(e,t){if(this.computeCachedInverse(!0),this.inverseCoffs){const r=e.x,n=e.y,i=e.z;return a.Vector3d.create(this.inverseCoffs[0]*r+this.inverseCoffs[3]*n+this.inverseCoffs[6]*i,this.inverseCoffs[1]*r+this.inverseCoffs[4]*n+this.inverseCoffs[7]*i,this.inverseCoffs[2]*r+this.inverseCoffs[5]*n+this.inverseCoffs[8]*i,t)}}multiplyInverseXYZAsVector3d(e,t,r,n){if(this.computeCachedInverse(!0),this.inverseCoffs)return a.Vector3d.create(this.inverseCoffs[0]*e+this.inverseCoffs[1]*t+this.inverseCoffs[2]*r,this.inverseCoffs[3]*e+this.inverseCoffs[4]*t+this.inverseCoffs[5]*r,this.inverseCoffs[6]*e+this.inverseCoffs[7]*t+this.inverseCoffs[8]*r,n)}multiplyInverseXYZAsPoint3d(e,t,r,n){if(this.computeCachedInverse(!0),this.inverseCoffs)return a.Point3d.create(this.inverseCoffs[0]*e+this.inverseCoffs[1]*t+this.inverseCoffs[2]*r,this.inverseCoffs[3]*e+this.inverseCoffs[4]*t+this.inverseCoffs[5]*r,this.inverseCoffs[6]*e+this.inverseCoffs[7]*t+this.inverseCoffs[8]*r,n)}multiplyMatrixMatrix(e,t){return t=t||new Matrix3d,PackedMatrix3dOps.multiplyMatrixMatrix(this.coffs,e.coffs,t.coffs),t}multiplyMatrixMatrixTranspose(e,t){return t=t||new Matrix3d,PackedMatrix3dOps.multiplyMatrixMatrixTranspose(this.coffs,e.coffs,t.coffs),t}multiplyMatrixTransposeMatrix(e,t){return t=t||new Matrix3d,PackedMatrix3dOps.multiplyMatrixTransposeMatrix(this.coffs,e.coffs,t.coffs),t}multiplyMatrixTransform(e,t){return t?(this.multiplyXYZtoXYZ(e.origin,t.origin),this.multiplyMatrixMatrix(e.matrix,t.matrix),t):c.Transform.createRefs(this.multiplyXYZ(e.origin.x,e.origin.y,e.origin.z),this.multiplyMatrixMatrix(e.matrix))}transpose(e){return e||(e=new Matrix3d),PackedMatrix3dOps.copyTransposed(this.coffs,e.coffs),void 0!==this.inverseCoffs?(e.inverseState=l.inverseStored,e.inverseCoffs=PackedMatrix3dOps.copyTransposed(this.inverseCoffs,e.inverseCoffs)):(e.inverseState=this.inverseState,e.inverseCoffs=void 0),e}transposeInPlace(){PackedMatrix3dOps.transposeInPlace(this.coffs),this.inverseCoffs&&PackedMatrix3dOps.transposeInPlace(this.inverseCoffs)}inverse(e){if(this.computeCachedInverse(!0),this.inverseState===l.inverseStored&&this.inverseCoffs)return Matrix3d.createRowValues(this.inverseCoffs[0],this.inverseCoffs[1],this.inverseCoffs[2],this.inverseCoffs[3],this.inverseCoffs[4],this.inverseCoffs[5],this.inverseCoffs[6],this.inverseCoffs[7],this.inverseCoffs[8],e)}setupInverseTranspose(){const e=this.coffs;this.inverseState=l.inverseStored,this.inverseCoffs=Float64Array.from([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]])}static indexedRowCrossProduct(e,t,r,n,i){n[i]=e[t+1]*e[r+2]-e[t+2]*e[r+1],n[i+3]=e[t+2]*e[r]-e[t]*e[r+2],n[i+6]=e[t]*e[r+1]-e[t+1]*e[r]}indexedColumnCrossProductInPlace(e,t,r){const n=this.coffs;n[r]=n[e+3]*n[t+6]-n[e+6]*n[t+3],n[r+3]=n[e+6]*n[t]-n[e]*n[t+6],n[r+6]=n[e]*n[t+3]-n[e+3]*n[t]}axisOrderCrossProductsInPlace(e){switch(e){case 0:this.indexedColumnCrossProductInPlace(0,1,2),this.indexedColumnCrossProductInPlace(2,0,1);break;case 1:this.indexedColumnCrossProductInPlace(1,2,0),this.indexedColumnCrossProductInPlace(0,1,2);break;case 2:this.indexedColumnCrossProductInPlace(2,0,1),this.indexedColumnCrossProductInPlace(1,2,0);break;case 4:this.indexedColumnCrossProductInPlace(0,2,1),this.indexedColumnCrossProductInPlace(1,0,2);break;case 5:this.indexedColumnCrossProductInPlace(1,0,2),this.indexedColumnCrossProductInPlace(2,1,0);break;case 6:this.indexedColumnCrossProductInPlace(2,1,0),this.indexedColumnCrossProductInPlace(0,2,1)}}normalizeColumnsInPlace(e){const t=this.columnXMagnitude(),r=this.columnYMagnitude(),i=this.columnZMagnitude();return e&&e.set(t,r,i),!(n.Geometry.isSmallMetricDistance(t)||n.Geometry.isSmallMetricDistance(r)||n.Geometry.isSmallMetricDistance(i))&&(this.scaleColumns(1/t,1/r,1/i,this),!0)}normalizeRowsInPlace(e){const t=this.rowXMagnitude(),r=this.rowYMagnitude(),i=this.rowZMagnitude();return e&&e.set(t,r,i),!(n.Geometry.isSmallMetricDistance(t)||n.Geometry.isSmallMetricDistance(r)||n.Geometry.isSmallMetricDistance(i))&&(this.scaleRows(1/t,1/r,1/i,this),!0)}static rowColumnDot(e,t,r,n){return e[t]*r[n]+e[t+1]*r[n+3]+e[t+2]*r[n+6]}computeCachedInverse(e){if(e&&Matrix3d.useCachedInverse&&this.inverseState!==l.unknown)return Matrix3d.numUseCache++,this.inverseState===l.inverseStored;this.inverseState=l.unknown,void 0===this.inverseCoffs&&(this.inverseCoffs=new Float64Array(9));const t=this.coffs,r=this.inverseCoffs;Matrix3d.indexedRowCrossProduct(t,3,6,r,0),Matrix3d.indexedRowCrossProduct(t,6,0,r,1),Matrix3d.indexedRowCrossProduct(t,0,3,r,2),Matrix3d.numComputeCache++;const n=Matrix3d.rowColumnDot(t,0,r,0);if(0===n)return this.inverseState=l.singular,this.inverseCoffs=void 0,!1;const i=1/n;for(let o=0;o<9;o++)r[o]*=i;return this.inverseState=l.inverseStored,!0}static flatIndexOf(e,t){return 3*n.Geometry.cyclic3dAxis(e)+n.Geometry.cyclic3dAxis(t)}indexedColumnWithWeight(e,t,r){return e=n.Geometry.cyclic3dAxis(e),o.Point4d.create(this.coffs[e],this.coffs[e+3],this.coffs[e+6],t,r)}at(e,t){return this.coffs[Matrix3d.flatIndexOf(e,t)]}setAt(e,t,r){this.coffs[Matrix3d.flatIndexOf(e,t)]=r,this.inverseState=l.unknown}scaleColumns(e,t,r,n){return Matrix3d.createRowValues(this.coffs[0]*e,this.coffs[1]*t,this.coffs[2]*r,this.coffs[3]*e,this.coffs[4]*t,this.coffs[5]*r,this.coffs[6]*e,this.coffs[7]*t,this.coffs[8]*r,n)}scaleColumnsInPlace(e,t,r){if(this.coffs[0]*=e,this.coffs[1]*=t,this.coffs[2]*=r,this.coffs[3]*=e,this.coffs[4]*=t,this.coffs[5]*=r,this.coffs[6]*=e,this.coffs[7]*=t,this.coffs[8]*=r,this.inverseState===l.inverseStored&&void 0!==this.inverseCoffs){const i=n.Geometry.conditionalDivideFraction(1,e),o=n.Geometry.conditionalDivideFraction(1,t),s=n.Geometry.conditionalDivideFraction(1,r);void 0!==i&&void 0!==o&&void 0!==s?(this.inverseCoffs[0]*=i,this.inverseCoffs[1]*=i,this.inverseCoffs[2]*=i,this.inverseCoffs[3]*=o,this.inverseCoffs[4]*=o,this.inverseCoffs[5]*=o,this.inverseCoffs[6]*=s,this.inverseCoffs[7]*=s,this.inverseCoffs[8]*=s):this.inverseState=l.singular}}scaleRows(e,t,r,n){return Matrix3d.createRowValues(this.coffs[0]*e,this.coffs[1]*e,this.coffs[2]*e,this.coffs[3]*t,this.coffs[4]*t,this.coffs[5]*t,this.coffs[6]*r,this.coffs[7]*r,this.coffs[8]*r,n)}addScaledInPlace(e,t){for(let r=0;r<9;r++)this.coffs[r]+=t*e.coffs[r];this.inverseState=l.unknown}scale(e,t){return Matrix3d.createRowValues(this.coffs[0]*e,this.coffs[1]*e,this.coffs[2]*e,this.coffs[3]*e,this.coffs[4]*e,this.coffs[5]*e,this.coffs[6]*e,this.coffs[7]*e,this.coffs[8]*e,t)}determinant(){return this.coffs[0]*this.coffs[4]*this.coffs[8]-this.coffs[0]*this.coffs[7]*this.coffs[5]+this.coffs[3]*this.coffs[7]*this.coffs[2]-this.coffs[3]*this.coffs[1]*this.coffs[8]+this.coffs[6]*this.coffs[1]*this.coffs[5]-this.coffs[6]*this.coffs[4]*this.coffs[2]}conditionNumber(){const e=this.determinant(),t=n.Geometry.hypotenuseXYZ(this.coffs[0],this.coffs[3],this.coffs[6])+n.Geometry.hypotenuseXYZ(this.coffs[1],this.coffs[4],this.coffs[7])+n.Geometry.hypotenuseXYZ(this.coffs[2],this.coffs[5],this.coffs[8]);return n.Geometry.safeDivideFraction(e,t,0)}sumSquares(){let e=0,t=0;for(e=0;e<9;e++)t+=this.coffs[e]*this.coffs[e];return t}sumDiagonalSquares(){let e=0,t=0;for(e=0;e<9;e+=4)t+=this.coffs[e]*this.coffs[e];return t}sumDiagonal(){return this.coffs[0]+this.coffs[4]+this.coffs[8]}maxAbs(){let e=0,t=0;for(e=0;e<9;e++)t=Math.max(t,Math.abs(this.coffs[e]));return t}maxDiff(e){let t=0,r=0;for(t=0;t<9;t++)r=Math.max(r,Math.abs(this.coffs[t]-e.coffs[t]));return r}get isIdentity(){return this.maxDiff(Matrix3d.identity)<n.Geometry.smallAngleRadians}get isDiagonal(){const e=this.sumSquares(),t=this.sumDiagonalSquares(),r=Math.abs(e-t);return Math.sqrt(r)<=n.Geometry.smallAngleRadians*(1+Math.sqrt(e))}get isUpperTriangular(){const e=this.sumSquares(),t=n.Geometry.hypotenuseSquaredXYZ(this.coffs[3],this.coffs[6],this.coffs[7]);return Math.sqrt(t)<=n.Geometry.smallAngleRadians*(1+Math.sqrt(e))}sameDiagonalScale(){const e=this.sumSquares(),t=this.sumDiagonalSquares(),r=Math.abs(e-t);if(Math.sqrt(r)<=n.Geometry.smallAngleRadians*(1+Math.sqrt(e))&&n.Geometry.isSameCoordinate(this.coffs[0],this.coffs[4])&&n.Geometry.isSameCoordinate(this.coffs[0],this.coffs[8]))return this.coffs[0]}sumSkewSquares(){return n.Geometry.hypotenuseSquaredXYZ(this.coffs[1]-this.coffs[3],this.coffs[2]-this.coffs[6],this.coffs[5]-this.coffs[7])}isRigid(e=!1){return this.testPerpendicularUnitRowsAndColumns()&&(e||this.determinant()>0)}factorRigidWithSignedScale(){const e=this.multiplyMatrixMatrixTranspose(this).sameDiagonalScale();if(void 0===e||e<=0)return;const t=this.determinant()>0?Math.sqrt(e):-Math.sqrt(e),r=1/t;return{rigidAxes:this.scaleColumns(r,r,r),scale:t}}get isSignedPermutation(){let e=0;for(let t=0;t<3;t++)for(let r=0;r<3;r++){const n=this.at(t,r);if(0===n);else{if(1!==n&&-1!==n)return!1;if(e++,0!==this.at(t+1,r))return!1;if(0!==this.at(t+2,r))return!1;if(0!==this.at(t,r+1))return!1;if(0!==this.at(t,r+2))return!1}}return 3===e}testPerpendicularUnitRowsAndColumns(){return this.multiplyMatrixMatrixTranspose(this).isIdentity}static createRigidFromColumns(e,t,r,n){const i=e.normalize();if(i){const o=i.unitCrossProduct(t);if(o){const t=o.unitCrossProduct(e);if(t){const e=Matrix3d.createShuffledColumns(i,t,o,r,n);return e.setupInverseTranspose(),e}}}}static createRigidFromMatrix3d(e,t=0,r){if((r=e.clone(r)).axisOrderCrossProductsInPlace(t),r.normalizeColumnsInPlace())return r}}Matrix3d.useCachedInverse=!0,Matrix3d.numUseCache=0,Matrix3d.numComputeCache=0,t.Matrix3d=Matrix3d},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),"undefined"===typeof WebGLRenderingContext&&(e.WebGLRenderingContext=new Proxy({},{get:()=>0})),function(e){let t,r,n,i,o,s,a,c,l,u,d,h,p,f,g,m,y,v;!function(e){e[e.Add=WebGLRenderingContext.FUNC_ADD]="Add",e[e.Subtract=WebGLRenderingContext.FUNC_SUBTRACT]="Subtract",e[e.ReverseSubtract=WebGLRenderingContext.FUNC_REVERSE_SUBTRACT]="ReverseSubtract",e[e.Default=e.Add]="Default"}(t=e.BlendEquation||(e.BlendEquation={})),function(e){e[e.Zero=WebGLRenderingContext.ZERO]="Zero",e[e.One=WebGLRenderingContext.ONE]="One",e[e.SrcColor=WebGLRenderingContext.SRC_COLOR]="SrcColor",e[e.OneMinusSrcColor=WebGLRenderingContext.ONE_MINUS_SRC_COLOR]="OneMinusSrcColor",e[e.DstColor=WebGLRenderingContext.DST_COLOR]="DstColor",e[e.OneMinusDstColor=WebGLRenderingContext.ONE_MINUS_DST_COLOR]="OneMinusDstColor",e[e.SrcAlpha=WebGLRenderingContext.SRC_ALPHA]="SrcAlpha",e[e.OneMinusSrcAlpha=WebGLRenderingContext.ONE_MINUS_SRC_ALPHA]="OneMinusSrcAlpha",e[e.DstAlpha=WebGLRenderingContext.DST_ALPHA]="DstAlpha",e[e.OneMinusDstAlpha=WebGLRenderingContext.ONE_MINUS_DST_ALPHA]="OneMinusDstAlpha",e[e.ConstColor=WebGLRenderingContext.CONSTANT_COLOR]="ConstColor",e[e.OneMinusConstColor=WebGLRenderingContext.ONE_MINUS_CONSTANT_COLOR]="OneMinusConstColor",e[e.ConstAlpha=WebGLRenderingContext.CONSTANT_ALPHA]="ConstAlpha",e[e.OneMinusConstAlpha=WebGLRenderingContext.ONE_MINUS_CONSTANT_ALPHA]="OneMinusConstAlpha",e[e.AlphaSaturate=WebGLRenderingContext.SRC_ALPHA_SATURATE]="AlphaSaturate",e[e.DefaultSrc=e.One]="DefaultSrc",e[e.DefaultDst=e.Zero]="DefaultDst"}(r=e.BlendFactor||(e.BlendFactor={})),function(e){let t,r,n,i;!function(e){e[e.ArrayBuffer=WebGLRenderingContext.ARRAY_BUFFER]="ArrayBuffer",e[e.ElementArrayBuffer=WebGLRenderingContext.ELEMENT_ARRAY_BUFFER]="ElementArrayBuffer"}(t=e.Target||(e.Target={})),function(e){e[e.ArrayBuffer=WebGLRenderingContext.ARRAY_BUFFER_BINDING]="ArrayBuffer",e[e.ElementArrayBuffer=WebGLRenderingContext.ELEMENT_ARRAY_BUFFER_BINDING]="ElementArrayBuffer"}(r=e.Binding||(e.Binding={})),function(e){e[e.Size=WebGLRenderingContext.BUFFER_SIZE]="Size",e[e.Usage=WebGLRenderingContext.BUFFER_USAGE]="Usage"}(n=e.Parameter||(e.Parameter={})),function(e){e[e.DynamicDraw=WebGLRenderingContext.DYNAMIC_DRAW]="DynamicDraw",e[e.StaticDraw=WebGLRenderingContext.STATIC_DRAW]="StaticDraw",e[e.StreamDraw=WebGLRenderingContext.STREAM_DRAW]="StreamDraw"}(i=e.Usage||(e.Usage={}))}(n=e.Buffer||(e.Buffer={})),function(e){e[e.Keep=WebGLRenderingContext.KEEP]="Keep",e[e.Zero=WebGLRenderingContext.ZERO]="Zero",e[e.Replace=WebGLRenderingContext.REPLACE]="Replace",e[e.Incr=WebGLRenderingContext.INCR]="Incr",e[e.IncrWrap=WebGLRenderingContext.INCR_WRAP]="IncrWrap",e[e.Decr=WebGLRenderingContext.DECR]="Decr",e[e.DecrWrap=WebGLRenderingContext.DECR_WRAP]="DecrWrap",e[e.Invert=WebGLRenderingContext.INVERT]="Invert",e[e.Default=e.Keep]="Default"}(i=e.StencilOperation||(e.StencilOperation={})),function(e){e[e.Never=WebGLRenderingContext.NEVER]="Never",e[e.Less=WebGLRenderingContext.LESS]="Less",e[e.LEqual=WebGLRenderingContext.LEQUAL]="LEqual",e[e.Greater=WebGLRenderingContext.GREATER]="Greater",e[e.GEqual=WebGLRenderingContext.GEQUAL]="GEqual",e[e.Equal=WebGLRenderingContext.EQUAL]="Equal",e[e.NotEqual=WebGLRenderingContext.NOTEQUAL]="NotEqual",e[e.Always=WebGLRenderingContext.ALWAYS]="Always",e[e.Default=e.Always]="Default"}(o=e.StencilFunction||(e.StencilFunction={})),function(e){e[e.Front=WebGLRenderingContext.FRONT]="Front",e[e.Back=WebGLRenderingContext.BACK]="Back",e[e.FrontAndBack=WebGLRenderingContext.FRONT_AND_BACK]="FrontAndBack",e[e.Default=e.Back]="Default"}(s=e.CullFace||(e.CullFace={})),function(e){e[e.Byte=WebGLRenderingContext.BYTE]="Byte",e[e.Short=WebGLRenderingContext.SHORT]="Short",e[e.UnsignedByte=WebGLRenderingContext.UNSIGNED_BYTE]="UnsignedByte",e[e.UnsignedShort=WebGLRenderingContext.UNSIGNED_SHORT]="UnsignedShort",e[e.UnsignedInt=WebGLRenderingContext.UNSIGNED_INT]="UnsignedInt",e[e.Float=WebGLRenderingContext.FLOAT]="Float"}(a=e.DataType||(e.DataType={})),function(e){e[e.CounterClockwise=WebGLRenderingContext.CCW]="CounterClockwise",e[e.Clockwise=WebGLRenderingContext.CW]="Clockwise",e[e.Default=e.CounterClockwise]="Default"}(c=e.FrontFace||(e.FrontFace={})),function(e){e[e.Never=WebGLRenderingContext.NEVER]="Never",e[e.Less=WebGLRenderingContext.LESS]="Less",e[e.Equal=WebGLRenderingContext.EQUAL]="Equal",e[e.LessOrEqual=WebGLRenderingContext.LEQUAL]="LessOrEqual",e[e.Greater=WebGLRenderingContext.GREATER]="Greater",e[e.NotEqual=WebGLRenderingContext.NOTEQUAL]="NotEqual",e[e.GreaterOrEqual=WebGLRenderingContext.GEQUAL]="GreaterOrEqual",e[e.Always=WebGLRenderingContext.ALWAYS]="Always",e[e.Default=e.Less]="Default"}(l=e.DepthFunc||(e.DepthFunc={})),function(e){e[e.Blend=WebGLRenderingContext.BLEND]="Blend",e[e.BlendColor=WebGLRenderingContext.BLEND_COLOR]="BlendColor",e[e.BlendEquationAlpha=WebGLRenderingContext.BLEND_EQUATION_ALPHA]="BlendEquationAlpha",e[e.BlendEquationRGB=WebGLRenderingContext.BLEND_EQUATION_RGB]="BlendEquationRGB",e[e.BlendSrcAlpha=WebGLRenderingContext.BLEND_SRC_ALPHA]="BlendSrcAlpha",e[e.BlendSrcRgb=WebGLRenderingContext.BLEND_SRC_RGB]="BlendSrcRgb",e[e.BlendDstAlpha=WebGLRenderingContext.BLEND_DST_ALPHA]="BlendDstAlpha",e[e.BlendDstRgb=WebGLRenderingContext.BLEND_DST_RGB]="BlendDstRgb",e[e.CullFace=WebGLRenderingContext.CULL_FACE]="CullFace",e[e.CullFaceMode=WebGLRenderingContext.CULL_FACE_MODE]="CullFaceMode",e[e.DepthFunc=WebGLRenderingContext.DEPTH_FUNC]="DepthFunc",e[e.DepthTest=WebGLRenderingContext.DEPTH_TEST]="DepthTest",e[e.DepthWriteMask=WebGLRenderingContext.DEPTH_WRITEMASK]="DepthWriteMask",e[e.FrontFace=WebGLRenderingContext.FRONT_FACE]="FrontFace",e[e.StencilFrontFunc=WebGLRenderingContext.STENCIL_FUNC]="StencilFrontFunc",e[e.StencilFrontRef=WebGLRenderingContext.STENCIL_REF]="StencilFrontRef",e[e.StencilFrontValueMask=WebGLRenderingContext.STENCIL_VALUE_MASK]="StencilFrontValueMask",e[e.StencilFrontWriteMask=WebGLRenderingContext.STENCIL_WRITEMASK]="StencilFrontWriteMask",e[e.StencilFrontOpFail=WebGLRenderingContext.STENCIL_FAIL]="StencilFrontOpFail",e[e.StencilFrontOpZFail=WebGLRenderingContext.STENCIL_PASS_DEPTH_FAIL]="StencilFrontOpZFail",e[e.StencilFrontOpZPass=WebGLRenderingContext.STENCIL_PASS_DEPTH_PASS]="StencilFrontOpZPass",e[e.StencilBackFunc=WebGLRenderingContext.STENCIL_BACK_FUNC]="StencilBackFunc",e[e.StencilBackRef=WebGLRenderingContext.STENCIL_BACK_REF]="StencilBackRef",e[e.StencilBackValueMask=WebGLRenderingContext.STENCIL_BACK_VALUE_MASK]="StencilBackValueMask",e[e.StencilBackWriteMask=WebGLRenderingContext.STENCIL_BACK_WRITEMASK]="StencilBackWriteMask",e[e.StencilBackOpFail=WebGLRenderingContext.STENCIL_BACK_FAIL]="StencilBackOpFail",e[e.StencilBackOpZFail=WebGLRenderingContext.STENCIL_BACK_PASS_DEPTH_FAIL]="StencilBackOpZFail",e[e.StencilBackOpZPass=WebGLRenderingContext.STENCIL_BACK_PASS_DEPTH_PASS]="StencilBackOpZPass",e[e.StencilTest=WebGLRenderingContext.STENCIL_TEST]="StencilTest",e[e.StencilWriteMask=WebGLRenderingContext.STENCIL_WRITEMASK]="StencilWriteMask"}(u=e.Capability||(e.Capability={})),function(e){let t,r,n,i;!function(e){e[e.TwoDee=WebGLRenderingContext.TEXTURE_2D]="TwoDee",e[e.CubeMap=WebGLRenderingContext.TEXTURE_CUBE_MAP]="CubeMap",e[e.CubeMapPositiveX=WebGLRenderingContext.TEXTURE_CUBE_MAP_POSITIVE_X]="CubeMapPositiveX",e[e.CubeMapNegativeX=WebGLRenderingContext.TEXTURE_CUBE_MAP_NEGATIVE_X]="CubeMapNegativeX",e[e.CubeMapPositiveY=WebGLRenderingContext.TEXTURE_CUBE_MAP_POSITIVE_Y]="CubeMapPositiveY",e[e.CubeMapNegativeY=WebGLRenderingContext.TEXTURE_CUBE_MAP_NEGATIVE_Y]="CubeMapNegativeY",e[e.CubeMapPositiveZ=WebGLRenderingContext.TEXTURE_CUBE_MAP_POSITIVE_Z]="CubeMapPositiveZ",e[e.CubeMapNegativeZ=WebGLRenderingContext.TEXTURE_CUBE_MAP_NEGATIVE_Z]="CubeMapNegativeZ"}(t=e.Target||(e.Target={})),function(e){e[e.Rgb=WebGLRenderingContext.RGB]="Rgb",e[e.Rgba=WebGLRenderingContext.RGBA]="Rgba",e[e.DepthStencil=WebGLRenderingContext.DEPTH_STENCIL]="DepthStencil",e[e.Luminance=WebGLRenderingContext.LUMINANCE]="Luminance",e[e.DepthComponent=WebGLRenderingContext.DEPTH_COMPONENT]="DepthComponent"}(r=e.Format||(e.Format={})),function(e){e[e.Float=WebGLRenderingContext.FLOAT]="Float",e[e.UnsignedByte=WebGLRenderingContext.UNSIGNED_BYTE]="UnsignedByte",e[e.UnsignedInt=WebGLRenderingContext.UNSIGNED_INT]="UnsignedInt"}(n=e.DataType||(e.DataType={})),function(e){e[e.Repeat=WebGLRenderingContext.REPEAT]="Repeat",e[e.MirroredRepeat=WebGLRenderingContext.MIRRORED_REPEAT]="MirroredRepeat",e[e.ClampToEdge=WebGLRenderingContext.CLAMP_TO_EDGE]="ClampToEdge"}(i=e.WrapMode||(e.WrapMode={}))}(d=e.Texture||(e.Texture={})),function(e){e[e.Fragment=WebGLRenderingContext.FRAGMENT_SHADER]="Fragment",e[e.Vertex=WebGLRenderingContext.VERTEX_SHADER]="Vertex"}(h=e.ShaderType||(e.ShaderType={})),function(e){e[e.CompileStatus=WebGLRenderingContext.COMPILE_STATUS]="CompileStatus"}(p=e.ShaderParameter||(e.ShaderParameter={})),function(e){e[e.LinkStatus=WebGLRenderingContext.LINK_STATUS]="LinkStatus"}(f=e.ProgramParameter||(e.ProgramParameter={})),function(e){e[e.Points=WebGLRenderingContext.POINTS]="Points",e[e.Lines=WebGLRenderingContext.LINES]="Lines",e[e.Triangles=WebGLRenderingContext.TRIANGLES]="Triangles"}(g=e.PrimitiveType||(e.PrimitiveType={})),function(e){let t;e.TARGET=WebGLRenderingContext.RENDERBUFFER,function(e){e[e.DepthComponent16=WebGLRenderingContext.DEPTH_COMPONENT16]="DepthComponent16"}(t=e.Format||(e.Format={}))}(m=e.RenderBuffer||(e.RenderBuffer={})),function(e){e.TARGET=WebGLRenderingContext.FRAMEBUFFER}(y=e.FrameBuffer||(e.FrameBuffer={})),function(e){e[e.Color=WebGLRenderingContext.COLOR_BUFFER_BIT]="Color",e[e.Depth=WebGLRenderingContext.DEPTH_BUFFER_BIT]="Depth",e[e.Stencil=WebGLRenderingContext.STENCIL_BUFFER_BIT]="Stencil"}(v=e.BufferBit||(e.BufferBit={})),e.POLYGON_OFFSET_FILL=WebGLRenderingContext.POLYGON_OFFSET_FILL}(t.GL||(t.GL={}))}).call(this,r(12))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(16);class XY{set(e=0,t=0){this.x=e,this.y=t}setZero(){this.x=0,this.y=0}constructor(e=0,t=0){this.x=e,this.y=t}setFrom(e){e?(this.x=e.x,this.y=e.y):(this.x=0,this.y=0)}isAlmostEqual(e,t){return n.Geometry.isSameCoordinate(this.x,e.x,t)&&n.Geometry.isSameCoordinate(this.y,e.y,t)}toJSON(){return[this.x,this.y]}toJSONXY(){return{x:this.x,y:this.y}}setFromJSON(e){Array.isArray(e)?this.set(e[0]||0,e[1]||0):e?this.set(e.x||0,e.y||0):this.set(0,0)}distance(e){const t=e.x-this.x,r=e.y-this.y;return Math.sqrt(t*t+r*r)}distanceSquared(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r}maxDiff(e){return Math.max(Math.abs(this.x-e.x),Math.abs(this.y-e.y))}get isAlmostZero(){return n.Geometry.isSmallMetricDistance(this.x)&&n.Geometry.isSmallMetricDistance(this.y)}maxAbs(){return Math.max(Math.abs(this.x),Math.abs(this.y))}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}magnitudeSquared(){return this.x*this.x+this.y*this.y}isExactEqual(e){return this.x===e.x&&this.y===e.y}isAlmostEqualMetric(e){return this.maxDiff(e)<=n.Geometry.smallMetricDistance}vectorTo(e,t){return Vector2d.create(e.x-this.x,e.y-this.y,t)}unitVectorTo(e,t){return this.vectorTo(e,t).normalize(t)}}t.XY=XY;class Point2d extends XY{constructor(e=0,t=0){super(e,t)}clone(){return new Point2d(this.x,this.y)}static create(e=0,t=0,r){return r?(r.x=e,r.y=t,r):new Point2d(e,t)}static fromJSON(e){const t=new Point2d;return t.setFromJSON(e),t}static createFrom(e,t){return e?Point2d.create(e.x,e.y,t):Point2d.create(0,0,t)}static createZero(e){return Point2d.create(0,0,e)}addForwardLeft(e,t,r){const n=r.x,i=r.y;return Point2d.create(this.x+e*n-t*i,this.y+e*i+t*n)}forwardLeftInterpolate(e,t,r){const n=r.x-this.x,i=r.y-this.y;return Point2d.create(this.x+e*n-t*i,this.y+e*i+t*n)}interpolate(e,t,r){if(e<=.5)return Point2d.create(this.x+e*(t.x-this.x),this.y+e*(t.y-this.y),r);const n=e-1;return Point2d.create(t.x+n*(t.x-this.x),t.y+n*(t.y-this.y),r)}interpolateXY(e,t,r,i){return Point2d.create(n.Geometry.interpolate(this.x,e,r.x),n.Geometry.interpolate(this.y,t,r.y),i)}minus(e,t){return Point2d.create(this.x-e.x,this.y-e.y,t)}plus(e,t){return Point2d.create(this.x+e.x,this.y+e.y,t)}plusXY(e=0,t=0,r){return Point2d.create(this.x+e,this.y+t,r)}plusScaled(e,t,r){return Point2d.create(this.x+e.x*t,this.y+e.y*t,r)}plus2Scaled(e,t,r,n,i){return Point2d.create(this.x+e.x*t+r.x*n,this.y+e.y*t+r.y*n,i)}plus3Scaled(e,t,r,n,i,o,s){return Point2d.create(this.x+e.x*t+r.x*n+i.x*o,this.y+e.y*t+r.y*n+i.y*o,s)}dotVectorsToTargets(e,t){return(e.x-this.x)*(t.x-this.x)+(e.y-this.y)*(t.y-this.y)}crossProductToPoints(e,t){const r=e.x-this.x,n=e.y-this.y,i=t.x-this.x;return r*(t.y-this.y)-n*i}fractionOfProjectionToLine(e,t,r){const i=e.distanceSquared(t);return i<n.Geometry.smallMetricDistanceSquared?r||0:e.dotVectorsToTargets(t,this)/i}}t.Point2d=Point2d;class Vector2d extends XY{constructor(e=0,t=0){super(e,t)}clone(){return new Vector2d(this.x,this.y)}static create(e=0,t=0,r){return r?(r.x=e,r.y=t,r):new Vector2d(e,t)}static unitX(e=1){return new Vector2d(e,0)}static unitY(e=1){return new Vector2d(0,e)}static createZero(e){return Vector2d.create(0,0,e)}static createFrom(e,t){return e instanceof Float64Array?e.length>=2?Vector2d.create(e[0],e[1]):e.length>=1?Vector2d.create(e[0],0):Vector2d.create(0,0):Vector2d.create(e.x,e.y,t)}static fromJSON(e){const t=new Vector2d;return t.setFromJSON(e),t}static createPolar(e,t){return Vector2d.create(e*t.cos())}static createStartEnd(e,t,r){return r?(r.set(t.x-e.x,t.y-e.y),r):new Vector2d(t.x-e.x,t.y-e.y)}static createOffsetBisector(e,t,r){let n=e.plus(t);if(n=n.normalize()){const t=r*n.dotProduct(e);return n.safeDivideOrNull(t)}}safeDivideOrNull(e,t){if(0!==e)return this.scale(1/e,t)}normalize(e){const t=n.Geometry.correctSmallMetricDistance(this.magnitude());return e=e||new Vector2d,this.safeDivideOrNull(t,e)}fractionOfProjectionToVector(e,t){const r=this.dotProduct(e),i=e.magnitudeSquared();return i<n.Geometry.smallMetricDistanceSquared?t||0:r/i}negate(e){return(e=e||new Vector2d).x=-this.x,e.y=-this.y,e}rotate90CCWXY(e){e=e||new Vector2d;const t=this.x,r=this.y;return e.x=-r,e.y=t,e}rotate90CWXY(e){e=e||new Vector2d;const t=this.x,r=this.y;return e.x=r,e.y=-t,e}unitPerpendicularXY(e){e=e||new Vector2d;const t=this.x,r=this.y;e.x=-r,e.y=t;const n=t*t+r*r;if(0!==n){const t=1/Math.sqrt(n);e.x*=t,e.y*=t}return e}rotateXY(e,t){const r=e.sin(),n=e.cos(),i=this.x,o=this.y;return(t=t||new Vector2d).x=i*n-o*r,t.y=i*r+o*n,t}interpolate(e,t,r){if(r=r||new Vector2d,e<=.5)r.x=this.x+e*(t.x-this.x),r.y=this.y+e*(t.y-this.y);else{const n=e-1;r.x=t.x+n*(t.x-this.x),r.y=t.y+n*(t.y-this.y)}return r}plus(e,t){return(t=t||new Vector2d).x=this.x+e.x,t.y=this.y+e.y,t}minus(e,t){return(t=t||new Vector2d).x=this.x-e.x,t.y=this.y-e.y,t}plusScaled(e,t,r){return(r=r||new Vector2d).x=this.x+e.x*t,r.y=this.y+e.y*t,r}plus2Scaled(e,t,r,n,i){return(i=i||new Vector2d).x=this.x+e.x*t+r.x*n,i.y=this.y+e.y*t+r.y*n,i}plus3Scaled(e,t,r,n,i,o,s){return(s=s||new Vector2d).x=this.x+e.x*t+r.x*n+i.x*o,s.y=this.y+e.y*t+r.y*n+i.y*o,s}scale(e,t){return(t=t||new Vector2d).x=this.x*e,t.y=this.y*e,t}scaleToLength(e,t){const r=n.Geometry.correctSmallMetricDistance(this.magnitude());return 0===r?new Vector2d:this.scale(e/r,t)}dotProduct(e){return this.x*e.x+this.y*e.y}dotProductStartEnd(e,t){return this.x*(t.x-e.x)+this.y*(t.y-e.y)}crossProduct(e){return this.x*e.y-this.y*e.x}angleTo(e){return i.Angle.createAtan2(this.crossProduct(e),this.dotProduct(e))}isParallelTo(e,t=!1){const r=this.magnitudeSquared(),i=e.magnitudeSquared();if(r<n.Geometry.smallMetricDistanceSquared||i<n.Geometry.smallMetricDistanceSquared)return!1;if(this.dotProduct(e)<0&&!t)return!1;const o=this.crossProduct(e);return o*o<=n.Geometry.smallAngleRadiansSquared*r*i}isPerpendicularTo(e){return i.Angle.isPerpendicularDotSet(this.magnitudeSquared(),e.magnitudeSquared(),this.dotProduct(e))}}t.Vector2d=Vector2d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(16),o=r(6),s=r(9),a=r(10),c=r(21),l=r(22),u=r(37),d=r(38),h=r(49),p=r(49),f=r(51);class MoveByDistanceContext{constructor(e,t,r){this.point0=e,this.distance0=0,this.targetDistance=Math.abs(r),this.fraction0=t}distanceStatus(){return n.Geometry.isSameCoordinate(this.distance0,this.targetDistance)?h.CurveSearchStatus.success:h.CurveSearchStatus.stoppedAtBoundary}announcePoint(e,t){const r=this.point0.distance(e),i=this.distance0+r;if(i<this.targetDistance&&!n.Geometry.isSameCoordinate(i,this.targetDistance))return this.point0.setFromPoint3d(e),this.distance0=i,this.fraction0=t,!1;const o=this.targetDistance-this.distance0,s=n.Geometry.safeDivideFraction(o,r,0);return this.point0.interpolate(s,e,this.point0),this.fraction0=n.Geometry.interpolate(this.fraction0,s,t),this.distance0=this.targetDistance,!0}announceExtrapolation(e,t,r,i,o){const s=this.targetDistance-this.distance0,a=e.distance(t,r),c=n.Geometry.conditionalDivideFraction(s,a);return void 0!==c&&(e.interpolate(r,-c,t,this.point0),this.distance0=this.targetDistance,this.fraction0=n.Geometry.interpolate(o,-c,i),!0)}}function g(e,t,r,n,i,o,s){const a=e.length;if(n>0){for(let c=r;c+1<a;c++)if(e.vectorIndexIndex(c,c+1,s),t.crossProduct(s,s),s.normalizeInPlace())return o.addScaledInPlace(s,i),!0}else{r+1>=a&&(r=a-2);for(let n=r;n>=0;n--)if(e.vectorIndexIndex(n,n+1,s),s.crossProduct(t,s),s.normalizeInPlace())return o.addScaledInPlace(s,i),!0}return!1}class LineString3d extends d.CurvePrimitive{constructor(){super(),this._points=new u.GrowableXYZArray}isSameGeometryClass(e){return e instanceof LineString3d}get isExtensibleFractionSpace(){return!0}get points(){return this._points.getPoint3dArray()}get packedPoints(){return this._points}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}static flattenArray(e){return e.reduce((e,t)=>e.concat(Array.isArray(t)?LineString3d.flattenArray(t):t),[])}static create(...e){const t=new LineString3d;return t.addPoints(e),t}static createXY(e,t,r=!1){const i=new LineString3d,o=i._points;for(const n of e)o.pushXYZ(n.x,n.y,t);if(r&&e.length>1){const e=o.distance(0,o.length-1);if(0!==e&&n.Geometry.isSameCoordinate(0,e)){o.pop();const e=o.front();o.push(e)}}return i.addPoints(e),i}addPoints(...e){const t=LineString3d.flattenArray(e);for(const r of t)r instanceof o.Point3d&&this._points.push(r)}addPoint(e){this._points.push(e)}addPointXYZ(e,t,r=0){this._points.pushXYZ(e,t,r)}addClosurePoint(){const e=this._points.length;e>1&&(n.Geometry.isSameCoordinate(0,this._points.distance(0,e-1))||this._points.pushWrap(1))}popPoint(){this._points.pop()}static createRectangleXY(e,t,r,n=!0){const i=LineString3d.create(),o=e.x,s=e.x+t,a=e.y,c=e.y+r,l=e.z;return i.addPointXYZ(o,a,l),i.addPointXYZ(s,a,l),i.addPointXYZ(s,c,l),i.addPointXYZ(o,c,l),n&&i.addClosurePoint(),i}static createRegularPolygonXY(e,t,r,n=!0){t<3&&(t=3);const o=LineString3d.create(),s=n?0:-1,a=Math.PI/t;let c,l,u;n||(r/=Math.cos(a));for(let d=0;d<t;d++)u=(s+2*d)*a,c=i.Angle.cleanupTrigValue(Math.cos(u)),l=i.Angle.cleanupTrigValue(Math.sin(u)),o.addPointXYZ(e.x+r*c,e.y+r*l,e.z);return o.addClosurePoint(),o}setFrom(e){this._points.clear();let t=0;for(;e._points.isIndexValid(t);)this._points.push(e._points.getPoint3dAt(t)),t++}static createPoints(e){const t=new LineString3d;let r;for(r of e)t._points.push(r);return t}static createFloat64Array(e){const t=new LineString3d;for(let r=0;r+3<=e.length;r+=3)t._points.push(o.Point3d.create(e[r],e[r+1],e[r+2]));return t}clone(){const e=new LineString3d;return e.setFrom(this),e}setFromJSON(e){if(this._points.clear(),Array.isArray(e)){let t;for(t of e)this._points.push(o.Point3d.fromJSON(t))}}toJSON(){const e=[];let t=0;for(;this._points.isIndexValid(t);)e.push(this._points.getPoint3dAt(t).toJSON()),t++;return e}static fromJSON(e){const t=new LineString3d;return t.setFromJSON(e),t}fractionToPoint(e,t){const r=this._points.length;if(0===r)return o.Point3d.createZero();if(1===r)return o.Point3d.createFrom(this._points.getPoint3dAt(0),t);const n=1/(r-1);if(e<=n)return this._points.interpolate(0,e/n,1,t);if(e+n>=1)return this._points.interpolate(r-1,(1-e)/n,r-2,t);const i=Math.floor(e/n);return this._points.interpolate(i,(e-i*n)/n,i+1,t)}fractionToPointAndDerivative(e,t){t=t||c.Ray3d.createZero();const r=this._points.length;if(r<=1)return t.direction.setZero(),1===r?t.origin.setFrom(this._points.getPoint3dAt(0)):t.origin.setZero(),t;const n=1/(r-1);if(e<=n)return t=t||c.Ray3d.createZero(),this._points.interpolate(0,e/n,1,t.origin),this._points.vectorIndexIndex(0,1,t.direction),t.direction.scaleInPlace(1/n),t;if(e+n>=1)return t=t||c.Ray3d.createZero(),this._points.interpolate(r-2,1-(1-e)/n,r-1,t.origin),this._points.vectorIndexIndex(r-2,r-1,t.direction),t.direction.scaleInPlace(1/n),t;t=t||c.Ray3d.createZero();const i=Math.floor(e/n),o=(e-i*n)/n;return this._points.interpolate(i,o,i+1,t.origin),this._points.vectorIndexIndex(i,i+1,t.direction),t.direction.scaleInPlace(1/n),t}fractionToPointAnd2Derivatives(e,t){const r=this.fractionToPointAndDerivative(e);return t=l.Plane3dByOriginAndVectors.createCapture(r.origin,r.direction,o.Vector3d.createZero(),t)}segmentIndexAndLocalFractionToGlobalFraction(e,t){const r=this._points.length-1;return r<1?0:(e+t)/r}fractionToFrenetFrame(e,t){const r=this._points.length;if(r<=1)return 1===r?s.Transform.createTranslation(this._points.getPoint3dAt(0),t):s.Transform.createIdentity(t);if(2===r)return s.Transform.createRefs(this._points.interpolate(0,e,1),a.Matrix3d.createRigidHeadsUp(this._points.vectorIndexIndex(0,1),0));const n=r-1,i=1/n;let c=0,l=0;e<=i?(l=e/i,c=0):e+i>=1?(c=r-2,l=1-(1-e)/i):l=e*n-(c=Math.floor(e/i));const u=this._points.interpolate(c,l,c+1),d=this._points.vectorIndexIndex(c,c+1),h=o.Vector3d.create(),p=o.Vector3d.create();0===c?g(this._points,d,c+1,1,1,h,p):c+2>=r?g(this._points,d,c-1,-1,1,h,p):(g(this._points,d,c-1,-1,1-l,h,p),g(this._points,d,c+1,1,l,h,p));const f=a.Matrix3d.createRigidFromColumns(h,d,2);return f?s.Transform.createOriginAndMatrix(u,f,t):s.Transform.createTranslation(u,t)}startPoint(){return 0===this._points.length?o.Point3d.createZero():this._points.getPoint3dAt(0)}pointAt(e,t){if(this._points.isIndexValid(e))return this._points.getPoint3dAt(e,t)}vectorBetween(e,t,r){return this._points.getVector3dBetweenIndices(e,t,r)}numPoints(){return this._points.length}endPoint(){return 0===this._points.length?o.Point3d.createZero():this._points.getPoint3dAt(this._points.length-1)}reverseInPlace(){if(this._points.length>=2){let e=0,t=this._points.length-1,r=this._points.getPoint3dAt(0);for(;e<t;)r=this._points.getPoint3dAt(e),this._points.setAt(e,this._points.getPoint3dAt(t)),this._points.setAt(t,r),e++,t--}}tryTransformInPlace(e){return this._points.transformInPlace(e),!0}curveLength(){return this._points.sumLengths()}curveLengthBetweenFractions(e,t){const r=this._points.length-1;if(t===e||r<1)return 0;if(t<e)return this.curveLengthBetweenFractions(t,e);const n=e*r,i=t*r,o=Math.max(1,Math.ceil(n)),s=Math.min(Math.floor(i),r-1),a=o-n,c=i-s;if(o>s)return Math.abs(i-n)*this._points.distance(o-1,o);{let e=a*this._points.distance(o-1,o)+c*this._points.distance(s,s+1);for(let t=o;t<s;t++)e+=this._points.distance(t,t+1);return e}}moveSignedDistanceFromFraction(e,t,r,i){const o=this._points.length-1,s=e*o;let a=n.Geometry.restrictToInterval(Math.floor(s),0,o-1);const c=s-a,l=this._points.interpolate(a,c,a+1,LineString3d._workPointA),u=LineString3d._workPointB,d=new MoveByDistanceContext(l,e,t);if(t>0){for(;a<=o;)if(a++,this._points.atPoint3dIndex(a,u),d.announcePoint(u,a/o))return h.CurveLocationDetail.createCurveFractionPointDistanceCurveSearchStatus(this,d.fraction0,d.point0,t,h.CurveSearchStatus.success,i);return r&&d.announceExtrapolation(this._points,o-1,o,(o-1)/o,1),h.CurveLocationDetail.createCurveFractionPointDistanceCurveSearchStatus(this,d.fraction0,d.point0,t,d.distanceStatus(),i)}for(c<=0&&a--;a>=0;a--)if(this._points.atPoint3dIndex(a,u),d.announcePoint(u,a/o))return h.CurveLocationDetail.createCurveFractionPointDistanceCurveSearchStatus(this,d.fraction0,d.point0,t,h.CurveSearchStatus.success,i);return r&&d.announceExtrapolation(this._points,1,0,1/o,0),h.CurveLocationDetail.createCurveFractionPointDistanceCurveSearchStatus(this,d.fraction0,d.point0,-d.distance0,d.distanceStatus(),i)}quickLength(){return this.curveLength()}closestPoint(e,t,r){r=h.CurveLocationDetail.create(this,r);const n=this._points.length;if(n>0){const i=n-1;if(r.setFP(1,this._points.getPoint3dAt(i),void 0),r.setDistanceTo(e),n>1){let o=0,s=0;const a=1/i;for(let c=1;c<n;c++)(o=e.fractionOfProjectionToLine(this._points.getPoint3dAt(c-1),this._points.getPoint3dAt(c)))<0?(!t||c>1)&&(o=0):o>1&&(!t||c<i)&&(o=1),this._points.getPoint3dAt(c-1).interpolate(o,this._points.getPoint3dAt(c),r.pointQ),(s=r.pointQ.distance(e))<r.a&&r.setFP((c-1+o)*a,r.pointQ,void 0,s)}}return r}isInPlane(e){return this._points.isCloseToPlane(e,n.Geometry.smallMetricDistance)}static pushVertexHit(e,t,r,n,i){const o=h.CurveLocationDetail.createCurveFractionPoint(r,n,i);e.push(o),0===t?o.setIntervalRole(p.CurveIntervalRole.isolatedAtVertex):1===t?(e[e.length-2].setIntervalRole(p.CurveIntervalRole.intervalStart),o.setIntervalRole(p.CurveIntervalRole.intervalEnd)):(e[e.length-2].setIntervalRole(p.CurveIntervalRole.intervalInterior),o.setIntervalRole(p.CurveIntervalRole.intervalEnd))}appendPlaneIntersectionPoints(e,t){if(this._points.length<1)return 0;const r=t.length,i=this._points.length,o=1===i?1:i-1,s=LineString3d._workPointA,a=LineString3d._workPointB,c=LineString3d._workPointC;this._points.getPoint3dAt(0,s);let l=0,u=0,d=0,f=0;for(let g=0;g<this._points.length;g++,s.setFrom(a),d=l)if(this._points.getPoint3dAt(g,a),0===(l=n.Geometry.correctSmallMetricDistance(e.altitude(a))))LineString3d.pushVertexHit(t,u++,this,g/o,a);else if(d*l<0){f=d/(d-l),s.interpolate(f,a,c);const e=h.CurveLocationDetail.createCurveFractionPoint(this,(g-1+f)/o,c);e.setIntervalRole(p.CurveIntervalRole.isolated),t.push(e),u=0}return t.length-r}extendRange(e,t){this._points.extendRange(e,t)}isAlmostEqual(e){return e instanceof LineString3d&&!!u.GrowableXYZArray.isAlmostEqual(this._points,e._points)}appendStrokePoint(e){const t=this._points.length;0!==t&&e.isAlmostEqual(this._points.getPoint3dAt(t-1))||this._points.push(e)}clear(){this._points.clear()}appendFractionalStrokePoints(e,t,r=0,n=1,i){if(i&&this.appendStrokePoint(e.fractionToPoint(r)),t>1){const i=(n-r)/t;for(let n=1;n<t;n++)this.appendStrokePoint(e.fractionToPoint(r+n*i))}i&&this.appendStrokePoint(e.fractionToPoint(n))}appendInterpolatedStrokePoints(e,t,r,n){if(n&&this.appendStrokePoint(t),e>1){const n=1/e;for(let i=1;i<e;i++)this.appendStrokePoint(t.interpolate(i*n,r))}n&&this.appendStrokePoint(r)}emitStrokes(e,t){const r=this._points.length,n=LineString3d._workPointA,i=LineString3d._workPointB;if(r>0)if(t&&t.hasMaxEdgeLength){e.appendStrokePoint(this._points.getPoint3dAt(0));for(let o=1;o<r;o++){this._points.getPoint3dAt(o-1,n),this._points.getPoint3dAt(o,i);const r=t.applyMaxEdgeLength(1,n.distance(i));r>1&&e.appendInterpolatedStrokePoints(r,n,i,!1),e.appendStrokePoint(i)}}else for(let o=0;o<r;o++)e.appendStrokePoint(this._points.getPoint3dAt(o))}emitStrokableParts(e,t){const r=this._points.length;if(e.startCurvePrimitive(this),r>1){const n=1/(r-1);if(t&&t.hasMaxEdgeLength)for(let i=1;i<r;i++){const r=t.applyMaxEdgeLength(1,this._points.getPoint3dAt(i-1).distance(this._points.getPoint3dAt(i)));e.announceSegmentInterval(this,this._points.getPoint3dAt(i-1),this._points.getPoint3dAt(i),r,(i-1)*n,i*n)}else for(let t=1;t<r;t++)e.announceSegmentInterval(this,this._points.getPoint3dAt(t-1),this._points.getPoint3dAt(t),1,(t-1)*n,t*n)}e.endCurvePrimitive(this)}dispatchToGeometryHandler(e){return e.handleLineString3d(this)}announceClipIntervals(e,t){const r=this._points.length;if(r<2)return!1;let i=0,o=1;const s=(e,r)=>{t&&t(n.Geometry.interpolate(i,e,o),n.Geometry.interpolate(i,r,o),this)},a=LineString3d._workPointA,c=LineString3d._workPointB;this._points.getPoint3dAt(0,a);let l=!1;for(let n=1;n<r;n++,a.setFrom(c),i=o)this._points.getPoint3dAt(n,c),o=n/(r-1),e.announceClippedSegmentIntervals(0,1,a,c,s)&&(l=!0);return l}addResolvedPoint(e,t,r){const n=this._points.length;if(0!==n){if(1===n)return this._points.getPoint3dAt(0,LineString3d._indexPoint),void r.push(LineString3d._indexPoint);e<0&&(e=0),e>=n&&(e=n-1,t+=1),this._points.interpolate(e,t,e+1,LineString3d._indexPoint),r.push(LineString3d._indexPoint)}}clonePartialCurve(e,t){if(t<e){const r=this.clonePartialCurve(t,e);return r&&r.reverseInPlace(),r}const r=this._points.length,i=r-1;if(r<2||e>=1||t<=0)return;e<0&&(e=0),t>1&&(t=1);const o=e*i,s=t*i,a=Math.floor(o),c=Math.floor(s),l=o-a,u=s-c,d=LineString3d.create();this.addResolvedPoint(a,l,d._points);for(let n=a+1;n<=c;n++)this._points.getPoint3dAt(n,LineString3d._workPointA),d._points.push(LineString3d._workPointA);return n.Geometry.isSmallRelative(u)||this.addResolvedPoint(c,u,d._points),d}getIndexedSegment(e){if(e>=0&&e+1<this._points.length)return f.LineSegment3d.create(this._points.atPoint3dIndex(e),this._points.atPoint3dIndex(e+1))}}LineString3d._workPointA=o.Point3d.create(),LineString3d._workPointB=o.Point3d.create(),LineString3d._workPointC=o.Point3d.create(),LineString3d._indexPoint=o.Point3d.create(),t.LineString3d=LineString3d;t.AnnotatedLineString3d=class AnnotatedLineString3d{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);var i=r(0);t.BentleyStatus=i.BentleyStatus,t.BentleyError=i.BentleyError,t.IModelStatus=i.IModelStatus,t.BriefcaseStatus=i.BriefcaseStatus,t.DbResult=i.DbResult,t.RepositoryStatus=i.RepositoryStatus,t.ChangeSetStatus=i.ChangeSetStatus,t.RpcInterfaceStatus=i.RpcInterfaceStatus;class IModelError extends n.BentleyError{constructor(e,t,r,n,i){super(e,t,r,n,i)}}t.IModelError=IModelError;t.ServerError=class ServerError extends IModelError{constructor(e,t,r){super(e,t,r),this.name="Server error ("+e+")"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5);class Angle{constructor(e=0,t){this._radians=e,this._degrees=t}clone(){return new Angle(this._radians,this._degrees)}static createDegrees(e){return new Angle(Angle.degreesToRadians(e),e)}static createRadians(e){return new Angle(e)}setRadians(e){this._radians=e,this._degrees=void 0}setDegrees(e){this._radians=Angle.degreesToRadians(e),this._degrees=e}static create360(){return new Angle(2*Math.PI,360)}static createAtan2(e,t){return new Angle(Math.atan2(e,t))}setFrom(e){this._radians=e._radians,this._degrees=e._degrees}static fromJSON(e,t){const r=new Angle;return r.setFromJSON(e,t),r}setFromJSON(e,t){this._radians=t||0,e&&("number"===typeof e?this.setDegrees(e):"number"===typeof e.degrees?this.setDegrees(e.degrees):"number"===typeof e._degrees?this.setDegrees(e._degrees):"number"===typeof e.radians?this.setRadians(e.radians):"number"===typeof e._radians&&this.setRadians(e._radians))}toJSON(){return this.degrees}toJSONRadians(){return{radians:this.radians}}get radians(){return this._radians}get degrees(){return void 0!==this._degrees?this._degrees:Angle.radiansToDegrees(this._radians)}static degreesToRadians(e){return e*Math.PI/180}static radiansToDegrees(e){if(e<0)return-Angle.radiansToDegrees(-e);const t=Math.PI;return e<=.25*t?180/t*e:e<.75*t?90+(e-.5*t)/t*180:e<=1.25*t?180+(e-t)/t*180:e<=1.75*t?270+(e-1.5*t)/t*180:360+(e-2*t)/t*180}cos(){return Math.cos(this._radians)}sin(){return Math.sin(this._radians)}tan(){return Math.tan(this._radians)}static isFullCircleRadians(e){return Math.abs(e)>=n.Geometry.fullCircleRadiansMinusSmallAngle}get isFullCircle(){return Angle.isFullCircleRadians(this._radians)}static adjustDegrees0To360(e){if(e>=0){const t=360;return e<t?e:e-Math.floor(e/t)*t}return 360-Angle.adjustDegrees0To360(-e)}static adjustDegreesSigned180(e){if(Math.abs(e)<=180)return e;if(e>=0){const t=360;return e-(1+Math.floor((e-180)/t))*t}return-Angle.adjustDegreesSigned180(-e)}static adjustRadians0To2Pi(e){if(e>=0){const t=2*Math.PI;return e<t?e:e-Math.floor(e/t)*t}const t=Angle.adjustRadians0To2Pi(-e);return 2*Math.PI-t}static adjustRadiansMinusPiPlusPi(e){if(Math.abs(e)<=Math.PI)return e;if(e>=0){const t=2*Math.PI;return e-(1+Math.floor((e-Math.PI)/t))*t}return-Angle.adjustRadiansMinusPiPlusPi(-e)}static zero(){return new Angle(0)}get isExactZero(){return 0===this.radians}get isAlmostZero(){return Math.abs(this.radians)<n.Geometry.smallAngleRadians}static createDegreesAdjustPositive(e){return Angle.createDegrees(Angle.adjustDegrees0To360(e))}static createDegreesAdjustSigned180(e){return Angle.createDegrees(Angle.adjustDegreesSigned180(e))}static isAlmostEqualRadiansAllowPeriodShift(e,t){const r=Math.abs(e-t);if(r<=n.Geometry.smallAngleRadians)return!0;const i=2*Math.PI;if(Math.abs(r-i)<=n.Geometry.smallAngleRadians)return!0;const o=r-Math.round(r/i)*i;return Math.abs(o)<=n.Geometry.smallAngleRadians}isAlmostEqualAllowPeriodShift(e){return Angle.isAlmostEqualRadiansAllowPeriodShift(this._radians,e._radians)}isAlmostEqualNoPeriodShift(e){return Math.abs(this._radians-e._radians)<n.Geometry.smallAngleRadians}isAlmostEqual(e){return this.isAlmostEqualNoPeriodShift(e)}static isAlmostEqualRadiansNoPeriodShift(e,t){return Math.abs(e-t)<n.Geometry.smallAngleRadians}static isPerpendicularDotSet(e,t,r){return e>n.Geometry.smallMetricDistanceSquared&&t>n.Geometry.smallMetricDistanceSquared&&r*r<=n.Geometry.smallAngleRadiansSquared*e*t}static trigValuesToHalfAngleTrigValues(e,t){const r=n.Geometry.hypotenuseXY(e,t);if(r<n.Geometry.smallMetricDistance)return{c:1,s:0,radians:0};{let n=1,i=0;const o=e/r,s=t/r;return o>=0?i=s/(2*(n=Math.sqrt(.5*(1+o)))):n=s/(2*(i=s>0?Math.sqrt(.5*(1-o)):-Math.sqrt(.5*(1-o)))),{c:n,s:i,radians:Math.atan2(i,n)}}}static cleanupTrigValue(e,t=1e-15){const r=Math.abs(e);if(r<=t)return 0;let n=Math.abs(r-.5);return n<=t?e<0?-.5:.5:(n=Math.abs(r-1))<=t?e<0?-1:1:e}static dotProductsToHalfAngleTrigValues(e,t,r,i=!0){const o=e-t,s=2*r;return i&&Math.abs(s)<n.Geometry.smallAngleRadians*(Math.abs(e)+Math.abs(t))?{c:1,s:0,radians:0}:Angle.trigValuesToHalfAngleTrigValues(o,s)}static radiansBetweenVectorsXYZ(e,t,r,i,o,s){const a=e*i+t*o+r*s;return Math.atan2(n.Geometry.crossProductMagnitude(e,t,r,i,o,s),a)}}Angle.piOver4Radians=.7853981633974483,Angle.piOver2Radians=1.5707963267948966,Angle.piRadians=3.141592653589793,Angle.pi2Radians=6.283185307179586,Angle.degreesPerRadian=45/Angle.piOver4Radians,Angle.radiansPerDegree=Angle.piOver4Radians/45,Angle.piOver12Radians=.26179938779914946,t.Angle=Angle},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),o="ECJson",s="className";class PropertyEntry{constructor(e,t){this.typedPropertyName=e,this.propertyAccessString=t}}class ApplicationEntry{constructor(e){this.applicationKey=e,this.propertiesByAccessString=new Map}getPropertyByAccessString(e){return this.propertiesByAccessString.get(e)}addProperty(e,t){let r=this.getPropertyByAccessString(t);if(r){const e=`The ECProperty ${t} has already been mapped to another TypeScript property ${r.typedPropertyName}`;throw new Error(e)}r=new PropertyEntry(e,t),this.propertiesByAccessString.set(t,r)}}class ClassEntry{constructor(e){this.baseClassEntries=new Array,this.applicationsByKey=new Map,this.typedConstructor=e}getApplicationByKey(e){return this.applicationsByKey.get(e)}addApplication(e){let t=this.getApplicationByKey(e);if(t)throw new Error("Internal error: Cannot add the same application twice");return t=new ApplicationEntry(e),this.applicationsByKey.set(e,t),t}}class ECJsonTypeMap{static getClassByType(e){return ECJsonTypeMap._classesByTypedName.get(e)}static gatherBaseClassEntries(e,t){const r=Object.getPrototypeOf(t.typedConstructor.prototype).constructor,n=ECJsonTypeMap.getClassByType(r);n&&(e.push(n),this.gatherBaseClassEntries(e,n))}static addClassPlaceholder(e){const t=new ClassEntry(e);return ECJsonTypeMap._classesByTypedName.set(e,t),ECJsonTypeMap.gatherBaseClassEntries(t.baseClassEntries,t),t}static addClass(e,t,r,n){if(!(n.classKeyPropertyName||n.schemaPropertyName&&n.classPropertyName))throw new Error("Either classKeyPropertyName or schemaPropertyName+classPropertyName have to be supplied to identify how the class information is persisted in JSON");let i=ECJsonTypeMap.getClassByType(e);i||(i=this.addClassPlaceholder(e));let o=i.getApplicationByKey(t);if(o){if(o.classKey===r){const n=`Duplicate classKeys ${r} found on TypeScript class ${e.name} for application ${t}`;throw new Error(n)}}else o=i.addApplication(t);return o.classKey=r,o.classKeyMapInfo=n,i}static addProperty(e,t,r,n){let i=ECJsonTypeMap.getClassByType(t);i||(i=ECJsonTypeMap.addClassPlaceholder(t));let o=i.getApplicationByKey(r);o||(o=i.addApplication(r)),o.addProperty(e,n)}static fromJson(e,t,r){const n=ECJsonTypeMap.getClassByType(e);if(!n)return void i.Logger.logError(o,`Type ${e.name} is not mapped to an ECClass. Supply the appropriate class decorator`);const a=t.toLowerCase(),c=n.getApplicationByKey(a);if(!c)return void i.Logger.logError(o,`Type ${e.name} is not mapped for the supplied application.`);let l;if(c.classKeyMapInfo.classKeyPropertyName)l=r[c.classKeyMapInfo.classKeyPropertyName];else{if(!c.classKeyMapInfo.schemaPropertyName||!c.classKeyMapInfo.classPropertyName)return;l=r[c.classKeyMapInfo.schemaPropertyName]+"."+r[c.classKeyMapInfo.classPropertyName]}if(c.classKey!==l)return void i.Logger.logError(o,`The ClassKey ${c.classKey} was specified to map with ${e.name}, but does not match that specified in the JSON: ${l} `);let u=Array(n);u=u.concat(n.baseClassEntries);const d=new e;return u.forEach(e=>{const t=e.getApplicationByKey(a);t&&t.propertiesByAccessString.forEach((e,t)=>{let n=r;const i=t.split(".");for(let r=0;r<i.length;r++){const e=i[r].match(/[^\[\]]+/g);if(!e||0===e.length||e.length>2)return;const t=e[0];if("undefined"===typeof(n=n[t]))return;if(2===e.length&&"relationshipInstances"===t&&r<i.length-1){const t=i[r+1].match(/[^\[\]]+/g);if(!t||2!==t.length)return;const o=e[1],a=t[0],c=t[1];let l,u,d=0;for(;c!==u;){if("undefined"===typeof(l=n[d++]))return;if(o===l[s]){const e=l[a];"undefined"!==e&&(u=e[s])}}n=l[a],r++}}d[e.typedPropertyName]=n})}),d}static toJson(e,t){const r=e.toLowerCase(),n=Object.getPrototypeOf(t).constructor,i=ECJsonTypeMap.getClassByType(n);if(!i)return;const o=i.getApplicationByKey(r);if(!o)return;const a={};if(o.classKeyMapInfo.classKeyPropertyName)a[o.classKeyMapInfo.classKeyPropertyName]=o.classKey;else{if(!o.classKeyMapInfo.schemaPropertyName||!o.classKeyMapInfo.classPropertyName)return;{const e=o.classKey.split(".",2);a[o.classKeyMapInfo.schemaPropertyName]=e[0],a[o.classKeyMapInfo.classPropertyName]=e[1]}}let c=Array(i);return(c=c.concat(i.baseClassEntries)).forEach(e=>{const n=e.getApplicationByKey(r);n&&n.propertiesByAccessString.forEach((e,r)=>{const n=t[e.typedPropertyName];if("undefined"===typeof n)return;const i=r.split(".");let o=a;i.forEach((e,t)=>{const r=e.match(/[^\[\]]+/g);if(!r||0===r.length||r.length>2)return;const a=r[0],c=t>=i.length-1;if(2!==r.length){if(void 0===o[a]){let e={};c&&(e=n),o[a]=e}return void(o=o[a])}const l=r[1];if("relationshipInstances"===a){o[a]||(o[a]=[]);const e=/\[.*\]/.test(i[t+1]),r=i[t+1].match(/[^\[\]]+/g);if(!r||0===r.length||r.length>2)return;const u=e?r[0]:void 0,d=e?r[1]:void 0;let h=0;for(;o[a][h]&&(o[a][h][s]!==l||e&&o[a][h][u]&&o[a][h][u][s]!==d);)h++;if(!o[a][h]){let e={};c&&(e=n),o[a][h]=e}o=o[a][h]}else{if("relatedInstance"!==a||!o[a]||"relatedInstance"===a&&o[a][s]!==l){let e={};c&&(e=n),o[a]=e}o=o[a]}void 0===o[s]&&(o[s]=l)})})}),a}static classToJson(e,t,r){return n=>{ECJsonTypeMap.addClass(n,e.toLowerCase(),t,r)}}static propertyToJson(e,t){return(r,n)=>{ECJsonTypeMap.addProperty(n,r.constructor,e.toLowerCase(),t)}}}ECJsonTypeMap._classesByTypedName=new Map,t.ECJsonTypeMap=ECJsonTypeMap;class ECInstance{}n([ECJsonTypeMap.propertyToJson("ecdb","id")],ECInstance.prototype,"ecId",void 0),t.ECInstance=ECInstance;class WsgInstance extends ECInstance{}n([ECJsonTypeMap.propertyToJson("wsg","instanceId"),ECJsonTypeMap.propertyToJson("ecdb","wsgId")],WsgInstance.prototype,"wsgId",void 0),n([ECJsonTypeMap.propertyToJson("wsg","eTag"),ECJsonTypeMap.propertyToJson("ecdb","eTag")],WsgInstance.prototype,"eTag",void 0),n([ECJsonTypeMap.propertyToJson("wsg","changeState")],WsgInstance.prototype,"changeState",void 0),t.WsgInstance=WsgInstance},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(70),i=r(97),o=r(0),s="imodeljs-clients.imodelhub";class IModelHubError extends i.WsgError{constructor(e,t,r){super(e,t,r)}static getErrorId(e){const t=o.IModelHubStatus[e.slice(IModelHubError._idPrefix.length)];return t||o.IModelHubStatus.Unknown}static requiresExtendedData(e){switch(e){case o.IModelHubStatus.LockOwnedByAnotherBriefcase:case o.IModelHubStatus.iModelAlreadyExists:case o.IModelHubStatus.FileAlreadyExists:case o.IModelHubStatus.PullIsRequired:case o.IModelHubStatus.CodeStateInvalid:case o.IModelHubStatus.CodeReservedByAnotherBriefcase:case o.IModelHubStatus.ConflictsAggregate:return!0;default:return!1}}copyExtendedData(){this.data=this._data}static fromId(e,t){const r=new IModelHubError(e);return r.name=o.IModelHubStatus[e],r.message=t,r}static parse(e,t=!0){const r=super.parse(e,!1);if(r instanceof i.WsgError&&r.name&&r.name.startsWith(IModelHubError._idPrefix)){const e=IModelHubError.getErrorId(r.name),i=new IModelHubError(e);return n(i,r),i.errorNumber=e,IModelHubError.requiresExtendedData(i.errorNumber)&&i.copyExtendedData(),t&&i.log(),i}return t&&r.log(),r}static shouldRetry(e,t){if(void 0===t||null===t)return super.shouldRetry(e,t);if(0===super.parseHttpStatus(t.statusType))return!1;const r=IModelHubError.parse({response:t},!1);if(!(r instanceof i.WsgError))return super.shouldRetry(e,t);if(r instanceof IModelHubError)return!1;const n=super.getErrorStatus(void 0!==r.name?super.getWSStatusId(r.name):98305,t.statusType);return[94212,98305].includes(n)}getLogLevel(){switch(this.errorNumber){case o.IModelHubStatus.AnotherUserPushing:case o.IModelHubStatus.PullIsRequired:case o.IModelHubStatus.LockOwnedByAnotherBriefcase:case o.IModelHubStatus.CodeReservedByAnotherBriefcase:return o.Logger.logWarning;default:return o.Logger.logError}}log(){this.getLogLevel()(s,this.logMessage(),this.getMetaData())}}IModelHubError._idPrefix="iModelHub.",t.IModelHubError=IModelHubError;class IModelHubClientError extends IModelHubError{static fromId(e,t){const r=new IModelHubClientError(e,t);return r.log(),r}static undefinedArgument(e){return this.fromId(o.IModelHubStatus.UndefinedArgumentError,`Argument ${e} is null or undefined`)}static invalidArgument(e){return this.fromId(o.IModelHubStatus.InvalidArgumentError,`Argument ${e} has an invalid value.`)}static missingDownloadUrl(e){return this.fromId(o.IModelHubStatus.MissingDownloadUrlError,`Supplied ${e} must include download URL. Use selectDownloadUrl() when getting ${e}.`)}static browser(){return this.fromId(o.IModelHubStatus.NotSupportedInBrowser,"Operation is not supported in browser.")}static fileHandler(){return this.fromId(o.IModelHubStatus.FileHandlerNotSet,"File handler is required to be set for file download / upload.")}static fileNotFound(){return this.fromId(o.IModelHubStatus.FileNotFound,"Could not find the file to upload.")}}t.IModelHubClientError=IModelHubClientError;t.ArgumentCheck=class ArgumentCheck{static defined(e,t){if(!t)throw IModelHubClientError.undefinedArgument(e)}static definedNumber(e,t){if("number"!==typeof t)throw IModelHubClientError.undefinedArgument(e)}static valid(e,t){if(!t)throw IModelHubClientError.invalidArgument(e)}static validGuid(e,t){if(this.defined(e,t),!o.Guid.isGuid(t))throw IModelHubClientError.invalidArgument(e)}static nonEmptyArray(e,t){if(this.defined(e,t),t.length<1)throw IModelHubClientError.invalidArgument(e)}static isBriefcaseIdValid(e){return e>1&&e<16777216}static validBriefcaseId(e,t){if(this.definedNumber(e,t),!this.isBriefcaseIdValid(t))throw IModelHubClientError.invalidArgument(e)}static isValidChangeSetId(e){const t=new RegExp("^[0-9A-Fa-f]+$");return 40===e.length&&t.test(e)}static validChangeSetId(e,t){if(this.defined(e,t),!this.isValidChangeSetId(t))throw IModelHubClientError.invalidArgument(e)}};t.AggregateResponseError=class AggregateResponseError extends Error{constructor(){super(...arguments),this.errors=[]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(6),o=r(21),s=r(22);function a(e,t,r,n,i,o){return o*(e-2*i*t-n*r)}t.quotientDerivative2=a;class Point4d{set(e=0,t=0,r=0,n=0){return this.xyzw[0]=e,this.xyzw[1]=t,this.xyzw[2]=r,this.xyzw[3]=n,this}get x(){return this.xyzw[0]}set x(e){this.xyzw[0]=e}get y(){return this.xyzw[1]}set y(e){this.xyzw[1]=e}get z(){return this.xyzw[2]}set z(e){this.xyzw[2]=e}get w(){return this.xyzw[3]}set w(e){this.xyzw[3]=e}constructor(e=0,t=0,r=0,n=0){this.xyzw=new Float64Array(4),this.xyzw[0]=e,this.xyzw[1]=t,this.xyzw[2]=r,this.xyzw[3]=n}static create(e=0,t=0,r=0,n=0,i){return i?i.set(e,t,r,n):new Point4d(e,t,r,n)}setFrom(e){return this.xyzw[0]=e.xyzw[0],this.xyzw[1]=e.xyzw[1],this.xyzw[2]=e.xyzw[2],this.xyzw[3]=e.xyzw[3],this}clone(e){return e?e.setFrom(this):new Point4d(this.xyzw[0],this.xyzw[1],this.xyzw[2],this.xyzw[3])}setFromJSON(e){n.Geometry.isNumberArray(e,4)?this.set(e[0],e[1],e[2],e[3]):this.set(0,0,0,0)}static fromJSON(e){const t=new Point4d;return t.setFromJSON(e),t}isAlmostEqual(e){return n.Geometry.isSameCoordinate(this.x,e.x)&&n.Geometry.isSameCoordinate(this.y,e.y)&&n.Geometry.isSameCoordinate(this.z,e.z)&&n.Geometry.isSameCoordinate(this.w,e.w)}toJSON(){return[this.xyzw[0],this.xyzw[1],this.xyzw[2],this.xyzw[3]]}distanceXYZW(e){return n.Geometry.hypotenuseXYZW(e.xyzw[0]-this.xyzw[0],e.xyzw[1]-this.xyzw[1],e.xyzw[2]-this.xyzw[2],e.xyzw[3]-this.xyzw[3])}distanceSquaredXYZW(e){return n.Geometry.hypotenuseSquaredXYZW(e.xyzw[0]-this.xyzw[0],e.xyzw[1]-this.xyzw[1],e.xyzw[2]-this.xyzw[2],e.xyzw[3]-this.xyzw[3])}realDistanceXY(e){const t=this.w,r=e.w;if(!n.Geometry.isSmallMetricDistance(t)&&!n.Geometry.isSmallMetricDistance(r))return n.Geometry.hypotenuseXY(e.xyzw[0]/r-this.xyzw[0]/t,e.xyzw[1]/r-this.xyzw[1]/t)}maxDiff(e){return Math.max(Math.abs(e.xyzw[0]-this.xyzw[0]),Math.abs(e.xyzw[1]-this.xyzw[1]),Math.abs(e.xyzw[2]-this.xyzw[2]),Math.abs(e.xyzw[3]-this.xyzw[3]))}maxAbs(){return Math.max(Math.abs(this.xyzw[0]),Math.abs(this.xyzw[1]),Math.abs(this.xyzw[2]),Math.abs(this.xyzw[3]))}magnitudeXYZW(){return n.Geometry.hypotenuseXYZW(this.xyzw[0],this.xyzw[1],this.xyzw[2],this.xyzw[3])}minus(e,t){return Point4d.create(this.xyzw[0]-e.xyzw[0],this.xyzw[1]-e.xyzw[1],this.xyzw[2]-e.xyzw[2],this.xyzw[3]-e.xyzw[3],t)}crossWeightedMinus(e,t){const r=this.xyzw[3],n=e.xyzw[3];return i.Vector3d.create(n*this.xyzw[0]-r*e.xyzw[0],n*this.xyzw[1]-r*e.xyzw[1],n*this.xyzw[2]-r*e.xyzw[2],t)}plus(e,t){return Point4d.create(this.xyzw[0]+e.xyzw[0],this.xyzw[1]+e.xyzw[1],this.xyzw[2]+e.xyzw[2],this.xyzw[3]+e.xyzw[3],t)}get isAlmostZero(){return n.Geometry.isSmallMetricDistance(this.maxAbs())}static createZero(){return new Point4d(0,0,0,0)}static createPlanePointPointZ(e,t,r){return Point4d.create(e.y*t.w-e.w*t.y,e.w*t.x-e.x*t.w,0,e.x*t.y-e.y*t.x,r)}static createFromPackedXYZW(e,t=0,r){return Point4d.create(e[t],e[t+1],e[t+2],e[t+3],r)}static createFromPointAndWeight(e,t){return new Point4d(e.x,e.y,e.z,t)}plusScaled(e,t,r){return Point4d.create(this.xyzw[0]+e.xyzw[0]*t,this.xyzw[1]+e.xyzw[1]*t,this.xyzw[2]+e.xyzw[2]*t,this.xyzw[3]+e.xyzw[3]*t,r)}interpolate(e,t,r){const n=1-e;return Point4d.create(this.xyzw[0]*n+t.xyzw[0]*e,this.xyzw[1]*n+t.xyzw[1]*e,this.xyzw[2]*n+t.xyzw[2]*e,this.xyzw[3]*n+t.xyzw[3]*e,r)}plus2Scaled(e,t,r,n,i){return Point4d.create(this.xyzw[0]+e.xyzw[0]*t+r.xyzw[0]*n,this.xyzw[1]+e.xyzw[1]*t+r.xyzw[1]*n,this.xyzw[2]+e.xyzw[2]*t+r.xyzw[2]*n,this.xyzw[3]+e.xyzw[3]*t+r.xyzw[3]*n,i)}plus3Scaled(e,t,r,n,i,o,s){return Point4d.create(this.xyzw[0]+e.xyzw[0]*t+r.xyzw[0]*n+i.xyzw[0]*o,this.xyzw[1]+e.xyzw[1]*t+r.xyzw[1]*n+i.xyzw[1]*o,this.xyzw[2]+e.xyzw[2]*t+r.xyzw[2]*n+i.xyzw[2]*o,this.xyzw[3]+e.xyzw[3]*t+r.xyzw[3]*n+i.xyzw[3]*o,s)}static createAdd2Scaled(e,t,r,n,i){return Point4d.create(e.xyzw[0]*t+r.xyzw[0]*n,e.xyzw[1]*t+r.xyzw[1]*n,e.xyzw[2]*t+r.xyzw[2]*n,e.xyzw[3]*t+r.xyzw[3]*n,i)}static createAdd3Scaled(e,t,r,n,i,o,s){return Point4d.create(e.xyzw[0]*t+r.xyzw[0]*n+i.xyzw[0]*o,e.xyzw[1]*t+r.xyzw[1]*n+i.xyzw[1]*o,e.xyzw[2]*t+r.xyzw[2]*n+i.xyzw[2]*o,e.xyzw[3]*t+r.xyzw[3]*n+i.xyzw[3]*o,s)}dotVectorsToTargets(e,t){return(e.xyzw[0]-this.xyzw[0])*(t.xyzw[0]-this.xyzw[0])+(e.xyzw[1]-this.xyzw[1])*(t.xyzw[1]-this.xyzw[1])+(e.xyzw[2]-this.xyzw[2])*(t.xyzw[2]-this.xyzw[2])+(e.xyzw[3]-this.xyzw[3])*(t.xyzw[3]-this.xyzw[3])}dotProduct(e){return this.xyzw[0]*e.xyzw[0]+this.xyzw[1]*e.xyzw[1]+this.xyzw[2]*e.xyzw[2]+this.xyzw[3]*e.xyzw[3]}dotProductXYZW(e,t,r,n){return this.xyzw[0]*e+this.xyzw[1]*t+this.xyzw[2]*r+this.xyzw[3]*n}altitude(e){return this.xyzw[0]*e.x+this.xyzw[1]*e.y+this.xyzw[2]*e.z+this.xyzw[3]}weightedAltitude(e){return this.xyzw[0]*e.x+this.xyzw[1]*e.y+this.xyzw[2]*e.z+this.xyzw[3]*e.w}velocity(e){return this.xyzw[0]*e.x+this.xyzw[1]*e.y+this.xyzw[2]*e.z}velocityXYZ(e,t,r){return this.xyzw[0]*e+this.xyzw[1]*t+this.xyzw[2]*r}static unitX(){return new Point4d(1,0,0,0)}static unitY(){return new Point4d(0,1,0,0)}static unitZ(){return new Point4d(0,0,1,0)}static unitW(){return new Point4d(0,0,0,1)}safeDivideOrNull(e,t){if(0!==e)return this.scale(1/e,t)}scale(e,t){return(t=t||new Point4d).xyzw[0]=this.xyzw[0]*e,t.xyzw[1]=this.xyzw[1]*e,t.xyzw[2]=this.xyzw[2]*e,t.xyzw[3]=this.xyzw[3]*e,t}negate(e){return(e=e||new Point4d).xyzw[0]=-this.xyzw[0],e.xyzw[1]=-this.xyzw[1],e.xyzw[2]=-this.xyzw[2],e.xyzw[3]=-this.xyzw[3],e}normalizeWeight(e){const t=n.Geometry.correctSmallMetricDistance(this.xyzw[3]);return e=e||new Point4d,this.safeDivideOrNull(t,e)}realPoint(e){const t=n.Geometry.correctSmallMetricDistance(this.xyzw[3]);if(0===t)return;const r=1/t;return i.Point3d.create(this.xyzw[0]*r,this.xyzw[1]*r,this.xyzw[2]*r,e)}static createRealPoint3dDefault000(e,t,r,o,s){const a=n.Geometry.correctSmallMetricDistance(o),c=0===a?0:1/a;return i.Point3d.create(e*c,t*c,r*c,s)}static createRealDerivativeRay3dDefault000(e,t,r,i,s,a,c,l,u){const d=n.Geometry.correctSmallMetricDistance(i),h=0===d?0:1/d,p=h*h;return o.Ray3d.createXYZUVW(e*h,t*h,r*h,(s*i-l*e)*p,(a*i-l*t)*p,(c*i-l*r)*p,u)}static createRealDerivativePlane3dByOriginAndVectorsDefault000(e,t,r,i,o,c,l,u,d,h,p,f,g){const m=n.Geometry.correctSmallMetricDistance(i),y=0===m?0:1/m,v=y*y,_=e*y,w=t*y,S=r*y,b=(o*i-u*e)*v,x=(c*i-u*t)*v,P=(l*i-u*r)*v;return s.Plane3dByOriginAndVectors.createOriginAndVectorsXYZ(_,w,S,b,x,P,a(d,u,f,_,b,y),a(h,u,f,w,x,y),a(p,u,f,S,P,y),g)}realPointDefault000(e){const t=n.Geometry.correctSmallMetricDistance(this.xyzw[3]);if(0===t)return i.Point3d.create(0,0,0,e);e=e||new i.Point3d;const r=1/t;return i.Point3d.create(this.xyzw[0]*r,this.xyzw[1]*r,this.xyzw[2]*r,e)}normalizeXYZW(e){const t=n.Geometry.correctSmallMetricDistance(this.magnitudeXYZW());return e=e||new Point4d,this.safeDivideOrNull(t,e)}}t.Point4d=Point4d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(176),o=r(0),s=r(86),a=r(104),c=r(64),l=r(4),u=r(8),d=r(26),h=r(133),p=r(103),f=r(134);class SyncFlags{constructor(){this._decorations=!1,this._scene=!1,this._renderPlan=!1,this._controller=!1,this._rotatePoint=!1,this._animationFraction=!1,this._redrawPending=!1}get isValidDecorations(){return this._decorations}get isValidScene(){return this._scene}get isValidController(){return this._controller}get isValidRenderPlan(){return this._renderPlan}get isValidRotatePoint(){return this._rotatePoint}get isValidAnimationFraction(){return this._animationFraction}get isRedrawPending(){return this._redrawPending}invalidateDecorations(){this._decorations=!1}invalidateScene(){this._scene=!1,this.invalidateDecorations()}invalidateRenderPlan(){this._renderPlan=!1,this.invalidateScene()}invalidateController(){this._controller=!1,this.invalidateRenderPlan()}invalidateRotatePoint(){this._rotatePoint=!1}invalidateAnimationFraction(){this._animationFraction=!1}invalidateRedrawPending(){this._redrawPending=!1}setValidDecorations(){this._decorations=!0}setValidScene(){this._scene=!0}setValidController(){this._controller=!0}setValidRenderPlan(){this._renderPlan=!0}setValidRotatePoint(){this._rotatePoint=!0}setValidAnimationFraction(){this._animationFraction=!0}setRedrawPending(){this._redrawPending=!0}initFrom(e){this._decorations=e._decorations,this._scene=e._scene,this._renderPlan=e._renderPlan,this._controller=e._controller,this._rotatePoint=e._rotatePoint,this._animationFraction=e._animationFraction,this._redrawPending=e._redrawPending}}t.SyncFlags=SyncFlags;class ViewRect{constructor(e=0,t=0,r=0,n=0){this.init(e,t,r,n)}get left(){return this._left}set left(e){this._left=Math.floor(e)}get top(){return this._top}set top(e){this._top=Math.floor(e)}get right(){return this._right}set right(e){this._right=Math.floor(e)}get bottom(){return this._bottom}set bottom(e){this._bottom=Math.floor(e)}get isNull(){return this.right<=this.left||this.bottom<=this.top}get isValid(){return!this.isNull}get width(){return this.right-this.left}set width(e){this.right=this.left+e}get height(){return this.bottom-this.top}set height(e){this.bottom=this.top+e}get aspect(){return this.isNull?1:this.width/this.height}get area(){return this.isNull?0:this.width*this.height}init(e,t,r,n){this.left=e,this.bottom=n,this.right=r,this.top=t}initFromPoints(e,t){this.init(e.x,e.y,t.x,t.y)}initFromRange(e){this.initFromPoints(e.low,e.high)}equals(e){return this.left===e.left&&this.right===e.right&&this.bottom===e.bottom&&this.top===e.top}setFrom(e){this.init(e.left,e.top,e.right,e.bottom)}clone(e){return void 0!==e?(e.setFrom(this),e):new ViewRect(this.left,this.top,this.right,this.bottom)}extend(e){this.left>e.left&&(this.left=e.left),this.top>e.top&&(this.top=e.top),this.right<e.right&&(this.right=e.right),this.bottom<e.bottom&&(this.bottom=e.bottom)}inset(e,t){this.width-2*e<=0||this.height-2*t<=0?this.init(0,0,0,0):(this._left+=e,this._right-=e,this._top+=t,this._bottom-=t)}insetUniform(e){this.inset(e,e)}scaleAboutCenter(e,t){const r=this.width,n=this.height,i=.5*(r-r*e),o=.5*(n-n*t);this.inset(i,o)}insetByPercent(e){this.insetUniform(this.width*e)}isContained(e){return this.left>=e.left&&this.right<=e.right&&this.bottom<=e.bottom&&this.top>=e.top}containsPoint(e){return e.x>=this.left&&e.x<this.right&&e.y>=this.top&&e.y<this.bottom}overlaps(e){return this.left<=e.right&&this.top<=e.bottom&&this.right>=e.left&&this.bottom>=e.top}computeOverlap(e,t){const r=Math.max(this.left,e.left),n=Math.max(this.top,e.top),i=Math.min(this.right,e.right),o=Math.min(this.bottom,e.bottom);if(r>i||n>o)return;const s=void 0!==t?t:new ViewRect;return s.left=r,s.right=i,s.top=n,s.bottom=o,s}}t.ViewRect=ViewRect;class DepthRangeNpc{constructor(e=0,t=1){this.minimum=e,this.maximum=t}middle(){return this.minimum+(this.maximum-this.minimum)/2}}t.DepthRangeNpc=DepthRangeNpc,function(e){e[e.View=0]="View",e[e.Npc=1]="Npc",e[e.World=2]="World"}(t.CoordSystem||(t.CoordSystem={}));class Animator{constructor(e,t,r,n){this.totalTime=e,this.viewport=t,this.startFrustum=r,this.endFrustum=n,this._currFrustum=new l.Frustum}moveToTime(e){this.interpolateFrustum(e/this.totalTime.milliseconds)}interpolateFrustum(e){for(let t=0;t<8;++t)this.startFrustum.points[t].interpolate(e,this.endFrustum.points[t],this._currFrustum.points[t]);this.viewport.setupViewFromFrustum(this._currFrustum)}animate(){const e=o.BeTimePoint.now();this._startTime||(this._startTime=e);const t=this.totalTime.milliseconds;if(this._startTime.milliseconds+t<=e.milliseconds)return this.moveToTime(t),!0;let r=!1,n=e.milliseconds-this._startTime.milliseconds;return n>t&&(r=!0,n=t),this.moveToTime(n),r}interrupt(){this._startTime&&this.moveToTime(this.totalTime.milliseconds)}}!function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(t.RemoveMe||(t.RemoveMe={}));t.DecorationAnimator=class DecorationAnimator{constructor(e){this._start=o.BeTimePoint.now(),this._stop=this._start.plus(e)}animateDecorations(e,t){return 0}animate(e){e.invalidateDecorations();const t=this._stop.milliseconds-this._start.milliseconds,r=o.BeTimePoint.now().milliseconds-this._start.milliseconds,n=Math.min(r/t,1);return 1===this.animateDecorations(e,n)||1===n?1:0}onInterrupted(e){e.invalidateDecorations(),this.animateDecorations(e,1)}};class ViewFrustum{constructor(e,t,r,i,o){this._viewCorners=new n.Range3d,this.frustFraction=1,this.viewOrigin=new n.Point3d,this.viewDelta=new n.Vector3d,this.viewOriginUnexpanded=new n.Point3d,this.viewDeltaUnexpanded=new n.Vector3d,this.rotation=new n.Matrix3d,this.worldToViewMap=n.Map4d.createIdentity(),this.worldToNpcMap=n.Map4d.createIdentity(),this.zClipAdjusted=!1,this.invalidFrustum=!1,this._viewRange=new ViewRect,this._view=e,this._clientWidth=t,this._clientHeight=r,this._displayedPlane=o,this._aspectRatioLocked=i;const s=this.view.getOrigin().clone(),a=this.view.getExtents().clone();this.rotation.setFrom(this.view.getRotation()),a.x=Math.abs(a.x),a.y=Math.abs(a.y),a.z=Math.abs(a.z);const c=this.view.getExtentLimits(),l=e=>Math.min(Math.max(c.min,e),c.max);if(a.x=l(a.x),a.y=l(a.y),this.adjustAspectRatio(s,a),this.viewOriginUnexpanded.setFrom(s),this.viewDeltaUnexpanded.setFrom(a),this.viewOrigin.setFrom(s),this.viewDelta.setFrom(a),this.zClipAdjusted=!1,this.view.is3d())if(this.view.allow3dManipulations()){if(this.view.isCameraOn&&this.validateCamera(),this.adjustZPlanes(s,a),this.view.isCameraOn){const e=this.view.camera.getEyePoint().minus(s);this.toView(e);const t=e.z-a.z,r=Math.max(15.2*n.Constant.oneCentimeter,this.view.forceMinFrontDist);t<r&&(this.toView(s),s.z-=r-t,this.fromView(s))}s.isExactEqual(this.viewOriginUnexpanded)&&a.isExactEqual(this.viewDeltaUnexpanded)||(this.zClipAdjusted=!0)}else{this.alignWithRootZ();const e=this.view.getViewedExtents();e.isNull&&(e.low.z=-ViewFrustum.get2dFrustumDepth(),e.high.z=ViewFrustum.get2dFrustumDepth());let t=Math.max(Math.abs(e.low.z),Math.abs(e.high.z));t=Math.max(t,1),a.z=2*t,s.z=-t}else this.alignWithRootZ(),a.z=2*ViewFrustum.get2dFrustumDepth(),s.z=-ViewFrustum.get2dFrustumDepth();this.viewOrigin.setFrom(s),this.viewDelta.setFrom(a);const u=this.view.computeWorldToNpc(this.rotation,s,a);void 0!==u.map?(this.worldToNpcMap.setFrom(u.map),this.frustFraction=u.frustFraction,this.worldToViewMap.setFrom(this.calcNpcToView().multiplyMapMap(this.worldToNpcMap))):this.invalidFrustum=!0}static get2dFrustumDepth(){return n.Constant.oneMeter}get view(){return this._view}set view(e){this._view=e}get _viewRect(){return this._viewRange.init(0,0,this._clientWidth,this._clientHeight),this._viewRange}toView(e,t){this.rotation.multiplyVectorInPlace(ViewFrustum._copyOutput(e,t))}fromView(e,t){this.rotation.multiplyTransposeVectorInPlace(ViewFrustum._copyOutput(e,t))}adjustAspectRatio(e,t){if(this._aspectRatioLocked)return;const r=this._viewRect.aspect*this.view.getAspectRatioSkew(),n=t.x/t.y;if(Math.abs(1-n/r)<1e-9)return;const i=t.clone();n>r?t.y=t.x/r:t.x=t.y*r;const o=e.clone();this.toView(o),o.x+=(i.x-t.x)/2,o.y+=(i.y-t.y)/2,this.fromView(o,e)}alignWithRootZ(){const e=n.Vector3d.unitZ();if(e.isAlmostEqual(this.rotation.rowZ()))return;const t=this.rotation.transpose();t.setColumn(2,e),n.Matrix3d.createRigidFromMatrix3d(t,2,t),t.transpose(this.rotation),this.view.setRotation(this.rotation)}validateCamera(){const e=this.view;if(!e.is3d())return;const t=e.camera;if(t.validateLens(),t.isFocusValid)return;const r=e.getExtents();let i=(r.x>r.y?r.x:r.y)/(2*Math.tan(t.getLensAngle().radians/2));i<r.z/2&&(i=r.z/2);const o=new n.Point3d(r.x/2,r.y/2,r.z/2+i);this.fromView(o),o.plus(e.getOrigin(),o),t.setEyePoint(o),t.setFocusDistance(i)}adjustZPlanes(e,t){const r=this.view;if(!r.is3d())return;let i=r.getViewedExtents();if(this.extendRangeForDisplayedPlane(i),i.isNull)return;const o=n.Transform.createOriginAndMatrix(n.Point3d.createZero(),this.rotation),s=l.Frustum.fromRange(i);if(s.multiply(o),i=s.toRange(),this.rotation.multiplyVectorInPlace(e),e.z=i.low.z,t.z=i.high.z-e.z,this.rotation.multiplyTransposeVectorInPlace(e),!r.isCameraOn)return;const a=r.camera.getEyePoint().minus(e);if(this.rotation.multiplyVectorInPlace(a),a.z<1)return this.rotation.multiplyVectorInPlace(e),e.z-=2-a.z,this.rotation.multiplyTransposeVectorInPlace(e),void(t.z=1);t.z>a.z&&(t.z=a.z)}extendRangeForDisplayedPlane(e){const t=this.view;if(!t.is3d())return;if(void 0===this._displayedPlane)return;const r=this._displayedPlane.getNormalRef(),i=this.rotation.getRow(2),o=i.crossProduct(r);if(o.magnitude()>1e-8){const s=new n.Point3d,a=new l.Frustum;let c=!1;const u=10,d=1e4;this.view.computeWorldToNpc(this.rotation,this.viewOrigin,this.viewDelta).map.transform1.multiplyPoint3dArrayQuietNormalize(a.points);for(let r=0;r<4;r++){const i=n.Ray3d.createStartEnd(a.points[r+4],a.points[r]).intersectionWithPlane(this._displayedPlane,s);void 0!==i&&(!t.isCameraOn||i>0)?e.extend(s):c=!0}if(c){const t=e.fractionToPoint(.5,.5,.5),n=o.unitCrossProduct(r);e.extend(t.plusScaled(n,d))}t.isCameraOn&&e.extend(t.getEyePoint().plusScaled(i,-u))}else e.extend(this._displayedPlane.getOriginRef().plusScaled(r,-1)),e.extend(this._displayedPlane.getOriginRef().plusScaled(r,1))}calcNpcToView(){const e=this.getViewCorners(),t=n.Map4d.createBoxMap(l.NpcCorners[0],l.NpcCorners[7],e.low,e.high);return void 0===t?n.Map4d.createIdentity():t}getViewCorners(){const e=this._viewCorners,t=this._viewRect;return e.high.x=t.right,e.low.y=t.bottom,e.low.x=0,e.high.y=0,e.low.z=-32767,e.high.z=32767,e}static createFromViewport(e,t){return new ViewFrustum(void 0!==t?t:e.view,e.viewRect.width,e.viewRect.height,e.isAspectRatioLocked)}static createFromViewportAndPlane(e,t){const r=new ViewFrustum(e.view,e.viewRect.width,e.viewRect.height,e.isAspectRatioLocked,t);return r.invalidFrustum?void 0:r}viewToNpcArray(e){const t=this.getViewCorners(),r=n.Transform.createIdentity();n.Transform.initFromRange(t.low,t.high,void 0,r),r.multiplyPoint3dArrayInPlace(e)}npcToViewArray(e){const t=this.getViewCorners();for(const r of e)t.fractionToPoint(r.x,r.y,r.z,r)}viewToNpc(e,t){const r=this.getViewCorners(),i=n.Transform.createIdentity();return n.Transform.initFromRange(r.low,r.high,void 0,i),i.multiplyPoint3d(e,t)}npcToView(e,t){return this.getViewCorners().fractionToPoint(e.x,e.y,e.z,t)}worldToNpcArray(e){this.worldToNpcMap.transform0.multiplyPoint3dArrayQuietNormalize(e)}npcToWorldArray(e){this.worldToNpcMap.transform1.multiplyPoint3dArrayQuietNormalize(e)}worldToViewArray(e){this.worldToViewMap.transform0.multiplyPoint3dArrayQuietNormalize(e)}worldToView4dArray(e,t){this.worldToViewMap.transform0.multiplyPoint3dArray(e,t)}viewToWorldArray(e){this.worldToViewMap.transform1.multiplyPoint3dArrayQuietNormalize(e)}view4dToWorldArray(e,t){this.worldToViewMap.transform1.multiplyPoint4dArrayQuietRenormalize(e,t)}worldToNpc(e,t){return this.worldToNpcMap.transform0.multiplyPoint3dQuietNormalize(e,t)}npcToWorld(e,t){return this.worldToNpcMap.transform1.multiplyPoint3dQuietNormalize(e,t)}worldToView(e,t){return this.worldToViewMap.transform0.multiplyPoint3dQuietNormalize(e,t)}worldToView4d(e,t){return this.worldToViewMap.transform0.multiplyPoint3d(e,1,t)}viewToWorld(e,t){return this.worldToViewMap.transform1.multiplyPoint3dQuietNormalize(e,t)}view4dToWorld(e,t){return this.worldToViewMap.transform1.multiplyXYZWQuietRenormalize(e.x,e.y,e.z,e.w,t)}getFrustum(e=2,t=!0,r){if(r=r?r.initNpc():new l.Frustum,!t&&this.zClipAdjusted){const e=this.view.computeWorldToNpc(this.rotation,this.viewOriginUnexpanded,this.viewDeltaUnexpanded);if(void 0===e.map)return r;const t=new l.Frustum;e.map.transform1.multiplyPoint3dArrayQuietNormalize(t.points),this.worldToNpcArray(t.points),r.setFrom(t)}switch(e){case 0:this.npcToViewArray(r.points);break;case 2:this.npcToWorldArray(r.points)}return r}getPixelSizeAtPoint(e){const t=e?this.worldToView(e):this.npcToView(new n.Point3d(.5,.5,.5)),r=new n.Point3d(t.x+1,t.y,t.z);return this.viewToWorld(t).distance(this.viewToWorld(r))}}ViewFrustum.nearScale24=3e-4,ViewFrustum._copyOutput=((e,t)=>{let r=e;return t&&(t.setFrom(e),r=t),r}),t.ViewFrustum=ViewFrustum;class Viewport{constructor(e){this.onViewChanged=new o.BeEvent,this._animationFraction=0,this._doContinuousRendering=!1,this.flashIntensity=0,this.flashDuration=0,this._wantTileBoundingBoxes=!1,this._viewRange=new ViewRect,this.sync=new SyncFlags,this.hilite=new l.Hilite.Settings,this._target=e}get viewFrustum(){return this._viewFrustum}get rotation(){return this._viewFrustum.rotation}get viewDelta(){return this._viewFrustum.viewDelta}get worldToViewMap(){return this._viewFrustum.worldToViewMap}get frustFraction(){return this._viewFrustum.frustFraction}get animationFraction(){return this._animationFraction}set animationFraction(e){this._animationFraction=e,this.sync.invalidateAnimationFraction()}get isAspectRatioLocked(){return!1}get target(){return this._target,this._target}get isGridOn(){return this.viewFlags.grid}get viewFlags(){return this.view.viewFlags}get wantAntiAliasLines(){return 2}get wantAntiAliasText(){return 0}get wantTileBoundingBoxes(){return this._wantTileBoundingBoxes}set wantTileBoundingBoxes(e){e!==this.wantTileBoundingBoxes&&(this._wantTileBoundingBoxes=e,this.invalidateScene())}get AnalysisStyle(){return this.view.AnalysisStyle}get iModel(){return this.view.iModel}get isPointAdjustmentRequired(){return this.view.is3d()}get isSnapAdjustmentRequired(){return u.IModelApp.toolAdmin.acsPlaneSnapLock&&this.view.is3d()}get isContextRotationRequired(){return u.IModelApp.toolAdmin.acsContextLock}dispose(){this._target,this._target=o.dispose(this._target)}get continuousRendering(){return this._doContinuousRendering}set continuousRendering(e){this._doContinuousRendering=e}get view(){return this._viewFrustum.view}get pixelsPerInch(){return 96}get backgroundMapPlane(){return this.view.displayStyle.backgroundMapPlane}set addFeatureOverrides(e){e!==this._addFeatureOverrides&&(this._addFeatureOverrides=e,this.view.setFeatureOverridesDirty(!0))}get isCameraOn(){return this.view.is3d()&&this.view.isCameraOn}invalidateDecorations(){this.sync.invalidateDecorations()}changeDynamics(e){this.target.changeDynamics(e),this.invalidateDecorations()}setFlashed(e,t){e!==this._flashedElem&&(this.lastFlashedElem=this._flashedElem,this._flashedElem=e),this.flashDuration=t}get auxCoordSystem(){return this.view.auxiliaryCoordinateSystem}getAuxCoordRotation(e){return this.auxCoordSystem.getRotation(e)}getAuxCoordOrigin(e){return this.auxCoordSystem.getOrigin(e)}toView(e,t){this._viewFrustum.toView(e,t)}fromView(e,t){this._viewFrustum.fromView(e,t)}changeView(e){this.doSetupFromView(e),this.invalidateScene(),this.sync.invalidateController(),this.target.reset()}invalidateScene(){this.sync.invalidateScene()}determineVisibleDepthRange(e,t){t&&(t.minimum=1,t.maximum=0);const r=(e=e&&e.isValid?e:this.viewRect).computeOverlap(this.viewRect);if(void 0===r)return;const i=this.readPixels(r,2);if(!i)return;let o=0,s=1;const a=n.Point3d.create(),c=n.Point2d.create();for(c.x=r.left;c.x<r.right;++c.x)for(c.y=r.top;c.y<r.bottom;++c.y)void 0!==this.getPixelDataNpcPoint(i,c.x,c.y,a)&&(s=Math.min(s,a.z),o=Math.max(o,a.z));return o<=0?void 0:(void 0===t?t=new DepthRangeNpc(s,o):(t.minimum=s,t.maximum=o),t)}turnCameraOn(e){const t=this.view;if(!t.is3d())return 15;if(e||(e=t.camera.lens),l.Camera.validateLensAngle(e),t.isCameraOn)return t.lookAtUsingLensAngle(t.getEyePoint(),t.getTargetPoint(),t.getYVector(),e);let r=this.determineVisibleDepthRange();r||(r=new DepthRangeNpc);const i=r.middle(),o=[new n.Point3d(0,0,i),new n.Point3d(1,1,i),new n.Point3d(0,0,r.maximum),new n.Point3d(1,1,r.maximum)];this.npcToWorldArray(o);const s=o[2].interpolate(.5,o[3]),a=o[0].interpolate(.5,o[1]),c=2*s.distance(a),u=t.minimumFrontDistance();return t.lookAtUsingLensAngle(s,a,t.getYVector(),e,u,c)}setStandardRotation(e){this.view.setStandardRotation(e),this.setupFromView()}doSetupFromView(e){const t=ViewFrustum.createFromViewport(this,e);return void 0===t?15:(this._viewFrustum=t,this.sync.invalidateRenderPlan(),this.sync.setValidController(),this.onViewChanged.raiseEvent(this),0)}setupFromView(){return this.doSetupFromView(this.view)}synchWithView(e){this.setupFromView()}viewToNpcArray(e){this._viewFrustum.viewToNpcArray(e)}npcToViewArray(e){this._viewFrustum.npcToViewArray(e)}viewToNpc(e,t){return this._viewFrustum.viewToNpc(e,t)}npcToView(e,t){return this._viewFrustum.npcToView(e,t)}worldToNpcArray(e){this._viewFrustum.worldToNpcArray(e)}npcToWorldArray(e){this._viewFrustum.npcToWorldArray(e)}worldToViewArray(e){this._viewFrustum.worldToViewArray(e)}worldToView4dArray(e,t){this._viewFrustum.worldToView4dArray(e,t)}viewToWorldArray(e){this._viewFrustum.viewToWorldArray(e)}view4dToWorldArray(e,t){this._viewFrustum.view4dToWorldArray(e,t)}worldToNpc(e,t){return this._viewFrustum.worldToNpc(e,t)}npcToWorld(e,t){return this._viewFrustum.npcToWorld(e,t)}worldToView(e,t){return this._viewFrustum.worldToView(e,t)}worldToView4d(e,t){return this._viewFrustum.worldToView4d(e,t)}viewToWorld(e,t){return this._viewFrustum.viewToWorld(e,t)}view4dToWorld(e,t){return this._viewFrustum.view4dToWorld(e,t)}pixelsFromInches(e){return e*this.pixelsPerInch}getFrustum(e=2,t=!0,r){return this._viewFrustum.getFrustum(e,t,r)}getWorldFrustum(e){return this.getFrustum(2,!0,e)}finishViewChange(e,t){t=void 0===t?{}:t,this.synchWithView(void 0===t.saveInUndo||t.saveInUndo),(void 0===t.animateFrustumChange||t.animateFrustumChange)&&this.animateFrustumChange(e,this.getFrustum(),t.animationTime)}scroll(e,t){const r=this.view;if(!r)return;const i=this.getFrustum().clone();if(r.is3d()&&r.isCameraOn){const t=new n.Vector3d(e.x,e.y,0),i=this.getFrustum(0,!1);i.translate(t),this.viewToWorldArray(i.points),r.setupFromFrustum(i),r.centerEyePoint()}else{const t=[new n.Point3d,new n.Point3d(e.x,e.y,0)];this.viewToWorldArray(t);const i=t[1].minus(t[0]),o=r.getOrigin().plus(i);r.setOrigin(o)}this.finishViewChange(i,t)}zoom(e,t,r){const i=this.view;if(!i)return;const o=this.getFrustum().clone();if(i.is3d()&&i.isCameraOn){const r=e?this.worldToNpc(e):l.NpcCenter.clone(),o=n.Transform.createFixedPointAndMatrix(r,n.Matrix3d.createScale(t,t,1)),s=r.minus(l.NpcCenter);s.z=0;const a=n.Transform.createTranslationXYZ(s.x,s.y,s.z).multiplyTransformTransform(o),c=new l.Frustum;a.multiplyPoint3dArrayInPlace(c.points),this.npcToWorldArray(c.points),i.setupFromFrustum(c),i.centerEyePoint()}else{const r=i.getExtents().clone();if(r.x*=t,r.y*=t,0!==i.validateViewDelta(r,!0))return;const n=e?e.clone():i.getCenter().clone();i.allow3dManipulations()||(n.z=0);const o=i.getOrigin().clone();this.toView(o),this.toView(n),i.setExtents(r),o.x=n.x-r.x/2,o.y=n.y-r.y/2,this.fromView(o),i.setOrigin(o)}this.finishViewChange(o,r)}zoomToPlacementProps(e,t){if(0===e.length)return;const r=e=>void 0!==e.angle;if(void 0!==t)if(void 0!==t.standardViewId)this.view.setStandardRotation(t.standardViewId);else if(void 0!==t.placementRelativeId){const n=e[0],o=r(n)?l.Placement2d.fromJSON(n):l.Placement3d.fromJSON(n),s=i.StandardView.getStandardRotation(t.placementRelativeId).clone();s.multiplyMatrixMatrixTranspose(o.transform.matrix,s),this.view.setRotation(s)}else void 0!==t.viewRotation&&this.view.setRotation(t.viewRotation);const o=n.Transform.createOriginAndMatrix(void 0,this.view.getRotation()),s=new l.Frustum,a=new n.Range3d;for(const n of e){const e=r(n)?l.Placement2d.fromJSON(n):l.Placement3d.fromJSON(n);a.extendArray(e.getWorldCorners(s).points,o)}this.view.lookAtViewAlignedVolume(a,this.viewRect.aspect,t?t.marginPercent:void 0),this.finishViewChange(this.getFrustum().clone(),t)}zoomToElementProps(e,t){if(0===e.length)return;const r=[];for(const n of e)void 0!==n.placement&&this.view.viewsModel(n.model)&&r.push(n.placement);this.zoomToPlacementProps(r,t)}async zoomToElements(e,t){this.zoomToElementProps(await this.iModel.elements.getProps(e),t)}zoomToVolume(e,t){this.view.lookAtVolume(e,this.viewRect.aspect,t?t.marginPercent:void 0),this.finishViewChange(this.getFrustum().clone(),t)}setupViewFromFrustum(e){const t=this.view.setupFromFrustum(e);return 0===this.setupFromView()&&0===t}computeViewRange(){return this.setupFromView(),this.view.computeFitRange()}animate(){this._animator&&this._animator.animate()&&(this._animator=void 0)}removeAnimator(){this.setAnimator(void 0)}setAnimator(e){this._animator&&this._animator.interrupt(),this._animator=e}animateFrustumChange(e,t,r){(!r||0>=r.milliseconds)&&(r=f.ToolSettings.animationTime),this.setAnimator(new Animator(r,this,e,t))}applyViewState(e,t){const r=this.getFrustum();this._viewFrustum.view=e.clone(),this.synchWithView(!1),t&&this.animateFrustumChange(r,this.getFrustum(),t)}static roundGrid(e,t){const r=e*t<0?-1:1;return e=e*r/t+.5,t*r*Math.floor(e)}getGridOrientation(e,t){switch(this.view.isSpatialView()&&e.setFrom(this.iModel.globalOrigin),this.view.getGridOrientation()){case 0:{const t=this.view.getCenter();this.toView(t),this.toView(e),e.z=t.z,this.fromView(e);break}case 1:break;case 2:n.Matrix3d.createRows(t.getRow(1),t.getRow(2),t.getRow(0),t);break;case 3:n.Matrix3d.createRows(t.getRow(0),t.getRow(2),t.getRow(1),t)}}pointToStandardGrid(e,t,r){const n=t.getRow(2);let i;(i=this.view.is3d()&&this.isCameraOn?this.view.camera.eye.vectorTo(e):this._viewFrustum.rotation.getRow(2).clone()).normalizeInPlace(),g(e,e,i,r,n,!1);const o=e.clone(),s=r.clone();this.toView(o),this.toView(s),o.y-=s.y,o.x-=s.x;const a=this.view.getGridSpacing();o.x=Viewport.roundGrid(o.x,a.x),o.y=Viewport.roundGrid(o.y,a.y),o.x+=s.x,o.y+=s.y,this.fromView(o),e.setFrom(o)}pointToGrid(e){if(4===this.view.getGridOrientation())return void this.pointToStandardGrid(e,this.getAuxCoordRotation(),this.getAuxCoordOrigin());const t=new n.Point3d,r=n.Matrix3d.createIdentity();this.getGridOrientation(t,r),this.pointToStandardGrid(e,r,t)}getPixelSizeAtPoint(e){void 0===e&&(e=this.npcToWorld(l.NpcCenter));const t=[],r=[];return r[0]=this.worldToView4d(e),r[1]=r[0].clone(),r[1].x+=r[1].w,this.view4dToWorldArray(r,t),t[0].distance(t[1])}get _wantInvertBlackAndWhite(){const e=this.view.backgroundColor.colors;return e.r+e.g+e.b>382.5}getContrastToBackgroundColor(){return this._wantInvertBlackAndWhite?l.ColorDef.black:l.ColorDef.white}processFlash(){let e=!1;if(this._flashedElem!==this.lastFlashedElem&&(this.flashIntensity=0,this.flashUpdateTime=o.BeTimePoint.now(),this.lastFlashedElem=this._flashedElem,e=void 0===this._flashedElem),void 0!==this._flashedElem&&this.flashIntensity<1){const t=o.BeDuration.fromSeconds(this.flashDuration),r=o.BeTimePoint.now().milliseconds-this.flashUpdateTime.milliseconds;this.flashIntensity=Math.min(r,t.milliseconds)/t.milliseconds,e=!0}return e}renderFrame(){const e=this.sync,t=this.view,r=this.target,n=new o.StopWatch(void 0,!0);this.animate(),t.onRenderFrame(this);let i=e.isRedrawPending||this._doContinuousRendering;if(e.invalidateRedrawPending(),r.updateViewRect()&&(r.onResized(),e.invalidateController()),t.isSelectionSetDirty){if(0===t.iModel.hilited.size&&0===t.iModel.selectionSet.size||t.iModel.hilited.size>0&&0===t.iModel.selectionSet.size)r.setHiliteSet(t.iModel.hilited.elements);else if(0===t.iModel.hilited.size&&t.iModel.selectionSet.size>0)r.setHiliteSet(t.iModel.selectionSet.elements);else{const e=new Set;t.iModel.hilited.elements.forEach(t=>e.add(t)),t.iModel.selectionSet.elements.forEach(t=>e.add(t)),r.setHiliteSet(e)}t.setSelectionSetDirty(!1),i=!0}if(t.areFeatureOverridesDirty){const e=new h.FeatureSymbology.Overrides(t);void 0!==this._addFeatureOverrides&&this._addFeatureOverrides(e,this),r.overrideFeatureSymbology(e),t.setFeatureOverridesDirty(!1),i=!0}if(e.isValidController||this.setupFromView(),!e.isValidScene){const n=new a.SceneContext(this,new c.TileRequests);t.createScene(n),t.createClassification(n),t.createTerrain(n),n.requests.requestMissing(),r.changeScene(n.graphics),r.changeTerrain(n.backgroundGraphics),i=!0,e.setValidScene()}if(e.isValidRenderPlan||(r.changeRenderPlan(d.RenderPlan.createFromViewport(this)),e.setValidRenderPlan(),i=!0),!e.isValidDecorations){const e=new d.Decorations;this.addDecorations(e),r.changeDecorations(e),i=!0}return e.isValidAnimationFraction||(r.animationFraction=this.animationFraction,i=!0,e.setValidAnimationFraction()),this.processFlash()&&(r.setFlashed(void 0!==this._flashedElem?this._flashedElem:o.Id64.invalid,this.flashIntensity),i=!0),n.stop(),i&&r.drawFrame(n.elapsed.milliseconds),!0}addDecorations(e){}readPixels(e,t){const r=this.viewRect;if(e.isContained(r))return this.target.readPixels(e,t)}readImage(e=new ViewRect(0,0,-1,-1),t=n.Point2d.createZero(),r=!1){return this.target.readImage(e,t,r)}getPixelDataNpcPoint(e,t,r,i){const o=e.getPixel(t,r).distanceFraction;if(o<=0)return;const s=this._viewFrustum,a=void 0!==i?i:new n.Point3d,c=this.viewRect;return a.x=(t+.5-c.left)/c.width,a.y=1-(r+.5-c.top)/c.height,s.frustFraction<1?a.z=o*s.frustFraction/(1+o*(s.frustFraction-1)):a.z=o,a}getPixelDataWorldPoint(e,t,r,n){const i=this.getPixelDataNpcPoint(e,t,r,n);return void 0!==i&&this.npcToWorld(i,i),i}}Viewport.nearScale24=3e-4,Viewport.undoDelay=o.BeDuration.fromSeconds(.5),t.Viewport=Viewport;class ScreenViewport extends Viewport{constructor(e,t,r){super(r),this.maxUndoSteps=20,this._forwardStack=[],this._backStack=[],this.canvas=e,this.parentDiv=t;const n=(e,t)=>{const r=e.style;r.position="absolute",r.top="0",r.left="0",r.height="100%",r.width="100%",r.zIndex=t.toString(),this.parentDiv.appendChild(e)};ScreenViewport.removeAllChildren(t);const i=parseInt(window.getComputedStyle(t).zIndex||"0",10);n(e,i+10),this.target.updateViewRect(),this.decorationDiv=document.createElement("div"),this.decorationDiv.className="overlay-decorators",this.decorationDiv.style.pointerEvents="none",this.decorationDiv.style.overflow="hidden",n(this.decorationDiv,i+20),this.toolTipDiv=document.createElement("div"),this.toolTipDiv.className="overlay-tooltip",this.toolTipDiv.style.pointerEvents="none",this.toolTipDiv.style.overflow="visible",n(this.toolTipDiv,i+30),this.setCursor()}static create(e,t){const r=document.createElement("canvas"),n=new this(r,e,u.IModelApp.renderSystem.createTarget(r));return n.changeView(t),n}static removeAllChildren(e){for(;e.lastChild;)e.removeChild(e.lastChild)}openToolTip(e,t,r){u.IModelApp.notifications.openToolTip(this.toolTipDiv,e,t,r)}setEventController(e){this._evController&&this._evController.destroy(),this._evController=e}pickNearestVisibleGeometry(e,t,r){const i=new p.ElementPicker;if(0===i.doPick(this,e,t,new p.LocateOptions))return;const o=void 0!==r?r:new n.Point3d;return o.setFrom(i.getHit(0).getPoint()),o}pickCanvasDecoration(e){return this.target.pickOverlayDecoration(e)}getClientRect(){return this.canvas.getBoundingClientRect()}get viewRect(){return this._viewRange.init(0,0,this.canvas.clientWidth,this.canvas.clientHeight),this._viewRange}addDecorations(e){ScreenViewport.removeAllChildren(this.decorationDiv);const t=new a.DecorateContext(this,e);this.view.decorate(t);for(const r of u.IModelApp.viewManager.decorators)r.decorate(t);this.sync.setValidDecorations()}setCursor(e="default"){this.canvas.style.cursor=e}synchWithView(e){super.setupFromView(),e&&this.saveViewUndo()}changeView(e){this.clearViewUndo(),super.changeView(e),this.saveViewUndo()}get viewCmdTargetCenter(){return this._viewCmdTargetCenter}set viewCmdTargetCenter(e){this._viewCmdTargetCenter=e?e.clone():void 0}get isUndoPossible(){return 0<this._backStack.length}get isRedoPossible(){return 0<this._forwardStack.length}clearViewUndo(){this._currentBaseline=void 0,this._forwardStack.length=0,this._backStack.length=0}saveViewUndo(){if(!this.view)return;if(this._currentBaseline||(this._currentBaseline=this.view.clone()),this.view.equalState(this._currentBaseline))return;const e=this._backStack;e.length>=this.maxUndoSteps&&e.shift();const t=o.BeTimePoint.now();(e.length<1||e[e.length-1].undoTime.plus(Viewport.undoDelay).before(t))&&(this._currentBaseline.undoTime=t,this._backStack.push(this._currentBaseline),this._forwardStack.length=0),this._currentBaseline=this.view.clone()}doUndo(e){0!==this._backStack.length&&(this._forwardStack.push(this._currentBaseline),this._currentBaseline=this._backStack.pop())}doRedo(e){0!==this._forwardStack.length&&(this._backStack.push(this._currentBaseline),this._currentBaseline=this._forwardStack.pop(),this.applyViewState(this._currentBaseline,e))}resetUndo(){this.clearViewUndo(),this.saveViewUndo()}static drawLocateHitDetail(e,t,r){if(!e.viewport.view.is3d())return;if(!(r instanceof s.SnapDetail)||!r.normal||r.isPointAdjusted)return;const i=e.createGraphicBuilder(3),o=e.viewport.hilite.color.invert(),a=o.clone();o.setTransparency(100),a.setTransparency(200),i.setSymbology(o,a,1);const c=2.5*t*e.viewport.getPixelSizeAtPoint(r.snapPoint),l=n.Matrix3d.createRigidHeadsUp(r.normal),u=n.Arc3d.createScaledXYColumns(r.snapPoint,l,c,c,n.AngleSweep.create360());i.addArc(u,!0,!0),i.addArc(u,!1,!1);const d=.6*c,h=n.Vector3d.create();u.vector0.normalize(h);const p=r.snapPoint.plusScaled(h,d),f=r.snapPoint.plusScaled(h,-d);i.addLineString([p,f]),u.vector90.normalize(h);const g=r.snapPoint.plusScaled(h,d),m=r.snapPoint.plusScaled(h,-d);i.addLineString([g,m]),e.addDecorationFromBuilder(i)}drawLocateCursor(e,t,r,n,i){if(i&&ScreenViewport.drawLocateHitDetail(e,r,i),n){const n=Math.floor(.5*r)+.5,i=this.worldToView(t);i.x=Math.floor(i.x)+.5,i.y=Math.floor(i.y)+.5;const o=e=>{e.beginPath(),e.strokeStyle="rgba(255,255,255,.4)",e.fillStyle="rgba(255,255,255,.2)",e.arc(0,0,n,0,2*Math.PI),e.fill(),e.stroke(),e.beginPath(),e.strokeStyle="rgba(0,0,0,.8)",e.lineWidth=1,e.arc(0,0,n+1,0,2*Math.PI),e.stroke()};e.addCanvasDecoration({position:i,drawDecoration:o},!0)}}}t.ScreenViewport=ScreenViewport;function g(e,t,r,n,i,o){let s,a=0;if(r?a=r.dotProduct(i):o=!0,o||Math.abs(a)<.001){const e=t.vectorTo(n).dotProduct(i);s=i.scale(e)}else{const e=(i.dotProduct(n)-i.dotProduct(t))/a;s=r.scale(e)}e.setFrom(s.plus(t))}t.OffScreenViewport=class OffScreenViewport extends Viewport{static create(e){const t=new this(u.IModelApp.renderSystem.createOffscreenTarget(new ViewRect(0,0,1,1)));return t.changeView(e),t.sync.setValidDecorations(),t}get viewRect(){return this.target.viewRect}setRect(e,t=!1){this.target.setViewRect(e,t),this.changeView(this.view)}},t.linePlaneIntersect=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(9),o=r(10),s=r(5);class Ray3d{constructor(e,t){this.origin=e,this.direction=t}static _create(e,t,r,i,o,s){return new Ray3d(n.Point3d.create(e,t,r),n.Vector3d.create(i,o,s))}static createXAxis(){return Ray3d._create(0,0,0,1,0,0)}static createYAxis(){return Ray3d._create(0,0,0,0,1,0)}static createZAxis(){return Ray3d._create(0,0,0,0,0,1)}static createZero(e){return e?(e.origin.setZero(),e.direction.setZero(),e):new Ray3d(n.Point3d.createZero(),n.Vector3d.createZero())}isAlmostEqual(e){return this.origin.isAlmostEqual(e.origin)&&this.direction.isAlmostEqual(e.direction)}static create(e,t,r){return r?(r.set(e,t),r):new Ray3d(e.clone(),t.clone())}static createWeightedDerivative(e,t,r){const n=e[3],i=t[3],o=e[0],a=e[1],c=e[2],l=t[0]*n-e[0]*i,u=t[1]*n-e[1]*i,d=t[2]*n-e[2]*i;if(s.Geometry.isSmallMetricDistance(n))return;const h=1/n,p=h*h;return Ray3d.createXYZUVW(o*h,a*h,c*h,l*p,u*p,d*p,r)}static createXYZUVW(e,t,r,i,o,s,a){return a?(a.getOriginRef().set(e,t,r),a.getDirectionRef().set(i,o,s),a):new Ray3d(n.Point3d.create(e,t,r),n.Vector3d.create(i,o,s))}static createCapture(e,t){return new Ray3d(e,t)}static createPointVectorNumber(e,t,r,n){return n?(n.origin.setFrom(e),n.direction.setFrom(t),n.a=r,n):((n=new Ray3d(e.clone(),t.clone())).a=r,n)}static createStartEnd(e,t,r){return r?(r.origin.setFrom(e),r.direction.setStartEnd(e,t),r):new Ray3d(e,n.Vector3d.createStartEnd(e,t))}getOriginRef(){return this.origin}getDirectionRef(){return this.direction}set(e,t){this.origin.setFrom(e),this.direction.setFrom(t)}clone(e){return e?(e.set(this.origin,this.direction),e):new Ray3d(this.origin.clone(),this.direction.clone())}cloneTransformed(e){return new Ray3d(e.multiplyPoint3d(this.origin),e.multiplyVector(this.direction))}transformInPlace(e){e.multiplyPoint3d(this.origin,this.origin),e.multiplyVector(this.direction,this.direction)}setFrom(e){this.set(e.origin,e.direction)}fractionToPoint(e){return this.origin.plusScaled(this.direction,e)}dotProductToPoint(e){return this.direction.dotProductStartEnd(this.origin,e)}pointToFraction(e){return s.Geometry.safeDivideFraction(this.direction.dotProductStartEnd(this.origin,e),this.direction.magnitudeSquared(),0)}projectPointToRay(e){return this.origin.plusScaled(this.direction,this.pointToFraction(e))}toRigidZFrame(){const e=o.Matrix3d.createRigidHeadsUp(this.direction,2);return i.Transform.createOriginAndMatrix(this.origin,e)}setFromJSON(e){if(!e)return this.origin.set(0,0,0),void this.direction.set(0,0,1);this.origin.setFromJSON(e.origin),this.direction.setFromJSON(e.direction)}trySetDirectionMagnitudeInPlace(e=1){return this.direction.tryNormalizeInPlace()?(this.direction.scaleInPlace(e),!0):(this.direction.setZero(),this.a=0,!1)}tryNormalizeInPlaceWithAreaWeight(e){const t=s.Geometry.smallMetricDistanceSquared;return this.a=e,!!(Math.abs(e)>t&&this.direction.tryNormalizeInPlace(t))||(this.direction.setZero(),this.a=0,!1)}toJSON(){return{origin:this.origin.toJSON(),direction:this.direction.toJSON()}}static fromJSON(e){const t=Ray3d.createXAxis();return t.setFromJSON(e),t}distance(e){const t=this.direction.magnitudeSquared(),r=this.dotProductToPoint(e),n=s.Geometry.inverseMetricDistanceSquared(t);return n?Math.sqrt(this.origin.distanceSquared(e)-r*r*n):Math.sqrt(this.origin.distanceSquared(e))}intersectionWithPlane(e,t){const r=n.Vector3d.createStartEnd(e.getOriginRef(),this.origin),i=this.direction.dotProduct(e.getNormalRef()),o=r.dotProduct(e.getNormalRef()),a=s.Geometry.conditionalDivideFraction(-o,i);if(void 0!==a)return t&&this.origin.plusScaled(this.direction,a,t),a}}t.Ray3d=Ray3d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(5);class Plane3dByOriginAndVectors{constructor(e,t,r){this.origin=e,this.vectorU=t,this.vectorV=r}static createOriginAndVectors(e,t,r,n){return n?(n.origin.setFrom(e),n.vectorU.setFrom(t),n.vectorV.setFrom(r),n):new Plane3dByOriginAndVectors(e.clone(),t.clone(),r.clone())}static createFromTransformColumnsXYAndLengths(e,t,r,n){return n?(n.origin.setFrom(e.getOrigin()),e.matrix.columnX(n.vectorU),e.matrix.columnY(n.vectorV)):n=new Plane3dByOriginAndVectors(e.getOrigin(),e.matrix.columnX(),e.matrix.columnY()),void 0!==t&&n.vectorU.scaleToLength(t,n.vectorU),void 0!==r&&n.vectorV.scaleToLength(r,n.vectorV),n}static createCapture(e,t,r,n){return n?(n.origin=e,n.vectorU=t,n.vectorV=r,n):new Plane3dByOriginAndVectors(e,t,r)}setOriginAndVectorsXYZ(e,t,r,n,i,o,s,a,c){return this.origin.set(e,t,r),this.vectorU.set(n,i,o),this.vectorV.set(s,a,c),this}setOriginAndVectors(e,t,r){return this.origin.setFrom(e),this.vectorU.setFrom(t),this.vectorV.setFrom(r),this}static createOriginAndVectorsXYZ(e,t,r,i,o,s,a,c,l,u){return u?u.setOriginAndVectorsXYZ(e,t,r,i,o,s,a,c,l):new Plane3dByOriginAndVectors(n.Point3d.create(e,t,r),n.Vector3d.create(i,o,s),n.Vector3d.create(a,c,l))}static createOriginAndTargets(e,t,r,n){return Plane3dByOriginAndVectors.createOriginAndVectorsXYZ(e.x,e.y,e.z,t.x-e.x,t.y-e.y,t.z-e.z,r.x-e.x,r.y-e.y,r.z-e.z,n)}static createXYPlane(e){return Plane3dByOriginAndVectors.createOriginAndVectorsXYZ(0,0,0,1,0,0,0,1,0,e)}static createOriginAndVectorsArrays(e,t,r,n){return Plane3dByOriginAndVectors.createOriginAndVectorsXYZ(e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2],n)}static createOriginAndVectorsWeightedArrays(e,t,r,o){const s=e[3];if(o=Plane3dByOriginAndVectors.createXYPlane(o),i.Geometry.isSmallMetricDistance(s))return o;const a=1/s,c=t[3]*a*a,l=r[3]*a*a;return o.origin.set(e[0]*a,e[1]*a,e[2]*a),n.Vector3d.createAdd2ScaledXYZ(t[0],t[1],t[2],a,e[0],e[1],e[2],-c,o.vectorU),n.Vector3d.createAdd2ScaledXYZ(r[0],r[1],r[2],a,e[0],e[1],e[2],-l,o.vectorV),o}fractionToPoint(e,t,r){return this.origin.plus2Scaled(this.vectorU,e,this.vectorV,t,r)}fractionToVector(e,t,r){return n.Vector3d.createAdd2Scaled(this.vectorU,e,this.vectorV,t,r)}setFromJSON(e){e&&e.origin&&e.vectorV?(this.origin.setFromJSON(e.origin),this.vectorU.setFromJSON(e.vectorU),this.vectorV.setFromJSON(e.vectorV)):(this.origin.set(0,0,0),this.vectorU.set(1,0,0),this.vectorV.set(0,1,0))}toJSON(){return{origin:this.origin.toJSON(),vectorU:this.vectorU.toJSON(),vectorV:this.vectorV.toJSON()}}static fromJSON(e){const t=Plane3dByOriginAndVectors.createXYPlane();return t.setFromJSON(e),t}isAlmostEqual(e){return this.origin.isAlmostEqual(e.origin)&&this.vectorU.isAlmostEqual(e.vectorU)&&this.vectorV.isAlmostEqual(e.vectorV)}}t.Plane3dByOriginAndVectors=Plane3dByOriginAndVectors},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(13),o=r(6),s=r(9),a=r(10);class RangeBase{static npcScaleFactor(e,t){return t<=e?0:1/(t-e)}static isExtremeValue(e){return Math.abs(e)>=RangeBase._EXTREME_POSITIVE}static isExtremePoint3d(e){return RangeBase.isExtremeValue(e.x)||RangeBase.isExtremeValue(e.y)||RangeBase.isExtremeValue(e.z)}static isExtremePoint2d(e){return RangeBase.isExtremeValue(e.x)||RangeBase.isExtremeValue(e.y)}static rangeToRangeAbsoluteDistance(e,t,r,n){return t<e?RangeBase._EXTREME_POSITIVE:n<r?RangeBase._EXTREME_POSITIVE:n<e?e-n:n<=t?0:r<=t?0:r-t}static coordinateToRangeAbsoluteDistance(e,t,r){return r<t?RangeBase._EXTREME_POSITIVE:e<t?t-e:e>r?e-r:0}}RangeBase._EXTREME_POSITIVE=1e200,RangeBase._EXTREME_NEGATIVE=-1e200,t.RangeBase=RangeBase;class Range3d extends RangeBase{setNull(){this.low.x=RangeBase._EXTREME_POSITIVE,this.low.y=RangeBase._EXTREME_POSITIVE,this.low.z=RangeBase._EXTREME_POSITIVE,this.high.x=RangeBase._EXTREME_NEGATIVE,this.high.y=RangeBase._EXTREME_NEGATIVE,this.high.z=RangeBase._EXTREME_NEGATIVE}freeze(){Object.freeze(this),Object.freeze(this.low),Object.freeze(this.high)}static toFloat64Array(e){return Float64Array.of(e.low.x,e.low.y,e.low.z,e.high.x,e.high.y,e.high.z)}toFloat64Array(){return Range3d.toFloat64Array(this)}static fromFloat64Array(e){if(6!==e.length)throw new Error("invalid array");return new Range3d(e[0],e[1],e[2],e[3],e[4],e[5])}static fromArrayBuffer(e){return this.fromFloat64Array(new Float64Array(e))}constructor(e=RangeBase._EXTREME_POSITIVE,t=RangeBase._EXTREME_POSITIVE,r=RangeBase._EXTREME_POSITIVE,n=RangeBase._EXTREME_NEGATIVE,i=RangeBase._EXTREME_NEGATIVE,s=RangeBase._EXTREME_NEGATIVE){super(),this.low=o.Point3d.create(e,t,r),this.high=o.Point3d.create(n,i,s)}isAlmostEqual(e){return this.low.isAlmostEqual(e.low)&&this.high.isAlmostEqual(e.high)||this.isNull&&e.isNull}setFrom(e){this.low.setFrom(e.low),this.high.setFrom(e.high)}static createFrom(e,t){return t?(t.setFrom(e),t):Range3d.createXYZXYZOrCorrectToNull(e.low.x,e.low.y,e.low.z,e.high.x,e.high.y,e.high.z,t)}setFromJSON(e){if(!e)return;if(this.setNull(),Array.isArray(e)){const t=o.Point3d.create();for(const r of e)t.setFromJSON(r),this.extendPoint(t);return}const t=o.Point3d.fromJSON(e.low),r=o.Point3d.fromJSON(e.high);RangeBase.isExtremePoint3d(t)||RangeBase.isExtremePoint3d(r)||(this.extendPoint(t),this.extendPoint(r))}toJSON(){return{low:this.low.toJSON(),high:this.high.toJSON()}}static fromJSON(e){const t=new Range3d;return t.setFromJSON(e),t}setDirect(e,t,r,n,i,o,s){this.low.x=e,this.low.y=t,this.low.z=r,this.high.x=n,this.high.y=i,this.high.z=o,s&&(this.low.x>this.high.x||this.low.y>this.high.y||this.low.z>this.high.z)&&this.setNull()}clone(e){return(e=e||new Range3d).setDirect(this.low.x,this.low.y,this.low.z,this.high.x,this.high.y,this.high.z,!1),e}static createNull(e){return(e=e||new Range3d).setNull(),e}extend(...e){let t;for(t of e)this.extendPoint(t)}static create(...e){const t=Range3d.createNull();let r;for(r of e)t.extendPoint(r);return t}static createTransformed(e,...t){const r=Range3d.createNull();let n;for(n of t)r.extendTransformedXYZ(e,n.x,n.y,n.z);return r}static createTransformedArray(e,t){const r=Range3d.createNull();return r.extendArray(t,e),r}static createInverseTransformedArray(e,t){const r=Range3d.createNull();return r.extendInverseTransformedArray(t,e),r}setXYZ(e,t,r){this.low.x=this.high.x=e,this.low.y=this.high.y=t,this.low.z=this.high.z=r}static createXYZ(e,t,r,n){return(n=n||new Range3d).setDirect(e,t,r,e,t,r,!1),n}static createXYZXYZ(e,t,r,n,i,o,s){return(s=s||new Range3d).setDirect(Math.min(e,n),Math.min(t,i),Math.min(r,o),Math.max(e,n),Math.max(t,i),Math.max(r,o),!1),s}static createXYZXYZOrCorrectToNull(e,t,r,n,i,o,s){return(s=s||new Range3d).setDirect(Math.min(e,n),Math.min(t,i),Math.min(r,o),Math.max(e,n),Math.max(t,i),Math.max(r,o),!0),s}static createRange2d(e,t=0,r){const n=r||new Range3d;return n.setNull(),n.extendXYZ(e.low.x,e.low.y,t),n.extendXYZ(e.high.x,e.high.y,t),n}static createArray(e,t){let r;for(r of((t=t||new Range3d).setNull(),e))t.extendPoint(r);return t}extendArray(e,t){if(Array.isArray(e))if(t)for(const r of e)this.extendTransformedXYZ(t,r.x,r.y,r.z);else for(const r of e)this.extendXYZ(r.x,r.y,r.z);else if(t)for(let r=0;r<e.length;r++)this.extendTransformedXYZ(t,e.getPoint3dAt(r).x,e.getPoint3dAt(r).y,e.getPoint3dAt(r).z);else for(let r=0;r<e.length;r++)this.extendXYZ(e.getPoint3dAt(r).x,e.getPoint3dAt(r).y,e.getPoint3dAt(r).z)}extendInverseTransformedArray(e,t){if(Array.isArray(e))for(const r of e)this.extendInverseTransformedXYZ(t,r.x,r.y,r.z);else for(let r=0;r<e.length;r++)this.extendInverseTransformedXYZ(t,e.getPoint3dAt(r).x,e.getPoint3dAt(r).y,e.getPoint3dAt(r).z)}extendTransformedXYZ(e,t,r,n){const i=e.origin,o=e.matrix.coffs;this.extendXYZ(i.x+o[0]*t+o[1]*r+o[2]*n,i.y+o[3]*t+o[4]*r+o[5]*n,i.z+o[6]*t+o[7]*r+o[8]*n)}extendTransformedXYZW(e,t,r,n,i){const o=e.origin,s=e.matrix.coffs;this.extendXYZW(o.x*i+s[0]*t+s[1]*r+s[2]*n,o.y*i+s[3]*t+s[4]*r+s[5]*n,o.z*i+s[6]*t+s[7]*r+s[8]*n,i)}extendInverseTransformedXYZ(e,t,r,n){const i=e.origin;if(!e.matrix.computeCachedInverse(!0))return!1;const o=e.matrix.inverseCoffs,s=t-i.x,a=r-i.y,c=n-i.z;return this.extendXYZ(o[0]*s+o[3]*a+o[6]*c,o[1]*s+o[4]*a+o[7]*c,o[2]*s+o[5]*a+o[8]*c),!0}extendTransformTransformedXYZ(e,t,r,n,i){const o=t.origin,s=t.matrix.coffs;this.extendTransformedXYZ(e,o.x+s[0]*r+s[1]*n+s[2]*i,o.y+s[3]*r+s[4]*n+s[5]*i,o.z+s[6]*r+s[7]*n+s[8]*i)}get isNull(){return this.high.x<this.low.x||this.high.y<this.low.y||this.high.z<this.low.z}static isNull(e){return e.high.x<e.low.x||e.high.y<e.low.y||e.high.z<e.low.z}get isSinglePoint(){return this.high.x===this.low.x&&this.high.y===this.low.y&&this.high.z===this.low.z}xLength(){const e=this.high.x-this.low.x;return e>0?e:0}yLength(){const e=this.high.y-this.low.y;return e>0?e:0}zLength(){const e=this.high.z-this.low.z;return e>0?e:0}maxLength(){return Math.max(this.xLength(),this.yLength(),this.zLength())}diagonal(e){return this.low.vectorTo(this.high,e)}diagonalFractionToPoint(e,t){return this.low.interpolate(e,this.high,t)}fractionToPoint(e,t,r,n){return this.low.interpolateXYZ(e,t,r,this.high,n)}localXYZToWorld(e,t,r,n){if(!this.isNull)return this.low.interpolateXYZ(e,t,r,this.high,n)}localToWorld(e,t){return this.localXYZToWorld(e.x,e.y,e.z,t)}localToWorldArrayInPlace(e){if(this.isNull)return!1;for(const t of e)this.low.interpolateXYZ(t.x,t.y,t.z,this.high,t);return!1}worldToLocal(e,t){const r=RangeBase.npcScaleFactor(this.low.x,this.high.x),n=RangeBase.npcScaleFactor(this.low.y,this.high.y),i=RangeBase.npcScaleFactor(this.low.z,this.high.z);if(0!==r&&0!==n&&0!==i)return o.Point3d.create((e.x-this.low.x)*r,(e.y-this.low.y)*n,(e.z-this.low.z)*i,t)}worldToLocalArrayInPlace(e){const t=RangeBase.npcScaleFactor(this.low.x,this.high.x),r=RangeBase.npcScaleFactor(this.low.y,this.high.y),n=RangeBase.npcScaleFactor(this.low.z,this.high.z);if(0===t||0===r||0===n)return!1;for(const i of e)o.Point3d.create((i.x-this.low.x)*t,(i.y-this.low.y)*r,(i.z-this.low.z)*n,i);return!0}corners(){return[o.Point3d.create(this.low.x,this.low.y,this.low.z),o.Point3d.create(this.high.x,this.low.y,this.low.z),o.Point3d.create(this.low.x,this.high.y,this.low.z),o.Point3d.create(this.high.x,this.high.y,this.low.z),o.Point3d.create(this.low.x,this.low.y,this.high.z),o.Point3d.create(this.high.x,this.low.y,this.high.z),o.Point3d.create(this.low.x,this.high.y,this.high.z),o.Point3d.create(this.high.x,this.high.y,this.high.z)]}maxAbs(){return this.isNull?0:Math.max(this.low.maxAbs(),this.high.maxAbs())}get isAlmostZeroX(){return n.Geometry.isSmallMetricDistance(this.xLength())}get isAlmostZeroY(){return n.Geometry.isSmallMetricDistance(this.yLength())}get isAlmostZeroZ(){return n.Geometry.isSmallMetricDistance(this.zLength())}containsXYZ(e,t,r){return e>=this.low.x&&t>=this.low.y&&r>=this.low.z&&e<=this.high.x&&t<=this.high.y&&r<=this.high.z}containsPoint(e){return this.containsXYZ(e.x,e.y,e.z)}containsPointXY(e){return e.x>=this.low.x&&e.y>=this.low.y&&e.x<=this.high.x&&e.y<=this.high.y}containsRange(e){return e.low.x>=this.low.x&&e.low.y>=this.low.y&&e.low.z>=this.low.z&&e.high.x<=this.high.x&&e.high.y<=this.high.y&&e.high.z<=this.high.z}intersectsRange(e){return!(this.low.x>e.high.x||this.low.y>e.high.y||this.low.z>e.high.z||e.low.x>this.high.x||e.low.y>this.high.y||e.low.z>this.high.z)}intersectsRangeXY(e){return!(this.low.x>e.high.x||this.low.y>e.high.y||e.low.x>this.high.x||e.low.y>this.high.y)}distanceToPoint(e){return this.isNull?RangeBase._EXTREME_POSITIVE:Math.min(n.Geometry.hypotenuseXYZ(RangeBase.coordinateToRangeAbsoluteDistance(e.x,this.low.x,this.high.x),RangeBase.coordinateToRangeAbsoluteDistance(e.y,this.low.y,this.high.y),RangeBase.coordinateToRangeAbsoluteDistance(e.z,this.low.z,this.high.z)),RangeBase._EXTREME_POSITIVE)}distanceToRange(e){return Math.min(n.Geometry.hypotenuseXYZ(RangeBase.rangeToRangeAbsoluteDistance(this.low.x,this.high.x,e.low.x,e.high.x),RangeBase.rangeToRangeAbsoluteDistance(this.low.y,this.high.y,e.low.y,e.high.y),RangeBase.rangeToRangeAbsoluteDistance(this.low.z,this.high.z,e.low.z,e.high.z)),RangeBase._EXTREME_POSITIVE)}extendXYZ(e,t,r){e<this.low.x&&(this.low.x=e),e>this.high.x&&(this.high.x=e),t<this.low.y&&(this.low.y=t),t>this.high.y&&(this.high.y=t),r<this.low.z&&(this.low.z=r),r>this.high.z&&(this.high.z=r)}extendXYZW(e,t,r,i){n.Geometry.isSmallMetricDistance(i)||this.extendXYZ(e/i,t/i,r/i)}extendPoint(e){this.extendXYZ(e.x,e.y,e.z)}extendTransformedPoint(e,t){this.extendTransformedXYZ(e,t.x,t.y,t.z)}extendRange(e){Range3d.isNull(e)||(this.extendXYZ(e.low.x,e.low.y,e.low.z),this.extendXYZ(e.high.x,e.high.y,e.high.z))}intersect(e,t){return this.intersectsRange(e)?Range3d.createXYZXYZOrCorrectToNull(Math.max(this.low.x,e.low.x),Math.max(this.low.y,e.low.y),Math.max(this.low.z,e.low.z),Math.min(this.high.x,e.high.x),Math.min(this.high.y,e.high.y),Math.min(this.high.z,e.high.z),t):Range3d.createNull(t)}union(e,t){return this.isNull?e.clone(t):e.isNull?this.clone(t):Range3d.createXYZXYZOrCorrectToNull(Math.min(this.low.x,e.low.x),Math.min(this.low.y,e.low.y),Math.min(this.low.z,e.low.z),Math.max(this.high.x,e.high.x),Math.max(this.high.y,e.high.y),Math.max(this.high.z,e.high.z),t)}scaleAboutCenterInPlace(e){if(!this.isNull){e=Math.abs(e);const t=.5*(this.low.x+this.high.x),r=.5*(this.low.y+this.high.y),i=.5*(this.low.z+this.high.z);this.high.x=n.Geometry.interpolate(t,e,this.high.x),this.high.y=n.Geometry.interpolate(r,e,this.high.y),this.high.z=n.Geometry.interpolate(i,e,this.high.z),this.low.x=n.Geometry.interpolate(t,e,this.low.x),this.low.y=n.Geometry.interpolate(r,e,this.low.y),this.low.z=n.Geometry.interpolate(i,e,this.low.z)}}expandInPlace(e){this.setDirect(this.low.x-e,this.low.y-e,this.low.z-e,this.high.x+e,this.high.y+e,this.high.z+e,!0)}getLocalToWorldTransform(e){return s.Transform.createOriginAndMatrix(o.Point3d.create(this.low.x,this.low.y,this.low.z),a.Matrix3d.createRowValues(this.high.x-this.low.x,0,0,0,this.high.y-this.low.y,0,0,0,this.high.z-this.low.z),e)}getNpcToWorldRangeTransform(e){const t=this.getLocalToWorldTransform(e),r=t.matrix;return 0===r.coffs[0]&&(r.coffs[0]=1),0===r.coffs[4]&&(r.coffs[4]=1),0===r.coffs[8]&&(r.coffs[8]=1),t}}t.Range3d=Range3d;class Range1d extends RangeBase{setNull(){this.low=RangeBase._EXTREME_POSITIVE,this.high=RangeBase._EXTREME_NEGATIVE}setDirect(e,t,r){this.low=e,this.high=t,r&&e>t&&this.setNull()}constructor(e=RangeBase._EXTREME_POSITIVE,t=RangeBase._EXTREME_NEGATIVE){super(),this.low=e,this.high=t,this.set_direct(e,t)}isAlmostEqual(e){return n.Geometry.isSameCoordinate(this.low,e.low)&&n.Geometry.isSameCoordinate(this.high,e.high)||this.isNull&&e.isNull}setFrom(e){this.low=e.low,this.high=e.high}setFromJSON(e){if(this.setNull(),Array.isArray(e)){let t;for(t of e)Number.isFinite(t)&&this.extendX(t)}else e.low&&e.low&&e.high&&e.high&&(this.setNull(),this.extendX(e.low),this.extendX(e.high))}static fromJSON(e){const t=new Range1d;return e&&t.setFromJSON(e),t}toJSON(){return this.isNull?new Array:[this.low,this.high]}set_direct(e,t){this.low=e,this.high=t}clone(e){return(e=e||new Range1d).set_direct(this.low,this.high),e}static createFrom(e,t){return(t=t||new Range1d).set_direct(e.low,e.high),t}static createNull(e){return(e=e||new Range1d).setNull(),e}setX(e){this.low=this.high=e}static createX(e,t){return(t=t||new Range1d).set_direct(e,e),t}static createXX(e,t,r){return(r=r||new Range1d).set_direct(Math.min(e,t),Math.max(e,t)),r}static createXXOrCorrectToNull(e,t,r){return t<e?Range1d.createNull(r):((r=r||new Range1d).set_direct(Math.min(e,t),Math.max(e,t)),r)}static createArray(e,t){let r;for(r of(t=t||new Range1d,e))t.extendX(r);return t}extendArray(e){let t;for(t of e)this.extendX(t)}extendArraySubset(e,t,r){const n=t+r;for(let i=t;i<n;i++)this.extendX(e[i])}get isNull(){return this.high<this.low}get isSinglePoint(){return this.high===this.low}length(){const e=this.high-this.low;return e>0?e:0}fractionToPoint(e){return n.Geometry.interpolate(this.low,e,this.high)}maxAbs(){return this.isNull?0:Math.max(Math.abs(this.low),Math.abs(this.high))}get isAlmostZeroLength(){return n.Geometry.isSmallMetricDistance(this.length())}containsX(e){return e>=this.low&&e<=this.high}containsRange(e){return e.low>=this.low&&e.high<=this.high}intersectsRange(e){return!(this.low>e.high||e.low>this.high)}distanceToRange(e){return RangeBase.rangeToRangeAbsoluteDistance(this.low,this.high,e.low,e.high)}distanceToX(e){return this.isNull?RangeBase._EXTREME_POSITIVE:RangeBase.coordinateToRangeAbsoluteDistance(e,this.low,this.high)}extendX(e){e<this.low&&(this.low=e),e>this.high&&(this.high=e)}extendRange(e){e.isNull||(this.extendX(e.low),this.extendX(e.high))}intersect(e,t){return this.intersectsRange(e)?Range1d.createXXOrCorrectToNull(Math.max(this.low,e.low),Math.min(this.high,e.high),t):Range1d.createNull(t)}union(e,t){return Range1d.createXX(Math.min(this.low,e.low),Math.max(this.high,e.high),t)}scaleAboutCenterInPlace(e){if(!this.isNull){e=Math.abs(e);const t=.5*(this.low+this.high);this.high=n.Geometry.interpolate(t,e,this.high),this.low=n.Geometry.interpolate(t,e,this.low)}}expandInPlace(e){this.setDirect(this.low-e,this.high+e,!0)}}t.Range1d=Range1d;class Range2d extends RangeBase{setNull(){this.low.x=RangeBase._EXTREME_POSITIVE,this.low.y=RangeBase._EXTREME_POSITIVE,this.high.x=RangeBase._EXTREME_NEGATIVE,this.high.y=RangeBase._EXTREME_NEGATIVE}static toFloat64Array(e){return Float64Array.of(e.low.x,e.low.y,e.high.x,e.high.y)}toFloat64Array(){return Range2d.toFloat64Array(this)}static fromFloat64Array(e){if(6!==e.length)throw new Error("invalid array");return new Range3d(e[0],e[1],e[2],e[3],e[4],e[5])}static fromArrayBuffer(e){return this.fromFloat64Array(new Float64Array(e))}constructor(e=Range2d._EXTREME_POSITIVE,t=Range2d._EXTREME_POSITIVE,r=Range2d._EXTREME_NEGATIVE,n=Range2d._EXTREME_NEGATIVE){super(),this.low=i.Point2d.create(e,t),this.high=i.Point2d.create(r,n)}isAlmostEqual(e){return this.low.isAlmostEqual(e.low)&&this.high.isAlmostEqual(e.high)||this.isNull&&e.isNull}setFrom(e){this.low.set(e.low.x,e.low.y),this.high.set(e.high.x,e.high.y)}static createFrom(e,t){return t?(t.setFrom(e),t):Range2d.createXYXYOrCorrectToNull(e.low.x,e.low.y,e.high.x,e.high.y,t)}setFromJSON(e){if(this.setNull(),Array.isArray(e)){const t=i.Point2d.create();for(const r of e)t.setFromJSON(r),this.extendPoint(t);return}const t=i.Point2d.fromJSON(e.low),r=i.Point2d.fromJSON(e.high);RangeBase.isExtremePoint2d(t)||RangeBase.isExtremePoint2d(r)||(this.extendPoint(t),this.extendPoint(r))}freeze(){Object.freeze(this.low),Object.freeze(this.high)}toJSON(){return this.isNull?[]:[this.low.toJSON(),this.high.toJSON()]}static fromJSON(e){const t=new Range2d;return e&&t.setFromJSON(e),t}setDirect(e,t,r,n,i){this.low.x=e,this.low.y=t,this.high.x=r,this.high.y=n,i&&(this.low.x>this.high.x||this.low.y>this.high.y)&&this.setNull()}clone(e){return(e=e||new Range2d).setDirect(this.low.x,this.low.y,this.high.x,this.high.y,!1),e}static createNull(e){return(e=e||new Range2d).setNull(),e}setXY(e,t){this.low.x=this.high.x=e,this.low.y=this.high.y=t}static createXY(e,t,r){return(r=r||new Range2d).setDirect(e,t,e,t,!1),r}static createXYXY(e,t,r,n,i){return(i=i||new Range2d).setDirect(Math.min(e,r),Math.min(t,n),Math.max(e,r),Math.max(t,n),!1),i}static createXYXYOrCorrectToNull(e,t,r,n,i){return e>r||t>n?Range2d.createNull(i):((i=i||new Range2d).setDirect(Math.min(e,r),Math.min(t,n),Math.max(e,r),Math.max(t,n),!0),i)}static createArray(e,t){let r;for(r of(t=t||new Range2d,e))t.extendPoint(r);return t}get isNull(){return this.high.x<this.low.x||this.high.y<this.low.y}static isNull(e){return e.high.x<e.low.x||e.high.y<e.low.y}get isSinglePoint(){return this.high.x===this.low.x&&this.high.y===this.low.y}xLength(){const e=this.high.x-this.low.x;return e>0?e:0}yLength(){const e=this.high.y-this.low.y;return e>0?e:0}diagonal(e){return this.low.vectorTo(this.high,e)}diagonalFractionToPoint(e,t){return this.low.interpolate(e,this.high,t)}fractionToPoint(e,t,r){return this.low.interpolateXY(e,t,this.high,r)}maxAbs(){return this.isNull?0:Math.max(this.low.maxAbs(),this.high.maxAbs())}get isAlmostZeroX(){return n.Geometry.isSmallMetricDistance(this.xLength())}get isAlmostZeroY(){return n.Geometry.isSmallMetricDistance(this.yLength())}containsXY(e,t){return e>=this.low.x&&t>=this.low.y&&e<=this.high.x&&t<=this.high.y}containsPoint(e){return this.containsXY(e.x,e.y)}containsRange(e){return e.low.x>=this.low.x&&e.low.y>=this.low.y&&e.high.x<=this.high.x&&e.high.y<=this.high.y}intersectsRange(e){return!(this.low.x>e.high.x||this.low.y>e.high.y||e.low.x>this.high.x||e.low.y>this.high.y)}distanceToPoint(e){return this.isNull?Range2d._EXTREME_POSITIVE:Math.min(n.Geometry.hypotenuseXY(RangeBase.coordinateToRangeAbsoluteDistance(e.x,this.low.x,this.high.x),RangeBase.coordinateToRangeAbsoluteDistance(e.y,this.low.y,this.high.y)),Range2d._EXTREME_POSITIVE)}distanceToRange(e){return Math.min(n.Geometry.hypotenuseXY(RangeBase.rangeToRangeAbsoluteDistance(this.low.x,this.high.x,e.low.x,e.high.x),RangeBase.rangeToRangeAbsoluteDistance(this.low.y,this.high.y,e.low.y,e.high.y)),Range2d._EXTREME_POSITIVE)}extendXY(e,t){e<this.low.x&&(this.low.x=e),e>this.high.x&&(this.high.x=e),t<this.low.y&&(this.low.y=t),t>this.high.y&&(this.high.y=t)}extendPoint(e){this.extendXY(e.x,e.y)}extendRange(e){Range2d.isNull(e)||(this.extendXY(e.low.x,e.low.y),this.extendXY(e.high.x,e.high.y))}intersect(e,t){return this.intersectsRange(e)?Range2d.createXYXY(Math.max(this.low.x,e.low.x),Math.max(this.low.y,e.low.y),Math.min(this.high.x,e.high.x),Math.min(this.high.y,e.high.y),t):Range2d.createNull(t)}union(e,t){return this.isNull?Range2d.createFrom(e,t):Range2d.isNull(e)?this.clone(t):Range2d.createXYXY(Math.min(this.low.x,e.low.x),Math.min(this.low.y,e.low.y),Math.max(this.high.x,e.high.x),Math.max(this.high.y,e.high.y),t)}scaleAboutCenterInPlace(e){if(!this.isNull){e=Math.abs(e);const t=.5*(this.low.x+this.high.x),r=.5*(this.low.y+this.high.y);this.high.x=n.Geometry.interpolate(t,e,this.high.x),this.high.y=n.Geometry.interpolate(r,e,this.high.y),this.low.x=n.Geometry.interpolate(t,e,this.low.x),this.low.y=n.Geometry.interpolate(r,e,this.low.y)}}expandInPlace(e){this.setDirect(this.low.x-e,this.low.y-e,this.high.x+e,this.high.y+e,!0)}}t.Range2d=Range2d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(13),o=r(6),s=r(99),a=r(19),c=r(21),l=r(165);t.NumberArray=class NumberArray{static PreciseSum(e){const t=e.length;if(0===t)return 0;let r,n,i=e[0],o=0;for(let s=1;s<t;s++)o=(n=i+(r=e[s]-o))-i-r,i=n;return i}static isExactEqual(e,t){if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return!e&&!t}static isAlmostEqual(e,t,r){if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>=r)return!1;return!0}return!e&&!t}static sum(e){let t=0;for(const r of e)t+=r;return t}static isCoordinateInArray(e,t){if(t)for(const r of t)if(n.Geometry.isSameCoordinate(e,r))return!0;return!1}static MaxAbsArray(e){const t=e.length;if(0===t)return 0;let r=Math.abs(e[0]);for(let n=1;n<t;n++){const t=Math.abs(e[n]);r<t&&(r=t)}return r}static MaxAbsTwo(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e:t}static maxAbsDiff(e,t){let r=0;const n=Math.min(e.length,t.length);for(let i=0;i<n;i++)r=Math.max(r,Math.abs(e[i]-t[i]));return r}static maxAbsDiffFloat64(e,t){let r=0;const n=Math.min(e.length,t.length);for(let i=0;i<n;i++)r=Math.max(r,Math.abs(e[i]-t[i]));return r}};t.Point2dArray=class Point2dArray{static isAlmostEqual(e,t){if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].isAlmostEqual(t[r]))return!1;return!0}return!e&&!t}static clonePoint2dArray(e){return e.map(e=>e.clone())}static lengthWithoutWraparound(e){let t=e.length;if(t<2)return t;const r=e[0].x,i=e[0].y;for(;t>1;){if(!n.Geometry.isSameCoordinate(e[t-1].x,r)||!n.Geometry.isSameCoordinate(e[t-1].y,i))return t;t--}return t}};t.Vector3dArray=class Vector3dArray{static isAlmostEqual(e,t){if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].isAlmostEqual(t[r]))return!1;return!0}return!e&&!t}static cloneVector3dArray(e){return e.map(e=>o.Vector3d.create(e.x,e.y,e.z))}};class Point4dArray{static packPointsAndWeightsToFloat64Array(e,t,r){r=r||new Float64Array(4*e.length);let n=0,i=0;for(i=0;i<e.length;i++)r[n++]=e[i].x,r[n++]=e[i].y,r[n++]=e[i].z,r[n++]=t[i];return r}static packToFloat64Array(e,t){t=t||new Float64Array(4*e.length);let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=n.z,t[r++]=n.w;return t}static unpackToPoint4dArray(e){const t=[];for(let r=0;r+3<e.length;r+=4)t.push(a.Point4d.create(e[r],e[r+1],e[r+2],e[r+3]));return t}static unpackFloat64ArrayToPointsAndWeights(e,t,r,n=o.Point3d.create){t.length=0,r.length=0;for(let i=0;i+3<e.length;i+=4)t.push(n(e[i],e[i+1],e[i+2])),r.push(e[i+3])}static multiplyInPlace(e,t){const r=t.length,n=Point4dArray._workPoint4d;for(let i=0;i+3<r;i+=4)e.multiplyXYZW(t[i],t[i+1],t[i+2],t[i+3],n),t[i]=n.x,t[i+1]=n.y,t[i+2]=n.z,t[i+3]=n.w}static isAlmostEqual(e,t){if(e&&t){if(e.length!==t.length)return!1;if(e instanceof Float64Array&&t instanceof Float64Array){for(let r=0;r<e.length;r++)if(!n.Geometry.isSameCoordinate(e[r],t[r]))return!1}else if(Array.isArray(e)&&Array.isArray(t))for(let r=0;r<e.length;r++)if(!e[r].isAlmostEqual(t[r]))return!1;return!0}return!e&&!t}static isCloseToPlane(e,t,r=n.Geometry.smallMetricDistance){if(Array.isArray(e)){for(const n of e)if(Math.abs(t.altitudeXYZW(n.x,n.y,n.z,n.w))>r)return!1}else if(e instanceof Float64Array){const n=e.length;for(let i=0;i+2<n;i+=4)if(Math.abs(t.altitudeXYZW(e[i],e[i+1],e[i+2],e[i+3]))>r)return!1}return!0}}Point4dArray._workPoint4d=a.Point4d.create(),t.Point4dArray=Point4dArray;class Point3dArray{static packToFloat64Array(e){const t=new Float64Array(3*e.length);let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=n.z;return t}static unpackNumbersToPoint3dArray(e){const t=[];for(let r=0;r+2<e.length;r+=3)t.push(o.Point3d.create(e[r],e[r+1],e[r+2]));return t}static unpackNumbersToNestedArrays(e,t){const r=[],n=e.length;let i=0,o=0;for(;i<n;){const s=[];for((o=i+t)>n&&(o=n);i<o;i++)s.push(e[i]);r.push(s)}return r}static unpackNumbersToNestedArraysIJK(e,t,r){const n=[],i=e.length;let o,s=0,a=0;for(;s<i;){const c=[];for(o=s+t*r;s<o;){const r=[];for((a=s+t)>i&&(a=i);s<a;s++)r.push(e[s]);c.push(r)}n.push(c)}return n}static multiplyInPlace(e,t){const r=o.Point3d.create(),n=t.length;for(let i=0;i+2<n;i+=3)e.multiplyXYZ(t[i],t[i+1],t[i+2],r),t[i]=r.x,t[i+1]=r.y,t[i+2]=r.z}static isAlmostEqual(e,t){if(e&&t){if(e.length!==t.length)return!1;if(e instanceof Float64Array&&t instanceof Float64Array){for(let r=0;r<e.length;r++)if(!n.Geometry.isSameCoordinate(e[r],t[r]))return!1}else if(Array.isArray(e)&&Array.isArray(t))for(let r=0;r<e.length;r++)if(!e[r].isAlmostEqual(t[r]))return!1;return!0}return!e&&!t}static centroid(e,t){t=o.Point3d.create(0,0,0,t);const r=o.Point3d.create();if(e.length>0){for(let n=0;n<e.length;n++)e.atPoint3dIndex(n,r),t.x+=r.x,t.y+=r.y,t.z+=r.z;t.scaleInPlace(1/e.length)}return t}static vectorToMostDistantPoint(e,t,r){if(0===e.length)return-1;let n,i=-1,o=-1;for(let s=0;s<e.length;s++)(n=t.distance(e[s]))>i&&(t.vectorTo(e[s],r),i=n,o=s);return o}static vectorToPointWithMaxCrossProductMangitude(e,t,r,n){if(0===e.length)return-1;let i,o,s=-1,a=-1;for(let c=0;c<e.length;c++)(i=(o=t.vectorTo(e[c],o)).crossProductMagnitude(r))>s&&(n.setFrom(o),s=i,a=c);return a}static closestPointIndex(e,t){let r,i=-1,o=Number.MAX_VALUE;const s=t.x,a=t.y,c=t.z;for(let l=0;l<e.length;l++)(r=n.Geometry.distanceXYZXYZ(s,a,c,e[l].x,e[l].y,e[l].z))<o&&(i=l,o=r);return i}static isCloseToPlane(e,t,r=n.Geometry.smallMetricDistance){if(Array.isArray(e)){let n;for(n of e)if(Math.abs(t.altitude(n))>r)return!1}else if(e instanceof Float64Array){const n=e.length;for(let i=0;i+2<n;i+=3)if(Math.abs(t.altitudeXYZ(e[i],e[i+1],e[i+2]))>r)return!1}return!0}static sumLengths(e){let t=0;if(Array.isArray(e)){const r=e.length-1;for(let n=0;n<r;n++)t+=e[n].distance(e[n+1])}else if(e instanceof Float64Array){const r=e.length;for(let n=0;n+5<r;n+=3)t+=Math.hypot(e[n+3]-e[n],e[n+4]-e[n+1],e[n+5]-e[n+2])}return t}static clonePoint3dArray(e){return e.map(e=>o.Point3d.create(e.x,e.y,e.z))}static clonePoint2dArray(e){return e.map(e=>i.Point2d.create(e.x,e.y))}}t.Point3dArray=Point3dArray;class PolygonOps{static sumTriangleAreas(e){let t=0;const r=e.length;if(r>=3){const n=e[0],i=n.vectorTo(e[1]);let s=o.Vector3d.create();for(let o=2;o<r;o++)s=n.vectorTo(e[o],s),t+=i.crossProductMagnitude(s),i.setFrom(s)}return t*=.5}static sumTriangleAreasXY(e){let t=0;const r=e.length;if(r>=3){const n=e[0],i=n.vectorTo(e[1]);let s=o.Vector3d.create();for(let o=2;o<r;o++)s=n.vectorTo(e[o],s),t+=i.crossProductXY(s),i.setFrom(s)}return t*=.5}static areaNormalGo(e,t){t||(t=new o.Vector3d);const r=e.length;if(3===r)e.crossProductIndexIndexIndex(0,1,2,t);else if(r>=3){t.setZero();for(let n=2;n<r;n++)e.accumulateCrossProductIndexIndexIndex(0,n-1,n,t)}return t.scaleInPlace(.5),t}static areaNormal(e,t){return t||(t=o.Vector3d.create()),PolygonOps.areaNormalGo(new Point3dArrayCarrier(e),t),t}static area(e){return PolygonOps.areaNormal(e).magnitude()}static areaXY(e){let t=0;for(let r=1;r+1<e.length;r++)t+=e[0].crossProductToPointsXY(e[r],e[r+1]);return.5*t}static centroidAreaNormal(e){const t=e.length;if(3===t){const t=e[0].crossProductToPoints(e[1],e[2]),r=.5*t.magnitude(),n=c.Ray3d.createCapture(Point3dArray.centroid(new Point3dArrayCarrier(e)),t);return n.tryNormalizeInPlaceWithAreaWeight(r)?n:void 0}if(t>=3){const r=e[0],i=r.vectorTo(e[1]);let s=o.Vector3d.create(),a=o.Vector3d.create();const l=o.Vector3d.createZero(),u=o.Vector3d.createZero();for(let n=2;n<t;n++){s=r.vectorTo(e[n],s),a=i.crossProduct(s,a),u.addInPlace(a);const t=a.magnitude()/6;l.plus2Scaled(i,t,s,t,l),i.setFrom(s)}const d=.5*u.magnitude(),h=n.Geometry.conditionalDivideFraction(1,d);if(void 0!==h){const e=c.Ray3d.createCapture(r.plusScaled(l,h,r),u);return e.tryNormalizeInPlaceWithAreaWeight(d),e}}}static centroidAndArea(e,t){let r=0;if(t.set(0,0),e.length<3)return;const o=e[0];let s=i.Vector2d.create(0,0),a=0;for(let n=1;n+1<e.length;n++){const t=o.vectorTo(e[n]),r=o.vectorTo(e[n+1]),i=t.crossProduct(r);s=s.plus(t.plus(r).scale(i)),a+=i}r=.5*a;const c=n.Geometry.conditionalDivideFraction(1,6*r);if(void 0!==c)return t.setFrom(o.plusScaled(s,c)),r;t.setFrom(o)}static unitNormal(e,t){const r=e.length;return 3===r?(e.crossProductIndexIndexIndex(0,1,2,t),t.normalizeInPlace()):4===r?(e.vectorIndexIndex(0,2,PolygonOps._vector0),e.vectorIndexIndex(1,3,PolygonOps._vector1),PolygonOps._vector0.crossProduct(PolygonOps._vector1,t),t.normalizeInPlace()):(PolygonOps.areaNormalGo(e,t),t.normalizeInPlace())}static addSecondMomentAreaProducts(e,t,r){const n=PolygonOps._normal;if(PolygonOps.unitNormal(e,n)){const i=PolygonOps._vector0,o=PolygonOps._vector1,s=PolygonOps._matrixA,a=PolygonOps._matrixB,c=PolygonOps._matrixC,l=e.vectorXYAndZIndex(t,0,PolygonOps._vectorOrigin),u=e.length;let d=0;for(let t=2;t<u;t++)e.vectorIndexIndex(0,t-1,i),e.vectorIndexIndex(0,t,o),d=n.tripleProduct(i,o),s.setOriginAndVectors(l,i,o,n),s.multiplyMatrixMatrix(PolygonOps._triangleMomentWeights,a),a.multiplyMatrixMatrixTranspose(s,c),r.addScaledInPlace(c,d)}}static testXYPolygonTurningDirections(e){let t=e.length,r=t-1;for(;r>1&&e[r].x===e[0].x&&e[r].y===e[0].y;)t=r--;if(t>2){let n=i.Point2d.create(e[r].x-e[r-1].x,e[r].y-e[r-1].y);const o=i.Point2d.create(e[0].x-e[r].x,e[0].y-e[r].y),s=n.x*o.y-n.y*o.x;for(let r=1;r<t;r++){if(n=o.clone(),i.Point2d.create(e[r].x-e[r-1].x,e[r].y-e[r-1].y,o),(n.x*o.y-n.y*o.x)*s<=0)return 0}return s>0?1:-1}return 0}static parity(e,t,r=0){let n;const i=e.x,o=e.y,s=t.length;if(s<2)return Math.abs(i-t[0].x)<=r&&Math.abs(o-t[0].y)<=r?0:-1;if(void 0!==(n=PolygonOps.parityYTest(e,t,r)))return n;if(void 0!==(n=PolygonOps.parityXTest(e,t,r)))return n;for(let l=0;l<s;l++)if(Math.abs(i-t[l].x)<=r&&Math.abs(o-t[l].y)<=r)return 0;let a=.276234342921378;const c=a;for(;a<10;){if(void 0!==(n=PolygonOps.parityVectorTest(e,a,t,r)))return n;a+=c}return-2}static parityYTest(e,t,r){const n=t.length,i=e.x,o=e.y;let s,a,c,l,u=o-t[n-1].y,d=0;if(!(Math.abs(u)<=r)){for(let e=0;e<n;e++,u=s){if(s=o-t[e].y,Math.abs(s)<=r)return;if(u*s<0){if(c=-u/(s-u),(l=e-1)<0&&(l=n-1),a=t[l].x+c*(t[e].x-t[l].x),Math.abs(a-i)<=r)return 0;a<i&&d++}}return 1&d?1:-1}}static parityXTest(e,t,r){const n=t.length,i=e.y,o=e.x;let s,a,c,l,u=o-t[n-1].x,d=0;if(!(Math.abs(u)<=r)){for(let e=0;e<n;e++,u=s){if(s=o-t[e].x,Math.abs(s)<=r)return;if(u*s<0){if(c=-u/(s-u),(l=e-1)<0&&(l=n-1),a=t[l].y+c*(t[e].y-t[l].y),Math.abs(a-i)<=r)return 0;a<i&&d++}}return 1&d?1:-1}}static parityVectorTest(e,t,r,n){const o=r.length;let s,a,c,l,u,d=0;const h=i.Vector2d.create(Math.cos(t),Math.sin(t)),p=i.Vector2d.create(-h.y,h.x);let f,g=p.dotProductStartEnd(e,r[o-1]);if(!(Math.abs(g)<=n)){for(let t=0;t<o;t++,g=s){if(s=p.dotProductStartEnd(e,r[t]),Math.abs(s)<=n)return;if(g*s<0){if(u=-g/(s-g),(f=t-1)<0&&(f=o-1),l=(a=h.dotProductStartEnd(e,r[f]))+u*((c=h.dotProductStartEnd(e,r[t]))-a),Math.abs(l)<=n)return 0;l<0&&d++}}return 1&d?1:-1}}}PolygonOps._triangleMomentWeights=s.Matrix4d.createRowValues(2/24,1/24,0,4/24,1/24,2/24,0,4/24,0,0,0,0,4/24,4/24,0,.5),PolygonOps._vector0=o.Vector3d.create(),PolygonOps._vector1=o.Vector3d.create(),PolygonOps._vectorOrigin=o.Vector3d.create(),PolygonOps._normal=o.Vector3d.create(),PolygonOps._matrixA=s.Matrix4d.createIdentity(),PolygonOps._matrixB=s.Matrix4d.createIdentity(),PolygonOps._matrixC=s.Matrix4d.createIdentity(),t.PolygonOps=PolygonOps;class Point3dArrayCarrier extends l.IndexedXYZCollection{constructor(e){super(),this.data=e}isValidIndex(e){return e>=0&&e<this.data.length}atPoint3dIndex(e,t){if(this.isValidIndex(e)){const r=this.data[e];return o.Point3d.create(r.x,r.y,r.z,t)}}atVector3dIndex(e,t){if(this.isValidIndex(e)){const r=this.data[e];return o.Vector3d.create(r.x,r.y,r.z,t)}}vectorIndexIndex(e,t,r){if(this.isValidIndex(e)&&this.isValidIndex(t))return o.Vector3d.createStartEnd(this.data[e],this.data[t],r)}vectorXYAndZIndex(e,t,r){if(this.isValidIndex(t))return o.Vector3d.createStartEnd(e,this.data[t],r)}crossProductXYAndZIndexIndex(e,t,r,n){if(this.isValidIndex(t)&&this.isValidIndex(r))return o.Vector3d.createCrossProductToPoints(e,this.data[t],this.data[r],n)}crossProductIndexIndexIndex(e,t,r,n){if(this.isValidIndex(e)&&this.isValidIndex(t)&&this.isValidIndex(r))return o.Vector3d.createCrossProductToPoints(this.data[e],this.data[t],this.data[r],n)}accumulateCrossProductIndexIndexIndex(e,t,r,n){const i=this.data;this.isValidIndex(e)&&this.isValidIndex(t)&&this.isValidIndex(r)&&n.addCrossProductToTargetsInPlace(i[e].x,i[e].y,i[e].z,i[t].x,i[t].y,i[t].z,i[r].x,i[r].y,i[r].z)}get length(){return this.data.length}}t.Point3dArrayCarrier=Point3dArrayCarrier},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.Immutable=1]="Immutable"}(t.RpcResponseCacheControl||(t.RpcResponseCacheControl={})),function(e){e.Name="__name__",e.JSON="__JSON__",e.Undefined="__undefined__",e.Map="__map__",e.Set="__set__",e.Unregistered="__unregistered__",e.Error="__error__",e.ErrorName="__error_name__",e.ErrorMessage="__error_message__",e.ErrorStack="__error_stack__",e.Binary="__binary__"}(t.RpcMarshalingDirective||(t.RpcMarshalingDirective={})),function(e){e[e.RequestCreated=0]="RequestCreated",e[e.ResponseLoaded=1]="ResponseLoaded",e[e.ResponseLoading=2]="ResponseLoading",e[e.ConnectionErrorReceived=3]="ConnectionErrorReceived",e[e.UnknownErrorReceived=4]="UnknownErrorReceived",e[e.BackendErrorReceived=5]="BackendErrorReceived",e[e.ConnectionAborted=6]="ConnectionAborted",e[e.RequestReceived=7]="RequestReceived",e[e.BackendResponseCreated=8]="BackendResponseCreated",e[e.BackendReportedPending=9]="BackendReportedPending",e[e.BackendReportedNotFound=10]="BackendReportedNotFound",e[e.BackendErrorOccurred=11]="BackendErrorOccurred"}(t.RpcProtocolEvent||(t.RpcProtocolEvent={})),function(e){e[e.Unknown=0]="Unknown",e[e.Created=1]="Created",e[e.Submitted=2]="Submitted",e[e.Pending=3]="Pending",e[e.Resolved=4]="Resolved",e[e.Rejected=5]="Rejected",e[e.Disposed=6]="Disposed",e[e.NotFound=7]="NotFound"}(t.RpcRequestStatus||(t.RpcRequestStatus={})),function(e){e[e.StatusChanged=0]="StatusChanged",e[e.PendingUpdateReceived=1]="PendingUpdateReceived"}(t.RpcRequestEvent||(t.RpcRequestEvent={})),function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Binary=2]="Binary",e[e.Multipart=3]="Multipart"}(t.RpcContentType||(t.RpcContentType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Window=1]="Window",e[e.Android=2]="Android",e[e.iOS=3]="iOS"}(t.RpcMobilePlatform||(t.RpcMobilePlatform={})),function(e){e[e.Frontend=0]="Frontend",e[e.Backend=1]="Backend"}(t.RpcEndpoint||(t.RpcEndpoint={})),t.WEB_RPC_CONSTANTS={CONTENT:"Content-Type",TEXT:"text/plain",ANY_TEXT:"text/",BINARY:"application/octet-stream",MULTIPART:"multipart/form-data"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3),o=r(4),s=r(63),a=r(8),c=r(20),l=r(53),u=r(177);class RenderPlan{get frustum(){return this._curFrustum.getFrustum()}get fraction(){return this._curFrustum.frustFraction}selectTerrainFrustum(){void 0!==this.terrainFrustum&&(this._curFrustum=this.terrainFrustum)}selectViewFrustum(){this._curFrustum=this.viewFrustum}constructor(e,t,r,n,i,o,s,a,c,l,u,d,h){this.is3d=e,this.viewFlags=t,this.bgColor=r,this.monoColor=n,this.hiliteSettings=i,this.aaLines=o,this.aaText=s,this.activeVolume=l,this.hline=u,this.lights=d,this._curFrustum=this.viewFrustum=a,this.terrainFrustum=c,this.analysisStyle=h}static createFromViewport(e){const t=e.view,r=t.displayStyle,n=r.is3d()?r.settings.hiddenLineSettings:void 0,i=t.getViewClip(),s=void 0!==i?a.IModelApp.renderSystem.getClipVolume(i,t.iModel):void 0,l=void 0===e.backgroundMapPlane?void 0:c.ViewFrustum.createFromViewportAndPlane(e,e.backgroundMapPlane),u=new RenderPlan(t.is3d(),r.viewFlags,t.backgroundColor,r.monochromeColor,e.hilite,e.wantAntiAliasLines,e.wantAntiAliasText,e.viewFrustum,l,s,n,void 0,t.displayStyle.settings.analysisStyle);return void 0!==u.analysisStyle&&void 0!==u.analysisStyle.scalarThematicSettings&&(u.analysisTexture=e.target.renderSystem.getGradientTexture(o.Gradient.Symb.createThematic(u.analysisStyle.scalarThematicSettings),e.iModel)),u}}t.RenderPlan=RenderPlan;t.RenderGraphic=class RenderGraphic{},function(e){e[e.None=0]="None",e[e.Mask=1]="Mask",e[e.Planes=2]="Planes"}(t.ClippingType||(t.ClippingType={}));t.RenderClipVolume=class RenderClipVolume{};t.Decorations=class Decorations{get skyBox(){return this._skyBox}set skyBox(e){n.dispose(this._skyBox),this._skyBox=e}get viewBackground(){return this._viewBackground}set viewBackground(e){n.dispose(this._viewBackground),this._viewBackground=e}get normal(){return this._normal}set normal(e){n.disposeArray(this._normal),this._normal=e}get world(){return this._world}set world(e){n.disposeArray(this._world),this._world=e}get worldOverlay(){return this._worldOverlay}set worldOverlay(e){n.disposeArray(this._worldOverlay),this._worldOverlay=e}get viewOverlay(){return this._viewOverlay}set viewOverlay(e){n.disposeArray(this._viewOverlay),this._viewOverlay=e}dispose(){this.skyBox=void 0,this.viewBackground=void 0,this.world=void 0,this.worldOverlay=void 0,this.viewOverlay=void 0,this.normal=void 0}};t.GraphicBranch=class GraphicBranch{constructor(e=!1){this.entries=[],this._viewFlagOverrides=new o.ViewFlag.Overrides,this.ownsEntries=e}add(e){this.entries.push(e)}getViewFlags(e,t){return this._viewFlagOverrides.apply(e.clone(t))}setViewFlags(e){this._viewFlagOverrides.overrideAll(e)}setViewFlagOverrides(e){this._viewFlagOverrides.copyFrom(e)}dispose(){this.clear()}get isEmpty(){return 0===this.entries.length}clear(){this.ownsEntries?n.disposeArray(this.entries):this.entries.length=0}},function(e){let t,r,n;e.Data=class Data{constructor(e,t=-1,r=0,n=0){this.elementId=e,this.distanceFraction=t,this.type=r,this.planarity=n}},function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.Surface=2]="Surface",e[e.Linear=3]="Linear",e[e.Edge=4]="Edge",e[e.Silhouette=5]="Silhouette"}(t=e.GeometryType||(e.GeometryType={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.Planar=2]="Planar",e[e.NonPlanar=3]="NonPlanar"}(r=e.Planarity||(e.Planarity={})),function(e){e[e.None=0]="None",e[e.ElementId=1]="ElementId",e[e.Distance=2]="Distance",e[e.Geometry=4]="Geometry",e[e.GeometryAndDistance=6]="GeometryAndDistance",e[e.All=7]="All"}(n=e.Selector||(e.Selector={}))}(t.Pixel||(t.Pixel={}));class PackedFeatureTable{constructor(e,t,r,n,i){switch(this._data=e,this.modelId=t,this.maxFeatures=n,this.numFeatures=r,this.type=i,this.numFeatures){case 0:this.anyDefined=!1;break;case 1:this.anyDefined=this.getFeature(0).isDefined;break;default:this.anyDefined=!0}this._data.length,this._subCategoriesOffset,this.maxFeatures,this.numFeatures}static pack(e){const t=new Map;for(const n of e.getArray()){void 0===t.get(n.value.subCategoryId.toString())&&t.set(n.value.subCategoryId,t.size)}const r=3*e.length,i=r+2*t.size,o=new Uint32Array(i);for(const s of e.getArray()){const e=s.value,r=3*s.index;let i=t.get(e.subCategoryId);i|=e.geometryClass<<24,o[r+0]=n.Id64.getLowerUint32(e.elementId),o[r+1]=n.Id64.getUpperUint32(e.elementId),o[r+2]=i}return t.forEach((e,t,i)=>{const s=r+2*e;o[s+0]=n.Id64.getLowerUint32(t),o[s+1]=n.Id64.getUpperUint32(t)}),new PackedFeatureTable(o,e.modelId,e.length,e.maxFeatures,e.type)}getFeature(e){this.numFeatures;const t=3*e,r=this.readId(t),n=this._data[t+2],i=n>>>24&255,s=(16777215&n)>>>0,a=this.readId(2*s+this._subCategoriesOffset);return new o.Feature(r,a,i)}findFeature(e){return e<this.numFeatures?this.getFeature(e):void 0}getElementIdParts(e){this.numFeatures;const t=3*e;return{low:this._data[t],high:this._data[t+1]}}findElementId(e){return e>=this.numFeatures?void 0:this.readId(3*e)}get isUniform(){return 1===this.numFeatures}get uniform(){return this.isUniform?this.getFeature(0):void 0}get isClassifier(){return 1===this.type}unpack(){const e=new o.FeatureTable(this.maxFeatures,this.modelId);for(let t=0;t<this.numFeatures;t++){const r=this.getFeature(t);e.insertWithIndex(r,t)}return e}get _subCategoriesOffset(){return 3*this.numFeatures}readId(e){return n.Id64.fromUint32Pair(this._data[e],this._data[e+1])}}t.PackedFeatureTable=PackedFeatureTable;t.RenderTarget=class RenderTarget{pickOverlayDecoration(e){}static get frustumDepth2d(){return 1}static get maxDisplayPriority(){return 8388576}static get minDisplayPriority(){return-this.maxDisplayPriority}static depthFromDisplayPriority(e){return(e-this.minDisplayPriority)/(this.maxDisplayPriority-this.minDisplayPriority)*this.frustumDepth2d}createGraphicBuilder(e,t,r=i.Transform.identity,n){return this.renderSystem.createGraphicBuilder(r,e,t,n)}};t.RenderSystem=class RenderSystem{get maxTextureSize(){return 0}findMaterial(e,t){}createMaterial(e,t){}createTriMesh(e){const t=u.MeshParams.create(e);return this.createMesh(t)}createIndexedPolylines(e){if(e.flags.isDisjoint){const t=u.PointStringParams.create(e);return void 0!==t?this.createPointString(t):void 0}{const t=u.PolylineParams.create(e);return void 0!==t?this.createPolyline(t):void 0}}createMesh(e){}createPolyline(e){}createPointString(e){}createPointCloud(e,t){}createSheetTilePolyfaces(e,t){return[]}createSheetTile(e,t,r){return[]}getClipVolume(e,t){}createTile(e,t){const r=new l.MeshArgs;r.points=new o.QPoint3dList(o.QParams3d.fromRange(i.Range3d.create(...t)));for(let n=0;n<4;++n)r.points.add(t[n]);return r.vertIndices=[0,1,2,2,1,3],r.textureUv=[new i.Point2d(0,0),new i.Point2d(1,0),new i.Point2d(0,1),new i.Point2d(1,1)],r.texture=e,r.isPlanar=!0,this.createTriMesh(r)}createSkyBox(e){}findTexture(e,t){}async loadTexture(e,t){let r=this.findTexture(e.toString(),t);if(void 0===r){const n=await this.loadTextureImage(e,t);void 0!==n&&(r=this.createTextureFromImage(n.image,2===n.format,t,new o.RenderTexture.Params(e.toString())))}return r}async loadTextureImage(e,t){const r=await t.elements.getProps(e);if(1!==r.length)return;const i=r[0];if(void 0===i.data||"string"!==typeof i.data||void 0===i.format||"number"!==typeof i.format)return;const a=i.format;if(!o.isValidImageSourceFormat(a))return;const c=new o.ImageSource(n.base64StringToUint8Array(i.data),a);return s.imageElementFromImageSource(c).then(e=>({image:e,format:a}))}getGradientTexture(e,t){}createTextureFromImageBuffer(e,t,r){}createTextureFromImage(e,t,r,n){}async createTextureFromImageSource(e,t,r){return s.imageElementFromImageSource(e).then(n=>a.IModelApp.hasRenderSystem?this.createTextureFromImage(n,2===e.format,t,r):void 0)}createTextureFromCubeImages(e,t,r,n,i,o,s,a){}onInitialized(){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(109),o=r(7);function s(e){e.addUniform("u_renderTargetIndex",1,e=>{e.addProgramUniform("u_renderTargetIndex",(e,t)=>{e.setUniform1i(t.target.compositor.currentRenderTargetIndex)})})}t.addWindowToTexCoords=function(e){e.addFunction("\nvec2 windowCoordsToTexCoords(vec2 wc) { return wc * u_invScreenSize; }\n"),e.addUniform("u_invScreenSize",3,e=>{e.addProgramUniform("u_invScreenSize",(e,t)=>{const r=t.target.viewRect,n=[1/r.width,1/r.height];e.setUniform2fv(n)})})},t.addWhiteOnWhiteReversal=function(e){e.addUniform("u_reverseWhiteOnWhite",2,e=>{e.addGraphicUniform("u_reverseWhiteOnWhite",(e,t)=>{const r=t.target.bgColor.clone();r.setAlpha(255);const i=r.equals(n.ColorDef.white)&&t.geometry.wantWoWReversal(t.programParams)?1:0;e.setUniform1f(i)})}),e.set(9,a)},t.addRenderTargetIndex=s;const a="\n  if (u_reverseWhiteOnWhite > 0.5) {\n    // Account for erroneous interpolation from varying vec3(1.0)...\n    const vec3 white = vec3(1.0);\n    const vec3 epsilon = vec3(0.0001);\n    vec3 color = baseColor.a > 0.0 ? baseColor.rgb / baseColor.a : baseColor.rgb; // revert premultiplied alpha\n    vec3 delta = (color + epsilon) - white;\n    if (delta.x > 0.0 && delta.y > 0.0 && delta.z > 0.0)\n      baseColor.rgb = vec3(0.0);\n  }\n  return baseColor;\n",c="\n  float linearDepth = computeLinearDepth(v_eyeSpace.z);\n  vec4 output0 = baseColor;\n  vec4 output1 = v_element_id0;\n  vec4 output2 = v_element_id1;\n  vec4 output3 = vec4(u_renderOrder * 0.0625, encodeDepthRgb(linearDepth)); // near=1, far=0\n",l=c+"\n  FragColor0 = output0;\n  FragColor1 = output1;\n  FragColor2 = output2;\n  FragColor3 = output3;\n",u=c+"\n  if (0 == u_renderTargetIndex)\n    FragColor = output0;\n  else if (1 == u_renderTargetIndex)\n    FragColor = output1;\n  else if (2 == u_renderTargetIndex)\n    FragColor = output2;\n  else\n    FragColor = output3;\n";var d;t.addPickBufferOutputs=function(e){e.addFunction(i.GLSLDecode.encodeDepthRgb),e.addFunction(d.computeLinearDepth),o.System.instance.capabilities.supportsMRTPickShaders?(e.addDrawBuffersExtension(),e.set(13,l)):(s(e),e.set(13,u))},function(e){e.assignFragColor="FragColor = baseColor;",e.assignFragColorNoAlpha="FragColor = vec4(baseColor.rgb, 1.0);",e.revertPreMultipliedAlpha="\nvec4 revertPreMultipliedAlpha(vec4 rgba) {\n  if (0.0 < rgba.a)\n    rgba.rgb /= rgba.a;\n  return rgba;\n}\n",e.applyPreMultipliedAlpha="\nvec4 applyPreMultipliedAlpha(vec4 rgba) {\n  rgba.rgb *= rgba.a;\n  return rgba;\n}\n",e.adjustPreMultipliedAlpha="\nvec4 adjustPreMultipliedAlpha(vec4 rgba, float newAlpha) {\n  float oldAlpha = rgba.a;\n  if (0.0 < oldAlpha)\n    rgba.rgb /= oldAlpha;\n\n  rgba.rgb *= newAlpha;\n  rgba.a = newAlpha;\n  return rgba;\n}\n",e.computeLinearDepth="\nfloat computeLinearDepth(float eyeSpaceZ) {\n  float eyeZ = -eyeSpaceZ;\n  float near = u_frustum.x, far = u_frustum.y;\n  float depthRange = far - near;\n  float linearDepth = (eyeZ - near) / depthRange;\n  return 1.0 - linearDepth;\n}\n"}(d=t.GLSLFragment||(t.GLSLFragment={}))},function(e,t,r){"use strict";e.exports=function(e,t,r,n,i,o,s,a){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,n,i,o,s,a],u=0;(c=new Error(t.replace(/%s/g,function(){return l[u++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(406),i=r(70),o=r(412),s=r(0),a=r(56);t.loggingCategory="imodeljs-clients.Request",t.loggingCategoryFullUrl="imodeljs-clients.Url",t.requestIdHeaderName="X-Correlation-Id";class ResponseError extends s.BentleyError{constructor(e,t,r){super(e,t,void 0,void 0,r)}static parse(e,t=!0){const r=new ResponseError(ResponseError.parseHttpStatus(e.status/100));return e?(e.response&&(e.response.error&&(r.name=e.response.error.name||r.name,r.description=e.response.error.message),e.response.res&&(r.message=e.response.res.statusMessage),e.response.body&&Object.keys(e.response.body).length>0?(r._data={},i(r._data,e.response.body)):r._data=e.response.text),r.status=e.status||e.statusCode,r.name=e.code||e.name||r.name,r.message=r.message||e.message||e.statusMessage,t&&r.log(),r):(r.message="Couldn't get response object.",r)}static shouldRetry(e,t){return!(void 0===e||null===e||void 0!==e.status&&null!==e.status||void 0!==e.res&&null!==e.res)||void 0!==t&&94212===t.statusType}static parseHttpStatus(e){switch(e){case 1:return 94209;case 2:return 0;case 3:return 94210;case 4:return 94211;case 5:return 94212;default:return 0}}logMessage(){return`${this.status} ${this.name}: ${this.message}`}log(){s.Logger.logError(t.loggingCategory,this.logMessage(),this.getMetaData())}}async function c(e,r,i){e.enter();let c="";c=!0===i.useCorsProxy?""===(c=a.Config.App.get("imjs_dev_cors_proxy_server",""))?r:c.replace(/\/$/,"")+"/"+r:r;const l="undefined"===typeof i.retries?4:i.retries;let u=n(i.method,c).retry(l,i.retryCallback);i.headers&&(u=u.set(i.headers)),""!==e.activityId&&u.set(t.requestIdHeaderName,e.activityId);let d="",h="";if(i.qs&&Object.keys(i.qs).length>0){const e={delimiter:"&",encode:!1};d=o.stringify(i.qs,e),u=u.query(d),h=r+"?"+d}else h=r;s.Logger.logInfo(t.loggingCategoryFullUrl,h),i.auth&&(u=u.auth(i.auth.user,i.auth.password)),i.accept&&(u=u.accept(i.accept)),i.body&&(u=u.send(i.body)),u=i.timeout?u.timeout(i.timeout):u.timeout(1e4),i.responseType&&(u=u.responseType(i.responseType)),u=i.redirects?u.redirects(i.redirects):u.redirects(0),i.buffer&&u.buffer(i.buffer),i.parser&&u.parse(i.parser),i.agent&&u.agent(i.agent),i.progressCallback&&u.on("progress",e=>{e&&i.progressCallback({loaded:e.loaded,total:e.total,percent:e.percent})});const p=i.errorCallback?i.errorCallback:ResponseError.parse;if(i.readStream){if("undefined"!==typeof window)throw new Error("This option is not supported on browsers");return new Promise((e,t)=>{u=u.type("blob"),i.readStream.pipe(u).on("error",e=>{const r=p(e);t(r)}).on("end",()=>{e({status:201,header:void 0,body:void 0})})})}if(i.stream){if("undefined"!==typeof window)throw new Error("This option is not supported on browsers");return new Promise((e,t)=>{u.on("response",e=>{if(200===e.statusCode);else{const r=p(e);t(r)}}).pipe(i.stream).on("error",e=>{const r=p(e);t(r)}).on("finish",()=>{e({status:200,header:void 0,body:void 0})})})}return u.then(e=>{const t={body:e.body,header:e.header,status:e.status};return Promise.resolve(t)}).catch(e=>{const t=p(e);return Promise.reject(t)})}t.ResponseError=ResponseError,t.request=c,t.getArrayBuffer=async function(e,t){return(await c(e,t,{method:"GET",responseType:"arraybuffer"})).body},t.getJson=async function(e,t){return(await c(e,t,{method:"GET",responseType:"json"})).body}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(8),o=r(4),s=r(291);var a;!function(e){e[e.Data=0]="Data",e[e.Reset=1]="Reset",e[e.Middle=2]="Middle"}(t.BeButton||(t.BeButton={})),function(e){e[e.Unknown=0]="Unknown",e[e.Mouse=1]="Mouse",e[e.Touch=2]="Touch"}(t.InputSource||(t.InputSource={})),function(e){e[e.User=0]="User",e[e.Precision=1]="Precision",e[e.TentativePoint=2]="TentativePoint",e[e.ElemSnap=3]="ElemSnap"}(t.CoordSource||(t.CoordSource={})),function(e){e[e.None=0]="None",e[e.Control=1]="Control",e[e.Shift=2]="Shift",e[e.Alt=4]="Alt"}(t.BeModifierKeys||(t.BeModifierKeys={}));t.BeButtonState=class BeButtonState{constructor(){this._downUorPt=new n.Point3d,this._downRawPt=new n.Point3d,this.downTime=0,this.isDown=!1,this.isDoubleClick=!1,this.isDragging=!1,this.inputSource=0}get downRawPt(){return this._downRawPt}set downRawPt(e){this._downRawPt.setFrom(e)}get downUorPt(){return this._downUorPt}set downUorPt(e){this._downUorPt.setFrom(e)}init(e,t,r,n,i,o,s){this.downUorPt=e,this.downRawPt=t,this.downTime=r,this.isDown=n,this.isDoubleClick=i,this.isDragging=o,this.inputSource=s}};class BeButtonEvent{constructor(){this._point=new n.Point3d,this._rawPoint=new n.Point3d,this._viewPoint=new n.Point3d,this.coordsFrom=0,this.keyModifiers=0,this.isDown=!1,this.isDoubleClick=!1,this.isDragging=!1,this.button=0,this.inputSource=0}get isValid(){return void 0!==this.viewport}get point(){return this._point}set point(e){this._point.setFrom(e)}get rawPoint(){return this._rawPoint}set rawPoint(e){this._rawPoint.setFrom(e)}get viewPoint(){return this._viewPoint}set viewPoint(e){this._viewPoint.setFrom(e)}invalidate(){this.viewport=void 0}initEvent(e,t,r,n,i,o=0,s=0,a=!0,c=!1,l=!1,u=0){this.point=e,this.rawPoint=t,this.viewPoint=r,this.viewport=n,this.coordsFrom=i,this.keyModifiers=o,this.isDown=a,this.isDoubleClick=c,this.isDragging=l,this.button=s,this.inputSource=u}getDisplayPoint(){return new n.Point2d(this._viewPoint.x,this._viewPoint.y)}get isControlKey(){return 0!==(1&this.keyModifiers)}get isShiftKey(){return 0!==(2&this.keyModifiers)}get isAltKey(){return 0!==(4&this.keyModifiers)}setFrom(e){this.point=e.point,this.rawPoint=e.rawPoint,this.viewPoint=e.viewPoint,this.viewport=e.viewport,this.coordsFrom=e.coordsFrom,this.keyModifiers=e.keyModifiers,this.isDown=e.isDown,this.isDoubleClick=e.isDoubleClick,this.isDragging=e.isDragging,this.button=e.button,this.inputSource=e.inputSource}clone(e){return(e=e||new BeButtonEvent).setFrom(this),e}}t.BeButtonEvent=BeButtonEvent;class BeTouchEvent extends BeButtonEvent{constructor(e){super(),this.touchInfo=e,this.tapCount=0}get touchCount(){return this.touchInfo.targetTouches.length}get isSingleTouch(){return 1===this.touchCount}get isTwoFingerTouch(){return 2===this.touchCount}get isSingleTap(){return 1===this.tapCount&&1===this.touchCount}get isDoubleTap(){return 2===this.tapCount&&1===this.touchCount}get isTwoFingerTap(){return 1===this.tapCount&&2===this.touchCount}setFrom(e){super.setFrom(e),this.touchInfo=e.touchInfo,this.tapCount=e.tapCount}clone(e){return(e=e||new BeTouchEvent(this.touchInfo)).setFrom(this),e}static getTouchPosition(e,t){const r=t.getClientRect();return n.Point2d.createFrom({x:e.clientX-r.left,y:e.clientY-r.top})}static getTouchListCentroid(e,t){switch(e.length){case 0:return;case 1:return this.getTouchPosition(e[0],t);case 2:return this.getTouchPosition(e[0],t).interpolate(.5,this.getTouchPosition(e[1],t));default:{const r=[];for(let n=0;n<e.length;n++)r.push(this.getTouchPosition(e[n],t));const i=n.Point2d.createZero();return n.PolygonOps.centroidAndArea(r,i),i}}}static findTouchById(e,t){for(let r=0;r<e.length;r++)if(t===e[r].identifier)return e[r]}}t.BeTouchEvent=BeTouchEvent;class BeWheelEvent extends BeButtonEvent{constructor(e=0){super(),this.wheelDelta=e}setFrom(e){super.setFrom(e),this.wheelDelta=e.wheelDelta}clone(e){return(e=e||new BeWheelEvent).setFrom(this),e}}t.BeWheelEvent=BeWheelEvent;class Tool{constructor(...e){}static get _localizeBase(){return this.namespace.name+":tools."+this.toolId}static get _keyinKey(){return this._localizeBase+".keyin"}static get _flyoverKey(){return this._localizeBase+".flyover"}static get _descriptionKey(){return this._localizeBase+".description"}static register(e){i.IModelApp.tools.register(this,e)}static get keyin(){return this._keyin?this._keyin:this._keyin=i.IModelApp.i18n.translate(this._keyinKey)}static get flyover(){return this._flyover?this._flyover:this._flyover=i.IModelApp.i18n.translate([this._flyoverKey,this._keyinKey])}static get description(){return this._description?this._description:this._description=i.IModelApp.i18n.translate([this._descriptionKey,this._flyoverKey,this._keyinKey])}get toolId(){return this.constructor.toolId}get keyin(){return this.constructor.keyin}get flyover(){return this.constructor.flyover}get description(){return this.constructor.description}run(...e){return!0}}Tool.hidden=!1,Tool.toolId="",t.Tool=Tool,function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(a=t.EventHandled||(t.EventHandled={}));class InteractiveTool extends Tool{constructor(){super(...arguments),this.receivedDownEvent=!1}onInstall(){return!0}onPostInstall(){}onReinitialize(){}onCleanup(){}onSuspend(){}onUnsuspend(){}testDecorationHit(e){return!1}getDecorationGeometry(e){}decorate(e){}decorateSuspended(e){}async onResetButtonDown(e){return a.No}async onResetButtonUp(e){return a.No}async onDataButtonDown(e){return a.No}async onDataButtonUp(e){return a.No}async onMiddleButtonDown(e){return a.No}async onMiddleButtonUp(e){return a.No}async onMouseMotion(e){}async onMouseNoMotion(e){}async onMouseMotionStopped(e){}async onMouseStartDrag(e){return a.No}async onMouseEndDrag(e){if(0!==e.button)return a.No;if(e.isDown)return this.onDataButtonDown(e);const t=e.clone();return t.isDown=!0,this.onDataButtonDown(t)}async onMouseWheel(e){return a.No}async onModifierKeyTransition(e,t,r){return a.No}async onKeyTransition(e,t){return a.No}async onTouchStart(e){}async onTouchEnd(e){}async onTouchComplete(e){}async onTouchCancel(e){}async onTouchMove(e){}async onTouchMoveStart(e,t){return a.No}async onTouchTap(e){return a.No}isCompatibleViewport(e,t){return!0}isValidLocation(e,t){return!0}onSelectedViewportChanged(e,t){}async getToolTip(e){return e.getToolTip()}getCurrentButtonEvent(e){i.IModelApp.toolAdmin.fillEventFromCursorLocation(e)}get isDynamicsStarted(){return i.IModelApp.viewManager.inDynamicsMode}beginDynamics(){i.IModelApp.toolAdmin.beginDynamics()}endDynamics(){i.IModelApp.toolAdmin.endDynamics()}onDynamicFrame(e,t){}async filterHit(e,t){return 0}changeLocateState(e,t,r,n){void 0!==r?(i.IModelApp.toolAdmin.setCursor(r),i.IModelApp.toolAdmin.setLocateCircleOn(e),i.IModelApp.viewManager.invalidateDecorationsAllViews()):i.IModelApp.toolAdmin.setLocateCursor(e),i.IModelApp.accuSnap.enableLocate(e),void 0!==t?i.IModelApp.accuSnap.enableSnap(t):i.IModelApp.accuSnap.enableSnap(!1),void 0!==n?i.IModelApp.toolAdmin.toolState.coordLockOvr=n:e&&!i.IModelApp.accuSnap.isSnapEnabled?i.IModelApp.toolAdmin.toolState.coordLockOvr|=2:i.IModelApp.toolAdmin.toolState.coordLockOvr&=-3}initLocateElements(e=!0,t,r,n){i.IModelApp.locateManager.initToolLocate(),this.changeLocateState(e,t,r,n)}}t.InteractiveTool=InteractiveTool;t.InputCollector=class InputCollector extends InteractiveTool{run(){const e=i.IModelApp.toolAdmin;return!(void 0!==e.viewTool||!e.onInstallTool(this))&&(e.startInputCollector(this),e.onPostInstallTool(this),!0)}exitTool(){i.IModelApp.toolAdmin.exitInputCollector()}async onResetButtonUp(e){return this.exitTool(),a.Yes}};t.ToolRegistry=class ToolRegistry{constructor(){this.tools=new Map}unRegister(e){this.tools.delete(e),this._keyinList=void 0}register(e,t){if(t&&(e.namespace=t),0!==e.toolId.length){if(!e.namespace)throw new o.IModelError(-1,"Tools must have a namespace");this.tools.set(e.toolId,e),this._keyinList=void 0}}registerModule(e,t){for(const r in e){if(!r)continue;const n=e[r];n.prototype instanceof Tool&&this.register(n,t)}}find(e){return this.tools.get(e)}create(e,...t){const r=this.find(e);return r?new r(...t):void 0}run(e,...t){const r=this.create(e,...t);return void 0!==r&&r.run(...t)}getToolList(){return void 0===this._keyinList&&(this._keyinList=[],this.tools.forEach(e=>{e.hidden||this._keyinList.push(e)})),this._keyinList}findPartialMatches(e){return(new s.FuzzySearch).search(this.getToolList(),["keyin"],e)}executeExactMatch(e,...t){const r=this.findExactMatch(e);return!!r&&new r(...t).run(...t)}findExactMatch(e){return this.getToolList().find(t=>t.keyin===e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(137),i=r(34),o=r(109),s=r(314),a=r(185),c=r(4),l="\n  g_vertexLUTIndex = decodeUInt32(a_pos);\n  g_vertexBaseCoords = compute_vert_coords(g_vertexLUTIndex);\n",u="\nvec4 unquantizePosition(vec3 pos, vec3 origin, vec3 scale) { return vec4(origin + scale * pos, 1.0); }\n",d="\nvec4 unquantizeVertexPosition(vec3 pos, vec3 origin, vec3 scale) { return unquantizePosition(pos, origin, scale); }\n",h="\nvec4 unquantizeVertexPosition(vec3 encodedIndex, vec3 origin, vec3 scale) {\n  // Need to read 2 rgba values to obtain 6 16-bit integers for position\n  vec2 tc = g_vertexBaseCoords;\n  vec4 enc1 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  tc.x += g_vert_stepX;\n  vec4 enc2 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  tc.x += g_vert_stepX;\n  g_featureIndexCoords = tc;\n\n  vec3 qpos = vec3(decodeUInt16(enc1.xy), decodeUInt16(enc1.zw), decodeUInt16(enc2.xy));\n\n  // Might as well decode the color index since we already read it...may not end up being used.\n  // (NOTE = If this is a textured mesh, the normal is stored where the color index would otherwise be...)\n  g_vertexData2 = enc2.zw;\n\n  return unquantizePosition(qpos, origin, scale);\n}\n",p="\nvec3 computeAnimationFrameDisplacement(float vertexLUTIndex, float frameIndex, vec3 origin, vec3 scale) {\n  vec2 tc = computeLUTCoords(frameIndex + g_vertexLUTIndex * 2.0, u_vertParams.xy, g_vert_center, 1.0);\n  vec4 enc1 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  tc.x += g_vert_stepX;\n  vec4 enc2 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  vec3 qpos = vec3(decodeUInt16(enc1.xy), decodeUInt16(enc1.zw), decodeUInt16(enc2.xy));\n  return unquantizePosition(qpos, origin, scale).xyz;\n}",f="\nvec3 computeAnimationDisplacement(float vertexLUTIndex, float frameIndex0, float frameIndex1, float fraction, vec3 origin, vec3 scale) {\nif (frameIndex0 < 0.0)\n  return vec3(0.0, 0.0, 0.0);\nvec3 displacement = computeAnimationFrameDisplacement(vertexLUTIndex, frameIndex0, origin, scale);\nif (fraction > 0.0) {\n  vec3 displacement1 = computeAnimationFrameDisplacement(vertexLUTIndex, frameIndex1, origin, scale);\n  displacement += fraction * (displacement1 - displacement);\n  }\nreturn displacement;\n}",g="\nvec3 computeAnimationFrameNormal(float frameIndex) {\n  float vertexIndex = floor(g_vertexLUTIndex/2.0);\n  vec2 tc = computeLUTCoords(frameIndex + vertexIndex, u_vertParams.xy, g_vert_center, 1.0);\n  vec4 enc = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  vec2 param = (vertexIndex * 2.0 == g_vertexLUTIndex) ? enc.xy : enc.zw;\n  return octDecodeNormal(param);\n}",m="\nvec3 computeAnimationNormal(float frameIndex0, float frameIndex1, float fraction) {\nvec3 normal = computeAnimationFrameNormal(frameIndex0);\nif (fraction > 0.0) {\n  vec3 normal1 = computeAnimationFrameNormal(frameIndex1);\n  normal += fraction * (normal1 - normal);\n  }\nreturn normal;\n}",y="\nfloat computeAnimationFrameParam(float frameIndex, float origin, float scale) {\n  float vertexIndex = floor(g_vertexLUTIndex/2.0);\n  vec2 tc = computeLUTCoords(frameIndex + vertexIndex, u_vertParams.xy, g_vert_center, 1.0);\n  vec4 enc = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  vec2 param = (vertexIndex * 2.0 == g_vertexLUTIndex) ? enc.xy : enc.zw;\n  return clamp((origin + scale * decodeUInt16(param)), 0.0, 1.0);\n}",v="\nvec2 computeAnimationParam(float frameIndex0, float frameIndex1, float fraction, float origin, float scale) {\nfloat param = computeAnimationFrameParam(frameIndex0, origin, scale);\nif (fraction > 0.0) {\n  float param1 = computeAnimationFrameParam(frameIndex1, origin, scale);\n  param += fraction * (param1 - param);\n  }\nreturn vec2(.5, param);\n}",_=new n.Matrix4;t.addModelViewProjectionMatrix=function(e){e.addUniform("u_mvp",7,e=>{e.addGraphicUniform("u_mvp",(e,t)=>{const r=t.projectionMatrix.clone(_);r.multiplyBy(t.modelViewMatrix),e.setMatrix4(r)})})},t.addProjectionMatrix=function(e){e.addUniform("u_proj",7,e=>{e.addProgramUniform("u_proj",(e,t)=>{e.setMatrix4(t.projectionMatrix)})})},t.addModelViewMatrix=function(e){e.addUniform("u_mv",7,e=>{e.addGraphicUniform("u_mv",(e,t)=>{e.setMatrix4(t.modelViewMatrix)})})},t.addNormalMatrix=function(e){e.addUniform("u_nmx",6,e=>{e.addGraphicUniform("u_nmx",(e,t)=>{const r=t.modelViewMatrix.getRotation();void 0!==r&&e.setMatrix3(r)})})};const w=new Float32Array(3),S=new Float32Array(3),b=new Float32Array(3),x=new Float32Array(2);function P(e,t,r,n){const i=n*t[t.length-1];for(let o=0;o<t.length-1;o++)if(i>=t[o]&&i<t[o+1])return e[0]=r[o],e[1]=r[o+1],void(e[2]=i-t[o]/(t[o+1]-t[o]));e[0]=e[1]=r[t.length-1],e[2]=0}t.addAnimation=function(e,t,r){w[0]=w[1]=w[2]=-1,e.addFunction(p),e.addFunction(f),r&&(e.addFunction(a.octDecodeNormal),e.addFunction(g),e.addFunction(m)),t&&(e.addFunction(y),e.addFunction(v)),e.addUniform("u_animDispParams",4,e=>{e.addGraphicUniform("u_animDispParams",(e,t)=>{w[0]=w[1]=w[2]=0;const r=t.geometry,n=t.target.analysisStyle;let i;r.lut.auxDisplacements&&n&&n.displacementChannelName&&void 0!==(i=r.lut.auxDisplacements.get(n.displacementChannelName))&&P(w,i.inputs,i.indices,t.target.animationFraction),e.setUniform3fv(w)})}),e.addUniform("u_qAnimDispScale",4,e=>{e.addGraphicUniform("u_qAnimDispScale",(e,t)=>{const r=t.geometry,n=t.target.analysisStyle;let i;if(w[0]=w[1]=w[2]=0,r.lut.auxDisplacements&&n&&n.displacementChannelName&&void 0!==(i=r.lut.auxDisplacements.get(n.displacementChannelName))){const e=n.displacementScale?n.displacementScale:1;for(let t=0;t<3;t++)w[t]=i.qScale[t]*e}e.setUniform3fv(w)})}),e.addUniform("u_qAnimDispOrigin",4,e=>{e.addGraphicUniform("u_qAnimDispOrigin",(e,t)=>{const r=t.geometry,n=t.target.analysisStyle;let i;if(w[0]=w[1]=w[2]=0,r.lut.auxDisplacements&&n&&n.displacementChannelName&&void 0!==(i=r.lut.auxDisplacements.get(n.displacementChannelName))){const e=n.displacementScale?n.displacementScale:1;for(let t=0;t<3;t++)w[t]=i.qOrigin[t]*e}e.setUniform3fv(w)})}),r&&e.addUniform("u_animNormalParams",4,e=>{e.addGraphicUniform("u_animNormalParams",(e,t)=>{b[0]=b[1]=b[2]=-1;const r=t.geometry,n=t.target.analysisStyle;let i;r.lut.auxNormals&&n&&n.normalChannelName&&void 0!==(i=r.lut.auxNormals.get(n.normalChannelName))&&P(b,i.inputs,i.indices,t.target.animationFraction),e.setUniform3fv(b)})}),t&&(e.addUniform("u_animScalarParams",4,e=>{e.addGraphicUniform("u_animScalarParams",(e,t)=>{const r=t.geometry,n=t.target.analysisStyle;let i;S[0]=S[1]=S[2]=-1,void 0!==r.lut.auxParams&&void 0!==n&&void 0!==n.scalarChannelName&&void 0!==(i=r.lut.auxParams.get(n.scalarChannelName))&&P(S,i.inputs,i.indices,t.target.animationFraction),e.setUniform3fv(S)})}),e.addUniform("u_animScalarQParams",3,e=>{e.addGraphicUniform("u_animScalarQParams",(e,t)=>{const r=t.geometry,n=t.target.analysisStyle;let i;if(x[0]=x[1]=-1,r.lut.auxParams&&n&&n.scalarChannelName&&n.scalarRange&&void 0!==(i=r.lut.auxParams.get(n.scalarChannelName))){const e=n.scalarRange.high-n.scalarRange.low;x[0]=c.Gradient.ThematicSettings.margin+(i.qOrigin-n.scalarRange.low)/e,x[1]=c.Gradient.ThematicSettings.contentRange*i.qScale/e}e.setUniform2fv(x)})}))};const C=new Float32Array(4);t.addPosition=function(e,t){e.addFunction(u),e.addAttribute("a_pos",4,e=>{e.addAttribute("a_pos",(e,t)=>{t.geometry.bindVertexArray(e)})}),e.addUniform("u_qScale",4,e=>{e.addGraphicUniform("u_qScale",(e,t)=>{e.setUniform3fv(t.geometry.qScale)})}),e.addUniform("u_qOrigin",4,e=>{e.addGraphicUniform("u_qOrigin",(e,t)=>{e.setUniform3fv(t.geometry.qOrigin)})}),t?function(e){e.addGlobal("g_vertexLUTIndex",2),e.addGlobal("g_vertexBaseCoords",3),e.addGlobal("g_vertexData2",3),e.addGlobal("g_featureIndexCoords",3),e.addFunction(o.GLSLDecode.uint32),e.addFunction(o.GLSLDecode.uint16),e.addFunction(h),e.addUniform("u_vertLUT",8,e=>{e.addGraphicUniform("u_vertLUT",(e,t)=>{t.geometry.lut.texture.bindSampler(e,i.TextureUnit.VertexLUT)})}),e.addUniform("u_vertParams",5,e=>{e.addGraphicUniform("u_vertParams",(e,t)=>{const r=t.geometry.lut,n=C;n[0]=r.texture.width,n[1]=r.texture.height,n[2]=r.numRgbaPerVertex,n[3]=r.numVertices,e.setUniform4fv(n)})}),s.addLookupTable(e,"vert","u_vertParams.z"),e.addInitializer(l)}(e):e.addFunction(d)},t.addAlpha=function(e){e.addUniform("u_hasAlpha",2,e=>{e.addGraphicUniform("u_hasAlpha",(e,t)=>{e.setUniform1f(5===t.geometry.getRenderPass(t.target)?1:0)})})},function(e){const t="\n{\n  gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\n  return;\n}\n";e.earlyDiscard="  if (checkForEarlyDiscard(rawPosition))"+t,e.discard="  if (checkForDiscard())"+t,e.lateDiscard="  if (checkForLateDiscard())"+t,e.computeLineWeight="\nfloat ComputeLineWeight() { return u_lineWeight; }\n",e.computeLineCode="\nfloat ComputeLineCode() { return u_lineCode; }\n"}(t.GLSLVertex||(t.GLSLVertex={}))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});var i=r(189);t.UiCore=i.default,n(r(578)),n(r(581)),n(r(588)),n(r(665)),n(r(673)),n(r(675)),n(r(678)),n(r(680)),n(r(683)),n(r(687)),n(r(690)),n(r(693)),n(r(696)),n(r(699)),n(r(702)),n(r(705)),n(r(713)),n(r(715))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(50),i=r(252),o=r(38),s=r(51),a=r(14);class GapSearchContext extends i.RecursiveCurveProcessorWithStack{constructor(){super(),this.maxGap=0}static maxGap(e){const t=new GapSearchContext;return e.announceToCurveProcessor(t),t.maxGap}announceCurvePrimitive(e,t){if(this._stack.length>0){const r=this._stack[this._stack.length-1];if(r instanceof CurveChain){const n=r.cyclicCurvePrimitive(t+1);void 0!==e&&void 0!==n&&(this.maxGap=Math.max(this.maxGap,e.endPoint().distance(n.startPoint())))}}}}class CountLinearPartsSearchContext extends i.RecursiveCurveProcessorWithStack{constructor(){super(),this.numLineSegment=0,this.numLineString=0,this.numOther=0}static hasNonLinearPrimitives(e){const t=new CountLinearPartsSearchContext;return e.announceToCurveProcessor(t),t.numOther>0}announceCurvePrimitive(e,t){e instanceof s.LineSegment3d?this.numLineSegment++:e instanceof a.LineString3d?this.numLineString++:this.numOther++}}class TransformInPlaceContext extends i.RecursiveCurveProcessor{constructor(e){super(),this.numFail=0,this.numOK=0,this.transform=e}static tryTransformInPlace(e,t){const r=new TransformInPlaceContext(t);return e.announceToCurveProcessor(r),0===r.numFail}announceCurvePrimitive(e,t){e.tryTransformInPlace(this.transform)?this.numOK++:this.numFail++}}class SumLengthsContext extends i.RecursiveCurveProcessor{constructor(){super(),this._sum=0}static sumLengths(e){const t=new SumLengthsContext;return e.announceToCurveProcessor(t),t._sum}announceCurvePrimitive(e,t){this._sum+=e.curveLength()}}class CloneCurvesContext extends i.RecursiveCurveProcessorWithStack{constructor(e){super(),this._transform=e,this._result=void 0}static clone(e,t){const r=new CloneCurvesContext(t);return e.announceToCurveProcessor(r),r._result}enter(e){e instanceof CurveCollection&&super.enter(e.cloneEmptyPeer())}leave(){const e=super.leave();return e&&(0===this._stack.length?this._result=e:this._stack[this._stack.length-1].tryAddChild(e)),e}doClone(e){return this._transform?e.cloneTransformed(this._transform):e.clone()}announceCurvePrimitive(e,t){const r=this.doClone(e);if(r&&this._stack.length>0){const e=this._stack[this._stack.length-1];e instanceof CurveChain?e.tryAddChild(r):e instanceof BagOfCurves&&e.tryAddChild(r)}}}class CurveCollection extends n.GeometryQuery{constructor(){super(...arguments),this.isInner=!1}sumLengths(){return SumLengthsContext.sumLengths(this)}maxGap(){return GapSearchContext.maxGap(this)}checkForNonLinearPrimitives(){return CountLinearPartsSearchContext.hasNonLinearPrimitives(this)}tryTransformInPlace(e){return TransformInPlaceContext.tryTransformInPlace(this,e)}clone(){return CloneCurvesContext.clone(this)}cloneTransformed(e){return CloneCurvesContext.clone(this,e)}get isAnyRegionType(){return 2===this.dgnBoundaryType()||5===this.dgnBoundaryType()||4===this.dgnBoundaryType()}get isOpenPath(){return 1===this.dgnBoundaryType()}get isClosedPath(){return 2===this.dgnBoundaryType()}extendRange(e,t){const r=this.children;if(r)for(const n of r)n.extendRange(e,t)}}t.CurveCollection=CurveCollection;class CurveChain extends CurveCollection{constructor(){super(),this._curves=[]}get children(){return void 0===this._curves&&(this._curves=[]),this._curves}getPackedStrokes(e){const t=this.cloneStroked(e);if(t instanceof CurveChain){const e=t.children;if(1===e.length){const t=e[0];if(t instanceof a.LineString3d)return t.packedPoints}}}cloneStroked(e){const t=a.LineString3d.create();for(const r of this.children)r.emitStrokes(t,e);return t}tryAddChild(e){return e instanceof o.CurvePrimitive&&(this._curves.push(e),!0)}getChild(e){if(e<this._curves.length)return this._curves[e]}extendRange(e,t){for(const r of this._curves)r.extendRange(e,t)}reverseChildrenInPlace(){for(const e of this._curves)e.reverseInPlace();this._curves.reverse()}}t.CurveChain=CurveChain;class BagOfCurves extends CurveCollection{isSameGeometryClass(e){return e instanceof BagOfCurves}constructor(){super(),this._children=[]}get children(){return this._children}static create(...e){const t=new BagOfCurves;for(const r of e)t.tryAddChild(r);return t}dgnBoundaryType(){return 0}announceToCurveProcessor(e,t=-1){return e.announceBagOfCurves(this,t)}cloneStroked(e){const t=new BagOfCurves;let r;for(r of this.children)if(r instanceof o.CurvePrimitive){const n=a.LineString3d.create();r.emitStrokes(n,e),n&&t.children.push(n)}else if(r instanceof CurveCollection){const n=r.cloneStroked(e);n&&t.children.push(n)}return t}cloneEmptyPeer(){return new BagOfCurves}tryAddChild(e){return this._children.push(e),!0}getChild(e){if(e<this._children.length)return this._children[e]}dispatchToGeometryHandler(e){return e.handleBagOfCurves(this)}}t.BagOfCurves=BagOfCurves},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=255]="None",e[e.Background=0]="Background",e[e.OpaqueLinear=1]="OpaqueLinear",e[e.OpaquePlanar=2]="OpaquePlanar",e[e.OpaqueGeneral=3]="OpaqueGeneral",e[e.Classification=4]="Classification",e[e.Translucent=5]="Translucent",e[e.HiddenEdge=6]="HiddenEdge",e[e.Hilite=7]="Hilite",e[e.WorldOverlay=8]="WorldOverlay",e[e.ViewOverlay=9]="ViewOverlay",e[e.SkyBox=10]="SkyBox",e[e.Terrain=11]="Terrain",e[e.HiliteClassification=12]="HiliteClassification",e[e.ClassificationByIndex=13]="ClassificationByIndex",e[e.COUNT=14]="COUNT"}(t.RenderPass||(t.RenderPass={})),function(e){e[e.IndexedTriangles=0]="IndexedTriangles",e[e.IndexedPoints=1]="IndexedPoints",e[e.ArrayedPoints=2]="ArrayedPoints"}(t.GeometryType||(t.GeometryType={})),function(e){e[e.Zero=WebGLRenderingContext.TEXTURE0]="Zero",e[e.One=WebGLRenderingContext.TEXTURE1]="One",e[e.Two=WebGLRenderingContext.TEXTURE2]="Two",e[e.Three=WebGLRenderingContext.TEXTURE3]="Three",e[e.Four=WebGLRenderingContext.TEXTURE4]="Four",e[e.Five=WebGLRenderingContext.TEXTURE5]="Five",e[e.Six=WebGLRenderingContext.TEXTURE6]="Six",e[e.Seven=WebGLRenderingContext.TEXTURE7]="Seven",e[e.ClipVolume=e.Zero]="ClipVolume",e[e.FeatureSymbology=e.One]="FeatureSymbology",e[e.SurfaceTexture=e.Two]="SurfaceTexture",e[e.LineCode=e.Two]="LineCode",e[e.ElementId=e.Three]="ElementId",e[e.PickElementId0=e.Four]="PickElementId0",e[e.PickElementId1=e.Five]="PickElementId1",e[e.PickDepthAndOrder=e.Six]="PickDepthAndOrder",e[e.VertexLUT=e.Seven]="VertexLUT",e[e.DiffuseMap=WebGLRenderingContext.TEXTURE8]="DiffuseMap",e[e.IBLSpecular=WebGLRenderingContext.TEXTURE9]="IBLSpecular",e[e.BRDFLUT=WebGLRenderingContext.TEXTURE10]="BRDFLUT",e[e.EnvironmentMap=WebGLRenderingContext.TEXTURE11]="EnvironmentMap",e[e.AnimationLUT=WebGLRenderingContext.TEXTURE12]="AnimationLUT"}(t.TextureUnit||(t.TextureUnit={})),function(e){e[e.None=0]="None",e[e.BlankingRegion=1]="BlankingRegion",e[e.Surface=2]="Surface",e[e.Linear=3]="Linear",e[e.Edge=4]="Edge",e[e.Silhouette=5]="Silhouette",e[e.PlanarBit=8]="PlanarBit",e[e.PlanarSurface=10]="PlanarSurface",e[e.PlanarLinear=11]="PlanarLinear",e[e.PlanarEdge=12]="PlanarEdge",e[e.PlanarSilhouette=13]="PlanarSilhouette"}(t.RenderOrder||(t.RenderOrder={})),t.isPlanar=function(e){return e>=8},t.isSurface=function(e){return e<=2||10===e},function(e){e[e.None=0]="None",e[e.Translucent=1]="Translucent",e[e.Hilite=2]="Hilite",e[e.All=3]="All"}(t.CompositeFlags||(t.CompositeFlags={})),function(e){e[e.None=0]="None",e[e.HasTexture=1]="HasTexture",e[e.ApplyLighting=2]="ApplyLighting",e[e.HasNormals=4]="HasNormals",e[e.IgnoreMaterial=8]="IgnoreMaterial",e[e.TransparencyThreshold=16]="TransparencyThreshold",e[e.BackgroundFill=32]="BackgroundFill",e[e.HasColorAndNormal=64]="HasColorAndNormal",e[e.EnvironmentMap=128]="EnvironmentMap"}(t.SurfaceFlags||(t.SurfaceFlags={})),function(e){e[e.None=0]="None",e[e.Visibility=1]="Visibility",e[e.Rgb=2]="Rgb",e[e.Alpha=4]="Alpha",e[e.Weight=8]="Weight",e[e.Flashed=16]="Flashed",e[e.Hilited=32]="Hilited",e[e.LineCode=64]="LineCode",e[e.IgnoreMaterial=128]="IgnoreMaterial",e[e.Rgba=6]="Rgba"}(t.OvrFlags||(t.OvrFlags={})),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes",e[e.Maybe=2]="Maybe"}(t.IsTranslucent||(t.IsTranslucent={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class TypeConverterManager{static registerConverter(e,t){if(TypeConverterManager._converters.hasOwnProperty(e)){const t=TypeConverterManager._converters[e].constructor.name;throw Error("TypeConverterManager.registerConverter error: type '"+e+"' already registered to '"+t+"'")}const r=new t;TypeConverterManager._converters[e]=r}static getConverter(e){if(TypeConverterManager._converters.hasOwnProperty(e))return TypeConverterManager._converters[e];if(!TypeConverterManager._defaultTypeConverter){const{StringTypeConverter:e}=r(367);TypeConverterManager._defaultTypeConverter=new e}return TypeConverterManager._defaultTypeConverter}}TypeConverterManager._converters={},t.TypeConverterManager=TypeConverterManager},function(e,t,r){"use strict";(function(e){var n=r(415),i=r(416),o=r(227);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!c.TYPED_ARRAY_SUPPORT&&!(this instanceof c))return new c(e,t,r);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return l(this,e,t,r)}function l(e,t,r,n){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,r,n):"string"===typeof t?function(e,t,r){"string"===typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|f(t,r),i=(e=a(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|p(t.length);return 0===(e=a(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(n=t.length)!==n?a(e,0):h(e,t);if("Buffer"===t.type&&o(t.data))return h(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(u(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function h(e,t){var r=t.length<0?0:0|p(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(n)return U(e).length;t=(""+t).toLowerCase(),n=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){if(0===e.length)return-1;if("string"===typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"===typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"===typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(o=r;o<a;o++)if(l(e,o)===l(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var d=!0,h=0;h<c;h++)if(l(e,o+h)!==l(t,h)){d=!1;break}if(d)return o}return-1}function v(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function _(e,t,r,n){return j(U(t,e.length-r),e,r,n)}function w(e,t,r,n){return j(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return w(e,t,r,n)}function b(e,t,r,n){return j(z(t),e,r,n)}function x(e,t,r,n){return j(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function P(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function C(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,c,l=e[i],u=null,d=l>239?4:l>223?3:l>191?2:1;if(i+d<=r)switch(d){case 1:l<128&&(u=l);break;case 2:128===(192&(o=e[i+1]))&&(c=(31&l)<<6|63&o)>127&&(u=c);break;case 3:o=e[i+1],s=e[i+2],128===(192&o)&&128===(192&s)&&(c=(15&l)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128===(192&o)&&128===(192&s)&&128===(192&a)&&(c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,d=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=d}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=T));return r}(n)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return l(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return function(e,t,r,n){return u(t),t<=0?a(e,t):void 0!==r?"string"===typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?C(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,r);case"utf8":case"utf-8":return C(this,t,r);case"ascii":return M(this,t,r);case"latin1":case"binary":return E(this,t,r);case"base64":return P(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,s=r-t,a=Math.min(o,s),l=this.slice(n,i),u=e.slice(t,r),d=0;d<a;++d)if(l[d]!==u[d]){o=l[d],s=u[d];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"===typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":return w(this,e,t,r);case"latin1":case"binary":return S(this,e,t,r);case"base64":return b(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function M(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function E(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function I(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=V(e[o]);return i}function A(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function R(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,r,n,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function D(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function k(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function F(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,n,o){return o||F(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,o){return o||F(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;r=new c(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||R(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||R(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUInt8=function(e,t){return t||R(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||R(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||R(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||R(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||R(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||R(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||R(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||R(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||R(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||R(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||R(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||O(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||O(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):k(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);O(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);O(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):k(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return N(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return N(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},c.prototype.fill=function(e,t,r,n){if("string"===typeof e){if("string"===typeof t?(n=t,t=0,r=this.length):"string"===typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"===typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=c.isBuffer(e)?e:U(new c(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function V(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function z(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function j(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(12))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(6),o=r(165);class GrowableFloat64Array{constructor(e=8){this._data=new Float64Array(e),this._inUse=0}static compare(e,t){return e-t}get length(){return this._inUse}setAt(e,t){this._data[e]=t}move(e,t){this._data[t]=this._data[e]}push(e){if(this._inUse+1<this._data.length)this._data[this._inUse]=e,this._inUse++;else{const t=new Float64Array(2*this._inUse);for(let e=0;e<this._inUse;e++)t[e]=this._data[e];this._data=t,this._data[this._inUse]=e,this._inUse++}}pushBlockCopy(e,t){const r=this._inUse+t;this.ensureCapacity(r);const n=e+t;for(let i=e;i<n;i++)this._data[this._inUse++]=this._data[i]}clear(){for(;this._inUse>0;)this.pop()}capacity(){return this._data.length}ensureCapacity(e){if(e>this.capacity()){const t=this._inUse,r=new Float64Array(e);for(let e=0;e<t;e++)r[e]=this._data[e];this._data=r}}resize(e,t=0){if(e<=this._inUse)return void(this._inUse=e);const r=this._inUse;this.ensureCapacity(e);for(let n=r;n<e;n++)this._data[n]=t;this._inUse=e}pop(){this._inUse>0&&this._inUse--}at(e){return this._data[e]}front(){return this._data[0]}back(){return this._data[this._inUse-1]}reassign(e,t){this._data[e]=t}sort(e=GrowableFloat64Array.compare){for(let t=0;t<this._inUse;t++)for(let r=t+1;r<this._inUse;r++){const n=this._data[t],i=this._data[r];e(n,i)>0&&(this._data[t]=i,this._data[r]=n)}}restrictToInterval(e,t){const r=this._data,n=r.length;let i=0,o=0;for(let s=0;s<n;s++)(o=r[s])>=e&&o<=t&&(r[i++]=o);this._inUse=i}overwriteWithScaledCombinations(e,t,r,n){for(let i=t;i>e;i--)this._data[i]=r*this._data[i-1]+n*this._data[i]}weightedSum(e,t){let r=e,n=0;const i=this._data;for(const o of t)n+=o*i[r++];return n}weightedDifferenceSum(e,t){let r=e,n=0;const i=this._data;for(const o of t)n+=o*(i[r+1]-i[r]),r++;return n}}t.GrowableFloat64Array=GrowableFloat64Array;class GrowableBlockedArray{constructor(e,t=8){this._data=new Float64Array(t*e),this._inUse=0,this._blockSize=e}get numBlocks(){return this._inUse}get numPerBlock(){return this._blockSize}getWithinBlock(e,t){return this._data[e*this._blockSize+t]}clear(){this._inUse=0}blockCapacity(){return this._data.length/this._blockSize}ensureBlockCapacity(e){if(e>this.blockCapacity()){const t=new Float64Array(e*this._blockSize);for(let e=0;e<this._data.length;e++)t[e]=this._data[e];this._data=t}}newBlockIndex(){const e=this._blockSize*this._inUse;e+1>this._data.length&&this.ensureBlockCapacity(2*this._inUse),this._inUse++;for(let t=e;t<e+this._blockSize;t++)this._data[t]=0;return e}popBlock(){this._inUse>0&&this._inUse--}blockIndexToDoubleIndex(e){return this._blockSize*e}checkedComponent(e,t){if(!(e>=this._inUse||e<0||t<0||t>=this._blockSize))return this._data[this._blockSize*e+t]}component(e,t){return this._data[this._blockSize*e+t]}static compareLexicalBlock(e,t,r,n){let i=0,o=0;for(let s=0;s<t;s++){if((i=e[r+s])>(o=e[n+s]))return 1;if(i<o)return-1}return r-n}sortIndicesLexical(e=GrowableBlockedArray.compareLexicalBlock){const t=this._inUse,r=new Uint32Array(t),n=this._data,i=this._blockSize;for(let o=0;o<t;o++)r[o]=o;return r.sort((t,r)=>e(n,i,t*i,r*i)),r}distanceBetweenBlocks(e,t){let r=0,n=this.blockIndexToDoubleIndex(e),i=this.blockIndexToDoubleIndex(t),o=0;const s=this._data;for(let a=0;a<this._blockSize;a++)r+=(o=s[n++]-s[i++])*o;return Math.sqrt(r)}distanceBetweenSubBlocks(e,t,r,n){let i=0;const o=this.blockIndexToDoubleIndex(e),s=this.blockIndexToDoubleIndex(t);let a=0;const c=this._data;for(let l=r;l<n;l++)i+=(a=c[o+l]-c[s+l])*a;return Math.sqrt(i)}}t.GrowableBlockedArray=GrowableBlockedArray;class GrowableXYZArray extends o.IndexedXYZCollection{constructor(e=8){super(),this._data=new Float64Array(3*e),this._inUse=0,this._capacity=e}get length(){return this._inUse}get float64Length(){return 3*this._inUse}ensureCapacity(e){if(e>this._capacity){const t=new Float64Array(3*e),r=3*this.length;for(let e=0;e<r;e++)t[e]=this._data[e];this._data=t,this._capacity=e}}resize(e){if(e<this.length)this._inUse=e>=0?e:0;else if(e>this._capacity){const t=new Float64Array(3*e);for(let e=0;e<this._data.length;e+=3)t[e]=this._data[e],t[e+1]=this._data[e+1],t[e+2]=this._data[e+2];this._data=t,this._capacity=e}}clone(){const e=new GrowableXYZArray(this.length),t=3*this.length,r=e._data,n=this._data;for(let i=0;i<t;i++)r[i]=n[i];return e._inUse=this.length,e}static create(e){const t=new GrowableXYZArray(e.length);for(const r of e)t.push(r);return t}push(e){this.pushXYZ(e.x,e.y,e.z)}pushAll(e){for(const t of e)this.push(t)}pushWrap(e){if(this._inUse>0){let t;for(let r=0;r<e;r++)t=3*r,this.pushXYZ(this._data[t],this._data[t+1],this._data[t+2])}}pushXYZ(e,t,r){const n=3*this._inUse;n>=this._data.length&&this.ensureCapacity(2*this.length),this._data[n]=e,this._data[n+1]=t,this._data[n+2]=r,this._inUse++}pop(){this._inUse>0&&this._inUse--}isIndexValid(e){return!(e>=this._inUse||e<0)}clear(){this._inUse=0}getPoint3dAt(e,t){const r=3*e;return i.Point3d.create(this._data[r],this._data[r+1],this._data[r+2],t)}getVector3dBetweenIndices(e,t,r){const n=3*e,o=3*t,s=this._inUse;if(e>=0&&e<s&&t>=0&&t<s)return i.Vector3d.createStartEndXYZXYZ(this._data[n],this._data[n+1],this._data[n+2],this._data[o],this._data[o+1],this._data[o+2],r)}atPoint3dIndex(e,t){const r=3*e;if(e>=0&&e<this._inUse)return t||(t=i.Point3d.create()),t.x=this._data[r],t.y=this._data[r+1],t.z=this._data[r+2],t}atVector3dIndex(e,t){const r=3*e;if(e>=0&&e<this._inUse)return t||(t=i.Vector3d.create()),t.x=this._data[r],t.y=this._data[r+1],t.z=this._data[r+2],t}transferFromGrowableXYZArray(e,t,r){if(e<this.length&&r<t.length){const n=3*e,i=3*r;return this._data[n]=t._data[i],this._data[n+1]=t._data[i+1],this._data[n+2]=t._data[i+2],!0}return!1}pushFromGrowableXYZArray(e,t){if(t<e.length){const r=3*t;return this.pushXYZ(e._data[r],e._data[r+1],e._data[r+2]),!0}return!1}front(e){if(0!==this._inUse)return this.getPoint3dAt(0,e)}back(e){if(!(this._inUse-1<0))return this.getPoint3dAt(this._inUse-1,e)}setAt(e,t){if(e<0||e>=this._inUse)return!1;let r=3*e;return this._data[r++]=t.x,this._data[r++]=t.y,this._data[r]=t.z,!0}setCoordinates(e,t,r,n){if(e<0||e>=this._inUse)return!1;let i=3*e;return this._data[i++]=t,this._data[i++]=r,this._data[i]=n,!0}getPoint3dArray(){const e=[],t=this._data,r=this.length;for(let n=0;n<r;n++)e.push(i.Point3d.create(t[3*n],t[3*n+1],t[3*n+2]));return e}transformInPlace(e){const t=this._data,r=this.float64Length,n=e.matrix.coffs,i=e.origin,o=i.x,s=i.y,a=i.z;let c=0,l=0,u=0;for(let d=0;d+3<=r;d+=3)c=t[d],l=t[d+1],u=t[d+2],t[d]=n[0]*c+n[1]*l+n[2]*u+o,t[d+1]=n[3]*c+n[4]*l+n[5]*u+s,t[d+2]=n[6]*c+n[7]*l+n[8]*u+a}tryTransformInverseInPlace(e){const t=this._data,r=this.float64Length,n=e.matrix;n.computeCachedInverse(!0);const i=n.inverseCoffs;if(!i)return!1;const o=e.origin,s=o.x,a=o.y,c=o.z;let l=0,u=0,d=0;for(let h=0;h+3<=r;h+=3)l=t[h]-s,u=t[h+1]-a,d=t[h+2]-c,t[h]=i[0]*l+i[1]*u+i[2]*d,t[h+1]=i[3]*l+i[4]*u+i[5]*d,t[h+2]=i[6]*l+i[7]*u+i[8]*d;return!0}extendRange(e,t){const r=this.float64Length,n=this._data;if(t)for(let i=0;i+3<=r;i+=3)e.extendTransformedXYZ(t,n[i],n[i+1],n[i+2]);else for(let i=0;i+3<=r;i+=3)e.extendXYZ(n[i],n[i+1],n[i+2])}sumLengths(){let e=0;const t=3*(this._inUse-1),r=this._data;for(let i=0;i<t;i+=3)e+=n.Geometry.hypotenuseXYZ(r[i+3]-r[i],r[i+4]-r[i+1],r[i+5]-r[i+2]);return e}isCloseToPlane(e,t=n.Geometry.smallMetricDistance){const r=3*this._inUse,i=this._data;for(let n=0;n<r;n+=3)if(Math.abs(e.altitudeXYZ(i[n],i[n+1],i[n+2]))>t)return!1;return!0}interpolate(e,t,r,n){if(e>=0&&e<this._inUse){const o=1-t,s=this._data;return e*=3,r*=3,i.Point3d.create(o*s[e]+t*s[r],o*s[e+1]+t*s[r+1],o*s[e+2]+t*s[r+2],n)}}areaXY(){let e=0;const t=this._data.length-6;if(t>2){const r=this._data[0],i=this._data[1];let o=this._data[3]-r,s=this._data[4]-i,a=0,c=0;for(let l=6;l<t;l+=3,o=a,s=c)a=this._data[l]-r,c=this._data[l+1]-i,e+=n.Geometry.crossProductXYXY(o,s,a,c)}return.5*e}vectorIndexIndex(e,t,r){const n=this._inUse;if(e<0||e>=n)return;if(t<0||t>=n)return;r||(r=i.Vector3d.create());const o=this._data;return e*=3,t*=3,r.x=o[t]-o[e],r.y=o[t+1]-o[e+1],r.z=o[t+2]-o[e+2],r}vectorXYAndZIndex(e,t,r){if(t>=0&&t<this._inUse){const n=this._data;return t*=3,i.Vector3d.create(n[t]-e.x,n[t+1]-e.y,n[t+2]-e.z,r)}}crossProductIndexIndexIndex(e,t,r,i){const o=3*e,s=3*t,a=3*r,c=this._data;if(this.isIndexValid(e)&&this.isIndexValid(t)&&this.isIndexValid(r))return n.Geometry.crossProductXYZXYZ(c[s]-c[o],c[s+1]-c[o+1],c[s+2]-c[o+2],c[a]-c[o],c[a+1]-c[o+1],c[a+2]-c[o+2],i)}accumulateCrossProductIndexIndexIndex(e,t,r,n){const i=3*e,o=3*t,s=3*r,a=this._data;this.isIndexValid(e)&&this.isIndexValid(t)&&this.isIndexValid(r)&&n.addCrossProductToTargetsInPlace(a[i],a[i+1],a[i+2],a[o],a[o+1],a[o+2],a[s],a[s+1],a[s+2])}crossProductXYAndZIndexIndex(e,t,r,i){const o=3*t,s=3*r,a=this._data;if(this.isIndexValid(t)&&this.isIndexValid(r))return n.Geometry.crossProductXYZXYZ(a[o]-e.x,a[o+1]-e.y,a[o+2]-e.z,a[s]-e.x,a[s+1]-e.y,a[s+2]-e.z,i)}distance(e,t){if(e>=0&&e<this._inUse&&t>=0&&t<=this._inUse){const r=3*e,i=3*t;return n.Geometry.hypotenuseXYZ(this._data[i]-this._data[r],this._data[i+1]-this._data[r+1],this._data[i+2]-this._data[r+2])}return 0}distanceIndexToPoint(e,t){if(e>=0&&e<this._inUse){const r=3*e;return n.Geometry.hypotenuseXYZ(t.x-this._data[r],t.y-this._data[r+1],t.z-this._data[r+2])}return 0}static isAlmostEqual(e,t){if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!e.getPoint3dAt(r).isAlmostEqual(t.getPoint3dAt(r)))return!1;return!0}return!e&&!t}sortIndicesLexical(){const e=this._inUse,t=new Uint32Array(e);for(let r=0;r<e;r++)t[r]=r;return t.sort((e,t)=>this.compareLexicalBlock(e,t)),t}compareLexicalBlock(e,t){let r=0,n=0;for(let i=0;i<3;i++){if((r=this._data[3*e+i])>(n=this._data[3*t+i]))return 1;if(r<n)return-1}return e-t}component(e,t){return this._data[3*e+t]}}t.GrowableXYZArray=GrowableXYZArray},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(59),o=r(6),s=r(9),a=r(10),c=r(21),l=r(166),u=r(167),d=r(49),h=r(50);t.CurvePrimitive=class CurvePrimitive extends h.GeometryQuery{constructor(){super()}fractionToPointAndUnitTangent(e,t){const r=this.fractionToPointAndDerivative(e,t);return r.trySetDirectionMagnitudeInPlace(1),r}fractionToFrenetFrame(e,t){const r=this.fractionToPointAnd2Derivatives(e);if(!r)return;let n=a.Matrix3d.createRigidFromColumns(r.vectorU,r.vectorV,0);if(n)return s.Transform.createRefs(r.origin,n,t);const i=a.Matrix3d.createPerpendicularVectorFavorXYPlane(r.vectorU,r.vectorV);return(n=a.Matrix3d.createRigidFromColumns(r.vectorU,i,0))?s.Transform.createRefs(r.origin,n,t):void 0}curveLength(){const e=new CurveLengthContext;return this.emitStrokableParts(e),e.getSum()}curveLengthBetweenFractions(e,t){if(e===t)return 0;if(void 0!==this.getFractionToDistanceScale()){const r=this.curveLength();return Math.abs((t-e)*r)}const r=new CurveLengthContext(e,t);return this.emitStrokableParts(r),Math.abs(r.getSum())}curveLengthWithFixedIntervalCountQuadrature(e,t,r,n=5){if(e>t){const r=e;e=t,t=r}const i=new CurveLengthContext(e,t,n);return i.announceIntervalForUniformStepStrokes(this,r,e,t),Math.abs(i.getSum())}moveSignedDistanceFromFraction(e,t,r,i){if(void 0!==this.getFractionToDistanceScale()){const o=this.curveLength(),s=n.Geometry.conditionalDivideFraction(t,o);return void 0===s?d.CurveLocationDetail.createCurveFractionPointDistanceCurveSearchStatus(this,e,this.fractionToPoint(e),0,d.CurveSearchStatus.error):d.CurveLocationDetail.createConditionalMoveSignedDistance(r,this,e,e+s,t,i)}return this.moveSignedDistanceFromFractionGeneric(e,t,r,i)}moveSignedDistanceFromFractionGeneric(e,t,r,i){const o=t>0?1:0,s=Math.abs(t),a=t<0?-1:1,l=this.curveLengthBetweenFractions(e,o);if(l<s&&!r)return d.CurveLocationDetail.createConditionalMoveSignedDistance(r,this,e,o,t,i);const u=s/l;let h=n.Geometry.interpolate(e,u,o),p=e,f=0;const g=1e-12*l;let m=0;const y=c.Ray3d.createXAxis();for(let n=0;n<10;n++){const e=this.curveLengthBetweenFractions(p,h),t=f+(h>p?a:-a)*e,r=s-t;if(Math.abs(r)<g){if(++m>1)break}else m=0;if(this.fractionToPointAndDerivative(h,y),(p=h)===(h=p+a*r/y.direction.magnitude())){m=100;break}f=t}return m>1?d.CurveLocationDetail.createConditionalMoveSignedDistance(!1,this,e,h,t,i):((i=d.CurveLocationDetail.createCurveEvaluatedFraction(this,e,i)).a=0,i.curveSearchStatus=d.CurveSearchStatus.error,i)}get isExtensibleFractionSpace(){return!1}closestPoint(e,t){const r=new ClosestPointStrokeHandler(e,t);return this.emitStrokableParts(r),r.claimResult()}announceClipIntervals(e,t){return!1}clonePartialCurve(e,t){}getFractionToDistanceScale(){}appendPlaneIntersectionPoints(e,t){const r=new AppendPlaneIntersectionStrokeHandler(e,t),n=t.length;return this.emitStrokableParts(r),t.length-n}startPoint(e){return this.fractionToPoint(0,e)}endPoint(e){return this.fractionToPoint(1,e)}};class NewtonRotRStrokeHandler extends l.NewtonEvaluatorRtoR{constructor(){super(),this._parentCurvePrimitive=void 0}startParentCurvePrimitive(e){this._parentCurvePrimitive=e}endParentCurvePrimitive(e){this._parentCurvePrimitive=void 0}}class AppendPlaneIntersectionStrokeHandler extends NewtonRotRStrokeHandler{constructor(e,t){super(),this._fractionA=0,this._functionA=0,this._functionB=0,this._fractionB=0,this._derivativeB=0,this._numThisCurve=0,this._plane=e,this._intersections=t,this.startCurvePrimitive(void 0),this._ray=c.Ray3d.createZero(),this._newtonSolver=new l.Newton1dUnboundedApproximateDerivative(this)}effectiveCurve(){return this._parentCurvePrimitive?this._parentCurvePrimitive:this._curve}get getDerivativeB(){return this._derivativeB}startCurvePrimitive(e){this._curve=e,this._fractionA=0,this._numThisCurve=0,this._functionA=0}endCurvePrimitive(){}announceIntervalForUniformStepStrokes(e,t,r,i){this.startCurvePrimitive(e),t<1&&(t=1);const o=1/t;for(let s=0;s<=t;s++){const t=n.Geometry.interpolate(r,s*o,i);e.fractionToPointAndDerivative(t,this._ray),this.announcePointTangent(this._ray.origin,t,this._ray.direction)}}announceSegmentInterval(e,t,r,o,s,a){const c=this._plane.altitude(t),l=this._plane.altitude(r);if(c*l>0)return;const u=i.Order2Bezier.solveCoffs(c,l);if(void 0!==u){const e=n.Geometry.interpolate(s,u,a);this._newtonSolver.setX(e),this._newtonSolver.runIterations()&&this.announceSolutionFraction(this._newtonSolver.getX())}}announceSolutionFraction(e){const t=this.effectiveCurve();t&&(this._ray=t.fractionToPointAndDerivative(e,this._ray),this._intersections.push(d.CurveLocationDetail.createCurveFractionPoint(t,e,this._ray.origin)))}evaluate(e){const t=this.effectiveCurve();return!!t&&(this.currentF=this._plane.altitude(t.fractionToPoint(e)),!0)}searchInterval(){if(!(this._functionA*this._functionB>0)&&(0===this._functionA&&this.announceSolutionFraction(this._fractionA),0===this._functionB&&this.announceSolutionFraction(this._fractionB),this._functionA*this._functionB<0)){const e=n.Geometry.inverseInterpolate(this._fractionA,this._functionA,this._fractionB,this._functionB);e&&(this._newtonSolver.setX(e),this._newtonSolver.runIterations()&&this.announceSolutionFraction(this._newtonSolver.getX()))}}evaluateB(e,t,r){this._functionB=this._plane.altitude(e),this._derivativeB=this._plane.velocity(r),this._fractionB=t}announcePointTangent(e,t,r){this.evaluateB(e,t,r),this._numThisCurve++>0&&this.searchInterval(),this._functionA=this._functionB,this._fractionA=this._fractionB,this._fractionA=this._fractionB}}class CurveLengthContext{tangentMagnitude(e){return this._ray=this._curve.fractionToPointAndDerivative(e,this._ray),this._ray.direction.magnitude()}getSum(){return this._summedLength}constructor(e=0,t=1,r=5){this.startCurvePrimitive(void 0),this._summedLength=0,this._ray=c.Ray3d.createZero(),e<t?(this._fraction0=e,this._fraction1=t):(this._fraction0=t,this._fraction1=e);switch(this._gaussX=new Float64Array(7),this._gaussW=new Float64Array(7),(r>5||r<1)&&(r=5),r){case 1:this._gaussMapper=u.Quadrature.setupGauss1;break;case 2:this._gaussMapper=u.Quadrature.setupGauss2;break;case 3:this._gaussMapper=u.Quadrature.setupGauss3;break;case 4:this._gaussMapper=u.Quadrature.setupGauss4;break;default:this._gaussMapper=u.Quadrature.setupGauss5}}startCurvePrimitive(e){this._curve=e}startParentCurvePrimitive(e){}endParentCurvePrimitive(e){}endCurvePrimitive(){}announceIntervalForUniformStepStrokes(e,t,r,i){if(r<this._fraction0&&(r=this._fraction0),i>this._fraction1&&(i=this._fraction1),i>r){this.startCurvePrimitive(e),t<1&&(t=1);const o=1/t;for(let e=1;e<=t;e++){const s=n.Geometry.interpolate(r,(e-1)*o,i),a=e===t?i:n.Geometry.interpolate(r,e*o,i),c=this._gaussMapper(s,a,this._gaussX,this._gaussW);for(let e=0;e<c;e++)this._summedLength+=this._gaussW[e]*this.tangentMagnitude(this._gaussX[e])}}}announceSegmentInterval(e,t,r,n,i,o){const s=t.distance(r);if(this._fraction0<=i&&o<=this._fraction1)this._summedLength+=s;else{let e=i,t=o;e<this._fraction0&&(e=this._fraction0),t>this._fraction1&&(t=this._fraction1),t>e&&(this._summedLength+=s*(t-e)/(o-i))}}announcePointTangent(e,t,r){}}class ClosestPointStrokeHandler extends NewtonRotRStrokeHandler{constructor(e,t){super(),this._fractionA=0,this._functionA=0,this._functionB=0,this._fractionB=0,this._numThisCurve=0,this._spacePoint=e,this._workPoint=o.Point3d.create(),this._workRay=c.Ray3d.createZero(),this._closestPoint=void 0,this._extend=t,this.startCurvePrimitive(void 0),this._newtonSolver=new l.Newton1dUnboundedApproximateDerivative(this)}claimResult(){return this._closestPoint&&(this._newtonSolver.setX(this._closestPoint.fraction),this._curve=this._closestPoint.curve,this._newtonSolver.runIterations()&&this.announceSolutionFraction(this._newtonSolver.getX())),this._closestPoint}startCurvePrimitive(e){this._curve=e,this._fractionA=0,this._numThisCurve=0,this._functionA=0}endCurvePrimitive(){}announceIntervalForUniformStepStrokes(e,t,r,i){this.startCurvePrimitive(e),t<1&&(t=1);const o=1/t;for(let s=0;s<=t;s++){const t=n.Geometry.interpolate(r,s*o,i);e.fractionToPointAndDerivative(t,this._workRay),this.announceRay(t,this._workRay)}}announceCandidate(e,t,r){const n=this._spacePoint.distance(r);this._closestPoint&&n>this._closestPoint.a||(this._closestPoint=d.CurveLocationDetail.createCurveFractionPoint(e,t,r,this._closestPoint),this._closestPoint.a=n,void 0!==this._parentCurvePrimitive&&(this._closestPoint.curve=this._parentCurvePrimitive))}announceSegmentInterval(e,t,r,i,o,s){let a=this._spacePoint.fractionOfProjectionToLine(t,r,0);this._extend?(0!==o&&(a=Math.max(a,0)),1!==s&&(a=Math.min(a,1))):a=n.Geometry.clampToStartEnd(a,0,1),this._workPoint=t.interpolate(a,r);const c=n.Geometry.interpolate(o,a,s);this.announceCandidate(e,c,this._workPoint)}searchInterval(){if(!(this._functionA*this._functionB>0)&&(0===this._functionA&&this.announceSolutionFraction(this._fractionA),0===this._functionB&&this.announceSolutionFraction(this._fractionB),this._functionA*this._functionB<0)){const e=n.Geometry.inverseInterpolate(this._fractionA,this._functionA,this._fractionB,this._functionB);e&&(this._newtonSolver.setX(e),this._newtonSolver.runIterations()&&this.announceSolutionFraction(this._newtonSolver.getX()))}}evaluateB(e,t){this._functionB=t.dotProductToPoint(this._spacePoint),this._fractionB=e}announceSolutionFraction(e){this._curve&&this.announceCandidate(this._curve,e,this._curve.fractionToPoint(e))}evaluate(e){let t=this._curve;return this._parentCurvePrimitive&&(t=this._parentCurvePrimitive),!!t&&(this._workRay=t.fractionToPointAndDerivative(e,this._workRay),this.currentF=this._workRay.dotProductToPoint(this._spacePoint),!0)}announceRay(e,t){this.evaluateB(e,t),this._numThisCurve++>0&&this.searchInterval(),this._functionA=this._functionB,this._fractionA=this._fractionB,this._fractionA=this._fractionB}announcePointTangent(e,t,r){this._workRay.set(e,r),this.announceRay(t,this._workRay)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(14),o=r(33);class Loop extends o.CurveChain{constructor(){super(),this.isInner=!1}isSameGeometryClass(e){return e instanceof Loop}static create(...e){const t=new Loop;for(const r of e)t.children.push(r);return t}static createArray(e){const t=new Loop;for(const r of e)t.children.push(r);return t}static createPolygon(e){const t=i.LineString3d.create(e);return t.addClosurePoint(),Loop.create(t)}cloneStroked(e){const t=i.LineString3d.create();for(const r of this.children)r.emitStrokes(t,e);return Loop.create(t)}dgnBoundaryType(){return 2}announceToCurveProcessor(e,t=-1){return e.announceLoop(this,t)}cyclicCurvePrimitive(e){if(this.children.length>=1)return e=n.Geometry.modulo(e,this.children.length),this.children[e]}cloneEmptyPeer(){return new Loop}dispatchToGeometryHandler(e){return e.handleLoop(this)}}t.Loop=Loop},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(52);t.RpcManager=class RpcManager{static initializeInterface(e){n.RpcRegistry.instance.initializeRpcInterface(e)}static terminateInterface(e){n.RpcRegistry.instance.terminateRpcInterface(e)}static getClientForInterface(e){return n.RpcRegistry.instance.getClientForInterface(e)}static registerImpl(e,t){n.RpcRegistry.instance.registerImpl(e,t)}static supplyImplInstance(e,t){n.RpcRegistry.instance.supplyImplInstance(e,t)}static unregisterImpl(e){n.RpcRegistry.instance.unregisterImpl(e)}static describeAvailableEndpoints(){return n.RpcRegistry.instance.describeAvailableEndpoints()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4),o=r(11),s=r(7),a=r(34),c=r(296);function l(e,t,r,n){const i=e.getHandle(),o=s.System.instance.context;if(o.pixelStorei(o.UNPACK_ALIGNMENT,1),s.System.instance.bindTexture2d(a.TextureUnit.Zero,i),void 0!==n)o.texImage2D(o.TEXTURE_2D,0,t.format,t.format,t.dataType,n);else{const e=void 0!==r?r:null;o.texImage2D(o.TEXTURE_2D,0,t.format,t.width,t.height,0,t.format,t.dataType,e)}t.useMipMaps?(o.generateMipmap(o.TEXTURE_2D),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,t.interpolate?o.LINEAR:o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t.interpolate?o.LINEAR:o.NEAREST)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,t.wrapMode),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,t.wrapMode),s.System.instance.bindTexture2d(a.TextureUnit.Zero,void 0)}function u(e,t,r){l(e,t,r)}t.Texture=class Texture extends i.RenderTexture{constructor(e,t){super(e),this.texture=t}dispose(){n.dispose(this.texture)}get hasTranslucency(){return o.GL.Texture.Format.Rgba===this.texture.format}};class Texture2DCreateParams{constructor(e,t,r,n,i,o,s,a,c){this.width=e,this.height=t,this.format=r,this.dataType=n,this.wrapMode=i,this.loadImageData=o,this.useMipMaps=s,this.interpolate=a,this.dataBytes=c}static createForData(e,t,r,n=!1,i=o.GL.Texture.WrapMode.ClampToEdge,s=o.GL.Texture.Format.Rgba){return new Texture2DCreateParams(e,t,s,o.GL.Texture.DataType.UnsignedByte,i,(e,t)=>u(e,t,r),void 0,void 0,n?r:void 0)}static createForImageBuffer(e,t){const r=this.getImageProperties(0===e.format,t);return new Texture2DCreateParams(e.width,e.height,r.format,o.GL.Texture.DataType.UnsignedByte,r.wrapMode,(t,r)=>u(t,r,e.data),r.useMipMaps,r.interpolate)}static createForAttachment(e,t,r,n){return new Texture2DCreateParams(e,t,r,n,o.GL.Texture.WrapMode.ClampToEdge,(e,t)=>u(e,t),void 0,void 0)}static createForImage(e,t,r){const n=this.getImageProperties(t,r);let a=e.naturalWidth,c=e.naturalHeight;const u=s.System.instance.capabilities;1===r?(a=i.nextHighestPowerOfTwo(a),c=i.nextHighestPowerOfTwo(c)):u.supportsNonPowerOf2Textures||i.isPowerOfTwo(a)&&i.isPowerOfTwo(c)||(o.GL.Texture.WrapMode.ClampToEdge===n.wrapMode?n.useMipMaps=void 0:o.GL.Texture.WrapMode.Repeat===n.wrapMode&&(a=i.nextHighestPowerOfTwo(a),c=i.nextHighestPowerOfTwo(c)));let d=e;if(a!==e.naturalWidth||c!==e.naturalHeight){const t=document.createElement("canvas");t.width=a,t.height=c,t.getContext("2d").drawImage(e,0,0,t.width,t.height),d=t}return new Texture2DCreateParams(a,c,n.format,o.GL.Texture.DataType.UnsignedByte,n.wrapMode,(e,t)=>l(e,t,void 0,d),n.useMipMaps,n.interpolate)}static getImageProperties(e,t){const r=3===t,n=2===t,i=0===t?o.GL.Texture.WrapMode.Repeat:o.GL.Texture.WrapMode.ClampToEdge,s=!r&&!n||void 0;return{format:e?o.GL.Texture.Format.Rgba:o.GL.Texture.Format.Rgb,wrapMode:i,useMipMaps:s,interpolate:!0}}}Texture2DCreateParams.placeholderParams=new Texture2DCreateParams(1,1,o.GL.Texture.Format.Rgba,o.GL.Texture.DataType.UnsignedByte,o.GL.Texture.WrapMode.ClampToEdge,(e,t)=>void 0);class TextureCubeCreateParams{constructor(e,t,r,n,i){this.dim=e,this.format=t,this.dataType=r,this.wrapMode=n,this.loadImageData=i}static createForCubeImages(e,t,r,n,i,c){const l=e.naturalWidth;if(e.naturalHeight!==l)return;const u=[e,t,r,n,i,c];for(let o=1;o<u.length;o++)if(u[o].naturalWidth!==l||u[o].naturalHeight!==l)return;return new TextureCubeCreateParams(l,o.GL.Texture.Format.Rgba,o.GL.Texture.DataType.UnsignedByte,o.GL.Texture.WrapMode.ClampToEdge,(e,t)=>(function(e,t,r){const n=e.getHandle(),i=s.System.instance.context;i.pixelStorei(i.UNPACK_ALIGNMENT,1),s.System.instance.bindTextureCubeMap(a.TextureUnit.Zero,n);const c=[o.GL.Texture.Target.CubeMapPositiveX,o.GL.Texture.Target.CubeMapNegativeX,o.GL.Texture.Target.CubeMapPositiveY,o.GL.Texture.Target.CubeMapNegativeY,o.GL.Texture.Target.CubeMapPositiveZ,o.GL.Texture.Target.CubeMapNegativeZ];for(let o=0;o<6;o++)i.texImage2D(c[o],0,t.format,t.format,t.dataType,r[o]);i.texParameteri(o.GL.Texture.Target.CubeMap,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(o.GL.Texture.Target.CubeMap,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(o.GL.Texture.Target.CubeMap,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(o.GL.Texture.Target.CubeMap,i.TEXTURE_WRAP_T,t.wrapMode),s.System.instance.bindTextureCubeMap(a.TextureUnit.Zero,void 0)})(e,t,u))}}class TextureHandle{constructor(e){this._glTexture=e,TextureHandle.wantDebugIds&&(e._debugId=++TextureHandle._debugId,TextureHandle._debugId%=TextureHandle._maxDebugId)}static set monitor(e){this._monitor=e}getHandle(){return this._glTexture}get isDisposed(){return void 0===this._glTexture}dispose(){this.isDisposed||(void 0!==TextureHandle._monitor&&TextureHandle._monitor.onTextureDisposed(this),s.System.instance.disposeTexture(this._glTexture),this._glTexture=void 0)}static createForAttachment(e,t,r,n){return Texture2DHandle.createForAttachment(e,t,r,n)}static createForData(e,t,r,n=!1,i=o.GL.Texture.WrapMode.ClampToEdge,s=o.GL.Texture.Format.Rgba){return Texture2DHandle.createForData(e,t,r,n,i,s)}static createForImageBuffer(e,t){return Texture2DHandle.createForImageBuffer(e,t)}static createForImage(e,t,r){return Texture2DHandle.createForImage(e,t,r)}static createForCubeImages(e,t,r,n,i,o){return TextureCubeHandle.createForCubeImages(e,t,r,n,i,o)}}TextureHandle.wantDebugIds=!1,TextureHandle._debugId=0,TextureHandle._maxDebugId=16777215,t.TextureHandle=TextureHandle;class Texture2DHandle extends TextureHandle{get width(){return this._width}get height(){return this._height}get format(){return this._format}get dataType(){return this._dataType}get dataBytes(){return this._dataBytes}static bindTexture(e,t){s.System.instance.bindTexture2d(e,t),this.wantDebugIds&&c.debugPrint("Texture Unit "+(e-a.TextureUnit.Zero)+" = "+(t?t._debugId:"null"))}static bindSampler(e,t,r){this.bindTexture(r,t),e.setUniform1i(r-a.TextureUnit.Zero)}bind(e){return void 0!==this._glTexture&&(Texture2DHandle.bindTexture(e,this._glTexture),!0)}bindSampler(e,t){void 0!==this._glTexture&&Texture2DHandle.bindSampler(e,this._glTexture,t)}update(e){if(0===this.width||0===this.height||void 0===this._dataBytes||0===this._dataBytes.length)return!1;if(!e.modified)return!1;const t=this.getHandle();if(void 0===t)return!1;const r=s.System.instance.context;return r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.bindTexture(r.TEXTURE_2D,t),r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,this._format,this._dataType,this._dataBytes),!0}static create(e){const t=s.System.instance.context.createTexture();return null!==t?new Texture2DHandle(t,e):void 0}static createForAttachment(e,t,r,n){return this.create(Texture2DCreateParams.createForAttachment(e,t,r,n))}static createForData(e,t,r,n=!1,i=o.GL.Texture.WrapMode.ClampToEdge,s=o.GL.Texture.Format.Rgba){return this.create(Texture2DCreateParams.createForData(e,t,r,n,i,s))}static createForImageBuffer(e,t){return i.isPowerOfTwo(e.width)&&i.isPowerOfTwo(e.height),this.create(Texture2DCreateParams.createForImageBuffer(e,t))}static createForImage(e,t,r){return this.create(Texture2DCreateParams.createForImage(e,t,r))}constructor(e,t){super(e),this._width=t.width,this._height=t.height,this._format=t.format,this._dataType=t.dataType,this._dataBytes=t.dataBytes,void 0!==TextureHandle._monitor&&TextureHandle._monitor.onTextureCreated(this),t.loadImageData(this,t)}}t.Texture2DHandle=Texture2DHandle;class TextureCubeHandle extends TextureHandle{get width(){return this._dim}get height(){return this._dim}get format(){return this._format}get dataType(){return this._dataType}get dataBytes(){}static bindTexture(e,t){s.System.instance.bindTextureCubeMap(e,t),this.wantDebugIds&&c.debugPrint("Texture Unit "+(e-a.TextureUnit.Zero)+" = "+(t?t._debugId:"null"))}static bindSampler(e,t,r){this.bindTexture(r,t),e.setUniform1i(r-a.TextureUnit.Zero)}bind(e){return void 0!==this._glTexture&&(TextureCubeHandle.bindTexture(e,this._glTexture),!0)}bindSampler(e,t){void 0!==this._glTexture&&TextureCubeHandle.bindSampler(e,this._glTexture,t)}static create(e){const t=s.System.instance.context.createTexture();return null!==t?new TextureCubeHandle(t,e):void 0}static createForCubeImages(e,t,r,n,i,o){const s=TextureCubeCreateParams.createForCubeImages(e,t,r,n,i,o);return void 0!==s?this.create(s):void 0}constructor(e,t){super(e),this._dim=t.dim,this._format=t.format,this._dataType=t.dataType,void 0!==TextureHandle._monitor&&TextureHandle._monitor.onTextureCreated(this),t.loadImageData(this,t)}}t.TextureCubeHandle=TextureCubeHandle;t.Texture2DDataUpdater=class Texture2DDataUpdater{constructor(e){this.modified=!1,this.data=e}setByteAtIndex(e,t){this.data.length,t!==this.data[e]&&(this.data[e]=t,this.modified=!0)}setOvrFlagsAtIndex(e,t){this.data.length,t!==this.data[e]&&(this.data[e]=t,this.modified=!0)}getByteAtIndex(e){return this.data.length,this.data[e]}getFlagsAtIndex(e){return this.getByteAtIndex(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(52),i=r(62),o=r(469);class RpcInterface{constructor(){this.configuration=i.RpcConfiguration.supply(this)}static isVersionCompatible(e,t){const r=o.diff(e,t);return o.prerelease(e)||o.prerelease(t)?null===r:0===o.major(e)||0===o.major(t)?null===r||"patch"===r&&o.patch(t)<o.patch(e):null===r||"patch"===r||"minor"===r&&o.minor(t)<o.minor(e)}forward(e,...t){const r=new this.configuration.protocol.requestType(this,e,t);return r.submit(),this[n.CURRENT_REQUEST]=r,r.response}}t.RpcInterface=RpcInterface,RpcInterface.prototype.configurationSupplier=void 0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3),o=r(171),s=r(15),a=r(280);t.IModelToken=class IModelToken{constructor(e,t,r,n,i){this.key=e,this.contextId=t,this.iModelId=r,this.changeSetId=n,this.openMode=i}};class EcefLocation{getTransform(){return i.Transform.createOriginAndMatrix(this.origin,this.orientation.toMatrix3d())}constructor(e){this.origin=i.Point3d.fromJSON(e.origin),this.orientation=i.YawPitchRollAngles.fromJSON(e.orientation),this.origin.freeze(),this.orientation.freeze()}static createFromCartographicOrigin(e){const t=e.toEcef(),r=i.Vector3d.createFrom(t).normalize(),n=i.Vector3d.create(-Math.sin(e.longitude),Math.cos(e.latitude),0),o=i.Matrix3d.createRigidFromColumns(r,n,2);return new EcefLocation({origin:t,orientation:i.YawPitchRollAngles.createFromMatrix3d(o)})}}t.EcefLocation=EcefLocation;class IModel{constructor(e){this._token=e}get projectExtents(){return this._projectExtents}set projectExtents(e){this._projectExtents=e.clone(),this._projectExtents.ensureMinLengths(1),this._projectExtents.freeze()}get globalOrigin(){return this._globalOrigin}get ecefLocation(){return this._ecefLocation}setEcefLocation(e){this._ecefLocation=new EcefLocation(e),this._ecefTrans=void 0}toJSON(){const e={};return e.name=this.name,e.rootSubject=this.rootSubject,e.projectExtents=this.projectExtents.toJSON(),e.globalOrigin=this.globalOrigin.toJSON(),e.ecefLocation=this.ecefLocation,e.iModelToken=this.iModelToken,e}get iModelToken(){return this._token}initialize(e,t){this.name=e,this.rootSubject=t.rootSubject,this.projectExtents=o.AxisAlignedBox3d.fromJSON(t.projectExtents),this._globalOrigin=i.Point3d.fromJSON(t.globalOrigin),this._globalOrigin.freeze(),t.ecefLocation&&this.setEcefLocation(t.ecefLocation)}static getDefaultSubCategoryId(e){return n.Id64.isValid(e)?n.Id64.fromLocalAndBriefcaseIds(n.Id64.getLocalId(e)+1,n.Id64.getBriefcaseId(e)):n.Id64.invalid}get isGeoLocated(){return void 0!==this._ecefLocation}getEcefTransform(){if(void 0===this._ecefLocation)throw new s.IModelError(65602,"iModel is not GeoLocated");return void 0===this._ecefTrans&&(this._ecefTrans=this._ecefLocation.getTransform(),this._ecefTrans.freeze()),this._ecefTrans}spatialToEcef(e,t){return this.getEcefTransform().multiplyPoint3d(e,t)}ecefToSpatial(e,t){return this.getEcefTransform().multiplyInversePoint3d(e,t)}spatialToCartographic(e,t){return a.Cartographic.fromEcef(this.spatialToEcef(e),t)}cartographicToSpatial(e,t){return this.ecefToSpatial(e.toEcef(t),t)}}IModel.repositoryModelId="0x1",IModel.rootSubjectId="0x1",IModel.dictionaryId="0x10",t.IModel=IModel},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(0),o=r(3),s=r(65),a=r(89),c=r(11),l=r(7),u=r(41);class CachedGeometry{_getLineWeight(e){return 0}_getLineCode(e){return a.LineCode.solid}get isLitSurface(){return!1}get hasBakedLighting(){return!1}get hasAnimation(){return!1}get material(){}get polylineBuffers(){}set uniformFeatureIndices(e){}get featuresInfo(){}get debugString(){return""}get isEdge(){switch(this.renderOrder){case 4:case 5:case 12:case 13:return!0;default:return!1}}wantWoWReversal(e){return!e.isOverlayPass&&this._wantWoWReversal(e.target)}getLineCode(e){return e.target.currentViewFlags.styles?this._getLineCode(e):a.LineCode.solid}getLineWeight(e){if(!e.target.currentViewFlags.weights)return 1;let t=this._getLineWeight(e);return t=Math.max(t,1),t=Math.min(t,31),Math.floor(t),t}wantMixHiliteColorForFlash(e,t){return!(!this.hasBakedLighting&&4!==this.getRenderPass(t))||!!this.isLitSurface&&(6===e.renderMode&&(e.sourceLights||e.cameraLights||e.solarLight))}}t.CachedGeometry=CachedGeometry;t.LUTGeometry=class LUTGeometry extends CachedGeometry{getColor(e){return this.lut.colorInfo}get qOrigin(){return this.lut.qOrigin}get qScale(){return this.lut.qScale}get hasAnimation(){return void 0!==this.lut.auxDisplacements||void 0!==this.lut.auxParams||void 0!==this.lut.auxNormals}constructor(){super()}};class IndexedGeometryParams{constructor(e,t,r){this.positions=e,this.indices=t,this.numIndices=r}static create(e,t,r){const n=s.QBufferHandle3d.create(t,e),i=s.BufferHandle.createBuffer(c.GL.Buffer.Target.ElementArrayBuffer,r);if(void 0!==n&&void 0!==i)return!n.isDisposed&&i.isDisposed,new IndexedGeometryParams(n,i,r.length)}static createFromList(e,t){return IndexedGeometryParams.create(e.toTypedArray(),e.params,t)}dispose(){i.dispose(this.positions),i.dispose(this.indices)}}t.IndexedGeometryParams=IndexedGeometryParams;class IndexedGeometry extends CachedGeometry{_wantWoWReversal(e){return!1}constructor(e){super(),this._params=e}dispose(){i.dispose(this._params)}bindVertexArray(e){e.enableArray(this._params.positions,3,c.GL.DataType.UnsignedShort,!1,0,0)}draw(){this._params.indices.bind(c.GL.Buffer.Target.ElementArrayBuffer),l.System.instance.context.drawElements(c.GL.PrimitiveType.Triangles,this._params.numIndices,c.GL.DataType.UnsignedInt,0)}get qOrigin(){return this._params.positions.origin}get qScale(){return this._params.positions.scale}}t.IndexedGeometry=IndexedGeometry;t.ClipMaskGeometry=class ClipMaskGeometry extends IndexedGeometry{constructor(e,t){super(IndexedGeometryParams.createFromList(t,e))}getTechniqueId(e){return 15}getRenderPass(e){return 255}get renderOrder(){return 2}};class SkyBoxQuads{constructor(){const e=new n.QPoint3dList(n.QParams3d.fromNormalizedRange());e.add(new o.Point3d(-1,1,1)),e.add(new o.Point3d(1,1,1)),e.add(new o.Point3d(-1,-1,1)),e.add(new o.Point3d(1,1,1)),e.add(new o.Point3d(1,-1,1)),e.add(new o.Point3d(-1,-1,1)),e.add(new o.Point3d(-1,1,-1)),e.add(new o.Point3d(1,1,-1)),e.add(new o.Point3d(-1,-1,-1)),e.add(new o.Point3d(1,1,-1)),e.add(new o.Point3d(1,-1,-1)),e.add(new o.Point3d(-1,-1,-1)),e.add(new o.Point3d(-1,1,-1)),e.add(new o.Point3d(1,1,-1)),e.add(new o.Point3d(1,1,1)),e.add(new o.Point3d(-1,1,-1)),e.add(new o.Point3d(-1,1,1)),e.add(new o.Point3d(1,1,1)),e.add(new o.Point3d(-1,-1,1)),e.add(new o.Point3d(1,-1,1)),e.add(new o.Point3d(-1,-1,-1)),e.add(new o.Point3d(1,-1,1)),e.add(new o.Point3d(1,-1,-1)),e.add(new o.Point3d(-1,-1,-1)),e.add(new o.Point3d(-1,1,1)),e.add(new o.Point3d(-1,1,-1)),e.add(new o.Point3d(-1,-1,1)),e.add(new o.Point3d(-1,1,-1)),e.add(new o.Point3d(-1,-1,-1)),e.add(new o.Point3d(-1,-1,1)),e.add(new o.Point3d(1,1,1)),e.add(new o.Point3d(1,1,-1)),e.add(new o.Point3d(1,-1,1)),e.add(new o.Point3d(1,1,-1)),e.add(new o.Point3d(1,-1,-1)),e.add(new o.Point3d(1,-1,1)),this.vertices=e.toTypedArray(),this.vertexParams=e.params}createParams(){return SkyBoxGeometryParams.create(this.vertices,this.vertexParams)}}class SkyBoxGeometryParams{constructor(e){this.positions=e}static create(e,t){const r=s.QBufferHandle3d.create(t,e);if(void 0!==r)return r.isDisposed,new SkyBoxGeometryParams(r)}dispose(){i.dispose(this.positions)}}t.SkyBoxGeometryParams=SkyBoxGeometryParams,function(e){let t;e.getInstance=function(){return void 0===t&&(t=new e),t}}(SkyBoxQuads||(SkyBoxQuads={}));class SkyBoxQuadsGeometry extends CachedGeometry{constructor(e,t){super(),this.cube=t,this._techniqueId=16,this._params=e}static create(e){const t=SkyBoxQuads.getInstance().createParams();return void 0!==t?new SkyBoxQuadsGeometry(t,e):void 0}getTechniqueId(e){return this._techniqueId}getRenderPass(e){return 10}get renderOrder(){return 2}bindVertexArray(e){e.enableArray(this._params.positions,3,c.GL.DataType.UnsignedShort,!1,0,0)}draw(){l.System.instance.context.drawArrays(c.GL.PrimitiveType.Triangles,0,36)}get qOrigin(){return this._params.positions.origin}get qScale(){return this._params.positions.scale}dispose(){i.dispose(this._params)}_wantWoWReversal(e){return!1}}t.SkyBoxQuadsGeometry=SkyBoxQuadsGeometry;class ViewportQuad{constructor(){this.indices=new Uint32Array(6);const e=new o.Point3d(-1,-1,0),t=new n.QPoint3dList(n.QParams3d.fromNormalizedRange());t.add(e),e.x=1,t.add(e),e.y=1,t.add(e),e.x=-1,t.add(e),this.vertices=t.toTypedArray(),this.vertexParams=t.params,this.indices[0]=0,this.indices[1]=1,this.indices[2]=2,this.indices[3]=0,this.indices[4]=2,this.indices[5]=3}createParams(){return IndexedGeometryParams.create(this.vertices,this.vertexParams,this.indices)}}!function(e){let t;e.getInstance=function(){return void 0===t&&(t=new e),t}}(ViewportQuad||(ViewportQuad={}));class ViewportQuadGeometry extends IndexedGeometry{constructor(e,t){super(e),this._techniqueId=t}static create(e){const t=ViewportQuad.getInstance().createParams();return void 0!==t?new ViewportQuadGeometry(t,e):void 0}getTechniqueId(e){return this._techniqueId}getRenderPass(e){return 3}get renderOrder(){return 2}}t.ViewportQuadGeometry=ViewportQuadGeometry;class TexturedViewportQuadGeometry extends ViewportQuadGeometry{constructor(e,t,r){super(e,t),this._textures=r;for(const n of this._textures)u.TextureHandle}}t.TexturedViewportQuadGeometry=TexturedViewportQuadGeometry;class SkySphereViewportQuadGeometry extends ViewportQuadGeometry{constructor(e,t,r){super(e,r),this.worldPos=new Float32Array(12),this._worldPosBuff=new s.BufferHandle,this.typeAndExponents=new Float32Array(3),this.zenithColor=new Float32Array(3),this.skyColor=new Float32Array(3),this.groundColor=new Float32Array(3),this.nadirColor=new Float32Array(3),this.zOffset=t.zOffset;const n=t.sphere;if(this.rotation=void 0!==n?n.rotation:0,void 0!==n)this.skyTexture=n.texture,this.typeAndExponents[0]=0,this.typeAndExponents[1]=1,this.typeAndExponents[2]=1,this.zenithColor[0]=0,this.zenithColor[1]=0,this.zenithColor[2]=0,this.nadirColor[0]=0,this.nadirColor[1]=0,this.nadirColor[2]=0,this.skyColor[0]=0,this.skyColor[1]=0,this.skyColor[2]=0,this.groundColor[0]=0,this.groundColor[1]=0,this.groundColor[2]=0;else{const e=t.gradient;this.zenithColor[0]=e.zenithColor.colors.r/255,this.zenithColor[1]=e.zenithColor.colors.g/255,this.zenithColor[2]=e.zenithColor.colors.b/255,this.nadirColor[0]=e.nadirColor.colors.r/255,this.nadirColor[1]=e.nadirColor.colors.g/255,this.nadirColor[2]=e.nadirColor.colors.b/255,e.twoColor?(this.typeAndExponents[0]=-1,this.typeAndExponents[1]=4,this.typeAndExponents[2]=4,this.skyColor[0]=0,this.skyColor[1]=0,this.skyColor[2]=0,this.groundColor[0]=0,this.groundColor[1]=0,this.groundColor[2]=0):(this.typeAndExponents[0]=1,this.typeAndExponents[1]=e.skyExponent,this.typeAndExponents[2]=e.groundExponent,this.skyColor[0]=e.skyColor.colors.r/255,this.skyColor[1]=e.skyColor.colors.g/255,this.skyColor[2]=e.skyColor.colors.b/255,this.groundColor[0]=e.groundColor.colors.r/255,this.groundColor[1]=e.groundColor.colors.g/255,this.groundColor[2]=e.groundColor.colors.b/255)}}static createGeometry(e){const t=ViewportQuad.getInstance().createParams();if(void 0===t)return;const r=void 0!==e.sphere?18:17;return new SkySphereViewportQuadGeometry(t,e,r)}get worldPosBuff(){return this._worldPosBuff}bind(){this._worldPosBuff.bindData(c.GL.Buffer.Target.ArrayBuffer,this.worldPos,c.GL.Buffer.Usage.StreamDraw)}dispose(){i.dispose(this._worldPosBuff)}}t.SkySphereViewportQuadGeometry=SkySphereViewportQuadGeometry;class CompositeGeometry extends TexturedViewportQuadGeometry{static createGeometry(e,t,r,n){const i=ViewportQuad.getInstance().createParams();if(void 0!==i)return new CompositeGeometry(i,[e,t,r,n])}get opaque(){return this._textures[0]}get accum(){return this._textures[1]}get reveal(){return this._textures[2]}get hilite(){return this._textures[3]}update(e){this._techniqueId=this.determineTechnique(e)}determineTechnique(e){switch(e){case 2:return 6;case 1:return 7;default:return 8}}constructor(e,t){super(e,6,t),this._textures.length}}t.CompositeGeometry=CompositeGeometry;class CopyPickBufferGeometry extends TexturedViewportQuadGeometry{static createGeometry(e,t,r){const n=ViewportQuad.getInstance().createParams();return void 0!==n?new CopyPickBufferGeometry(n,[e,t,r]):void 0}get elemIdLow(){return this._textures[0]}get elemIdHigh(){return this._textures[1]}get depthAndOrder(){return this._textures[2]}constructor(e,t){super(e,10,t)}}t.CopyPickBufferGeometry=CopyPickBufferGeometry;class SingleTexturedViewportQuadGeometry extends TexturedViewportQuadGeometry{static createGeometry(e,t){const r=ViewportQuad.getInstance().createParams();if(void 0!==r)return new SingleTexturedViewportQuadGeometry(r,e,t)}get texture(){return this._textures[0]}set texture(e){this._textures[0]=e}constructor(e,t,r){super(e,r,[t])}}t.SingleTexturedViewportQuadGeometry=SingleTexturedViewportQuadGeometry;class PolylineBuffers{constructor(e,t,r,n){this.indices=e,this.prevIndices=t,this.nextIndicesAndParams=r,this.distances=n}static create(e){const t=s.BufferHandle.createArrayBuffer(e.indices.data),r=s.BufferHandle.createArrayBuffer(e.prevIndices.data),n=s.BufferHandle.createArrayBuffer(e.nextIndicesAndParams),i=s.BufferHandle.createArrayBuffer(e.distances);return void 0!==t&&void 0!==r&&void 0!==n&&void 0!==i?new PolylineBuffers(t,r,n,i):void 0}dispose(){i.dispose(this.indices),i.dispose(this.prevIndices),i.dispose(this.nextIndicesAndParams),i.dispose(this.distances)}}t.PolylineBuffers=PolylineBuffers},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(313),i=r(31),o=r(7),s=r(526),a=r(142);var c;!function(e){e[e.Boolean=0]="Boolean",e[e.Int=1]="Int",e[e.Float=2]="Float",e[e.Vec2=3]="Vec2",e[e.Vec3=4]="Vec3",e[e.Vec4=5]="Vec4",e[e.Mat3=6]="Mat3",e[e.Mat4=7]="Mat4",e[e.Sampler2D=8]="Sampler2D",e[e.SamplerCube=9]="SamplerCube",e[e.COUNT=10]="COUNT"}(t.VariableType||(t.VariableType={})),function(e){e[e.Global=0]="Global",e[e.Varying=1]="Varying",e[e.Uniform=2]="Uniform",e[e.Attribute=3]="Attribute",e[e.COUNT=4]="COUNT"}(t.VariableScope||(t.VariableScope={})),function(e){e[e.Default=0]="Default",e[e.Low=1]="Low",e[e.Medium=2]="Medium",e[e.High=3]="High",e[e.COUNT=4]="COUNT"}(t.VariablePrecision||(t.VariablePrecision={})),function(e){e.typeToString=function(e){switch(e){case 0:return"bool";case 1:return"int";case 2:return"float";case 3:return"vec2";case 4:return"vec3";case 5:return"vec4";case 6:return"mat3";case 7:return"mat4";case 8:return"sampler2D";case 9:return"samplerCube";default:return"undefined"}},e.scopeToString=function(e){switch(e){case 0:return"";case 1:return"varying";case 2:return"uniform";case 3:return"attribute";default:return"undefined"}},e.precisionToString=function(e){switch(e){case 0:return"";case 1:return"lowp";case 2:return"mediump";case 3:return"highp";default:return"undefined"}}}(c||(c={}));class ShaderVariable{constructor(e,t,r,n,i,o,s){this.isConst=!1,this._addBinding=o,this.name=e,this.value=s,this.type=t,this.scope=r,this.precision=n,this.isConst=i}static create(e,t,r,n,i=0){return new ShaderVariable(e,t,r,i,!1,n,void 0)}static createGlobal(e,t,r,n=!1){return new ShaderVariable(e,t,0,0,n,void 0,r)}get hasBinding(){return void 0!==this._addBinding}addBinding(e){void 0!==this._addBinding&&this._addBinding(e)}get typeName(){return c.typeToString(this.type)}get scopeName(){return c.scopeToString(this.scope)}get precisionName(){return c.precisionToString(this.precision)}buildDeclaration(){const e=new Array;this.isConst&&e.push("const");const t=this.scopeName;0<t.length&&e.push(t);const r=this.precisionName;return 0<r.length&&e.push(r),e.push(this.typeName),e.push(this.name),void 0!==this.value&&0<this.value.length&&(e.push("="),e.push(this.value)),e.join(" ")+";"}}t.ShaderVariable=ShaderVariable;class ShaderVariables{constructor(){this.list=new Array}find(e){return this.list.find(t=>t.name===e)}addVariable(e){const t=this.find(e.name);void 0!==t?(t.type,e.type):this.list.push(e)}addUniform(e,t,r,n=0){this.addVariable(ShaderVariable.create(e,t,2,r,n))}addAttribute(e,t,r){this.addVariable(ShaderVariable.create(e,t,3,r))}addVarying(e,t){this.addVariable(ShaderVariable.create(e,t,1))}addGlobal(e,t,r,n=!1){this.addVariable(ShaderVariable.createGlobal(e,t,r,n))}addConstant(e,t,r){this.addGlobal(e,t,r,!0)}buildDeclarations(){let e="";for(const t of this.list)e+=t.buildDeclaration()+"\n";return e}addBindings(e,t){for(const r of this.list)!r.hasBinding||void 0!==t&&void 0!==t.find(r.name)||r.addBinding(e)}get length(){return this.list.length}exceedsMaxVaryingVectors(){const e=[0,0,0,0,0,0,0,0];for(const t of this.list){if(1!==t.scope)continue;let r=0;switch(t.type){case 1:case 2:r=1;break;case 3:r=2;break;case 4:r=3;break;case 5:r=4;break;default:continue}let n=!1;for(let t=0;t<8;t++){const i=e[t]+r;if(i<=4){e[t]=i,n=!0;break}}if(!n)return!0}return!1}}t.ShaderVariables=ShaderVariables;class SourceBuilder{constructor(){this.source=""}add(e){this.source+=e}newline(){this.add("\n")}addline(e){this.add(e),this.newline()}static buildFunctionDefinition(e,t){return"\n"===t.charAt(0)?e+" {"+t+"}\n\n":e+" { "+t+" }\n\n"}addFunction(e,t){this.add(SourceBuilder.buildFunctionDefinition(e,t))}addMain(e){this.addFunction("void main()",e)}}t.SourceBuilder=SourceBuilder;class ShaderBuilder extends ShaderVariables{constructor(e){super(),this.components=new Array,this.functions=new Array,this.extensions=new Array,this.headerComment="",this.components.length=e}addComponent(e,t){this.components.length,this.components[e]=t}removeComponent(e){this.components.length,this.components[e]=void 0}getComponent(e){return this.components.length,this.components[e]}addFunction(e,t){let r=e;void 0!==t&&(r=SourceBuilder.buildFunctionDefinition("\n"+e,t)),void 0===this.findFunction(r)&&this.functions.push(r)}replaceFunction(e,t){const r=this.functions.indexOf(e);return-1!==r&&(this.functions[r]=t),-1!==r}findFunction(e){return this.functions.find(t=>t===e)}addExtension(e){-1===this.extensions.indexOf(e)&&this.extensions.push(e)}buildPreludeCommon(e=!1,t=!1,r=0){const n=new SourceBuilder;n.addline("#version 100"),n.addline("#define TEXTURE texture2D"),n.addline("#define TEXTURE_CUBE textureCube"),r>0&&n.addline("#define MAX_CLIPPING_PLANES "+r),n.newline(),""!==this.headerComment&&(n.addline(this.headerComment),n.newline());let i=!1;for(const s of this.extensions)"GL_EXT_draw_buffers"===s&&(o.System.instance.capabilities.supportsDrawBuffers,i=!0),n.addline("#extension "+s+" : enable");n.addline("precision highp float;"),n.addline("precision highp int;"),n.newline(),n.add(this.buildDeclarations()),e&&(n.addline("#define FragColor gl_FragColor"),i&&(n.addline("#define FragColor0 gl_FragData[0]"),n.addline("#define FragColor1 gl_FragData[1]"),n.addline("#define FragColor2 gl_FragData[2]"),n.addline("#define FragColor3 gl_FragData[3]")));for(const o of this.functions)n.add(o);return 0!==this.functions.length&&n.newline(),n}}t.ShaderBuilder=ShaderBuilder,function(e){e[e.CheckForEarlyDiscard=0]="CheckForEarlyDiscard",e[e.ComputeFeatureOverrides=1]="ComputeFeatureOverrides",e[e.CheckForDiscard=2]="CheckForDiscard",e[e.ComputePosition=3]="ComputePosition",e[e.AddComputeElementId=4]="AddComputeElementId",e[e.CheckForLateDiscard=5]="CheckForLateDiscard",e[e.COUNT=6]="COUNT"}(t.VertexShaderComponent||(t.VertexShaderComponent={}));class VertexShaderBuilder extends ShaderBuilder{constructor(e,t){super(6),this._isAnimated=t,this._computedVarying=new Array,this._initializers=new Array,i.addPosition(this,e)}get computedVarying(){return this._computedVarying}get initializers(){return this._initializers}buildPrelude(){return this.buildPreludeCommon()}get(e){return this.getComponent(e)}set(e,t){this.addComponent(e,t)}unset(e){this.removeComponent(e)}addInitializer(e){this._initializers.push(e)}addComputedVarying(e,t,r){this.addVarying(e,t),this._computedVarying.push(r)}buildSource(){const e=this.buildPrelude(),t=new SourceBuilder;t.newline();const r=this.get(3);void 0!==r&&e.addFunction("vec4 computePosition(vec4 rawPos)",r);for(const i of this._initializers)t.addline("  {"+i+"  }\n");t.addline("  vec4 rawPosition = unquantizeVertexPosition(a_pos, u_qOrigin, u_qScale);"),this._isAnimated&&t.addline("  rawPosition.xyz += computeAnimationDisplacement(g_vertexLUTIndex, u_animDispParams.x, u_animDispParams.y, u_animDispParams.z, u_qAnimDispOrigin, u_qAnimDispScale);");const n=this.get(0);void 0!==n&&(e.addFunction("bool checkForEarlyDiscard(vec4 rawPos)",n),t.add(i.GLSLVertex.earlyDiscard));const o=this.get(1);void 0!==o&&(e.addFunction("void computeFeatureOverrides()",o),t.addline("  computeFeatureOverrides();"));const s=this.get(2);void 0!==s&&(e.addFunction("bool checkForDiscard()",s),t.add(i.GLSLVertex.discard)),void 0!==this.get(4)&&t.addline("  computeElementId();"),t.addline("  gl_Position = computePosition(rawPosition);");for(const i of this._computedVarying)t.addline("  "+i);const a=this.get(5);return void 0!==a&&(e.addFunction("bool checkForLateDiscard()",a),t.addline(i.GLSLVertex.lateDiscard)),e.addMain(t.source),e.source}}t.VertexShaderBuilder=VertexShaderBuilder,function(e){e[e.CheckForEarlyDiscard=0]="CheckForEarlyDiscard",e[e.ComputeBaseColor=1]="ComputeBaseColor",e[e.ApplyMaterialOverrides=2]="ApplyMaterialOverrides",e[e.ApplyFeatureColor=3]="ApplyFeatureColor",e[e.FinalizeBaseColor=4]="FinalizeBaseColor",e[e.CheckForDiscard=5]="CheckForDiscard",e[e.DiscardByAlpha=6]="DiscardByAlpha",e[e.ApplyLighting=7]="ApplyLighting",e[e.ApplyMonochrome=8]="ApplyMonochrome",e[e.ReverseWhiteOnWhite=9]="ReverseWhiteOnWhite",e[e.ApplyClipping=10]="ApplyClipping",e[e.ApplyFlash=11]="ApplyFlash",e[e.ApplyDebugColor=12]="ApplyDebugColor",e[e.AssignFragData=13]="AssignFragData",e[e.COUNT=14]="COUNT"}(t.FragmentShaderComponent||(t.FragmentShaderComponent={}));class FragmentShaderBuilder extends ShaderBuilder{constructor(){super(14),this.maxClippingPlanes=0}get(e){return this.getComponent(e)}set(e,t){this.addComponent(e,t)}unset(e){this.removeComponent(e)}addDrawBuffersExtension(){o.System.instance.capabilities.supportsDrawBuffers,this.addExtension("GL_EXT_draw_buffers")}buildSource(){const e=this.get(7),t=this.buildPrelude(void 0!==e),r=this.get(1);void 0!==r&&t.addFunction("vec4 computeBaseColor()",r);const n=new SourceBuilder;n.newline();const i=this.get(0);void 0!==i&&(t.addFunction("bool checkForEarlyDiscard()",i),n.addline("  if (checkForEarlyDiscard()) { discard; return; }"));const o=this.get(10);void 0!==o&&(t.addFunction("void applyClipping()",o),n.addline("  applyClipping();")),n.addline("  vec4 baseColor = computeBaseColor();");const s=this.get(2);void 0!==s&&(t.addFunction("vec4 applyMaterialOverrides(vec4 baseColor)",s),n.addline("  baseColor = applyMaterialOverrides(baseColor);"));const a=this.get(3);void 0!==a&&(t.addFunction("vec4 applyFeatureColor(vec4 baseColor)",a),n.addline("  baseColor = applyFeatureColor(baseColor);"));const c=this.get(4);void 0!==c&&(t.addFunction("vec4 finalizeBaseColor(vec4 baseColor)",c),n.addline("  baseColor = finalizeBaseColor(baseColor);"));const l=this.get(5);void 0!==l&&(t.addFunction("bool checkForDiscard(vec4 baseColor)",l),n.addline("  if (checkForDiscard(baseColor)) { discard; return; }"));const u=this.get(6);void 0!==u&&(t.addFunction("bool discardByAlpha(float alpha)",u),n.addline("  if (discardByAlpha(baseColor.a)) { discard; return; }")),void 0!==e&&(t.addFunction("vec4 applyLighting(vec4 baseColor)",e),n.addline("  baseColor = applyLighting(baseColor);"));const d=this.get(8);void 0!==d&&(t.addFunction("vec4 applyMonochrome(vec4 baseColor)",d),n.addline("  baseColor = applyMonochrome(baseColor);"));const h=this.get(9);void 0!==h&&(t.addFunction("vec4 reverseWhiteOnWhite(vec4 baseColor)",h),n.addline("  baseColor = reverseWhiteOnWhite(baseColor);"));const p=this.get(11);void 0!==p&&(t.addFunction("vec4 applyFlash(vec4 baseColor)",p),n.addline("  baseColor = applyFlash(baseColor);"));const f=this.get(12);void 0!==f&&(t.addFunction("vec4 applyDebugColor(vec4 baseColor)",f),n.addline("  baseColor = applyDebugColor(baseColor);"));const g=this.get(13);return void 0!==g&&(t.addFunction("void assignFragData(vec4 baseColor)",g),n.addline("  assignFragData(baseColor);")),t.addMain(n.source),t.source}buildPrelude(e){return 0===this.maxClippingPlanes||this.get(10),this.buildPreludeCommon(!0,e,this.maxClippingPlanes)}}t.FragmentShaderBuilder=FragmentShaderBuilder;class ClippingShaders{constructor(e,t){this.shaders=[],this.builder=e.clone(),s.addClipping(this.builder,a.ClipDef.forPlanes(6));const r=e.clone();s.addClipping(r,a.ClipDef.forMask()),this.maskShader=r.buildProgram(t),this.maskShader}static roundUpToNearesMultipleOf(e,t){const r=Math.ceil(e/t)*t;return r}static roundNumPlanes(e){return e<=2?e:e<=6?6:e<=120?this.roundUpToNearesMultipleOf(e,20):this.roundUpToNearesMultipleOf(e,50)}getProgram(e){if(1===e.type)return this.maskShader;if(2===e.type){e.numberOfPlanes;const t=ClippingShaders.roundNumPlanes(e.numberOfPlanes);for(const e of this.shaders)if(e.maxClippingPlanes===t)return e;this.builder.frag.maxClippingPlanes=t;const r=this.builder.buildProgram(o.System.instance.context);return this.shaders.push(r),r}}}t.ClippingShaders=ClippingShaders,function(e){e[e.Fragment=1]="Fragment",e[e.Vertex=2]="Vertex",e[e.Both=3]="Both"}(t.ShaderType||(t.ShaderType={}));class ProgramBuilder{constructor(e,t=!1){this.vert=new VertexShaderBuilder(e,t),this.frag=new FragmentShaderBuilder}addVariable(e,t){1&t&&this.frag.addVariable(e),2&t&&this.vert.addVariable(e)}addUniform(e,t,r,n=3){this.addVariable(ShaderVariable.create(e,t,2,r),n)}addAttribute(e,t,r,n=3){this.addVariable(ShaderVariable.create(e,t,3,r),n)}addVarying(e,t){this.addVariable(ShaderVariable.create(e,t,1),3)}addGlobal(e,t,r=3,n,i=!1){this.addVariable(ShaderVariable.createGlobal(e,t,n,i),r)}addInlineComputedVarying(e,t,r){this.frag.addVarying(e,t),this.vert.addComputedVarying(e,t,r)}addFunctionComputedVarying(e,t,r,n){let i="\n"+c.typeToString(t)+" "+r+"()";i=SourceBuilder.buildFunctionDefinition(i,n);const o=r+"()";this.addFunctionComputedVaryingWithArgs(e,t,o,i)}addFunctionComputedVaryingWithArgs(e,t,r,n){this.vert.addFunction(n);const i=e+" = "+r+";";this.addInlineComputedVarying(e,t,i)}buildProgram(e){this.vert.exceedsMaxVaryingVectors();const t=new n.ShaderProgram(e,this.vert.buildSource(),this.frag.buildSource(),this.vert.headerComment,this.frag.maxClippingPlanes);return this.vert.addBindings(t),this.frag.addBindings(t,this.vert),t}setDebugDescription(e){this.vert.headerComment=this.frag.headerComment="//! "+e}clone(){const e=new ProgramBuilder(!1);e.vert.headerComment=this.vert.headerComment;for(let t=0;t<this.vert.computedVarying.length;t++)e.vert.computedVarying[t]=this.vert.computedVarying[t];for(let t=0;t<this.vert.initializers.length;t++)e.vert.initializers[t]=this.vert.initializers[t];for(let t=0;t<this.vert.components.length;t++)e.vert.components[t]=this.vert.components[t];for(let t=0;t<this.vert.functions.length;t++)e.vert.functions[t]=this.vert.functions[t];for(let t=0;t<this.vert.extensions.length;t++)e.vert.extensions[t]=this.vert.extensions[t];for(let t=0;t<this.vert.list.length;t++)e.vert.list[t]=this.vert.list[t];e.frag.headerComment=this.frag.headerComment,e.frag.maxClippingPlanes=this.frag.maxClippingPlanes;for(let t=0;t<this.frag.components.length;t++)e.frag.components[t]=this.frag.components[t];for(let t=0;t<this.frag.functions.length;t++)e.frag.functions[t]=this.frag.functions[t];for(let t=0;t<this.frag.extensions.length;t++)e.frag.extensions[t]=this.frag.extensions[t];for(let t=0;t<this.frag.list.length;t++)e.frag.list[t]=this.frag.list[t];return e}}t.ProgramBuilder=ProgramBuilder},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(44),i=r(7),o=(r(0),r(138)),s="\nbool isShaderBitSet(float flag) { return 0.0 != extractNthBit(floor(u_shaderFlags + 0.5), flag); }\n";function a(e){e.addConstant("kShaderBit_Monochrome",2,"0.0"),e.addConstant("kShaderBit_NonUniformColor",2,"1.0"),e.addConstant("kShaderBit_OITFlatAlphaWeight",2,"2.0"),e.addConstant("kShaderBit_OITScaleOutput",2,"3.0"),e.addFunction(l.extractNthBit),e.addFunction(s)}t.addViewMatrix=function(e){e.addUniform("u_viewMatrix",7,e=>{e.addGraphicUniform("u_viewMatrix",(e,t)=>{e.setMatrix4(t.viewMatrix)})})},t.addShaderFlags=function(e){a(e.vert),a(e.frag),e.addUniform("u_shaderFlags",2,e=>{e.addGraphicUniform("u_shaderFlags",(e,t)=>{!function(e,t){t.geometry,n.LUTGeometry;const r=t.geometry;let s=t.target.currentShaderFlags;r.getColor(t.target).isNonUniform&&(s|=2);const a=i.System.instance.capabilities.maxRenderType,c=t.geometry instanceof o.SurfaceGeometry?t.geometry:void 0;(void 0!==c&&(c.isGlyph||c.isTileSection)||0===a)&&(s|=4),a<1&&(s|=8),e.setUniform1f(s)}(e,t)})})},t.addFrustum=function(e){e.addUniform("u_frustum",4,e=>{e.addProgramUniform("u_frustum",(e,t)=>{e.setUniform3fv(t.target.frustumUniforms.frustum)})}),e.addGlobal("kFrustumType_Ortho2d",2,3,"0.0",!0),e.addGlobal("kFrustumType_Ortho3d",2,3,"1.0",!0),e.addGlobal("kFrustumType_Perspective",2,3,"2.0",!0)};const c="v_eyeSpace = (u_mv * rawPosition);";var l;t.addEyeSpace=function(e){e.addInlineComputedVarying("v_eyeSpace",5,c)},function(e){e.extractNthBit="\nfloat extractNthBit(float flags, float n) {\n  float denom = pow(2.0, n+1.0);\n  return floor(fract(flags/denom)*2.0);\n}\n",e.floatToBool="\nbool floatToBool(float f) { return floor(f + 0.5) > 0.0; }\n"}(l=t.GLSLCommon||(t.GLSLCommon={}))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(80));var i=r(188);t.PresentationError=i.PresentationError,t.PresentationStatus=i.PresentationStatus;var o=r(553);t.KeySet=o.default,n(r(325)),n(r(559));var s=r(329);t.PresentationRpcInterface=s.default;var a=r(560);t.RpcRequestsHandler=a.default,n(r(561));var c=r(569);t.RulesetVariablesState=c.RulesetVariablesState,n(r(570)),n(r(571))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"===typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"===typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,l=[],u=!1,d=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&p())}function p(){if(!u){var e=a(h);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(5);var o,s;function a(e,t){if(e)return e.clone(t)}!function(e){e[e.isolated=0]="isolated",e[e.isolatedAtVertex=1]="isolatedAtVertex",e[e.intervalStart=10]="intervalStart",e[e.intervalInterior=11]="intervalInterior",e[e.intervalEnd=12]="intervalEnd"}(o=t.CurveIntervalRole||(t.CurveIntervalRole={})),function(e){e[e.error=0]="error",e[e.success=1]="success",e[e.stoppedAtBoundary=2]="stoppedAtBoundary"}(s=t.CurveSearchStatus||(t.CurveSearchStatus={}));class CurveLocationDetail{constructor(){this.pointQ=n.Point3d.createZero(),this.fraction=0,this.point=n.Point3d.createZero(),this.a=0}setIntervalRole(e){this.intervalRole=e}get isIsolated(){return void 0===this.intervalRole||this.intervalRole===o.isolated||this.intervalRole===o.isolatedAtVertex}clone(e){return e===this?e:((e=e||new CurveLocationDetail).curve=this.curve,e.fraction=this.fraction,e.point.setFromPoint3d(this.point),e.vectorInCurveLocationDetail=a(this.vectorInCurveLocationDetail,e.vectorInCurveLocationDetail),e.a=this.a,e.curveSearchStatus=this.curveSearchStatus,e)}setFP(e,t,r,n=0){this.fraction=e,this.point.setFrom(t),this.vectorInCurveLocationDetail=a(r,this.vectorInCurveLocationDetail),this.a=n}setFR(e,t,r=0){return this.setFP(e,t.origin,t.direction,r)}setCurve(e){this.curve=e}setDistanceTo(e){this.a=this.point.distance(e)}static create(e,t){return(t=t||new CurveLocationDetail).curve=e,t}static createCurveFractionPoint(e,t,r,n){return(n=n||new CurveLocationDetail).curve=e,n.fraction=t,n.point.setFromPoint3d(r),n.vectorInCurveLocationDetail=void 0,n.a=0,n.curveSearchStatus=void 0,n}static createCurveFractionPointDistanceCurveSearchStatus(e,t,r,n,i,o){return(o=o||new CurveLocationDetail).curve=e,o.fraction=t,o.point.setFromPoint3d(r),o.vectorInCurveLocationDetail=void 0,o.a=n,o.curveSearchStatus=i,o}static createConditionalMoveSignedDistance(e,t,r,n,o,a){let c=o,l=s.success;return e||i.Geometry.isIn01(n)||(n<0?(c=-t.curveLengthBetweenFractions(r,0),n=0,l=s.stoppedAtBoundary):n>1&&(n=1,c=t.curveLengthBetweenFractions(r,1),l=s.stoppedAtBoundary)),(a=a||new CurveLocationDetail).curve=t,a.fraction=n,a.point=t.fractionToPoint(n,a.point),a.vectorInCurveLocationDetail=void 0,a.a=c,a.curveSearchStatus=l,a}static createCurveEvaluatedFraction(e,t,r){return(r=r||new CurveLocationDetail).curve=e,r.fraction=t,r.point=e.fractionToPoint(t),r.vectorInCurveLocationDetail=void 0,r.curveSearchStatus=void 0,r.a=0,r}static createCurveFractionPointDistance(e,t,r,n,i){return(i=i||new CurveLocationDetail).curve=e,i.fraction=t,i.point.setFromPoint3d(r),i.vectorInCurveLocationDetail=void 0,i.a=n,i.curveSearchStatus=void 0,i}updateIfCloserCurveFractionPointDistance(e,t,r,n){return!(this.a<n)&&(CurveLocationDetail.createCurveFractionPointDistance(e,t,r,n,this),!0)}}t.CurveLocationDetail=CurveLocationDetail;class CurveLocationDetailPair{constructor(){this.detailA=new CurveLocationDetail,this.detailB=new CurveLocationDetail}static createDetailRef(e,t,r){return(r=r||new CurveLocationDetailPair).detailA=e,r.detailB=t,r}clone(e){return(e=e||new CurveLocationDetailPair).detailA=this.detailA.clone(),e.detailB=this.detailB.clone(),e}}t.CurveLocationDetailPair=CurveLocationDetailPair},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(23),i=r(9);t.GeometryQuery=class GeometryQuery{range(e,t){t&&t.setNull();const r=t||n.Range3d.createNull();return this.extendRange(r,e),r}tryTranslateInPlace(e,t=0,r=0){return this.tryTransformInPlace(i.Transform.createTranslationXYZ(e,t,r))}get children(){}isAlmostEqual(e){if(this.isSameGeometryClass(e)){const t=this.children,r=e.children;if(t&&r){if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(!t[e].isAlmostEqual(r[e]))return!1;return!0}return!t&&!r}return!1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(59),o=r(6),s=r(21),a=r(22),c=r(38),l=r(49),u=r(14);class LineSegment3d extends c.CurvePrimitive{isSameGeometryClass(e){return e instanceof LineSegment3d}get point0Ref(){return this._point0}get point1Ref(){return this._point1}get isExtensibleFractionSpace(){return!0}constructor(e,t){super(),this._point0=e,this._point1=t}setRefs(e,t){this._point0=e,this._point1=t}set(e,t){this._point0=e.clone(),this._point1=t.clone()}setFrom(e){this._point0.setFrom(e._point0),this._point1.setFrom(e._point1)}startPoint(e){return e?(e.setFrom(this._point0),e):this._point0.clone()}endPoint(e){return e?(e.setFrom(this._point1),e):this._point1.clone()}fractionToPointAndDerivative(e,t){return(t=t||s.Ray3d.createZero()).direction.setStartEnd(this._point0,this._point1),this._point0.interpolate(e,this._point1,t.origin),t}fractionToPointAnd2Derivatives(e,t){return(t=t||a.Plane3dByOriginAndVectors.createXYPlane()).vectorU.setStartEnd(this._point0,this._point1),t.vectorV.set(0,0,0),this._point0.interpolate(e,this._point1,t.origin),t}clone(){return LineSegment3d.create(this._point0,this._point1)}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}static create(e,t,r){return r?(r.set(e,t),r):new LineSegment3d(e.clone(),t.clone())}static createXYXY(e,t,r,n,i=0,s){return s?(s._point0.set(e,t,i),s._point1.set(r,n,i),s):new LineSegment3d(o.Point3d.create(e,t,i),o.Point3d.create(r,n,i))}static createXYZXYZ(e,t,r,n,i,s,a){return a?(a._point0.set(e,t,r),a._point1.set(n,i,s),a):new LineSegment3d(o.Point3d.create(e,t,r),o.Point3d.create(n,i,s))}fractionToPoint(e,t){return this._point0.interpolate(e,this._point1,t)}curveLength(){return this._point0.distance(this._point1)}curveLengthBetweenFractions(e,t){return Math.abs(t-e)*this._point0.distance(this._point1)}quickLength(){return this.curveLength()}closestPoint(e,t,r){let n=e.fractionOfProjectionToLine(this._point0,this._point1,0);return t||(n>1?n=1:n<0&&(n=0)),(r=l.CurveLocationDetail.create(this,r)).fraction=n,this._point0.interpolate(n,this._point1,r.point),r.vectorInCurveLocationDetail=void 0,r.a=r.point.distance(e),r}reverseInPlace(){const e=this._point0;this._point0=this._point1,this._point1=e}tryTransformInPlace(e){return this._point0=e.multiplyPoint3d(this._point0,this._point0),this._point1=e.multiplyPoint3d(this._point1,this._point1),!0}isInPlane(e){return n.Geometry.isSmallMetricDistance(e.altitude(this._point0))&&n.Geometry.isSmallMetricDistance(e.altitude(this._point1))}appendPlaneIntersectionPoints(e,t){const r=e.altitude(this._point0),n=e.altitude(this._point1),o=i.Order2Bezier.solveCoffs(r,n);let s=0;return void 0!==o&&(s++,t.push(l.CurveLocationDetail.createCurveFractionPoint(this,o,this.fractionToPoint(o)))),s}extendRange(e,t){t?(e.extendTransformedPoint(t,this._point0),e.extendTransformedPoint(t,this._point1)):(e.extendPoint(this._point0),e.extendPoint(this._point1))}setFromJSON(e){if(!e)return this._point0.set(0,0,0),void this._point1.set(1,0,0);e.startPoint&&e.endPoint?(this._point0.setFromJSON(e.startPoint),this._point1.setFromJSON(e.endPoint)):Array.isArray(e)&&e.length>1&&(this._point0.setFromJSON(e[0]),this._point1.setFromJSON(e[1]))}getFractionToDistanceScale(){return this.curveLength()}toJSON(){return[this._point0.toJSON(),this._point1.toJSON()]}static fromJSON(e){const t=new LineSegment3d(o.Point3d.createZero(),o.Point3d.create());return t.setFromJSON(e),t}isAlmostEqual(e){if(e instanceof LineSegment3d){const t=e;return this._point0.isAlmostEqual(t._point0)&&this._point1.isAlmostEqual(t._point1)}return!1}emitStrokes(e,t){if(e.appendStrokePoint(this._point0),t){let r=1;t.maxEdgeLength&&(r=t.applyMaxEdgeLength(r,this.curveLength())),r=t.applyMinStrokesPerPrimitive(r),e.appendFractionalStrokePoints(this,r,0,1,!1)}e.appendStrokePoint(this._point1)}emitStrokableParts(e,t){e.startCurvePrimitive(this);const r=this._point0.vectorTo(this._point1);let n=1;t&&(t.maxEdgeLength&&(n=t.applyMaxEdgeLength(n,r.magnitude())),n=t.applyMinStrokesPerPrimitive(n)),e.announceSegmentInterval(this,this._point0,this._point1,n,0,1),e.endCurvePrimitive(this)}dispatchToGeometryHandler(e){return e.handleLineSegment3d(this)}announceClipIntervals(e,t){return e.announceClippedSegmentIntervals(0,1,this._point0,this._point1,t?(e,r)=>t(e,r,this):void 0)}clonePartialCurve(e,t){return u.LineString3d.create(this.fractionToPoint(e),this.fractionToPoint(t))}}t.LineSegment3d=LineSegment3d},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(42),i=r(73),o=r(102),s=r(15),a=r(0),c=r(4);t.REGISTRY=Symbol.for("@bentley/imodeljs-common/RpcRegistry"),t.OPERATION=Symbol.for("@bentley/imodeljs-common/RpcOperation"),t.POLICY=Symbol.for("@bentley/imodeljs-common/RpcOperationPolicy"),t.INSTANCE=Symbol.for("@bentley/imodeljs-common/RpcInterface/__instance__"),t.CURRENT_REQUEST=Symbol.for("@bentley/imodeljs-common/RpcRequest/__current__"),t.CURRENT_INVOCATION=Symbol.for("@bentley/imodeljs-common/RpcInvocation/__current__"),t.builtins=[];class RpcRegistry{constructor(){this.definitionClasses=new Map,this.proxies=new Map,this.implementations=new Map,this.suppliedImplementations=new Map,this.implementationClasses=new Map,this.types=new Map,this.id=(()=>{let e=0;return()=>++e})()}static get instance(){if(!RpcRegistry._instance){const r="undefined"!==typeof e?e:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{};r[t.REGISTRY]||(r[t.REGISTRY]=new RpcRegistry),RpcRegistry._instance=r[t.REGISTRY]}return RpcRegistry._instance}lookupInterfaceDefinition(e){if(!this.definitionClasses.has(e))throw new s.IModelError(32768,`RPC interface "${e}" is not initialized.`);return this.definitionClasses.get(e)}describeAvailableEndpoints(){const e=[];for(const t of o.RpcControlChannel.channels)e.push(t.describeEndpoints());return Promise.all(e).then(e=>{const t=e.reduce((e,t)=>e.concat(t),[]);for(const r of t){const e=this.definitionClasses.get(r.interfaceName);r.compatible=!(!e||!n.RpcInterface.isVersionCompatible(r.interfaceVersion,e.version))}return t})}getClientForInterface(e){let t=this.proxies.get(e.name);return t||(t=this.instantiateClient(e)),t}getImplForInterface(e){let t=this.implementations.get(e.name);return t||(t=this.instantiateImpl(e)),t}lookupImpl(e){const t=this.lookupInterfaceDefinition(e);return this.getImplForInterface(t)}registerImpl(e,t){this.unregisterImpl(e),this.implementationClasses.set(e.name,t)}unregisterImpl(e){this.implementationClasses.delete(e.name);const t=this.implementations.get(e.name);t&&(t.configuration.onRpcImplTerminated(e,t),this.implementations.delete(e.name))}supplyImplInstance(e,t){this.suppliedImplementations.set(e.name,t)}isRpcInterfaceInitialized(e){return this.definitionClasses.has(e.name)}initializeRpcInterface(e){this.definitionClasses.has(e.name)||(this.notifyInitialize(),this.definitionClasses.set(e.name,e),this.configureOperations(e),this.registerTypes(e))}terminateRpcInterface(e){this.purgeTypes(e),this.unregisterImpl(e),this.purgeClient(e),this.definitionClasses.delete(e.name)}instantiateImpl(e){this.checkInitialized(e);const t=this.implementationClasses.get(e.name);if(!t)throw new s.IModelError(32768,`An RPC interface implementation class for "${e.name}" is not registered.`);e.prototype.configurationSupplier&&(t.prototype.configurationSupplier=e.prototype.configurationSupplier);const r=this.suppliedImplementations.get(e.name),n=r||new t;if(!(n instanceof t))throw new s.IModelError(32768,"Invalid RPC interface implementation.");return r&&(r.configuration=c.RpcConfiguration.supply(r)),this.implementations.set(e.name,n),n.configuration.onRpcImplInitialized(e,n),n}instantiateClient(e){this.checkInitialized(e);const t=new e;return this.proxies.set(e.name,t),Object.getOwnPropertyNames(e.prototype).forEach(e=>{"constructor"!==e&&"configurationSupplier"!==e&&(t[e]=t[e].bind(t,e))}),t.configuration.onRpcClientInitialized(e,t),t}checkInitialized(e){if(!this.definitionClasses.has(e.name))throw new s.IModelError(32768,`RPC interface "${e.name}" is not initialized.`)}configureOperations(e){const r=e.prototype;for(const n of t.builtins){const o=Symbol.for(n);r[o]||(r[o]={[t.OPERATION]:new i.RpcOperation(e,n,new i.RpcOperationPolicy)})}Object.getOwnPropertyNames(e.prototype).forEach(n=>{if("constructor"===n||"configurationSupplier"===n)return;const o=i.RpcOperation.computeOperationName(n);if(!r[o][t.OPERATION]){const n=e[t.POLICY]||new i.RpcOperationPolicy;r[o][t.OPERATION]=new i.RpcOperation(e,o,n)}})}registerTypes(e){e.types().forEach(t=>{this.registerType(e,t,!0)});for(const t of[Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,a.BentleyError,s.IModelError,s.ServerError])this.registerType(e,t,!1)}registerType(e,t,r){const n=`${e.name}_${t.name}`;if(this.types.has(n)){if(r)throw new s.IModelError(32768,`Class "${n}" is already registered for RPC interface type marshaling.`)}else this.types.set(n,t)}purgeClient(e){const t=this.proxies.get(e.name);t&&(t.configuration.onRpcClientTerminated(e,t),this.proxies.delete(e.name))}purgeTypes(e){const t=`${e.name}_`;for(const r of this.types.keys())-1!==r.indexOf(t)&&this.types.delete(r)}notifyInitialize(){c.initializeRpcRequest(),c.RpcPendingQueue.initialize()}}t.RpcRegistry=RpcRegistry}).call(this,r(12))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(3),i=r(4),o=r(77),s=r(292),a=r(87);class PolylineArgs{constructor(e=new i.QPoint3dList(i.QParams3d.fromRange(n.Range3d.createNull())),t=[],r,o=!1,s=!1){this.colors=new i.ColorIndex,this.features=new i.FeatureIndex,this.width=0,this.linePixels=0,this.points=e,this.polylines=t,this.pointParams=void 0===r?i.QParams3d.fromRange(n.Range3d.createNull()):r,this.flags=new i.PolylineFlags(o,s)}get isValid(){return 0!==this.polylines.length}reset(){this.flags.initDefaults(),this.points=new i.QPoint3dList(i.QParams3d.fromRange(n.Range3d.createNull())),this.polylines=[],this.colors.reset(),this.features.reset()}init(e){if(this.reset(),void 0!==e.polylines)return this.width=e.displayParams.width,this.linePixels=e.displayParams.linePixels,this.flags.is2d=e.is2d,this.flags.isPlanar=e.isPlanar,this.flags.isDisjoint=2===e.type,o.DisplayParams.RegionEdgeType.Outline===e.displayParams.regionEdgeType&&(void 0===e.displayParams.gradient||e.displayParams.gradient.isOutlined?this.flags.setIsNormalEdge():this.flags.setIsOutlineEdge()),e.polylines.forEach(e=>{const t=new i.PolylineData;t.init(e)&&this.polylines.push(t)}),!!this.isValid&&(this.finishInit(e),!0)}finishInit(e){this.pointParams=e.points.params,this.points=e.points,e.colorMap.toColorIndex(this.colors,e.colors),e.toFeatureIndex(this.features)}}t.PolylineArgs=PolylineArgs;class MeshArgsEdges{constructor(){this.edges=new i.EdgeArgs,this.silhouettes=new i.SilhouetteEdgeArgs,this.polylines=new i.PolylineEdgeArgs,this.width=0,this.linePixels=0}clear(){this.edges.clear(),this.silhouettes.clear(),this.polylines.clear(),this.width=0,this.linePixels=0}get isValid(){return this.edges.isValid||this.silhouettes.isValid||this.polylines.isValid}}t.MeshArgsEdges=MeshArgsEdges;class MeshArgs{constructor(){this.edges=new MeshArgsEdges,this.colors=new i.ColorIndex,this.features=new i.FeatureIndex,this.fillFlags=i.FillFlags.None,this.isPlanar=!1,this.is2d=!1,this.hasBakedLighting=!1,this.asClassifier=!1}clear(){this.edges.clear(),this.vertIndices=void 0,this.points=void 0,this.normals=void 0,this.textureUv=void 0,this.texture=void 0,this.colors.reset(),this.features.reset(),this.material=void 0,this.fillFlags=i.FillFlags.None,this.isPlanar=this.is2d=this.hasBakedLighting=this.asClassifier=!1}init(e){if(this.clear(),void 0===e.triangles||e.triangles.isEmpty)return!1;e.points.length,this.vertIndices=e.triangles.indices,this.points=e.points,!e.displayParams.ignoreLighting&&0<e.normals.length&&(this.normals=e.normals),0<e.uvParams.length&&(this.textureUv=e.uvParams),e.colorMap.toColorIndex(this.colors,e.colors),e.toFeatureIndex(this.features),this.material=e.displayParams.material,void 0!==e.displayParams.textureMapping&&(this.texture=e.displayParams.textureMapping.texture),this.fillFlags=e.displayParams.fillFlags,this.isPlanar=e.isPlanar,this.is2d=e.is2d,this.hasBakedLighting=!0===e.hasBakedLighting,this.asClassifier=!0===e.asClassifier,this.edges.width=e.displayParams.width,this.edges.linePixels=e.displayParams.linePixels;const t=e.edges;if(void 0===t)return!0;this.edges.edges.init(e.edges),this.edges.silhouettes.init(e.edges);const r=[];return t.polylines.forEach(e=>{const t=new i.PolylineData;t.init(e)&&r.push(t)}),this.edges.polylines.init(r),!0}}t.MeshArgs=MeshArgs;t.MeshGraphicArgs=class MeshGraphicArgs{constructor(){this.polylineArgs=new PolylineArgs,this.meshArgs=new MeshArgs}};class Mesh{constructor(e){this.normals=[],this.uvParams=[],this.colorMap=new s.ColorMap,this.colors=new Uint16Array;const{displayParams:t,features:r,type:n,range:o,is2d:c,isPlanar:l}=e;this._data=0===n?new a.TriangleList:new i.MeshPolylineList,this.displayParams=t,this.features=r,this.type=n,this.is2d=c,this.isPlanar=l,this.hasBakedLighting=!0===e.hasBakedLighting,this.asClassifier=!0===e.asClassifier,this.points=new i.QPoint3dList(i.QParams3d.fromRange(o))}static create(e){return new Mesh(e)}get triangles(){return 0===this.type?this._data:void 0}get polylines(){return 0!==this.type?this._data:void 0}toFeatureIndex(e){void 0!==this.features&&this.features.toFeatureIndex(e)}getGraphics(e,t){if(void 0!==this.triangles&&0!==this.triangles.length){if(e.meshArgs.init(this))return t.createTriMesh(e.meshArgs)}else if(void 0!==this.polylines&&0!==this.polylines.length&&e.polylineArgs.init(this))return t.createIndexedPolylines(e.polylineArgs)}addPolyline(e){const{type:t,polylines:r}=this;1===t&&e.indices.length<2||void 0!==r&&r.push(e)}addTriangle(e){const{triangles:t,type:r}=this;void 0!==t&&t.addTriangle(e)}addVertex(e){const{position:t,normal:r,uvParam:n,fillColor:i}=e;return this.points.push(t),void 0!==r&&this.normals.push(r),void 0!==n&&this.uvParams.push(n),this.colorMap.insert(i),this.points.length-1}}t.Mesh=Mesh,function(e){let t;!function(e){e[e.Mesh=0]="Mesh",e[e.Polyline=1]="Polyline",e[e.Point=2]="Point"}(t=e.PrimitiveType||(e.PrimitiveType={}));e.Features=class Features{constructor(e){this.indices=[],this.uniform=0,this.initialized=!1,this.table=e}add(e,t){const r=this.table.insert(e);if(this.initialized)if(0<this.indices.length)this.indices.push(r);else{for(;this.indices.length<t-1;)this.indices.push(this.uniform);this.indices.push(r)}else this.uniform=r,this.initialized=!0}setIndices(e){this.indices.length=0,this.uniform=0,this.initialized=0<e.length,e.length,1===e.length?this.uniform=e[0]:1<e.length&&(this.indices=e)}toFeatureIndex(e){this.initialized?0===this.indices.length?(e.type=1,e.featureID=this.uniform):(e.type=2,e.featureIDs=new Uint32Array(this.indices)):e.type=0}}}(Mesh=t.Mesh||(t.Mesh={}));t.MeshList=class MeshList extends Array{constructor(e){super(),this.features=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);class FloatRgb{constructor(e,t,r){var n;this._value=new Float32Array(3),this._value[0]=e,this._value[1]=t,this._value[2]=r,(n=this).red,n.green,n.blue}static fromColorDef(e){const t=e.colors;return new FloatRgb(t.r/255,t.g/255,t.b/255)}get red(){return this._value[0]}get green(){return this._value[1]}get blue(){return this._value[2]}bind(e){e.setUniform3fv(this._value)}}t.FloatRgb=FloatRgb;class Rgba{constructor(e,t,r,n){var i;this._value=new Float32Array(4),this._value[0]=e,this._value[1]=t,this._value[2]=r,this._value[3]=n,(i=this).red,i.green,i.blue,i.alpha}get red(){return this._value[0]}get green(){return this._value[1]}get blue(){return this._value[2]}get alpha(){return this._value[3]}get hasTranslucency(){return 1!==this.alpha}equals(e){return this.red===e.red&&this.green===e.green&&this.blue===e.blue&&this.alpha===e.alpha}bind(e){e.setUniform4fv(this._value)}}t.Rgba=Rgba;class FloatRgba extends Rgba{constructor(e,t,r,n){super(e,t,r,n)}static fromPreMulRgba(e){const t=0!==e.alpha?1/e.alpha:0;return new FloatRgba(e.red*t,e.green*t,e.blue*t,e.alpha)}static fromRgb(e,t=1){return new FloatRgba(e.red,e.green,e.blue,t)}static fromColorDef(e,t){const r=e.colors;return void 0!==t&&(r.t=t),new FloatRgba(r.r/255,r.g/255,r.b/255,(255-r.t)/255)}static fromColorDefAndAlpha(e,t){const r=e.colors;return new FloatRgba(r.r/255,r.g/255,r.b/255,t)}}t.FloatRgba=FloatRgba;class FloatPreMulRgba extends Rgba{static fromRgba(e){return new FloatPreMulRgba(e.red*e.alpha,e.green*e.alpha,e.blue*e.alpha,e.alpha)}static fromColorDef(e){const t=e.colors,r=(255-t.t)/255;return new FloatPreMulRgba(t.r*r/255,t.g*r/255,t.b*r/255,r)}constructor(e,t,r,n){super(e,t,r,n)}}t.FloatPreMulRgba=FloatPreMulRgba},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1);r(600);var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("button",o({},this.props))},t}(s.Component);t.Button=a,t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class Config{constructor(){this._container={},this._expanded={}}appendSystemVars(){this.set("imjs_env_is_browser",Boolean(void 0!==typeof window)),this.merge(Object({NODE_ENV:"production",CORS_PROXY_PORT:void 0,PUBLIC_URL:"."}))}translateVar(e){const t=Object.keys(this._container).find(t=>t.toLowerCase()===e.toLowerCase());return t||e}expand(e,t){if("string"!==typeof t)return t;const r=Object.getOwnPropertyDescriptor(this._expanded,e);if(void 0!==r)return r.value;const n={},i=t.match(/\${[\w]+}/gi);return null===i?t:(i.forEach(e=>{const t=e.match(/\${([\w]+)}/i)[1];n.hasOwnProperty(t)||(n[t]=e)}),this._expanded[e]=null,Object.getOwnPropertyNames(n).forEach(e=>{const r=n[e],i=Object.getOwnPropertyDescriptor(this._expanded,e);if(void 0!==i){if(null===i.value)throw new Error(`Found recursive definition of var ${e}`);t=t.replace(r,i.value)}else{if(!this.has(e))throw new Error(`Failed to expand var ${e}`);t=t.replace(r,this.get(e))}}),t)}get(e,t){const r=this.translateVar(e),n=Object.getOwnPropertyDescriptor(this._container,r);if(void 0===n){if(void 0!==t)return t;throw new Error(`Property ${r} does not exists.`)}if("string"===typeof n.value){const e=n.value;if(null!==e.match(/\${\w+}/))return this.expand(r,e)}return n.value}has(e){const t=this.translateVar(e);return this._container.hasOwnProperty(t)}getNumber(e,t){return Number(this.get(e,t))}getBoolean(e,t){return Boolean(this.get(e,t))}getString(e,t){return String(this.get(e,t))}remove(e){const t=this.translateVar(e);if(!this.has(t))throw new Error(`Property ${t} does not exists.`);this._expanded={},delete this._container[t]}set(e,t){const r=this.translateVar(e);this._container[r]=t,this._expanded={}}getVars(){return Object.getOwnPropertyNames(this._container)}merge(e){if(void 0===e||null===e||e!==Object(e))throw new Error("source should be a object");Object.keys(e).forEach(t=>{const r=this.translateVar(t),n=e[r];if("object"===typeof n||"undefined"===typeof n||null===n)return;const i=Object.getOwnPropertyDescriptor(this._container,r);(void 0===i||i.writable)&&this.set(r,n)})}getContainer(){return JSON.parse(JSON.stringify(this._container))}static get App(){return Config._appConfig||(Config._appConfig=new Config,Config._appConfig.appendSystemVars()),Config._appConfig}}t.Config=Config},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(18);class Query{constructor(){this._query={}}getQueryOptions(){return this._query}resetQueryOptions(){this._query={}}addFilter(e,t="and"){this._query.$filter?this._query.$filter+=`+${t}+`:this._query.$filter="",this._query.$filter+=e}filter(e){return this._query.$filter=e,this}addSelect(e){return this._query.$select&&(this._query.$select+=","),this._query.$select+=e,this}select(e){return this._query.$select=e,this}top(e){return this._query.$top=e,this}skip(e){return this._query.$skip=e,this}orderBy(e){return this._query.$orderby=e,this}}t.Query=Query;t.StringIdQuery=class StringIdQuery extends Query{byId(e){return this.checkValue(e),this._byId=e,this}checkValue(e){n.ArgumentCheck.valid("id",e)}getId(){return this._byId}};t.InstanceIdQuery=class InstanceIdQuery extends Query{byId(e){return n.ArgumentCheck.validGuid("id",e),this._byId=e,this}getId(){return this._byId}},t.addSelectFileAccessKey=function(e){e.$select||(e.$select="*"),e.$select+=",FileAccessKey-forward-AccessKey.DownloadURL"}},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.aliceBlue=16775408]="aliceBlue",e[e.amber=49151]="amber",e[e.antiqueWhite=14150650]="antiqueWhite",e[e.aqua=16776960]="aqua",e[e.aquamarine=13959039]="aquamarine",e[e.azure=16777200]="azure",e[e.beige=14480885]="beige",e[e.bisque=12903679]="bisque",e[e.black=0]="black",e[e.blanchedAlmond=13495295]="blanchedAlmond",e[e.blue=16711680]="blue",e[e.blueViolet=14822282]="blueViolet",e[e.brown=2763429]="brown",e[e.burlyWood=8894686]="burlyWood",e[e.cadetBlue=10526303]="cadetBlue",e[e.chartreuse=65407]="chartreuse",e[e.chocolate=1993170]="chocolate",e[e.coral=5275647]="coral",e[e.cornflowerBlue=15570276]="cornflowerBlue",e[e.cornSilk=14481663]="cornSilk",e[e.crimson=3937500]="crimson",e[e.cyan=16776960]="cyan",e[e.darkBlue=9109504]="darkBlue",e[e.darkBrown=2179941]="darkBrown",e[e.darkCyan=9145088]="darkCyan",e[e.darkGoldenrod=755384]="darkGoldenrod",e[e.darkGray=11119017]="darkGray",e[e.darkGreen=25600]="darkGreen",e[e.darkGrey=11119017]="darkGrey",e[e.darkKhaki=7059389]="darkKhaki",e[e.darkMagenta=9109643]="darkMagenta",e[e.darkOliveGreen=3107669]="darkOliveGreen",e[e.darkOrange=36095]="darkOrange",e[e.darkOrchid=13382297]="darkOrchid",e[e.darkRed=139]="darkRed",e[e.darkSalmon=8034025]="darkSalmon",e[e.darkSeagreen=9419919]="darkSeagreen",e[e.darkSlateBlue=9125192]="darkSlateBlue",e[e.darkSlateGray=5197615]="darkSlateGray",e[e.darkSlateGrey=5197615]="darkSlateGrey",e[e.darkTurquoise=13749760]="darkTurquoise",e[e.darkViolet=13828244]="darkViolet",e[e.deepPink=9639167]="deepPink",e[e.deepSkyBlue=16760576]="deepSkyBlue",e[e.dimGray=6908265]="dimGray",e[e.dimGrey=6908265]="dimGrey",e[e.dodgerBlue=16748574]="dodgerBlue",e[e.fireBrick=2237106]="fireBrick",e[e.floralWhite=15792895]="floralWhite",e[e.forestGreen=2263842]="forestGreen",e[e.fuchsia=16711935]="fuchsia",e[e.gainsboro=14474460]="gainsboro",e[e.ghostWhite=16775416]="ghostWhite",e[e.gold=55295]="gold",e[e.goldenrod=2139610]="goldenrod",e[e.gray=8421504]="gray",e[e.green=32768]="green",e[e.greenYellow=3145645]="greenYellow",e[e.grey=8421504]="grey",e[e.honeydew=15794160]="honeydew",e[e.hotPink=11823615]="hotPink",e[e.indianRed=6053069]="indianRed",e[e.indigo=8519755]="indigo",e[e.ivory=15794175]="ivory",e[e.khaki=9234160]="khaki",e[e.lavender=16443110]="lavender",e[e.lavenderBlush=16118015]="lavenderBlush",e[e.lawnGreen=64636]="lawnGreen",e[e.lemonChiffon=13499135]="lemonChiffon",e[e.lightBlue=15128749]="lightBlue",e[e.lightCoral=8421616]="lightCoral",e[e.lightCyan=16777184]="lightCyan",e[e.lightGoldenrodYellow=13826810]="lightGoldenrodYellow",e[e.lightGray=13882323]="lightGray",e[e.lightGreen=9498256]="lightGreen",e[e.lightGrey=13882323]="lightGrey",e[e.lightPink=12695295]="lightPink",e[e.lightSalmon=8036607]="lightSalmon",e[e.lightSeagreen=11186720]="lightSeagreen",e[e.lightSkyBlue=16436871]="lightSkyBlue",e[e.lightSlateGray=10061943]="lightSlateGray",e[e.lightSlateGrey=10061943]="lightSlateGrey",e[e.lightSteelBlue=14599344]="lightSteelBlue",e[e.lightyellow=14745599]="lightyellow",e[e.lime=65280]="lime",e[e.limeGreen=3329330]="limeGreen",e[e.linen=15134970]="linen",e[e.magenta=16711935]="magenta",e[e.maroon=128]="maroon",e[e.mediumAquamarine=11193702]="mediumAquamarine",e[e.mediumBlue=13434880]="mediumBlue",e[e.mediumOrchid=13850042]="mediumOrchid",e[e.mediumPurple=14381203]="mediumPurple",e[e.mediumSeaGreen=7451452]="mediumSeaGreen",e[e.mediumSlateBlue=15624315]="mediumSlateBlue",e[e.mediumSpringGreen=10156544]="mediumSpringGreen",e[e.mediumTurquoise=13422920]="mediumTurquoise",e[e.mediumVioletRed=8721863]="mediumVioletRed",e[e.midnightBlue=7346457]="midnightBlue",e[e.mintCream=16449525]="mintCream",e[e.mistyRose=14804223]="mistyRose",e[e.moccasin=11920639]="moccasin",e[e.navajoWhite=11394815]="navajoWhite",e[e.navy=8388608]="navy",e[e.oldLace=15136253]="oldLace",e[e.olive=32896]="olive",e[e.oliveDrab=2330219]="oliveDrab",e[e.orange=42495]="orange",e[e.orangeRed=17919]="orangeRed",e[e.orchid=14053594]="orchid",e[e.paleGoldenrod=11200750]="paleGoldenrod",e[e.paleGreen=10025880]="paleGreen",e[e.paleTurquoise=15658671]="paleTurquoise",e[e.paleVioletRed=9662683]="paleVioletRed",e[e.papayaWhip=14020607]="papayaWhip",e[e.peachPuff=12180223]="peachPuff",e[e.peru=4163021]="peru",e[e.pink=13353215]="pink",e[e.plum=14524637]="plum",e[e.powderBlue=15130800]="powderBlue",e[e.purple=8388736]="purple",e[e.rebeccaPurple=10040166]="rebeccaPurple",e[e.red=255]="red",e[e.rosyBrown=9408444]="rosyBrown",e[e.royalBlue=14772545]="royalBlue",e[e.saddleBrown=1262987]="saddleBrown",e[e.salmon=7504122]="salmon",e[e.sandyBrown=6333684]="sandyBrown",e[e.seaGreen=5737262]="seaGreen",e[e.seaShell=15660543]="seaShell",e[e.sienna=2970272]="sienna",e[e.silver=12632256]="silver",e[e.skyBlue=15453831]="skyBlue",e[e.slateBlue=13458026]="slateBlue",e[e.slateGray=9470064]="slateGray",e[e.slateGrey=9470064]="slateGrey",e[e.snow=16448255]="snow",e[e.springGreen=8388352]="springGreen",e[e.steelBlue=11829830]="steelBlue",e[e.tan=9221330]="tan",e[e.teal=8421376]="teal",e[e.thistle=14204888]="thistle",e[e.tomato=4678655]="tomato",e[e.turquoise=13688896]="turquoise",e[e.violet=15631086]="violet",e[e.wheat=11788021]="wheat",e[e.white=16777215]="white",e[e.whiteSmoke=16119285]="whiteSmoke",e[e.yellow=65535]="yellow",e[e.yellowGreen=3329434]="yellowGreen"}(n=t.ColorByName||(t.ColorByName={})),function(e){e[e.VISIBILITY_GOAL=40]="VISIBILITY_GOAL",e[e.HSV_SATURATION_WEIGHT=4]="HSV_SATURATION_WEIGHT",e[e.HSV_VALUE_WEIGHT=2]="HSV_VALUE_WEIGHT"}(i||(i={}));class HSLColor{constructor(){this.h=0,this.s=0,this.l=0}clone(){const e=new HSLColor;return e.h=this.h,e.s=this.s,e.l=this.l,e}toColorDef(e){return ColorDef.fromHSL(this.h,this.s,this.l,e)}static fromColorDef(e,t){return e.toHSL(t)}}t.HSLColor=HSLColor;class HSVColor{constructor(){this.h=0,this.s=0,this.v=0}clone(){const e=new HSVColor;return e.h=this.h,e.s=this.s,e.v=this.v,e}toColorDef(e){return ColorDef.fromHSV(this,e)}static fromColorDef(e,t){return e.toHSV(t)}adjustColor(e,t){if(e){let e=2*t;this.v>=e?this.v-=e:(e-=this.v,this.v=0,this.s=this.s+e<100?this.s+e:100)}else{let e=4*t;this.s>=e?this.s-=e:(e-=this.s,this.s=0,this.v=this.v+e<100?this.v+e:100)}}}t.HSVColor=HSVColor;const o=new Uint8Array(4),s=new Uint32Array(o.buffer);class ColorDef{constructor(e){this._tbgr=0,e&&("number"!==typeof e?e instanceof ColorDef?this._tbgr=e._tbgr:this.fromString(e):this.tbgr=e)}static rgb2bgr(e){return s[0]=e,o[3]<<24+o[0]<<16+o[1]<<8+o[2]}clone(){return new ColorDef(this._tbgr)}setFrom(e){this._tbgr=e._tbgr}toJSON(){return this._tbgr}static fromJSON(e){return new ColorDef(e)}static from(e,t,r,n,i){return i=i||new ColorDef,o[0]=e,o[1]=t,o[2]=r,o[3]=n||0,i._tbgr=s[0],i}get colors(){return s[0]=this._tbgr,{b:o[2],g:o[1],r:o[0],t:o[3]}}get tbgr(){return this._tbgr}set tbgr(e){s[0]=e,this._tbgr=s[0]}getAbgr(){return s[0]=this._tbgr,o[3]=255-o[3],s[0]}getRgb(){return s[0]=this._tbgr,(o[0]<<16)+(o[1]<<8)+o[2]}setAlpha(e){s[0]=this._tbgr,o[3]=255-(0|e),this._tbgr=s[0]}getAlpha(){return s[0]=this._tbgr,255-o[3]}get isOpaque(){return 255===this.getAlpha()}setTransparency(e){this.setAlpha(255-e)}get name(){return n[this._tbgr]}toHexString(){return"#"+("000000"+this.getRgb().toString(16)).slice(-6)}toRgbString(){const e=this.colors;return"rgb("+(0|e.r)+","+(0|e.g)+","+(0|e.b)+")"}fromString(e){if("string"!==typeof e)return this;e=e.toLowerCase();let t=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e);if(t){let e;const r=t[1],n=t[2];switch(r){case"rgb":case"rgba":if(e=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return ColorDef.from(Math.min(255,parseInt(e[1],10)),Math.min(255,parseInt(e[2],10)),Math.min(255,parseInt(e[3],10)),null!=e[5]?255-Math.min(255,parseInt(e[5],10)):0,this);if(e=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return ColorDef.from(Math.min(100,parseInt(e[1],10))/100*255,Math.min(100,parseInt(e[2],10))/100*255,Math.min(100,parseInt(e[3],10))/100*255,null!=e[5]?255-Math.min(100,parseInt(e[5],10))/100*255:0,this);break;case"hsl":case"hsla":if(e=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){const t=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,n=parseInt(e[3],10)/100;return ColorDef.fromHSL(t,r,n,this)}}}else if(t=/^\#([a-f0-9]+)$/.exec(e)){const e=t[1],r=e.length;if(3===r)return ColorDef.from(parseInt(e.charAt(0)+e.charAt(0),16),parseInt(e.charAt(1)+e.charAt(1),16),parseInt(e.charAt(2)+e.charAt(2),16),0,this);if(6===r)return ColorDef.from(parseInt(e.charAt(0)+e.charAt(1),16),parseInt(e.charAt(2)+e.charAt(3),16),parseInt(e.charAt(4)+e.charAt(5),16),0,this)}return e&&e.length>0&&Object.entries(n).some(t=>t[1].toLowerCase()===e&&(this._tbgr=Number(t[0]),!0)),this}lerp(e,t,r){const n=e.colors,i=this.colors;return i.r+=(n.r-i.r)*t,i.g+=(n.g-i.g)*t,i.b+=(n.b-i.b)*t,ColorDef.from(i.r,i.g,i.b,i.t,r)}invert(){const e=this.colors;return ColorDef.from(255-e.r,255-e.g,255-e.b)}static fromHSL(e,t,r,n){const i=(e,t,r)=>Math.round(255*((e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e))(e,t,r)),o=(e,t,r)=>Math.max(t,Math.min(r,e));if(e=((e,t)=>(e%t+t)%t)(e,1),t=o(t,0,1),r=o(r,0,1),0===t)return ColorDef.from(r,r,r,0,n);const s=r<=.5?r*(1+t):r+t-r*t,a=2*r-s;return ColorDef.from(i(a,s,e+1/3),i(a,s,e),i(a,s,e-1/3),0,n)}toHSL(e){const t=this.colors;t.r/=255,t.g/=255,t.b/=255;const r=Math.max(t.r,t.g,t.b),n=Math.min(t.r,t.g,t.b);let i,o=0;const s=(n+r)/2;if(n===r)i=0;else{const e=r-n;switch(i=s<=.5?e/(r+n):e/(2-r-n),r){case t.r:o=(t.g-t.b)/e+(t.g<t.b?6:0);break;case t.g:o=(t.b-t.r)/e+2;break;case t.b:o=(t.r-t.g)/e+4}o/=6}const a=e||new HSLColor;return a.h=o,a.s=i,a.l=s,a}toHSV(e){const t=e||new HSVColor,{r,g:n,b:i}=this.colors;let o=r<n?r:n;i<o&&(o=i);let s=r>n?r:n;i>s&&(s=i),t.v=Math.floor(s/255*100+.5);const a=s-o;if(t.s=0!==s?Math.floor(a/s*100+.5):0,t.s){const e=(s-r)/a,o=(s-n)/a,c=(s-i)/a;let l;l=r===s?c-o:n===s?2+e-c:4+o-e,(l*=60)<0&&(l+=360),t.h=Math.floor(l+.5),t.h>=360&&(t.h=0)}else t.h=0;return t}static fromHSV(e,t){if(!e.s||-1===e.h){const r=255&Math.floor(255*e.v/100+.5+3e-14);return ColorDef.from(r,r,r,0,t)}let r=e.h,n=e.s,i=e.v;360===r&&(r=0),r/=60;const o=Math.floor(r),s=r-o;i/=100,n/=100;const a=255&Math.floor(i*(1-n)*255+.5),c=255&Math.floor(i*(1-n*s)*255+.5),l=255&Math.floor(i*(1-n*(1-s))*255+.5),u=255&Math.floor(255*i+.5);let d=0,h=0,p=0;switch(o){case 0:d=u,p=l,h=a;break;case 1:d=c,p=u,h=a;break;case 2:d=a,p=u,h=l;break;case 3:d=a,p=c,h=u;break;case 4:d=l,p=a,h=u;break;case 5:d=u,p=a,h=c}return ColorDef.from(d,p,h,0,t)}visibilityCheck(e){const t=this.colors,r=e.colors;return.3*Math.abs(t.r-r.r)+.59*Math.abs(t.g-r.g)+.11*Math.abs(t.b-r.b)}adjustForContrast(e,t){const r=this.visibilityCheck(e);if(40<=r){const e=this.clone();return void 0!==t&&e.setAlpha(t),e}const n=Math.floor((40-r)/255*100),i=this.toHSV(),o=i.clone();i.adjustColor(!0,n),o.adjustColor(!1,n),void 0===t&&(t=this.getAlpha());const s=ColorDef.fromHSV(i);s.setAlpha(t);const a=ColorDef.fromHSV(o);return a.setAlpha(t),a.getRgb()===e.getRgb()?s:s.getRgb()===e.getRgb()?a:a.visibilityCheck(e)>=s.visibilityCheck(e)?a:s}equals(e){return this._tbgr===e._tbgr}}ColorDef.black=new ColorDef(n.black),ColorDef.white=new ColorDef(n.white),ColorDef.red=new ColorDef(n.red),ColorDef.green=new ColorDef(n.green),ColorDef.blue=new ColorDef(n.blue),t.ColorDef=ColorDef,Object.freeze(ColorDef.black),Object.freeze(ColorDef.white),Object.freeze(ColorDef.red),Object.freeze(ColorDef.green),Object.freeze(ColorDef.blue);class RgbColor{constructor(e,t,r){this.r=e,this.g=t,this.b=r,this.r=Math.max(0,Math.min(this.r,255)),this.g=Math.max(0,Math.min(this.g,255)),this.b=Math.max(0,Math.min(this.b,255))}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}static fromColorDef(e){const t=e.colors;return new RgbColor(t.r,t.g,t.b)}}t.RgbColor=RgbColor},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(452),o=r(83);class BezierCoffs{constructor(e){if(e instanceof Float64Array)this.coffs=e.slice();else if(Array.isArray(e)){this.coffs=new Float64Array(e.length);let t=0;for(const r of e)this.coffs[t++]=r}else this.coffs=new Float64Array(e)}allocateToOrder(e){this.coffs.length!==e?this.coffs=new Float64Array(e):this.coffs.fill(0)}createPeer(){return new UnivariateBezier(this.order)}get order(){return this.coffs.length}copyFrom(e){if(this.order===e.order)for(let t=0;t<this.coffs.length;t++)this.coffs[t]=e.coffs[t];else this.coffs=e.coffs.slice()}scaleInPlace(e){for(let t=0;t<this.coffs.length;t++)this.coffs[t]*=e}addInPlace(e){for(let t=0;t<this.coffs.length;t++)this.coffs[t]+=e}roots(e,t){const r=UnivariateBezier.create(this);return r.addInPlace(-e),UnivariateBezier.deflateRoots01(r)}filter01(e,t=!1){if(!e||!t)return e;let r=!1;for(const i of e)if(n.Geometry.isIn01(i)){r=!0;break}if(r){const t=[];for(const r of e)n.Geometry.isIn01(r)&&t.push(r);return t}}zero(){this.coffs.fill(0)}subdivide(e,t,r){const n=this.order;if(t.order!==n&&r.order!==n)return!1;const i=1-e;r.copyFrom(this);let o=n-1;for(let s=0;s<n;s++){t.coffs[s]=r.coffs[0];for(let t=0;t<o;t++)r.coffs[t]=i*r.coffs[t]+e*r.coffs[t+1];o--}return!0}static maxAbsDiff(e,t){const r=e.order;if(t.order!==r)return;let n,i=0;for(let o=0;o<r;o++)(n=Math.abs(e.coffs[o]-t.coffs[o]))>i&&(i=n);return i}}t.BezierCoffs=BezierCoffs;t.BezierPolynomialAlgebra=class BezierPolynomialAlgebra{static accumulateScaledShiftedComponentTimesComponentDelta(e,t,r,n,o,s,a,c){const l=n-1,u=n,d=n+l-1;if(e.length!==d)return;const h=i.PascalCoefficients.getRow(u-1),p=i.PascalCoefficients.getRow(l-1),f=i.PascalCoefficients.getRow(d-1);let g;for(let i=0;i<u;i++){g=o*(a+t[s+i*r])*h[i];for(let n=0,o=c;n<l;n++,o+=r)e[i+n]+=g*p[n]*(t[o+r]-t[o])/f[i+n]}}static scaledComponentSum(e,t,r,n,i,o,s,a){const c=n;if(e.length===c)for(let l=0,u=0;l<c;l++,u+=r)e[l]=o*t[u+i]+a*t[u+s]}static componentDifference(e,t,r,n,i){const o=n-1;if(e.length===o)for(let s=0,a=i;s<o;a+=r,s++)e[s]=t[a+r]-t[a]}static accumulateProduct(e,t,r,n=1){const o=t.length,s=r.length,a=o+s-1;if(e.length!==a)return;let c,l,u;const d=i.PascalCoefficients.getRow(o-1),h=i.PascalCoefficients.getRow(s-1),p=i.PascalCoefficients.getRow(a-1);for(c=0;c<o;c++)for(u=n*d[c]*t[c],l=0;l<s;l++)e[c+l]+=u*h[l]*r[l]/p[c+l]}static accumulateProductWithDifferences(e,t,r,n=1){const o=t.length-1,s=r.length,a=o+s-1;if(e.length!==a)return;let c,l,u;const d=i.PascalCoefficients.getRow(o-1),h=i.PascalCoefficients.getRow(s-1),p=i.PascalCoefficients.getRow(a-1);for(c=0;c<o;c++)for(u=n*d[c]*(t[c+1]-t[c]),l=0;l<s;l++)e[c+l]+=u*h[l]*r[l]/p[c+l]}static univariateDifference(e,t){const r=t.length;if(t.length+1!==r)for(let n=0;n<r;n++)t[n]=e[n+1]-e[n]}static accumulate(e,t,r){if(r.length===t)for(let n=0;n<t;n++)r[n]+=e[n]}};class UnivariateBezier extends BezierCoffs{get order(){return this._order}constructor(e){super(e),this._order=super.order}allocateOrder(e){this._order!==e&&(super.allocateToOrder(e),this._order=e)}clone(e=!1){if(e){const e=new UnivariateBezier(this.order);return e.coffs=this.coffs.slice(0,this.order),e}const t=new UnivariateBezier(this.coffs.length);return t._order=this._order,t.coffs=this.coffs.slice(),t}static create(e){const t=new UnivariateBezier(e.order);return t.coffs=e.coffs.slice(),t}static createCoffs(e){return new UnivariateBezier(e)}static createArraySubset(e,t,r,n){n?n.order!==r&&n.allocateToOrder(r):n=new UnivariateBezier(r);for(let i=0;i<r;i++)n.coffs[i]=e[t+i];return n}static createProduct(e,t){const r=new UnivariateBezier(e.order+t.order-1),n=i.PascalCoefficients.getRow(e.order-1),o=i.PascalCoefficients.getRow(t.order-1),s=i.PascalCoefficients.getRow(e.order+t.order-2);for(let i=0;i<e.order;i++){const a=e.coffs[i]*n[i];for(let e=0;e<t.order;e++){const n=t.coffs[e]*o[e],c=i+e,l=s[c];r.coffs[c]+=a*n/l}}return r}addSquaredSquaredBezier(e,t){const r=e.length,n=this.order;if(2*r!==n+1)return!1;const o=i.PascalCoefficients.getRow(r-1),s=i.PascalCoefficients.getRow(n-1),a=this.coffs;for(let i=0;i<r;i++){const n=e[i]*o[i]*t;for(let t=0;t<r;t++){const r=e[t]*o[t],c=i+t,l=s[c];a[c]+=n*r/l}}return!0}basisFunctions(e,t){this._basisValues=i.PascalCoefficients.getBezierBasisValues(this.order,e,this._basisValues),t&&t.length===this.order||(t=new Float64Array(this.order));let r=0;for(const n of this._basisValues)t[r++]=n;return t}static sumWeightedBlocks(e,t,r,n,i){for(let a=0;a<n;a++)i[a]=0;let o,s=0;for(let a=0;a<t;a++){const t=e[a];for(o=0;o<n;o++)i[o]+=t*r[s++]}}sumBasisFunctions(e,t,r,n){const o=this._order;return n||(n=new Float64Array(o)),this._basisValues=i.PascalCoefficients.getBezierBasisValues(this.order,e,this._basisValues),UnivariateBezier.sumWeightedBlocks(this._basisValues,o,t,r,n),n}sumBasisFunctionDerivatives(e,t,r,n){const o=this._order;return n||(n=new Float64Array(r)),this._basisValues=i.PascalCoefficients.getBezierBasisDerivatives(this.order,e,this._basisValues),UnivariateBezier.sumWeightedBlocks(this._basisValues,o,t,r,n),n}evaluate(e){this._basisValues=i.PascalCoefficients.getBezierBasisValues(this.order,e,this._basisValues);let t=0;for(let r=0;r<this.order;r++)t+=this._basisValues[r]*this.coffs[r];return t}deflateLeft(){const e=this.order,t=e-1,r=i.PascalCoefficients.getRow(t-1),n=i.PascalCoefficients.getRow(e-1);let o;for(let i=0;i<t;i++)o=this.coffs[i+1],this.coffs[i]=o*n[i+1]/r[i];this._order--}deflateRight(){const e=this.order,t=e-1,r=i.PascalCoefficients.getRow(t-1),n=i.PascalCoefficients.getRow(e-1);let o,s;for(let i=0;i<t;i++)s=(o=this.coffs[i])*n[i]/r[i],this.coffs[i]=s;this._order--}deflateRoot(e){const t=this.order,r=t-1;if(1===t)return this._order=0,this.coffs[0];if(t<1)return this._order=0,0;const n=i.PascalCoefficients.getRow(t-1),o=i.PascalCoefficients.getRow(r-1),s=-e,a=1-e;let c=0;if(e>.5){let e,i=this.coffs[0]/s;this.coffs[0]=i;let l=this.coffs[1];for(let t=1;t<r;t++)e=((l=this.coffs[t]*n[t])-i*a)/s,this.coffs[t]=e/o[t],i=e;c=this.coffs[t-1]-i*a}else{let e,i,l=this.coffs[t-1]/a;this.coffs[t-1]=l;for(let r=t-2;r>0;r--)e=((i=this.coffs[r]*n[r])-l*s)/a,this.coffs[r]=e/o[r-1],l=e;c=this.coffs[0]-l*s;for(let t=0;t<r;t++)this.coffs[t]=this.coffs[t+1]}return this._order=r,c}runNewton(e,t=1e-11){const r=this.order-1;let n,o,s=0,a=e;const c=this.order,l=this.coffs,u=c-1;for(let d=0;d++<10;){UnivariateBezier._basisBuffer=i.PascalCoefficients.getBezierBasisValues(c,a,UnivariateBezier._basisBuffer),n=0;for(let t=0;t<c;t++)n+=l[t]*UnivariateBezier._basisBuffer[t];UnivariateBezier._basisBuffer1=i.PascalCoefficients.getBezierBasisValues(u,a,UnivariateBezier._basisBuffer1),o=0;for(let t=0;t<u;t++)o+=(l[t+1]-l[t])*UnivariateBezier._basisBuffer1[t];if(o*=r,Math.abs(n)>10*Math.abs(o))return;const e=n/o;if(Math.abs(e)<t){if(++s>=2)return a-e}else s=0;a-=e}}static deflateRoots01(e){const t=[],r=e.coffs;let n,i,o,s,a;for(;e.order>1;){const c=e.order;if(0===r[0]){e.deflateLeft(),t.push(0);continue}let l=0,u=0;for(let d=1;d<c;d++)if((n=r[d-1])*(i=r[d])<=0&&(l++,s=(d-1+(o=-n/(i-n)))/(c-1),void 0!==(a=e.runNewton(s,1e-10)))){t.push(a),e.deflateRoot(a),u++;break}if(!u)return t}return t}}t.UnivariateBezier=UnivariateBezier;class Order2Bezier extends BezierCoffs{constructor(e=0,t=0){super(2),this.coffs[0]=e,this.coffs[1]=t}clone(){return new Order2Bezier(this.coffs[0],this.coffs[1])}static solveCoffs(e,t){return n.Geometry.conditionalDivideFraction(-e,t-e)}basisFunctions(e,t){return t||(t=new Float64Array(2)),t[0]=1-e,t[1]=e,t}sumBasisFunctions(e,t,r,n){n||(n=new Float64Array(r));const i=1-e;for(let o=0;o<r;o++)n[o]=i*t[o]+e*t[o+r];return n}sumBasisFunctionDerivatives(e,t,r,n){n||(n=new Float64Array(r));for(let i=0;i<r;i++)n[i]=t[i+r]-t[i];return n}evaluate(e){return(1-e)*this.coffs[0]+e*this.coffs[1]}solve(e){const t=this.coffs[1]-this.coffs[0];return n.Geometry.conditionalDivideFraction(e-this.coffs[0],t)}roots(e,t){const r=this.solve(e);if(void 0!==r)return!t||n.Geometry.isIn01(r)?[r]:void 0}}t.Order2Bezier=Order2Bezier;class Order3Bezier extends BezierCoffs{constructor(e=0,t=0,r=0){super(3),this.coffs[0]=e,this.coffs[1]=t,this.coffs[2]=r}clone(){return new Order3Bezier(this.coffs[0],this.coffs[1],this.coffs[2])}basisFunctions(e,t){t||(t=new Float64Array(3));const r=1-e;return t[0]=r*r,t[1]=2*e*r,t[2]=e*e,t}sumBasisFunctions(e,t,r,n){n||(n=new Float64Array(r));const i=1-e,o=i*i,s=2*e*i,a=e*e;for(let c=0;c<r;c++)n[c]=o*t[c]+s*t[c+r]+a*t[c+2*r];return n}sumBasisFunctionDerivatives(e,t,r,n){n||(n=new Float64Array(r));const i=2*(1-e),o=2*e,s=2*r;for(let a=0;a<r;a++){const e=t[a+r];n[a]=i*(e-t[a])+o*(t[a+s]-e)}return n}addSquareLinear(e,t,r){this.coffs[0]+=r*e*e,this.coffs[1]+=r*e*t,this.coffs[2]+=r*t*t}roots(e,t){const r=this.coffs[0]-e,n=this.coffs[1]-e,i=n-r,s=this.coffs[2]-e-n-i,a=o.Degree2PowerPolynomial.solveQuadratic(s,2*i,r);return super.filter01(a,t)}evaluate(e){const t=1-e;return this.coffs[0]*t*t+e*(2*this.coffs[1]*t+this.coffs[2]*e)}}t.Order3Bezier=Order3Bezier;class Order4Bezier extends BezierCoffs{constructor(e=0,t=0,r=0,n=0){super(4),this.coffs[0]=e,this.coffs[1]=t,this.coffs[2]=r,this.coffs[3]=n}clone(){return new Order4Bezier(this.coffs[0],this.coffs[1],this.coffs[2],this.coffs[3])}static createProductOrder3Order2(e,t){return new Order4Bezier(e.coffs[0]*t.coffs[0],(e.coffs[0]*t.coffs[1]+2*e.coffs[1]*t.coffs[0])/3,(2*e.coffs[1]*t.coffs[1]+e.coffs[2]*t.coffs[0])/3,e.coffs[2]*t.coffs[1])}basisFunctions(e,t){t||(t=new Float64Array(4));const r=1-e,n=e*e,i=r*r;return t[0]=i*r,t[1]=3*i*e,t[2]=3*r*n,t[3]=e*n,t}sumBasisFunctions(e,t,r,n){n||(n=new Float64Array(r));const i=1-e,o=e*e,s=i*i,a=i*s,c=3*e*s,l=3*o*i,u=e*o;for(let d=0;d<r;d++)n[d]=a*t[d]+c*t[d+r]+l*t[d+2*r]+u*t[d+3*r];return n}sumBasisFunctionDerivatives(e,t,r,n){n||(n=new Float64Array(r));const i=1-e,o=i*i*3,s=6*e*i,a=3*e*e;for(let c=0;c<r;c++){const e=t[c],i=t[c+r],l=t[c+2*r],u=t[c+3*r];n[c]=o*(i-e)+s*(l-i)+a*(u-l)}return n}evaluate(e){const t=1-e,r=t*t,n=r*t;return this.coffs[0]*n+e*(3*this.coffs[1]*r+e*(3*this.coffs[2]*t+e*this.coffs[3]))}static createFromDegree3PowerPolynomial(e){const t=e.evaluate(0),r=e.evaluateDerivative(0),n=e.evaluateDerivative(1),i=e.evaluate(1);return new Order4Bezier(t,t+r/3,i-n/3,i)}realRoots(e,t,r){r.clear();const i=new Float64Array(4),s=this.coffs[0],a=this.coffs[1],c=this.coffs[2],l=this.coffs[3],u=Math.max(s,a,c,l),d=Math.min(s,a,c,l),h=n.Geometry.smallMetricDistance;if(!(d>h)&&!(u<-h)){if(d>=-h&&u<h)return r.push(0),r.push(1/3),r.push(2/3),void r.push(1);i[0]=s-e,i[1]=3*(a-s),i[2]=3*(s-2*a+c),i[3]=3*a-s-3*c+l,o.AnalyticRoots.appendCubicRoots(i,r),t&&r.reassign(0,1)}}}t.Order4Bezier=Order4Bezier;class Order5Bezier extends BezierCoffs{constructor(e=0,t=0,r=0,n=0,i=0){super(5),this.coffs[0]=e,this.coffs[1]=t,this.coffs[2]=r,this.coffs[3]=n,this.coffs[4]=i}clone(){return new Order5Bezier(this.coffs[0],this.coffs[1],this.coffs[2],this.coffs[3],this.coffs[4])}static createFromDegree4PowerPolynomial(e){const t=e.evaluate(0),r=e.evaluateDerivative(0),n=e.evaluateDerivative(1),i=e.evaluate(1),o=t+.25*r,s=2*o-t+e.coffs[2]/6;return new Order5Bezier(t,o,s,i-.25*n,i)}basisFunctions(e,t){t||(t=new Float64Array(5));const r=1-e,n=e*e,i=n*e,o=r*r,s=o*r;return t[0]=o*o,t[1]=4*s*e,t[2]=6*o*n,t[3]=4*r*i,t[4]=n*n,t}sumBasisFunctions(e,t,r,n){n||(n=new Float64Array(r));const i=1-e,o=e*e,s=i*i,a=s*s,c=4*(s*i)*e,l=6*s*o,u=4*i*(o*e),d=o*o;for(let h=0;h<r;h++)n[h]=a*t[h]+c*t[h+r]+l*t[h+2*r]+u*t[h+3*r]+d*t[h+4*r];return n}sumBasisFunctionDerivatives(e,t,r,n){n||(n=new Float64Array(r));const i=1-e,o=e*e,s=i*i,a=4*i*s,c=12*e*s,l=12*o*i,u=4*e*o;for(let d=0;d<r;d++){const e=t[d],i=t[d+r],o=t[d+2*r],s=t[d+3*r],h=t[d+4*r];n[d]=a*(i-e)+c*(o-i)+l*(s-o)+u*(h-s)}return n}evaluate(e){const t=1-e,r=t*t,n=r*t,i=r*r;return this.coffs[0]*i+e*(4*this.coffs[1]*n+e*(6*this.coffs[2]*r+e*(4*this.coffs[3]*t+e*this.coffs[4])))}addProduct(e,t,r){this.coffs[0]+=r*e.coffs[0]*t.coffs[0],this.coffs[1]+=r*(e.coffs[0]*t.coffs[1]+e.coffs[1]*t.coffs[0])*.5,this.coffs[2]+=r*(e.coffs[0]*t.coffs[2]+4*e.coffs[1]*t.coffs[1]+e.coffs[2]*t.coffs[0])/6,this.coffs[3]+=r*(e.coffs[1]*t.coffs[2]+e.coffs[2]*t.coffs[1])*.5,this.coffs[4]+=r*e.coffs[2]*t.coffs[2]}addConstant(e){for(let t=0;t<5;t++)this.coffs[t]+=e}realRoots(e,t,r){r.clear();const i=this.coffs[0]-e,s=this.coffs[1]-e,a=this.coffs[2]-e,c=this.coffs[3]-e,l=this.coffs[4]-e,u=Math.max(i,s,a,c,l),d=Math.min(i,s,a,c,l),h=n.Geometry.smallMetricDistance;if(d>h)return;if(u<-h)return;if(d>=-h&&u<h)return r.push(0),r.push(.25),r.push(.5),r.push(.75),void r.push(1);const p=new Float64Array(5);p[0]=i-e,p[1]=4*(-i+s),p[2]=6*(i-2*s+a),p[3]=4*(3*s-i-3*a+c),p[4]=i-4*s+6*a-4*c+l,o.AnalyticRoots.appendQuarticRoots(p,r),t&&r.reassign(0,1)}}t.Order5Bezier=Order5Bezier},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(84),o=r(16),s=r(83),a=r(6),c=r(10),l=r(21),u=r(22),d=r(38),h=r(49),p=r(72),f=r(14);class Arc3d extends d.CurvePrimitive{constructor(e,t,r){super(),this._center=e,this._matrix=t,this._sweep=r}isSameGeometryClass(e){return e instanceof Arc3d}get center(){return this._center.clone()}get vector0(){return this._matrix.columnX()}get vector90(){return this._matrix.columnY()}get matrix(){return this._matrix.clone()}get sweep(){return this._sweep}set sweep(e){this._sweep.setFrom(e)}get isExtensibleFractionSpace(){return!0}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}setRefs(e,t,r){this._center=e,this._matrix=t,this._sweep=r}set(e,t,r){this.setRefs(e.clone(),t.clone(),r?r.clone():i.AngleSweep.create360())}setFrom(e){this._center.setFrom(e._center),this._matrix.setFrom(e._matrix),this._sweep.setFrom(e._sweep)}clone(){return new Arc3d(this._center.clone(),this._matrix.clone(),this._sweep.clone())}static createRefs(e,t,r,n){return n?(n.setRefs(e,t,r),n):new Arc3d(e,t,r)}static createScaledXYColumns(e,t,r,n,i,o){const s=t.columnX(),a=t.columnY();return Arc3d.create(e,s.scale(r,s),a.scale(n,a),i,o)}static create(e,t,r,n,o){const s=t.unitCrossProductWithDefault(r,0,0,0),a=c.Matrix3d.createColumns(t,r,s);return o?(o.setRefs(e.clone(),a,n?n.clone():i.AngleSweep.create360()),o):new Arc3d(e.clone(),a,n?n.clone():i.AngleSweep.create360())}quickEccentricity(){const e=this._matrix.columnXMagnitude(),t=this._matrix.columnYMagnitude(),r=this._matrix.columnXYCrossProductMagnitude(),i=n.Geometry.maxXY(e,t);return r/(i*i)}static createCircularStartMiddleEnd(e,t,r,n){const c=a.Vector3d.createStartEnd(e,t),l=a.Vector3d.createStartEnd(e,r),u=c.magnitude(),d=l.magnitude(),h=c.sizedCrossProduct(l,Math.sqrt(u*d));if(h){const t=s.SmallSystem.linearSystem3d(h.x,h.y,h.z,c.x,c.y,c.z,l.x,l.y,l.z,0,.5*u*u,.5*d*d);if(t){const s=a.Point3d.create(e.x,e.y,e.z).plus(t),c=a.Vector3d.createStartEnd(s,e),l=a.Vector3d.createRotateVectorAroundVector(c,h,o.Angle.createDegrees(90));if(l){const e=a.Vector3d.createStartEnd(s,r),t=c.signedAngleTo(e,h);return Arc3d.create(s,c,l,i.AngleSweep.createStartEndRadians(0,t.radians),n)}}}return f.LineString3d.create(e,t,r)}getFractionToDistanceScale(){const e=this.circularRadius();if(void 0!==e)return Math.abs(e*this._sweep.sweepRadians)}fractionToPoint(e,t){const r=this._sweep.fractionToRadians(e);return this._matrix.originPlusMatrixTimesXY(this._center,Math.cos(r),Math.sin(r),t)}fractionToPointAndDerivative(e,t){return(t=this.radiansToPointAndDerivative(this._sweep.fractionToRadians(e),t)).direction.scaleInPlace(this._sweep.sweepRadians),t}fractionToPointAnd2Derivatives(e,t){const r=this._sweep.fractionToRadians(e);t||(t=u.Plane3dByOriginAndVectors.createXYPlane());const n=Math.cos(r),i=Math.sin(r);this._matrix.originPlusMatrixTimesXY(this._center,n,i,t.origin);const o=this._sweep.sweepRadians;this._matrix.multiplyXY(-o*i,o*n,t.vectorU);const s=o*o;return this._matrix.multiplyXY(-s*n,-s*i,t.vectorV),t}radiansToPointAndDerivative(e,t){t=t||l.Ray3d.createZero();const r=Math.cos(e),n=Math.sin(e);return this._matrix.originPlusMatrixTimesXY(this._center,r,n,t.origin),this._matrix.multiplyXY(-n,r,t.direction),t}angleToPointAndDerivative(e,t){t=t||l.Ray3d.createZero();const r=e.cos(),n=e.sin();return this._matrix.originPlusMatrixTimesXY(this._center,r,n,t.origin),this._matrix.multiplyXY(-n,r,t.direction),t}startPoint(e){return this.fractionToPoint(0,e)}endPoint(e){return this.fractionToPoint(1,e)}curveLength(){return this.curveLengthBetweenFractions(0,1)}curveLengthBetweenFractions(e,t){const r=this.getFractionToDistanceScale();if(void 0!==r)return r*Math.abs(t-e);let n=e,i=t;e>t&&(n=t,i=e);const o=(i-n)*this._sweep.sweepDegrees;let s=this.quickEccentricity();s<1e-5&&(s=1e-5);let a=Math.ceil(o/(s*Arc3d.quadratureIntervalAngleDegrees));return a>400&&(a=400),a<1&&(a=1),super.curveLengthWithFixedIntervalCountQuadrature(n,i,a,Arc3d.quadratureGuassCount)}quickLength(){const e=Math.abs(this._sweep.sweepRadians);let t=Math.ceil(4*e/Math.PI);t<1&&(t=1),t<4?t+=3:t<6&&(t+=2);const r=Arc3d._workPointA,n=Arc3d._workPointB;let i=0;this.fractionToPoint(0,r);for(let s=1;s<=t;s++)this.fractionToPoint(s/t,n),i+=r.distance(n),r.setFromPoint3d(n);const o=e/t;return i*(o/(2*Math.sin(.5*o)))}moveSignedDistanceFromFraction(e,t,r,i){if(!this.isCircular)return super.moveSignedDistanceFromFractionGeneric(e,t,r,i);const o=this.curveLength(),s=n.Geometry.conditionalDivideFraction(t,o);return void 0===s?h.CurveLocationDetail.createCurveFractionPointDistanceCurveSearchStatus(this,e,this.fractionToPoint(e),0,h.CurveSearchStatus.error):h.CurveLocationDetail.createConditionalMoveSignedDistance(r,this,e,e+s,t,i)}allPerpendicularAngles(e,t=!1,r=!1){const n=[],i=e.vectorTo(this.center),o=this.matrix.columnXMagnitudeSquared(),a=this._matrix.columnXDotColumnY(),c=this._matrix.columnYMagnitudeSquared();return s.TrigPolynomial.SolveUnitCircleImplicitQuadricIntersection(a,c-o,-a,this.matrix.dotColumnY(i),-this.matrix.dotColumnX(i),0,n),n}closestPoint(e,t,r){r=h.CurveLocationDetail.create(this,r);const n=this.allPerpendicularAngles(e);t||this._sweep.isFullCircle||(n.push(this._sweep.startRadians),n.push(this._sweep.endRadians));const i=l.Ray3d.createZero();if(0===n.length)r.setFR(0,this.radiansToPointAndDerivative(this._sweep.startRadians,i)),r.a=e.distance(r.point);else{let o=Number.MAX_VALUE,s=0;for(const a of n)(t||this._sweep.isRadiansInSweep(a))&&(this.radiansToPointAndDerivative(a,i),(s=e.distance(i.origin))<o&&(o=s,r.setFR(this._sweep.radiansToSignedPeriodicFraction(a),i),r.a=s))}return r}reverseInPlace(){this._sweep.reverseInPlace()}tryTransformInPlace(e){return this._center=e.multiplyPoint3d(this._center,this._center),this._matrix=e.matrix.multiplyMatrixMatrix(this._matrix,this._matrix),this.setVector0Vector90(this._matrix.columnX(),this._matrix.columnY()),!0}isInPlane(e){const t=e.getNormalRef();return n.Geometry.isSmallMetricDistance(e.altitude(this._center))&&n.Geometry.isSmallMetricDistance(this._matrix.dotColumnX(t))&&n.Geometry.isSmallMetricDistance(this._matrix.dotColumnY(t))}get isCircular(){const e=this._matrix.columnXMagnitudeSquared(),t=this._matrix.columnYMagnitudeSquared(),r=this._matrix.columnXDotColumnY();return o.Angle.isPerpendicularDotSet(e,t,r)&&n.Geometry.isSameCoordinateSquared(e,t)}circularRadius(){return this.isCircular?this._matrix.columnXMagnitude():void 0}maxVectorLength(){return Math.max(this._matrix.columnXMagnitude(),this._matrix.columnYMagnitude())}appendPlaneIntersectionPoints(e,t){const r=e.altitude(this._center),i=this._matrix.coffs,o=e.velocityXYZ(i[0],i[3],i[6]),s=e.velocityXYZ(i[1],i[4],i[7]),a=n.Geometry.solveTrigForm(r,o,s);let c=0;if(void 0!==a){let e;for(e of(c=a.length,a)){const r=Math.atan2(e.y,e.x),n=this._sweep.radiansToPositivePeriodicFraction(r);t.push(h.CurveLocationDetail.createCurveFractionPoint(this,n,this.fractionToPoint(n)))}}return c}extendRange(e){let t=a.Point3d.create();for(let r=0;r<=1.001;r+=1/32)t=this.fractionToPoint(r,t),e.extendPoint(t)}static createUnitCircle(){return Arc3d.createRefs(a.Point3d.create(0,0,0),c.Matrix3d.createIdentity(),i.AngleSweep.create360())}static createXY(e,t,r=i.AngleSweep.create360()){return new Arc3d(e.clone(),c.Matrix3d.createScale(t,t,1),r)}static createXYEllipse(e,t,r,n=i.AngleSweep.create360()){return new Arc3d(e.clone(),c.Matrix3d.createScale(t,r,1),n)}setVector0Vector90(e,t){this._matrix.setColumns(e,t,e.unitCrossProductWithDefault(t,0,0,0))}toScaledMatrix3d(){const e=o.Angle.dotProductsToHalfAngleTrigValues(this._matrix.columnXMagnitudeSquared(),this._matrix.columnYMagnitudeSquared(),this._matrix.columnXDotColumnY(),!0),t=this._matrix.multiplyXY(e.c,e.s),r=this._matrix.multiplyXY(-e.s,e.c),n=c.Matrix3d.createRigidFromColumns(t,r,0);return{axes:n||c.Matrix3d.createIdentity(),center:this._center,r0:t.magnitude(),r90:r.magnitude(),sweep:this.sweep.cloneMinusRadians(e.radians)}}toVectors(){return{center:this.center,vector0:this.matrix.columnX(),vector90:this.matrix.columnY(),sweep:this.sweep}}toTransformedVectors(e){return e?{center:e.multiplyPoint3d(this._center),vector0:e.multiplyVector(this._matrix.columnX()),vector90:e.multiplyVector(this._matrix.columnY()),sweep:this.sweep}:{center:this._center.clone(),vector0:this._matrix.columnX(),vector90:this._matrix.columnY(),sweep:this.sweep}}toTransformedPoint4d(e){return{center:e.multiplyPoint3d(this._center,1),vector0:e.multiplyPoint3d(this._matrix.columnX(),0),vector90:e.multiplyPoint3d(this._matrix.columnY(),0),sweep:this.sweep}}setFromJSON(e){if(e&&e.center&&e.vector0&&e.vector90&&e.sweep){this._center.setFromJSON(e.center);const t=a.Vector3d.create(),r=a.Vector3d.create();t.setFromJSON(e.vector0),r.setFromJSON(e.vector90),this.setVector0Vector90(t,r),this._sweep.setFromJSON(e.sweep)}else this._center.set(0,0,0),this._matrix.setFrom(c.Matrix3d.identity),this._sweep.setStartEndRadians()}toJSON(){return{center:this._center.toJSON(),sweep:this._sweep.toJSON(),vector0:this._matrix.columnX().toJSON(),vector90:this._matrix.columnY().toJSON()}}isAlmostEqual(e){if(e instanceof Arc3d){const t=e;return this._center.isAlmostEqual(t._center)&&this._matrix.isAlmostEqual(t._matrix)&&this._sweep.isAlmostEqualAllowPeriodShift(t._sweep)}return!1}emitStrokes(e,t){let r=1;if(t){const e=this.maxVectorLength();r=t.applyTolerancesToArc(e,this._sweep.sweepRadians)}else r=p.StrokeOptions.applyAngleTol(void 0,1,this._sweep.sweepRadians);e.appendFractionalStrokePoints(this,r,0,1,!0)}emitStrokableParts(e,t){let r=1;if(t){const e=this.maxVectorLength();r=t.applyTolerancesToArc(e,this._sweep.sweepRadians)}else r=p.StrokeOptions.applyAngleTol(void 0,1,this._sweep.sweepRadians);e.startCurvePrimitive(this),e.announceIntervalForUniformStepStrokes(this,r,0,1),e.endCurvePrimitive(this)}dispatchToGeometryHandler(e){return e.handleArc3d(this)}clonePartialCurve(e,t){if(t<e){const r=this.clonePartialCurve(t,e);return r&&r.reverseInPlace(),r}const r=this.clone();return r.sweep.setStartEndRadians(this.sweep.fractionToRadians(e),this.sweep.fractionToRadians(t)),r}announceClipIntervals(e,t){return e.announceClippedArcIntervals(this,t)}}Arc3d._workPointA=a.Point3d.create(),Arc3d._workPointB=a.Point3d.create(),Arc3d.quadratureGuassCount=5,Arc3d.quadratureIntervalAngleDegrees=10,t.Arc3d=Arc3d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(50);t.SolidPrimitive=class SolidPrimitive extends n.GeometryQuery{constructor(e){super(),this._capped=e}get capped(){return this._capped}set capped(e){this._capped=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(40),i=r(85),o=r(75),s=r(52),a=r(102);class RpcConfiguration{constructor(){this.applicationAuthorizationKey="",this.applicationAuthorizationValue="",this.pendingOperationRetryInterval=1e4,this.controlChannel=a.RpcControlChannel.obtain(this)}static assign(e,t){e.prototype.configurationSupplier=t}static obtain(e){let t=e[s.INSTANCE];return t||(t=e[s.INSTANCE]=new e),t}static initializeInterfaces(e){e.interfaces().forEach(e=>n.RpcManager.initializeInterface(e)),e.controlChannel.initialize()}static supply(e){return RpcConfiguration.obtain(e.configurationSupplier?e.configurationSupplier():RpcDefaultConfiguration)}onRpcClientInitialized(e,t){this.protocol.onRpcClientInitialized(e,t)}onRpcImplInitialized(e,t){this.protocol.onRpcImplInitialized(e,t)}onRpcClientTerminated(e,t){this.protocol.onRpcClientTerminated(e,t)}onRpcImplTerminated(e,t){this.protocol.onRpcImplTerminated(e,t)}}RpcConfiguration.developmentMode=!1,RpcConfiguration.strictMode=!1,t.RpcConfiguration=RpcConfiguration;class RpcDefaultConfiguration extends RpcConfiguration{constructor(){super(...arguments),this.interfaces=(()=>[]),this.protocol=new RpcDirectProtocol(this),this.applicationAuthorizationKey="Authorization",this.applicationAuthorizationValue="Basic Og=="}}t.RpcDefaultConfiguration=RpcDefaultConfiguration;class RpcDirectProtocol extends i.RpcProtocol{constructor(){super(...arguments),this.requestType=RpcDirectRequest}}t.RpcDirectProtocol=RpcDirectProtocol;class RpcDirectRequest extends o.RpcRequest{constructor(){super(...arguments),this.headers=new Map,this.fulfillment=void 0}send(){const e=this.protocol.serialize(this);return new Promise(async(t,r)=>{try{this.fulfillment=await this.protocol.fulfill(e),t(this.fulfillment.status)}catch(e){r(e)}})}setHeader(e,t){this.headers.set(e,t)}load(){return Promise.resolve(this.fulfillment.result)}}t.RpcDirectRequest=RpcDirectRequest},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i={r:0,g:0,b:0,a:0};function o(e,t,r){return e.r=e.g=e.b=e.a=t[r],r+1}function s(e,t,r){return e.r=t[r+0],e.g=t[r+1],e.b=t[r+2],e.a=255,r+3}function a(e,t,r){return s(e,t,r),e.a=t[r+3],r+4}function c(e){return 0===e?"image/jpeg":"image/png"}async function l(e){const t=new Blob([e.data],{type:c(e.format)});return u(URL.createObjectURL(t))}async function u(e){return new Promise((t,r)=>{const n=new Image;n.onload=(()=>t(n)),n.onerror=r,n.src=e})}function d(e){const t=function(e){const t=document.createElement("canvas");if(null===t)return;t.width=e.width,t.height=e.height;const r=t.getContext("2d");if(null===r)return;const n=r.createImageData(e.width,e.height),c=5===e.format?o:2===e.format?s:a,l=e.data;let u=0,d=0;const h=i;for(;u<l.length;)u=c(h,l,u),n.data[d+0]=h.r,n.data[d+1]=h.g,n.data[d+2]=h.b,n.data[d+3]=h.a,d+=4;return r.putImageData(n,0,0),t}(e);return void 0!==t?t.toDataURL():void 0}t.getImageSourceMimeType=c,t.getImageSourceFormatForMimeType=function(e){switch(e){case"image/jpeg":return 0;case"image/png":return 2;default:return}},t.imageElementFromImageSource=l,t.imageElementFromUrl=u,t.extractImageSourceDimensions=async function(e){return l(e).then(e=>new n.Point2d(e.naturalWidth,e.naturalHeight))},t.imageBufferToPngDataUrl=d,t.imageBufferToBase64EncodedPng=function(e){const t=d(e);if(void 0!==t&&t.startsWith("data:image/png;base64,"))return t.substring("data:image/png;base64,".length)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4),o=r(3),s=r(26),a=r(8),c=r(88),l=r(507),u=r(508),d=r(510),h=r(511),p=r(20);function f(e,t){const r=n.compareNumbers(e.depth,t.depth);return 0===r?n.compareStrings(e.contentId,t.contentId):r}class MissingNodes{constructor(e){this._requests=e}insert(e){switch(e.loadStatus){case 0:void 0===this._list&&(this._list=new n.SortedArray(f)),this._list.insert(e);case 1:case 2:this._requests.hasMissingTiles=!0}}extractArray(){return void 0!==this._list?this._list.extractArray():void 0}}t.MissingNodes=MissingNodes;t.TileRequests=class TileRequests{constructor(){this._map=new Map,this.hasMissingTiles=!1}getMissing(e){let t=this._map.get(e);return void 0===t&&(t=new MissingNodes(this),this._map.set(e,t)),t}requestMissing(){this._map.forEach((e,t)=>{const r=e.extractArray();void 0!==r&&t.requestTiles(r)})}};class Tile{constructor(e){this.root=e.root,this.range=e.range,this.parent=e.parent,this.depth=void 0!==this.parent?this.parent.depth+1:0,this.loadStatus=0,this.contentId=e.contentId,this._maximumSize=e.maximumSize,this._isLeaf=!0===e.isLeaf,this._childrenLastUsed=n.BeTimePoint.now(),this._contentRange=e.contentRange,this._sizeMultiplier=e.sizeMultiplier,this.root.loader.tileRequiresLoading(e)||this.setIsReady(),this.center=this.range.low.interpolate(.5,this.range.high),this.radius=.5*this.range.low.distance(this.range.high),this._childrenLoadStatus=this.hasChildren&&this.depth<this.root.loader.maxDepth?TileTree.LoadStatus.NotLoaded:TileTree.LoadStatus.Loaded}dispose(){if(this._graphic=n.dispose(this._graphic),this._rangeGraphic=n.dispose(this._rangeGraphic),this._children)for(const e of this._children)n.dispose(e);this._children=void 0,this.loadStatus=5}cancelAllLoads(){if(this.isLoading&&(this.loadStatus=0,void 0!==this._children))for(const e of this._children)e.cancelAllLoads()}get isQueued(){return 1===this.loadStatus}get isAbandoned(){return 5===this.loadStatus}get isNotLoaded(){return 0===this.loadStatus}get isLoading(){return 2===this.loadStatus}get isNotFound(){return 4===this.loadStatus}get isReady(){return 3===this.loadStatus}setGraphic(e,t,r,n){this._graphic=e,void 0===e?this._maximumSize=0:0===this._maximumSize&&(this._maximumSize=512),void 0!==t&&t!==this._isLeaf&&(this._isLeaf=t,this.unloadChildren()),void 0!==n&&(void 0===this._sizeMultiplier||n>this._sizeMultiplier)&&(this._sizeMultiplier=n,this.contentId=this.contentId.substring(0,this.contentId.lastIndexOf("/")+1)+n,void 0!==this._children&&this._children.length>1&&this.unloadChildren()),void 0!==r&&(this._contentRange=r),this.setIsReady()}setIsReady(){this.loadStatus=3,a.IModelApp.viewManager.onNewTilesReady()}setIsQueued(){this.loadStatus=1}setNotLoaded(){this.loadStatus=0}setNotFound(){this.loadStatus=4}setAbandoned(){const e=this.children;if(void 0!==e)for(const t of e)t.setAbandoned();this.loadStatus=5}get maximumSize(){return this._maximumSize*this.sizeMultiplier}get isEmpty(){return this.isReady&&!this.hasGraphics&&!this.hasChildren}get hasChildren(){return!this.isLeaf}get contentRange(){return void 0!==this._contentRange?this._contentRange:this.range}get isLeaf(){return this._isLeaf}get isDisplayable(){return this.maximumSize>0}get isParentDisplayable(){return void 0!==this.parent&&this.parent.isDisplayable}get graphics(){return this._graphic}get hasGraphics(){return void 0!==this.graphics}get sizeMultiplier(){return void 0!==this._sizeMultiplier?this._sizeMultiplier:1}get hasSizeMultiplier(){return void 0!==this._sizeMultiplier}get children(){return this._children}get iModel(){return this.root.iModel}get yAxisUp(){return this.root.yAxisUp}get hasContentRange(){return void 0!==this._contentRange}isRegionCulled(e){return this.isCulled(this.range,e)}isContentCulled(e){return this.isCulled(this.contentRange,e)}getRangeGraphic(e){if(void 0===this._rangeGraphic){const t=e.createGraphicBuilder(1),r=this.hasSizeMultiplier?i.ColorDef.red:this.isLeaf?i.ColorDef.blue:i.ColorDef.green;t.setSymbology(r,r,1),t.addRangeBox(this.contentRange),this._rangeGraphic=t.finish()}return this._rangeGraphic}computeWorldContentRange(){const e=new i.ElementAlignedBox3d;return this.contentRange.isNull||this.root.location.multiplyRange(this.contentRange,e),e}computeVisibility(e){const t=this.root.debugForcedDepth;if(void 0!==t)return this.depth===t?2:1;if(this.isEmpty||this.isRegionCulled(e))return 0;if(!this.isDisplayable)return 1;const r=this.hasContentRange;if(!this.hasChildren)return r&&this.isContentCulled(e)?0:2;const n=e.getTileRadius(this),i=e.getTileCenter(this),o=e.getPixelSizeAtPoint(i);return(0!==o?n/o:.001)>this.maximumSize*e.tileSizeModifier?1:r&&this.isContentCulled(e)?0:2}selectTiles(e,t,r=0){const n=this.computeVisibility(t);if(0===n)return this.unloadChildren(t.purgeOlderThan),0;if(2===n){if(this.isReady||t.insertMissing(this),this.hasGraphics)e.push(this),this.unloadChildren(t.purgeOlderThan);else{const r=e.length,n=this.children;if(void 0===n)return 1;for(const i of n)if(0!==i.computeVisibility(t)){if(!i.hasGraphics)return e.length=r,1;e.push(i)}this._childrenLastUsed=t.now}return 0}let i=this.isReady||this.isParentDisplayable;if(i&&this.isDisplayable){!this.hasGraphics&&!this.hasSizeMultiplier&&(r>=this.root.maxTilesToSkip?i=!1:r+=1)}const o=this.loadChildren(),s=i?this.children:void 0;if(i&&TileTree.LoadStatus.Loading===o&&t.markChildrenLoading(),void 0!==s){this._childrenLastUsed=t.now;let n=!0;const i=e.length;for(const o of s)1===o.selectTiles(e,t,r)&&(n=!1);if(n)return 0;e.length=i}return this.hasGraphics?(e.push(this),0):(this.isReady||t.insertMissing(this),this.isParentDisplayable?1:0)}drawGraphics(e){if(void 0!==this.graphics&&(e.graphics.add(this.graphics),e.context.viewport.wantTileBoundingBoxes)){const t=this.getRangeGraphic(e.context);void 0!==t&&e.graphics.add(t)}}unloadChildren(e){const t=this.children;if(void 0!==t)if(void 0!==e&&this._childrenLastUsed.milliseconds>e.milliseconds)for(const r of t)r.unloadChildren(e);else{for(const e of t)e.setAbandoned(),e.dispose();this._children=void 0,this._childrenLoadStatus=TileTree.LoadStatus.NotLoaded}}isCulled(e,t){const r=i.Frustum.fromRange(e,Tile._scratchRootFrustum),n=r.transformBy(t.location,Tile._scratchWorldFrustum),o=0===t.frustumPlanes.computeFrustumContainment(n),s=!o&&void 0!==t.clip&&3===t.clip.classifyPointContainment(r.points);return o||s}loadChildren(){return TileTree.LoadStatus.NotLoaded===this._childrenLoadStatus&&(this._childrenLoadStatus=TileTree.LoadStatus.Loading,this.root.loader.getChildrenProps(this).then(e=>{if(this._children=[],this._childrenLoadStatus=TileTree.LoadStatus.Loaded,void 0!==e){const t=this.hasContentRange?void 0:new i.ElementAlignedBox3d;for(const r of e){const e=new Tile(Tile.Params.fromJSON(r,this.root,this));this._children.push(e),void 0===t||e.isEmpty||t.extendRange(e.contentRange)}void 0!==t&&(this._contentRange=t)}0===this._children.length?(this._children=void 0,this._isLeaf=!0):a.IModelApp.viewManager.onNewTilesReady()}).catch(e=>{this._childrenLoadStatus=TileTree.LoadStatus.NotFound,this._children=void 0,this._isLeaf=!0})),this._childrenLoadStatus}debugDump(){let e="  ".repeat(this.depth);if(e+=this.contentId,void 0!==this._children){e+=" "+this._children.length+"\n";for(const t of this._children)e+=t.debugDump()}else e+="\n";return e}}Tile._scratchWorldFrustum=new i.Frustum,Tile._scratchRootFrustum=new i.Frustum,t.Tile=Tile,function(e){let t,r,n;!function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Queued=1]="Queued",e[e.Loading=2]="Loading",e[e.Ready=3]="Ready",e[e.NotFound=4]="NotFound",e[e.Abandoned=5]="Abandoned"}(t=e.LoadStatus||(e.LoadStatus={})),function(e){e[e.OutsideFrustum=0]="OutsideFrustum",e[e.TooCoarse=1]="TooCoarse",e[e.Visible=2]="Visible"}(r=e.Visibility||(e.Visibility={})),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(n=e.SelectParent||(e.SelectParent={}));class DrawArgs{constructor(e,t,r,n,o,a){this.graphics=new s.GraphicBranch,this.location=t,this.root=r,this.clip=a,this.context=e,this.now=n,this.purgeOlderThan=o,this.graphics.setViewFlagOverrides(r.viewFlagOverrides),this.viewFrustum=void 0!==e.backgroundMap?p.ViewFrustum.createFromViewportAndPlane(e.viewport,e.backgroundMap.getPlane()):e.viewport.viewFrustum,void 0!==this.viewFrustum&&(this._frustumPlanes=new i.FrustumPlanes(this.viewFrustum.getFrustum()))}getPixelSizeAtPoint(e){return void 0!==this.viewFrustum?this.viewFrustum.getPixelSizeAtPoint(e):this.context.getPixelSizeAtPoint()}get frustumPlanes(){return void 0!==this._frustumPlanes?this._frustumPlanes:this.context.frustumPlanes}get tileSizeModifier(){return 1}getTileCenter(e){return this.location.multiplyPoint3d(e.center)}getTileRadius(e){let t=e.range.clone(DrawArgs._scratchRange);return t=this.location.multiplyRange(t,t),.5*(e.root.is3d?t.low.distance(t.high):t.low.distanceXY(t.high))}drawGraphics(){if(this.graphics.isEmpty)return;const e=void 0!==this.clip?a.IModelApp.renderSystem.getClipVolume(this.clip,this.root.iModel):void 0,t=this.context.createBranch(this.graphics,this.location,e);this.context.outputGraphic(t)}insertMissing(e){e.isNotLoaded?(void 0===this._missing&&(this._missing=this.context.requests.getMissing(this.root)),this._missing.insert(e)):(e.isQueued||e.isLoading)&&(this.context.requests.hasMissingTiles=!0)}requestMissing(){if(void 0!==this._missing){const e=this._missing.extractArray();void 0!==e&&this.root.requestTiles(e)}}markChildrenLoading(){this.context.requests.hasMissingTiles=!0}}DrawArgs._scratchRange=new o.Range3d,e.DrawArgs=DrawArgs;class Params{constructor(e,t,r,n,i,o,s,a){this.root=e,this.contentId=t,this.range=r,this.maximumSize=n,this.isLeaf=i,this.parent=o,this.contentRange=s,this.sizeMultiplier=a}static fromJSON(e,t,r){const n=void 0!==e.contentRange?i.ElementAlignedBox3d.fromJSON(e.contentRange):void 0;return new Params(t,e.contentId,i.ElementAlignedBox3d.fromJSON(e.range),e.maximumSize,e.isLeaf,r,n,e.sizeMultiplier)}}e.Params=Params}(Tile=t.Tile||(t.Tile={}));class TileTree{constructor(e){this.iModel=e.iModel,this.is3d=e.is3d,this.id=e.id,this.modelId=n.Id64.fromJSON(e.modelId),this.location=e.location,this.expirationTime=n.BeDuration.fromSeconds(5),this.clipVector=e.clipVector,this.maxTilesToSkip=n.JsonUtils.asInt(e.maxTilesToSkip,100),this.loader=e.loader,this._rootTile=new Tile(Tile.Params.fromJSON(e.rootTile,this)),this.viewFlagOverrides=this.loader.viewFlagOverrides,this.yAxisUp=!!e.yAxisUp&&e.yAxisUp}get rootTile(){return this._rootTile}dispose(){n.dispose(this._rootTile)}get is2d(){return!this.is3d}get range(){return void 0!==this._rootTile?this._rootTile.range:new i.ElementAlignedBox3d}selectTilesForScene(e){return this.selectTiles(this.createDrawArgs(e))}selectTiles(e){const t=[];return void 0!==this._rootTile&&this._rootTile.selectTiles(t,e),t}drawScene(e){this.draw(this.createDrawArgs(e))}draw(e){const t=this.selectTiles(e);for(const r of t)r.drawGraphics(e);e.drawGraphics(),e.requestMissing()}requestTiles(e){this.loader.loadTileContents(e)}createDrawArgs(e){const t=n.BeTimePoint.now(),r=t.minus(this.expirationTime);return new Tile.DrawArgs(e,this.location.clone(),this,t,r,this.clipVector)}}t.TileTree=TileTree;const g=new i.ViewFlag.Overrides(i.ViewFlags.fromJSON({renderMode:6,noCameraLights:!0,noSourceLights:!0,noSolarLight:!0}));class TileLoader{loadGraphics(e,t,r=0){let i;if("string"===typeof t)i=n.base64StringToUint8Array(t);else if(t instanceof Uint8Array)i=t;else{if(!(t instanceof ArrayBuffer))return void e.setIsReady();i=new Uint8Array(t)}e.loadStatus=2;const o=new c.TileIO.StreamBuffer(i.buffer),s=o.nextUint32,p=()=>!e.isLoading;let f;switch(o.rewind(4),s){case 1835283298:f=l.B3dmTileIO.Reader.create(o,e.root.iModel,e.root.modelId,e.root.is3d,e.range,a.IModelApp.renderSystem,e.yAxisUp,e.isLeaf,p);break;case 1416521572:f=d.DgnTileIO.Reader.create(o,e.root.iModel,e.root.modelId,e.root.is3d,a.IModelApp.renderSystem,r,p);break;case 1818512745:f=h.IModelTileIO.Reader.create(o,e.root.iModel,e.root.modelId,e.root.is3d,a.IModelApp.renderSystem,r,p,e.hasSizeMultiplier?e.sizeMultiplier:void 0);break;case 1937010288:return void e.setGraphic(u.PntsTileIO.readPointCloud(o,e.root.iModel,e.root.modelId,e.root.is3d,e.range,a.IModelApp.renderSystem,e.yAxisUp))}if(void 0===f)return void e.setNotFound();const g=f.read();g.catch(t=>e.setNotFound()),g.then(t=>{e.isLoading&&(e.setGraphic(t.renderGraphic,t.isLeaf,t.contentRange,t.sizeMultiplier),a.IModelApp.viewManager.onNewTilesReady())})}get viewFlagOverrides(){return g}}function m(e,t){const r=e.diagonal(),n=t?e.high:e.low;r.x>r.y&&r.x>r.z?n.x=(e.low.x+e.high.x)/2:r.y>r.z?n.y=(e.low.y+e.high.y)/2:n.z=(e.low.z+e.high.z)/2}function y(e,t){const r=e.diagonal(),n=t?e.high:e.low;r.x>r.y?n.x=(e.low.x+e.high.x)/2:n.y=(e.low.y+e.high.y)/2}t.TileLoader=TileLoader;class IModelTileLoader extends TileLoader{constructor(e,t){super(),this._iModel=e,this._type=t}get maxDepth(){return 32}tileRequiresLoading(e){return 0!==e.maximumSize}get viewFlagOverrides(){return IModelTileLoader._viewFlagOverrides}async getChildrenProps(e){const t=[];if(e.isLeaf)return t;if(e.hasSizeMultiplier){const r=2*e.sizeMultiplier;let n=e.contentId;const i=n.lastIndexOf("/");return n=n.substring(0,i+1)+r.toString(16),t.push({contentId:n,range:e.range,contentRange:e.contentRange,sizeMultiplier:r,isLeaf:!1,maximumSize:512}),t}const r=e.contentId.split("/");r.length;parseInt(r[0],16);e.depth;const n=parseInt(r[1],16),i=parseInt(r[2],16),o=parseInt(r[3],16),s=e.root.is2d,a=s?y:m;for(let c=0;c<2;c++)for(let r=0;r<2;r++)for(let l=0;l<(s?1:2);l++){const u=e.range.clone();a(u,0===c),a(u,0===r),s||a(u,0===l);const d=2*n+c,h=2*i+r,p=2*o+l,f=(e.depth+1).toString(16)+"/"+d.toString(16)+"/"+h.toString(16)+"/"+p.toString(16)+"/1";t.push({contentId:f,range:u,maximumSize:512})}return t}async loadTileContents(e){for(const t of e)t.isNotLoaded,t.setIsQueued(),this._iModel.tiles.getTileContent(t.root.id,t.contentId).then(e=>{t.isQueued&&this.loadGraphics(t,e,this._type)}).catch(e=>{t.setNotFound()})}}IModelTileLoader._viewFlagOverrides=new i.ViewFlag.Overrides,t.IModelTileLoader=IModelTileLoader,function(e){class Params{constructor(e,t,r,n,i,o,s,a,c,l,u){this.id=e,this.rootTile=t,this.iModel=r,this.is3d=n,this.loader=i,this.location=o,this.modelId=s,this.maxTilesToSkip=a,this.yAxisUp=c,this.isTerrain=l,this.clipVector=u}static fromJSON(e,t,r,n,i){return new Params(e.id,e.rootTile,t,r,n,o.Transform.fromJSON(e.location),i,e.maxTilesToSkip,e.yAxisUp,e.isTerrain)}}let t;e.Params=Params,function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.NotFound=3]="NotFound"}(t=e.LoadStatus||(e.LoadStatus={}))}(TileTree=t.TileTree||(t.TileTree={}));t.TileTreeState=class TileTreeState{constructor(e,t,r){this._iModel=e,this._is3d=t,this._modelId=r,this.loadStatus=TileTree.LoadStatus.NotLoaded}get iModel(){return this._iModel}setTileTree(e,t){this.tileTree=new TileTree(TileTree.Params.fromJSON(e,this._iModel,this._is3d,t,this._modelId)),this.loadStatus=TileTree.LoadStatus.Loaded}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(11),i=r(7);class BufferHandle{constructor(){const e=i.System.instance.context.createBuffer();this._glBuffer=null!==e?e:void 0,this.isDisposed}get isDisposed(){return void 0===this._glBuffer}dispose(){this.isDisposed||(i.System.instance.context.deleteBuffer(this._glBuffer),this._glBuffer=void 0)}bind(e){void 0!==this._glBuffer&&i.System.instance.context.bindBuffer(e,this._glBuffer)}static unbind(e){i.System.instance.context.bindBuffer(e,null)}bindData(e,t,r=n.GL.Buffer.Usage.StaticDraw){this.bind(e),i.System.instance.context.bufferData(e,t,r),BufferHandle.unbind(e)}static createBuffer(e,t,r=n.GL.Buffer.Usage.StaticDraw){const i=new BufferHandle;if(!i.isDisposed)return i.bindData(e,t,r),i}static createArrayBuffer(e,t=n.GL.Buffer.Usage.StaticDraw){return BufferHandle.createBuffer(n.GL.Buffer.Target.ArrayBuffer,e,t)}isBound(e){return i.System.instance.context.getParameter(e)===this._glBuffer}}function o(e,t,r){r[e]=0!==t?1/t:t}function s(e){const t=new Float32Array(4);return t[0]=e.origin.x,t[1]=e.origin.y,o(2,e.scale.x,t),o(3,e.scale.y,t),t}function a(e){const t=new Float32Array(3);return t[0]=e.x,t[1]=e.y,t[2]=e.z,t}function c(e){const t=new Float32Array(3);return o(0,e.x,t),o(1,e.y,t),o(2,e.z,t),t}t.BufferHandle=BufferHandle,t.qparams2dToArray=s,t.qorigin3dToArray=a,t.qscale3dToArray=c,t.qparams3dToArray=function(e){return{origin:a(e.origin),scale:c(e.scale)}};class QBufferHandle2d extends BufferHandle{constructor(e){super(),this.params=s(e)}static create(e,t){const r=new QBufferHandle2d(e);if(!r.isDisposed)return r.bindData(n.GL.Buffer.Target.ArrayBuffer,t),r}}t.QBufferHandle2d=QBufferHandle2d;class QBufferHandle3d extends BufferHandle{constructor(e){super(),this.origin=a(e.origin),this.scale=c(e.scale)}static create(e,t){const r=new QBufferHandle3d(e);if(!r.isDisposed)return r.bindData(n.GL.Buffer.Target.ArrayBuffer,t),r}}t.QBufferHandle3d=QBufferHandle3d;class AttributeHandle{constructor(e){this._glId=e}static create(e,t,r=!1){const n=i.System.instance.context.getAttribLocation(e,t);if(-1!==n)return AttributeHandle._allocatedIds.add(n),new AttributeHandle(n)}setVertexAttribPointer(e,t,r,n,o){i.System.instance.context.vertexAttribPointer(this._glId,e,t,r,n,o)}enableVertexAttribArray(){i.System.instance.context.enableVertexAttribArray(this._glId)}disableVertexAttribArray(){i.System.instance.context.disableVertexAttribArray(this._glId)}enableArray(e,t,r,i,o,s){e.bind(n.GL.Buffer.Target.ArrayBuffer),this.setVertexAttribPointer(t,r,i,o,s),this.enableVertexAttribArray(),BufferHandle.unbind(n.GL.Buffer.Target.ArrayBuffer)}static disableAll(){const e=i.System.instance.context;for(const t of this._allocatedIds)e.disableVertexAttribArray(t)}}var l;AttributeHandle._allocatedIds=new Set,t.AttributeHandle=AttributeHandle,function(e){e[e.Undefined=0]="Undefined",e[e.Mat3=1]="Mat3",e[e.Mat4=2]="Mat4",e[e.Float=3]="Float",e[e.FloatArray=4]="FloatArray",e[e.Vec2=5]="Vec2",e[e.Vec3=6]="Vec3",e[e.Vec4=7]="Vec4",e[e.Int=8]="Int"}(l||(l={}));class UniformHandle{constructor(e){this._type=0,this._data=[],this._location=e}static create(e,t,r=!0){const n=i.System.instance.context.getUniformLocation(e,t);if(null!==n)return new UniformHandle(n)}updateData(e,t){let r=this._type!==e;r&&(this._type=e,this._data.length!==t.length&&(this._data.length=t.length));for(let n=0;n<t.length;n++){const e=t[n];r=r||this._data[n]!==e,this._data[n]=e}return r}updateDatum(e,t){1!==this._data.length&&(this._data.length=1);const r=this._type!==e||this._data[0]!==t;return this._type=e,this._data[0]=t,r}setMatrix3(e){this.updateData(1,e.data)&&i.System.instance.context.uniformMatrix3fv(this._location,!1,e.data)}setMatrix4(e){this.updateData(2,e.data)&&i.System.instance.context.uniformMatrix4fv(this._location,!1,e.data)}setUniform1fv(e){this.updateData(4,e)&&i.System.instance.context.uniform1fv(this._location,e)}setUniform2fv(e){this.updateData(5,e)&&i.System.instance.context.uniform2fv(this._location,e)}setUniform3fv(e){this.updateData(6,e)&&i.System.instance.context.uniform3fv(this._location,e)}setUniform4fv(e){this.updateData(7,e)&&i.System.instance.context.uniform4fv(this._location,e)}setUniform1i(e){this.updateDatum(8,e)&&i.System.instance.context.uniform1i(this._location,e)}setUniform1f(e){this.updateDatum(3,e)&&i.System.instance.context.uniform1f(this._location,e)}}t.UniformHandle=UniformHandle},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Primitive=0]="Primitive",e[e.Array=1]="Array",e[e.Struct=2]="Struct"}(t.PropertyValueFormat||(t.PropertyValueFormat={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(66);!function(e){e.Text="text",e.String="string",e.ShortDate="shortdate",e.Boolean="boolean",e.Float="float",e.Int="int",e.Hexadecimal="hexadecimal",e.Enum="enum",e.Point2d="point2d",e.Point3d="point3d"}(t.StandardTypeConverterTypeNames||(t.StandardTypeConverterTypeNames={}));t.TypeConverter=class TypeConverter{async convertToString(e){return void 0===e?"":e.toString()}async convertFromString(e){}async convertPropertyToString(e,t){return this.convertToString(t)}async convertFromStringToPropertyValue(e,t){const r=await this.convertFromString(e);return{valueFormat:n.PropertyValueFormat.Primitive,value:r||"",displayValue:""}}isEqualTo(e,t){return e===t}isNotEqualTo(e,t){return e!==t}get isStringType(){return!1}get isLessGreaterType(){return!1}get isNullableType(){return!1}get isBooleanType(){return!1}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(220)),n(r(546)),n(r(547)),n(r(319)),n(r(320)),n(r(179)),n(r(321)),n(r(30)),n(r(134)),n(r(146)),n(r(161)),n(r(76)),n(r(310)),n(r(312)),n(r(183)),n(r(103)),n(r(78)),n(r(548)),n(r(291)),n(r(86)),n(r(143)),n(r(63)),n(r(549)),n(r(311)),n(r(144)),n(r(135)),n(r(309)),n(r(132)),n(r(176)),n(r(317)),n(r(293)),n(r(104)),n(r(318)),n(r(20)),n(r(108)),n(r(8)),n(r(550)),n(r(64))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(17)),n(r(81)),n(r(56)),n(r(226)),n(r(231)),n(r(419)),n(r(97)),n(r(120)),n(r(247)),n(r(445)),n(r(119)),n(r(56)),n(r(29)),n(r(446)),n(r(248)),n(r(447)),n(r(448))},function(e,t,r){"use strict";var n=r(405),i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e,t,r){var o=t[r];if(void 0!==o&&null!==o){if(i.call(e,r)&&(void 0===e[r]||null===e[r]))throw new TypeError("Cannot convert undefined or null to object ("+r+")");i.call(e,r)&&n(o)?e[r]=a(Object(e[r]),t[r]):e[r]=o}}function a(e,t){if(e===t)return e;for(var r in t=Object(t))i.call(t,r)&&s(e,t,r);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(t),a=0;a<n.length;a++)o.call(t,n[a])&&s(e,t,n[a]);return e}e.exports=function(e){e=function(e){if(null===e||void 0===e)throw new TypeError("Sources cannot be null or undefined");return Object(e)}(e);for(var t=1;t<arguments.length;t++)a(e,arguments[t]);return e}},function(e,t){"function"===typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(16);class StrokeOptions{constructor(){this.shouldTriangulate=!1,this.defaultCircleStrokes=16}get needParams(){return void 0!==this._needParams&&this._needParams}set needParams(e){this._needParams=e}get needNormals(){return void 0!==this._needNormals&&this._needNormals}set needNormals(e){this._needNormals=e}get hasMaxEdgeLength(){return void 0!==this.maxEdgeLength&&this.maxEdgeLength>0}applyMaxEdgeLength(e,t){return this.maxEdgeLength&&this.maxEdgeLength>0&&e*this.maxEdgeLength<t&&(e=n.Geometry.stepCount(this.maxEdgeLength,t,e)),e}applyAngleTol(e,t,r){return StrokeOptions.applyAngleTol(this,e,t,r)}static applyAngleTol(e,t,r,i){r=Math.abs(r);let o=i||Math.PI/8;return e&&e.angleTol&&e.angleTol.radians>0&&(o=e.angleTol.radians),t*o<r&&(t=n.Geometry.stepCount(o,r,t)),t}static applyMaxEdgeLength(e,t,r){return r<0&&(r=-r),t<1&&(t=1),e&&e.maxEdgeLength&&e.maxEdgeLength*t<r&&(t=Math.ceil(r/e.maxEdgeLength+.99999)),t}applyTolerancesToArc(e,t=2*Math.PI){let r=1;return r=this.applyAngleTol(r,t,.25*Math.PI),r=this.applyMaxEdgeLength(r,t*e),r=this.applyChordTol(r,e,t),r=this.applyMinStrokesPerPrimitive(r)}applyChordTol(e,t,r){if(this.chordTol&&this.chordTol>0&&this.chordTol<t){const i=this.chordTol,o=2*Math.acos(1-i/t);e=n.Geometry.stepCount(o,r,e)}return e}applyMinStrokesPerPrimitive(e){return void 0!==this.minStrokesPerPrimitive&&Number.isFinite(this.minStrokesPerPrimitive)&&this.minStrokesPerPrimitive>e&&(e=this.minStrokesPerPrimitive),e}static createForCurves(){const e=new StrokeOptions;return e.angleTol=i.Angle.createDegrees(15),e}static createForFacets(){const e=new StrokeOptions;return e.angleTol=i.Angle.createDegrees(22.5),e}}t.StrokeOptions=StrokeOptions},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(15),i=r(43),o=r(0),s=r(52),a=r(25);class RpcOperationPolicy{constructor(){this.token=(e=>e.findParameterOfType(i.IModelToken)),this.requestId=(e=>o.Guid.createValue()),this.retryInterval=(e=>e.pendingOperationRetryInterval),this.requestCallback=(e=>{}),this.sentCallback=(e=>{}),this.invocationCallback=(e=>{}),this.allowResponseCaching=(e=>a.RpcResponseCacheControl.None)}}t.RpcOperationPolicy=RpcOperationPolicy;class RpcOperation{constructor(e,t,r){this.interfaceDefinition=e,this.operationName=t,this.policy=r}static lookup(e,t){const r="string"===typeof e?s.RpcRegistry.instance.lookupInterfaceDefinition(e):e;let i=RpcOperation.computeOperationName(t);for(const n of s.builtins)if(n===i){i=Symbol.for(n);break}const o=r.prototype;if(!o.hasOwnProperty(i))throw new n.IModelError(32768,`RPC interface class "${r.name}" does not does not declare operation "${t}"`);return o[i][s.OPERATION]}static forEach(e,t){Object.getOwnPropertyNames(e.prototype).forEach(r=>{if("constructor"===r||"configurationSupplier"===r)return;const n=RpcOperation.computeOperationName(r);t(e.prototype[n][s.OPERATION])}),Object.getOwnPropertySymbols(e.prototype).forEach(r=>{const n=e.prototype[r][s.OPERATION];n&&t(n)})}get interfaceVersion(){return this.interfaceDefinition.version}static computeOperationName(e){const t=e.indexOf(":");return-1===t?e:e.substring(0,t+1)}}RpcOperation.fallbackToken=void 0,t.RpcOperation=RpcOperation,function(e){e.setPolicy=function(t){return(r,n,i)=>{i.value[s.OPERATION]=new e(r.constructor,n,t)}},e.allowResponseCaching=function(t=a.RpcResponseCacheControl.Immutable){return(r,n,i)=>{i.value[s.OPERATION]=new e(r.constructor,n,new class extends RpcOperationPolicy{constructor(){super(...arguments),this.allowResponseCaching=(()=>t)}})}},e.setDefaultPolicy=function(e){return t=>{t[s.POLICY]=e}}}(RpcOperation=t.RpcOperation||(t.RpcOperation={}))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(52),i=r(62),o=r(15),s=r(25);let a,c="";var l;!function(e){e.createDefault=function(){return{[s.RpcMarshalingDirective.Binary]:!0,type:0,index:0,size:-1}}}(t.MarshalingBinaryMarker||(t.MarshalingBinaryMarker={})),function(e){e.create=function(e="",t=[]){return{objects:e,data:t}}}(l=t.RpcSerializedValue||(t.RpcSerializedValue={}));t.RpcMarshaling=class RpcMarshaling{constructor(){}static serialize(e,t,r){const n=l.create();return"undefined"===typeof r?n:(a=n,c="string"===typeof e?e:e.interfaceDefinition.name,n.objects=JSON.stringify(r,WireFormat.marshal),a=void 0,n)}static deserialize(e,t,r){if(""===r.objects)return;a=r;const n=JSON.parse(r.objects,WireFormat.unmarshal);return a=void 0,n}};class WireFormat{static marshal(t,r){t!==s.RpcMarshalingDirective.Name&&t!==s.RpcMarshalingDirective.Undefined&&t!==s.RpcMarshalingDirective.Unregistered||delete this[t];const i=this[t]!==r&&("object"!==typeof r||null===r||Array.isArray(r)||e.isBuffer(this[t])),o=i?this[t]:r,a=WireFormat.marshalBinary(o);if(a)return a;if("object"===typeof o&&null!==o&&!Array.isArray(o)&&o.constructor!==Object){const e=`${c}_${o.constructor.name}`,t=!n.RpcRegistry.instance.types.has(e);if(i)return WireFormat.marshalCustom(e,r,t);if(r instanceof Map)return WireFormat.marshalMap(e,r,t);if(r instanceof Set)return WireFormat.marshalSet(e,r,t);WireFormat.recordClass(r,e,t),r instanceof Error&&WireFormat.marshalError(r),WireFormat.recordUndefineds(r)}return r}static unmarshal(e,t){if("object"===typeof t&&null!==t){if(t[s.RpcMarshalingDirective.Binary])return WireFormat.unmarshalBinary(t);if(t[s.RpcMarshalingDirective.Name])return WireFormat.unmarshalObject(t)}return t}static marshalBinary(t){if(ArrayBuffer.isView(t)||e.isBuffer(t)){const r={[s.RpcMarshalingDirective.Binary]:!0,type:-1,index:-1,size:-1};let n=-1;if(e.isBuffer(t))n=0;else for(n=0;n!==WireFormat.binaryTypes.length&&!(t instanceof WireFormat.binaryTypes[n]);++n);if(-1===n)throw new o.IModelError(32768,`Cannot marshal binary type "${t.constructor.name}".`);return r.type=n,r.index=a.data.push(t)-1,r.size=t.byteLength,r}}static unmarshalBinary(e){if(e.type>=WireFormat.binaryTypes.length)throw new o.IModelError(32768,"Cannot unmarshal unknown binary type.");if(e.index>=a.data.length)throw new o.IModelError(32768,"Cannot unmarshal missing binary value.");return new WireFormat.binaryTypes[e.type](a.data[e.index])}static marshalCustom(e,t,r){return{[s.RpcMarshalingDirective.Name]:e,[s.RpcMarshalingDirective.JSON]:t,[s.RpcMarshalingDirective.Unregistered]:r}}static marshalMap(e,t,r){return{[s.RpcMarshalingDirective.Name]:e,[s.RpcMarshalingDirective.Map]:Array.from(t),[s.RpcMarshalingDirective.Unregistered]:r}}static marshalSet(e,t,r){return{[s.RpcMarshalingDirective.Name]:e,[s.RpcMarshalingDirective.Set]:Array.from(t),[s.RpcMarshalingDirective.Unregistered]:r}}static marshalError(e){e[s.RpcMarshalingDirective.Error]=!0;const t=e.name;e.name="";const r=e.message;e.message="[Backend to Frontend Transition]";let n=e.stack;"undefined"===typeof n&&(n="[Backend to Frontend Transition]\n[Backend Implementation]"),e[s.RpcMarshalingDirective.ErrorStack]=n,e.message=r,e[s.RpcMarshalingDirective.ErrorMessage]=e.message,e.name=t,e[s.RpcMarshalingDirective.ErrorName]=e.name}static recordUndefineds(e){const t=[];for(const r in e)e.hasOwnProperty(r)&&void 0===e[r]&&t.push(r);t.length&&(e[s.RpcMarshalingDirective.Undefined]=t)}static unmarshalCustom(e,t){if(e){const r=e.fromJSON;return r?r(t):new e(t)}return t}static buildDescriptors(e){const t=e[s.RpcMarshalingDirective.Error];delete e[s.RpcMarshalingDirective.Error];const r=e[s.RpcMarshalingDirective.ErrorName];delete e[s.RpcMarshalingDirective.ErrorName];const n=e[s.RpcMarshalingDirective.ErrorMessage];delete e[s.RpcMarshalingDirective.ErrorMessage];const i=e[s.RpcMarshalingDirective.ErrorStack];delete e[s.RpcMarshalingDirective.ErrorStack];const o={},a=Object.keys(e);for(const s of a)o[s]=Object.getOwnPropertyDescriptor(e,s);return t&&(o.hasOwnProperty("name")||(o.name={configurable:!0,enumerable:!0,writable:!0,value:r}),o.hasOwnProperty("message")||(o.message={configurable:!0,enumerable:!0,writable:!0,value:n}),o.hasOwnProperty("stack")||(o.stack={configurable:!0,enumerable:!0,writable:!0,value:i})),o}static inflateObject(e,t){const r=t[s.RpcMarshalingDirective.Undefined];r&&delete t[s.RpcMarshalingDirective.Undefined];const n=WireFormat.buildDescriptors(t);if(r)for(const i of r)n[i]={configurable:!0,enumerable:!0,writable:!0,value:void 0};return Object.create(e?e.prototype:Object.prototype,n)}static unmarshalObject(e){const t=e[s.RpcMarshalingDirective.Name];delete e[s.RpcMarshalingDirective.Name],WireFormat.checkUnregistered(t,e);const r=n.RpcRegistry.instance.types.get(t),i=e[s.RpcMarshalingDirective.JSON];if(i)return WireFormat.unmarshalCustom(r,i);{const t=e[s.RpcMarshalingDirective.Map],n=e[s.RpcMarshalingDirective.Set];return t?new Map(t):n?new Set(n):WireFormat.inflateObject(r,e)}}static checkUnregistered(e,t){if(i.RpcConfiguration.strictMode&&t[s.RpcMarshalingDirective.Unregistered]){const[t,r]=e.split("_",2);throw new Error(`Cannot unmarshal type "${r} for this RPC interface. Ensure this type is listed in ${t}.types or suppress using RpcConfiguration.strictMode.`)}delete t[s.RpcMarshalingDirective.Unregistered]}static recordClass(e,t,r){e[s.RpcMarshalingDirective.Name]=t,e[s.RpcMarshalingDirective.Unregistered]=r}}WireFormat.binaryTypes=[Uint8Array]}).call(this,r(36).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(73),o=r(85),s=r(74),a=r(52),c=r(15),l=r(25),u={lastRequest:0,lastResponse:0};class RpcRequest{constructor(e,t,r){this._resolve=(()=>void 0),this._reject=(()=>void 0),this._created=0,this._lastSubmitted=0,this._lastUpdated=0,this._status=l.RpcRequestStatus.Unknown,this._extendedStatus="",this._connecting=!1,this._active=!0,this._created=(new Date).getTime(),this.path="",this.method="",this.client=e,this.protocol=e.configuration.protocol,this.operation=i.RpcOperation.lookup(e.constructor,t),this.parameters=r,this.retryInterval=this.operation.policy.retryInterval(e.configuration),this.response=new Promise((e,t)=>{this._resolve=e,this._reject=t}),this.id=this.operation.policy.requestId(this),this.setStatus(l.RpcRequestStatus.Created),this.operation.policy.requestCallback(this)}static get aggregateLoad(){return u}static current(e){return e[a.CURRENT_REQUEST]}get status(){return this._status}get extendedStatus(){return this._extendedStatus}get lastSubmitted(){return this._lastSubmitted}get lastUpdated(){return this._lastUpdated}get connecting(){return this._connecting}get pending(){switch(this.status){case l.RpcRequestStatus.Submitted:case l.RpcRequestStatus.Pending:return!0;default:return!1}}get elapsed(){return this._lastUpdated-this._created}findParameterOfType(e){for(const t of this.parameters)if(t instanceof e)return t}setLastUpdatedTime(){this._lastUpdated=(new Date).getTime()}async submit(){if(this._active){this._lastSubmitted=(new Date).getTime(),this.status!==l.RpcRequestStatus.Created&&this.status!==l.RpcRequestStatus.NotFound||this.setStatus(l.RpcRequestStatus.Submitted);try{this._connecting=!0,this.protocol.events.raiseEvent(l.RpcProtocolEvent.RequestCreated,this),this.setHeaders();const e=this.send();this.operation.policy.sentCallback(this);const t=await e;this.protocol.events.raiseEvent(l.RpcProtocolEvent.ResponseLoading,this);const r=await this.load();this.protocol.events.raiseEvent(l.RpcProtocolEvent.ResponseLoaded,this),this._connecting=!1,this.handleResponse(t,r)}catch(e){this.protocol.events.raiseEvent(l.RpcProtocolEvent.ConnectionErrorReceived,this,e),this._connecting=!1,this.reject(e)}}}handleResponse(e,t){const r=this.protocol.getStatus(e);switch(r){case l.RpcRequestStatus.Resolved:return this.handleResolved(t);case l.RpcRequestStatus.Rejected:return this.handleRejected(t);case l.RpcRequestStatus.Pending:return this.setPending(r,t.objects);case l.RpcRequestStatus.NotFound:return this.handleNotFound(r,t)}}handleResolved(e){try{const t=s.RpcMarshaling.deserialize(this.operation,this.protocol,e);return this.resolve(t)}catch(e){return this.reject(e)}}handleRejected(e){this.protocol.events.raiseEvent(l.RpcProtocolEvent.BackendErrorReceived,this);try{const t=new Error,r=s.RpcMarshaling.deserialize(this.operation,this.protocol,e);t.name=r.name,t.message=r.message;const n=t.stack,i=r.stack;return r.stack=`${n}\n${i}`,this.reject(r)}catch(e){return this.reject(e)}}handleNotFound(e,t){const r=s.RpcMarshaling.deserialize(this.operation,this.protocol,t);this.setStatus(e);let n=!1;RpcRequest.notFoundHandlers.raiseEvent(this,r,()=>{if(n)throw new c.IModelError(32768,"Already resubmitted using this handler.");n=!0,this.submit()},e=>this.reject(e))}resolve(e){this._active&&(this._active=!1,this.setLastUpdatedTime(),this._resolve(e),this.setStatus(l.RpcRequestStatus.Resolved),this.dispose())}reject(e){this._active&&(this._active=!1,this.setLastUpdatedTime(),this._reject(e),this.setStatus(l.RpcRequestStatus.Rejected),this.dispose())}dispose(){this.setStatus(l.RpcRequestStatus.Disposed);const e=this.client;e[a.CURRENT_REQUEST]===this&&(e[a.CURRENT_REQUEST]=void 0)}setPending(e,t){this._active&&(this.setLastUpdatedTime(),this._extendedStatus=t,this.setStatus(e),RpcRequest.events.raiseEvent(l.RpcRequestEvent.PendingUpdateReceived,this))}setHeaders(){this.setHeader(this.protocol.requestIdHeaderName,this.id),this.protocol.authorizationHeaderName&&this.setHeader(this.protocol.authorizationHeaderName,this.protocol.configuration.applicationAuthorizationValue)}setStatus(e){this._status!==e&&(this._status=e,RpcRequest.events.raiseEvent(l.RpcRequestEvent.StatusChanged,this))}}RpcRequest.events=new n.BeEvent,RpcRequest.notFoundHandlers=new n.BeEvent,t.RpcRequest=RpcRequest,t.initializeRpcRequest=(()=>{let e=!1;return()=>{e||(e=!0,RpcRequest.events.addListener((e,t)=>{if(e===l.RpcRequestEvent.StatusChanged)switch(t.status){case l.RpcRequestStatus.Submitted:u.lastRequest=t.lastSubmitted;break;case l.RpcRequestStatus.Pending:case l.RpcRequestStatus.Resolved:case l.RpcRequestStatus.Rejected:u.lastResponse=t.lastUpdated}}),o.RpcProtocol.events.addListener(e=>{const t=(new Date).getTime();switch(e){case l.RpcProtocolEvent.RequestReceived:u.lastRequest=t;break;case l.RpcProtocolEvent.BackendReportedPending:case l.RpcProtocolEvent.BackendErrorOccurred:case l.RpcProtocolEvent.BackendResponseCreated:u.lastResponse=t}}))}})()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(131),o=r(30),s=r(103),a=r(132),c=r(86),l=r(8),u=r(0),d=r(4);class AccuSnap{constructor(){this.needFlash=new Set,this.areFlashed=new Set,this.cross=new a.SpriteLocation,this.icon=new a.SpriteLocation,this.errorIcon=new a.SpriteLocation,this._suppressed=0,this._motionStopTime=0,this._lastCursorPos=new n.Point2d,this.toolState=new AccuSnap.ToolState,this._settings=new AccuSnap.Settings}onInitialized(){}get _searchDistance(){return this.isLocateEnabled?1:this._settings.searchDistance}get _hotDistanceInches(){return l.IModelApp.locateManager.apertureInches*this._settings.hotDistanceFactor}get isLocateEnabled(){return this.toolState.locate}get isSnapEnabled(){return this.toolState.enabled}get isSnapEnabledByUser(){return this._settings.enableFlag}isFlashed(e){return this.areFlashed.has(e)}needsFlash(e){return this.needFlash.has(e)}setNeedsFlash(e){this.needFlash.add(e),this.clearIsFlashed(e),e.invalidateDecorations()}setIsFlashed(e){this.areFlashed.add(e)}clearIsFlashed(e){this.areFlashed.delete(e)}static toSnapDetail(e){return e&&e instanceof c.SnapDetail?e:void 0}getCurrSnapDetail(){return AccuSnap.toSnapDetail(this.currHit)}get isHot(){const e=this.getCurrSnapDetail();return!!e&&e.isHot}destroy(){this.currHit=void 0,this.aSnapHits=void 0}get _doSnapping(){return this.isSnapEnabled&&this.isSnapEnabledByUser&&!this._isSnapSuspended}get _isSnapSuspended(){return 0!==this._suppressed||0!==this.toolState.suspended}get keypointDivisor(){return 2}getActiveSnapModes(){const e=[];return e.push(2),e}synchSnapMode(){}get _searchForExtendedIntersections(){const e=l.IModelApp.tentativePoint.getCurrSnap();return void 0!==e&&void 0!==e.primitive}get isActive(){if(l.IModelApp.tentativePoint.isActive){if(!this._doSnapping||!this._searchForExtendedIntersections)return!1;const e=this.getActiveSnapModes();for(const t of e)if(64===t)return!0;return!1}return this._doSnapping||this.isLocateEnabled}initializeForCheckMotion(){this._lastCursorPos.setFrom(l.IModelApp.toolAdmin.currentInputState.lastMotion)}clear(){this.setCurrHit(void 0)}setCurrHit(e){const t=AccuSnap.toSnapDetail(e),r=this.getCurrSnapDetail(),n=void 0!==e&&e.isSameHit(this.currHit),i=n&&!t,o=n&&void 0!==t&&void 0!==r,s=i||o&&t.snapPoint.isAlmostEqual(r.snapPoint),a=i||o&&this.isHot===t.isHot,c=!t||!r||t.snapMode===r.snapMode,l=a&&(!r||r.getHitType()===e.getHitType());s&&l&&c?this.currHit=e:(this.erase(),a&&c||(this.unFlashViews(),this.setFlashHit(e)),void 0!==(this.currHit=e)&&this.showSnapSprite())}flashHitInView(e,t){const r=t.viewport;r&&this.hitShouldBeHilited(e)&&this.needsFlash(r)&&(e.draw(t),this.setIsFlashed(r))}setNeedsFlashView(e){this.isFlashed(e)||this.needsFlash(e)||this.setNeedsFlash(e)}setFlashHit(e){void 0!==e&&this.hitShouldBeHilited(e)&&this.setNeedsFlashView(e.viewport)}erase(){this.clearToolTip(void 0),this.clearSprites()}async showElemInfo(e,t,r){if(l.IModelApp.viewManager.doesHostHaveFocus){const n=await l.IModelApp.toolAdmin.getToolTip(r);this.showLocateMessage(e,t,n)}}showLocateMessage(e,t,r){l.IModelApp.viewManager.doesHostHaveFocus&&t.openToolTip(r,e)}async displayToolTip(e,t,r){if(0===this._motionStopTime||!this._settings.toolTip||!l.IModelApp.notifications.isToolTipSupported||l.IModelApp.notifications.isToolTipOpen)return;const n=this.currHit,i=l.IModelApp.tentativePoint.getCurrSnap();if(!n&&!i&&!this.errorIcon.isActive)return;const o=void 0===i||void 0!==r?this._settings.toolTipDelay:u.BeDuration.fromSeconds(.1);if(this._motionStopTime+o.milliseconds>Date.now())return;let s;if(this._motionStopTime=0,i){if(r){const e=this._settings.stickyFactor*t.pixelsFromInches(l.IModelApp.locateManager.apertureInches)/2+1.5;if(!l.IModelApp.locateManager.picker.testHit(i,t,r,e,l.IModelApp.locateManager.options))return}s=i}else s=n;if(!this.errorIcon.isActive&&s)return this.showElemInfo(e,t,s);this.explanation?this.showLocateMessage(e,t,this.explanation):this.errorKey&&(this.explanation=l.IModelApp.i18n.translate(this.errorKey),this.explanation&&(s||(s=this.aSnapHits?this.aSnapHits.hits[0]:void 0),this.showLocateMessage(e,t,this.explanation)))}clearToolTip(e){l.IModelApp.notifications.isToolTipOpen&&(e&&5>e.viewPoint.distanceXY(l.IModelApp.notifications.toolTipLocation)||l.IModelApp.notifications.clearToolTip())}showSnapSprite(){const e=this.getCurrSnapDetail();if(!e)return;const t=e.snapPoint,r=e.viewport,n=a.IconSprites.getSpriteFromUrl(e.isHot?"SnapCross.png":"SnapUnfocused.png");this.cross.activate(n,r,t);const i=e.sprite;i&&this.icon.activate(i,r,AccuSnap.adjustIconLocation(r,t,i.size))}static adjustIconLocation(e,t,r){const n=e.worldToView(t);return n.x+=r.x/3,n.y-=1.3*r.y,e.viewToWorld(n,n)}showSnapError(e,t){this.errorIcon.deactivate();const r=t.viewport;let n;switch(e){case 500:case 600:n=a.IconSprites.getSpriteFromUrl("SnapAppFiltered.png");break;case 700:this.errorKey=void 0;break;case 300:n=a.IconSprites.getSpriteFromUrl("SnapNotSnappable.png"),this.errorKey=s.ElementLocateManager.getFailureMessageKey("NotSnappable");break;case 301:n=a.IconSprites.getSpriteFromUrl("SnapNotSnappable.png"),this.errorKey=s.ElementLocateManager.getFailureMessageKey("ModelNotAllowed")}if(!n)return;const i=n.size,o=AccuSnap.adjustIconLocation(r,t.rawPoint,i);this.errorIcon.activate(n,r,o)}clearSprites(){this.errorIcon.deactivate(),this.cross.deactivate(),this.icon.deactivate()}hitShouldBeHilited(e){if(!e)return!1;if(e.isModelHit)return!1;const t=AccuSnap.toSnapDetail(e);return!t||t.isHot||this._settings.hiliteColdHits}unFlashViews(){this.needFlash.clear(),this.areFlashed.forEach(e=>{e.setFlashed(void 0,0)}),this.areFlashed.clear()}adjustPointIfHot(e,t){const r=this.getCurrSnapDetail();r&&r.isHot&&t===r.viewport&&e.setFrom(r.adjustedPoint)}onEnabledStateChange(e,t){}getHitAndList(e){const t=this.currHit;return t&&(e.setHitList(this.aSnapHits),this.aSnapHits=void 0),t}initCmdState(){this.toolState.suspended=0}suspend(e){const t=this._doSnapping;e?this.toolState.suspended++:this.toolState.suspended>0&&this.toolState.suspended--,this.onEnabledStateChange(this._doSnapping,t)}suppress(e){const t=this._doSnapping;return e?this._suppressed++:this._suppressed>0&&this._suppressed--,this.onEnabledStateChange(this._doSnapping,t),this._suppressed}enableSnap(e){const t=this._doSnapping;this.toolState.enabled=e,e||this.clear(),this.onEnabledStateChange(this._doSnapping,t)}intersectXY(e,t){const r=e.getCurvePrimitive();if(void 0===r)return;const i=t.getCurvePrimitive();if(void 0===i)return;const o=t.viewport.worldToViewMap.transform0,s=n.CurveCurve.IntersectionProjectedXY(o,r,!0,i,!0);if(0===s.dataA.length)return;let a=0;if(s.dataA.length>1){const r=o.multiplyPoint3d(1===e.geomType&&1!==t.geomType?t.getPoint():e.getPoint(),1);let n;for(let e=0;e<s.dataA.length;e++){const t=o.multiplyPoint3d(s.dataA[e].point,1),i=r.realDistanceXY(t);void 0!==i&&(void 0===n||i<n)&&(n=i,a=e)}}const l=new c.IntersectDetail(e,2,s.dataA[a].point,i,t.sourceId);return l.primitive=r,l}static async requestSnap(e,t,r,o,s,a){const u={id:e.sourceId,testPoint:e.testPoint,closePoint:e.hitPoint,worldToView:e.viewport.worldToViewMap.transform0.toJSON(),viewFlags:e.viewport.viewFlags,snapModes:t,snapAperture:e.viewport.pixelsFromInches(r),snapDivisor:o};if(!e.isElementHit){const t=l.IModelApp.viewManager.getDecorationGeometry(e);if(void 0===t)return void(a&&(a.snapStatus=200));u.decorationGeometry=[new d.DecorationGeometryProps(e.sourceId,t)]}if(t.includes(64)){if(void 0!==s)for(const t of s.hits)if(e.sourceId!==t.sourceId){if(!t.isElementHit){const e=l.IModelApp.viewManager.getDecorationGeometry(t);if(void 0===e)continue;void 0===u.decorationGeometry?u.decorationGeometry=[new d.DecorationGeometryProps(t.sourceId,e)]:u.decorationGeometry.push(new d.DecorationGeometryProps(t.sourceId,e))}if(void 0===u.intersectCandidates?u.intersectCandidates=[t.sourceId]:u.intersectCandidates.push(t.sourceId),5===u.intersectCandidates.length)break}if(1===t.length&&void 0===u.intersectCandidates)return void(a&&(a.snapStatus=200))}let h=await e.viewport.iModel.requestSnap(u);if(a&&(a.snapStatus=h.status),0!==h.status)return;if(void 0!==h.category&&void 0!==h.subCategory){const t=e.viewport.view,r=t.getSubCategoryAppearance(h.subCategory);if(r.invisible){const r=t.subCategories.getSubCategories(h.category);if(void 0!==r){u.offSubCategories=[h.subCategory];for(const e of r)e!==h.subCategory&&t.getSubCategoryAppearance(e).invisible&&u.offSubCategories.push(e)}if(void 0===u.offSubCategories)return void(a&&(a.snapStatus=200));if(0===(h=await e.viewport.iModel.requestSnap(u)).status&&void 0!==h.subCategory){const e=t.getSubCategoryAppearance(h.subCategory);e.invisible?h.status=200:e.dontSnap&&(h.status=300)}if(a&&(a.snapStatus=h.status),0!==h.status)return}else if(r.dontSnap)return void(a&&(a.snapStatus=300))}const p=new c.SnapDetail(e,h.snapMode,h.heat,h.snapPoint);if(p.setCurvePrimitive(void 0!==h.curve?i.IModelJson.Reader.parse(h.curve):void 0,void 0,h.geomType),void 0!==h.parentGeomType&&(p.parentGeomType=h.parentGeomType),void 0!==h.hitPoint&&p.hitPoint.setFromJSON(h.hitPoint),void 0!==h.normal&&(p.normal=n.Vector3d.fromJSON(h.normal)),64!==p.snapMode)return p;if(void 0===h.intersectId)return;const f=void 0!==h.intersectCurve?i.IModelJson.Reader.parse(h.intersectCurve):void 0;return void 0!==f?new c.IntersectDetail(p,p.heat,p.snapPoint,f,h.intersectId):void 0}async getAccuSnapDetail(e,t){const r=e.getNextHit();if(void 0===r)return;let n;l.IModelApp.tentativePoint.isActive?(n=[]).push(1):n=this.getActiveSnapModes(),this.explanation="";const i=await AccuSnap.requestSnap(r,n,this._hotDistanceInches,this.keypointDivisor,e,t);if(void 0!==i){if(0===(this.isLocateEnabled?l.IModelApp.locateManager.filterHit(i,1,t):0)){if(l.IModelApp.tentativePoint.isActive){const t=l.IModelApp.tentativePoint.getCurrSnap();if(void 0===t)return;const n=this.intersectXY(t,i);if(void 0===n)return;return e.setCurrentHit(r),n}return l.IModelApp.accuDraw.onSnap(i),e.setCurrentHit(r),i}t.snapStatus=600}}findHits(e,t=!1){const r=this.isLocateEnabled?e.point:e.rawPoint,n=e.viewport,i=l.IModelApp.locateManager.picker,o=l.IModelApp.locateManager.options.clone();o.hitSource=this.isSnapEnabled?3:2;let s=n.pixelsFromInches(l.IModelApp.locateManager.apertureInches)/2+1.5;if(this.initializeForCheckMotion(),s*=this._searchDistance,0===i.doPick(n,r,s,o))return this.aSnapHits=void 0,2;if(this.aSnapHits=i.getHitList(!0),!t&&this.aSnapHits.length>1&&this.currHit&&3!==this.currHit.getHitType()&&this.currHit.priority<4)for(let a=1;a<this.aSnapHits.length;++a){const e=this.aSnapHits.hits[a];if(e.isSameHit(this.currHit)){this.aSnapHits.removeHit(a),this.aSnapHits.insertHit(0,e);break}}return 0}async findLocatableHit(e,t,r){if(r.snapStatus=2,t){if(this.aSnapHits=void 0,0!==(r.snapStatus=this.findHits(e)))return}else if(!this.aSnapHits)return void(r.snapStatus=2);const n=this.aSnapHits;let i;const o=new s.LocateResponse;for(;void 0!==(i=n.getNextHit());){if(0===await l.IModelApp.locateManager.filterHit(i,1,r))return i;r.snapStatus=600,r=o}n.resetCurrentHit()}async resetButton(){let e;const t=new s.LocateResponse;t.snapStatus=100,this.clearToolTip(void 0);const r=new o.BeButtonEvent;return l.IModelApp.toolAdmin.fillEventFromCursorLocation(r),this._doSnapping?this.aSnapHits&&0!==this.aSnapHits.length?(this.aSnapHits.removeCurrentHit(),e=await this.getAccuSnapDetail(this.aSnapHits,t)):(t.snapStatus=this.findHits(r),e=0!==t.snapStatus?void 0:await this.getAccuSnapDetail(this.aSnapHits,t)):this.isLocateEnabled&&(e=await this.findLocatableHit(r,!1,t)),(e||this.currHit)&&this.setCurrHit(e),this.showSnapError(t.snapStatus,r),t.snapStatus}async onMotion(e){this.clearToolTip(e);const t=new s.LocateResponse;let r;t.snapStatus=100,this.isActive&&(this._doSnapping?(t.snapStatus=this.findHits(e),r=0!==t.snapStatus?void 0:await this.getAccuSnapDetail(this.aSnapHits,t)):this.isLocateEnabled&&(r=await this.findLocatableHit(e,!0,t))),(r||this.currHit)&&this.setCurrHit(r),this.showSnapError(t.snapStatus,e)}onMotionStopped(e){this._motionStopTime=Date.now()}async onNoMotion(e){return this.displayToolTip(e.viewPoint,e.viewport,e.rawPoint)}flashElements(e){const t=e.viewport;if(this.currHit)return void(this.needsFlash(t)&&this.flashHitInView(this.currHit,e));const r=l.IModelApp.tentativePoint.getCurrSnap();r&&r.draw(e)}decorate(e){this.flashElements(e),this.cross.isActive&&(this.cross.decorate(e),this.icon.decorate(e)),this.errorIcon.decorate(e)}clearElemFromHitList(e){this.aSnapHits&&this.aSnapHits.removeHitsFrom(e)}clearIfElement(e){this.clearElemFromHitList(e);const t=this.currHit;t&&t.sourceId===e&&this.destroy()}enableLocate(e){this.toolState.locate=e}onStartTool(){this.initCmdState(),this.enableSnap(!1),this.enableLocate(!1),l.IModelApp.tentativePoint.clear(!0)}async reEvaluate(){if(this.getCurrSnapDetail()){const e=new o.BeButtonEvent;return l.IModelApp.toolAdmin.fillEventFromCursorLocation(e),this.onMotion(e)}}}t.AccuSnap=AccuSnap;t.TentativeOrAccuSnap=class TentativeOrAccuSnap{static get isHot(){return l.IModelApp.accuSnap.isHot||l.IModelApp.tentativePoint.isSnapped}static getCurrentSnap(e=!0){return l.IModelApp.accuSnap.isHot?l.IModelApp.accuSnap.getCurrSnapDetail():l.IModelApp.tentativePoint.isSnapped?l.IModelApp.tentativePoint.currSnap:e?void 0:l.IModelApp.accuSnap.getCurrSnapDetail()}static getCurrentPoint(){if(l.IModelApp.accuSnap.isHot){const e=l.IModelApp.accuSnap.getCurrSnapDetail();if(e)return e.adjustedPoint}return l.IModelApp.tentativePoint.getPoint()}static getCurrentView(){const e=l.IModelApp.accuSnap.getCurrSnapDetail();return e?e.viewport:l.IModelApp.tentativePoint.viewport}},function(e){class ToolState{constructor(){this.enabled=!1,this.locate=!1,this.suspended=0}setFrom(e){this.enabled=e.enabled,this.locate=e.locate,this.suspended=e.suspended}clone(){const e=new ToolState;return e.setFrom(this),e}}e.ToolState=ToolState;e.Settings=class Settings{constructor(){this.hotDistanceFactor=1.2,this.stickyFactor=1,this.searchDistance=2,this.hiliteColdHits=!0,this.enableFlag=!0,this.toolTip=!0,this.toolTipDelay=u.BeDuration.fromSeconds(.5)}}}(AccuSnap=t.AccuSnap||(t.AccuSnap={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(0);class DisplayParams{constructor(e,t,r,i=0,o=0,s=n.FillFlags.None,a,c,l=!1,u){this.type=DisplayParams.Type.Mesh,this.type=e,this.material=a,this.gradient=c,this.lineColor=DisplayParams.adjustTransparencyInPlace(t),this.fillColor=DisplayParams.adjustTransparencyInPlace(r),this.width=i,this.linePixels=o,this.fillFlags=s,this.ignoreLighting=l,this._textureMapping=u}static createForType(e,t,r){const i=DisplayParams.adjustTransparencyInPlace(t.lineColor.clone());switch(e){case DisplayParams.Type.Mesh:{let o;if(void 0!==t.gradient&&void 0!==r){const e=r(t.gradient);void 0!==e&&(o=new n.TextureMapping(e,new n.TextureMapping.Params))}return new DisplayParams(e,i,DisplayParams.adjustTransparencyInPlace(t.fillColor.clone()),t.rasterWidth,t.linePixels,t.fillFlags,t.material,t.gradient,!1,o)}case DisplayParams.Type.Linear:return new DisplayParams(e,i,i,t.rasterWidth,t.linePixels);default:return new DisplayParams(e,i,i,0,0,n.FillFlags.Always,void 0,void 0,!0)}}static createForMesh(e,t){return DisplayParams.createForType(DisplayParams.Type.Mesh,e,t)}static createForLinear(e){return DisplayParams.createForType(DisplayParams.Type.Linear,e)}static createForText(e){return DisplayParams.createForType(DisplayParams.Type.Text,e)}get regionEdgeType(){if(this.hasBlankingFill)return DisplayParams.RegionEdgeType.None;if(void 0!==this.gradient&&void 0!==this.gradient.flags){return 0!==(2&this.gradient.flags)||n.FillFlags.None===(this.fillFlags&n.FillFlags.Always)?DisplayParams.RegionEdgeType.Outline:DisplayParams.RegionEdgeType.None}return this.fillColor.equals(this.lineColor)?DisplayParams.RegionEdgeType.Default:DisplayParams.RegionEdgeType.Outline}get wantRegionOutline(){return DisplayParams.RegionEdgeType.Outline===this.regionEdgeType}get hasBlankingFill(){return n.FillFlags.Blanking===(this.fillFlags&n.FillFlags.Blanking)}get hasFillTransparency(){return 255!==this.fillColor.getAlpha()}get hasLineTransparency(){return 255!==this.lineColor.getAlpha()}get textureMapping(){return void 0!==this.material?this.material.textureMapping:this._textureMapping}get isTextured(){return void 0!==this.textureMapping}equals(e,t=DisplayParams.ComparePurpose.Strict){return DisplayParams.ComparePurpose.Merge===t?0===this.compareForMerge(e):e===this||this.type===e.type&&(this.ignoreLighting===e.ignoreLighting&&(this.width===e.width&&(this.linePixels===e.linePixels&&(this.fillFlags===e.fillFlags&&(this.wantRegionOutline===e.wantRegionOutline&&(this.material===e.material&&(this.textureMapping===e.textureMapping&&(!!this.fillColor.equals(e.fillColor)&&!!this.lineColor.equals(e.lineColor)))))))))}compareForMerge(e){if(e===this)return 0;let t=i.compareNumbers(this.type,e.type);return 0===t&&0===(t=i.compareBooleans(this.ignoreLighting,e.ignoreLighting))&&0===(t=i.compareNumbers(this.width,e.width))&&0===(t=i.compareNumbers(this.linePixels,e.linePixels))&&0===(t=i.compareNumbers(this.fillFlags,e.fillFlags))&&0===(t=i.compareBooleans(this.wantRegionOutline,e.wantRegionOutline))&&0===(t=i.compareBooleans(this.hasFillTransparency,e.hasFillTransparency))&&0===(t=i.compareBooleans(this.hasLineTransparency,e.hasLineTransparency))&&0===(t=function(e,t){return i.comparePossiblyUndefined((e,t)=>e===t?0:i.compareStringsOrUndefined(e.key,t.key),e,t)}(this.material,e.material))&&void 0===this.material&&this.isTextured&&(t=function(e,t){return i.comparePossiblyUndefined((e,t)=>e===t?0:i.compareStringsOrUndefined(e.texture.key,t.texture.key),e,t)}(this.textureMapping,e.textureMapping)),t}static adjustTransparencyInPlace(e){return e.colors.t<DisplayParams.minTransparency&&e.setTransparency(0),e}}DisplayParams.minTransparency=15,t.DisplayParams=DisplayParams,function(e){let t,r,n;!function(e){e[e.Mesh=0]="Mesh",e[e.Linear=1]="Linear",e[e.Text=2]="Text"}(t=e.Type||(e.Type={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Outline=2]="Outline"}(r=e.RegionEdgeType||(e.RegionEdgeType={})),function(e){e[e.Merge=0]="Merge",e[e.Strict=1]="Strict"}(n=e.ComparePurpose||(e.ComparePurpose={}))}(DisplayParams=t.DisplayParams||(t.DisplayParams={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4);class EntityState{constructor(e,t,r){this.classFullName=e.classFullName,this.iModel=t,this.id=n.Id64.fromJSON(e.id),this.jsonProperties=e.jsonProperties?JSON.parse(JSON.stringify(e.jsonProperties)):{}}toJSON(){const e={};return e.classFullName=this.classFullName,n.Id64.isValid(this.id)&&(e.id=this.id),this.jsonProperties&&Object.keys(this.jsonProperties).length>0&&(e.jsonProperties=this.jsonProperties),e}equals(e){return JSON.stringify(this.toJSON())===JSON.stringify(e.toJSON())}clone(){return new this.constructor(this.toJSON(),this.iModel,this)}static getClassFullName(){return this.schemaName+":"+this.className}static get sqlName(){return this.schemaName+"."+this.className}static get className(){return this.name.slice(0,this.name.lastIndexOf("State"))}}EntityState.schemaName="BisCore",t.EntityState=EntityState;t.ElementState=class ElementState extends EntityState{constructor(e,t){super(e,t),this.code=i.Code.fromJSON(e.code),this.model=i.RelatedElement.idFromJson(e.model),this.parent=i.RelatedElement.fromJSON(e.parent),this.federationGuid=e.federationGuid,this.userLabel=e.userLabel}toJSON(){const e=super.toJSON();return n.Id64.isValid(this.code.spec)&&(e.code=this.code),e.model=this.model,e.parent=this.parent,e.federationGuid=this.federationGuid,e.userLabel=this.userLabel,e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(45),i="v_texCoord = (rawPosition.xy + 1.0) * 0.5;",o="return rawPos;";t.createViewportQuadBuilder=function(e){const t=new n.ProgramBuilder(!1);return t.vert.set(3,o),e&&function(e){e.addInlineComputedVarying("v_texCoord",3,i)}(t),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.instanceKeyFromJSON=(e=>Object.assign({},e,{id:n.Id64.fromJSON(e.id)})),t.classInfoFromJSON=(e=>Object.assign({},e,{id:n.Id64.fromJSON(e.id)})),t.propertyInfoFromJSON=(e=>Object.assign({},e,{classInfo:t.classInfoFromJSON(e.classInfo)})),t.relatedClassInfoFromJSON=(e=>Object.assign({},e,{sourceClassInfo:t.classInfoFromJSON(e.sourceClassInfo),targetClassInfo:t.classInfoFromJSON(e.targetClassInfo),relationshipInfo:t.classInfoFromJSON(e.relationshipInfo)}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(70),i=r(56),o=r(29),s=r(0),a="imodeljs-clients.Clients";class DefaultRequestOptionsProvider{constructor(){this._defaultOptions={method:"GET",useCorsProxy:!1}}async assignOptions(e){const t=Object.assign({},e);return n(e,this._defaultOptions),n(e,t),Promise.resolve()}}t.DefaultRequestOptionsProvider=DefaultRequestOptionsProvider;class Client{constructor(){}async setupOptionDefaults(e){return Client._defaultRequestOptionsProvider||(Client._defaultRequestOptionsProvider=new DefaultRequestOptionsProvider),Client._defaultRequestOptionsProvider.assignOptions(e)}async getUrl(e){if(this._url)return Promise.resolve(this._url);const t=new UrlDiscoveryClient,r=this.getUrlSearchKey();return t.discoverUrl(e,r,void 0).then(e=>(this._url=e,Promise.resolve(this._url))).catch(()=>Promise.reject(`Failed to discover URL for service identified by "${r}"`))}async delete(e,t,r){e.enter();const n=await this.getUrl(e)+r;s.Logger.logInfo(a,`Sending DELETE request to ${n}`);const i={method:"DELETE",headers:{authorization:t.toTokenString()}};await this.setupOptionDefaults(i),await o.request(e,n,i),e.enter(),s.Logger.logTrace(a,`Successful DELETE request to ${n}`)}}t.Client=Client;t.AuthenticationError=class AuthenticationError extends o.ResponseError{};class UrlDiscoveryClient extends Client{constructor(){super()}getUrlSearchKey(){return""}async getUrl(){return Promise.resolve(i.Config.App.getString(UrlDiscoveryClient.configURL,"https://buddi.bentley.com/WebService"))}async discoverUrl(e,t,r){e.enter();const n=await this.getUrl()+"/GetUrl/",s={method:"GET",qs:{url:t,region:"undefined"!==typeof r?r:i.Config.App.getNumber(UrlDiscoveryClient.configResolveUrlUsingRegion,0)}};await this.setupOptionDefaults(s),e.enter();const a=(await o.request(e,n,s)).body.result.url.replace(/\/$/,"");return Promise.resolve(a)}}UrlDiscoveryClient.configURL="imjs_buddi_url",UrlDiscoveryClient.configResolveUrlUsingRegion="imjs_buddi_resolve_url_using_region",t.UrlDiscoveryClient=UrlDiscoveryClient},function(e,t,r){"use strict";var n=r(121),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=d;var o=r(98);o.inherits=r(71);var s=r(236),a=r(240);o.inherits(d,s);for(var c=i(a.prototype),l=0;l<c.length;l++){var u=c[l];d.prototype[u]||(d.prototype[u]=a.prototype[u])}function d(e){if(!(this instanceof d))return new d(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(6),o=r(5),s=r(37);class Degree2PowerPolynomial{constructor(e=0,t=0,r=0){this.coffs=[e,t,r]}static solveQuadratic(e,t,r){const n=o.Geometry.conditionalDivideFraction(t,e),i=o.Geometry.conditionalDivideFraction(r,e);if(void 0!==n&&void 0!==i){const e=n*n-4*i;if(e>0){const t=Math.sqrt(e);return[.5*(-n-t),.5*(-n+t)]}if(e<0)return;const t=-.5*n;return[t,t]}const s=o.Geometry.conditionalDivideFraction(-r,t);if(void 0!==s)return[s]}addConstant(e){this.coffs[0]+=e}addSquaredLinearTerm(e,t,r=1){this.coffs[0]+=r*(e*e),this.coffs[1]+=r*(2*e*t),this.coffs[2]+=r*(t*t)}realRoots(){const e=Degree2PowerPolynomial.solveQuadratic(this.coffs[2],this.coffs[1],this.coffs[0]);if(e&&e.length>1&&e[0]>e[1]){const t=e[0];e[0]=e[1],e[1]=t}return e}evaluate(e){return this.coffs[0]+e*(this.coffs[1]+e*this.coffs[2])}evaluateDerivative(e){return this.coffs[1]+2*e*this.coffs[2]}tryGetVertexFactorization(){const e=o.Geometry.conditionalDivideFraction(-this.coffs[1],2*this.coffs[2]);if(void 0!==e){const t=this.evaluate(e);return{c:this.coffs[2],x0:e,y0:t}}}static fromRootsAndC2(e,t,r=1){return new Degree2PowerPolynomial(r*e*t,-r*(e+t),r)}}t.Degree2PowerPolynomial=Degree2PowerPolynomial;class Degree3PowerPolynomial{constructor(e=0,t=0,r=0,n=1){this.coffs=[e,t,r,n]}addConstant(e){this.coffs[0]+=e}addSquaredLinearTerm(e,t,r=1){this.coffs[0]+=r*(e*e),this.coffs[1]+=r*(2*e*t),this.coffs[2]+=r*(t*t)}evaluate(e){return this.coffs[0]+e*(this.coffs[1]+e*(this.coffs[2]+e*this.coffs[3]))}evaluateDerivative(e){return this.coffs[1]+e*(2*this.coffs[2]+3*e*this.coffs[3])}static fromRootsAndC3(e,t,r,n=1){return new Degree3PowerPolynomial(-n*e*t*r,n*(e*t+t*r+e*r),-n*(e+t+r),n)}}t.Degree3PowerPolynomial=Degree3PowerPolynomial;class Degree4PowerPolynomial{constructor(e=0,t=0,r=0,n=0,i=0){this.coffs=[e,t,r,n,i]}addConstant(e){this.coffs[0]+=e}evaluate(e){return this.coffs[0]+e*(this.coffs[1]+e*(this.coffs[2]+e*(this.coffs[3]+e*this.coffs[4])))}evaluateDerivative(e){return this.coffs[1]+e*(2*this.coffs[2]+e*(3*this.coffs[3]+4*e*this.coffs[4]))}static fromRootsAndC4(e,t,r,n,i=1){return new Degree4PowerPolynomial(i*(e*t*r*n),-i*(e*t*r+e*t*n+e*r*n+t*r*n),i*(e*t+e*r+e*n+t*r+t*n+r*n),-i*(e+t+r+n),i)}}t.Degree4PowerPolynomial=Degree4PowerPolynomial;t.TorusImplicit=class TorusImplicit{constructor(e,t){this.majorRadius=e,this.minorRadius=t}boxSize(){return Math.abs(this.majorRadius)+Math.abs(this.minorRadius)}implicitFunctionScale(){const e=this.boxSize();return 0===e?1:1/(e*e*e*e)}evaluateImplicitFunctionXYZ(e,t,r){const n=e*e+t*t,i=r*r,o=this.majorRadius*this.majorRadius,s=n+i+(o-this.minorRadius*this.minorRadius);return(s*s-4*o*n)*this.implicitFunctionScale()}evaluateImplicitFunctionPoint(e){return this.evaluateImplicitFunctionXYZ(e.x,e.y,e.z)}evaluateImplicitFunctionXYZW(e,t,r,n){const i=e*e+t*t,o=r*r,s=n*n,a=this.majorRadius*this.majorRadius,c=i+o+s*(a-this.minorRadius*this.minorRadius);return(c*c-4*s*a*i)*this.implicitFunctionScale()}evaluateThetaPhi(e,t){const r=Math.cos(e),n=Math.sin(e),o=this.majorRadius+this.minorRadius*Math.cos(t),s=this.minorRadius*Math.sin(t);return i.Point3d.create(r*o,n*o,s)}evaluateDerivativesThetaPhi(e,t,r,n){const o=Math.cos(e),s=Math.sin(e),a=this.minorRadius*Math.cos(t),c=this.minorRadius*Math.sin(t),l=this.majorRadius+a;i.Vector3d.create(-l*s,l*o,0,r),i.Vector3d.create(-o*c,-s*c,a,n)}evaluateThetaPhiDistance(e,t,r){const n=Math.cos(e),o=Math.sin(e),s=this.majorRadius+r*Math.cos(t),a=r*Math.sin(t);return i.Point3d.create(n*s,o*s,a)}XYZToThetaPhiDistance(e){const t=e.magnitudeXY(),r=o.Geometry.conditionalDivideFraction(this.majorRadius,t);let n,s;r?(n=!0,s=i.Point3d.create(r*e.x,r*e.y,0)):(n=!1,s=i.Point3d.create(e.x,e.y,0));const a=n?Math.atan2(e.y,e.x):0,c=i.Vector3d.createStartEnd(s,e).magnitude(),l=t-this.majorRadius;let u,d;return 0===e.z&&0===l?(d=0,u=!1):(d=Math.atan2(e.z,l),u=!0),{theta:a,phi:d,distance:c,rho:t,safePhi:n&&u}}};t.SphereImplicit=class SphereImplicit{constructor(e){this.radius=e}evaluateImplicitFunction(e,t,r){return e*e+t*t+r*r-this.radius*this.radius}evaluateImplicitFunctionXYZW(e,t,r,n){return 0===n?0:e*e+t*t+r*r-this.radius*this.radius*n*n}XYZToThetaPhiR(e){const t=e.x*e.x+e.y*e.y,r=Math.sqrt(t),n=Math.sqrt(t+e.z*e.z);let i,o,s;return 0===n?(i=o=0,s=!1):(o=Math.atan2(e.z,r),0!==t?(i=Math.atan2(e.y,e.x),s=!0):(i=0,s=!1)),{theta:i,phi:o,r:n,valid:s}}evaluateThetaPhi(e,t){const r=this.radius*Math.cos(e),n=this.radius*Math.sin(e),o=Math.cos(t),s=Math.sin(t);return i.Point3d.create(r*o,n*o,this.radius*s)}evaluateDerivativesThetaPhi(e,t,r,n){const o=this.radius*Math.cos(e),s=this.radius*Math.sin(e),a=Math.cos(t),c=Math.sin(t);i.Vector3d.create(-s*a,o*a,0,r),i.Vector3d.create(-o*c,-s*c,this.radius*a,n)}};class AnalyticRoots{static IsZero(e){return Math.abs(e)<this.EQN_EPS}static isSmallRatio(e,t,r=1e-9,n=8e-16){return Math.abs(e)<=r||Math.abs(e)<n*Math.abs(t)}static cbrt(e){return e>0?Math.pow(e,1/3):e<0?-Math.pow(-e,1/3):0}static SafeDivide(e,t,r,n=0,i){return Math.abs(r)>this.s_safeDivideFactor*Math.abs(t)?(e[i]=t/r,!0):(e[i]=n,!1)}static checkRootProximity(e,t){return 0===t?e.at(t)<e.at(t+1):t>0&&t+1<e.length?e.at(t)>e.at(t-1)&&e.at(t)<e.at(t+1):e.at(t)>e.at(t-1)}static NewtonMethodAdjustment(e,t,r){if(3===r){return(e[0]+t*(e[1]+t*(e[2]+t*e[3])))/(e[1]+t*(2*e[2]+3*t*e[3]))}if(4===r){return(e[0]+t*(e[1]+t*(e[2]+t*(e[3]+t*e[4]))))/(e[1]+t*(2*e[2]+t*(3*e[3]+4*t*e[4])))}return 0}static improveSortedRoots(e,t,r){for(let n=0;n<r.length;n++){let i=this.NewtonMethodAdjustment(e,r.at(n),t);if(!i)continue;const o=r.at(n);let s=0,a=0;for(;0!==i&&s<10;){if(Math.abs(i)<1e-10*(1+Math.abs(r.at(n)))){if(++a>1)break}else a=0;const c=r.at(n)-i;if(r.reassign(n,c),!this.checkRootProximity(r,n)){r.reassign(n,o);break}i=this.NewtonMethodAdjustment(e,r.at(n),t),s++}}}static appendSolution(e,t){void 0!==e&&t.push(e)}static append2Solutions(e,t,r){r.push(e),r.push(t)}static appendLinearRoot(e,t,r){AnalyticRoots.appendSolution(o.Geometry.conditionalDivideFraction(-e,t),r)}static mostDistantFromMean(e){if(!e||0===e.length)return 0;let t=0;for(let i=0;i<e.length;i++)t+=e.at(i);t/=e.length;let r=0,n=e.at(0);for(let i=0;i<e.length;i++){const o=Math.abs(e.at(i)-t);o<r&&(r=o,n=e.at(i))}return n}static appendQuadraticRoots(e,t){const r=o.Geometry.conditionalDivideFraction(1,e[2]);if(!r)return void this.appendLinearRoot(e[0],e[1],t);const n=.5*e[1]*r,i=n*n-e[0]*r;if(this.IsZero(i))this.appendSolution(-n,t);else if(!(i<0))if(i>0){const e=Math.sqrt(i);this.append2Solutions(e-n,-e-n,t)}else;}static addConstant(e,t){for(let r=0;r<t.length;r++)t.reassign(r,t.at(r)+e)}static appendCubicRootsUnsorted(e,t){let r,n,i,s,a,c,l,u;const d=o.Geometry.conditionalDivideFraction(1,e[3]);if(!d)return void this.appendQuadraticRoots(e,t);r=e[2]*d,n=e[1]*d,i=e[0]*d;const h=r/-3;if((u=(c=.5*(2/27*r*(s=r*r)-1/3*r*n+i))*c+(l=(a=(3*n-s)/9)*a*a))>=0&&this.IsZero(u)){if(this.IsZero(c))return t.push(h),t.push(h),void t.push(h);{const e=this.cbrt(-c);return e<0?(t.push(h+2*e),t.push(h-e),void t.push(h-e)):(t.push(h-e),t.push(h-e),void t.push(h+2*e))}}if(u<=0){const e=1/3*Math.acos(-c/Math.sqrt(-l)),r=2*Math.sqrt(-a);return t.push(h+r*Math.cos(e)),t.push(h-r*Math.cos(e+Math.PI/3)),void t.push(h-r*Math.cos(e-Math.PI/3))}{const e=Math.sqrt(u),r=this.cbrt(e-c),n=-this.cbrt(e+c);return void t.push(h+r+n)}}static appendCubicRoots(e,t){this.appendCubicRootsUnsorted(e,t),t.sort()}static appendQuarticRoots(e,t){const r=new Float64Array(4);let n,i,o,a,c,l,u,d,h,p;const f=new Float64Array(1);if(!this.SafeDivide(f,1,e[4],0,0))return void this.appendCubicRoots(e,t);o=e[3]*f[0],a=e[2]*f[0],c=e[1]*f[0],l=e[0]*f[0];const g=-.25*o;d=-3/8*(u=o*o)+a,h=.125*u*o-.5*o*a+c,p=-3/256*u*u+1/16*u*a-.25*o*c+l;const m=new s.GrowableFloat64Array;if(this.IsZero(p))return r[0]=h,r[1]=d,r[2]=0,r[3]=1,this.appendCubicRootsUnsorted(r,t),t.push(0),void this.addConstant(g,t);{r[0]=.5*p*d-1/8*h*h,r[1]=-p,r[2]=-.5*d,r[3]=1,this.appendCubicRootsUnsorted(r,m);const e=this.mostDistantFromMean(m);if(n=e*e-p,i=2*e-d,this.isSmallRatio(n,p))n=0;else{if(!(n>0))return;n=Math.sqrt(n)}if(this.isSmallRatio(i,d))i=0;else{if(!(i>0)){for(let e=0;e<m.length;e++)t.push(m.at(e));return}i=Math.sqrt(i)}r[0]=e-n,r[1]=h<0?-i:i,r[2]=1,this.appendQuadraticRoots(r,t),r[0]=e+n,r[1]=h<0?i:-i,r[2]=1,this.appendQuadraticRoots(r,t)}this.addConstant(g,t),t.sort(),this.improveSortedRoots(e,4,t)}static appendCosSinRadians(e,t,r,n,i){r&&r.push(e),n&&n.push(t),i&&i.push(Math.atan2(t,e))}static appendImplicitLineUnitCircleIntersections(e,t,r,n,i,o,s=1e-14){let a;const c=t*t+r*r;let l=0;if(a=s<0?0:2*s,c<=0)l=0===e?-2:-1;else{const s=-e/c,u=1-e*e/c;if(u<-a){const a=Math.sqrt(c),u=e<0?1/a:-1/a;this.appendCosSinRadians(s*t,s*r,n,i,o),this.appendCosSinRadians(t*u,r*u,n,i,o),l=0}else if(u<a){const a=Math.sqrt(c),u=e<0?1/a:-1/a;this.appendCosSinRadians(s*t,s*r,n,i,o),this.appendCosSinRadians(t*u,r*u,n,i,o),l=1}else{const e=Math.sqrt(u/c),a=s*t,d=s*r;this.appendCosSinRadians(a-e*r,d+e*t,n,i,o),this.appendCosSinRadians(a+e*r,d-e*t,n,i,o),l=2}}return l}}AnalyticRoots.EQN_EPS=1e-9,AnalyticRoots.s_safeDivideFactor=1e-14,AnalyticRoots.s_quadricRelTol=1e-14,AnalyticRoots.sTestWindow=1e-6,t.AnalyticRoots=AnalyticRoots;class PowerPolynomial{static degreeKnownEvaluate(e,t,r){if(t<0)return 0;let n=e[t];for(let i=t-1;i>=0;i--)n=r*n+e[i];return n}static Evaluate(e,t){const r=e.length-1;return this.degreeKnownEvaluate(e,r,t)}static Accumulate(e,t,r){let n=e.length-1;const i=t.length-1;for(let o=0;o<=i;o++)e[o]+=r*t[o];for(;n>=0&&0===e[n];)n--;return n}static Zero(e){for(let t=0;t<e.length;t++)e[t]=0}}t.PowerPolynomial=PowerPolynomial;class TrigPolynomial{static SolveAngles(e,t,r,n){let i,o=Math.abs(r);n.length=0;const a=this.SmallAngle;for(let s=0;s<=t;s++)(i=Math.abs(e[s]))>o&&(o=i);const c=a*o;let l=t;for(;l>0&&Math.abs(e[l-1])<=c;)l--;const u=new s.GrowableFloat64Array;if(-1===l);else if(0===l||(1===l?u.push(-e[0]/e[1]):2===l?AnalyticRoots.appendQuadraticRoots(e,u):3===l?AnalyticRoots.appendCubicRoots(e,u):4===l&&AnalyticRoots.appendQuarticRoots(e,u)),u.length>0){for(let e=0;e<u.length;e++){const t=PowerPolynomial.Evaluate(this.S,u.at(e)),r=PowerPolynomial.Evaluate(this.C,u.at(e));n.push(Math.atan2(t,r))}l<t&&n.push(-.5*Math.PI)}return n.length>0}static SolveUnitCircleImplicitQuadricIntersection(e,t,r,n,i,o,s){const a=new Float64Array(5);PowerPolynomial.Zero(a);let c=2;Math.hypot(e,t,r)>TrigPolynomial.coeffientRelTol*Math.hypot(n,i,o)?(PowerPolynomial.Accumulate(a,this.CW,n),PowerPolynomial.Accumulate(a,this.SW,i),PowerPolynomial.Accumulate(a,this.WW,o),PowerPolynomial.Accumulate(a,this.SS,r),PowerPolynomial.Accumulate(a,this.CC,e),PowerPolynomial.Accumulate(a,this.SC,t),c=4):(PowerPolynomial.Accumulate(a,this.C,n),PowerPolynomial.Accumulate(a,this.S,i),PowerPolynomial.Accumulate(a,this.W,o),c=2);let l=0;return l=Math.max(l,Math.abs(e),Math.abs(r),Math.abs(t),Math.abs(n),Math.abs(i),Math.abs(o)),this.SolveAngles(a,c,l,s)}static SolveUnitCircleEllipseIntersection(e,t,r,n,i,o,s,a){a.length=0;const c=r*r+n*n,l=2*(r*i+n*o),u=i*i+o*o,d=2*(r*e+n*t),h=2*(i*e+o*t),p=e*e+t*t-1,f=this.SolveUnitCircleImplicitQuadricIntersection(c,l,u,d,h,p,s);for(const g of s){const s=Math.cos(g),c=Math.sin(g),l=e+r*s+i*c,u=t+n*s+o*c;a.push(Math.atan2(u,l))}return f}static SolveUnitCircleHomogeneousEllipseIntersection(e,t,r,n,i,o,s,a,c,l,u){u.length=0;const d=n*n+i*i-o*o,h=2*(n*s+i*a-o*c),p=s*s+a*a-c*c,f=2*(n*e+i*t-o*r),g=2*(s*e+a*t-c*r),m=e*e+t*t-r*r,y=this.SolveUnitCircleImplicitQuadricIntersection(d,h,p,f,g,m,l);for(const v of l){const r=Math.cos(v),o=Math.sin(v),c=e+n*r+s*o,l=t+i*r+a*o;u.push(Math.atan2(l,c))}return y}}TrigPolynomial.SmallAngle=1e-11,TrigPolynomial.S=Float64Array.from([0,2,-2]),TrigPolynomial.C=Float64Array.from([1,-2]),TrigPolynomial.W=Float64Array.from([1,-2,2]),TrigPolynomial.CW=Float64Array.from([1,-4,6,-4]),TrigPolynomial.SW=Float64Array.from([0,2,-6,8,-4]),TrigPolynomial.SC=Float64Array.from([0,2,-6,4]),TrigPolynomial.SS=Float64Array.from([0,0,4,-8,4]),TrigPolynomial.CC=Float64Array.from([1,-4,4]),TrigPolynomial.WW=Float64Array.from([1,-4,8,-8,4]),TrigPolynomial.CCminusSS=Float64Array.from([1,-4,0,8,-4]),TrigPolynomial.coeffientRelTol=1e-12,t.TrigPolynomial=TrigPolynomial;class SmallSystem{static lineSegment2dXYTransverseIntersectionUnbounded(e,t,r,n,i){const s=t.x-e.x,a=t.y-e.y,c=n.x-r.x,l=n.y-r.y,u=r.x-e.x,d=r.y-e.y,h=o.Geometry.crossProductXYXY(s,a,c,l),p=o.Geometry.crossProductXYXY(u,d,c,l),f=o.Geometry.crossProductXYXY(s,a,u,d),g=o.Geometry.conditionalDivideFraction(p,h),m=o.Geometry.conditionalDivideFraction(f,h);return void 0!==g&&void 0!==m?(i.set(g,-m),!0):(i.set(0,0),!1)}static lineSegment3dXYTransverseIntersectionUnbounded(e,t,r,n,i){const s=t.x-e.x,a=t.y-e.y,c=n.x-r.x,l=n.y-r.y,u=r.x-e.x,d=r.y-e.y,h=o.Geometry.crossProductXYXY(s,a,c,l),p=o.Geometry.crossProductXYXY(u,d,c,l),f=o.Geometry.crossProductXYXY(s,a,u,d),g=o.Geometry.conditionalDivideFraction(p,h),m=o.Geometry.conditionalDivideFraction(f,h);return void 0!==g&&void 0!==m?(i.set(g,-m),!0):(i.set(0,0),!1)}static lineSegment3dHXYTransverseIntersectionUnbounded(e,t,r,i,s){const a=o.Geometry.tripleProduct(e.x,t.x,r.x,e.y,t.y,r.y,e.w,t.w,r.w),c=o.Geometry.tripleProduct(e.x,t.x,i.x,e.y,t.y,i.y,e.w,t.w,i.w),l=o.Geometry.conditionalDivideFraction(-a,c-a);if(void 0!==l){const a=o.Geometry.tripleProduct(r.x,i.x,e.x,r.y,i.y,e.y,r.w,i.w,e.w),c=o.Geometry.tripleProduct(r.x,i.x,t.x,r.y,i.y,t.y,r.w,i.w,t.w),u=o.Geometry.conditionalDivideFraction(-a,c-a);if(void 0!==u)return n.Vector2d.create(u,l,s)}}static lineSegment3dHXYClosestPointUnbounded(e,t,r){const n=t.x*e.w-e.x*t.w,i=t.y*e.w-e.y*t.w,s=o.Geometry.tripleProduct(e.x,-i,r.x,e.y,n,r.y,e.w,0,r.w),a=o.Geometry.tripleProduct(t.x,-i,r.x,t.y,n,r.y,t.w,0,r.w);return o.Geometry.conditionalDivideFraction(-s,a-s)}static lineSegment3dXYClosestPointUnbounded(e,t,r){const n=t.x-e.x,i=t.y-e.y,s=n*n+i*i,a=n*(r.x-e.x)+i*(r.y-e.y);return o.Geometry.conditionalDivideFraction(a,s)}static lineSegment3dClosestApproachUnbounded(e,t,r,n,i){const s=t.x-e.x,a=t.y-e.y,c=t.z-e.z,l=n.x-r.x,u=n.y-r.y,d=n.z-r.z,h=r.x-e.x,p=r.y-e.y,f=r.z-e.z,g=o.Geometry.dotProductXYZXYZ(s,a,c,s,a,c),m=o.Geometry.dotProductXYZXYZ(l,u,d,l,u,d),y=o.Geometry.dotProductXYZXYZ(s,a,c,l,u,d),v=o.Geometry.dotProductXYZXYZ(h,p,f,s,a,c),_=o.Geometry.dotProductXYZXYZ(h,p,f,l,u,d);return SmallSystem.linearSystem2d(g,-y,y,-m,v,_,i)}static linearSystem2d(e,t,r,n,i,s,a){const c=o.Geometry.crossProductXYXY(e,r,t,n),l=o.Geometry.crossProductXYXY(i,s,t,n),u=o.Geometry.crossProductXYXY(e,r,i,s),d=o.Geometry.conditionalDivideFraction(l,c),h=o.Geometry.conditionalDivideFraction(u,c);return void 0!==d&&void 0!==h?(a.set(d,h),!0):(a.set(0,0),!1)}static linearSystem3d(e,t,r,n,s,a,c,l,u,d,h,p,f){const g=o.Geometry.tripleProduct(e,n,c,t,s,l,r,a,u),m=o.Geometry.tripleProduct(d,h,p,t,s,l,r,a,u),y=o.Geometry.tripleProduct(e,n,c,d,h,p,r,a,u),v=o.Geometry.tripleProduct(d,h,p,t,s,l,d,h,p),_=o.Geometry.conditionalDivideFraction(m,g),w=o.Geometry.conditionalDivideFraction(y,g),S=o.Geometry.conditionalDivideFraction(v,g);if(void 0!==_&&void 0!==w&&void 0!==w)return i.Vector3d.create(_,w,S,f)}}t.SmallSystem=SmallSystem},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(16),i=r(5);class AngleSweep{get startDegrees(){return n.Angle.radiansToDegrees(this._radians0)}get endDegrees(){return n.Angle.radiansToDegrees(this._radians1)}get sweepDegrees(){return n.Angle.radiansToDegrees(this._radians1-this._radians0)}get startRadians(){return this._radians0}get endRadians(){return this._radians1}get sweepRadians(){return this._radians1-this._radians0}get startAngle(){return n.Angle.createRadians(this._radians0)}get endAngle(){return n.Angle.createRadians(this._radians1)}constructor(e=0,t=0){this._radians0=e,this._radians1=t}static createStartEndRadians(e=0,t=2*Math.PI,r){return(r=r||new AngleSweep).setStartEndRadians(e,t),r}cloneMinusRadians(e){return new AngleSweep(this._radians0-e,this._radians1-e)}static createStartEndDegrees(e=0,t=360,r){return AngleSweep.createStartEndRadians(n.Angle.degreesToRadians(e),n.Angle.degreesToRadians(t),r)}static createStartEnd(e,t,r){return(r=r||new AngleSweep).setStartEndRadians(e.radians,t.radians),r}static createStartSweep(e,t,r){return AngleSweep.createStartSweepRadians(e.radians,t.radians,r)}interpolate(e,t){return new AngleSweep(i.Geometry.interpolate(this._radians0,e,t._radians0),i.Geometry.interpolate(this._radians1,e,t._radians1))}static createStartSweepRadians(e=0,t=Math.PI,r){return(r=r||new AngleSweep).setStartEndRadians(e,e+t),r}static createStartSweepDegrees(e=0,t=360,r){return AngleSweep.createStartEndRadians(n.Angle.degreesToRadians(e),n.Angle.degreesToRadians(e+t),r)}setStartEndRadians(e=0,t=2*Math.PI){const r=t-e;n.Angle.isFullCircleRadians(r)&&(t=e+(r>0?2:-2)*Math.PI),this._radians0=e,this._radians1=t}setStartEndDegrees(e=0,t=360){this.setStartEndRadians(n.Angle.degreesToRadians(e),n.Angle.degreesToRadians(t))}setFrom(e){this._radians0=e._radians0,this._radians1=e._radians1}static create360(e){return new AngleSweep(e=e||0,e+2*Math.PI)}static createFullLatitude(){return AngleSweep.createStartEndRadians(-.5*Math.PI,.5*Math.PI)}reverseInPlace(){const e=this._radians0;this._radians0=this._radians1,this._radians1=e}capLatitudeInPlace(){const e=.5*Math.PI;this._radians0=i.Geometry.clampToStartEnd(this._radians0,-e,e),this._radians1=i.Geometry.clampToStartEnd(this._radians1,-e,e)}get isCCW(){return this._radians1>=this._radians0}get isFullCircle(){return n.Angle.isFullCircleRadians(this.sweepRadians)}get isFullLatitudeSweep(){const e=.5*Math.PI;return n.Angle.isAlmostEqualRadiansNoPeriodShift(this._radians0,-e)&&n.Angle.isAlmostEqualRadiansNoPeriodShift(this._radians1,e)}clone(){return new AngleSweep(this._radians0,this._radians1)}fractionToRadians(e){return e<.5?this._radians0+e*(this._radians1-this._radians0):this._radians1+(e-1)*(this._radians1-this._radians0)}fractionToAngle(e){return n.Angle.createRadians(this.fractionToRadians(e))}fractionPeriod(){return i.Geometry.safeDivideFraction(2*Math.PI,Math.abs(this._radians1-this._radians0),1)}angleToUnboundedFraction(e){return i.Geometry.safeDivideFraction(e.radians-this._radians0,this._radians1-this._radians0,1)}angleToPositivePeriodicFraction(e){return this.radiansToPositivePeriodicFraction(e.radians)}radiansArraytoPositivePeriodicFractions(e){const t=e.length;for(let r=0;r<t;r++)e.reassign(r,this.radiansToPositivePeriodicFraction(e.at(r)))}radiansToPositivePeriodicFraction(e){if(n.Angle.isAlmostEqualRadiansAllowPeriodShift(e,this._radians0))return 0;if(n.Angle.isAlmostEqualRadiansAllowPeriodShift(e,this._radians1))return 1;const t=this._radians1-this._radians0,r=e-this._radians0;if(t>0){const e=n.Angle.adjustRadians0To2Pi(r);return i.Geometry.safeDivideFraction(e,t,0)}const o=n.Angle.adjustRadians0To2Pi(-r);return i.Geometry.safeDivideFraction(o,-t,0)}angleToSignedPeriodicFraction(e){return this.radiansToSignedPeriodicFraction(e.radians)}radiansToSignedPeriodicFraction(e){if(n.Angle.isAlmostEqualRadiansAllowPeriodShift(e,this._radians0))return 0;if(n.Angle.isAlmostEqualRadiansAllowPeriodShift(e,this._radians1))return 1;const t=this._radians1-this._radians0,r=e-this._radians0-.5*t;if(t>0){const e=n.Angle.adjustRadiansMinusPiPlusPi(r);return.5+i.Geometry.safeDivideFraction(e,t,0)}const o=n.Angle.adjustRadiansMinusPiPlusPi(-r);return.5+i.Geometry.safeDivideFraction(o,-t,0)}isAngleInSweep(e){return this.isRadiansInSweep(e.radians)}isRadiansInSweep(e){return(e-this._radians0)*(e-this._radians1)<=0||this.radiansToPositivePeriodicFraction(e)<=1}setFromJSON(e){e?e instanceof AngleSweep?this.setFrom(e):i.Geometry.isNumberArray(e.degrees,2)?this.setStartEndDegrees(e.degrees[0],e.degrees[1]):i.Geometry.isNumberArray(e.radians,2)?this.setStartEndRadians(e.radians[0],e.radians[1]):i.Geometry.isNumberArray(e,2)&&this.setStartEndDegrees(e[0],e[1]):this.setStartEndRadians()}static fromJSON(e){const t=AngleSweep.create360();return t.setFromJSON(e),t}toJSON(){return[this.startDegrees,this.endDegrees]}isAlmostEqualAllowPeriodShift(e){return n.Angle.isAlmostEqualRadiansAllowPeriodShift(this._radians0,e._radians0)&&n.Angle.isAlmostEqualRadiansNoPeriodShift(this._radians1-this._radians0,e._radians1-e._radians0)}isAlmostEqualNoPeriodShift(e){return n.Angle.isAlmostEqualRadiansNoPeriodShift(this._radians0,e._radians0)&&n.Angle.isAlmostEqualRadiansNoPeriodShift(this._radians1-this._radians0,e._radians1-e._radians0)}isAlmostEqual(e){return this.isAlmostEqualNoPeriodShift(e)}}t.AngleSweep=AngleSweep},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(172),o=r(74),s=r(25);!function(e){e.forUnknownError=function(e,t){const r=o.RpcMarshaling.serialize(e.operation.interfaceDefinition,void 0,t);return{interfaceName:e.operation.interfaceDefinition,id:e.id,result:r,rawResult:t,status:s.RpcRequestStatus.Rejected}}}(t.RpcRequestFulfillment||(t.RpcRequestFulfillment={}));class RpcProtocol{constructor(e){this.events=new n.BeEvent,this.invocationType=i.RpcInvocation,this.requestIdHeaderName="X-RequestId",this.configuration=e,this.events.addListener((e,t)=>RpcProtocol.events.raiseEvent(e,t))}get authorizationHeaderName(){return this.configuration.applicationAuthorizationKey}getStatus(e){return e}getCode(e){return e}supplyPathForOperation(e,t){return JSON.stringify(e)}getOperationFromPath(e){return JSON.parse(e)}fulfill(e){return new this.invocationType(this,e).fulfillment}serialize(e){return{id:e.id,authorization:this.configuration.applicationAuthorizationValue||"",operation:{interfaceDefinition:e.operation.interfaceDefinition.name,operationName:e.operation.operationName,interfaceVersion:e.operation.interfaceVersion},method:e.method,path:e.path,parameters:o.RpcMarshaling.serialize(e.operation,e.protocol,e.parameters),caching:s.RpcResponseCacheControl.None}}onRpcClientInitialized(e,t){}onRpcImplInitialized(e,t){}onRpcClientTerminated(e,t){}onRpcImplTerminated(e,t){}}RpcProtocol.events=new n.BeEvent,t.RpcProtocol=RpcProtocol},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(132),o=r(8),s=r(0);!function(e){e[e.Nearest=1]="Nearest",e[e.NearestKeypoint=2]="NearestKeypoint",e[e.MidPoint=4]="MidPoint",e[e.Center=8]="Center",e[e.Origin=16]="Origin",e[e.Bisector=32]="Bisector",e[e.Intersection=64]="Intersection"}(t.SnapMode||(t.SnapMode={})),function(e){e[e.None=0]="None",e[e.NotInRange=1]="NotInRange",e[e.InRange=2]="InRange"}(t.SnapHeat||(t.SnapHeat={})),function(e){e[e.None=0]="None",e[e.FromUser=1]="FromUser",e[e.MotionLocate=2]="MotionLocate",e[e.AccuSnap=3]="AccuSnap",e[e.TentativeSnap=4]="TentativeSnap",e[e.DataPoint=5]="DataPoint",e[e.Application=6]="Application",e[e.EditAction=7]="EditAction",e[e.EditActionSS=8]="EditActionSS"}(t.HitSource||(t.HitSource={})),function(e){e[e.None=0]="None",e[e.Point=1]="Point",e[e.Segment=2]="Segment",e[e.Curve=3]="Curve",e[e.Arc=4]="Arc",e[e.Surface=5]="Surface"}(t.HitGeomType||(t.HitGeomType={})),function(e){e[e.None=0]="None",e[e.Wire=1]="Wire",e[e.Sheet=2]="Sheet",e[e.Solid=3]="Solid",e[e.Mesh=4]="Mesh",e[e.Text=5]="Text"}(t.HitParentGeomType||(t.HitParentGeomType={})),function(e){e[e.WireEdge=0]="WireEdge",e[e.PlanarEdge=1]="PlanarEdge",e[e.NonPlanarEdge=2]="NonPlanarEdge",e[e.SilhouetteEdge=3]="SilhouetteEdge",e[e.PlanarSurface=4]="PlanarSurface",e[e.NonPlanarSurface=5]="NonPlanarSurface",e[e.Unknown=6]="Unknown"}(t.HitPriority||(t.HitPriority={})),function(e){e[e.Hit=1]="Hit",e[e.Snap=2]="Snap",e[e.Intersection=3]="Intersection"}(t.HitDetailType||(t.HitDetailType={}));class HitDetail{constructor(e,t,r,n,i,o,s,a){this.testPoint=e,this.viewport=t,this.hitSource=r,this.hitPoint=n,this.sourceId=i,this.priority=o,this.distXY=s,this.distFraction=a}getHitType(){return 1}getPoint(){return this.hitPoint}isSameHit(e){return void 0!==e&&this.sourceId===e.sourceId}get isElementHit(){return!s.Id64.isInvalid(this.sourceId)&&!s.Id64.isTransient(this.sourceId)}get isModelHit(){return void 0!==this.viewport.iModel.models.getLoaded(this.sourceId)}clone(){return new HitDetail(this.testPoint,this.viewport,this.hitSource,this.hitPoint,this.sourceId,this.priority,this.distXY,this.distFraction)}draw(e){this.viewport.setFlashed(this.sourceId,.25)}async getToolTip(){if(!this.isElementHit)return o.IModelApp.viewManager.getDecorationToolTip(this);let e="";return(await this.viewport.iModel.getToolTipMessage(this.sourceId)).forEach(t=>e+=o.IModelApp.i18n.translateKeys(t)+"<br>"),e}}t.HitDetail=HitDetail;class SnapDetail extends HitDetail{constructor(e,t=1,r=0,o){super(e.testPoint,e.viewport,e.hitSource,e.hitPoint,e.sourceId,e.priority,e.distXY,e.distFraction),this.snapMode=t,this.heat=r,this.snapPoint=n.Point3d.fromJSON(o||e.hitPoint),this.adjustedPoint=this.snapPoint.clone(),this.sprite=i.IconSprites.getSpriteFromUrl(SnapDetail.getSnapSpriteUrl(t))}getHitType(){return 2}getPoint(){return this.isHot?this.snapPoint:super.getPoint()}get isHot(){return 0!==this.heat}get isPointAdjusted(){return!this.adjustedPoint.isExactEqual(this.snapPoint)}setSnapPoint(e,t){this.snapPoint.setFrom(e),this.adjustedPoint.setFrom(e),this.heat=t}setCurvePrimitive(e,t,r){this.primitive=e,this.geomType=void 0,void 0!==this.primitive?(void 0!==t&&this.primitive.tryTransformInPlace(t),this.primitive instanceof n.Arc3d?this.geomType=4:this.primitive instanceof n.LineSegment3d?this.geomType=2:this.primitive instanceof n.LineString3d?this.geomType=2:this.geomType=3,void 0!==r&&0!==r&&(this.geomType=r)):1!==r&&5!==r||(this.geomType=r)}clone(){const e=new SnapDetail(this,this.snapMode,this.heat,this.snapPoint);return e.sprite=this.sprite,e.geomType=this.geomType,e.parentGeomType=this.parentGeomType,e.adjustedPoint.setFrom(this.adjustedPoint),void 0!==this.primitive&&(e.primitive=this.primitive.clone()),void 0!==this.normal&&(e.normal=this.normal.clone()),e}getCurvePrimitive(e=!0){if(!e||void 0===this.primitive)return this.primitive;if(this.primitive instanceof n.LineString3d){const e=this.primitive;if(e.points.length>2){const t=e.closestPoint(this.snapPoint,!1),r=e.points.length-1,i=1/r;let o=Math.floor(t.fraction/i);return o>=r&&(o=r-1),n.LineSegment3d.create(e.points[o],e.points[o+1])}}return this.primitive}draw(e){if(void 0!==this.primitive){let t=!1;switch(this.snapMode){case 8:case 16:case 32:break;default:t=!0}const r=e.createGraphicBuilder(3),i=e.viewport.hilite.color.adjustForContrast(e.viewport.view.backgroundColor,50),o=e.viewport.hilite.color.adjustForContrast(i,175),s=n.Path.create(this.getCurvePrimitive(t));return r.setSymbology(i,i,6),r.addPath(s),r.setSymbology(o,o,2),r.addPath(s),void e.addDecorationFromBuilder(r)}super.draw(e)}static getSnapSpriteUrl(e){switch(e){case 1:return"SnapPointOn.png";case 2:return"SnapKeypoint.png";case 4:return"SnapMidpoint.png";case 8:return"SnapCenter.png";case 16:return"SnapOrigin.png";case 32:return"SnapBisector.png";case 64:return"SnapIntersection.png"}return""}}t.SnapDetail=SnapDetail;t.IntersectDetail=class IntersectDetail extends SnapDetail{constructor(e,t=0,r,n,i){super(e,64,t,r),this.otherPrimitive=n,this.otherId=i,this.primitive=e.primitive,this.normal=e.normal}draw(e){if(void 0!==this.primitive&&void 0!==this.otherPrimitive){const t=e.createGraphicBuilder(3),r=e.viewport.hilite.color.adjustForContrast(e.viewport.view.backgroundColor,50),i=e.viewport.hilite.color.adjustForContrast(r,175),o=n.Path.create(this.primitive),s=n.Path.create(this.otherPrimitive);return t.setSymbology(r,r,6),t.addPath(o),t.addPath(s),t.setSymbology(i,i,2),t.addPath(o),t.setSymbology(i,i,2,4177066232),t.addPath(s),void e.addDecorationFromBuilder(t)}super.draw(e)}};t.HitList=class HitList{constructor(){this.hits=[],this.currHit=-1}get length(){return this.hits.length}empty(){this.hits.length=0,this.currHit=-1}resetCurrentHit(){this.currHit=-1}getHit(e){return e<0&&(e=this.length-1),e>=this.length?void 0:this.hits[e]}setHit(e,t){e<0||e>=this.length||(this.hits[e]=t)}dropNulls(){const e=this.hits;this.hits=[];for(const t of e)this.hits.push(t)}getNextHit(){return this.currHit++,this.getCurrentHit()}getCurrentHit(){return-1===this.currHit?void 0:this.getHit(this.currHit)}setCurrentHit(e){this.resetCurrentHit();for(let t;void 0!==(t=this.getNextHit());)if(t===e)return}removeCurrentHit(){this.removeHit(this.currHit)}removeHit(e){e<0&&(e=this.length-1),e<=this.currHit&&(this.currHit=-1),e>=this.length||this.hits.splice(e,1)}removeHitsFrom(e){let t=!1;for(let r=this.length-1;r>=0;r--){const n=this.hits[r];n&&e===n.sourceId&&(t=!0,this.removeHit(r))}return t}getPriorityZOverride(e){switch(e){case 0:case 1:case 2:return 0;case 3:return 1;case 4:case 5:return 2;default:return 3}}compare(e,t){if(!e||!t)return 0;const r=this.getPriorityZOverride(e.priority),n=this.getPriorityZOverride(t.priority);return r<n?-1:r>n?1:e.distXY<t.distXY?-1:e.distXY>t.distXY?1:e.distFraction>t.distFraction?-1:e.distFraction<t.distFraction?1:e.priority<t.priority?-1:e.priority>t.priority?1:0}addHit(e){if(0===this.hits.length)return this.hits.push(e),0;let t=0;for(;t<this.hits.length;++t){const r=this.hits[t];if(this.compare(e,r)<0)break}return this.hits.splice(t,0,e),t}insertHit(e,t){e<0||e>=this.length?this.hits.push(t):this.hits.splice(e,0,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);!function(e){e.vertex=.1,e.facetArea=.1}(t.ToleranceRatio||(t.ToleranceRatio={})),function(e){e[e.Never=0]="Never",e[e.Always=1]="Always",e[e.CurvedSurfacesOnly=2]="CurvedSurfacesOnly"}(t.NormalMode||(t.NormalMode={})),function(e){e[e.Yes=1]="Yes",e[e.No=0]="No"}(t.SurfacesOnly||(t.SurfacesOnly={})),function(e){e[e.Yes=1]="Yes",e[e.No=0]="No"}(t.PreserveOrder||(t.PreserveOrder={})),function(e){e[e.Yes=1]="Yes",e[e.No=0]="No"}(t.GenerateEdges||(t.GenerateEdges={}));class GeometryOptions{constructor(e=1,t=0,r=0,n=1){this.normals=e,this.surfaces=t,this.preserveOrder=r,this.edges=n}get wantSurfacesOnly(){return 1===this.surfaces}get wantPreserveOrder(){return 1===this.preserveOrder}get wantEdges(){return 1===this.edges}static createForGraphicBuilder(e,t=1,r=0){return new GeometryOptions(t,r,e.isOverlay||e.isViewBackground?1:0,e.isSceneGraphic?1:0)}}t.GeometryOptions=GeometryOptions;class Triangle{constructor(e=!0){this.indices=new Uint32Array(3),this.visible=[!0,!0,!0],this.singleSided=e}setIndices(e,t,r){this.indices[0]=e,this.indices[1]=t,this.indices[2]=r}setEdgeVisibility(e,t,r){this.visible[0]=e,this.visible[1]=t,this.visible[2]=r}isEdgeVisible(e){return this.visible[e]}get isDegenerate(){return this.indices[0]===this.indices[1]||this.indices[0]===this.indices[2]||this.indices[1]===this.indices[2]}}t.Triangle=Triangle;t.TriangleList=class TriangleList{constructor(){this._flags=[],this.indices=[]}get length(){return this._flags.length}get isEmpty(){return 0===this.length}addTriangle(e){let t=e.singleSided?1:0;for(let r=0;r<3;r++)e.isEdgeVisible(r)&&(t|=2<<r),this.indices.push(e.indices[r]);this._flags.push(t)}getTriangle(e,t){const r=void 0!==t?t:new Triangle;if(e>this.length)return new Triangle;const n=this._flags[e];r.singleSided=0!==(1&n);const i=3*e;for(let o=0;o<3;o++)r.indices[o]=this.indices[i+o],r.visible[o]=0!==(n&2<<o);return r}};class TriangleKey{constructor(e){this._sortedIndices=new Uint32Array(3);const t=e.indices,r=this._sortedIndices;t[0]<t[1]?t[0]<t[2]?(r[0]=t[0],t[1]<t[2]?(r[1]=t[1],r[2]=t[2]):(r[1]=t[2],r[2]=t[1])):(r[0]=t[2],r[1]=t[0],r[2]=t[1]):t[1]<t[2]?(r[0]=t[1],t[0]<t[2]?(r[1]=t[0],r[2]=t[2]):(r[1]=t[2],r[2]=t[0])):(r[0]=t[2],r[1]=t[1],r[2]=t[0]),r[0],r[1],r[1],r[2]}compare(e){let t=0;for(let r=0;r<3&&0===(t=this._sortedIndices[r]-e._sortedIndices[r]);r++);return t}}t.TriangleKey=TriangleKey;t.TriangleSet=class TriangleSet extends n.SortedArray{constructor(){super((e,t)=>e.compare(t))}insertKey(e,t){return this.insert(new TriangleKey(e),t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3);!function(e){let t,r;!function(e){e[e.Success=0]="Success",e[e.InvalidTileData=1]="InvalidTileData",e[e.InvalidHeader=2]="InvalidHeader",e[e.InvalidBatchTable=3]="InvalidBatchTable",e[e.InvalidScene=4]="InvalidScene",e[e.InvalidFeatureTable=5]="InvalidFeatureTable",e[e.Canceled=6]="Canceled"}(t=e.ReadStatus||(e.ReadStatus={})),function(e){e[e.Unknown=0]="Unknown",e[e.B3dm=1835283298]="B3dm",e[e.Gltf=1179937895]="Gltf",e[e.Dgn=1416521572]="Dgn",e[e.Pnts=1937010288]="Pnts",e[e.IModel=1818512745]="IModel"}(r=e.Format||(e.Format={}));e.StreamBuffer=class StreamBuffer{constructor(e){this._curPos=0,this._view=new DataView(e)}get length(){return this._view.byteLength}get isPastTheEnd(){return this.curPos>this.length}get curPos(){return this._curPos}set curPos(e){this._curPos=e,this.isPastTheEnd}advance(e){return this.curPos=this.curPos+e,!this.isPastTheEnd}rewind(e){return!(this.curPos-e<0)&&(this.curPos=this.curPos-e,!0)}reset(){this.curPos=0}get nextUint8(){return this.read(1,e=>e.getUint8(this.curPos))}get nextUint16(){return this.read(2,e=>e.getUint16(this.curPos,!0))}get nextUint32(){return this.read(4,e=>e.getUint32(this.curPos,!0))}get nextFloat32(){return this.read(4,e=>e.getFloat32(this.curPos,!0))}get nextFloat64(){return this.read(8,e=>e.getFloat64(this.curPos,!0))}get nextPoint3d64(){return new i.Point3d(this.nextFloat64,this.nextFloat64,this.nextFloat64)}get nextId64(){return n.Id64.fromUint32Pair(this.nextUint32,this.nextUint32)}nextBytes(e){const t=new Uint8Array(this.arrayBuffer,this.curPos,e);return this.advance(e),t}nextUint32s(e){const t=4*e,r=new Uint32Array(this.arrayBuffer,this.curPos,t);return this.advance(t),r}get arrayBuffer(){return this._view.buffer}read(e,t){const r=t(this._view);return this.advance(e),r}};e.Header=class Header{constructor(e){this._format=function(e){const t=e;return function(e){switch(e){case 0:case 1835283298:case 1179937895:case 1818512745:case 1416521572:case 1937010288:return!0;default:return!1}}(t)?t:0}(e.nextUint32),this.version=e.nextUint32}get format(){return this._format}invalidate(){this._format=0}};e.GeometryCollection=class GeometryCollection{constructor(e,t,r){this.meshes=e,this.isComplete=t,this.isCurved=r}get isEmpty(){return 0===this.meshes.length}}}(t.TileIO||(t.TileIO={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(54);var i;!function(e){e.valueFromLinePixels=function(e){switch(e){case 0:return 0;case 2155905152:return 1;case 4177066232:return 2;case 4292935648:return 3;case 4262526480:return 4;case 3772834016:return 5;case 4169726088:return 6;case 4279828248:return 7;case 3435973836:return 8;case 1:return 9;default:return 0}},e.solid=0,e.count=16,e.size=32,e.lineCodeData=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,255,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,255,0,0,0,0,255,255,255,255,255,255,255,0,0,0,0,255,0,0,0,0,255,255,255,255,255,255,255,0,0,0,0,0,255,255,255,0,0,0,0,0,255,255,255,0,0,0,0,0,255,255,255,0,0,0,0,0,255,255,255,0,0,0,255,0,0,0,255,0,0,0,255,255,255,255,255,0,0,0,255,0,0,0,255,0,0,0,255,255,255,255,255,0,0,0,255,255,0,0,0,255,255,255,255,255,255,255,255,0,0,0,255,255,0,0,0,255,255,255,255,255,255,255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}(i=t.LineCode||(t.LineCode={}));t.EdgeOverrides=class EdgeOverrides{constructor(e,t=!1){this._forceOpaque=!1,this.init(t,e)}get color(){return this._color}get lineCode(){return this._lineCode}get weight(){return this._weight}get forceOpaque(){return this._forceOpaque}get overridesColor(){return void 0!==this.color}get overridesLineCode(){return void 0!==this.lineCode}get overridesWeight(){return void 0!==this.weight}get overridesAlpha(){return this.forceOpaque}get anyOverridden(){return this.overridesColor||this.overridesLineCode||this.overridesWeight||this.overridesAlpha}computeOvrFlags(){let e=0;return this.overridesColor&&(e|=6),this.overridesWeight&&(e|=8),this.overridesLineCode&&(e|=64),this.overridesAlpha&&(e|=4),e}init(e,t){this._forceOpaque=e,void 0===t?(this._color=void 0,this._weight=void 0,this._lineCode=void 0):(this._color=void 0!==t.color?n.FloatPreMulRgba.fromColorDef(t.color):void 0,this._weight=t.width,this._lineCode=void 0!==t.pattern?i.valueFromLinePixels(t.pattern):void 0)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(137),i=r(3),o=r(0),s=r(4),a=r(7),c=r(105),l=r(138),u=r(139);t.ShaderProgramParams=class ShaderProgramParams{constructor(){this._renderPass=255,this._projectionMatrix=new n.Matrix4}get target(){return this._target,this._target}get renderPass(){return this._renderPass}get projectionMatrix(){return this._projectionMatrix}get isViewCoords(){return 9===this.renderPass||0===this.renderPass}get isOverlayPass(){return 8===this.renderPass||9===this.renderPass}get context(){return a.System.instance.context}init(e,t=3){if(this._renderPass=t,this._target=e,this.isViewCoords){const t=e.viewRect;n.Matrix4.fromOrtho(0,t.width,t.height,0,-1,1,this._projectionMatrix)}else n.Matrix4.fromMatrix4d(e.projectionMatrix,this._projectionMatrix)}};const d=i.Transform.createIdentity();t.DrawParams=class DrawParams{constructor(){this._modelViewMatrix=new n.Matrix4,this._modelMatrix=new n.Matrix4,this._viewMatrix=new n.Matrix4}get geometry(){return this._geometry,this._geometry}get programParams(){return this._programParams,this._programParams}get modelViewMatrix(){return this._modelViewMatrix}get modelMatrix(){return this._modelMatrix}get viewMatrix(){return this._viewMatrix}get target(){return this.programParams.target}get renderPass(){return this.programParams.renderPass}get projectionMatrix(){return this.programParams.projectionMatrix}get isViewCoords(){return this.programParams.isViewCoords}get isOverlayPass(){return this.programParams.isOverlayPass}get context(){return this.programParams.context}init(e,t,r=i.Transform.identity,o){if(this._programParams=e,void 0===o?o=e.renderPass:this.programParams.renderPass,this._geometry=t,n.Matrix4.fromTransform(r,this._modelMatrix),this.isViewCoords){const e=r.clone(d);e.matrix.coffs[2]=e.matrix.coffs[5]=e.matrix.coffs[8]=0,n.Matrix4.fromTransform(e,this._modelViewMatrix)}else{let e=this.target.viewMatrix.clone(d);e=e.multiplyTransformTransform(r,e),n.Matrix4.fromTransform(e,this._modelViewMatrix)}n.Matrix4.fromTransform(this.target.viewMatrix,this._viewMatrix)}},function(e){e[e.Push=0]="Push",e[e.Pop=1]="Pop"}(t.PushOrPop||(t.PushOrPop={}));class DrawCommand{preExecute(e){}postExecute(e){}get primitive(){}get branch(){}get pushOrPop(){}get isPrimitiveCommand(){return void 0!==this.primitive}get featureIndexType(){return void 0!==this.primitive?this.primitive.featureIndexType:0}get hasFeatureOverrides(){return 0!==this.featureIndexType}get renderOrder(){return void 0!==this.primitive?this.primitive.renderOrder:1}get hasAnimation(){return void 0!==this.primitive&&this.primitive.hasAnimation}getRenderPass(e){return void 0!==this.primitive?this.primitive.getRenderPass(e):255}getTechniqueId(e){return void 0!==this.primitive?this.primitive.getTechniqueId(e):-1}isPushCommand(e){return 0===this.pushOrPop&&(void 0===e||this.branch===e)}isPopCommand(e){return 1===this.pushOrPop&&(void 0===e||this.branch===e)}static createForBranch(e,t){return new BranchCommand(e,t)}static createForPrimitive(e,t){return void 0!==t?new BatchPrimitiveCommand(e,t):new PrimitiveCommand(e)}}t.DrawCommand=DrawCommand;class BranchCommand extends DrawCommand{get branch(){return this._branch}get pushOrPop(){return this._pushOrPop}constructor(e,t){super(),this._branch=e,this._pushOrPop=t}execute(e){0===this._pushOrPop?e.pushBranch(this._branch):e.popBranch()}}class PrimitiveCommand extends DrawCommand{constructor(e){super(),this._primitive=e}get primitive(){return this._primitive}execute(e){this._primitive.draw(e)}}class BatchPrimitiveCommand extends PrimitiveCommand{constructor(e,t){super(e),this._batch=t}preExecute(e){e.target.currentOverrides=this._batch.getOverrides(e.target),e.target.currentPickTable,e.target.currentPickTable=this._batch.pickTable}postExecute(e){e.target.currentOverrides=void 0,e.target.currentPickTable=void 0}computeIsFlashed(e){if(this.primitive instanceof l.SurfacePrimitive){const t=this.primitive;if(void 0!==t.meshData.features&&t.meshData.features.isUniform){const r=t.meshData.features.uniform,n=this._batch.featureTable.findElementId(r);if(void 0!==n)return n.toString()===e.toString()}}return o.Id64.isInvalid(e)}}t.BatchPrimitiveCommand=BatchPrimitiveCommand;t.RenderCommands=class RenderCommands{constructor(e,t){this._scratchFrustum=new s.Frustum,this._scratchRange=new s.ElementAlignedBox3d,this._curBatch=void 0,this._forcedRenderPass=255,this._opaqueOverrides=!1,this._translucentOverrides=!1,this._addTranslucentAsOpaque=!1,this.target=e,this._stack=t,this._commands=Array(14);for(let r=0;r<14;++r)this._commands[r]=[]}get isEmpty(){for(const e of this._commands)if(0<e.length)return!1;return!0}get currentViewFlags(){return this._stack.top.viewFlags}get compositeFlags(){let e=0;return this.hasCommands(5)&&(e|=1),(this.hasCommands(7)||this.hasCommands(12))&&(e|=2),e}hasCommands(e){return 0!==this.getCommands(e).length}isOpaquePass(e){return e>=1&&e<=3}addGraphics(e,t=255){this._forcedRenderPass=t,e.forEach(e=>e.addCommands(this)),this._forcedRenderPass=255}addTerrain(e){this._forcedRenderPass=11,e.forEach(e=>e.addCommands(this)),this._forcedRenderPass=255}addDecorations(e,t=255){this._forcedRenderPass=t;for(const r of e)r.addCommands(this);this._forcedRenderPass=255}addWorldDecorations(e){const t=this.target.getWorldDecorations(e);this.pushAndPopBranch(t,()=>{for(const e of t.branch.entries)e.addCommands(this)})}addPickableDecorations(e){if(void 0!==e.normal)for(const t of e.normal){const e=t;e.isPickable&&e.addCommands(this)}if(void 0!==e.world){const t=this.target.getWorldDecorations(e.world);this.pushAndPopBranch(t,()=>{for(const e of t.branch.entries)e.isPickable&&e.addCommands(this)})}}addBackground(e){void 0!==e&&(this._forcedRenderPass,this._forcedRenderPass=0,this._stack.pushState(this.target.decorationState),e.addCommands(this),this._stack.pop(),this._forcedRenderPass=255)}addSkyBox(e){void 0!==e&&(this._forcedRenderPass,this._forcedRenderPass=10,this._stack.pushState(this.target.decorationState),e.addCommands(this),this._stack.pop(),this._forcedRenderPass=255)}addDrawCommand(e,t){if(void 0===t&&(t=this.getRenderPass(e)),255===t)return;if(255!==this._forcedRenderPass)return void this.getCommands(this._forcedRenderPass).push(e);let r=0;(this._opaqueOverrides||this._translucentOverrides)&&(r=e.featureIndexType);const n=0!==r;if(5===t&&this._addTranslucentAsOpaque)switch(e.renderOrder){case 10:t=2;break;case 2:t=3;break;default:t=1}switch(t){case 5:if(this._opaqueOverrides&&n){let t;switch(e.renderOrder){case 10:t=2;break;case 2:t=3;break;default:t=1}this.getCommands(t).push(e)}break;case 1:case 2:0===e.featureIndexType&&(t=3);case 3:this._translucentOverrides&&n&&!this._addTranslucentAsOpaque&&this.getCommands(5).push(e)}this.getCommands(t).push(e)}getRenderPass(e){return e.getRenderPass(this.target)}getCommands(e){let t=e;return this._commands.length,t>=this._commands.length&&(t-=1),this._commands[t]}addHiliteBranch(e,t,r){this.pushAndPopBranchForPass(r,e,()=>{e.branch.entries.forEach(e=>e.addHiliteCommands(this,t,r))})}pushAndPopBranchForPass(e,t,r){this._stack.pushBranch(t);const n=this.getCommands(e);n.push(DrawCommand.createForBranch(t,0)),r(),this._stack.pop(),n[n.length-1].isPushCommand(t)?n.pop():n.push(DrawCommand.createForBranch(t,1))}pushAndPopBranch(e,t){let r;this._stack.pushBranch(e);const n=255===this._forcedRenderPass,i=n?0:this._forcedRenderPass,o=n?this._commands.length:i+1;for(let a=i;a<o;++a)(r=this._commands[a]).push(DrawCommand.createForBranch(e,0));t();const s=DrawCommand.createForBranch(e,1);for(let a=i;a<o;++a)(r=this._commands[a]).length,0<r.length&&r[r.length-1].isPushCommand(e)?r.pop():r.push(s);this._stack.pop()}clear(){this._commands.forEach(e=>{e.splice(0)})}initForPickOverlays(e){this.clear(),this._addTranslucentAsOpaque=!0,this._stack.pushState(this.target.decorationState);for(const t of e){const e=t;e.isPickable&&e.addCommands(this)}this._stack.pop(),this._addTranslucentAsOpaque=!1}init(e,t,r,n,i=!1){if(this.clear(),i)return this._addTranslucentAsOpaque=!0,this.addGraphics(e),void 0!==r&&this.addPickableDecorations(r),this._addTranslucentAsOpaque=!1,void this.setupClassificationByVolume();this.addGraphics(e),this.addTerrain(t),void 0!==n&&0<n.length&&this.addDecorations(n),void 0!==r&&(this.addBackground(r.viewBackground),this.addSkyBox(r.skyBox),void 0!==r.normal&&0<r.normal.length&&this.addGraphics(r.normal),void 0!==r.world&&0<r.world.length&&this.addWorldDecorations(r.world),this._stack.pushState(this.target.decorationState),void 0!==r.viewOverlay&&0<r.viewOverlay.length&&this.addDecorations(r.viewOverlay,9),void 0!==r.worldOverlay&&0<r.worldOverlay.length&&this.addDecorations(r.worldOverlay,8),this._stack.pop()),this.setupClassificationByVolume()}addPrimitive(e){if(void 0!==this._frustumPlanes&&e instanceof l.SurfacePrimitive&&4===e.getRenderPass(this.target)){const t=e;if(t.cachedGeometry instanceof l.SurfaceGeometry){const e=t.cachedGeometry;this._scratchRange.setNull();const r=e.qOrigin[0],n=e.qOrigin[1],i=e.qOrigin[2],o=65535*e.qScale[0]+r,a=65535*e.qScale[1]+n,c=65535*e.qScale[2]+i;this._scratchRange.setXYZ(r,n,i),this._scratchRange.extendXYZ(o,a,c);let l=s.Frustum.fromRange(this._scratchRange,this._scratchFrustum);if(l=l.transformBy(this.target.currentTransform,l),0===this._frustumPlanes.computeFrustumContainment(l))return}}const t=DrawCommand.createForPrimitive(e,this._curBatch);if(this.addDrawCommand(t),255===this._forcedRenderPass&&e.isEdge){const e=this.target.currentViewFlags;0!==e.renderMode&&e.hiddenEdges&&this.addDrawCommand(t,6)}}addBranch(e){this.pushAndPopBranch(e,()=>{e.branch.entries.forEach(e=>e.addCommands(this))})}computeBatchHiliteRenderPass(e){let t=7;if(e.graphic instanceof u.MeshGraphic)4===e.graphic.surfaceType&&(t=12);else if(e.graphic instanceof c.GraphicsArray){const r=e.graphic;r.graphics[0]instanceof u.MeshGraphic&&4===r.graphics[0].surfaceType&&(t=12)}return t}addBatch(e){!this._opaqueOverrides&&this._translucentOverrides,this._curBatch;const t=e.getOverrides(this.target);if(!t.allHidden){if(void 0!==this._frustumPlanes&&!e.range.isNull){let t=s.Frustum.fromRange(e.range,this._scratchFrustum);if(t=t.transformBy(this.target.currentTransform,t),0===this._frustumPlanes.computeFrustumContainment(t))return}this._curBatch=e,this._opaqueOverrides=t.anyOpaque,this._translucentOverrides=t.anyTranslucent,e.graphic.addCommands(this),this._curBatch=void 0,t.anyHilited&&e.graphic.addHiliteCommands(this,e,this.computeBatchHiliteRenderPass(e)),this._opaqueOverrides=this._translucentOverrides=!1}}setCheckRange(e){this._frustumPlanes=new s.FrustumPlanes(e)}clearCheckRange(){this._frustumPlanes=void 0}setupClassificationByVolume(){const e=this._commands[4],t=this._commands[13],r=e.length;let n=0;for(;n<r;){const r=e[n++];if(!r.isPushCommand())continue;let i=n++;if(!e[i].isPrimitiveCommand)continue;for(;e[n].isPrimitiveCommand;)++n;const o=n++,s=e[o];if(s.isPopCommand())for(;i<o;)t.push(r),t.push(e[i++]),t.push(s)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(34),i=r(54),o=r(31),s=r(27),a=r(46),c=r(109),l=r(314),u=r(297),d=(r(0),r(186)),h=r(7);!function(e){e[e.None=0]="None",e[e.Weight=1]="Weight",e[e.LineCode=2]="LineCode",e[e.HasOverrides=4]="HasOverrides",e[e.Color=8]="Color",e[e.Alpha=16]="Alpha",e[e.Surface=28]="Surface",e[e.Point=29]="Point",e[e.Linear=31]="Linear",e[e.PointCloud=12]="PointCloud"}(t.FeatureSymbologyOptions||(t.FeatureSymbologyOptions={}));const p="\nfloat getFeatureIndex() {\n  if (u_featureInfo.x <= kFeatureDimension_SingleNonUniform)\n      return u_featureInfo.y;\n\n  vec2 tc = g_featureIndexCoords;\n  vec4 enc = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  return decodeUInt32(enc.xyz);\n}\n",f="\nfloat extractNthFeatureBit(float flags, float n) {\n  return 0.0 == extractNthBit(u_globalOvrFlags, n) ? extractNthBit(flags, n) : 0.0;\n}\n",g="\nfloat extractNthFeatureBit(float flags, float n) {\n  return extractNthBit(flags, n);\n}\n",m="\nvec2 computeFeatureTextureCoords() { return compute_feature_coords(getFeatureIndex()); }\n",y="\nvec4 getFirstFeatureRgba() {\n  return u_featureOverrides1;\n}\n",v="\nvec4 getFirstFeatureRgba() {\n  if (u_featureInfo.x <= kFeatureDimension_SingleUniform)\n    return u_featureOverrides1;\n\n  feature_texCoord = computeFeatureTextureCoords();\n  return TEXTURE(u_featureLUT, feature_texCoord);\n}\n",_="\nvec4 getSecondFeatureRgba() {\n  return u_featureOverrides2;\n}\n",w="\nvec4 getSecondFeatureRgba() {\n  if (u_featureInfo.x <= kFeatureDimension_SingleUniform)\n    return u_featureOverrides2;\n\n  vec2 coord = feature_texCoord;\n  coord.x += g_feature_stepX;\n  return TEXTURE(u_featureLUT, coord);\n}\n",S="\nfloat ComputeLineWeight() {\n  return 1.0 == linear_feature_overrides.x ? linear_feature_overrides.y : u_lineWeight;\n}\n",b="\nfloat ComputeLineCode() {\n  return 1.0 == linear_feature_overrides.z ? linear_feature_overrides.w : u_lineCode;\n}\n";function x(e,t=!1){var r;(r=e).addConstant("kFeatureDimension_Empty",2,"0.0"),r.addConstant("kFeatureDimension_SingleUniform",2,"1.0"),r.addConstant("kFeatureDimension_SingleNonUniform",2,"2.0"),r.addConstant("kFeatureDimension_Multiple",2,"3.0"),t||(e.addUniform("u_featureInfo",3,e=>{e.addGraphicUniform("u_featureInfo",(e,t)=>{let r=0;const n=[0,0],i=t.geometry.featuresInfo,o=void 0!==i?i.type:0;1===o&&(n[1]=i.uniform);const s=t.target.currentOverrides;if(void 0!==s)r=t.target.areDecorationOverridesActive?u.computeFeatureDimension(0,1):u.computeFeatureDimension(s.dimension,o);else{const e=t.target.currentPickTable;void 0!==e&&(r=u.computeFeatureDimension(void 0!==e.nonUniform?1:0,o))}n[0]=r,e.setUniform2fv(n)})}),e.addFunction(p))}const P="\n  if (feature_invisible)\n    return true;\n\n  bool hasAlpha = 1.0 == u_hasAlpha;\n  if (v_feature_alpha_flashed.x > 0.0) {\n    const float s_minTransparency = 15.0; // NB: See DisplayParams.getMinTransparency() - this must match!\n    const float s_maxAlpha = (255.0 - s_minTransparency) / 255.0;\n    hasAlpha = v_feature_alpha_flashed.x < s_maxAlpha;\n  }\n\n  bool isOpaquePass = (kRenderPass_OpaqueLinear <= u_renderPass && kRenderPass_OpaqueGeneral >= u_renderPass);\n  bool isTranslucentPass = kRenderPass_Translucent == u_renderPass;\n  return (isOpaquePass && hasAlpha) || (isTranslucentPass && !hasAlpha);\n";function C(e,t,r,i){if(0===t)return!1;const s=e.vert;if(x(s,i),!(0!==(4&r)))return!0;const c=0!==(1&r),u=0!==(2&r),d=0!==(8&r),p=0!==(16&r);return s.addGlobal("feature_invisible",0,"false"),s.addFunction(a.GLSLCommon.extractNthBit),function(e){e.addConstant("kOvrBit_Visibility",2,"0.0"),e.addConstant("kOvrBit_Rgb",2,"1.0"),e.addConstant("kOvrBit_Alpha",2,"2.0"),e.addConstant("kOvrBit_Weight",2,"3.0"),e.addConstant("kOvrBit_Flashed",2,"4.0"),e.addConstant("kOvrBit_Hilited",2,"5.0"),e.addConstant("kOvrBit_LineCode",2,"6.0"),e.addConstant("kOvrBit_IgnoreMaterial",2,"7.0")}(s),s.addGlobal("linear_feature_overrides",5,"vec4(0.0)"),s.addGlobal("feature_ignore_material",0,"false"),c||u?(s.addFunction(f),u&&s.replaceFunction(o.GLSLVertex.computeLineCode,b),c&&(s.replaceFunction(o.GLSLVertex.computeLineWeight,S),s.addUniform("u_globalOvrFlags",2,e=>{e.addGraphicUniform("u_globalOvrFlags",(e,t)=>{let r=0;if(t.geometry.isEdge){const e=t.target.getEdgeOverrides(t.renderPass);void 0!==e&&(r=e.computeOvrFlags())}e.setUniform1f(r)})}))):s.addFunction(g),i?s.addFunction(y):(l.addLookupTable(s,"feature","2.0"),s.addGlobal("feature_texCoord",3),s.addFunction(m),s.addFunction(v),s.addUniform("u_featureLUT",8,e=>{e.addGraphicUniform("u_featureLUT",(e,t)=>{const r=t.target.currentOverrides;r.isNonUniform?r.lut.bindSampler(e,n.TextureUnit.FeatureSymbology):h.System.instance.ensureSamplerBound(e,n.TextureUnit.FeatureSymbology)})}),s.addUniform("u_featureParams",3,e=>{e.addGraphicUniform("u_featureParams",(e,t)=>{const r=t.target.currentOverrides;r.isNonUniform&&e.setUniform2fv([r.lut.width,r.lut.height])})})),s.addUniform("u_featureOverrides1",5,e=>{e.addGraphicUniform("u_featureOverrides1",(e,t)=>{const r=t.target.currentOverrides;r.isUniform&&e.setUniform4fv(r.uniform1)})}),d&&(s.addFunction(i?_:w),p&&o.addAlpha(s),s.addUniform("u_featureOverrides2",5,e=>{e.addGraphicUniform("u_featureOverrides2",(e,t)=>{const r=t.target.currentOverrides;r.isUniform&&e.setUniform4fv(r.uniform2)})}),p&&s.set(2,P)),!0}function T(e){e.addUniform("u_hilite_color",5,e=>{e.addGraphicUniform("u_hilite_color",(e,t)=>{const r=t.target.currentViewFlags,n=t.geometry.wantMixHiliteColorForFlash(r,t.target)?0:255;i.FloatRgba.fromColorDef(t.target.hiliteSettings.color,n).bind(e)})}),e.addUniform("u_hilite_settings",4,e=>{e.addProgramUniform("u_hilite_settings",(e,t)=>{const r=t.target.hiliteSettings;let n=2;switch(r.silhouette){case 0:n=0;break;case 1:n=1}const i=r.hiddenRatio,o=Math.max(0,r.visibleRatio-i);e.setUniform3fv([o,i,n])})})}t.addHiliteSettings=T;const M="return 0.0 == v_feature_hilited;",E="return vec4(ceil(v_feature_hilited));",I="\nif (ceil(v_feature_hilited) >= 1.0 && isSurfaceBitSet(kSurfaceBit_HasTexture))\n  return vec4(TEXTURE(s_texture, v_texCoord).a > 0.15 ? 1.0 : 0.0);\nelse\n  return vec4(ceil(v_feature_hilited));\n",A="\n  vec4 value = getFirstFeatureRgba();\n  float flags = value.r * 256.0;\n  feature_invisible = 1.0 == extractNthFeatureBit(flags, kOvrBit_Visibility);\n  v_feature_hilited = extractNthFeatureBit(flags, kOvrBit_Hilited);\n",R=A+"\n  linear_feature_overrides = vec4(1.0 == extractNthFeatureBit(flags, kOvrBit_Weight),\n  value.g * 256.0,\n  1.0 == extractNthFeatureBit(flags, kOvrBit_LineCode),\n  value.b * 256.0);\n";function O(e,t=!1,r=!1){let n=4;t&&(n|=1),C(e,2,n,r)&&(e.addVarying("v_feature_hilited",2),e.vert.set(1,t?R:A),e.vert.set(2,M),e.frag.set(1,E),e.frag.set(13,s.GLSLFragment.assignFragColor))}function D(e,t){t&&(e.addUniform("u_pickElementId0",8,e=>{e.addProgramUniform("u_pickElementId0",(e,t)=>{t.target.compositor.elementId0.bindSampler(e,n.TextureUnit.PickElementId0)})},3),e.addUniform("u_pickElementId1",8,e=>{e.addProgramUniform("u_pickElementId1",(e,t)=>{t.target.compositor.elementId1.bindSampler(e,n.TextureUnit.PickElementId1)})},3)),e.addUniform("u_pickDepthAndOrder",8,e=>{e.addProgramUniform("u_pickDepthAndOrder",(e,t)=>{t.target.compositor.depthAndOrder.bindSampler(e,n.TextureUnit.PickDepthAndOrder)})},3)}t.addSurfaceHiliter=function(e,t=!1,r=!1){O(e,t,r),e.frag.set(1,I)},t.addHiliter=O;const k="\nvec2 readDepthAndOrder(vec2 tc) {\n  vec4 pdo = TEXTURE(u_pickDepthAndOrder, tc);\n  float order = floor(pdo.x * 16.0 + 0.5);\n  return vec2(order, decodeDepthRgb(pdo.yzw));\n}\n",F="\n  if (u_renderPass > kRenderPass_Translucent || u_renderPass <= kRenderPass_Background)\n    return false;\n\n  vec2 tc = windowCoordsToTexCoords(gl_FragCoord.xy);\n  vec2 depthAndOrder = readDepthAndOrder(tc);\n  float surfaceDepth = computeLinearDepth(v_eyeSpace.z);\n  return depthAndOrder.x > u_renderOrder && abs(depthAndOrder.y - surfaceDepth) < 4.0e-5;\n",N="\n  if (u_renderPass > kRenderPass_Translucent || u_renderPass <= kRenderPass_Background)\n    return false;\n  else if (!isSurfaceBitSet(kSurfaceBit_HasNormals))\n    return false; // no normal == never-lit geometry == never rendered with edges == don't have to test further\n\n  vec2 tc = windowCoordsToTexCoords(gl_FragCoord.xy);\n  vec2 depthAndOrder = readDepthAndOrder(tc);\n  if (depthAndOrder.x <= u_renderOrder)\n    return false; // just do normal z-testing.\n\n  // Calculate depthTolerance for letting edges show through their own surfaces\n  vec3 eyeDir;\n  float dtWidthFactor;\n  if (u_frustum.z == kFrustumType_Perspective) {\n    eyeDir = normalize(-v_eyeSpace.xyz);\n    dtWidthFactor = -v_eyeSpace.z * u_pixelWidthFactor;\n  } else {\n    eyeDir = vec3(0.0, 0.0, 1.0);\n    dtWidthFactor = u_pixelWidthFactor;\n  }\n\n  // Compute depth tolerance based on angle of triangle to screen\n  float dSq = dot(eyeDir, v_n);\n  if (depthAndOrder.x == kRenderOrder_Silhouette) // curved surface\n    dSq *= 0.5;\n  else\n    dSq *= 0.9;\n\n  dSq = dSq * dSq;\n  dSq = max(dSq, 0.0001);\n  dSq = min(dSq, 0.999);\n\n  float depthTolerance = dtWidthFactor * v_lineWeight * sqrt((1.0 - dSq) / dSq);\n  if (depthAndOrder.x == kRenderOrder_Silhouette) // curved surface\n    depthTolerance = depthTolerance * 1.333;\n\n  // Make sure stuff behind camera doesn't get pushed in front of it\n  depthTolerance = max(depthTolerance, 0.0);\n\n  // Convert depthTolerance from eye space to linear depth\n  depthTolerance /= (u_frustum.y - u_frustum.x);\n\n  float surfaceDepth = computeLinearDepth(v_eyeSpace.z);\n  float depthDelta = abs(depthAndOrder.y - surfaceDepth);\n  if (depthDelta > depthTolerance)\n    return false; // don't discard and let normal z-testing happen\n\n  // Does pick buffer contain same element?\n  vec4 elemId0 = TEXTURE(u_pickElementId0, tc);\n\n  // Converting to ints to test since varying floats can be interpolated incorrectly\n  ivec4 elemId0_i = ivec4(elemId0 * 255.0 + 0.5);\n  ivec4 v_element_id0_i = ivec4(v_element_id0 * 255.0 + 0.5);\n  bool isSameElement = elemId0_i == v_element_id0_i;\n  if (isSameElement) {\n    vec4 elemId1 = TEXTURE(u_pickElementId1, tc);\n    ivec4 elemId1_i = ivec4(elemId1 * 255.0 + 0.5);\n    ivec4 v_element_id1_i = ivec4(v_element_id1 * 255.0 + 0.5);\n    isSameElement = elemId1_i == v_element_id1_i;\n  }\n  if (!isSameElement) {\n    // If what was in the pick buffer is a planar line/edge/silhouette then we've already tested the depth so return true to discard.\n    // If it was a planar surface then use a tighter and constant tolerance to see if we want to let it show through since we're only fighting roundoff error.\n    return (depthAndOrder.x > kRenderOrder_PlanarSurface) || ((depthAndOrder.x == kRenderOrder_PlanarSurface) && (depthDelta <= 4.0e-5));\n  }\n\n  return true; // discard surface in favor of pick buffer contents.\n";function L(e){e.addUniform("u_renderOrder",2,e=>{e.addGraphicUniform("u_renderOrder",(e,t)=>{e.setUniform1f(t.geometry.renderOrder)})})}function B(e){e.addUniform("u_pixelWidthFactor",2,e=>{e.addGraphicUniform("u_pixelWidthFactor",(e,t)=>{!function(e,t){const r=t.target.viewRect,n=r.width,i=r.height,o=t.target.frustumUniforms.frustumPlanes,s=o[0],a=o[1],c=o[2],l=o[3];let u,d;const h=t.target.frustumUniforms.frustum;if(2===h[2]){const e=s*(1/h[0]);d=e/i,u=e/n}else u=.5*(l-c)/n,d=.5*(s-a)/i;const p=Math.sqrt(u*u+d*d);e.setUniform1f(p)}(e,t)})})}t.computeUniformElementId="\n  v_element_id0 = u_element_id0;\n  v_element_id1 = u_element_id1;\n",t.computeElementId="\n  if (u_featureInfo.x <= kFeatureDimension_SingleUniform) {\n    v_element_id0 = u_element_id0;\n    v_element_id1 = u_element_id1;\n  } else {\n    vec2 texc = computeElementIdTextureCoords();\n    v_element_id0 = TEXTURE(u_elementIdLUT, texc);\n    texc.x += g_elementId_stepX;\n    v_element_id1 = TEXTURE(u_elementIdLUT, texc);\n  }\n",t.addRenderOrder=L;const V="\nvec2 computeElementIdTextureCoords() {\n  return compute_elementId_coords(getFeatureIndex());\n}\n";function U(e,r=!1){e.addVarying("v_element_id0",5),e.addVarying("v_element_id1",5);const i=e.vert;r?i.addFunction("void computeElementId()",t.computeUniformElementId):(l.addLookupTable(i,"elementId","2.0"),i.addFunction(V),i.addFunction("void computeElementId()",t.computeElementId),i.addUniform("u_elementIdLUT",8,e=>{e.addGraphicUniform("u_elementIdLUT",(e,t)=>{t.target.currentPickTable;const r=t.target.currentPickTable;void 0!==r.nonUniform?r.nonUniform.bindSampler(e,n.TextureUnit.ElementId):h.System.instance.ensureSamplerBound(e,n.TextureUnit.ElementId)})}),i.addUniform("u_elementIdParams",3,e=>{e.addGraphicUniform("u_elementIdParams",(e,t)=>{const r=t.target.currentPickTable;void 0!==r.nonUniform&&e.setUniform2fv([r.nonUniform.width,r.nonUniform.height])})})),i.addUniform("u_element_id0",5,e=>{e.addGraphicUniform("u_element_id0",(e,t)=>{const r=t.target.currentPickTable;void 0!==r.uniform&&e.setUniform4fv(r.uniform.elemId0)})}),i.addUniform("u_element_id1",5,e=>{e.addGraphicUniform("u_element_id1",(e,t)=>{const r=t.target.currentPickTable;void 0!==r.uniform&&e.setUniform4fv(r.uniform.elemId1)})})}t.addElementId=U;const z="\n  return g_baseAlpha < u_transparencyThreshold && isSurfaceBitSet(kSurfaceBit_TransparencyThreshold);\n";t.addSurfaceDiscard=function(e,r){const n=e.frag,i=e.vert;s.addWindowToTexCoords(n),i.set(5,z),i.addUniform("u_transparencyThreshold",2,e=>{e.addProgramUniform("u_transparencyThreshold",(e,t)=>{e.setUniform1f(t.target.transparencyThreshold)})}),0===r?(D(n,!1),n.addFunction(s.GLSLFragment.computeLinearDepth),n.addFunction(c.GLSLDecode.depthRgb),n.addFunction(k),a.addEyeSpace(e),n.set(0,F)):(x(i),function(e){e.addUniform("u_lineWeight",2,e=>{e.addGraphicUniform("u_lineWeight",(e,t)=>{const r=t.geometry,n=t.target.getEdgeWeight(t.programParams,r.edgeWidth);e.setUniform1f(n<1?1:n)})})}(i),i.addFunction(o.GLSLVertex.computeLineWeight),i.set(4,t.computeElementId),D(n,!0),function(e){e.addConstant("kRenderOrder_None",2,"0.0"),e.addConstant("kRenderOrder_BlankingRegion",2,"1.0"),e.addConstant("kRenderOrder_Surface",2,"2.0"),e.addConstant("kRenderOrder_Linear",2,"3.0"),e.addConstant("kRenderOrder_Edge",2,"4.0"),e.addConstant("kRenderOrder_Silhouette",2,"5.0"),e.addConstant("kRenderOrder_PlanarSurface",2,"10.0"),e.addConstant("kRenderOrder_PlanarLinear",2,"11.0"),e.addConstant("kRenderOrder_PlanarEdge",2,"12.0"),e.addConstant("kRenderOrder_PlanarSilhouette",2,"13.0")}(n),B(n),n.addFunction(s.GLSLFragment.computeLinearDepth),n.addFunction(c.GLSLDecode.depthRgb),n.addFunction(k),n.set(0,N),a.addEyeSpace(e),e.addInlineComputedVarying("v_lineWeight",2,"v_lineWeight = ComputeLineWeight();"),U(e)),L(n),d.addRenderPass(n)};const j="\n  v_feature_rgb = vec3(-1.0);\n  v_feature_alpha_flashed = vec2(-1.0, 0.0);\n  vec4 value = getFirstFeatureRgba();\n\n  // 2 RGBA values per feature - first R is override flags mask\n  if (0.0 == value.r) {\n    return; // nothing overridden for this feature\n  }\n\n  float flags = value.r * 256.0;\n  feature_invisible = 1.0 == extractNthFeatureBit(flags, kOvrBit_Visibility);\n  if (feature_invisible)\n    return;\n\n  bool rgbOverridden = extractNthFeatureBit(flags, kOvrBit_Rgb) > 0.0;\n  bool alphaOverridden = extractNthFeatureBit(flags, kOvrBit_Alpha) > 0.0;\n  if (alphaOverridden || rgbOverridden) {\n    vec4 rgba = getSecondFeatureRgba();\n    if (rgbOverridden)\n      v_feature_rgb = rgba.rgb;\n\n    if (alphaOverridden)\n      v_feature_alpha_flashed.x = rgba.a;\n  }\n\n  linear_feature_overrides = vec4(1.0 == extractNthFeatureBit(flags, kOvrBit_Weight),\n                                  value.g * 256.0,\n                                  1.0 == extractNthFeatureBit(flags, kOvrBit_LineCode),\n                                  value.b * 256.0);\n\n  feature_ignore_material = 0.0 != extractNthFeatureBit(flags, kOvrBit_IgnoreMaterial);\n  v_feature_alpha_flashed.y = extractNthFeatureBit(flags, kOvrBit_Flashed);\n  v_feature_alpha_flashed.y += 2.0 * extractNthFeatureBit(flags, kOvrBit_Hilited);\n",G="\n  if (v_feature_rgb.r >= 0.0)\n    baseColor.rgb = v_feature_rgb.rgb * baseColor.a;\n\n  if (v_feature_alpha_flashed.x >= 0.0)\n    baseColor = adjustPreMultipliedAlpha(baseColor, v_feature_alpha_flashed.x);\n\n  return baseColor;\n",H="\n  float flashHilite = floor(v_feature_alpha_flashed.y + 0.5);\n  float isFlashed = (flashHilite == 1.0 || flashHilite == 3.0) ? 1.0 : 0.0;\n  float isHilited = (flashHilite >= 2.0) ? 1.0 : 0.0;\n\n  float hiliteRatio = u_hilite_settings.x * isHilited;\n  baseColor = revertPreMultipliedAlpha(baseColor);\n  baseColor.rgb = mix(baseColor.rgb, u_hilite_color.rgb, hiliteRatio);\n\n  if (u_hilite_color.a == 1.0) { // .a indicates lit geometry - brighten it\n    const float maxBrighten = 0.2;\n    float brighten = u_flash_intensity * maxBrighten;\n    baseColor.rgb += isFlashed * brighten;\n  } else { // unlit geometry - tween it toward flash color\n    float maxTween = 0.75;\n    float hiliteFraction = u_flash_intensity * isFlashed * maxTween;\n    baseColor.rgb *= (1.0 - hiliteFraction);\n    baseColor.rgb += u_hilite_color.rgb * hiliteFraction;\n  }\n\n  return applyPreMultipliedAlpha(baseColor);\n";t.addFeatureSymbology=function(e,t,r,n=!1){if(!C(e,t,r,n)||0===r)return;e.addVarying("v_feature_rgb",4),e.addVarying("v_feature_alpha_flashed",3),e.vert.set(1,j);const i=e.frag;T(i),i.addFunction(a.GLSLCommon.floatToBool),i.set(3,G),i.addFunction(s.GLSLFragment.revertPreMultipliedAlpha),i.addFunction(s.GLSLFragment.applyPreMultipliedAlpha),i.addFunction(s.GLSLFragment.adjustPreMultipliedAlpha),i.set(11,H),i.addUniform("u_flash_intensity",2,e=>{e.addProgramUniform("u_flash_intensity",(e,t)=>{e.setUniform1f(t.target.flashIntensity)})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class UiComponents{constructor(){}static async initialize(e){return UiComponents._i18n=e,await UiComponents._i18n.registerNamespace("UiComponents").readFinished,Promise.resolve()}static terminate(){UiComponents._i18n=void 0}static get i18n(){if(!UiComponents._i18n)throw new Error("UiComponents not initialized");return UiComponents._i18n}}t.default=UiComponents},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(343)),n(r(727)),n(r(822)),n(r(823))},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){var n=r(112),i=r(805),o=r(94),s="[object Object]",a=Function.prototype,c=Object.prototype,l=a.toString,u=c.hasOwnProperty,d=l.call(Object);e.exports=function(e){if(!o(e)||n(e)!=s)return!1;var t=i(e);if(null===t)return!0;var r=u.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&l.call(r)==d}},function(e,t,r){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=r(388)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(70),i=r(29),o=r(17),s=r(0),a=r(81),c=r(119),l="imodeljs-clients.Clients";class WsgError extends i.ResponseError{constructor(e,t,r){super(e,t,r)}static parse(e,t=!0){const r=i.ResponseError.parse(e,!1),o=new WsgError(98305);if(n(o,r),o._data)if("object"===typeof o._data){if(o._data.errorMessage||o._data.errorId)return o.message=o._data.errorMessage||o.message,o.name=o._data.errorId||o.name,o.description=o._data.errorDescription||o.description,o.errorNumber=WsgError.getWSStatusId(o.name?o.name:""),t&&o.log(),o}else if(302===o.status&&o._data.indexOf("ims.bentley.com")>=0){const e=new a.AuthenticationError(98319);return n(e,r),e.name="Authentication Error",e.message="Authentication Error - Check if the accessToken is valid",e}return t&&r.log(),r}static shouldRetry(e,t){if(void 0===t||null===t)return super.shouldRetry(e,t);if(0===super.parseHttpStatus(t.statusType))return!1;const r=WsgError.parse({response:t},!1);if(!(r instanceof WsgError))return super.shouldRetry(e,t);const n=WsgError.getErrorStatus(void 0!==r.name?WsgError.getWSStatusId(r.name):98305,t.statusType);return[98306,98307,98308,98309,98310,98311,98312,98313,98314,98315,98316,98317,98318,94212,94211,98305].includes(n)}static getErrorStatus(e,t){return 98305!==e?e:94212===super.parseHttpStatus(t)?94212:94211===super.parseHttpStatus(t)?94211:98305}static getWSStatusId(e){switch(e){case"LoginFailed":return 98306;case"SslRequired":return 98307;case"NotEnoughRights":return 98308;case"DatasourceNotFound":case"RepositoryNotFound":return 98309;case"SchemaNotFound":return 98310;case"ClassNotFound":return 98311;case"PropertyNotFound":return 98312;case"LinkTypeNotFound":return 98311;case"ObjectNotFound":case"InstanceNotFound":return 98313;case"FileNotFound":return 98314;case"NotSupported":return 98315;case"NoServerLicense":return 98316;case"NoClientLicense":return 98317;case"TooManyBadLoginAttempts":return 98318;default:return 98305}}log(){s.Logger.logError(l,this.logMessage(),this.getMetaData())}}t.WsgError=WsgError;class DefaultWsgRequestOptionsProvider extends a.DefaultRequestOptionsProvider{constructor(){super(),this._defaultOptions.errorCallback=WsgError.parse,this._defaultOptions.retryCallback=WsgError.shouldRetry}}t.DefaultWsgRequestOptionsProvider=DefaultWsgRequestOptionsProvider;class WsgClient extends a.Client{constructor(e){super(),this.apiVersion=e,this.apiVersion=e}async setupOptionDefaults(e){return WsgClient._defaultWsgRequestOptionsProvider||(WsgClient._defaultWsgRequestOptionsProvider=new DefaultWsgRequestOptionsProvider),WsgClient._defaultWsgRequestOptionsProvider.assignOptions(e)}async getUrl(e,t){return this._url?Promise.resolve(this._url):super.getUrl(e).then(e=>(this._url=e,t||(this._url+="/"+this.apiVersion),Promise.resolve(this._url)))}async getAccessToken(e,t){return(new c.ImsDelegationSecureTokenClient).getToken(e,t,this.getRelyingPartyUrl())}async deleteInstance(e,t,r,n,s){e.enter();const a=await this.getUrl(e)+r;e.enter();const c=n?o.ECJsonTypeMap.toJson("wsg",n):void 0,l={method:"DELETE",headers:{authorization:t.toTokenString()},body:{instance:c}};return s&&(l.body.requestOptions=s),await this.setupOptionDefaults(l),i.request(e,a,l).then(()=>Promise.resolve())}async postInstance(e,t,r,n,a,c){const u=await this.getUrl(e)+n;e.enter(),s.Logger.logInfo(l,`Sending POST request to ${u}`);const d=o.ECJsonTypeMap.toJson("wsg",a),h={method:"POST",headers:{authorization:r.toTokenString()},body:{instance:d}};c&&(h.body.requestOptions=c),await this.setupOptionDefaults(h),e.enter();const p=await i.request(e,u,h);if(e.enter(),!p.body||!p.body.changedInstance||!p.body.changedInstance.instanceAfterChange)return Promise.reject(new Error(`POST to URL ${u} executed successfully, but did not return the expected result.`));const f=p.body.changedInstance.instanceAfterChange,g=o.ECJsonTypeMap.fromJson(t,"wsg",f);return g?(s.Logger.logTrace(l,`Successful POST request to ${u}`),Promise.resolve(g)):Promise.reject(new Error(`POST to URL ${u} executed successfully, but could not convert response to a strongly typed instance.`))}async postInstances(e,t,r,n,a,c){e.enter();const u=await this.getUrl(e)+n;e.enter(),s.Logger.logInfo(l,`Sending POST request to ${u}`);const d=a.map(e=>o.ECJsonTypeMap.toJson("wsg",e)),h={method:"POST",headers:{authorization:r.toTokenString()},body:{instances:d}};c&&(h.body.requestOptions=c),await this.setupOptionDefaults(h),e.enter();const p=await i.request(e,u,h);if(e.enter(),!p.body||!p.body.changedInstances)return Promise.reject(new Error(`POST to URL ${u} executed successfully, but did not return the expected result.`));const f=p.body.changedInstances.map(e=>{const r=e.instanceAfterChange;if(!r)throw new Error(`POST to URL ${u} executed successfully, but could not convert response to a strongly typed instance.`);const n=o.ECJsonTypeMap.fromJson(t,"wsg",r);if(!n)throw new Error(`POST to URL ${u} executed successfully, but could not convert response to a strongly typed instance.`);return n});return s.Logger.logTrace(l,`Successful POST request to ${u}`),Promise.resolve(f)}async getInstances(e,t,r,n,a){e.enter();const c=await this.getUrl(e)+n;e.enter(),s.Logger.logInfo(l,`Sending GET request to ${c}`);const u={method:"GET",headers:{authorization:r.toTokenString()},qs:a,accept:"application/json"};await this.setupOptionDefaults(u),e.enter();const d=await i.request(e,c,u);if(e.enter(),!d.body||!d.body.hasOwnProperty("instances"))return Promise.reject(new Error(`Query to URL ${c} executed successfully, but did NOT return any instances.`));const h=new Array;for(const i of d.body.instances){const e=o.ECJsonTypeMap.fromJson(t,"wsg",i);e&&h.push(e)}return s.Logger.logTrace(l,`Successful GET request to ${c}`),Promise.resolve(h)}getQueryRequestBody(e){const t=(e,t,r)=>(""!==e&&(e+="&"),e+=`${t}=${r}`);let r="";return e.$filter&&(r=t(r,"$filter",e.$filter)),e.$orderby&&(r=t(r,"$orderby",e.$orderby)),e.$select&&(r=t(r,"$select",e.$select)),e.$skip&&(r=t(r,"$skip",e.$skip.toString(10))),e.$top&&(r=t(r,"$top",e.$top.toString(10))),r}async postQuery(e,t,r,n,a){e.enter();const c=`${await this.getUrl(e)}${n}$query`;e.enter(),s.Logger.logInfo(l,`Sending POST request to ${c}`);const u={method:"POST",headers:{authorization:r.toTokenString()},body:this.getQueryRequestBody(a)};await this.setupOptionDefaults(u),e.enter();const d=await i.request(e,c,u);if(e.enter(),!d.body||!d.body.hasOwnProperty("instances"))return Promise.reject(new Error(`Query to URL ${c} executed successfully, but did NOT return any instances.`));const h=new Array;for(const i of d.body.instances){const e=o.ECJsonTypeMap.fromJson(t,"wsg",i);e&&h.push(e)}return s.Logger.logTrace(l,`Successful POST request to ${c}`),Promise.resolve(h)}}WsgClient.configHostRelyingPartyUri="imjs_default_relying_party_uri",WsgClient.configUseHostRelyingPartyUriAsFallback="imjs_use_default_relying_party_uri_as_fallback",t.WsgClient=WsgClient},function(e,t,r){(function(e){function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"===typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"===typeof e},t.isString=function(e){return"string"===typeof e},t.isSymbol=function(e){return"symbol"===typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){return"object"===typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"===typeof e},t.isPrimitive=function(e){return null===e||"boolean"===typeof e||"number"===typeof e||"string"===typeof e||"symbol"===typeof e||"undefined"===typeof e},t.isBuffer=e.isBuffer}).call(this,r(36).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(6),o=r(9),s=r(10),a=r(19);class Matrix4d{constructor(){this._coffs=new Float64Array(16)}setFrom(e){for(let t=0;t<16;t++)this._coffs[t]=e._coffs[t]}clone(){const e=new Matrix4d;for(let t=0;t<16;t++)e._coffs[t]=this._coffs[t];return e}setZero(){for(let e=0;e<16;e++)this._coffs[e]=0}setIdentity(){for(let e=0;e<16;e++)this._coffs[e]=0;this._coffs[0]=this._coffs[5]=this._coffs[10]=this._coffs[15]=1}static is1000(e,t,r,n,i){return Math.abs(e-1)<=i&&Math.abs(t)<=i&&Math.abs(r)<=i&&Math.abs(n)<=i}isIdentity(e=1e-10){return Matrix4d.is1000(this._coffs[0],this._coffs[1],this._coffs[2],this._coffs[3],e)&&Matrix4d.is1000(this._coffs[5],this._coffs[6],this._coffs[7],this._coffs[4],e)&&Matrix4d.is1000(this._coffs[10],this._coffs[11],this._coffs[8],this._coffs[9],e)&&Matrix4d.is1000(this._coffs[15],this._coffs[12],this._coffs[13],this._coffs[14],e)}static createZero(e){return e?(e.setZero(),e):new Matrix4d}static createRowValues(e,t,r,n,i,o,s,a,c,l,u,d,h,p,f,g,m){return(m=m||new Matrix4d)._coffs[0]=e,m._coffs[1]=t,m._coffs[2]=r,m._coffs[3]=n,m._coffs[4]=i,m._coffs[5]=o,m._coffs[6]=s,m._coffs[7]=a,m._coffs[8]=c,m._coffs[9]=l,m._coffs[10]=u,m._coffs[11]=d,m._coffs[12]=h,m._coffs[13]=p,m._coffs[14]=f,m._coffs[15]=g,m}setOriginAndVectors(e,t,r,n){this._coffs[0]=t.x,this._coffs[1]=r.x,this._coffs[2]=n.x,this._coffs[3]=e.x,this._coffs[4]=t.y,this._coffs[5]=r.y,this._coffs[6]=n.y,this._coffs[7]=e.y,this._coffs[8]=t.z,this._coffs[9]=r.z,this._coffs[10]=n.z,this._coffs[11]=e.z,this._coffs[12]=0,this._coffs[13]=0,this._coffs[14]=0,this._coffs[15]=1}static createTransform(e,t){const r=e.matrix,n=e.origin;return Matrix4d.createRowValues(r.coffs[0],r.coffs[1],r.coffs[2],n.x,r.coffs[3],r.coffs[4],r.coffs[5],n.y,r.coffs[6],r.coffs[7],r.coffs[8],n.z,0,0,0,1,t)}static createIdentity(e){return(e=Matrix4d.createZero(e))._coffs[0]=1,e._coffs[5]=1,e._coffs[10]=1,e._coffs[15]=1,e}static createTranslationXYZ(e,t,r,n){return(n=Matrix4d.createZero(n))._coffs[0]=1,n._coffs[5]=1,n._coffs[10]=1,n._coffs[15]=1,n._coffs[3]=e,n._coffs[7]=t,n._coffs[11]=r,n}static createTranslationAndScaleXYZ(e,t,r,n,i,o,s){return Matrix4d.createRowValues(n,0,0,e,0,i,0,t,0,0,o,r,0,0,0,1,s)}static createBoxToBox(e,t,r,i,o){const s=t.x-e.x,a=t.y-e.y,c=t.z-e.z,l=i.x-r.x,u=i.y-r.y,d=i.z-r.z,h=n.Geometry.conditionalDivideFraction(l,s),p=n.Geometry.conditionalDivideFraction(u,a),f=n.Geometry.conditionalDivideFraction(d,c);if(void 0!==h&&void 0!==p&&void 0!==f)return Matrix4d.createTranslationAndScaleXYZ(r.x-h*e.x,r.y-p*e.y,r.z-f*e.z,h,p,f,o)}setFromJSON(e){if(n.Geometry.isArrayOfNumberArray(e,4,4))for(let t=0;t<4;++t)for(let r=0;r<4;++r)this._coffs[4*t+r]=e[t][r];else this.setZero()}maxDiff(e){let t=0;for(let r=0;r<16;r++)t=Math.max(t,Math.abs(this._coffs[r]-e._coffs[r]));return t}maxAbs(){let e=0;for(let t=0;t<16;t++)e=Math.max(e,Math.abs(this._coffs[t]));return e}isAlmostEqual(e){return n.Geometry.isSmallMetricDistance(this.maxDiff(e))}toJSON(){const e=[];for(let t=0;t<4;++t){const r=4*t;e.push([this._coffs[r],this._coffs[r+1],this._coffs[r+2],this._coffs[r+3]])}return e}static fromJSON(e){const t=new Matrix4d;return t.setFromJSON(e),t}getSteppedPoint(e,t,r){return a.Point4d.create(this._coffs[e],this._coffs[e+t],this._coffs[e+2*t],this._coffs[e+3*t],r)}columnX(){return this.getSteppedPoint(0,4)}columnY(){return this.getSteppedPoint(1,4)}columnZ(){return this.getSteppedPoint(2,4)}columnW(){return this.getSteppedPoint(3,4)}rowX(){return this.getSteppedPoint(0,1)}rowY(){return this.getSteppedPoint(4,1)}rowZ(){return this.getSteppedPoint(8,1)}rowW(){return this.getSteppedPoint(12,1)}get hasPerspective(){return 0!==this._coffs[12]||0!==this._coffs[13]||0!==this._coffs[14]||1!==this._coffs[15]}diagonal(){return this.getSteppedPoint(0,5)}weight(){return this._coffs[15]}matrixPart(){return s.Matrix3d.createRowValues(this._coffs[0],this._coffs[1],this._coffs[2],this._coffs[4],this._coffs[5],this._coffs[6],this._coffs[8],this._coffs[9],this._coffs[10])}get asTransform(){if(!this.hasPerspective)return o.Transform.createRowValues(this._coffs[0],this._coffs[1],this._coffs[2],this._coffs[3],this._coffs[4],this._coffs[5],this._coffs[6],this._coffs[7],this._coffs[8],this._coffs[9],this._coffs[10],this._coffs[11])}multiplyMatrixMatrix(e,t){t=t&&t!==this&&t!==e?t:new Matrix4d;for(let r=0;r<16;r+=4)for(let n=0;n<4;n++)t._coffs[r+n]=this._coffs[r]*e._coffs[n]+this._coffs[r+1]*e._coffs[n+4]+this._coffs[r+2]*e._coffs[n+8]+this._coffs[r+3]*e._coffs[n+12];return t}multiplyMatrixMatrixTranspose(e,t){t=t&&t!==this&&t!==e?t:new Matrix4d;let r=0;for(let n=0;n<16;n+=4)for(let i=0;i<16;i+=4)t._coffs[r++]=this._coffs[n]*e._coffs[i]+this._coffs[n+1]*e._coffs[i+1]+this._coffs[n+2]*e._coffs[i+2]+this._coffs[n+3]*e._coffs[i+3];return t}multiplyMatrixTransposeMatrix(e,t){t=t&&t!==this&&t!==e?t:new Matrix4d;let r=0;for(let n=0;n<4;n+=1)for(let i=0;i<4;i+=1)t._coffs[r++]=this._coffs[n]*e._coffs[i]+this._coffs[n+4]*e._coffs[i+4]+this._coffs[n+8]*e._coffs[i+8]+this._coffs[n+12]*e._coffs[i+12];return t}cloneTransposed(e){return Matrix4d.createRowValues(this._coffs[0],this._coffs[4],this._coffs[8],this._coffs[12],this._coffs[1],this._coffs[5],this._coffs[9],this._coffs[13],this._coffs[2],this._coffs[6],this._coffs[10],this._coffs[14],this._coffs[3],this._coffs[7],this._coffs[11],this._coffs[15],e)}multiplyXYZW(e,t,r,n,i){return(i=i||a.Point4d.createZero()).set(this._coffs[0]*e+this._coffs[1]*t+this._coffs[2]*r+this._coffs[3]*n,this._coffs[4]*e+this._coffs[5]*t+this._coffs[6]*r+this._coffs[7]*n,this._coffs[8]*e+this._coffs[9]*t+this._coffs[10]*r+this._coffs[11]*n,this._coffs[12]*e+this._coffs[13]*t+this._coffs[14]*r+this._coffs[15]*n)}multiplyBlockedFloat64ArrayInPlace(e){const t=e.length;let r,n,i,o;for(let s=0;s+3<t;s+=4)r=e[s],n=e[s+1],i=e[s+2],o=e[s+3],e[s]=this._coffs[0]*r+this._coffs[1]*n+this._coffs[2]*i+this._coffs[3]*o,e[s+1]=this._coffs[4]*r+this._coffs[5]*n+this._coffs[6]*i+this._coffs[7]*o,e[s+2]=this._coffs[8]*r+this._coffs[9]*n+this._coffs[10]*i+this._coffs[11]*o,e[s+3]=this._coffs[12]*r+this._coffs[13]*n+this._coffs[14]*i+this._coffs[15]*o}multiplyPoint3d(e,t,r){return this.multiplyXYZW(e.x,e.y,e.z,t,r)}multiplyPoint3dArray(e,t,r=1){e.forEach((e,n)=>{t[n]=this.multiplyXYZW(e.x,e.y,e.z,r,t[n])})}multiplyTransposeXYZW(e,t,r,n,i){return(i=i||a.Point4d.createZero()).set(this._coffs[0]*e+this._coffs[4]*t+this._coffs[8]*r+this._coffs[12]*n,this._coffs[1]*e+this._coffs[5]*t+this._coffs[9]*r+this._coffs[13]*n,this._coffs[2]*e+this._coffs[6]*t+this._coffs[10]*r+this._coffs[14]*n,this._coffs[3]*e+this._coffs[7]*t+this._coffs[11]*r+this._coffs[15]*n)}rowDotColumn(e,t,r){const n=4*e,i=r;return this._coffs[n]*t._coffs[i]+this._coffs[n+1]*t._coffs[i+4]+this._coffs[n+2]*t._coffs[i+8]+this._coffs[n+3]*t._coffs[i+12]}rowDotRow(e,t,r){const n=4*e,i=4*r;return this._coffs[n]*t._coffs[i]+this._coffs[n+1]*t._coffs[i+1]+this._coffs[n+2]*t._coffs[i+2]+this._coffs[n+3]*t._coffs[i+3]}columnDotColumn(e,t,r){const n=e,i=r;return this._coffs[n]*t._coffs[i]+this._coffs[n+4]*t._coffs[i+4]+this._coffs[n+8]*t._coffs[i+8]+this._coffs[n+12]*t._coffs[i+12]}columnDotRow(e,t,r){const n=e,i=4*r;return this._coffs[n]*t._coffs[i]+this._coffs[n+4]*t._coffs[i+1]+this._coffs[n+8]*t._coffs[i+2]+this._coffs[n+12]*t._coffs[i+3]}atIJ(e,t){return this._coffs[4*e+t]}multiplyXYZWQuietRenormalize(e,t,r,o,s){(s=s||i.Point3d.createZero()).set(this._coffs[0]*e+this._coffs[1]*t+this._coffs[2]*r+this._coffs[3]*o,this._coffs[4]*e+this._coffs[5]*t+this._coffs[6]*r+this._coffs[7]*o,this._coffs[8]*e+this._coffs[9]*t+this._coffs[10]*r+this._coffs[11]*o);const a=this._coffs[12]*e+this._coffs[13]*t+this._coffs[14]*r+this._coffs[15]*o;if(!n.Geometry.isSmallMetricDistance(a)){const e=1/a;s.x*=e,s.y*=e,s.z*=e}return s}multiplyPoint4dArrayQuietRenormalize(e,t){e.forEach((e,r)=>{t[r]=this.multiplyXYZWQuietRenormalize(e.x,e.y,e.z,e.w,t[r])})}multiplyPoint4d(e,t){return this.multiplyXYZW(e.xyzw[0],e.xyzw[1],e.xyzw[2],e.xyzw[3],t)}multiplyTransposePoint4d(e,t){return this.multiplyTransposeXYZW(e.xyzw[0],e.xyzw[1],e.xyzw[2],e.xyzw[3],t)}multiplyPoint3dQuietNormalize(e,t){return this.multiplyXYZWQuietRenormalize(e.x,e.y,e.z,1,t)}multiplyPoint3dArrayQuietNormalize(e){e.forEach(e=>this.multiplyXYZWQuietRenormalize(e.x,e.y,e.z,1,e))}addMomentsInPlace(e,t,r,n){this._coffs[0]+=e*e,this._coffs[1]+=e*t,this._coffs[2]+=e*r,this._coffs[3]+=e*n,this._coffs[4]+=t*e,this._coffs[5]+=t*t,this._coffs[6]+=t*r,this._coffs[7]+=t*n,this._coffs[8]+=r*e,this._coffs[9]+=r*t,this._coffs[10]+=r*r,this._coffs[11]+=r*n,this._coffs[12]+=n*e,this._coffs[13]+=n*t,this._coffs[14]+=n*r,this._coffs[15]+=n*n}addScaledInPlace(e,t=1){for(let r=0;r<16;r++)this._coffs[r]+=t*e._coffs[r]}rowOperation(e,t,r,n){if(0===n)return;let i=4*e+r,o=4*t+r;for(let s=r;s<4;s++,i++,o++)this._coffs[o]+=n*this._coffs[i]}createInverse(){const e=this.clone(),t=Matrix4d.createIdentity();let r,i,o,s;for(i=0;i<3;i++){if(r=5*i,o=e._coffs[r],void 0===(s=n.Geometry.conditionalDivideFraction(1,o)))return;let a=r+4;for(let r=i+1;r<4;r++,a+=4){const n=-e._coffs[a]*s;e.rowOperation(i,r,i,n),t.rowOperation(i,r,0,n)}}for(i=1;i<4;i++){if(r=5*i,o=e._coffs[r],void 0===(s=n.Geometry.conditionalDivideFraction(1,o)))return;let a=i;for(let r=0;r<i;r++,a+=4){const n=-e._coffs[a]*s;e.rowOperation(i,r,i,n),t.rowOperation(i,r,0,n)}}return t.scaleRowsInPlace(1/e._coffs[0],1/e._coffs[5],1/e._coffs[10],1/e._coffs[15]),t}rowArrays(e){return e?[[e(this._coffs[0]),e(this._coffs[1]),e(this._coffs[2]),e(this._coffs[3])],[e(this._coffs[4]),e(this._coffs[5]),e(this._coffs[6]),e(this._coffs[7])],[e(this._coffs[8]),e(this._coffs[9]),e(this._coffs[10]),e(this._coffs[11])],[e(this._coffs[12]),e(this._coffs[13]),e(this._coffs[14]),e(this._coffs[15])]]:[[this._coffs[0],this._coffs[1],this._coffs[2],this._coffs[3]],[this._coffs[4],this._coffs[5],this._coffs[6],this._coffs[7]],[this._coffs[8],this._coffs[9],this._coffs[10],this._coffs[11]],[this._coffs[12],this._coffs[13],this._coffs[14],this._coffs[15]]]}scaleRowsInPlace(e,t,r,n){for(let i=0;i<4;i++)this._coffs[i]*=e;for(let i=4;i<8;i++)this._coffs[i]*=t;for(let i=8;i<12;i++)this._coffs[i]*=r;for(let i=12;i<16;i++)this._coffs[i]*=n}}t.Matrix4d=Matrix4d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(23),o=r(21),s=r(22),a=r(38),c=r(49),l=r(5),u=r(124),d=r(24),h=r(253),p=r(453),f=r(256),g=r(59),m=r(255),y=r(19);class BSplineCurve3dBase extends a.CurvePrimitive{constructor(e,t,r,n){super(),this._bcurve=f.BSpline1dNd.create(t,e,r,n)}get degree(){return this._bcurve.degree}get order(){return this._bcurve.order}get numSpan(){return this._bcurve.numSpan}get numPoles(){return this._bcurve.numPoles}copyKnots(e){return this._bcurve.knots.copyKnots(e)}setWrappable(e){this._bcurve.knots.wrappable=e}fractionToPoint(e,t){return this.knotToPoint(this._bcurve.knots.fractionToKnot(e),t)}fractionToPointAndDerivative(e,t){const r=this._bcurve.knots.fractionToKnot(e);return(t=this.knotToPointAndDerivative(r,t)).direction.scaleInPlace(this._bcurve.knots.knotLength01),t}fractionToPointAnd2Derivatives(e,t){const r=this._bcurve.knots.fractionToKnot(e);t=this.knotToPointAnd2Derivatives(r,t);const n=this._bcurve.knots.knotLength01;return t.vectorU.scaleInPlace(n),t.vectorV.scaleInPlace(n*n),t}startPoint(){return this.evaluatePointInSpan(0,0)}endPoint(){return this.evaluatePointInSpan(this.numSpan-1,1)}reverseInPlace(){this._bcurve.reverseInPlace()}collectBezierSpans(e){const t=[],r=this.numSpan;for(let n=0;n<r;n++)if(this._bcurve.knots.isIndexOfRealSpan(n)){const r=this.getSaturatedBezierSpan3dOr3dH(n,e);r&&t.push(r)}return t}poleIndexToDataIndex(e){if(e>=0&&e<this.numPoles)return e*this._bcurve.poleLength}closestPoint(e,t){const r=this.fractionToPoint(0),n=c.CurveLocationDetail.createCurveFractionPointDistance(this,0,r,r.distance(e));let i;this.fractionToPoint(1,r),n.updateIfCloserCurveFractionPointDistance(this,1,e,e.distance(r));const o=this.numSpan;for(let s=0;s<o;s++)this._bcurve.knots.isIndexOfRealSpan(s)&&(i=this.getSaturatedBezierSpan3dOr3dH(s,!0,i))&&i.updateClosestPointByTruePerpendicular(e,n)&&(n.curve=this,n.fraction=i.fractionToParentFraction(n.fraction));return n}appendPlaneIntersectionPoints(e,t){const r=this.numPoles,n=this.order,o=new Float64Array(r),s=this.numSpan,a=y.Point4d.create(),u=i.Range1d.createNull();for(let i=0;i<r;i++)o[i]=e.weightedAltitude(this.getPolePoint4d(i,a)),u.extendX(o[i]);let d,h=0,p=-1e3;if(u.containsX(0))for(let i=0;i<s;i++)if(this._bcurve.knots.isIndexOfRealSpan(i)&&(u.setNull(),u.extendArraySubset(o,i,n),u.containsX(0))){d=g.UnivariateBezier.createArraySubset(o,i,n,d),m.Bezier1dNd.saturate1dInPlace(d.coffs,this._bcurve.knots,i);const e=d.roots(0,!0);if(e)for(const r of e){h++;const e=this._bcurve.knots.spanFractionToFraction(i,r);if(!l.Geometry.isAlmostEqualNumber(e,p)){const r=c.CurveLocationDetail.createCurveEvaluatedFraction(this,e);t.push(r),p=e}}}return h}}t.BSplineCurve3dBase=BSplineCurve3dBase;class BSplineCurve3d extends BSplineCurve3dBase{initializeWorkBezier(){return void 0===this._workBezier&&(this._workBezier=h.BezierCurve3dH.createOrder(this.order)),this._workBezier}isSameGeometryClass(e){return e instanceof BSplineCurve3d}tryTransformInPlace(e){return d.Point3dArray.multiplyInPlace(e,this._bcurve.packedData),!0}getPolePoint3d(e,t){const r=this.poleIndexToDataIndex(e);if(void 0!==r){const e=this._bcurve.packedData;return n.Point3d.create(e[r],e[r+1],e[r+2],t)}}getPolePoint4d(e,t){const r=this.poleIndexToDataIndex(e);if(void 0!==r){const e=this._bcurve.packedData;return y.Point4d.create(e[r],e[r+1],e[r+2],1,t)}}spanFractionToKnot(e,t){return this._bcurve.spanFractionToKnot(e,t)}constructor(e,t,r){super(3,e,t,r)}copyPoints(){return d.Point3dArray.unpackNumbersToNestedArrays(this._bcurve.packedData,3)}copyPointsFloat64Array(){return this._bcurve.packedData.slice()}copyKnots(e){return this._bcurve.knots.copyKnots(e)}static createUniformKnots(e,t){const r=e.length;if(t<1||r<t)return;const n=u.KnotVector.createUniformClamped(e.length,t-1,0,1),i=new BSplineCurve3d(e.length,t,n);let o=0;for(const s of e)i._bcurve.packedData[o++]=s.x,i._bcurve.packedData[o++]=s.y,i._bcurve.packedData[o++]=s.z;return i}static create(e,t,r){let n=e.length;e instanceof Float64Array&&(n/=3);const i=n+r===t.length;if(r<1||n<r)return;const o=u.KnotVector.create(t,r-1,i),s=new BSplineCurve3d(n,r,o);if(e instanceof Float64Array){let t=0;for(const r of e)s._bcurve.packedData[t++]=r}else{let t=0;for(const r of e)s._bcurve.packedData[t++]=r.x,s._bcurve.packedData[t++]=r.y,s._bcurve.packedData[t++]=r.z}return s}clone(){const e=this._bcurve.knots.clone(),t=new BSplineCurve3d(this.numPoles,this.order,e);return t._bcurve.packedData=this._bcurve.packedData.slice(),t}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}evaluatePointInSpan(e,t){return this._bcurve.evaluateBuffersInSpan(e,t),n.Point3d.createFrom(this._bcurve.poleBuffer)}evaluatePointAndTangentInSpan(e,t){return this._bcurve.evaluateBuffersInSpan1(e,t),o.Ray3d.createCapture(n.Point3d.createFrom(this._bcurve.poleBuffer),n.Vector3d.createFrom(this._bcurve.poleBuffer1))}knotToPoint(e,t){return this._bcurve.evaluateBuffersAtKnot(e),n.Point3d.createFrom(this._bcurve.poleBuffer,t)}knotToPointAndDerivative(e,t){return this._bcurve.evaluateBuffersAtKnot(e,1),t?(t.origin.setFrom(this._bcurve.poleBuffer),t.direction.setFrom(this._bcurve.poleBuffer1),t):o.Ray3d.createCapture(n.Point3d.createFrom(this._bcurve.poleBuffer),n.Vector3d.createFrom(this._bcurve.poleBuffer1))}knotToPointAnd2Derivatives(e,t){return this._bcurve.evaluateBuffersAtKnot(e,2),s.Plane3dByOriginAndVectors.createOriginAndVectorsXYZ(this._bcurve.poleBuffer[0],this._bcurve.poleBuffer[1],this._bcurve.poleBuffer[2],this._bcurve.poleBuffer1[0],this._bcurve.poleBuffer1[1],this._bcurve.poleBuffer1[2],this._bcurve.poleBuffer2[0],this._bcurve.poleBuffer2[1],this._bcurve.poleBuffer2[2],t)}fractionToPoint(e,t){return this.knotToPoint(this._bcurve.knots.fractionToKnot(e),t)}fractionToPointAndDerivative(e,t){const r=this._bcurve.knots.fractionToKnot(e);return(t=this.knotToPointAndDerivative(r,t)).direction.scaleInPlace(this._bcurve.knots.knotLength01),t}fractionToPointAnd2Derivatives(e,t){const r=this._bcurve.knots.fractionToKnot(e);t=this.knotToPointAnd2Derivatives(r,t);const n=this._bcurve.knots.knotLength01;return t.vectorU.scaleInPlace(n),t.vectorV.scaleInPlace(n*n),t}isAlmostEqual(e){return e instanceof BSplineCurve3d&&(this._bcurve.knots.isAlmostEqual(e._bcurve.knots)&&d.Point3dArray.isAlmostEqual(this._bcurve.packedData,e._bcurve.packedData))}isInPlane(e){return d.Point3dArray.isCloseToPlane(this._bcurve.packedData,e)}quickLength(){return d.Point3dArray.sumLengths(this._bcurve.packedData)}emitStrokableParts(e,t){const r=void 0!==e.announceBezierCurve,n=this.initializeWorkBezier(),i=this.numSpan;let o;for(let s=0;s<i;s++){const i=this.getSaturatedBezierSpan3dOr3dH(s,!1,n);i&&(o=i.strokeCount(t),r?e.announceBezierCurve(i,o,this,s,this._bcurve.knots.spanFractionToFraction(s,0),this._bcurve.knots.spanFractionToFraction(s,1)):e.announceIntervalForUniformStepStrokes(this,o,this._bcurve.knots.spanFractionToFraction(s,0),this._bcurve.knots.spanFractionToFraction(s,1)))}}emitStrokes(e,t){const r=this.initializeWorkBezier(),n=this.numSpan;for(let i=0;i<n;i++){const n=this.getSaturatedBezierSpan3dH(i,r);n&&n.emitStrokes(e,t)}}get isClosable(){if(!this._bcurve.knots.wrappable)return!1;const e=this.degree,t=this._bcurve.knots.leftKnotIndex,r=this._bcurve.knots.rightKnotIndex,n=this._bcurve.knots.rightKnot-this._bcurve.knots.leftKnot,i=r-t;for(let s=t-e+1;s<t+e-1;s++){const e=s+i;if(!l.Geometry.isSameCoordinate(this._bcurve.knots.knots[s]+n,this._bcurve.knots.knots[e]))return!1}const o=this.numPoles-this.degree;for(let s=0;s+1<e;s++){const e=s+o;if(!l.Geometry.isSamePoint3d(this.getPolePoint3d(s),this.getPolePoint3d(e)))return!1}return!0}getSaturatedBezierSpan3dOr3dH(e,t,r){return t?this.getSaturatedBezierSpan3dH(e,r):this.getSaturatedBezierSpan3d(e,r)}getSaturatedBezierSpan3d(e,t){if(e<0||e>=this.numSpan)return;const r=this.order;void 0!==t&&t instanceof p.BezierCurve3d&&t.order===r||(t=p.BezierCurve3d.createOrder(r));const n=t;return n.loadSpanPoles(this._bcurve.packedData,e),n.saturateInPlace(this._bcurve.knots,e),t}getSaturatedBezierSpan3dH(e,t){if(e<0||e>=this.numSpan)return;const r=this.order;void 0!==t&&t instanceof h.BezierCurve3dH&&t.order===r||(t=h.BezierCurve3dH.createOrder(r));const n=t;return n.loadSpan3dPolesWithWeight(this._bcurve.packedData,e,1),n.saturateInPlace(this._bcurve.knots,e),n}setWrappable(e){this._bcurve.knots.wrappable=e}dispatchToGeometryHandler(e){return e.handleBSplineCurve3d(this)}extendRange(e,t){const r=this._bcurve.packedData,n=r.length-2;if(t)for(let i=0;i<n;i+=3)e.extendTransformedXYZ(t,r[i],r[i+1],r[i+2]);else for(let i=0;i<n;i+=3)e.extendXYZ(r[i],r[i+1],r[i+2])}}t.BSplineCurve3d=BSplineCurve3d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class GeometryHandler{handleCurveCollection(e){}handlePath(e){return this.handleCurveCollection(e)}handleLoop(e){return this.handleCurveCollection(e)}handleParityRegion(e){return this.handleCurveCollection(e)}handleUnionRegion(e){return this.handleCurveCollection(e)}handleBagOfCurves(e){return this.handleCurveCollection(e)}}t.GeometryHandler=GeometryHandler;t.NullGeometryHandler=class NullGeometryHandler extends GeometryHandler{handleLineSegment3d(e){}handleLineString3d(e){}handleArc3d(e){}handleCurveCollection(e){}handleBSplineCurve3d(e){}handleBSplineCurve3dH(e){}handleBSplineSurface3d(e){}handleCoordinateXYZ(e){}handleBSplineSurface3dH(e){}handleIndexedPolyface(e){}handleTransitionSpiral(e){}handlePath(e){}handleLoop(e){}handleParityRegion(e){}handleUnionRegion(e){}handleBagOfCurves(e){}handleSphere(e){}handleCone(e){}handleBox(e){}handleTorusPipe(e){}handleLinearSweep(e){}handleRotationalSweep(e){}handleRuledSweep(e){}handlePointString3d(e){}handleBezierCurve3d(e){}handleBezierCurve3dH(e){}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(42),i=r(40),o=r(62),s=r(73),a=r(52),c=r(43),l=r(15);class RpcControlResponse{}t.RpcControlResponse=RpcControlResponse;t.RpcPendingResponse=class RpcPendingResponse extends RpcControlResponse{constructor(e=""){super(),this.message=e}};t.RpcNotFoundResponse=class RpcNotFoundResponse extends RpcControlResponse{};class RpcControlChannel{constructor(e){var t;this._initialized=!1,this._clientActive=!1,this._describeEndpoints=void 0,this._channelInterface=((t=class extends n.RpcInterface{describeEndpoints(){return this.forward.apply(this,arguments)}}).version="CONTROL",t.types=(()=>[]),t),this._channelImpl=class extends n.RpcInterface{describeEndpoints(){const e=[];return this.configuration.interfaces().forEach(t=>{if(!a.RpcRegistry.instance.isRpcInterfaceInitialized(t))return;const r={interfaceName:t.name,interfaceVersion:t.version,operationNames:[],compatible:!0};s.RpcOperation.forEach(t,e=>r.operationNames.push(e.operationName)),e.push(r)}),Promise.resolve(e)}},this._configuration=e,RpcControlChannel.channels.push(this)}describeEndpoints(){return this.activateClient(),this._describeEndpoints()}static obtain(e){if(RpcControlChannel._obtainLock)return;++RpcControlChannel._obtainLock;const t=new RpcControlChannel(e);return--RpcControlChannel._obtainLock,t}computeId(){const t=[];this._configuration.interfaces().forEach(e=>t.push(`${e.name}@${e.version}`));const r=t.sort().join(",");return"undefined"!==typeof btoa?btoa(r):"undefined"!==typeof e?e.from(r,"binary").toString("base64"):r}activateClient(){if(this._clientActive)return;if(!this._initialized){if(this._configuration.interfaces().length)throw new l.IModelError(32768,"Invalid state.");this.initialize()}this._clientActive=!0,s.RpcOperation.forEach(this._channelInterface,e=>e.policy.token=(e=>s.RpcOperation.fallbackToken||new c.IModelToken("none","none","none","none",void 0)));const e=i.RpcManager.getClientForInterface(this._channelInterface);this._describeEndpoints=(()=>e.describeEndpoints())}initialize(){if(this._initialized)throw new l.IModelError(32768,"Already initialized.");this._initialized=!0;const e=this.computeId();Object.defineProperty(this._channelInterface,"name",{value:e}),Object.defineProperty(this._channelImpl,"name",{value:e}),o.RpcConfiguration.assign(this._channelInterface,()=>this._configuration.constructor),i.RpcManager.registerImpl(this._channelInterface,this._channelImpl),i.RpcManager.initializeInterface(this._channelInterface)}handleUnknownOperation(e,t){const r=e.request.operation;return"CONTROL"===r.interfaceVersion&&"describeEndpoints"===r.operationName&&(r.interfaceDefinition=this._channelInterface.name,!0)}}RpcControlChannel.channels=[],RpcControlChannel._obtainLock=0,t.RpcControlChannel=RpcControlChannel}).call(this,r(36).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(86),i=r(3),o=r(20),s=r(8),a=r(30),c=r(0);!function(e){e[e.Identify=0]="Identify",e[e.AutoLocate=1]="AutoLocate"}(t.LocateAction||(t.LocateAction={})),function(e){e[e.Accept=0]="Accept",e[e.Reject=1]="Reject"}(t.LocateFilterStatus||(t.LocateFilterStatus={})),function(e){e[e.Success=0]="Success",e[e.Aborted=1]="Aborted",e[e.NoElements=2]="NoElements",e[e.Disabled=100]="Disabled",e[e.NoSnapPossible=200]="NoSnapPossible",e[e.NotSnappable=300]="NotSnappable",e[e.ModelNotSnappable=301]="ModelNotSnappable",e[e.FilteredByCategory=400]="FilteredByCategory",e[e.FilteredByUser=500]="FilteredByUser",e[e.FilteredByApp=600]="FilteredByApp",e[e.FilteredByAppQuietly=700]="FilteredByAppQuietly"}(t.SnapStatus||(t.SnapStatus={}));class LocateOptions{constructor(){this.allowDecorations=!1,this.maxHits=20,this.hitSource=5}clone(){const e=new LocateOptions;return e.allowDecorations=this.allowDecorations,e.maxHits=this.maxHits,e.hitSource=this.hitSource,e}init(){this.allowDecorations=!1,this.maxHits=20,this.hitSource=5}}t.LocateOptions=LocateOptions;class LocateResponse{constructor(){this.snapStatus=0,this.explanation=""}}t.LocateResponse=LocateResponse;class ElementPicker{constructor(){this.pickPointWorld=new i.Point3d}empty(){this.pickPointWorld.setZero(),this.viewport=void 0,this.hitList?this.hitList.empty():this.hitList=new n.HitList}getHitList(e){const t=this.hitList;return e&&(this.hitList=void 0),t}getNextHit(){return this.hitList?this.hitList.getNextHit():void 0}getHit(e){return this.hitList?this.hitList.getHit(e):void 0}resetCurrentHit(){this.hitList&&this.hitList.resetCurrentHit()}getPixelPriority(e){switch(e.type){case 2:return 2===e.planarity?4:5;case 3:return 0;case 4:return 2===e.planarity?1:2;case 5:return 3;default:return 6}}comparePixel(e,t,r,n){const i=this.getPixelPriority(e),o=this.getPixelPriority(t);return i<o?-1:i>o?1:r<n?-1:r>n?1:e.distanceFraction>t.distanceFraction?-1:e.distanceFraction<t.distanceFraction?1:0}doPick(e,t,r,s){if(this.hitList&&this.hitList.length>0&&e===this.viewport&&t.isAlmostEqual(this.pickPointWorld))return this.hitList.resetCurrentHit(),this.hitList.length;this.empty(),this.viewport=e,this.pickPointWorld.setFrom(t);const a=e.worldToView(t),l=new i.Point2d(Math.floor(a.x+.5),Math.floor(a.y+.5)),u=Math.floor(r+.5),d=new o.ViewRect(l.x-u,l.y-u,l.x+u,l.y+u),h=e.readPixels(d,7);if(void 0===h)return 0;const p=new Map,f=i.Point2d.createZero();for(f.x=l.x-u;f.x<=l.x+u;++f.x)for(f.y=l.y-u;f.y<=l.y+u;++f.y){const e=h.getPixel(f.x,f.y);if(void 0===e||void 0===e.elementId||c.Id64.isInvalid(e.elementId))continue;const t=l.distance(f);if(t>u)continue;const r=p.get(e.elementId.toString());void 0!==r?this.comparePixel(e,h.getPixel(r.x,r.y),t,l.distance(r))<0&&r.setFrom(f):p.set(e.elementId.toString(),f.clone())}if(0===p.size)return 0;for(const i of p.values()){const r=h.getPixel(i.x,i.y);if(void 0===r||void 0===r.elementId)continue;const o=e.getPixelDataWorldPoint(h,i.x,i.y);if(void 0===o)continue;const a=new n.HitDetail(t,e,s.hitSource,o,r.elementId.toString(),this.getPixelPriority(r),l.distance(i),r.distanceFraction);this.hitList.addHit(a),this.hitList.hits.length>s.maxHits&&(this.hitList.hits.length=s.maxHits)}return this.hitList.length}testHit(e,t,r,n,i){return 0!==this.doPick(t,r,n,i)&&this.hitList.hits.some(t=>e.isSameHit(t))}}t.ElementPicker=ElementPicker;class ElementLocateManager{constructor(){this.options=new LocateOptions,this.picker=new ElementPicker}static getFailureMessageKey(e){return"LocateFailure."+e}onInitialized(){}get apertureInches(){return.11}get touchApertureInches(){return.22}clear(){this.setCurrHit(void 0)}setHitList(e){this.hitList=e}setCurrHit(e){this.currHit=e}getNextHit(){return this.hitList?this.hitList.getNextHit():void 0}getPreLocatedHit(){let e=s.IModelApp.accuSnap.getHitAndList(this);if(!e&&(e=s.IModelApp.tentativePoint.getHitAndList(this))){const t=e.viewport;this.picker.empty(),this.picker.doPick(t,e.getPoint(),t.pixelsFromInches(this.apertureInches)/2+1.5,this.options),this.setHitList(this.picker.getHitList(!0))}return this.hitList&&this.hitList.resetCurrentHit(),e}async filterHit(e,t,r){if(!this.options.allowDecorations&&!e.isElementHit)return r.reason=ElementLocateManager.getFailureMessageKey("Transient"),1;const n=s.IModelApp.toolAdmin.activeTool;if(!(n&&n instanceof a.InteractiveTool))return 0;const i=await n.filterHit(e,r);return 1===i&&(r.reason=ElementLocateManager.getFailureMessageKey("ByCommand")),i}initLocateOptions(){this.options.init()}initToolLocate(){this.initLocateOptions(),this.clear(),this.picker.empty(),s.IModelApp.tentativePoint.clear(!0)}async _doLocate(e,t,r,n,i,o){if(!n)return;if(t){const t=this.getPreLocatedHit();if(t){if(!o||0===await this.filterHit(t,0,e))return t;e=new LocateResponse}this.picker.empty(),this.picker.doPick(n,r,n.pixelsFromInches(2===i?this.touchApertureInches:this.apertureInches)/2+1.5,this.options);const s=this.picker.getHitList(!0);this.setHitList(s)}let s;for(;void 0!==(s=this.getNextHit());){if(!o||0===await this.filterHit(s,0,e))return s;e=new LocateResponse}}async doLocate(e,t,r,n,i,o=!0){e.reason=ElementLocateManager.getFailureMessageKey("NoElements"),e.explanation="";const s=await this._doLocate(e,t,r,n,i,o);return this.setCurrHit(s),s&&this.hitList&&this.hitList.removeHitsFrom(s.sourceId),s}}t.ElementLocateManager=ElementLocateManager},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(3),o=r(4),s={maxPoints:50,maxRefs:25,maxDotsInRow:250,maxHorizon:500,dotTransparency:100,lineTransparency:200,planeTransparency:225};class RenderContext{constructor(e){this.viewport=e,this.viewFlags=e.viewFlags.clone(),this.frustum=e.getFrustum(),this.frustumPlanes=new o.FrustumPlanes(this.frustum)}getPixelSizeAtPoint(e){return this.viewport.viewFrustum.getPixelSizeAtPoint(e)}get target(){return this.viewport.target}createGraphicBuilder(e,t,r){return this.target.createGraphicBuilder(e,this.viewport,t,r)}createBranch(e,t,r){return this.target.renderSystem.createBranch(e,t,r)}}t.RenderContext=RenderContext;t.DynamicsContext=class DynamicsContext extends RenderContext{addGraphic(e){void 0===this._dynamics&&(this._dynamics=[]),this._dynamics.push(e)}changeDynamics(){this.viewport.changeDynamics(this._dynamics)}};class DecorateContext extends RenderContext{constructor(e,t){super(e),this._decorations=t,this.decorationDiv=e.decorationDiv}get screenViewport(){return this.viewport}static getGridDimension(e,t,r,n,i){let o=0,s=0;for(let c=0,l=i.length;c<l;++c){const e=r.vectorTo(i[c]).dotProduct(n);c?(e<o&&(o=e),e>s&&(s=e)):o=s=e}if(s<=o)return!1;e.min=Math.floor(o/t);const a=Math.ceil(s/t);return e.nRepetitions=a-e.min,e.min*=t,!0}static getGridPlaneViewIntersections(e,t,r,o){const s=i.Plane3dByOriginAndUnitNormal.create(e,t);if(void 0===s)return[];const a=r.getFrustum();if(o&&r.view.isSpatialView()){const e=r.view.iModel.projectExtents.clone();if(e.isNull)return[];if(e.intersect(a.toRange(),e),e.isNull)return[];a.initFromRange(e)}const c=new Array([0,4],[1,5],[2,6],[3,7],[0,1],[1,3],[3,2],[2,0],[4,5],[5,7],[7,6],[6,4]),l=[];for(let i=0,u=c.length;i<u;++i){const e=a.getCorner(c[i][0]),t=a.getCorner(c[i][1]);n.LineSegment3d.create(e,t).appendPlaneIntersectionPoints(s,l)}return l.map(e=>e.point.clone())}addDecorationFromBuilder(e){this.addDecoration(e.type,e.finish())}addDecoration(e,t){switch(e){case 1:void 0===this._decorations.normal&&(this._decorations.normal=[]),this._decorations.normal.push(t);break;case 2:this._decorations.world||(this._decorations.world=[]),this._decorations.world.push(t);break;case 3:this._decorations.worldOverlay||(this._decorations.worldOverlay=[]),this._decorations.worldOverlay.push(t);break;case 4:this._decorations.viewOverlay||(this._decorations.viewOverlay=[]),this._decorations.viewOverlay.push(t)}}addCanvasDecoration(e,t=!1){void 0===this._decorations.canvasDecorations&&(this._decorations.canvasDecorations=[]);const r=this._decorations.canvasDecorations;0===r.length||!0===t?r.push(e):r.unshift(e)}addHtmlDecoration(e){this.decorationDiv.appendChild(e)}drawStandardGrid(e,t,r,i,o=!1,a){const c=this.viewport,l=t.rowX(),u=t.rowY(),d=t.rowZ(),h=c.rotation.getRow(2);if(!c.isCameraOn&&Math.abs(h.dotProduct(d))<.005)return;const p=0===i?1:i,f=n.Vector2d.create(r.x,r.y).scale(p);let g=new n.Point3d,m=new n.Point2d;if(void 0===a||0===a.x||0===a.y){const t=DecorateContext.getGridPlaneViewIntersections(e,d,c,void 0!==a);if(t.length<3)return;const r=new n.Point2d,i={nRepetitions:m.x,min:r.x},o={nRepetitions:m.y,min:r.y};if(!DecorateContext.getGridDimension(i,f.x,e,n.Point3d.createFrom(l),t)||!DecorateContext.getGridDimension(o,f.y,e,n.Point3d.createFrom(u),t))return;m.x=i.nRepetitions,r.x=i.min,m.y=o.nRepetitions,r.y=o.min,g.plus3Scaled(e,1,l,r.x,u,r.y,g)}else g=e,m=a;if(0===m.x||0===m.y)return;const y=l.scale(f.x),v=u.scale(f.y),_=g.plus2Scaled(y,m.x/2,v,m.y/2);let w=s.maxPoints,S=s.maxRefs;w<10&&(w=10),S<10&&(S=10);const b=1e3/w,x=1e3/S;let P=c.getPixelSizeAtPoint(_);(f.x/P<x||f.y/P<x)&&(i=0),g.plusScaled(h,P,g),P*=p;const C=f.x/P>b&&f.y/P>b,T=this.createGraphicBuilder(2,void 0,void 0);DecorateContext.drawGrid(T,o,C,g,y,v,i,m,c),this.addDecorationFromBuilder(T)}static drawGrid(e,t,r,i,a,c,l,u,d){const h=d.worldToViewMap.transform1.columnZ(),p=n.Vector3d.createFrom(h),f=n.Geometry.conditionalDivideFraction(1,h.w);if(void 0!==f){const e=p.scale(f);p.setFrom(i.vectorTo(e))}let g=p.normalize(p);if(!g)return;const m=a.crossProduct(c);if(!(g=m.normalize(m)))return;const y=d.getContrastToBackgroundColor(),v=y.clone(),_=y.clone(),w=y.clone();v.setTransparency(s.lineTransparency),_.setTransparency(s.dotTransparency),w.setTransparency(s.planeTransparency);let S=0;p.dotProduct(m)<0&&(w.setFrom(o.ColorDef.red),w.setTransparency(s.planeTransparency),S=4177066232);const b=l>0?l:1,x=1/b;if(t&&(l=0),r){const r=n.Vector3d.createFrom(a),o=n.Vector3d.createFrom(c);r.scale(x,r),o.scale(x,o),e.setSymbology(_,w,1),DecorateContext.drawGridDots(e,t,i,o,u.y*b,r,u.x*b,l,d)}if(0<l&&(e.setSymbology(v,w,1,S),DecorateContext.drawGridRefs(e,i,a,c,u.x,u.y),DecorateContext.drawGridRefs(e,i,c,a,u.y,u.x)),p.isPerpendicularTo(a))return;const P=[i,i.plusScaled(a,u.x),i.plus2Scaled(a,u.x,c,u.y),i.plusScaled(c,u.y),i];0===l&&(e.setSymbology(v,w,1,S),e.addLineString(P)),e.setBlankingFill(w),e.addShape(P)}static getClipPlaneIntersection(e,t,r,n){e.min=-Number.MAX_VALUE,e.max=Number.MAX_VALUE;for(let i=0;i<6;i++){const o=n.planes[i],s=o.dotProductVector(r),a=-o.evaluatePoint(t)/s;s>0?a>e.min&&(e.min=a):s<0&&a<e.max&&(e.max=a)}return e.min<e.max}static drawGridDots(e,t,r,i,o,a,c,l,u){const d=a.magnitude(),h=a.normalize();if(!h)return;const p=[],f=u.isCameraOn;let g=0,m=0;const y=n.Vector3d.create();if(f){const e=u.view.camera,t=s.maxHorizon*d/u.viewDelta.x;u.rotation.rowZ(y),m=(g=y.dotProduct(e.getEyePoint()))-e.focusDist*t}const v=u.getFrustum().getRangePlanes(!0,!0,0),_={min:0,max:0};for(let n=0;n<o;n++){if(0!==l&&0===n%l)continue;const e=r.plusScaled(i,n);if(DecorateContext.getClipPlaneIntersection(_,e,h,v)){if(f){const t=e.plusScaled(h,_.min),r=e.plusScaled(h,_.max);if(y.dotProduct(t)<m&&y.dotProduct(r)<m)continue}let r=0,i=Math.floor(_.min/d),o=Math.ceil(_.max/d);i=i<0?0:i,o=o>c?c:o;const u=t&&1&n?.5:0;for(let t=i;t<=o&&r<s.maxDotsInRow;t++){if(0!==l&&0===t%l)continue;const n=e.plusScaled(a,t+u);if(f){const e=y.dotProduct(n);e<g&&e>m&&p.push(n)}else p.push(n);r++}}}0!==p.length&&e.addPointString(p)}static drawGridRefs(e,t,r,n,i,o){const s=t.plusScaled(n,o);for(let a=0;a<=i;a+=1){const n=[t.plusScaled(r,a),s.plusScaled(r,a)];e.addLineString(n)}}setSkyBox(e){this._decorations.skyBox=e}setViewBackground(e){this._decorations.viewBackground=e}}t.DecorateContext=DecorateContext;t.SceneContext=class SceneContext extends RenderContext{constructor(e,t){super(e),this.graphics=[],this.backgroundGraphics=[],this.requests=t}outputGraphic(e){this.backgroundMap?this.backgroundGraphics.push(e):this.graphics.push(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4),o=r(3),s=r(26),a=r(41),c=r(297),l=r(54),u=r(89),d=r(11);class OvrUniform{constructor(){this.floatFlags=0,this.weight=0,this.lineCode=0,this.unused=0,this.rgba=l.FloatRgba.fromColorDef(i.ColorDef.black,0),this.flags=0}isFlagSet(e){return 0!==(this.flags&e)}get anyOverridden(){return 0!==this.flags}get allHidden(){return this.isFlagSet(1)}get anyOpaque(){return this.isFlagSet(4)&&1===this.rgba.alpha}get anyTranslucent(){return this.isFlagSet(4)&&1>this.rgba.alpha}get anyHilited(){return this.isFlagSet(32)}initialize(e,t,r,n){this.update(e,r,n,t)}update(e,t,r,o){e.isUniform;const s=e.uniform,a=n.Id64.isValid(r)&&s.elementId===r,c=t.has(s.elementId);if(void 0===o)return void(0===(1&this.flags)&&(this.flags=a?16|this.flags:-17&this.flags,this.flags=c?32|this.flags:-33&this.flags,this.floatFlags=this.flags/256));this.floatFlags=this.weight=this.lineCode=this.unused=0,this.rgba=l.FloatRgba.fromColorDef(i.ColorDef.black,0),this.flags=0;const d=o.getAppearance(s,e.modelId,e.type);if(void 0===d)return this.flags=1,void(this.floatFlags=this.flags/256);if(a&&(this.flags|=16),c&&(this.flags|=32),d.overridesRgb&&d.rgb&&(this.flags|=2,this.rgba=l.FloatRgba.fromColorDef(i.ColorDef.from(d.rgb.r,d.rgb.g,d.rgb.b,1))),void 0!==d.transparency){const e=1-d.transparency;this.flags|=4,this.rgba=new l.FloatRgba(this.rgba.red,this.rgba.green,this.rgba.blue,e)}d.overridesWeight&&d.weight&&(this.flags|=8,this.weight=d.weight/256),d.overridesLinePixels&&d.linePixels&&(this.flags|=64,this.lineCode=u.LineCode.valueFromLinePixels(d.linePixels)/256),d.ignoresMaterial&&(this.flags|=128),this.floatFlags=this.flags/256}}class OvrNonUniform{constructor(){this.lutParams=new c.LUTParams(1,1),this.anyOverridden=!0,this.allHidden=!0,this.anyTranslucent=!0,this.anyOpaque=!0,this.anyHilited=!0}initialize(e,t,r,n){const i=e.numFeatures,o=c.LUTDimensions.computeWidthAndHeight(i,2),s=o.width,l=o.height;this.lutParams=new c.LUTParams(s,l);const u=new Uint8Array(s*l*4),h=new a.Texture2DDataUpdater(u);return this.buildLookupTable(h,e,t,n,r),a.TextureHandle.createForData(s,l,u,!0,d.GL.Texture.WrapMode.ClampToEdge)}update(e,t,r,n,i){const o=new a.Texture2DDataUpdater(t.dataBytes);void 0===i?this.updateFlashedAndHilited(o,e,r,n):this.buildLookupTable(o,e,i,r,n),t.update(o)}buildLookupTable(e,t,r,i,o){this.anyOpaque=this.anyTranslucent=this.anyHilited=!1;let s=0,a=0;for(let c=0;c<t.numFeatures;c++){const l=t.getFeature(c),d=4*c*2,h=r.getAppearance(l,t.modelId,t.type);if(void 0===h||h.isFullyTransparent){e.setOvrFlagsAtIndex(d,1),s++,a++;continue}let p=0;if(o.has(l.elementId)&&(p|=32,this.anyHilited=!0),h.overridesRgb&&h.rgb){p|=2;const t=h.rgb;e.setByteAtIndex(d+4,t.r),e.setByteAtIndex(d+5,t.g),e.setByteAtIndex(d+6,t.b)}if(void 0!==h.transparency){p|=4;let t=1-h.transparency;t=Math.floor(255*t+.5),e.setByteAtIndex(d+7,t),255===t?this.anyOpaque=!0:this.anyTranslucent=!0}if(h.overridesWeight&&h.weight){p|=8;let t=h.weight;t=Math.min(31,t),t=Math.max(1,t),e.setByteAtIndex(d+1,t)}if(h.overridesLinePixels&&h.linePixels){p|=64;const t=u.LineCode.valueFromLinePixels(h.linePixels);e.setByteAtIndex(d+2,t)}h.ignoresMaterial&&(p|=128),n.Id64.isValid(i)&&l.elementId===i&&(p|=16),e.setOvrFlagsAtIndex(d,p),0!==p&&a++}this.allHidden=s===t.numFeatures,this.anyOverridden=a>0}updateFlashedAndHilited(e,t,r,i){this.anyOverridden=!1,this.anyHilited=!1;const o=n.Id64.isValid(r)?{lo:n.Id64.getLowerUint32(r),hi:n.Id64.getUpperUint32(r)}:void 0,s=void 0!==o,a=s||void 0!==i;for(let c=0;c<t.numFeatures;c++){const r=4*c*2,l=e.getFlagsAtIndex(r);if(0!==(1&l)){this.anyOverridden=!0;continue}const u=a?t.getElementIdParts(c):void 0,d=s&&u.low===o.lo&&u.high===o.hi;let h;h=void 0!==i?i.has(n.Id64.fromUint32Pair(u.low,u.high)):0!==(32&l);let p=d?16|l:-17&l;p=h?32|p:-33&p,e.setOvrFlagsAtIndex(r,p),0!==p&&(this.anyOverridden=!0,this.anyHilited=this.anyHilited||h)}}}class FeatureOverrides{constructor(e){this.dimension=0,this._lastOverridesUpdated=n.BeTimePoint.now(),this._lastFlashUpdated=n.BeTimePoint.now(),this._lastHiliteUpdated=n.BeTimePoint.now(),this.target=e}static createFromTarget(e){return new FeatureOverrides(e)}dispose(){n.dispose(this.lut),this.lut=void 0}get isNonUniform(){return 1===this.dimension}get isUniform(){return!this.isNonUniform}get anyOverridden(){return this._uniform?this._uniform.anyOverridden:this._nonUniform.anyOverridden}get allHidden(){return this._uniform?this._uniform.allHidden:this._nonUniform.allHidden}get anyOpaque(){return this._uniform?this._uniform.anyOpaque:this._nonUniform.anyOpaque}get anyTranslucent(){return this._uniform?this._uniform.anyTranslucent:this._nonUniform.anyTranslucent}get anyHilited(){return this._uniform?this._uniform.anyHilited:this._nonUniform.anyHilited}get uniform1(){if(this.isUniform){const e=this._uniform;return new Float32Array([e.floatFlags,e.weight,e.lineCode,e.unused])}return new Float32Array(4)}get uniform2(){if(this.isUniform){const e=this._uniform.rgba;return new Float32Array([e.red,e.green,e.blue,e.alpha])}return new Float32Array(4)}initFromMap(e){const t=e.numFeatures;this._uniform=this._nonUniform=void 0,this.lut=void 0;const r=this.target.currentFeatureSymbologyOverrides,i=this.target.hilite;1<t?(this._nonUniform=new OvrNonUniform,this.lut=this._nonUniform.initialize(e,r,i,this.target.flashedElemId),this.dimension=1):(this._uniform=new OvrUniform,this._uniform.initialize(e,r,i,this.target.flashedElemId),this.dimension=0),this._lastOverridesUpdated=this._lastFlashUpdated=this._lastHiliteUpdated=n.BeTimePoint.now()}update(e){const t=this.target.overridesUpdateTime,r=this.target.flashedUpdateTime,n=this._lastOverridesUpdated.before(t),i=this.target.hiliteUpdateTime,o=this._lastHiliteUpdated.before(i),s=n?this.target.currentFeatureSymbologyOverrides:void 0,a=this.target.hilite;(n||o||this._lastFlashUpdated.before(r))&&(this.isUniform?this._uniform.update(e,a,this.target.flashedElemId,s):this._nonUniform.update(e,this.lut,this.target.flashedElemId,void 0!==s||o?a:void 0,s),this._lastOverridesUpdated=t,this._lastFlashUpdated=r,this._lastHiliteUpdated=i)}}t.FeatureOverrides=FeatureOverrides;const h=new Uint32Array(1),p=new Uint8Array(h.buffer);function f(e){h[0]=e;const t=new Float32Array(4);for(let r=0;r<4;r++)t[r]=p[r]/255;return t}function g(e){return e.anyDefined?e.isUniform?{uniform:(t=e.getElementIdParts(0),{elemId0:f(t.low),elemId1:f(t.high)})}:{nonUniform:function(e){const t=e.numFeatures;if(t<=1)return;const r=c.LUTDimensions.computeWidthAndHeight(t,2);r.width,r.height;const n=new Uint8Array(r.width*r.height*4),i=new Uint32Array(n.buffer);for(let o=0;o<e.numFeatures;o++){const t=e.getElementIdParts(o);i[2*o]=t.low,i[2*o+1]=t.high}return a.TextureHandle.createForData(r.width,r.height,n)}(e)}:{};var t}class Graphic extends s.RenderGraphic{get isPickable(){return!1}addHiliteCommands(e,t,r){}assignUniformFeatureIndices(e){}toPrimitive(){}}t.Graphic=Graphic;t.Batch=class Batch extends Graphic{constructor(e,t,r){super(),this._overrides=[],this.graphic=e,this.featureTable=t,this.range=r}dispose(){n.dispose(this.graphic);for(const e of this._overrides)e.target.onBatchDisposed(this),n.dispose(e);this._overrides.length=0}get pickTable(){return void 0===this._pickTable&&(this._pickTable=g(this.featureTable)),this._pickTable}addCommands(e){e.addBatch(this)}get isPickable(){return!0}getOverrides(e){let t;for(const r of this._overrides)if(r.target===e){t=r;break}return void 0===t&&(t=FeatureOverrides.createFromTarget(e),this._overrides.push(t),e.addBatch(this),t.initFromMap(this.featureTable)),t.update(this.featureTable),t}onTargetDisposed(e){let t=0,r=-1;for(const n of this._overrides){if(n.target===e){r=t;break}t++}r>-1&&(n.dispose(this._overrides[r]),this._overrides.splice(r,1))}};class Branch extends Graphic{constructor(e,t=o.Transform.createIdentity(),r,n){super(),this.branch=e,this.localToWorldTransform=t,this.clips=r,void 0!==n&&e.setViewFlags(n)}dispose(){this.branch.dispose()}addCommands(e){e.addBranch(this)}addHiliteCommands(e,t,r){e.addHiliteBranch(this,t,r)}assignUniformFeatureIndices(e){for(const t of this.branch.entries)t.assignUniformFeatureIndices(e)}}t.Branch=Branch;t.WorldDecorations=class WorldDecorations extends Branch{constructor(e){super(new s.GraphicBranch,o.Transform.identity,void 0,e)}init(e){this.branch.clear();for(const t of e)this.branch.add(t)}};t.GraphicsArray=class GraphicsArray extends Graphic{constructor(e){super(),this.graphics=e}dispose(){for(const e of this.graphics)n.dispose(e);this.graphics.length=0}addCommands(e){for(const t of this.graphics)t.addCommands(e)}addHiliteCommands(e,t,r){for(const n of this.graphics)n.addHiliteCommands(e,t,r)}assignUniformFeatureIndices(e){for(const t of this.graphics)t.assignUniformFeatureIndices(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);class FeaturesInfo{constructor(e){this.uniform=e}static create(e){switch(e.type){case 0:return;case 1:return new FeaturesInfo(e.featureID);default:return FeaturesInfo._nonUniform}}static createUniform(e){return new FeaturesInfo(e)}static createFromVertexTable(e){switch(e.featureIndexType){case 0:return;case 2:return FeaturesInfo._nonUniform;default:return e.uniformFeatureID,new FeaturesInfo(e.uniformFeatureID)}}get type(){return void 0!==this.uniform?1:2}get isUniform(){return 1===this.type}get isNonUniform(){return!this.isUniform}}FeaturesInfo._nonUniform=new FeaturesInfo(void 0),t.FeaturesInfo=FeaturesInfo},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(105),i=r(90),o=r(106),s=r(90),a=r(0),c=r(7);class Primitive extends n.Graphic{constructor(e){super(),this.isPixelMode=!1,this.cachedGeometry=e}dispose(){a.dispose(this.cachedGeometry)}getRenderPass(e){return this.isPixelMode?9:this.cachedGeometry.getRenderPass(e)}get featureIndexType(){const e=this.cachedGeometry.featuresInfo;return e instanceof o.FeaturesInfo?e.type:0}get usesMaterialColor(){const e=this.cachedGeometry.material;return void 0!==e&&(e.overridesRgb||e.overridesAlpha)}get isLit(){return this.cachedGeometry.isLitSurface}get hasAnimation(){return this.cachedGeometry.hasAnimation}addCommands(e){e.addPrimitive(this)}addHiliteCommands(e,t,r){this.isEdge||e.getCommands(r).push(s.DrawCommand.createForPrimitive(this,t))}setUniformFeatureIndices(e){this.cachedGeometry.uniformFeatureIndices=e}get isEdge(){return!1}toPrimitive(){return this}draw(e){void 0===Primitive._drawParams&&(Primitive._drawParams=new i.DrawParams);const t=Primitive._drawParams;t.init(e.params,this.cachedGeometry,e.target.currentTransform,e.renderPass),e.draw(t)}getTechniqueId(e){return this.cachedGeometry.getTechniqueId(e)}get debugString(){return this.cachedGeometry.debugString}}t.Primitive=Primitive;t.SkyBoxPrimitive=class SkyBoxPrimitive extends Primitive{constructor(e){super(e)}draw(e){const t=e.target.viewRect.height,r=e.target.viewRect.width;r>t?c.System.instance.context.viewport(0,-(r-t)/2,r,r):c.System.instance.context.viewport(-(t-r)/2,0,t,t),super.draw(e),c.System.instance.context.viewport(0,0,r,t)}get renderOrder(){return 2}};t.SkySpherePrimitive=class SkySpherePrimitive extends Primitive{constructor(e){super(e)}get renderOrder(){return 2}};t.PointCloudPrimitive=class PointCloudPrimitive extends Primitive{constructor(e){super(e)}get renderOrder(){return 2}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3),o=r(4),s=r(310),a=r(183),c=r(78),l=r(8),u=r(311),d=r(144),h=r(135),p=r(176),f=r(64),g=r(20);!function(e){e[e.View=0]="View",e[e.WorldXY=1]="WorldXY",e[e.WorldYZ=2]="WorldYZ",e[e.WorldXZ=3]="WorldXZ",e[e.AuxCoord=4]="AuxCoord",e[e.GeoCoord=5]="GeoCoord"}(t.GridOrientationType||(t.GridOrientationType={})),function(e){e[e.Success=0]="Success",e[e.ViewNotInitialized=1]="ViewNotInitialized",e[e.AlreadyAttached=2]="AlreadyAttached",e[e.NotAttached=3]="NotAttached",e[e.DrawFailure=4]="DrawFailure",e[e.NotResized=5]="NotResized",e[e.ModelNotFound=6]="ModelNotFound",e[e.InvalidWindow=7]="InvalidWindow",e[e.MinWindow=8]="MinWindow",e[e.MaxWindow=9]="MaxWindow",e[e.MaxZoom=10]="MaxZoom",e[e.MaxDisplayDepth=11]="MaxDisplayDepth",e[e.InvalidUpVector=12]="InvalidUpVector",e[e.InvalidTargetPoint=13]="InvalidTargetPoint",e[e.InvalidLens=14]="InvalidLens",e[e.InvalidViewport=15]="InvalidViewport"}(t.ViewStatus||(t.ViewStatus={}));t.MarginPercent=class MarginPercent{constructor(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n;const i=e=>e<0?0:e>.25?.25:e;this.left=i(e),this.top=i(t),this.right=i(r),this.bottom=i(n)}};class ViewSubCategories{constructor(){this._byCategoryId=new Map,this._appearances=new Map}getSubCategories(e){return this._byCategoryId.get(e)}getSubCategoryAppearance(e){return this._appearances.get(e.toString())}async load(e,t){const r=[...e].join(",");if(0===r.length)return Promise.resolve();const n="SELECT ECInstanceId as id, Parent.Id as parentId, Properties as appearance FROM BisCore.SubCategory WHERE Parent.Id IN ("+r+")";return t.executeQuery(n).then(e=>this.loadFromRows(e))}update(e,t){let r;for(const n of e)void 0===this._byCategoryId.get(n)&&(void 0===r&&(r=new Set),r.add(n));return void 0!==r?this.load(r,t):Promise.resolve()}loadFromRows(e){for(const t of e)this.add(t.parentId,t.id,new o.SubCategoryAppearance(JSON.parse(t.appearance)))}add(e,t,r){let n=this._byCategoryId.get(e);void 0===n&&this._byCategoryId.set(e,n=new Set),n.add(t),this._appearances.set(t,r)}}t.ViewSubCategories=ViewSubCategories;class ViewState extends c.ElementState{constructor(e,t,r,n){super(e,t),this.categorySelector=r,this.displayStyle=n,this._featureOverridesDirty=!0,this._selectionSetDirty=!0,this.subCategories=new ViewSubCategories,this._alwaysDrawnExclusive=!1,this.description=e.description,this.isPrivate=e.isPrivate,r instanceof ViewState&&(this.categorySelector=r.categorySelector.clone(),this.displayStyle=r.displayStyle.clone(),this.subCategories=r.subCategories)}static get className(){return"ViewDefinition"}static createFromStateData(e,t,r){}get viewFlags(){return this.displayStyle.viewFlags}set viewFlags(e){this.viewFlags.equals(e)||(this.setFeatureOverridesDirty(),this.displayStyle.viewFlags=e)}get AnalysisStyle(){return this.displayStyle.settings.analysisStyle}equals(e){return super.equals(e)&&this.categorySelector.equals(e.categorySelector)&&this.displayStyle.equals(e.displayStyle)}equalState(e){return this.isPrivate===e.isPrivate&&this.categorySelector.id===e.categorySelector.id&&this.displayStyle.id===e.displayStyle.id&&this.categorySelector.equalState(e.categorySelector)&&this.displayStyle.equalState(e.displayStyle)&&JSON.stringify(this.getDetails())===JSON.stringify(e.getDetails())}toJSON(){const e=super.toJSON();return e.categorySelectorId=this.categorySelector.id,e.displayStyleId=this.displayStyle.id,e.isPrivate=this.isPrivate,e.description=this.description,e}async load(){this._auxCoordSystem=void 0;const e=this.getAuxiliaryCoordinateSystemId();if(n.Id64.isValid(e)){const t=await this.iModel.elements.getProps(e);this._auxCoordSystem=s.AuxCoordSystemState.fromProps(t[0],this.iModel)}return this.subCategories.load(this.categorySelector.categories,this.iModel)}cancelAllTileLoads(){this.forEachTileTreeModel(e=>{const t=e.tileTree();void 0!==t&&t.rootTile.cancelAllLoads()})}get areAllTileTreesLoaded(){let e=!0;return this.forEachTileTreeModel(t=>{t.loadStatus()!==f.TileTree.LoadStatus.Loaded&&(e=!1)}),e}get name(){return this.code.getValue()}get backgroundColor(){return this.displayStyle.backgroundColor}get neverDrawn(){return this._neverDrawn}get alwaysDrawn(){return this._alwaysDrawn}clearAlwaysDrawn(){void 0!==this.alwaysDrawn&&0<this.alwaysDrawn.size&&(this.alwaysDrawn.clear(),this._alwaysDrawnExclusive=!1,this.setFeatureOverridesDirty())}clearNeverDrawn(){void 0!==this.neverDrawn&&0<this.neverDrawn.size&&(this.neverDrawn.clear(),this.setFeatureOverridesDirty())}setNeverDrawn(e){this._neverDrawn=e,this.setFeatureOverridesDirty()}setAlwaysDrawn(e,t=!1){this._alwaysDrawn=e,this._alwaysDrawnExclusive=t,this.setFeatureOverridesDirty()}dropSubCategoryOverride(e){this.displayStyle.dropSubCategoryOverride(e),this.setFeatureOverridesDirty()}overrideSubCategory(e,t){this.displayStyle.overrideSubCategory(e,t),this.setFeatureOverridesDirty()}getSubCategoryOverride(e){return this.displayStyle.getSubCategoryOverride(e)}getSubCategoryAppearance(e){const t=this.subCategories.getSubCategoryAppearance(e);if(void 0===t)return o.SubCategoryAppearance.defaults;const r=this.getSubCategoryOverride(e);return void 0!==r?r.override(t):t}isSubCategoryVisible(e){const t=this.subCategories.getSubCategoryAppearance(e.toString());if(void 0===t)return!1;const r=this.getSubCategoryOverride(e);return void 0===r||void 0===r.invisible?!t.invisible:!r.invisible}get isAlwaysDrawnExclusive(){return this._alwaysDrawnExclusive}changeCategoryDisplay(e,t,r=!1){if(t){this.categorySelector.addCategories(e);const t=n.Id64.toIdSet(e);this.subCategories.update(t,this.iModel).then(()=>{if(this.setFeatureOverridesDirty(),r)for(const e of t){const t=this.subCategories.getSubCategories(e);if(void 0!==t)for(const e of t)this.changeSubCategoryDisplay(e,!0)}})}else this.categorySelector.dropCategories(e);this.setFeatureOverridesDirty()}changeSubCategoryDisplay(e,t){const r=this.subCategories.getSubCategoryAppearance(e);if(void 0===r)return;const n=this.getSubCategoryOverride(e);if((void 0!==n&&void 0!==n.invisible?!n.invisible:!r.invisible)===t)return;const i=void 0!==n?n.toJSON():{};i.invisible=!t,this.overrideSubCategory(e,o.SubCategoryOverride.fromJSON(i))}get areFeatureOverridesDirty(){return this._featureOverridesDirty}get isSelectionSetDirty(){return this._selectionSetDirty}setFeatureOverridesDirty(e=!0){this._featureOverridesDirty=e}setSelectionSetDirty(e=!0){this._selectionSetDirty=e}is3d(){return this instanceof ViewState3d}isSpatialView(){return this instanceof SpatialViewState}forEachTileTreeModel(e){this.forEachModel(t=>e(t))}createScene(e){this.forEachTileTreeModel(t=>this.addModelToScene(t,e))}createTerrain(e){void 0!==this.displayStyle.backgroundMapPlane&&this.displayStyle.backgroundMap.addToScene(e)}createClassification(e){this.forEachModel(t=>this.addModelClassifierToScene(t,e))}decorate(e){this.drawGrid(e),void 0!==this.displayStyle.backgroundMapPlane&&this.displayStyle.backgroundMap.decorate(e)}static getStandardViewMatrix(e){return p.StandardView.getStandardRotation(e)}setStandardRotation(e){this.setRotation(ViewState.getStandardViewMatrix(e))}getTargetPoint(e){return this.getCenter(e)}getCenter(e){const t=this.getRotation().transpose().multiplyVector(this.getExtents());return this.getOrigin().plusScaled(t,.5,e)}drawGrid(e){const t=e.viewport;if(!t.isGridOn)return;const r=this.getGridOrientation();if(4===r)return void this.auxiliaryCoordinateSystem.drawGrid(e);const n=this.getGridsPerRef(),o=i.Point2d.createFrom(this.getGridSpacing()),s=i.Point3d.create(),a=i.Matrix3d.createIdentity(),c=i.Point2d.create();this.getGridSettings(t,s,a,r),e.drawStandardGrid(s,a,o,n,!1,0!==r?c:void 0)}computeWorldToNpc(e,t,r){void 0===e&&(e=this.getRotation());const n=e.rowX(),o=e.rowY(),s=e.rowZ();void 0===r&&(r=this.getExtents()),void 0===t&&(t=this.getOrigin());let a,c,l,u,d=1;if(this.is3d()&&this.isCameraOn){const s=this.camera,h=i.Vector3d.createStartEnd(s.eye,t);e.multiplyVectorInPlace(h);const p=s.focusDist;let f=r.z,m=h.z,y=m+f;if(y/m<g.Viewport.nearScale24){const e=1e4*i.Constant.oneKilometer;-m>e&&(m=-e,h.z=m),f=(y=m*g.Viewport.nearScale24)-h.z}const v=-m/p,_=-y/p;d=_/v,a=n.scale(r.x*v),c=o.scale(r.y*v),l=new i.Vector3d(h.x*(_-v),h.y*(_-v),f),e.multiplyTransposeVectorInPlace(l),u=new i.Point3d(h.x*v,h.y*v,h.z),e.multiplyTransposeVectorInPlace(u),u.plus(s.eye,u)}else u=t,a=n.scale(r.x),c=o.scale(r.y),l=s.scale(r.z);return{map:i.Map4d.createVectorFrustum(u,a,c,l,d),frustFraction:d}}calculateFrustum(e){const t=this.computeWorldToNpc();if(void 0===t.map)return;const r=e?e.initNpc():new o.Frustum;return t.map.transform1.multiplyPoint3dArrayQuietNormalize(r.points),r}setupFromFrustum(e){const t=e.clone();t.fixPointOrder();const r=t.points,n=r[0],o=i.Vector3d.createFrom(r[1].minus(n)),s=i.Vector3d.createFrom(r[2].minus(n)),a=i.Vector3d.createFrom(r[4].minus(n)),c=i.Matrix3d.createRigidFromColumns(o,s,0);if(!c)return 7;p.StandardView.adjustToStandardRotation(c);const l=c.getColumn(0),u=c.getColumn(1),d=c.getColumn(2),h=c.inverse();if(!h)return 7;const f=d.dotProduct(a);if(f<0)return 7;const g=new i.Vector3d;g.plus2Scaled(l,l.dotProduct(o),u,u.dotProduct(s),g),g.plusScaled(d,f,g),t.getCenter().plusScaled(g,-.5,n);const m=h.multiplyVector(g),y=this.validateViewDelta(m,!1);return 0!==y?y:(this.setOrigin(n),this.setExtents(m),this.setRotation(h),0)}setDisplayStyle(e){this.displayStyle=e}getDetails(){return this.jsonProperties.viewDetails||(this.jsonProperties.viewDetails=new Object),this.jsonProperties.viewDetails}adjustAspectRatio(e){const t=this.getExtents(),r=t.x/t.y;if(e*=this.getAspectRatioSkew(),Math.abs(1-r/e)<1e-9)return;const n=t.clone();r>e?t.y=t.x/e:t.x=t.y*e;let o=this.getOrigin();const s=i.Transform.createOriginAndMatrix(i.Point3d.createZero(),this.getRotation()),a=s.multiplyPoint3d(o);a.x+=(n.x-t.x)/2,a.y+=(n.y-t.y)/2,o=s.inverse().multiplyPoint3d(a),this.setOrigin(o),this.setExtents(t)}showFrustumErrorMessage(e){let t;switch(e){case 7:t="InvalidWindow";break;case 9:t="MaxWindow";break;case 8:t="MinWindow";break;case 10:t="MaxZoom";break;default:return}l.IModelApp.notifications.outputMessage(new h.NotifyMessageDetails(10,l.IModelApp.i18n.translate("Viewing."+t)))}validateViewDelta(e,t){const r=this.getExtentLimits();let n=0;const i=(e,t)=>(e<r.min?(e=r.min,t||(n=8)):e>r.max&&(e=r.max,t||(n=9)),e);return e.x=i(e.x,!1),e.y=i(e.y,!1),e.z=i(e.z,!0),t&&0!==n&&this.showFrustumErrorMessage(n),n}peekDetail(e){return this.getDetails()[e]}getDetail(e){const t=this.getDetails()[e];return t||{}}setDetail(e,t){this.getDetails()[e]=t}removeDetail(e){delete this.getDetails()[e]}setCategorySelector(e){this.categorySelector=e}get auxiliaryCoordinateSystem(){return this._auxCoordSystem||(this._auxCoordSystem=this.createAuxCoordSystem("")),this._auxCoordSystem}getAuxiliaryCoordinateSystemId(){return n.Id64.fromJSON(this.getDetail("acs"))}setAuxiliaryCoordinateSystem(e){this._auxCoordSystem=e,e?this.setDetail("acs",e.id):this.removeDetail("acs")}viewsCategory(e){return this.categorySelector.isCategoryViewed(e)}getAspectRatio(){const e=this.getExtents();return e.x/e.y}getAspectRatioSkew(){return n.JsonUtils.asDouble(this.getDetail("aspectSkew"),1)}setAspectRatioSkew(e){e&&1!==e?this.setDetail("aspectSkew",e):this.removeDetail("aspectSkew")}getXVector(e){return this.getRotation().getRow(0,e)}getYVector(e){return this.getRotation().getRow(1,e)}getZVector(e){return this.getRotation().getRow(2,e)}setViewClip(e){e&&e.isValid?this.setDetail("clip",e.toJSON()):this.removeDetail("clip")}getViewClip(){const e=this.peekDetail("clip");if(void 0===e)return;const t=i.ClipVector.fromJSON(e);return t.isValid?t:void 0}setGridSettings(e,t,r){switch(e){case 2:case 3:if(!this.is3d())return;break;case 5:if(!this.isSpatialView())return}const i=this.getDetails();n.JsonUtils.setOrRemoveNumber(i,"gridOrient",e,1),n.JsonUtils.setOrRemoveNumber(i,"gridPerRef",r,10),n.JsonUtils.setOrRemoveNumber(i,"gridSpaceX",t.x,1),n.JsonUtils.setOrRemoveNumber(i,"gridSpaceY",t.y,t.x)}getGridSettings(e,t,r,n){switch(r.setIdentity(),t.setFrom(e.view.isSpatialView()?e.view.iModel.globalOrigin:i.Point3d.create()),n){case 0:{const n=i.Point3d.create(.5,.5,.5);e.npcToWorld(n,n),r.setFrom(e.rotation),r.multiplyXYZtoXYZ(t,t),t.z=n.z,r.multiplyTransposeVectorInPlace(t);break}case 1:break;case 2:{const e=r.getRow(0),t=r.getRow(1),n=r.getRow(2);r.setRow(0,t),r.setRow(1,n),r.setRow(2,e);break}case 3:{const e=r.getRow(0),t=r.getRow(1),n=r.getRow(2);r.setRow(0,e),r.setRow(1,n),r.setRow(2,t);break}}}getGridOrientation(){return n.JsonUtils.asInt(this.getDetail("gridOrient"),1)}getGridsPerRef(){return n.JsonUtils.asInt(this.getDetail("gridPerRef"),10)}getGridSpacing(){const e=n.JsonUtils.asInt(this.getDetail("gridSpaceX"),1);return{x:e,y:n.JsonUtils.asInt(this.getDetail("gridSpaceY"),e)}}lookAtVolume(e,t,r){const n=o.Frustum.fromRange(e).points;return this.getRotation().multiplyVectorArrayInPlace(n),this.lookAtViewAlignedVolume(i.Range3d.createArray(n),t,r)}lookAtViewAlignedVolume(e,t,r){if(e.isNull)return;const n=this.getRotation(),o=e.low.clone();let s=i.Vector3d.createStartEnd(e.low,e.high);const a=i.Constant.oneMillimeter;s.z<a&&(o.z-=(a-s.z)/2,s.z=a);let c=s.clone();const l=this.is3d()&&this.isCameraOn;if(l);else if(r){const e=r.left+r.right,t=r.top+r.bottom,n=e/(1-e)*s.x,i=t/(1-t)*s.y,a=r.left/(1-e)*s.x,l=r.bottom/(1-t)*s.y;o.x-=a,o.y-=l,s.x+=n,s.y+=i,c=s.clone()}else s.scale(1.04,s);if(l){const e=s.magnitudeXY();e>s.z&&(s.z=e)}if(this.validateViewDelta(s,!0),this.setExtents(s),t&&this.adjustAspectRatio(t),s=this.getExtents(),o.x-=(s.x-c.x)/2,o.y-=(s.y-c.y)/2,o.z-=(s.z-c.z)/2,n.multiplyTransposeVectorInPlace(o),this.setOrigin(o),!this.is3d())return;const u=this.camera;u.validateLens();const d=Math.max(s.x,s.y)/(2*Math.tan(u.getLensAngle().radians/2)),h=d+s.z;u.setFocusDistance(d),this.centerEyePoint(h),this.verifyFocusPlane()}addModelToScene(e,t){e.loadTileTree();const r=e.tileTree();void 0!==r&&r.drawScene(t)}addModelClassifierToScene(e,t){if(void 0!==e.jsonProperties.classifiers)for(const r of e.jsonProperties.classifiers)if(r.isActive){const e=this.iModel.models.getLoaded(r.modelId);void 0!==e&&(e.loadTileTree(!0,r.expand),void 0!==e.classifierTileTree&&e.classifierTileTree.drawScene(t))}}setRotationAboutPoint(e,t){void 0===t&&(t=this.getTargetPoint());const r=e.clone().inverse();if(void 0===r)return;const n=r.multiplyMatrixMatrix(this.getRotation()),o=i.Transform.createFixedPointAndMatrix(t,n),s=this.calculateFrustum();void 0!==s&&(s.multiply(o),this.setupFromFrustum(s))}}t.ViewState=ViewState;class ViewState3d extends ViewState{constructor(e,t,r,s){super(e,t,r,s),this.forceMinFrontDist=0,this._cameraOn=n.JsonUtils.asBool(e.cameraOn),this.origin=i.Point3d.fromJSON(e.origin),this.extents=i.Vector3d.fromJSON(e.extents),this.rotation=i.YawPitchRollAngles.fromJSON(e.angles).toMatrix3d(),this.rotation.isRigid(),this.camera=new o.Camera(e.camera)}static get className(){return"ViewDefinition3d"}onRenderFrame(e){}allow3dManipulations(){return!0}toJSON(){const e=super.toJSON();return e.cameraOn=this._cameraOn,e.origin=this.origin,e.extents=this.extents,e.angles=i.YawPitchRollAngles.createFromMatrix3d(this.rotation).toJSON(),e.angles,e.camera=this.camera,e}equalState(e){return!!(this.origin.isAlmostEqual(e.origin)&&this.extents.isAlmostEqual(e.extents)&&this.rotation.isAlmostEqual(e.rotation))&&(this.isCameraOn===e.isCameraOn&&((!this.isCameraOn||!this.camera.equals(e.camera))&&super.equalState(e)))}get isCameraOn(){return this._cameraOn}setupFromFrustum(e){const t=super.setupFromFrustum(e);if(0!==t)return t;this.turnCameraOff();const r=e.points,n=r[0].distance(r[1]),i=r[4].distance(r[5]);if(i>n*(1+1e-6))return 7;const o=i/n;if(o>=1-1e-6)return 0;let s=r[0];const a=this.getExtents().clone(),c=this.getZVector(),l=s.vectorTo(r[4]).scale(1/(1-o)),u=s.plus(l),d=l.dotProduct(c),h=d-a.z/2,p=h/d;return s=u.plus2Scaled(l,-p,c,h-d),a.x*=p,a.y*=p,this.setEyePoint(u),this.setFocusDistance(h),this.setOrigin(s),this.setExtents(a),this.setLensAngle(this.calcLensAngle()),this.enableCamera(),0}static calculateMaxDepth(e,t){const r=Math.min(Math.abs(t.x),Math.abs(t.y)),n=0===r?1e8:Math.min(1e5/r,1e8);return Math.max(e.x,e.y)*n}getOrigin(){return this.origin}getExtents(){return this.extents}getRotation(){return this.rotation}setOrigin(e){this.origin.setFrom(e)}setExtents(e){this.extents.setFrom(e)}setRotation(e){this.rotation.setFrom(e)}enableCamera(){this.supportsCamera()&&(this._cameraOn=!0)}supportsCamera(){return!0}minimumFrontDistance(){return Math.max(15.2*i.Constant.oneCentimeter,this.forceMinFrontDist)}isEyePointAbove(e){return this._cameraOn?this.getEyePoint().z>e:this.getZVector().z>0}getDisplayStyle3d(){return this.displayStyle}turnCameraOff(){this._cameraOn=!1}get isCameraValid(){return this.camera.isValid}calcLensAngle(){const e=Math.max(this.extents.x,this.extents.y);return i.Angle.createRadians(2*Math.atan2(.5*e,this.camera.getFocusDistance()))}getTargetPoint(e){if(!this._cameraOn)return super.getTargetPoint(e);const t=this.getRotation().getRow(2);return this.getEyePoint().plusScaled(t,-1*this.getFocusDistance(),e)}lookAt(e,t,r,n,o,s){const a=new i.Point3d(e.x,e.y,e.z),c=r.normalize();if(!c)return 12;const l=i.Vector3d.createStartEnd(t,a),u=l.normalizeWithLength(l).mag,d=this.minimumFrontDistance();if(u<=d)return 13;const h=new i.Vector3d;if(c.crossProduct(l).normalizeWithLength(h).mag<i.Geometry.smallMetricDistance)return 12;if(l.crossProduct(h).normalizeWithLength(c).mag<i.Geometry.smallMetricDistance)return 12;const p=i.Matrix3d.createRows(h,c,l);s=s||this.getBackDistance(),o=o||this.getFrontDistance();const f=n?new i.Vector3d(Math.abs(n.x),Math.abs(n.y),this.extents.z):this.extents.clone();o=Math.max(o,.5*i.Constant.oneMeter),(s=Math.max(s,u+.5*i.Constant.oneMeter))<u&&(s=u+i.Constant.oneMillimeter),o>u&&(o=u-d),o<d&&(o=d),f.z=s-o;const g=f.scale(o/u),m=this.validateViewDelta(g,!1);if(0!==m)return m;if(f.z>ViewState3d.calculateMaxDepth(f,l))return 11;const y=a.plus3Scaled(l,-s,h,-.5*f.x,c,-.5*f.y);return this.setEyePoint(e),this.setRotation(p),this.setFocusDistance(u),this.setOrigin(y),this.setExtents(f),this.setLensAngle(this.calcLensAngle()),this.enableCamera(),0}lookAtUsingLensAngle(e,t,r,n,o,s){const a=e.vectorTo(t).magnitude();if(a<=i.Constant.oneMillimeter)return 13;if(n.radians<1e-4||n.radians>Math.PI)return 14;const c=2*Math.tan(n.radians/2)*a,l=i.Vector2d.create(this.extents.x,this.extents.y),u=Math.max(l.x,l.y);return l.scale(c/u,l),this.lookAt(e,t,r,l,o,s)}moveCameraLocal(e){const t=this.getRotation().multiplyTransposeVector(e);return this.moveCameraWorld(t)}moveCameraWorld(e){if(!this._cameraOn)return this.origin.plus(e,this.origin),0;const t=this.getTargetPoint().plus(e),r=this.getEyePoint().plus(e);return this.lookAt(r,t,this.getYVector())}rotateCameraLocal(e,t,r){const n=this.getRotation().multiplyTransposeVector(t);return this.rotateCameraWorld(e,n,r)}rotateCameraWorld(e,t,r){const n=r||this.getEyePoint(),o=i.Matrix3d.createRotationAroundVector(t,e);if(!o)return 12;const s=i.Transform.createFixedPointAndMatrix(n,o).multiplyPoint3d(this.getTargetPoint()),a=o.multiplyVector(this.getYVector());return this.lookAt(this.getEyePoint(),s,a)}getFrontDistance(){return this.getBackDistance()-this.extents.z}getBackDistance(){const e=this.origin.vectorTo(this.getEyePoint());return this.getRotation().multiplyVector(e,e),e.z}centerEyePoint(e){const t=this.getExtents().scale(.5);t.z=e||this.getBackDistance();const r=this.getRotation().multiplyTransposeXYZ(t.x,t.y,t.z);this.camera.setEyePoint(this.getOrigin().plus(r))}centerFocusDistance(){const e=this.getBackDistance(),t=this.getFrontDistance(),r=this.getEyePoint(),n=r.plusScaled(this.getZVector(),t-e);this.lookAtUsingLensAngle(r,n,this.getYVector(),this.getLensAngle(),t,e)}verifyFocusPlane(){if(!this._cameraOn)return;let e=this.getBackDistance();const t=e-this.extents.z,r=this.camera,n=this.extents,i=this.rotation;if(e<=0||t<=0){const t=Math.tan(r.lens.radians/2);return e=n.z/t,r.setFocusDistance(e/2),void this.centerEyePoint(e)}const o=r.focusDist;if(o>t&&o<e)return;r.setFocusDistance(n.z/2+t);const s=r.focusDist/o;n.x*=s,n.y*=s,r.eye.plus3Scaled(i.rowZ(),-e,i.rowX(),-.5*n.x,i.rowY(),-.5*n.y,this.origin)}getEyePoint(){return this.camera.eye}getLensAngle(){return this.camera.lens}setLensAngle(e){this.camera.setLensAngle(e)}setEyePoint(e){this.camera.setEyePoint(e)}setFocusDistance(e){this.camera.setFocusDistance(e)}getFocusDistance(){return this.camera.focusDist}createAuxCoordSystem(e){return s.AuxCoordSystem3dState.createNew(e,this.iModel)}decorate(e){super.decorate(e),this.drawSkyBox(e),this.drawGroundPlane(e)}drawSkyBox(e){const t=this.getDisplayStyle3d();if(!t.environment.sky.display)return;const r=e.viewport,n=t.loadSkyBoxParams(r.target.renderSystem);if(void 0!==n){const t=l.IModelApp.renderSystem.createSkyBox(n);e.setSkyBox(t)}}getGroundElevation(){return this.getDisplayStyle3d().environment.ground.elevation+this.iModel.globalOrigin.z}getGroundExtents(e){const t=this.getDisplayStyle3d(),r=new o.AxisAlignedBox3d;if(void 0!==e&&!t.environment.ground.display)return r;const n=this.getGroundElevation();if(void 0!==e){const t=i.Ray3d.create(i.Point3d.create(),e.rotation.rowZ()),o=i.Plane3dByOriginAndUnitNormal.create(i.Point3d.create(0,0,n),i.Vector3d.create(0,0,1)),s=e.getFrustum();for(const e of s.points){t.origin=e;const n=i.Point3d.create();if(void 0===t.intersectionWithPlane(o,n))return r}}r.setFrom(this.iModel.projectExtents),r.low.z=r.high.z=n;const s=r.low.interpolate(.5,r.high),a=r.low.distance(r.high);return r.setNull(),r.extendPoint(s),r.low.addScaledInPlace(i.Vector3d.create(-1,-1,-1),a),r.high.addScaledInPlace(i.Vector3d.create(1,1,1),a),r.low.z=r.high.z=n,r}drawGroundPlane(e){const t=this.getGroundExtents(e.viewport);if(t.isNull)return;const r=this.getDisplayStyle3d().environment.ground;if(!r.display)return;const n=[t.low.clone(),t.low.clone(),t.high.clone(),t.high.clone()];n[1].x=t.high.x,n[3].x=t.low.x;const s=this.isEyePointAbove(t.low.z),a=r.getGroundPlaneGradient(s),c=e.viewport.target.renderSystem.getGradientTexture(a,this.iModel);if(!c)return;const l=new o.RenderMaterial.Params;l.diffuseColor=o.ColorDef.white,l.shadows=!1,l.ambient=1,l.diffuse=0;const u=new o.TextureMapping.Params,d=new o.TextureMapping.Trans2x3(0,1,0,1,0,0);u.textureMatrix=d,u.textureMatrix.setTransform(),l.textureMapping=new o.TextureMapping(c,u);const h=e.viewport.target.renderSystem.createMaterial(l,this.iModel);if(!h)return;const p=new o.GraphicParams;p.setLineColor(a.keys[0].color),p.setFillColor(o.ColorDef.white),p.material=h;const f=e.createGraphicBuilder(2);f.activateGraphicParams(p);const g=new i.StrokeOptions;g.needParams=!0;const m=i.PolyfaceBuilder.create(g);m.toggleReversedFacetFlag();const y=[i.Point2d.create(0,0),i.Point2d.create(1,0),i.Point2d.create(1,1),i.Point2d.create(0,1)];m.addQuadFacet(n,y);const v=m.claimPolyface(!1);f.addPolyface(v,!0),e.addDecorationFromBuilder(f)}}t.ViewState3d=ViewState3d;class SpatialViewState extends ViewState3d{static createFromStateData(e,t,r){const n=new a.DisplayStyle3dState(e.displayStyleProps,r),i=new u.ModelSelectorState(e.modelSelectorProps,r);return new this(e.viewDefinitionProps,r,t,n,i)}constructor(e,t,r,n,i){super(e,t,r,n),this.modelSelector=i,r instanceof SpatialViewState&&(this.modelSelector=r.modelSelector.clone())}equals(e){return super.equals(e)&&this.modelSelector.equals(e.modelSelector)}equalState(e){return!!super.equalState(e)&&(this.modelSelector.id===e.modelSelector.id&&this.modelSelector.equalState(e.modelSelector))}static get className(){return"SpatialViewDefinition"}createAuxCoordSystem(e){return s.AuxCoordSystemSpatialState.createNew(e,this.iModel)}getExtentLimits(){return{min:i.Constant.oneMillimeter,max:i.Constant.diameterOfEarth}}computeFitRange(){const e=new o.AxisAlignedBox3d;return this.forEachModel(t=>{const r=t.tileTree();void 0!==r&&void 0!==r.rootTile&&t.useRangeForFit()&&e.extendRange(r.rootTile.computeWorldContentRange())}),e.isNull&&e.setFrom(this.getViewedExtents()),e.ensureMinLengths(1),e}getViewedExtents(){const e=o.AxisAlignedBox3d.fromJSON(this.iModel.projectExtents);return e.scaleAboutCenterInPlace(1.0001),e.extendRange(this.getGroundExtents()),e}toJSON(){const e=super.toJSON();return e.modelSelectorId=this.modelSelector.id,e}async load(){return await super.load(),this.modelSelector.load()}viewsModel(e){return this.modelSelector.containsModel(e)}clearViewedModels(){this.modelSelector.models.clear()}addViewedModel(e){this.modelSelector.addModels(e)}removeViewedModel(e){this.modelSelector.dropModels(e)}forEachModel(e){for(const t of this.modelSelector.models){const r=this.iModel.models.getLoaded(t);void 0!==r&&r.isGeometricModel&&e(r)}}forEachTileTreeModel(e){this.forEachModel(t=>e(t)),this.displayStyle.forEachContextModel(t=>e(t))}}t.SpatialViewState=SpatialViewState;t.OrthographicViewState=class OrthographicViewState extends SpatialViewState{static get className(){return"OrthographicViewDefinition"}constructor(e,t,r,n,i){super(e,t,r,n,i)}supportsCamera(){return!1}};class ViewState2d extends ViewState{static get className(){return"ViewDefinition2d"}constructor(e,t,r,o){super(e,t,r,o),this.origin=i.Point2d.fromJSON(e.origin),this.delta=i.Point2d.fromJSON(e.delta),this.angle=i.Angle.fromJSON(e.angle),this.baseModelId=n.Id64.fromJSON(e.baseModelId)}toJSON(){const e=super.toJSON();return e.origin=this.origin,e.delta=this.delta,e.angle=this.angle,e.baseModelId=this.baseModelId,e}getViewedModel(){const e=this.iModel.models.getLoaded(this.baseModelId);if(!e||e instanceof d.GeometricModel2dState)return e}equalState(e){return this.baseModelId===e.baseModelId&&this.origin.isAlmostEqual(e.origin)&&this.delta.isAlmostEqual(e.delta)&&this.angle.isAlmostEqualNoPeriodShift(e.angle)&&super.equalState(e)}computeFitRange(){return this.getViewedExtents()}getViewedExtents(){if(void 0===this._viewedExtents){const e=this.iModel.models.getLoaded(this.baseModelId);if(void 0!==e&&e.isGeometricModel){const t=e.getOrLoadTileTree();void 0!==t&&(this._viewedExtents=new o.AxisAlignedBox3d(t.range.low,t.range.high),t.location.multiplyRange(this._viewedExtents,this._viewedExtents))}}return void 0!==this._viewedExtents?this._viewedExtents:new o.AxisAlignedBox3d}onRenderFrame(e){}async load(){return await super.load(),this.iModel.models.load(this.baseModelId)}allow3dManipulations(){return!1}getOrigin(){return new i.Point3d(this.origin.x,this.origin.y)}getExtents(){return new i.Vector3d(this.delta.x,this.delta.y)}getRotation(){return i.Matrix3d.createRotationAroundVector(i.Vector3d.unitZ(),this.angle)}setExtents(e){this.delta.set(e.x,e.y)}setOrigin(e){this.origin.set(e.x,e.y)}setRotation(e){const t=e.getColumn(0);this.angle.setRadians(Math.atan2(t.y,t.x))}viewsModel(e){return this.baseModelId.toString()===e.toString()}forEachModel(e){const t=this.iModel.models.getLoaded(this.baseModelId);void 0!==t&&t.isGeometricModel&&e(t)}createAuxCoordSystem(e){return s.AuxCoordSystem2dState.createNew(e,this.iModel)}}t.ViewState2d=ViewState2d;t.DrawingViewState=class DrawingViewState extends ViewState2d{static createFromStateData(e,t,r){const n=new a.DisplayStyle2dState(e.displayStyleProps,r);return new this(e.viewDefinitionProps,r,t,n)}static get className(){return"DrawingViewDefinition"}getExtentLimits(){return{min:i.Constant.oneCentimeter,max:2*this.iModel.projectExtents.xLength()}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.uint16="\nfloat decodeUInt16(vec2 v) {\n  v = v * vec2(1.0, 256.0); // v.y <<= 8\n  return dot(v, vec2(1.0)); // v.x+v.y => v.x | v.y\n}\n",e.uint32="\nfloat decodeUInt32(vec3 v) {\n  v = v * vec3(1.0, 256.0, 256.0*256.0); // v.y <<= 8; v.z <<= 16\n  return dot(v, vec3(1.0)); // v.x+v.y+v.z => v.x | v.y | v.z\n}\n",e.unquantize3d="\nvec3 unquantize3d(vec3 qpos, vec3 origin, vec3 scale) { return origin + scale * qpos; }\n",e.unquantize2d="\n// params.xy = origin. params.zw = scale.\nvec2 unquantize2d(vec2 qpos, vec4 params) { return params.xy + params.zw * qpos; }\n",e.depthRgb="\nfloat decodeDepthRgb(vec3 rgb) { return dot(rgb, vec3(1.0, 1.0 / 255.0, 1.0 / 65025.0)); }\n",e.encodeDepthRgb="\nvec3 encodeDepthRgb(float depth) {\n  // 1.0 must be reduced slightly; otherwise decoding will produce zero. It's the far plane, so we don't care (and decoding produces 1.0 anyway).\n  depth = min(depth, 16777215.0/16777216.0);\n\n  vec3 enc = vec3(1.0, 255.0, 65025.0) * depth;\n  enc = fract(enc);\n  enc.xy -= enc.yz / 255.0;\n  return enc;\n}\n"}(t.GLSLDecode||(t.GLSLDecode={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(552));var n=r(573);t.PersistenceHelper=n.default;var i=r(574);t.Presentation=i.default},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){var n=r(154),i=r(740),o=r(741),s="[object Null]",a="[object Undefined]",c=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:s:c&&c in Object(e)?i(e):o(e)}},function(e,t,r){var n=r(350),i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();e.exports=o},function(e,t,r){var n=r(351),i=r(768),o=r(770);e.exports=function(e,t){return o(i(e,t,n),e+"")}},function(e,t){var r=Array.isArray;e.exports=r},function(e,t){e.exports=function(e,t,r,n){var i=r?r.call(n,e,t):void 0;if(void 0!==i)return!!i;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;var o=Object.keys(e),s=Object.keys(t);if(o.length!==s.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),c=0;c<o.length;c++){var l=o[c];if(!a(l))return!1;var u=e[l],d=t[l];if(!1===(i=r?r.call(n,u,d,l):void 0)||void 0===i&&u!==d)return!1}return!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(66),i=r(372),o=r(373),s=r(374);!function(e){e.PropertyPane="pane",e.Table="table"}(t.PropertyContainerType||(t.PropertyContainerType={}));class PropertyValueRendererManager{constructor(){this._propertyRenderers=new Map,this._defaultPrimitiveValueRenderer=new i.PrimitivePropertyValueRenderer,this._defaultArrayValueRenderer=new o.ArrayPropertyValueRenderer,this._defaultStructValueRenderer=new s.StructPropertyValueRenderer}selectRenderer(e){if(this._propertyRenderers.has(e.property.typename))return this._propertyRenderers.get(e.property.typename);switch(e.value.valueFormat){case n.PropertyValueFormat.Primitive:return this._defaultPrimitiveValueRenderer;case n.PropertyValueFormat.Array:return this._defaultArrayValueRenderer;case n.PropertyValueFormat.Struct:return this._defaultStructValueRenderer;default:return}}async render(e,t){const r=this.selectRenderer(e);if(r&&r.canRender(e,t))return await r.render(e,t)}registerRenderer(e,t,r=!1){if(!r&&this._propertyRenderers.has(e))throw Error("PropertyValueRendererManager.registerRenderer error: type '"+e+"' already registered to '"+t.constructor.name+"'");this._propertyRenderers.set(e,t)}unregisterRenderer(e){this._propertyRenderers.delete(e)}getRegisteredRenderer(e){return this._propertyRenderers.get(e)}static get defaultManager(){return this._defaultRendererManager||(this._defaultRendererManager=new PropertyValueRendererManager),this._defaultRendererManager}}t.PropertyValueRendererManager=PropertyValueRendererManager},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(221);var i,o,s;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=32768]="ERROR"}(t.BentleyStatus||(t.BentleyStatus={})),function(e){e[e.IMODEL_ERROR_BASE=65536]="IMODEL_ERROR_BASE",e[e.Success=0]="Success",e[e.AlreadyLoaded=65537]="AlreadyLoaded",e[e.AlreadyOpen=65538]="AlreadyOpen",e[e.BadArg=65539]="BadArg",e[e.BadElement=65540]="BadElement",e[e.BadModel=65541]="BadModel",e[e.BadRequest=65542]="BadRequest",e[e.BadSchema=65543]="BadSchema",e[e.CannotUndo=65544]="CannotUndo",e[e.CodeNotReserved=65545]="CodeNotReserved",e[e.DeletionProhibited=65546]="DeletionProhibited",e[e.DuplicateCode=65547]="DuplicateCode",e[e.DuplicateName=65548]="DuplicateName",e[e.ElementBlockedChange=65549]="ElementBlockedChange",e[e.FileAlreadyExists=65550]="FileAlreadyExists",e[e.FileNotFound=65551]="FileNotFound",e[e.FileNotLoaded=65552]="FileNotLoaded",e[e.ForeignKeyConstraint=65553]="ForeignKeyConstraint",e[e.IdExists=65554]="IdExists",e[e.InDynamicTransaction=65555]="InDynamicTransaction",e[e.InvalidCategory=65556]="InvalidCategory",e[e.InvalidCode=65557]="InvalidCode",e[e.InvalidCodeSpec=65558]="InvalidCodeSpec",e[e.InvalidId=65559]="InvalidId",e[e.InvalidName=65560]="InvalidName",e[e.InvalidParent=65561]="InvalidParent",e[e.InvalidProfileVersion=65562]="InvalidProfileVersion",e[e.IsCreatingChangeSet=65563]="IsCreatingChangeSet",e[e.LockNotHeld=65564]="LockNotHeld",e[e.Mismatch2d3d=65565]="Mismatch2d3d",e[e.MismatchGcs=65566]="MismatchGcs",e[e.MissingDomain=65567]="MissingDomain",e[e.MissingHandler=65568]="MissingHandler",e[e.MissingId=65569]="MissingId",e[e.NoGeometry=65570]="NoGeometry",e[e.NoMultiTxnOperation=65571]="NoMultiTxnOperation",e[e.NotDgnMarkupProject=65572]="NotDgnMarkupProject",e[e.NotEnabled=65573]="NotEnabled",e[e.NotFound=65574]="NotFound",e[e.NotOpen=65575]="NotOpen",e[e.NotOpenForWrite=65576]="NotOpenForWrite",e[e.NotSameUnitBase=65577]="NotSameUnitBase",e[e.NothingToRedo=65578]="NothingToRedo",e[e.NothingToUndo=65579]="NothingToUndo",e[e.ParentBlockedChange=65580]="ParentBlockedChange",e[e.ReadError=65581]="ReadError",e[e.ReadOnly=65582]="ReadOnly",e[e.ReadOnlyDomain=65583]="ReadOnlyDomain",e[e.RepositoryManagerError=65584]="RepositoryManagerError",e[e.SQLiteError=65585]="SQLiteError",e[e.TransactionActive=65586]="TransactionActive",e[e.UnitsMissing=65587]="UnitsMissing",e[e.UnknownFormat=65588]="UnknownFormat",e[e.UpgradeFailed=65589]="UpgradeFailed",e[e.ValidationFailed=65590]="ValidationFailed",e[e.VersionTooNew=65591]="VersionTooNew",e[e.VersionTooOld=65592]="VersionTooOld",e[e.ViewNotFound=65593]="ViewNotFound",e[e.WriteError=65594]="WriteError",e[e.WrongClass=65595]="WrongClass",e[e.WrongIModel=65596]="WrongIModel",e[e.WrongDomain=65597]="WrongDomain",e[e.WrongElement=65598]="WrongElement",e[e.WrongHandler=65599]="WrongHandler",e[e.WrongModel=65600]="WrongModel",e[e.ConstraintNotUnique=65601]="ConstraintNotUnique",e[e.NoGeoLocation=65602]="NoGeoLocation"}(t.IModelStatus||(t.IModelStatus={})),function(e){e[e.CannotAcquire=131072]="CannotAcquire",e[e.CannotDownload=131073]="CannotDownload",e[e.CannotUpload=131074]="CannotUpload",e[e.CannotCopy=131075]="CannotCopy",e[e.CannotDelete=131076]="CannotDelete",e[e.VersionNotFound=131077]="VersionNotFound",e[e.CannotApplyChanges=131078]="CannotApplyChanges"}(t.BriefcaseStatus||(t.BriefcaseStatus={})),function(e){e[e.Success=0]="Success",e[e.RPC_INTERFACE_ERROR_BASE=135168]="RPC_INTERFACE_ERROR_BASE",e[e.IncompatibleVersion=135168]="IncompatibleVersion"}(i=t.RpcInterfaceStatus||(t.RpcInterfaceStatus={})),function(e){e[e.Success=0]="Success",e[e.CHANGESET_ERROR_BASE=90112]="CHANGESET_ERROR_BASE",e[e.ApplyError=90113]="ApplyError",e[e.ChangeTrackingNotEnabled=90114]="ChangeTrackingNotEnabled",e[e.CorruptedChangeStream=90115]="CorruptedChangeStream",e[e.FileNotFound=90116]="FileNotFound",e[e.FileWriteError=90117]="FileWriteError",e[e.HasLocalChanges=90118]="HasLocalChanges",e[e.HasUncommittedChanges=90119]="HasUncommittedChanges",e[e.InvalidId=90120]="InvalidId",e[e.InvalidVersion=90121]="InvalidVersion",e[e.InDynamicTransaction=90122]="InDynamicTransaction",e[e.IsCreatingChangeSet=90123]="IsCreatingChangeSet",e[e.IsNotCreatingChangeSet=90124]="IsNotCreatingChangeSet",e[e.MergePropagationError=90125]="MergePropagationError",e[e.NothingToMerge=90126]="NothingToMerge",e[e.NoTransactions=90127]="NoTransactions",e[e.ParentMismatch=90128]="ParentMismatch",e[e.SQLiteError=90129]="SQLiteError",e[e.WrongDgnDb=90130]="WrongDgnDb",e[e.CouldNotOpenDgnDb=90131]="CouldNotOpenDgnDb",e[e.MergeSchemaChangesOnOpen=90132]="MergeSchemaChangesOnOpen",e[e.ReverseOrReinstateSchemaChangesOnOpen=90133]="ReverseOrReinstateSchemaChangesOnOpen",e[e.ProcessSchemaChangesOnOpen=90134]="ProcessSchemaChangesOnOpen",e[e.CannotMergeIntoReadonly=90135]="CannotMergeIntoReadonly",e[e.CannotMergeIntoMaster=90136]="CannotMergeIntoMaster",e[e.CannotMergeIntoReversed=90137]="CannotMergeIntoReversed"}(t.ChangeSetStatus||(t.ChangeSetStatus={})),function(e){e[e.Success=0]="Success",e[e.ServerUnavailable=86017]="ServerUnavailable",e[e.LockAlreadyHeld=86018]="LockAlreadyHeld",e[e.SyncError=86019]="SyncError",e[e.InvalidResponse=86020]="InvalidResponse",e[e.PendingTransactions=86021]="PendingTransactions",e[e.LockUsed=86022]="LockUsed",e[e.CannotCreateChangeSet=86023]="CannotCreateChangeSet",e[e.InvalidRequest=86024]="InvalidRequest",e[e.ChangeSetRequired=86025]="ChangeSetRequired",e[e.CodeUnavailable=86026]="CodeUnavailable",e[e.CodeNotReserved=86027]="CodeNotReserved",e[e.CodeUsed=86028]="CodeUsed",e[e.LockNotHeld=86029]="LockNotHeld",e[e.RepositoryIsLocked=86030]="RepositoryIsLocked"}(t.RepositoryStatus||(t.RepositoryStatus={})),function(e){e[e.Success=0]="Success",e[e.Info=94209]="Info",e[e.Redirection=94210]="Redirection",e[e.ClientError=94211]="ClientError",e[e.ServerError=94212]="ServerError"}(t.HttpStatus||(t.HttpStatus={})),function(e){e[e.Success=0]="Success",e[e.WSERROR_BASE=98304]="WSERROR_BASE",e[e.Unknown=98305]="Unknown",e[e.LoginFailed=98306]="LoginFailed",e[e.SslRequired=98307]="SslRequired",e[e.NotEnoughRights=98308]="NotEnoughRights",e[e.RepositoryNotFound=98309]="RepositoryNotFound",e[e.SchemaNotFound=98310]="SchemaNotFound",e[e.ClassNotFound=98311]="ClassNotFound",e[e.PropertyNotFound=98312]="PropertyNotFound",e[e.InstanceNotFound=98313]="InstanceNotFound",e[e.FileNotFound=98314]="FileNotFound",e[e.NotSupported=98315]="NotSupported",e[e.NoServerLicense=98316]="NoServerLicense",e[e.NoClientLicense=98317]="NoClientLicense",e[e.TooManyBadLoginAttempts=98318]="TooManyBadLoginAttempts",e[e.LoginRequired=98319]="LoginRequired"}(t.WSStatus||(t.WSStatus={})),function(e){e[e.Success=0]="Success",e[e.IMODELHUBERROR_BASE=102400]="IMODELHUBERROR_BASE",e[e.IMODELHUBERROR_REQUESTERRORBASE=102656]="IMODELHUBERROR_REQUESTERRORBASE",e[e.Unknown=102401]="Unknown",e[e.MissingRequiredProperties=102402]="MissingRequiredProperties",e[e.InvalidPropertiesValues=102403]="InvalidPropertiesValues",e[e.UserDoesNotHavePermission=102404]="UserDoesNotHavePermission",e[e.UserDoesNotHaveAccess=102405]="UserDoesNotHaveAccess",e[e.InvalidBriefcase=102406]="InvalidBriefcase",e[e.BriefcaseDoesNotExist=102407]="BriefcaseDoesNotExist",e[e.BriefcaseDoesNotBelongToUser=102408]="BriefcaseDoesNotBelongToUser",e[e.AnotherUserPushing=102409]="AnotherUserPushing",e[e.ChangeSetAlreadyExists=102410]="ChangeSetAlreadyExists",e[e.ChangeSetDoesNotExist=102411]="ChangeSetDoesNotExist",e[e.FileIsNotUploaded=102412]="FileIsNotUploaded",e[e.iModelIsNotInitialized=102413]="iModelIsNotInitialized",e[e.ChangeSetPointsToBadSeed=102414]="ChangeSetPointsToBadSeed",e[e.OperationFailed=102415]="OperationFailed",e[e.PullIsRequired=102416]="PullIsRequired",e[e.MaximumNumberOfBriefcasesPerUser=102417]="MaximumNumberOfBriefcasesPerUser",e[e.MaximumNumberOfBriefcasesPerUserPerMinute=102418]="MaximumNumberOfBriefcasesPerUserPerMinute",e[e.DatabaseTemporarilyLocked=102419]="DatabaseTemporarilyLocked",e[e.iModelIsLocked=102420]="iModelIsLocked",e[e.CodesExist=102421]="CodesExist",e[e.LocksExist=102422]="LocksExist",e[e.iModelAlreadyExists=102423]="iModelAlreadyExists",e[e.iModelDoesNotExist=102424]="iModelDoesNotExist",e[e.FileDoesNotExist=102425]="FileDoesNotExist",e[e.FileAlreadyExists=102426]="FileAlreadyExists",e[e.LockDoesNotExist=102427]="LockDoesNotExist",e[e.LockOwnedByAnotherBriefcase=102428]="LockOwnedByAnotherBriefcase",e[e.CodeStateInvalid=102429]="CodeStateInvalid",e[e.CodeReservedByAnotherBriefcase=102430]="CodeReservedByAnotherBriefcase",e[e.CodeDoesNotExist=102431]="CodeDoesNotExist",e[e.EventTypeDoesNotExist=102432]="EventTypeDoesNotExist",e[e.EventSubscriptionDoesNotExist=102433]="EventSubscriptionDoesNotExist",e[e.EventSubscriptionAlreadyExists=102434]="EventSubscriptionAlreadyExists",e[e.ProjectIdIsNotSpecified=102435]="ProjectIdIsNotSpecified",e[e.FailedToGetProjectPermissions=102436]="FailedToGetProjectPermissions",e[e.FailedToGetProjectMembers=102437]="FailedToGetProjectMembers",e[e.ChangeSetAlreadyHasVersion=102438]="ChangeSetAlreadyHasVersion",e[e.VersionAlreadyExists=102439]="VersionAlreadyExists",e[e.JobSchedulingFailed=102440]="JobSchedulingFailed",e[e.ConflictsAggregate=102441]="ConflictsAggregate",e[e.FailedToGetProjectById=102442]="FailedToGetProjectById",e[e.DatabaseOperationFailed=102443]="DatabaseOperationFailed",e[e.SeedFileInitializationFailed=102444]="SeedFileInitializationFailed",e[e.UndefinedArgumentError=102657]="UndefinedArgumentError",e[e.InvalidArgumentError=102658]="InvalidArgumentError",e[e.MissingDownloadUrlError=102659]="MissingDownloadUrlError",e[e.NotSupportedInBrowser=102660]="NotSupportedInBrowser",e[e.FileHandlerNotSet=102661]="FileHandlerNotSet",e[e.FileNotFound=102662]="FileNotFound"}(o=t.IModelHubStatus||(t.IModelHubStatus={})),function(e){e[e.Success=0]="Success",e[e.AUTHSTATUS_BASE=131072]="AUTHSTATUS_BASE",e[e.Error=131072]="Error"}(s=t.AuthStatus||(t.AuthStatus={}));t.BentleyError=class BentleyError extends Error{constructor(e,t,r,i,o){super(t),this.errorNumber=e,this._getMetaData=o,this.name=this._initName(),r&&n.Logger.logException(i||"BentleyError",this,r,this._getMetaData)}get hasMetaData(){return void 0!==this._getMetaData}getMetaData(){return this.hasMetaData?this._getMetaData():void 0}_initName(){switch(this.errorNumber){case 65537:return"Already Loaded";case 65538:return"Already Open";case 65539:return"Bad Arg";case 65540:return"Bad Element";case 65541:return"Bad Model";case 65542:return"Bad Request";case 65543:return"Bad Schema";case 65544:return"Can not Undo";case 65545:return"Code Not Reserved";case 65546:return"Deletion Prohibited";case 65547:return"Duplicate Code";case 65548:return"Duplicate Name";case 65549:return"Element Blocked Change";case 65550:return"File Already Exists";case 65551:return"File Not Found";case 65552:return"File Not Loaded";case 65553:return"ForeignKey Constraint";case 65554:return"Id Exists";case 65555:return"InDynamicTransaction";case 65556:return"Invalid Category";case 65557:return"Invalid Code";case 65558:return"Invalid CodeSpec";case 65559:return"Invalid Id";case 65560:return"Invalid Name";case 65561:return"Invalid Parent";case 65562:return"Invalid Profile Version";case 65563:return"IsCreatingChangeSet";case 65564:return"Lock Not Held";case 65565:return"Mismatch 2d3d";case 65566:return"Mismatch Gcs";case 65567:return"Missing Domain";case 65568:return"Missing Handler";case 65569:return"Missing Id";case 65570:return"No Geometry";case 65571:return"NoMultiTxnOperation";case 65572:return"NotDgnMarkupProject";case 65573:return"Not Enabled";case 65574:return"Not Found";case 65575:return"Not Open";case 65576:return"Not Open For Write";case 65577:return"Not Same Unit Base";case 65578:return"Nothing To Redo";case 65579:return"Nothing To Undo";case 65580:return"Parent Blocked Change";case 65581:return"Read Error";case 65582:return"ReadOnly";case 65583:return"ReadOnlyDomain";case 65584:return"RepositoryManagerError";case 65585:return"SQLiteError";case 65586:return"Transaction Active";case 65587:return"Units Missing";case 65588:return"Unknown Format";case 65589:return"Upgrade Failed";case 65590:return"Validation Failed";case 65591:return"Version Too New";case 65592:return"Version Too Old";case 65593:return"View Not Found";case 65594:return"Write Error";case 65595:return"Wrong Class";case 65596:return"Wrong IModel";case 65597:return"Wrong Domain";case 65598:return"Wrong Element";case 65599:return"Wrong Handler";case 65600:return"Wrong Model";case 1:return"BE_SQLITE_ERROR";case 2:return"BE_SQLITE_INTERNAL";case 3:return"BE_SQLITE_PERM";case 4:return"BE_SQLITE_ABORT";case 5:return"Db is busy";case 6:return"Db is Locked";case 7:return"BE_SQLITE_NOMEM";case 8:return"Readonly";case 9:return"BE_SQLITE_INTERRUPT";case 10:return"BE_SQLITE_IOERR";case 11:return"BE_SQLITE_CORRUPT";case 12:return"Not Found";case 13:return"BE_SQLITE_FULL";case 14:return"Can't open";case 15:return"BE_SQLITE_PROTOCOL";case 16:return"BE_SQLITE_EMPTY";case 17:return"BE_SQLITE_SCHEMA";case 18:return"BE_SQLITE_TOOBIG";case 20:return"BE_SQLITE_MISMATCH";case 21:return"BE_SQLITE_MISUSE";case 22:return"BE_SQLITE_NOLFS";case 23:return"BE_SQLITE_AUTH";case 24:return"BE_SQLITE_FORMAT";case 25:return"BE_SQLITE_RANGE";case 26:return"Not a Database";case 266:return"BE_SQLITE_IOERR_READ";case 522:return"BE_SQLITE_IOERR_SHORT_READ";case 778:return"BE_SQLITE_IOERR_WRITE";case 1034:return"BE_SQLITE_IOERR_FSYNC";case 1290:return"BE_SQLITE_IOERR_DIR_FSYNC";case 1546:return"BE_SQLITE_IOERR_TRUNCATE";case 1802:return"BE_SQLITE_IOERR_FSTAT";case 2058:return"BE_SQLITE_IOERR_UNLOCK";case 2314:return"BE_SQLITE_IOERR_RDLOCK";case 2570:return"BE_SQLITE_IOERR_DELETE";case 2826:return"BE_SQLITE_IOERR_BLOCKED";case 3082:return"BE_SQLITE_IOERR_NOMEM";case 3338:return"BE_SQLITE_IOERR_ACCESS";case 3594:return"BE_SQLITE_IOERR_CHECKRESERVEDLOCK";case 3850:return"BE_SQLITE_IOERR_LOCK";case 4106:return"BE_SQLITE_IOERR_CLOSE";case 4362:return"BE_SQLITE_IOERR_DIR_CLOSE";case 4618:return"BE_SQLITE_IOERR_SHMOPEN";case 4874:return"BE_SQLITE_IOERR_SHMSIZE";case 5130:return"BE_SQLITE_IOERR_SHMLOCK";case 5386:return"BE_SQLITE_IOERR_SHMMAP";case 5642:return"BE_SQLITE_IOERR_SEEK";case 5898:return"BE_SQLITE_IOERR_DELETE_NOENT";case 16777226:return"File Exists";case 33554442:return"Already Open";case 50331658:return"No Property Table";case 67108874:return"File Not Found";case 83886090:return"No Txn Active";case 100663306:return"Bad Db Profile";case 117440522:return"Invalid Profile Version";case 134217738:return"Profile Upgrade Failed";case 150994954:return"Profile Too Old For ReadWrite";case 167772170:return"Profile Too Old";case 184549386:return"Profile Too New For ReadWrite";case 201326602:return"Profile Too New";case 218103818:return"ChangeTrack Error";case 234881034:return"Invalid ChangeSet Version";case 251658250:return"Schema Upgrade Required";case 268435466:return"Schema Too New";case 285212682:return"Schema Too Old";case 301989898:return"Schema Lock Failed";case 318767114:return"Schema Upgrade Failed";case 335544330:return"Schema Import Failed";case 352321546:return"Could Not Acquire Locks Or Codes";case 262:return"BE_SQLITE_LOCKED_SHAREDCACHE";case 261:return"BE_SQLITE_BUSY_RECOVERY";case 270:return"SQLite No Temp Dir";case 526:return"BE_SQLITE_CANTOPEN_ISDIR";case 782:return"BE_SQLITE_CANTOPEN_FULLPATH";case 267:return"BE_SQLITE_CORRUPT_VTAB";case 264:return"BE_SQLITE_READONLY_RECOVERY";case 520:return"BE_SQLITE_READONLY_CANTLOCK";case 776:return"BE_SQLITE_READONLY_ROLLBACK";case 516:return"BE_SQLITE_ABORT_ROLLBACK";case 275:return"BE_SQLITE_CONSTRAINT_CHECK";case 531:return"CommitHook Constraint Error";case 787:return"Foreign Key Constraint Error";case 1043:return"Function Constraint Error";case 1299:return"NotNull Constraint Error";case 1555:return"Primary Key Constraint Error";case 1811:return"Trigger Constraint Error";case 2067:return"Unique Constraint Error";case 2323:return"VTable Constraint Error";case 32768:return"Error";case 131072:return"CannotAcquire";case 131073:return"CannotDownload";case 131075:return"CannotCopy";case 131076:return"CannotDelete";case 131077:return"VersionNotFound";case i.IncompatibleVersion:return"RpcInterfaceStatus.IncompatibleVersion";case 90113:return"Error applying a change set when reversing or reinstating it";case 90114:return"Change tracking has not been enabled. The ChangeSet API mandates this";case 90115:return"Contents of the change stream are corrupted and does not match the ChangeSet";case 90116:return"File containing the changes to the change set is not found";case 90117:return"Error writing the contents of the change set to the backing change stream file";case 90118:return"Cannot perform the operation since the Db has local changes";case 90119:return"Cannot perform the operation since current transaction has uncommitted changes";case 90120:return"Invalid ChangeSet Id";case 90121:return"Invalid version of the change set";case 90122:return"Cannot perform the operation since system is in the middle of a dynamic transaction";case 90123:return"Cannot perform operation since system is in the middle of a creating a change set";case 90124:return"Cannot perform operation since the system is not creating a change set";case 90125:return"Error propagating the changes after the merge";case 90126:return"No change sets to merge";case 90127:return"No transactions are available to create a change set";case 90128:return"Parent change set of the Db does not match the parent id of the change set";case 90129:return"Error performing a SQLite operation on the Db";case 90130:return"ChangeSet originated in a different Db";case 90131:return"Could not open the DgnDb to merge change set";case 90132:return"Cannot merge changes in in an open DgnDb. Close the DgnDb, and process the operation when it is opened";case 90133:return"Cannot reverse or reinstate schema changes in an open DgnDb. Close the DgnDb, and process the operation when it is opened";case 90134:return"Cannot process changes schema changes in an open DgnDb. Close the DgnDb, and process the operation when it is opened";case 90135:return"Cannot merge changes into a Readonly DgnDb";case 90136:return"Cannot merge changes into a Master DgnDb";case 90137:return"Cannot merge changes into a DgnDb that has reversed change sets";case 86017:return"ServerUnavailable";case 86018:return"LockAlreadyHeld";case 86019:return"SyncError";case 86020:return"InvalidResponse";case 86021:return"PendingTransactions";case 86022:return"LockUsed";case 86023:return"CannotCreateChangeSet";case 86024:return"InvalidRequest";case 86025:return"ChangeSetRequired";case 86026:return"CodeUnavailable";case 86027:return"CodeNotReserved";case 86028:return"CodeUsed";case 86029:return"LockNotHeld";case 86030:return"RepositoryIsLocked";case 94209:return"HTTP Info";case 94210:return"HTTP Redirection";case 94211:return"HTTP Client error";case 94212:return"HTTP Server error";case 98305:return"Unknown error";case 98311:return"Class not found";case 98314:return"File not found";case 98313:return"Instance not found";case 98306:return"Login failed";case 98317:return"No client license";case 98316:return"No server license";case 98308:return"Not enough rights";case 98315:return"Not supported";case 98312:return"Property not found";case 98309:return"Repository not found";case 98310:return"Schema not found";case 98307:return"SSL required";case 98318:return"Too many bad login attempts";case o.Unknown:return"Unknown error";case o.MissingRequiredProperties:return"Missing required properties";case o.InvalidPropertiesValues:return"Invalid properties values";case o.UserDoesNotHavePermission:return"User does not have permission";case o.UserDoesNotHaveAccess:return"User does not have access";case o.InvalidBriefcase:return"Invalid briefcase";case o.BriefcaseDoesNotExist:return"Briefcase does not exist";case o.BriefcaseDoesNotBelongToUser:return"Briefcase does not belong to user";case o.AnotherUserPushing:return"Another user pushing";case o.ChangeSetAlreadyExists:return"ChangeSet already exists";case o.ChangeSetDoesNotExist:return"ChangeSet does not exist";case o.FileIsNotUploaded:return"File is not uploaded";case o.iModelIsNotInitialized:return"iModel is not initialized";case o.ChangeSetPointsToBadSeed:return"ChangeSet points to a bad seed file";case o.OperationFailed:return"iModelHub operation has failed";case o.PullIsRequired:return"Pull is required";case o.MaximumNumberOfBriefcasesPerUser:return"Limit of briefcases per user was reached";case o.MaximumNumberOfBriefcasesPerUserPerMinute:return"Limit of briefcases per user per minute was reached";case o.DatabaseTemporarilyLocked:return"Database is temporarily locked";case o.iModelIsLocked:return"iModel is locked";case o.CodesExist:return"Code already exists";case o.LocksExist:return"Lock already exists";case o.iModelAlreadyExists:return"iModel already exists";case o.iModelDoesNotExist:return"iModel does not exist";case o.LockDoesNotExist:return"Lock does not exist";case o.LockOwnedByAnotherBriefcase:return"Lock is owned by another briefcase";case o.CodeStateInvalid:return"Code state is invalid";case o.CodeReservedByAnotherBriefcase:return"Code is reserved by another briefcase";case o.CodeDoesNotExist:return"Code does not exist";case o.FileDoesNotExist:return"File does not exist";case o.FileAlreadyExists:return"File already exists";case o.EventTypeDoesNotExist:return"Event type does not exist";case o.EventSubscriptionDoesNotExist:return"Event subscription does not exist";case o.EventSubscriptionAlreadyExists:return"Event subscription already exists";case o.ProjectIdIsNotSpecified:return"Project Id is not specified";case o.FailedToGetProjectPermissions:return"Failed to get project permissions";case o.FailedToGetProjectMembers:return"Failed to get project members";case o.ChangeSetAlreadyHasVersion:return"ChangeSet already has version";case o.VersionAlreadyExists:return"Version already exists";case o.JobSchedulingFailed:return"Failed to schedule a background job";case o.ConflictsAggregate:return"Codes or locks are owned by another briefcase";case o.FailedToGetProjectById:return"Failed to query project by its id";case o.DatabaseOperationFailed:return"Database operation has failed";case o.UndefinedArgumentError:return"Undefined argument";case o.InvalidArgumentError:return"Invalid argument";case o.MissingDownloadUrlError:return"Missing download url";case o.NotSupportedInBrowser:return"Not supported in browser";case o.FileHandlerNotSet:return"File handler is not set";case o.FileNotFound:return"File not found";case s.Error:return"Authorization error";case 0:case 0:case 100:case 101:case 0:return"Success";default:return"Error ("+this.errorNumber+")"}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(228),i=r(229),o=r(29),s=r(56),a=r(81),c=r(226);class ImsFederatedAuthenticationClient extends a.Client{constructor(){super()}getUrlSearchKey(){return ImsFederatedAuthenticationClient.searchKey}static parseTokenResponse(e){const t=n.useNamespaces({trust:"http://docs.oasis-open.org/ws-sx/ws-trust/200512"})("//saml:Assertion",(new i.DOMParser).parseFromString(e)).toString();if(t)return c.AuthorizationToken.fromSamlAssertion(t)}}ImsFederatedAuthenticationClient.searchKey="IMS.FederatedAuth.Url",t.ImsFederatedAuthenticationClient=ImsFederatedAuthenticationClient;class ImsActiveSecureTokenClient extends a.Client{constructor(){super()}getUrlSearchKey(){return ImsActiveSecureTokenClient.searchKey}async setupOptionDefaults(e){await super.setupOptionDefaults(e),e.useCorsProxy=!1}async getToken(e,t,r,n){const i=await this.getUrl(e),a=n?`imodeljs ${n}`:"imodeljs",l={method:"POST",auth:{user:t,password:r},body:{AppliesTo:s.Config.App.get("imjs_default_relying_party_uri"),DeviceId:"undefined"===typeof window?"backend":"frontend",AppId:a,Lifetime:10080}};return await this.setupOptionDefaults(l),o.request(e,i,l).then(e=>{if(!e.body.RequestedSecurityToken)return Promise.reject(new Error("Authorization token not in expected format "+JSON.stringify(e)));const t=c.AuthorizationToken.fromSamlAssertion(e.body.RequestedSecurityToken);return t?Promise.resolve(t):Promise.reject(new Error("Could not parse the authorization token"))})}}ImsActiveSecureTokenClient.searchKey="Mobile.ImsStsAuth",t.ImsActiveSecureTokenClient=ImsActiveSecureTokenClient;class ImsDelegationSecureTokenClient extends a.Client{constructor(){super()}getUrlSearchKey(){return ImsDelegationSecureTokenClient.searchKey}async setupOptionDefaults(e){await super.setupOptionDefaults(e),e.useCorsProxy=!1}async getToken(e,t,r,n){const i=await this.getUrl(e)+"/json/IssueEx";r||(r=s.Config.App.get("imjs_default_relying_party_uri"));const a=n?`imodeljs ${n}`:"imodeljs",l={method:"POST",headers:{authorization:t.toTokenString(),"User-Agent":a},body:{ActAs:t.getSamlAssertion(),AppliesTo:r,AppliesToBootstrapToken:r,DeviceId:"undefined"===typeof window?"backend":"frontend",AppId:a,Lifetime:60}};return await this.setupOptionDefaults(l),o.request(e,i,l).then(e=>{if(!e.body.RequestedSecurityToken)return Promise.reject(new Error("Authorization token not in expected format "+JSON.stringify(e)));const t=c.AccessToken.fromSamlAssertion(e.body.RequestedSecurityToken);return t?Promise.resolve(t):Promise.reject(new Error("Could not parse the accessToken token"))})}}ImsDelegationSecureTokenClient.searchKey="ActiveSTSDelegationServiceUrl",t.ImsDelegationSecureTokenClient=ImsDelegationSecureTokenClient},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(232)),n(r(57)),n(r(18)),n(r(438)),n(r(439)),n(r(243)),n(r(440)),n(r(245)),n(r(441)),n(r(442)),n(r(443)),n(r(444)),n(r(246))},function(e,t,r){"use strict";(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,r,n,i){if("function"!==typeof e)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,r)});case 3:return t.nextTick(function(){e.call(null,r,n)});case 4:return t.nextTick(function(){e.call(null,r,n,i)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return t.nextTick(function(){e.apply(null,o)})}}}:e.exports=t}).call(this,r(48))},function(e,t,r){var n=r(36),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),o(i,s),s.from=function(e,t,r){if("number"===typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!==typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"===typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(24);class KnotVector{constructor(e,t){this.degree=t,this._possibleWrap=!1,this._knot0=0,this._knot1=1,Array.isArray(e)?(this.knots=new Float64Array(e.length),this.setKnots(e),this.setupFixedValues()):e instanceof Float64Array?(this.knots=e.slice(),this.setupFixedValues()):this.knots=new Float64Array(e)}get leftKnot(){return this._knot0}get rightKnot(){return this._knot1}get leftKnotIndex(){return this.degree-1}get rightKnotIndex(){return this.knots.length-this.degree}get wrappable(){return this._possibleWrap}set wrappable(e){this._possibleWrap=e}get numSpans(){return this.rightKnotIndex-this.leftKnotIndex}clone(){return new KnotVector(this.knots,this.degree)}setupFixedValues(){this._knot0=this.knots[this.degree-1],this._knot1=this.knots[this.knots.length-this.degree]}get knotLength01(){return this._knot1-this._knot0}isAlmostEqual(e){return this.degree===e.degree&&i.NumberArray.isAlmostEqual(this.knots,e.knots,KnotVector.knotTolerance)}setKnots(e,t){const r=t?e.length-2:e.length;if(r!==this.knots.length&&(this.knots=new Float64Array(r)),t)for(let n=1;n+1<e.length;n++)this.knots[n-1]=e[n];else for(let n=0;n<e.length;n++)this.knots[n]=e[n];this.setupFixedValues()}static createUniformClamped(e,t,r,n){const i=new KnotVector(e+t-1,t);let o=0;for(let a=0;a<t;a++)i.knots[o++]=r;const s=1/(e-t);for(let a=1;a+t<e;a++)i.knots[o++]=r+a*s*(n-r);for(let a=0;a<t;a++)i.knots[o++]=n;return i.setupFixedValues(),i}static create(e,t,r){const n=r?e.length-2:e.length,i=new KnotVector(n,t);return i.setKnots(e,r),i}grevilleKnot(e){if(e<0)return this.leftKnot;if(e>this.rightKnotIndex)return this.rightKnot;let t=0;for(let r=e;r<e+this.degree;r++)t+=this.knots[r];return t/this.degree}createBasisArray(){return new Float64Array(this.degree+1)}baseKnotFractionToKnot(e,t){const r=this.knots[e];return r+t*(this.knots[e+1]-r)}spanFractionToKnot(e,t){const r=this.spanIndexToLeftKnotIndex(e);return this.knots[r]+t*(this.knots[r+1]-this.knots[r])}spanFractionToFraction(e,t){return(this.spanFractionToKnot(e,t)-this.leftKnot)/(this.rightKnot-this.leftKnot)}fractionToKnot(e){return n.Geometry.interpolate(this.knots[this.degree-1],e,this.knots[this.knots.length-this.degree])}evaluateBasisFunctions(e,t,r){if(r[0]=1,this.degree<1)return;const n=this.knots[e],i=this.knots[e+1];if(r[1]=(t-n)/(i-n),r[0]=1-r[1],!(this.degree<2))for(let o=1;o<this.degree;o++){let n=e-o,i=n+o+1,s=0;for(let e=0;e<=o;e++){const o=this.knots[n++],a=(t-o)/(this.knots[i++]-o),c=r[e]*a,l=r[e]*(1-a);r[e]=s+l,s=c}r[o+1]=s}}evaluateBasisFunctions1(e,t,r,n,i){if(r[0]=1,n[0]=0,this.degree<1)return;const o=this.knots[e];let s=1/(this.knots[e+1]-o);if(r[1]=(t-o)*s,r[0]=1-r[1],n[0]=-s,n[1]=s,i&&(i[0]=0,i[1]=0),!(this.degree<2))for(let a=1;a<this.degree;a++){let o=e-a,c=o+a+1,l=0,u=0,d=0;for(let e=0;e<=a;e++){const a=this.knots[o++],h=(t-a)*(s=1/(this.knots[c++]-a)),p=1-h,f=r[e]*h,g=r[e]*p,m=n[e]*h+r[e]*s,y=n[e]*p-r[e]*s,v=2*n[e]*s;if(r[e]=l+g,n[e]=u+y,l=f,u=m,i){const t=i[e]*h+v,r=i[e]*p-v;i[e]=d+r,d=t}}r[a+1]=l,n[a+1]=u,i&&(i[a+1]=d)}}knotToLeftKnotIndex(e){const t=this.degree-1;if(e<this.knots[t+1])return t;const r=this.knots.length-this.degree-1;if(e>=this.knots.length-this.degree)return this.knots[r];for(let n=t+1;n<r;n++)if(e<this.knots[n+1])return n;return r}spanIndexToLeftKnotIndex(e){const t=this.degree;return e<=0?t-1:Math.min(e+t-1,this.knots.length-t)}spanIndexToSpanLength(e){const t=this.spanIndexToLeftKnotIndex(e);return this.knots[t+1]-this.knots[t]}isIndexOfRealSpan(e){return e>=0&&e<this.knots.length-this.degree&&!n.Geometry.isSmallMetricDistance(this.spanIndexToSpanLength(e))}reflectKnots(){const e=this.leftKnot,t=this.rightKnot,r=this.knots.length;for(let n=0;n<r;n++)this.knots[n]=e+(t-this.knots[n]);this.knots.reverse()}copyKnots(e){const t=[];e&&t.push(this.knots[0]);for(const r of this.knots)t.push(r);return e&&t.push(t[t.length-1]),t}}KnotVector.knotTolerance=1e-9,t.KnotVector=KnotVector},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5);class Segment1d{constructor(e,t){this.x0=e,this.x1=t}set(e,t){this.x0=e,this.x1=t}static create(e=0,t=1,r){return r?(r.set(e,t),r):new Segment1d(e,t)}setFrom(e){this.x0=e.x0,this.x1=e.x1}clone(){return new Segment1d(this.x0,this.x1)}get isIn01(){return n.Geometry.isIn01(this.x0)&&n.Geometry.isIn01(this.x1)}fractionToPoint(e){return n.Geometry.interpolate(this.x0,e,this.x1)}reverseInPlace(){const e=this.x0;this.x0=this.x1,this.x1=e}isAlmostEqual(e){return n.Geometry.isSameCoordinate(this.x0,e.x0)&&n.Geometry.isSameCoordinate(this.x1,e.x1)}get isExact01(){return 0===this.x0&&1===this.x1}}t.Segment1d=Segment1d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6);!function(e){e[e.StronglyInside=1]="StronglyInside",e[e.Ambiguous=2]="Ambiguous",e[e.StronglyOutside=3]="StronglyOutside"}(t.ClipPlaneContainment||(t.ClipPlaneContainment={})),function(e){e[e.ClipRequired=0]="ClipRequired",e[e.TrivialReject=1]="TrivialReject",e[e.TrivialAccept=2]="TrivialAccept"}(t.ClipStatus||(t.ClipStatus={}));class ClipUtilities{static selectIntervals01(e,t,r,n){t.push(0),t.push(1),t.sort();let i,o,s=t.at(0);const a=ClipUtilities._selectIntervals01TestPoint,c=t.length;for(let l=1;l<c;l++,s=i)if(o=.5*(s+(i=t.at(l))),i>s&&o>=0&&o<=1&&(e.fractionToPoint(o,a),r.isPointOnOrInside(a))){if(!n)return!0;n(s,i,e)}return!1}static announceNNC(e,t,r){if(r)for(const n of e)r(n.low,n.high,t);return e.length>0}static collectClippedCurves(e,t){const r=[];return e.announceClipIntervals(t,(e,t,n)=>{if(t!==e){const i=n.clonePartialCurve(e,t);i&&r.push(i)}}),r}static clipPolygonToClipShape(e,t){const r=[];return t.fetchClipPlanesRef().polygonClip(e,r),r}static pointSetSingleClipStatus(e,t,r){if(0===t.convexSets.length)return 2;for(const i of t.convexSets){let t=!1,o=!1;for(const s of i.planes){let i=0,a=0;const c=s.distance-r,l=n.Point3d.create(),u=n.Vector3d.create();for(let t=0;t<e.length;t++)e.getPoint3dAt(t,l),u.setFrom(l),u.dotProduct(s.inwardNormalRef)>c?i++:a++;if(o=0!==a||o,0===i){t=!0;break}}if(!o)return 2;if(!t)return 0}return 1}}ClipUtilities._selectIntervals01TestPoint=n.Point3d.create(),t.ClipUtilities=ClipUtilities},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(33),i=r(39);class ParityRegion extends n.CurveCollection{isSameGeometryClass(e){return e instanceof ParityRegion}get children(){return this._children}constructor(){super(),this._children=[]}static create(...e){const t=new ParityRegion;for(const r of e)t.children.push(r);return t}dgnBoundaryType(){return 4}announceToCurveProcessor(e,t=-1){return e.announceParityRegion(this,t)}clone(){const e=new ParityRegion;let t;for(t of this.children){const r=t.clone();r instanceof i.Loop&&e.children.push(r)}return e}cloneStroked(e){const t=new ParityRegion;let r;for(r of this.children){const n=r.cloneStroked(e);n&&t.children.push(n)}return t}cloneEmptyPeer(){return new ParityRegion}tryAddChild(e){return e instanceof i.Loop&&(this._children.push(e),!0)}getChild(e){if(e<this._children.length)return this._children[e]}dispatchToGeometryHandler(e){return e.handleParityRegion(this)}}t.ParityRegion=ParityRegion},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(14),i=r(33);class Path extends i.CurveChain{isSameGeometryClass(e){return e instanceof Path}announceToCurveProcessor(e,t=-1){return e.announcePath(this,t)}constructor(){super()}static create(...e){const t=new Path;for(const r of e)t.children.push(r);return t}static createArray(e){const t=new Path;for(const r of e)t.children.push(r);return t}cloneStroked(e){const t=n.LineString3d.create();for(const r of this.children)r.emitStrokes(t,e);return Path.create(t)}dgnBoundaryType(){return 1}cyclicCurvePrimitive(e){if(e>=0&&e<this.children.length)return this.children[e]}cloneEmptyPeer(){return new Path}dispatchToGeometryHandler(e){return e.handlePath(this)}}t.Path=Path},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(251),i=r(271),o=r(170),s=r(14),a=r(127),c=r(39),l=r(24);class SweepContour{constructor(e,t){this.curves=e,this.localToWorld=t}static createForLinearSweep(e,t){const r=n.FrameBuilder.createRightHandedFrame(t,e);if(r)return new SweepContour(e,r)}static createForRotation(e,t){const r=n.FrameBuilder.createRightHandedFrame(void 0,e,t);if(r)return new SweepContour(e,r)}getCurves(){return this.curves}tryTransformInPlace(e){return e.multiplyTransformTransform(this.localToWorld,this.localToWorld),!0}clone(){return new SweepContour(this.curves.clone(),this.localToWorld.clone())}cloneTransformed(e){const t=this.clone();if(t.tryTransformInPlace(e))return t}isAlmostEqual(e){return e instanceof SweepContour&&(this.curves.isAlmostEqual(e.curves)&&this.localToWorld.isAlmostEqual(e.localToWorld))}buildFacets(e,t){if(!this._facets)if(this.curves instanceof c.Loop){if(this._xyStrokes=this.curves.cloneStroked(t),this._xyStrokes instanceof c.Loop&&1===this._xyStrokes.children.length){const e=this._xyStrokes.children[0].points;this.localToWorld.multiplyInversePoint3dArrayInPlace(e),l.PolygonOps.sumTriangleAreasXY(e)<0&&e.reverse();const r=o.Triangulator.earcutSingleLoop(e),n=i.PolyfaceBuilder.graphToPolyface(r,t);this._facets=n,this._facets.tryTransformInPlace(this.localToWorld)}}else if(this.curves instanceof a.ParityRegion&&(this._xyStrokes=this.curves.cloneStroked(t),this._xyStrokes instanceof a.ParityRegion)){this._xyStrokes.tryTransformInPlace(this.localToWorld);const e=[];for(const t of this._xyStrokes.children){const r=t.children;if(1===r.length){const t=r[0];t instanceof s.LineString3d&&e.push(t.packedPoints)}}const r=o.Triangulator.triangulateStrokedLoops(e);if(r){const e=i.PolyfaceBuilder.graphToPolyface(r,t);this._facets=e,this._facets.tryTransformInPlace(this.localToWorld)}}}emitFacets(e,t,r){this.buildFacets(e,e.options),this._facets&&e.addIndexedPolyface(this._facets,t,r)}}t.SweepContour=SweepContour},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(6),o=r(23),s=r(24),a=r(37),c=r(50),l=r(464);function u(e,t,r){return void 0!==e&&void 0!==t&&void 0!==r}function d(e,t,r){if(!t||0===t.length)return!0;if(t.length>0&&e[e.length-1]===t.length){for(let n=0;n+1<e.length;n++){let i=e[n],o=e[n+1];if(r)for(;o>i+2;){o--;const e=t[++i];t[i]=t[o],t[o]=e}else for(;o>i+1;){o--;const e=t[i];t[i]=t[o],t[o]=e,i++}}return!0}return!1}class FacetFaceData{get paramDistanceRange(){return this._paramDistanceRange}get paramRange(){return this._paramRange}constructor(e,t){this._paramDistanceRange=e,this._paramRange=t}static createNull(){return new FacetFaceData(o.Range2d.createNull(),o.Range2d.createNull())}clone(e){return e?(this._paramDistanceRange.clone(e._paramDistanceRange),this._paramRange.clone(e._paramRange),e):new FacetFaceData(this._paramDistanceRange.clone(),this._paramRange.clone())}null(){this._paramDistanceRange.setNull(),this._paramRange.setNull()}convertParamToDistance(e,t){t=t||n.Point2d.create();const r=this._paramRange.high.minus(this._paramRange.low);return t.x=0===r.x?e.x:this._paramDistanceRange.low.x+(e.x-this._paramRange.low.x)*(this._paramDistanceRange.high.x-this._paramDistanceRange.low.x)/r.x,t.y=0===r.y?e.y:this.paramDistanceRange.low.y+(e.y-this._paramRange.low.y)*(this._paramDistanceRange.high.y-this._paramDistanceRange.low.y)/r.y,t}convertParamToNormalized(e,t){t=t||n.Point2d.create();const r=this._paramRange.high.minus(this._paramRange.low);return t.x=0===r.x?e.x:(e.x-this._paramRange.low.x)/r.x,t.y=0===r.y?e.y:(e.y-this._paramRange.low.y)/r.y,t}scaleDistances(e){this._paramDistanceRange.low.x*=e,this._paramDistanceRange.low.y*=e,this._paramDistanceRange.high.x*=e,this._paramDistanceRange.high.y*=e}setParamDistanceRangeFromNewFaceData(e,t,r){const o=n.Point2d.create(),s=n.Point2d.create();let a=0;const c=IndexedPolyfaceVisitor.create(e,0);if(!c.moveToReadIndex(t))return!1;do{const e=c.numEdgesThisFacet,t=c.point,r=[],l=c.param,u=[];if(!l)return!1;for(let c=0;c<e;c++){if(r[2]=c,u[2]=c,c>1){const e=l[u[0]].minus(l[u[1]]),c=l[u[1]].minus(l[u[2]]),d=t.getPoint3dAt(r[0]).minus(t.getPoint3dAt(r[1])),h=t.getPoint3dAt(r[1]).minus(t.getPoint3dAt(r[2])),p=Math.abs(e.x*c.y-c.x*e.y);if(p){const t=i.Point3d.createFrom(d);t.scaleInPlace(c.y),t.addScaledInPlace(h,-e.y);const r=i.Point3d.createFrom(h);r.scaleInPlace(e.x),r.addScaledInPlace(d,-c.x);const l=n.Point2d.create(t.magnitude()/p,r.magnitude()/p);o.x+=l.x,o.y+=l.y,s.x+=l.x*l.x,s.y+=l.y*l.y,a++}}u[0]=u[1],u[1]=u[2],r[0]=r[1],r[1]=r[2]}}while(c.moveToNextFacet()&&c.currentReadIndex()<r);if(0!==a){const e=n.Point2d.create(o.x/a,o.y/a),t=n.Point2d.create(Math.sqrt(Math.abs(s.x/a-e.x*e.x)),Math.sqrt(Math.abs(s.y/a-e.y*e.y)));this._paramDistanceRange.low.set(0,0),this._paramDistanceRange.high.set((e.x+t.x)*(this._paramRange.high.x-this._paramRange.low.x),(e.y+t.y)*(this._paramRange.high.y-this._paramRange.low.y))}return!0}}var h;t.FacetFaceData=FacetFaceData,function(e){e[e.Scalar=0]="Scalar",e[e.Distance=1]="Distance",e[e.Vector=2]="Vector",e[e.Normal=3]="Normal"}(h=t.AuxChannelDataType||(t.AuxChannelDataType={}));class AuxChannelData{constructor(e,t){this.input=e,this.values=t}copyValues(e,t,r,n){for(let i=0;i<n;i++)this.values[t*n+i]=e.values[r*n+i]}clone(){return new AuxChannelData(this.input,this.values.slice())}isAlmostEqual(e,t){const r=t||1e-8;return Math.abs(this.input-e.input)<r&&s.NumberArray.isAlmostEqual(this.values,e.values,r)}}t.AuxChannelData=AuxChannelData;class AuxChannel{constructor(e,t,r,n){this.data=e,this.dataType=t,this.name=r,this.inputName=n}clone(){const e=[];for(const t of this.data)e.push(t.clone());return new AuxChannel(e,this.dataType,this.name,this.inputName)}isAlmostEqual(e,t){if(this.dataType!==e.dataType||this.name!==e.name||this.inputName!==e.inputName||this.data.length!==e.data.length)return!1;for(let r=0;r<this.data.length;r++)if(!this.data[r].isAlmostEqual(e.data[r],t))return!1;return!0}get isScalar(){return this.dataType===h.Distance||this.dataType===h.Scalar}get entriesPerValue(){return this.isScalar?1:3}get valueCount(){return 0===this.data.length?0:this.data[0].values.length/this.entriesPerValue}get scalarRange(){if(!this.isScalar)return;const e=o.Range1d.createNull();for(const t of this.data)e.extendArray(t.values);return e}}t.AuxChannel=AuxChannel;class PolyfaceAuxData{constructor(e,t){this.channels=e,this.indices=t}clone(){const e=[];for(const t of this.channels)e.push(t.clone());return new PolyfaceAuxData(e,this.indices.slice())}isAlmostEqual(e,t){if(!s.NumberArray.isExactEqual(this.indices,e.indices)||this.channels.length!==e.channels.length)return!1;for(let r=0;r<this.channels.length;r++)if(!this.channels[r].isAlmostEqual(e.channels[r],t))return!1;return!0}createForVisitor(){const e=[];for(const t of this.channels){const r=[];for(const e of t.data)r.push(new AuxChannelData(e.input,[]));e.push(new AuxChannel(r,t.dataType,t.name,t.inputName))}return new PolyfaceAuxData(e,[])}}t.PolyfaceAuxData=PolyfaceAuxData;class PolyfaceData{constructor(e=!1,t=!1,r=!1){this.point=new a.GrowableXYZArray,this.pointIndex=[],this.edgeVisible=[],this.face=[],e&&(this.normal=[],this.normalIndex=[]),t&&(this.param=[],this.paramIndex=[]),r&&(this.color=[],this.colorIndex=[])}clone(){const e=new PolyfaceData;return e.point=this.point.clone(),e.pointIndex=this.pointIndex.slice(),e.edgeVisible=this.edgeVisible.slice(),e.face=this.face.slice(),this.normal&&(e.normal=s.Vector3dArray.cloneVector3dArray(this.normal)),this.param&&(e.param=s.Point2dArray.clonePoint2dArray(this.param)),this.color&&(e.color=this.color.slice()),this.normalIndex&&(e.normalIndex=this.normalIndex.slice()),this.paramIndex&&(e.paramIndex=this.paramIndex.slice()),this.colorIndex&&(e.colorIndex=this.colorIndex.slice()),this.auxData&&(e.auxData=this.auxData.clone()),e}isAlmostEqual(e){return!!a.GrowableXYZArray.isAlmostEqual(this.point,e.point)&&(!!s.NumberArray.isExactEqual(this.pointIndex,e.pointIndex)&&(!!s.Vector3dArray.isAlmostEqual(this.normal,e.normal)&&(!!s.NumberArray.isExactEqual(this.normalIndex,e.normalIndex)&&(!!s.Point2dArray.isAlmostEqual(this.param,e.param)&&(!!s.NumberArray.isExactEqual(this.paramIndex,e.paramIndex)&&(!!s.NumberArray.isExactEqual(this.color,e.color)&&(!!s.NumberArray.isExactEqual(this.colorIndex,e.colorIndex)&&!!s.NumberArray.isExactEqual(this.edgeVisible,e.edgeVisible))))))))}get requireNormals(){return void 0!==this.normal}get pointCount(){return this.point.length}get normalCount(){return this.normal?this.normal.length:0}get paramCount(){return this.param?this.param.length:0}get colorCount(){return this.color?this.color.length:0}get indexCount(){return this.pointIndex.length}get faceCount(){return this.face.length}getPoint(e){return this.point.getPoint3dAt(e)}getNormal(e){return this.normal?this.normal[e]:i.Vector3d.create()}getParam(e){return this.param?this.param[e]:n.Point2d.create()}getColor(e){return this.color?this.color[e]:0}getEdgeVisible(e){return this.edgeVisible[e]}copyPointTo(e,t){this.point.getPoint3dAt(e,t)}copyNormalTo(e,t){this.normal&&t.setFrom(this.normal[e])}copyParamTo(e,t){this.param&&t.setFrom(this.param[e])}gatherIndexedData(e,t,r,n){const i=r-t,o=i+n;this.resizeAllDataArrays(o);for(let s=0;s<i;s++)this.point.transferFromGrowableXYZArray(s,e.point,e.pointIndex[t+s]);for(let s=0;s<n;s++)this.point.transferFromGrowableXYZArray(i+s,this.point,s);for(let s=0;s<i;s++)this.pointIndex[s]=e.pointIndex[t+s];for(let s=0;s<n;s++)this.pointIndex[i+s]=this.pointIndex[s];for(let s=0;s<i;s++)this.edgeVisible[s]=e.edgeVisible[t+s];for(let s=0;s<n;s++)this.edgeVisible[i+s]=this.edgeVisible[s];if(this.normal&&this.normalIndex&&e.normal&&e.normalIndex){for(let r=0;r<i;r++)this.normal[r].setFrom(e.normal[e.normalIndex[t+r]]);for(let e=0;e<n;e++)this.normal[i+e].setFrom(this.normal[e]);for(let r=0;r<i;r++)this.normalIndex[r]=e.normalIndex[t+r];for(let e=0;e<n;e++)this.normalIndex[i+e]=this.normalIndex[e]}if(this.param&&this.paramIndex&&e.param&&e.paramIndex){for(let r=0;r<i;r++)this.param[r].setFrom(e.param[e.paramIndex[t+r]]);for(let e=0;e<n;e++)this.param[i+e].setFrom(this.param[e]);for(let r=0;r<i;r++)this.paramIndex[r]=e.paramIndex[t+r];for(let e=0;e<n;e++)this.paramIndex[i+e]=this.paramIndex[e]}if(this.color&&this.colorIndex&&e.color&&e.colorIndex){for(let r=0;r<i;r++)this.color[r]=e.color[this.colorIndex[t+r]];for(let e=0;e<n;e++)this.color[i+e]=this.color[e];for(let r=0;r<i;r++)this.colorIndex[r]=e.colorIndex[t+r];for(let e=0;e<n;e++)this.colorIndex[i+e]=this.colorIndex[e]}if(this.auxData&&e.auxData&&this.auxData.channels.length===e.auxData.channels.length){for(let r=0;r<this.auxData.channels.length;r++){const o=this.auxData.channels[r],s=e.auxData.channels[r],a=o.entriesPerValue;if(o.data.length===s.data.length)for(let e=0;e<o.data.length;e++){const r=o.data[e],c=s.data[e];for(let e=0;e<i;e++)r.copyValues(c,e,t+e,a);for(let e=0;e<n;e++)r.copyValues(r,i+e,e,a)}}for(let r=0;r<i;r++)this.auxData.indices[r]=e.auxData.indices[t+r];for(let e=0;e<n;e++)this.auxData.indices[i+e]=this.auxData.indices[e]}}static trimArray(e,t){e&&t<e.length&&(e.length=t)}trimAllIndexArrays(e){if(PolyfaceData.trimArray(this.pointIndex,e),PolyfaceData.trimArray(this.paramIndex,e),PolyfaceData.trimArray(this.normalIndex,e),PolyfaceData.trimArray(this.colorIndex,e),PolyfaceData.trimArray(this.edgeVisible,e),this.auxData){PolyfaceData.trimArray(this.auxData.indices,e);for(const t of this.auxData.channels)for(const r of t.data)PolyfaceData.trimArray(r.values,t.entriesPerValue*e)}}resizeAllDataArrays(e){if(e>this.point.length){for(;this.point.length<e;)this.point.push(i.Point3d.create());for(;this.pointIndex.length<e;)this.pointIndex.push(-1);for(;this.edgeVisible.length<e;)this.edgeVisible.push(!1);if(this.normal)for(;this.normal.length<e;)this.normal.push(i.Vector3d.create());if(this.param)for(;this.param.length<e;)this.param.push(n.Point2d.create());if(this.color)for(;this.color.length<e;)this.color.push(0);if(this.auxData)for(const t of this.auxData.channels)for(const r of t.data)for(;r.values.length<e*t.entriesPerValue;)r.values.push(0)}else if(e<this.point.length&&(this.point.resize(e),this.edgeVisible.length=e,this.pointIndex.length=e,this.normal&&(this.normal.length=e),this.param&&(this.param.length=e),this.color&&(this.color.length=e),this.auxData))for(const t of this.auxData.channels)for(const r of t.data)r.values.length=e*t.entriesPerValue}range(e,t){return(e=e||o.Range3d.createNull()).extendArray(this.point,t),e}reverseIndices(e){e&&function(e){if(0===e.length)return!1;for(let t=0;t+1<e.length;t++)if(e[t]>=e[t+1])return!1;return!0}(e)&&(d(e,this.pointIndex,!0),d(e,this.normalIndex,!0),d(e,this.paramIndex,!0),d(e,this.colorIndex,!0),d(e,this.edgeVisible,!1))}reverseNormals(){if(this.normal)for(const e of this.normal)e.scaleInPlace(-1)}tryTransformInPlace(e){const t=e.matrix.inverse();return this.point.transformInPlace(e),t&&this.normal&&t.multiplyVectorArrayInPlace(this.normal),!0}compress(){const e=l.ClusterableArray.clusterGrowablePoint3dArray(this.point);this.point=e.growablePackedPoints,e.updateIndices(this.pointIndex)}}PolyfaceData.planarityLocalRelTol=1e-13,t.PolyfaceData=PolyfaceData;class Polyface extends c.GeometryQuery{constructor(e){super(),this._twoSided=!1,this.data=e}get twoSided(){return this._twoSided}set twoSided(e){this._twoSided=e}}t.Polyface=Polyface;class IndexedPolyface extends Polyface{isSameGeometryClass(e){return e instanceof IndexedPolyface}isAlmostEqual(e){return e instanceof IndexedPolyface&&(this.data.isAlmostEqual(e.data)&&s.NumberArray.isExactEqual(this._facetStart,e._facetStart)&&s.NumberArray.isExactEqual(this._facetToFaceData,e._facetToFaceData))}tryTransformInPlace(e){if(this.data.tryTransformInPlace(e)){e.matrix.determinant()<0&&(this.reverseIndices(),this.reverseNormals())}return!1}clone(){return new IndexedPolyface(this.data.clone(),this._facetStart.slice(),this._facetToFaceData.slice())}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}reverseIndices(){this.data.reverseIndices(this._facetStart)}reverseNormals(){this.data.reverseNormals()}tryGetFaceData(e){const t=this._facetToFaceData[e];if(!(t>=this.data.face.length))return this.data.face[t]}constructor(e,t,r){super(e),t?this._facetStart=t.slice():(this._facetStart=[],this._facetStart.push(0)),this._facetToFaceData=r?r.slice():[]}addIndexedPolyface(e,t,r){const n=u(this.data.param,e.data.param,e.data.paramIndex),o=u(this.data.normal,e.data.normal,e.data.normalIndex),s=new a.GrowableFloat64Array;s.ensureCapacity(e.data.pointCount);const c=e.data.point,l=i.Point3d.create();for(let i=0,a=e.data.point.length;i<a;i++)c.getPoint3dAt(i,l),r?(r.multiplyPoint3d(l,l),s.push(this.addPoint(l))):s.push(this.addPoint(l));const d=e._facetStart.length-1;for(let i=0;i<d;i++){const r=e._facetStart[i],n=e._facetStart[i+1];if(t)for(let t=n;t-- >r;)this.addPointIndex(s.at(e.data.pointIndex[t]),e.data.edgeVisible[t]);else for(let t=r;t<n;t++)this.addPointIndex(s.at(e.data.pointIndex[t]),e.data.edgeVisible[t]);this.terminateFacet(!1)}if(n){const r=this.data.param.length;for(const t of e.data.param){const e=t.clone();this.addParam(e)}for(let n=0;n<e._facetStart.length;n++){const i=e._facetStart[n],o=e._facetStart[n+1];if(t)for(let t=o;t-- >i;)this.addParamIndex(r+e.data.paramIndex[t-1]);else for(let t=i;t<o;t++)this.addParamIndex(r+e.data.paramIndex[t])}}if(o){const n=this.data.normal.length;for(const t of e.data.normal){const e=t.clone();r?(r.multiplyVector(e,e),this.addNormal(e)):this.addNormal(e)}for(let r=0;r<e._facetStart.length;r++){const i=e._facetStart[r],o=e._facetStart[r+1];if(t)for(let t=o;t-- >i;)this.addNormalIndex(n+e.data.normalIndex[t-1]);else for(let t=i;t<o;t++)this.addNormalIndex(n+e.data.normalIndex[t])}}if(this.data.color&&e.data.color&&e.data.colorIndex){const r=this.data.color.length;for(const t of e.data.color)this.addColor(t);for(let n=0;n<e._facetStart.length;n++){const i=e._facetStart[n],o=e._facetStart[n+1];if(t)for(let t=o;t-- >i;)this.addColorIndex(r+e.data.colorIndex[t-1]);else for(let t=i;t<o;t++)this.addColorIndex(r+e.data.colorIndex[t])}}if(0!==e.data.face.length){const t=this.data.face.length;for(const r of e.data.face){const e=r.clone();this.data.face.push(e)}for(const r of e._facetToFaceData)this._facetToFaceData.push(t+r)}}get zeroTerminatedIndexCount(){return this.data.pointIndex.length+this._facetStart.length-1}static create(e=!1,t=!1,r=!1){return new IndexedPolyface(new PolyfaceData(e,t,r))}addPoint(e){return this.data.point.pushXYZ(e.x,e.y,e.z),this.data.point.length-1}addPointXYZ(e,t,r){return this.data.point.push(i.Point3d.create(e,t,r)),this.data.point.length-1}addParam(e){return this.data.param||(this.data.param=[]),this.data.param.push(e.clone()),this.data.param.length-1}addParamXY(e,t){return this.data.param||(this.data.param=[]),this.data.param.push(n.Point2d.create(e,t)),this.data.param.length-1}addNormal(e){return this.data.normal||(this.data.normal=[]),this.data.normal.push(e.clone()),this.data.normal.length-1}addNormalXYZ(e,t,r){return this.data.normal||(this.data.normal=[]),this.data.normal.push(i.Vector3d.create(e,t,r)),this.data.normal.length-1}addColor(e){return this.data.color||(this.data.color=[]),this.data.color.push(e),this.data.color.length-1}addPointIndex(e,t=!0){this.data.pointIndex.push(e),this.data.edgeVisible.push(t)}addNormalIndex(e){this.data.normalIndex||(this.data.normalIndex=[]),this.data.normalIndex.push(e)}addParamIndex(e){this.data.paramIndex||(this.data.paramIndex=[]),this.data.paramIndex.push(e)}addColorIndex(e){this.data.colorIndex||(this.data.colorIndex=[]),this.data.colorIndex.push(e)}cleanupOpenFacet(){this.data.trimAllIndexArrays(this.data.pointIndex.length)}terminateFacet(e=!0){const t=this._facetStart.length-1,r=this._facetStart[t],n=this.data.pointIndex.length;if(e){const e=[];if(n<r+2&&e.push("Less than 3 indices in open facet"),this.data.normalIndex&&this.data.normalIndex.length!==n&&e.push("normalIndex count must match pointIndex count"),this.data.paramIndex&&this.data.paramIndex.length!==n&&e.push("paramIndex count must equal pointIndex count"),this.data.colorIndex&&this.data.colorIndex.length!==n&&e.push("colorIndex count must equal pointIndex count"),this.data.edgeVisible.length!==n&&e.push("visibleIndex count must equal pointIndex count"),function(e,t,r,n){if(void 0===e&&void 0===n)return!0;if(!e||!n)return!1;const i=n.length;if(t<0||t>=e.length)return!1;if(r<t||r>e.length)return!1;for(let o=t;o<r;o++)if(e[o]<0||e[o]>=i)return!1;return!0}(this.data.normalIndex,r,n,this.data.normal)||e.push("invalid normal indices in open facet"),e.length>0)return this.cleanupOpenFacet(),e}this._facetStart.push(n)}get facetCount(){return this._facetStart.length-1}get faceCount(){return this.data.face.length}get pointCount(){return this.data.pointCount}get colorCount(){return this.data.colorCount}get paramCount(){return this.data.paramCount}get normalCount(){return this.data.normalCount}numEdgeInFacet(e){return this.isValidFacetIndex(e)?this._facetStart[e+1]-this._facetStart[e]:0}isValidFacetIndex(e){return e>=0&&e+1<this._facetStart.length}facetIndex0(e){return this._facetStart[e]}facetIndex1(e){return this._facetStart[e+1]}createVisitor(e=0){return IndexedPolyfaceVisitor.create(this,e)}range(e,t){return this.data.range(t,e)}extendRange(e,t){this.data.range(e,t)}getFaceDataByFacetIndex(e){return this.data.face[this._facetToFaceData[e]]}getFaceDataByFaceIndex(e){return this.data.face[e]}setNewFaceData(e=0){const t=this._facetToFaceData.length;if(t>=this._facetStart.length)return!1;0===e&&(e=this._facetStart.length);const r=FacetFaceData.createNull(),n=IndexedPolyfaceVisitor.create(this,0);if(!n.moveToReadIndex(t))return!1;const i=void 0!==this.data.param,o=r.paramRange.isNull&&i;do{for(let e=0;e<n.numEdgesThisFacet;e++)o&&void 0!==n.param&&r.paramRange.extendPoint(n.param[e])}while(n.moveToNextFacet()&&n.currentReadIndex()<e);i&&0!==this.data.param.length&&r.paramDistanceRange.isNull&&r.setParamDistanceRangeFromNewFaceData(this,t,e),this.data.face.push(r);const s=this.data.face.length-1;for(let a=this._facetToFaceData.length;a<e;a++)this._facetToFaceData.push(0===this._facetStart[a]?0:s);return!0}checkIfClosedByEdgePairing(){return!1}dispatchToGeometryHandler(e){return e.handleIndexedPolyface(this)}}t.IndexedPolyface=IndexedPolyface;class IndexedPolyfaceVisitor extends PolyfaceData{constructor(e,t){super(e.data.normalCount>0,e.data.paramCount>0,e.data.colorCount>0),this._polyface=e,this._numWrap=t,e.data.auxData&&(this.auxData=e.data.auxData.createForVisitor()),this.reset(),this._numEdges=0,this._nextFacetIndex=0,this._currentFacetIndex=-1}get numEdgesThisFacet(){return this._numEdges}static create(e,t){return new IndexedPolyfaceVisitor(e,t)}moveToReadIndex(e){return!!this._polyface.isValidFacetIndex(e)&&(this._currentFacetIndex=e,this._nextFacetIndex=e+1,this._numEdges=this._polyface.numEdgeInFacet(e),this.resizeAllDataArrays(this._numEdges+this._numWrap),this.gatherIndexedData(this._polyface.data,this._polyface.facetIndex0(this._currentFacetIndex),this._polyface.facetIndex1(this._currentFacetIndex),this._numWrap),!0)}moveToNextFacet(){return this._nextFacetIndex!==this._currentFacetIndex?this.moveToReadIndex(this._nextFacetIndex):(this._nextFacetIndex++,!0)}reset(){this.moveToReadIndex(0),this._nextFacetIndex=0}tryGetDistanceParameter(e,t){if(e>=this.numEdgesThisFacet)return;if(void 0===this.param||0===this._polyface.data.face.length)return;const r=this._polyface.tryGetFaceData(this._currentFacetIndex);return r?r.convertParamToDistance(this.param[e],t):void 0}tryGetNormalizedParameter(e,t){if(e>=this.numEdgesThisFacet)return;if(void 0===this.param||0===this._polyface.data.face.length)return;const r=this._polyface.tryGetFaceData(this._currentFacetIndex);return r?r.convertParamToNormalized(this.param[e],t):void 0}currentReadIndex(){return this._currentFacetIndex}clientPointIndex(e){return this.pointIndex[e]}clientParamIndex(e){return this.paramIndex?this.paramIndex[e]:-1}clientNormalIndex(e){return this.normalIndex?this.normalIndex[e]:-1}clientColorIndex(e){return this.colorIndex?this.colorIndex[e]:-1}clientAuxIndex(e){return this.auxData?this.auxData.indices[e]:-1}}t.IndexedPolyfaceVisitor=IndexedPolyfaceVisitor},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(84),o=r(16),s=r(13),a=r(6),c=r(125),l=r(258),u=r(10),d=r(50),h=r(265),p=r(267),f=r(9),g=r(264),m=r(33),y=r(127),v=r(39),_=r(128),w=r(130),S=r(100),b=r(278),x=r(275),P=r(269),C=r(268),T=r(276),M=r(270),E=r(273),I=r(274),A=r(21),R=r(101),O=r(14),D=r(266),k=r(60),F=r(51),N=r(277),L=r(19),B=r(33);!function(e){class Reader{constructor(){}static parseVector3dProperty(e,t,r){if(e.hasOwnProperty(t)){const r=e[t];if(n.Geometry.isNumberArray(r,3))return a.Vector3d.create(r[0],r[1],r[2]);if(a.XYZ.isXAndY(r))return a.Vector3d.fromJSON(r)}return r}static parsePoint3dProperty(e,t,r){if(e.hasOwnProperty(t)){const r=e[t];if(n.Geometry.isNumberArray(r,3))return a.Point3d.create(r[0],r[1],r[2]);if(a.XYZ.isXAndY(r))return a.Point3d.fromJSON(r)}return r}static parseSegment1dProperty(e,t,r){if(e.hasOwnProperty(t)){const r=e[t];if(n.Geometry.isNumberArray(r,2))return c.Segment1d.create(r[0],r[1])}return r}static parseNumberProperty(e,t,r){if(e.hasOwnProperty(t)){const r=e[t];if(Number.isFinite(r))return r}return r}static parseAngleProperty(e,t,r){if(e.hasOwnProperty(t)){const r=e[t];return o.Angle.fromJSON(r)}return r}static parseAngleSweepProps(e,t,r){if(e.hasOwnProperty(t)){const r=e[t];return i.AngleSweep.fromJSON(r)}if(void 0!==r)return r()}static parseBooleanProperty(e,t,r){if(e.hasOwnProperty(t)){const r=e[t];if(!0===r)return!0;if(!1===r)return!1}return r}static loadContourArray(e,t){if(e.hasOwnProperty(t)){const r=e[t];if(Array.isArray(r)){const e=[];for(const t of r){const r=Reader.parse(t);r instanceof B.CurveCollection&&e.push(r)}if(e.length>0)return e}}}static parseYawPitchRollAngles(e){return l.YawPitchRollAngles.fromJSON(e).toMatrix3d()}static parseStringProperty(e,t,r){if(e.hasOwnProperty(t)){const r=e[t];if("string"===r.type)return r}return r}static parseAxesFromVectors(e,t,r){if(Array.isArray(e)&&2===e.length){const r=a.Vector3d.fromJSON(e[0]),n=a.Vector3d.fromJSON(e[1]),i=u.Matrix3d.createRigidFromColumns(r,n,t);if(i)return i}if(r)return u.Matrix3d.createIdentity()}static parseOrientation(e,t){return e.yawPitchRollAngles?Reader.parseYawPitchRollAngles(e.yawPitchRollAngles):e.xyVectors?Reader.parseAxesFromVectors(e.xyVectors,0,t):e.zxVectors?Reader.parseAxesFromVectors(e.zxVectors,2,t):t?u.Matrix3d.createIdentity():void 0}static parseArcByVectorProps(e){if(e&&void 0!==e.center&&void 0!==e.vectorX&&void 0!==e.vectorY&&void 0!==e.sweepStartEnd)return k.Arc3d.create(a.Point3d.fromJSON(e.center),a.Vector3d.fromJSON(e.vectorX),a.Vector3d.fromJSON(e.vectorY),i.AngleSweep.fromJSON(e.sweepStartEnd))}static parseArcBy3Points(e){if(Array.isArray(e)&&e.length>2){const t=a.Point3d.fromJSON(e[0]),r=a.Point3d.fromJSON(e[1]),n=a.Point3d.fromJSON(e[2]);return k.Arc3d.createCircularStartMiddleEnd(t,r,n)}}static parseArcObject(e){let t=Reader.parseArcByVectorProps(e);return t||(t=Reader.parseArcBy3Points(e))}static parseCoordinate(e){const t=a.Point3d.fromJSON(e);if(t)return h.CoordinateXYZ.create(t)}static parseTransitionSpiral(e){const t=Reader.parseOrientation(e,!0),r=Reader.parsePoint3dProperty(e,"origin"),n=Reader.parseAngleProperty(e,"startBearing"),i=Reader.parseAngleProperty(e,"endBearing"),o=Reader.parseNumberProperty(e,"startRadius"),s=Reader.parseNumberProperty(e,"endRadius"),a=Reader.parseNumberProperty(e,"curveLength",void 0),c=Reader.parseSegment1dProperty(e,"fractionInterval",void 0),l=Reader.parseStringProperty(e,"spiralType","clothoid");if(r)return p.TransitionSpiral3d.create(l,o,s,n,i,a,c,f.Transform.createOriginAndMatrix(r,t))}static parseBcurve(e){if(Array.isArray(e.points)&&Array.isArray(e.knots)&&Number.isFinite(e.order)&&void 0!==e.closed)if(4===e.points[0].length){const t=[];for(const i of e.points)t.push(L.Point4d.fromJSON(i));const r=[];for(const i of e.knots)r.push(i);if(e.closed)for(let i=0;i+1<e.order;i++)t.push(t[i].clone());const n=N.BSplineCurve3dH.create(t,r,e.order);if(n)return!0===e.closed&&n.setWrappable(!0),n}else if(3===e.points[0].length||2===e.points[0].length){const t=[];for(const i of e.points)t.push(a.Point3d.fromJSON(i));const r=[];for(const i of e.knots)r.push(i);if(e.closed)for(let i=0;i+1<e.order;i++)t.push(t[i].clone());const n=S.BSplineCurve3d.create(t,r,e.order);if(n)return!0===e.closed&&n.setWrappable(!0),n}}static parseArray(e){if(Array.isArray(e)){const t=[];let r;for(r of e){const e=Reader.parse(r);void 0!==e&&t.push(e)}return t}}static addZeroBasedIndicesFromSignedOneBased(e,t){if(e&&n.Geometry.isNumberArray(e))for(const r of e)0!==r&&t(Math.abs(r)-1)}static parsePolyfaceAuxData(e){if(!Array.isArray(e.channels)||!Array.isArray(e.indices))return;const t=[];for(const n of e.channels)if(Array.isArray(n.data)&&n.hasOwnProperty("dataType")){const e=[];for(const t of n.data)t.hasOwnProperty("input")&&Array.isArray(t.values)&&e.push(new w.AuxChannelData(t.input,t.values));t.push(new w.AuxChannel(e,n.dataType,n.name,n.inputName))}const r=new w.PolyfaceAuxData(t,[]);return Reader.addZeroBasedIndicesFromSignedOneBased(e.indices,e=>{r.indices.push(e)}),r}static parseIndexedMesh(e){if(e.hasOwnProperty("point")&&Array.isArray(e.point)&&e.hasOwnProperty("pointIndex")&&Array.isArray(e.pointIndex)){const t=w.IndexedPolyface.create();if(e.hasOwnProperty("normal")&&Array.isArray(e.normal))for(const r of e.normal)n.Geometry.isNumberArray(r,3)&&t.addNormal(a.Vector3d.create(r[0],r[1],r[2]));if(e.hasOwnProperty("param")&&Array.isArray(e.param))for(const r of e.param)n.Geometry.isNumberArray(r,2)&&t.addParam(s.Point2d.create(r[0],r[1]));if(e.hasOwnProperty("color")&&Array.isArray(e.color))for(const r of e.color)t.addColor(r);for(const r of e.point)t.addPoint(a.Point3d.fromJSON(r));for(const r of e.pointIndex)if(0===r)t.terminateFacet(!1);else{const e=Math.abs(r)-1;t.addPointIndex(e,r>0)}return e.hasOwnProperty("normalIndex")&&Reader.addZeroBasedIndicesFromSignedOneBased(e.normalIndex,e=>{t.addNormalIndex(e)}),e.hasOwnProperty("paramIndex")&&Reader.addZeroBasedIndicesFromSignedOneBased(e.paramIndex,e=>{t.addParamIndex(e)}),e.hasOwnProperty("colorIndex")&&Reader.addZeroBasedIndicesFromSignedOneBased(e.colorIndex,e=>{t.addColorIndex(e)}),e.hasOwnProperty("auxData")&&(t.data.auxData=Reader.parsePolyfaceAuxData(e.auxData)),t}}static parseCurveCollectionMembers(e,t){if(t&&Array.isArray(t)){for(const r of t){const t=Reader.parse(r);void 0!==t&&e.tryAddChild(t)}return e}}static parseBsurf(e){if(e.hasOwnProperty("uKnots")&&Array.isArray(e.uKnots)&&e.hasOwnProperty("vKnots")&&Array.isArray(e.vKnots)&&e.hasOwnProperty("orderU")&&Number.isFinite(e.orderU)&&e.hasOwnProperty("orderV")&&Number.isFinite(e.orderV)&&e.hasOwnProperty("points")&&Array.isArray(e.points)){const t=e.orderU,r=e.orderV;if(Array.isArray(e.points[0])&&Array.isArray(e.points[0][0])){const n=e.points[0][0].length;if(3===n)return b.BSplineSurface3d.createGrid(e.points,t,e.uKnots,r,e.vKnots);if(4===n)return b.BSplineSurface3dH.createGrid(e.points,b.WeightStyle.WeightsAlreadyAppliedToCoordinates,t,e.uKnots,r,e.vKnots)}}}static parseConeProps(e){const t=Reader.parseOrientation(e,!1),r=Reader.parsePoint3dProperty(e,"start"),n=Reader.parsePoint3dProperty(e,"end"),i=Reader.parseNumberProperty(e,"startRadius"),o=Reader.parseNumberProperty(e,"endRadius",i),s=Reader.parseBooleanProperty(e,"capped",!1);if(r&&n&&void 0!==i&&void 0!==o){if(void 0===t){const e=a.Vector3d.createStartEnd(r,n),t=u.Matrix3d.createRigidHeadsUp(e,2),c=t.columnX(),l=t.columnY();return P.Cone.createBaseAndTarget(r,n,c,l,i,o,s)}return P.Cone.createBaseAndTarget(r,n,t.columnX(),t.columnY(),i,o,s)}}static parseCylinderProps(e){const t=Reader.parsePoint3dProperty(e,"start"),r=Reader.parsePoint3dProperty(e,"end"),n=Reader.parseNumberProperty(e,"radius"),i=Reader.parseBooleanProperty(e,"capped",!1);if(t&&r&&void 0!==n)return P.Cone.createAxisPoints(t,r,n,n,i)}static parseLineSegmentProps(e){if(Array.isArray(e)&&e.length>1)return F.LineSegment3d.create(a.Point3d.fromJSON(e[0]),a.Point3d.fromJSON(e[1]))}static parseLinearSweep(e){const t=Reader.parse(e.contour),r=Reader.parseBooleanProperty(e,"capped"),n=Reader.parseVector3dProperty(e,"vector");if(t&&void 0!==r&&n)return M.LinearSweep.create(t,n,r)}static parseRotationalSweep(e){const t=Reader.parse(e.contour),r=Reader.parseBooleanProperty(e,"capped"),n=Reader.parseVector3dProperty(e,"axis"),i=Reader.parsePoint3dProperty(e,"center"),s=Reader.parseNumberProperty(e,"sweepAngle");if(t&&void 0!==s&&void 0!==r&&n&&i)return E.RotationalSweep.create(t,A.Ray3d.createCapture(i,n),o.Angle.createDegrees(s),r)}static parseBox(e){const t=Reader.parseBooleanProperty(e,"capped",!1),r=Reader.parsePoint3dProperty(e,"baseOrigin"),n=Reader.parseNumberProperty(e,"baseX"),i=Reader.parseNumberProperty(e,"baseY",n);let o=Reader.parsePoint3dProperty(e,"topOrigin");const s=Reader.parseNumberProperty(e,"topX",n),c=Reader.parseNumberProperty(e,"topY",i),l=Reader.parseNumberProperty(e,"height",n),d=Reader.parseOrientation(e,!0);if(r&&!o&&(o=u.Matrix3d.XYZMinusMatrixTimesXYZ(r,d,a.Vector3d.create(0,0,l))),void 0!==t&&void 0!==n&&void 0!==i&&void 0!==c&&void 0!==s&&d&&r&&o)return C.Box.createDgnBoxWithAxes(r,d,o,n,i,s,c,t)}static parseSphere(e){const t=Reader.parsePoint3dProperty(e,"center"),r=Reader.parseNumberProperty(e,"radius"),n=Reader.parseNumberProperty(e,"radiusX",r),i=Reader.parseNumberProperty(e,"radiusX",n),o=Reader.parseNumberProperty(e,"radiusX",n),s=Reader.parseAngleSweepProps(e,"latitudeStartEnd"),a=Reader.parseOrientation(e,!0),c=Reader.parseBooleanProperty(e,"capped",!1);if(void 0!==t&&void 0!==n&&void 0!==i&&void 0!==o&&void 0!==c)return x.Sphere.createFromAxesAndScales(t,a,n,i,o,s,c)}static parseRuledSweep(e){const t=Reader.parseBooleanProperty(e,"capped",!1),r=this.loadContourArray(e,"contour");if(void 0!==r&&void 0!==t)return I.RuledSweep.create(r,t)}static parseTorusPipe(e){const t=Reader.parseOrientation(e,!0),r=Reader.parsePoint3dProperty(e,"center"),n=Reader.parseNumberProperty(e,"majorRadius"),i=Reader.parseNumberProperty(e,"minorRadius"),s=Reader.parseAngleProperty(e,"sweepAngle",void 0),a=Reader.parseBooleanProperty(e,"capped",!1);if(r&&void 0!==n&&void 0!==i)return T.TorusPipe.createDgnTorusPipe(r,t.columnX(),t.columnY(),n,i,s||o.Angle.createDegrees(360),a)}static parsePointArray(e){const t=[];if(e&&Array.isArray(e))for(const r of e)a.XYZ.isXAndY(r)?t.push(a.Point3d.fromJSON(r)):n.Geometry.isNumberArray(r,2)&&t.push(a.Point3d.fromJSON(r));return t}static parse(e){if(void 0!==e&&e){if(void 0!==e.lineSegment)return Reader.parseLineSegmentProps(e.lineSegment);if(void 0!==e.lineString)return O.LineString3d.create(Reader.parsePointArray(e.lineString));if(void 0!==e.arc)return Reader.parseArcObject(e.arc);if(e.hasOwnProperty("point"))return Reader.parseCoordinate(e.point);if(e.hasOwnProperty("bcurve"))return Reader.parseBcurve(e.bcurve);if(e.hasOwnProperty("path"))return Reader.parseCurveCollectionMembers(new _.Path,e.path);if(e.hasOwnProperty("loop"))return Reader.parseCurveCollectionMembers(new v.Loop,e.loop);if(e.hasOwnProperty("parityRegion"))return Reader.parseCurveCollectionMembers(new y.ParityRegion,e.parityRegion);if(e.hasOwnProperty("unionRegion"))return Reader.parseCurveCollectionMembers(new g.UnionRegion,e.unionRegion);if(e.hasOwnProperty("bagOfCurves"))return Reader.parseCurveCollectionMembers(new m.BagOfCurves,e.bagOfCurves);if(e.hasOwnProperty("indexedMesh"))return Reader.parseIndexedMesh(e.indexedMesh);if(e.hasOwnProperty("bsurf"))return Reader.parseBsurf(e.bsurf);if(e.hasOwnProperty("cone"))return Reader.parseConeProps(e.cone);if(e.hasOwnProperty("cylinder"))return Reader.parseCylinderProps(e.cylinder);if(e.hasOwnProperty("sphere"))return Reader.parseSphere(e.sphere);if(e.hasOwnProperty("linearSweep"))return Reader.parseLinearSweep(e.linearSweep);if(e.hasOwnProperty("box"))return Reader.parseBox(e.box);if(e.hasOwnProperty("rotationalSweep"))return Reader.parseRotationalSweep(e.rotationalSweep);if(e.hasOwnProperty("ruledSweep"))return Reader.parseRuledSweep(e.ruledSweep);if(e.hasOwnProperty("torusPipe"))return Reader.parseTorusPipe(e.torusPipe);if(e.hasOwnProperty("pointString"))return D.PointString3d.create(Reader.parsePointArray(e.pointString));if(e.hasOwnProperty("transitionSpiral"))return Reader.parseTransitionSpiral(e.transitionSpiral);if(Array.isArray(e))return Reader.parseArray(e)}}}e.Reader=Reader;class Writer extends R.GeometryHandler{handleLineSegment3d(e){return{lineSegment:[e.point0Ref.toJSON(),e.point1Ref.toJSON()]}}handleCoordinateXYZ(e){return{point:e.point.toJSON()}}handleArc3d(e){return{arc:{center:e.center.toJSON(),vectorX:e.vector0.toJSON(),vectorY:e.vector90.toJSON(),sweepStartEnd:[e.sweep.startDegrees,e.sweep.endDegrees]}}}static insertOrientationFromMatrix(e,t,r){if(r){if(void 0===t)return;if(t.isIdentity)return}e.xyVectors=t?[t.columnX().toJSON(),t.columnY().toJSON()]:[[1,0,0],[0,1,0]]}static isIdentityXY(e,t){return e.isAlmostEqualXYZ(1,0,0)&&t.isAlmostEqualXYZ(0,1,0)}static insertOrientationFromXYVectors(e,t,r,n){n&&Writer.isIdentityXY(t,r)||(e.xyVectors=[t.toJSON(),r.toJSON()])}static insertXYOrientation(e,t,r,n){n&&t.isAlmostEqualXYZ(1,0,0)&&r.isAlmostEqualXYZ(0,1,0)||(e.xyVectors=[t.toJSON(),r.toJSON()])}handleTransitionSpiral(e){const t=e.originalProperties,r={origin:e.localToWorld.origin.toJSON(),type:e.getSpiralType()};return Writer.insertOrientationFromMatrix(r,e.localToWorld.matrix,!0),e.activeFractionInterval.isExact01||(r.fractionInterval=[e.activeFractionInterval.x0,e.activeFractionInterval.x1]),void 0!==t&&4===t.numDefinedProperties()?(void 0!==t.radius0&&(r.startRadius=e.radius01.x0),void 0!==t.radius1&&(r.endRadius=e.radius01.x1),void 0!==t.bearing0&&(r.startBearing=e.bearing01.startAngle.toJSON()),void 0!==t.bearing1&&(r.endBearing=e.bearing01.endAngle.toJSON()),void 0!==t.curveLength&&(r.curveLength=e.curveLength())):(r.startRadius=e.radius01.x0,r.endRadius=e.radius01.x1,r.startBearing=e.bearing01.startAngle.toJSON(),r.endBearing=e.bearing01.endAngle.toJSON(),r.curveLength=e.curveLength()),{transitionSpiral:r}}handleCone(e){const t=e.getRadiusA(),r=e.getRadiusB(),i=e.getCenterA(),o=e.getCenterB(),s=e.getVectorX(),c=e.getVectorY(),l=a.Vector3d.createStartEnd(i,o);if(n.Geometry.isSameCoordinate(t,r)&&s.isPerpendicularTo(l)&&c.isPerpendicularTo(l)&&n.Geometry.isSameCoordinate(s.magnitude(),1)&&n.Geometry.isSameCoordinate(c.magnitude(),1))return{cylinder:{capped:e.capped,start:e.getCenterA().toJSON(),end:e.getCenterB().toJSON(),radius:t}};{const t={capped:e.capped,start:e.getCenterA().toJSON(),end:e.getCenterB().toJSON(),startRadius:e.getRadiusA(),endRadius:e.getRadiusB()};return Writer.insertOrientationFromXYVectors(t,s,c,!1),{cone:t}}}handleSphere(e){const t=e.cloneVectorX().normalizeWithLength(),r=e.cloneVectorY().normalizeWithLength(),i=e.cloneVectorZ().normalizeWithLength(),o=e.cloneLatitudeSweep(),s=t.mag,a=r.mag,c=i.mag;if(t.v&&i.v){const r={center:e.cloneCenter().toJSON()};e.getConstructiveFrame().matrix.isIdentity||(r.zxVectors=[i.v.toJSON(),t.v.toJSON()]);const l=o.isFullLatitudeSweep;return e.capped&&!l&&(r.capped=e.capped),n.Geometry.isSameCoordinate(s,a)&&n.Geometry.isSameCoordinate(s,c)?r.radius=s:(r.radiusX=s,r.radiusY=a,r.radiusZ=c),l||(r.latitudeStartEnd=o.toJSON()),{sphere:r}}}handleTorusPipe(e){const t=e.cloneVectorX(),r=e.cloneVectorY(),n=e.getMajorRadius(),i=e.getMinorRadius(),o=e.getSweepAngle();e.getIsReversed()&&(r.scaleInPlace(-1),o.setRadians(-o.radians));const s={center:e.cloneCenter().toJSON(),majorRadius:n,minorRadius:i,xyVectors:[t.toJSON(),r.toJSON()]};return o.isFullCircle||(s.sweepAngle=o.degrees,s.capped=e.capped),{torusPipe:s}}handleLineString3d(e){const t=e.points,r=[];if(t)for(const n of t)r.push(n.toJSON());return{lineString:r}}handlePointString3d(e){const t=e.points,r=[];if(t)for(const n of t)r.push(n.toJSON());return{pointString:r}}handlePath(e){return{path:this.collectChildren(e)}}handleLoop(e){return{loop:this.collectChildren(e)}}handleParityRegion(e){return{parityRegion:this.collectChildren(e)}}handleUnionRegion(e){return{unionRegion:this.collectChildren(e)}}handleBagOfCurves(e){return{bagOfCurves:this.collectChildren(e)}}collectChildren(e){const t=[];if(e.children&&Array.isArray(e.children))for(const r of e.children){const e=r.dispatchToGeometryHandler(this);e&&t.push(e)}return t}handleLinearSweep(e){const t=e.cloneSweepVector(),r=e.getCurvesRef(),n=e.capped;if(t&&r&&void 0!==n)return{linearSweep:{contour:r.dispatchToGeometryHandler(this),capped:n,vector:t.toJSON()}}}handleRuledSweep(e){const t=e.cloneContours(),r=e.capped;if(t&&t.length>1&&void 0!==r){const e=[];for(const r of t)e.push(this.emit(r));return{ruledSweep:{contour:e,capped:r}}}}handleRotationalSweep(e){const t=e.cloneAxisRay(),r=e.getCurves(),n=e.capped,i=e.getSweep();return{rotationalSweep:{axis:t.direction.toJSON(),contour:r.dispatchToGeometryHandler(this),capped:n,center:t.origin.toJSON(),sweepAngle:i.degrees}}}handleBox(e){const t={box:{baseOrigin:e.getBaseOrigin().toJSON(),baseX:e.getBaseX(),baseY:e.getBaseY(),capped:e.capped,topOrigin:e.getTopOrigin().toJSON()}};return Writer.insertXYOrientation(t.box,e.getVectorX(),e.getVectorY(),!0),n.Geometry.isSameCoordinate(e.getTopX(),e.getBaseX())||(t.box.topX=e.getTopX()),n.Geometry.isSameCoordinate(e.getTopY(),e.getBaseY())||(t.box.topY=e.getTopY()),t}handlePolyfaceAuxData(e,t){const r={indices:[]},n=t.createVisitor(0);if(n.auxData){for(;n.moveToNextFacet();){for(let e=0;e<n.indexCount;e++)r.indices.push(n.auxData.indices[e]+1);r.indices.push(0)}r.channels=[];for(const t of e.channels){const e={};e.dataType=t.dataType,e.name=t.name,e.inputName=t.inputName,e.data=[];for(const r of t.data){const t={};t.input=r.input,t.values=r.values.slice(0),e.data.push(t)}r.channels.push(e)}return r}}handleIndexedPolyface(e){const t=[],r=[],n=[],i=[],o=[],s=a.Point3d.create();for(let a=0;e.data.point.atPoint3dIndex(a,s);a++)t.push(s.toJSON());if(e.data.normal)for(const a of e.data.normal)n.push(a.toJSON());if(e.data.param)for(const a of e.data.param)i.push(a.toJSON());if(e.data.color)for(const a of e.data.color)o.push(a);const c=e.createVisitor(0);let l=0;const u=[],d=[],h=[];let p;for(;c.moveToNextFacet();){p=c.indexCount;for(let t=0;t<p;t++){const n=e.data.edgeVisible[l+t]?c.pointIndex[t]+1:-(c.clientPointIndex(t)+1);r.push(n)}if(r.push(0),l+=c.indexCount,c.normalIndex){for(let e=0;e<p;e++)u.push(1+c.clientNormalIndex(e));u.push(0)}if(c.paramIndex){for(let e=0;e<p;e++)d.push(1+c.clientParamIndex(e));d.push(0)}if(c.colorIndex){for(let e=0;e<p;e++)h.push(1+c.clientColorIndex(e));h.push(0)}}const f={};return e.data.auxData&&(f.auxData=this.handlePolyfaceAuxData(e.data.auxData,e)),e.data.color&&(f.color=o),e.data.colorIndex&&(f.colorIndex=h),e.data.normal&&(f.normal=n),e.data.normalIndex&&(f.normalIndex=u),e.data.param&&(f.param=i),e.data.paramIndex&&(f.paramIndex=d),f.point=t,f.pointIndex=r,{indexedMesh:f}}handleBSplineCurve3d(e){if(e.isClosable){const t=e.copyKnots(!0),r=e.copyPoints(),n=e.degree;for(let e=0;e<n;e++)r.pop();const i=n,o=t.length-n-1,s=t[o]-t[i];return t[0]=t[o-n]-s,t[t.length-1]=t[i+n]+s,{bcurve:{points:r,knots:t,closed:!0,order:e.order}}}return{bcurve:{points:e.copyPoints(),knots:e.copyKnots(!0),closed:!1,order:e.order}}}handleBezierCurve3d(e){const t=[],r=e.order;for(let n=0;n<r;n++)t.push(0);for(let n=0;n<r;n++)t.push(1);return{bcurve:{points:e.copyPolesAsJsonArray(),knots:t,closed:!1,order:e.order}}}handleBSplineCurve3dH(e){if(e.isClosable){const t=e.copyKnots(!0),r=e.copyPoints(),n=e.degree;for(let e=0;e<n;e++)r.pop();const i=n,o=t.length-n-1,s=t[o]-t[i];return t[0]=t[o-n]-s,t[t.length-1]=t[i+n]+s,{bcurve:{points:r,knots:t,closed:!0,order:e.order}}}return{bcurve:{points:e.copyPoints(),knots:e.copyKnots(!0),closed:!1,order:e.order}}}handleBSplineSurface3d(e){if(!e.isClosable(0)&&!e.isClosable(1))return{bsurf:{points:e.getPointArray(!1),uKnots:e.copyKnots(0,!0),vKnots:e.copyKnots(1,!0),orderU:e.orderUV(0),orderV:e.orderUV(1)}}}handleBezierCurve3dH(e){const t=[],r=e.order;for(let n=0;n<r;n++)t.push(0);for(let n=0;n<r;n++)t.push(1);return{bcurve:{points:e.copyPolesAsJsonArray(),knots:t,closed:!1,order:e.order}}}handleBSplineSurface3dH(e){return{bsurf:{points:e.getPointGridJSON().points,uKnots:e.copyKnots(0,!0),vKnots:e.copyKnots(1,!0),orderU:e.orderUV(0),orderV:e.orderUV(1)}}}emitArray(e){const t=[];for(const r of e){const e=this.emit(r);t.push(e)}return t}emit(e){return Array.isArray(e)?this.emitArray(e):e instanceof d.GeometryQuery?e.dispatchToGeometryHandler(this):void 0}static toIModelJson(e){return(new Writer).emit(e)}}e.Writer=Writer}(t.IModelJson||(t.IModelJson={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(63);class Sprite{constructor(){this.size=new n.Point2d}get offset(){return new n.Point2d(Math.round(this.size.x)/2,Math.round(this.size.y/2))}get isLoaded(){return void 0!==this.image}onLoaded(e){this.image=e,this.size.set(e.naturalWidth,e.naturalHeight)}fromImageSource(e){i.imageElementFromImageSource(e).then(e=>this.onLoaded(e))}fromUrl(e){i.imageElementFromUrl(e).then(e=>this.onLoaded(e))}}t.Sprite=Sprite;class IconSprites{static getSpriteFromUrl(e){let t=this._sprites.get(e);return t||(t=new Sprite,this._sprites.set(e,t),t.fromUrl(e)),t}static emptyAll(){this._sprites.clear()}}IconSprites._sprites=new Map,t.IconSprites=IconSprites;t.SpriteLocation=class SpriteLocation{constructor(){this.position=new n.Point3d}get isActive(){return void 0!==this._viewport}activate(e,t,r,n){e.isLoaded&&(t.worldToView(r,this.position),this._sprite=e,this._alpha=n,this._viewport=t,t.invalidateDecorations())}deactivate(){this.isActive&&(this._viewport.invalidateDecorations(),this._viewport=void 0)}drawDecoration(e){void 0!==this._alpha&&(e.globalAlpha=this._alpha);const t=this._sprite;e.drawImage(t.image,-t.offset.x,-t.offset.y)}decorate(e){e.viewport===this._viewport&&e.addCanvasDecoration(this)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(0);!function(e){class Appearance{constructor(e){if(this.rgb=e.rgb,this.weight=e.weight,this.transparency=e.transparency,this.linePixels=e.linePixels,this.ignoresMaterial=e.ignoresMaterial,void 0!==this.weight&&(this.weight=Math.max(1,Math.min(this.weight,32))),void 0!==this.transparency){this.transparency=Math.max(0,Math.min(this.transparency,1));const e=1e-4;1-this.transparency<e?this.transparency=1:this.transparency<e&&(this.transparency=0)}}static fromJSON(e){return void 0===e||void 0===e.rgb&&void 0===e.weight&&void 0===e.transparency&&void 0===e.linePixels&&!e.ignoresMaterial?this.defaults:new Appearance(e)}static fromRgb(e){return this.fromJSON({rgb:n.RgbColor.fromColorDef(e)})}static fromRgba(e){return this.fromJSON({rgb:n.RgbColor.fromColorDef(e),transparency:e.colors.t/255})}static fromSubCategoryOverride(e){const t=void 0!==e.color?n.RgbColor.fromColorDef(e.color):void 0,r=void 0!==e.transparency?e.transparency:void 0,o=void 0!==e.weight?e.weight:void 0,s=!(void 0===e.material||!i.Id64.isValid(e.material))||void 0;return this.fromJSON({rgb:t,transparency:r,weight:o,ignoresMaterial:s})}get overridesRgb(){return void 0!==this.rgb}get overridesTransparency(){return void 0!==this.transparency}get overridesLinePixels(){return void 0!==this.linePixels}get overridesWeight(){return void 0!==this.weight}get overridesSymbology(){return this.overridesRgb||this.overridesTransparency||this.overridesWeight||this.overridesLinePixels||!!this.ignoresMaterial}get isFullyTransparent(){return void 0!==this.transparency&&this.transparency>=1}equals(e){return this.rgbIsEqual(e.rgb)&&this.weight===e.weight&&this.transparency===e.transparency&&this.linePixels===e.linePixels&&this.ignoresMaterial===e.ignoresMaterial}toJSON(){return{rgb:this.rgb,weight:this.weight,transparency:this.transparency,linePixels:this.linePixels,ignoresMaterial:!!this.ignoresMaterial||void 0}}extendAppearance(e){if(!this.overridesSymbology)return e;const t=e.toJSON();return void 0===t.rgb&&(t.rgb=this.rgb),void 0===t.transparency&&(t.transparency=this.transparency),void 0===t.linePixels&&(t.linePixels=this.linePixels),void 0===t.weight&&(t.weight=this.weight),void 0===t.ignoresMaterial&&this.ignoresMaterial&&(t.ignoresMaterial=!0),Appearance.fromJSON(t)}rgbIsEqual(e){return void 0===this.rgb?void 0===e:void 0!==e&&this.rgb.equals(e)}}Appearance.defaults=new Appearance({}),e.Appearance=Appearance;e.Overrides=class Overrides{constructor(e){this.neverDrawn=new Set,this.alwaysDrawn=new Set,this.isAlwaysDrawnExclusive=!1,this._defaultOverrides=Appearance.defaults,this._constructions=!1,this._dimensions=!1,this._patterns=!1,this._lineWeights=!0,this.modelOverrides=new Map,this.elementOverrides=new Map,this.subCategoryOverrides=new Map,this.visibleSubCategories=new Set,void 0!==e&&this.initFromView(e)}get defaultOverrides(){return this._defaultOverrides}get lineWeights(){return this._lineWeights}isNeverDrawn(e){return this.neverDrawn.has(e.toString())}isAlwaysDrawn(e){return this.alwaysDrawn.has(e.toString())}isSubCategoryVisible(e){return this.visibleSubCategories.has(e.toString())}clearModelOverrides(e){this.modelOverrides.delete(e.toString())}clearElementOverrides(e){this.elementOverrides.delete(e.toString())}clearSubCategoryOverrides(e){this.subCategoryOverrides.delete(e.toString())}getModelOverrides(e){return this.modelOverrides.get(e.toString())}getElementOverrides(e){return this.elementOverrides.get(e.toString())}getSubCategoryOverrides(e){return this.subCategoryOverrides.get(e.toString())}setVisibleSubCategory(e){this.visibleSubCategories.add(e.toString())}setNeverDrawn(e){this.neverDrawn.add(e.toString())}setAlwaysDrawn(e){this.alwaysDrawn.add(e.toString())}getAppearance(e,t,r=0){if(1===r)return this.getClassifierAppearance(e,t);let n=this._lineWeights?Appearance.defaults:Appearance.fromJSON({weight:1});const o=this.getModelOverrides(t);void 0!==o&&(n=o.extendAppearance(n));const{elementId:s,subCategoryId:a,geometryClass:c}=e;let l,u=!1;if(!i.Id64.isInvalid(s)){if(this.isNeverDrawn(s))return;if(!(u=this.isAlwaysDrawn(s))&&this.isAlwaysDrawnExclusive)return;void 0!==(l=this.getElementOverrides(s))&&(n=void 0!==o?l.extendAppearance(n):l)}if(!i.Id64.isInvalid(a)){if(!u&&!this.isSubCategoryVisible(a))return;const e=this.getSubCategoryOverrides(a);void 0!==e&&(n=e.extendAppearance(n))}void 0===l&&void 0===o&&(n=this._defaultOverrides.extendAppearance(n));let d=u||this.isClassVisible(c);return d&&n.isFullyTransparent&&(d=!1),d?n:void 0}getClassifierAppearance(e,t){let r=Appearance.defaults;const n=this.getModelOverrides(t);void 0!==n&&(r=n.extendAppearance(r));const{elementId:o,subCategoryId:s}=e,a=this.getElementOverrides(o);if(void 0!==a&&(r=void 0!==n?a.extendAppearance(r):a),!i.Id64.isInvalid(s)){const e=this.getSubCategoryOverrides(s);void 0!==e&&(r=e.extendAppearance(r))}return void 0===a&&void 0===n&&(r=this._defaultOverrides.extendAppearance(r)),r.isFullyTransparent?void 0:r}isClassVisible(e){switch(e){case 1:return this._constructions;case 2:return this._dimensions;case 3:return this._patterns;default:return!0}}isFeatureVisible(e){const{elementId:t,subCategoryId:r,geometryClass:n}=e,o=!i.Id64.isInvalid(t);if(o&&this.isNeverDrawn(t))return!1;const s=o&&this.isAlwaysDrawn(t);return s||this.isAlwaysDrawnExclusive?s:!!this.isSubCategoryVisible(r)&&this.isClassVisible(n)}overrideModel(e,t,r=!0){(r||void 0===this.getModelOverrides(e))&&this.modelOverrides.set(e.toString(),t)}overrideSubCategory(e,t,r=!0){this.isSubCategoryVisible(e)&&(r||void 0===this.getSubCategoryOverrides(e))&&this.subCategoryOverrides.set(e.toString(),t)}overrideElement(e,t,r=!0){this.isNeverDrawn(e)||(r||void 0===this.getElementOverrides(e))&&this.elementOverrides.set(e.toString(),t)}setDefaultOverrides(e,t=!0){!t&&e.overridesSymbology||(this._defaultOverrides=e)}initFromView(e){const{alwaysDrawn:t,neverDrawn:r,viewFlags:n}=e,{constructions:i,dimensions:o,patterns:s}=n;this.copy(this.alwaysDrawn,t),this.copy(this.neverDrawn,r),this.isAlwaysDrawnExclusive=e.isAlwaysDrawnExclusive,this._constructions=i,this._dimensions=o,this._patterns=s,this._lineWeights=n.weights;for(const a of e.categorySelector.categories){const t=e.subCategories.getSubCategories(a);if(void 0!==t)for(const r of t)if(e.isSubCategoryVisible(r)){this.visibleSubCategories.add(r);const t=e.getSubCategoryOverride(r);if(void 0!==t){const e=Appearance.fromSubCategoryOverride(t);e.overridesSymbology&&this.subCategoryOverrides.set(r,e)}}}}copy(e,t){if(e.clear(),void 0!==t)for(const r of t)e.add(r)}}}(t.FeatureSymbology||(t.FeatureSymbology={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3),o=r(4),s=r(76),a=r(8),c=r(132),l=r(104),u=r(20),d=r(179),h=r(30);var p;!function(e){e[e.None=0]="None",e[e.ACS=2]="ACS",e[e.Grid=4]="Grid",e[e.All=65535]="All"}(t.CoordinateLockOverrides||(t.CoordinateLockOverrides={})),function(e){e[e.Start=1]="Start",e[e.Resume=2]="Resume"}(t.StartOrResume||(t.StartOrResume={})),function(e){e[e.Start=1]="Start",e[e.Stop=2]="Stop",e[e.Suspend=3]="Suspend",e[e.Unsuspend=4]="Unsuspend"}(t.ManipulatorToolEvent||(t.ManipulatorToolEvent={})),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(p||(p={}));class ToolSettings{}ToolSettings.animationTime=n.BeDuration.fromMilliseconds(260),ToolSettings.doubleTapTimeout=n.BeDuration.fromMilliseconds(250),ToolSettings.doubleClickTimeout=n.BeDuration.fromMilliseconds(500),ToolSettings.doubleClickToleranceInches=.05,ToolSettings.noMotionTimeout=n.BeDuration.fromMilliseconds(50),ToolSettings.preserveWorldUp=!0,ToolSettings.touchMoveDelay=n.BeDuration.fromMilliseconds(50),ToolSettings.startDragDelay=n.BeDuration.fromMilliseconds(110),ToolSettings.touchMoveDistanceInches=.15,ToolSettings.startDragDistanceInches=.15,ToolSettings.viewToolPickRadiusInches=.2,ToolSettings.walkCameraAngle=i.Angle.createDegrees(75.6),ToolSettings.walkEnforceZUp=!1,ToolSettings.walkVelocity=3.5,ToolSettings.wheelLineFactor=40,ToolSettings.wheelPageFactor=120,ToolSettings.wheelZoomBumpDistance=i.Constant.oneCentimeter,ToolSettings.wheelZoomRatio=1.75,t.ToolSettings=ToolSettings;class ToolState{constructor(){this.coordLockOvr=0,this.locateCircleOn=!0}setFrom(e){this.coordLockOvr=e.coordLockOvr,this.locateCircleOn=e.locateCircleOn}clone(){const e=new ToolState;return e.setFrom(this),e}}t.ToolState=ToolState;class SuspendedToolState{constructor(){this._shuttingDown=!1;const{toolAdmin:e,viewManager:t,accuSnap:r}=a.IModelApp;e.setIncompatibleViewportCursor(!0),this._toolState=e.toolState.clone(),this._accuSnapState=r.toolState.clone(),this._viewCursor=t.cursor,this._inDynamics=t.inDynamicsMode,this._inDynamics&&t.endDynamicsMode()}stop(){if(this._shuttingDown)return;const{toolAdmin:e,viewManager:t,accuSnap:r}=a.IModelApp;e.setIncompatibleViewportCursor(!0),e.toolState.setFrom(this._toolState),r.toolState.setFrom(this._accuSnapState),t.setViewCursor(this._viewCursor),this._inDynamics?t.beginDynamicsMode():t.endDynamicsMode()}}t.SuspendedToolState=SuspendedToolState;class CurrentInputState{constructor(){this._rawPoint=new i.Point3d,this._uorPoint=new i.Point3d,this._viewPoint=new i.Point3d,this.qualifiers=0,this.motionTime=0,this.button=[new h.BeButtonState,new h.BeButtonState,new h.BeButtonState],this.lastButton=0,this.inputSource=0,this.lastMotion=new i.Point2d}get rawPoint(){return this._rawPoint}set rawPoint(e){this._rawPoint.setFrom(e)}get uorPoint(){return this._uorPoint}set uorPoint(e){this._uorPoint.setFrom(e)}get viewPoint(){return this._viewPoint}set viewPoint(e){this._viewPoint.setFrom(e)}get wasMotion(){return 0!==this.motionTime}get isShiftDown(){return 0!==(2&this.qualifiers)}get isControlDown(){return 0!==(1&this.qualifiers)}get isAltDown(){return 0!==(4&this.qualifiers)}isDragging(e){return this.button[e].isDragging}onStartDrag(e){this.button[e].isDragging=!0}onInstallTool(){this.clearKeyQualifiers(),void 0!==this.lastWheelEvent&&this.lastWheelEvent.invalidate(),this.lastTouchStart=this.touchTapTimer=this.touchTapCount=void 0}clearKeyQualifiers(){this.qualifiers=0}clearViewport(e){e===this.viewport&&(this.viewport=void 0)}isAnyDragging(){return this.button.some(e=>e.isDragging)}setKeyQualifier(e,t){this.qualifiers=t?this.qualifiers|e:this.qualifiers&~e}setKeyQualifiers(e){this.setKeyQualifier(2,e.shiftKey),this.setKeyQualifier(1,e.ctrlKey),this.setKeyQualifier(4,e.altKey)}onMotion(e){this.motionTime=Date.now(),this.lastMotion.x=e.x,this.lastMotion.y=e.y}get hasMotionStopped(){const e=this.hasEventInputStopped(this.motionTime,ToolSettings.noMotionTimeout);return e.stopped&&(this.motionTime=e.eventTimer),e.stopped}hasEventInputStopped(e,t){let r=!1;return 0!==e&&Date.now()-e>=t.milliseconds&&(r=!0,e=0),{eventTimer:e,stopped:r}}changeButtonToDownPoint(e){e.point=this.button[e.button].downUorPt,e.rawPoint=this.button[e.button].downRawPt,e.viewport&&(e.viewPoint=e.viewport.worldToView(e.rawPoint))}updateDownPoint(e){this.button[e.button].downUorPt=e.point}onButtonDown(e){const t=this.viewport.worldToView(this.button[e].downRawPt),r=this.viewport.npcToView(o.NpcCenter);t.z=r.z;const n=Date.now(),i=n-this.button[e].downTime<ToolSettings.doubleClickTimeout.milliseconds&&t.distance(this.viewPoint)<this.viewport.pixelsFromInches(ToolSettings.doubleClickToleranceInches);this.button[e].init(this.uorPoint,this.rawPoint,n,!0,i,!1,this.inputSource),this.lastButton=e}onButtonUp(e){this.button[e].isDown=!1,this.button[e].isDragging=!1,this.lastButton=e}toEvent(e,t){let r=0;const n=this.uorPoint.clone();let i=this.viewport;if(t){const e=s.TentativeOrAccuSnap.getCurrentSnap(!1);e?(r=e.isHot?3:0,n.setFrom(e.isPointAdjusted?e.adjustedPoint:e.getPoint()),i=e.viewport):a.IModelApp.tentativePoint.isActive&&(r=2,n.setFrom(a.IModelApp.tentativePoint.getPoint()),i=a.IModelApp.tentativePoint.viewport)}const o=this.button[this.lastButton];e.initEvent(n,this.rawPoint,this.viewPoint,i,r,this.qualifiers,this.lastButton,o.isDown,o.isDoubleClick,o.isDragging,this.inputSource)}adjustLastDataPoint(e){const t=this.button[0];t.downUorPt=e.point,t.downRawPt=e.point,this.viewport=e.viewport}toEventFromLastDataPoint(e){const t=this.button[0],r=t.downUorPt,n=t.downRawPt,i=this.viewport.worldToView(n);e.initEvent(r,n,i,this.viewport,0,this.qualifiers,0,t.isDown,t.isDoubleClick,t.isDragging,t.inputSource)}fromPoint(e,t,r){this.viewport=e,this._viewPoint.x=t.x,this._viewPoint.y=t.y,this._viewPoint.z=e.npcToView(o.NpcCenter).z,e.viewToWorld(this._viewPoint,this._rawPoint),this._uorPoint=this._rawPoint.clone(),this.inputSource=r}fromButton(e,t,r,n){this.fromPoint(e,t,r),s.TentativeOrAccuSnap.getCurrentSnap(!1)?n&&a.IModelApp.toolAdmin.adjustSnapPoint():a.IModelApp.toolAdmin.adjustPoint(this._uorPoint,e,!0,n)}isStartDrag(e){if(this.isAnyDragging())return!1;const t=this.button[e];if(!t.isDown)return!1;if(Date.now()-t.downTime<=ToolSettings.startDragDelay.milliseconds)return!1;const r=this.viewport.worldToView(t.downRawPt);return Math.abs(this._viewPoint.x-r.x)+Math.abs(this._viewPoint.y-r.y)>this.viewport.pixelsFromInches(ToolSettings.startDragDistanceInches)}}t.CurrentInputState=CurrentInputState;class ToolAdmin{constructor(){this.currentInputState=new CurrentInputState,this.toolState=new ToolState,this._saveLocateCircle=!1,this._modifierKeyWentDown=!1,this._modifierKey=0,this.assemblyLock=!1,this.gridLock=!1,this.acsPlaneSnapLock=!1,this.acsContextLock=!1,this._toolEvents=[],this._processingEvent=!1,this.activeToolChanged=new n.BeEvent,this.manipulatorToolEvent=new n.BeEvent}get defaultToolId(){return"Select"}onInitialized(){"undefined"!==typeof document&&(this._idleTool=a.IModelApp.tools.create("Idle"),["keydown","keyup"].forEach(e=>{document.addEventListener(e,ToolAdmin._keyEventHandler,!0),ToolAdmin._removals.push(()=>{document.removeEventListener(e,ToolAdmin._keyEventHandler,!0)})}),window.onfocus=(()=>{ToolAdmin._keysCurrentlyDown.clear()}),ToolAdmin._removals.push(()=>{window.onfocus=null}))}startEventLoop(){ToolAdmin._wantEventLoop||(ToolAdmin._wantEventLoop=!0,requestAnimationFrame(ToolAdmin.eventLoop))}onShutDown(){this._idleTool=void 0,c.IconSprites.emptyAll(),ToolAdmin._wantEventLoop=!1,ToolAdmin._removals.forEach(e=>e()),ToolAdmin._removals.length=0}tryReplace(e){if(this._toolEvents.length<1)return!1;const t=this._toolEvents[this._toolEvents.length-1];return("mousemove"===t.ev.type||"touchmove"===t.ev.type)&&t.ev.type===e.ev.type&&(t.ev=e.ev,t.vp=e.vp,!0)}addEvent(e,t){const r={ev:e,vp:t};this.tryReplace(r)||this._toolEvents.push(r)}getMousePosition(e){const t=e.ev,r=e.vp.getClientRect();return i.Point2d.createFrom({x:t.clientX-r.left,y:t.clientY-r.top})}getMouseButton(e){switch(e){case 1:return 2;case 2:return 1;default:return 0}}onMouseButton(e,t){const r=e.ev,n=e.vp,i=this.getMousePosition(e),o=this.getMouseButton(r.button);return this.currentInputState.setKeyQualifiers(r),t?this.onButtonDown(n,i,o,1):this.onButtonUp(n,i,o,1)}async onWheel(e){const t=e.ev,r=this.currentInputState;if(r.setKeyQualifiers(t),0===t.deltaY)return h.EventHandled.No;let n;switch(t.deltaMode){case t.DOM_DELTA_LINE:n=-t.deltaY*ToolSettings.wheelLineFactor;break;case t.DOM_DELTA_PAGE:n=-t.deltaY*ToolSettings.wheelPageFactor;break;default:n=-t.deltaY}if(void 0===this.cursorView)return h.EventHandled.No;const i=e.vp,o=this.getMousePosition(e);i.removeAnimator(),r.fromButton(i,o,1,!0);const s=new h.BeWheelEvent;s.wheelDelta=n,r.toEvent(s,!0);const a=this.pickCanvasDecoration(s);if(void 0!==a&&void 0!==a.onWheel&&a.onWheel(s))return h.EventHandled.Yes;const c=this.activeTool;return void 0===c||h.EventHandled.Yes!==await c.onMouseWheel(s)?this.idleTool.onMouseWheel(s):h.EventHandled.Yes}async onTouch(e){const t=e.ev,r=e.vp;if(this.filterViewport(r))return;r.removeAnimator();const n=new h.BeTouchEvent(t),o=this.currentInputState,s=h.BeTouchEvent.getTouchListCentroid(0!==t.targetTouches.length?t.targetTouches:t.changedTouches,r);switch(t.type){case"touchstart":case"touchend":o.setKeyQualifiers(t)}o.fromButton(r,void 0!==s?s:i.Point2d.createZero(),2,!0),o.toEvent(n,!1);const a=this.activeTool;switch(t.type){case"touchstart":return o.lastTouchStart=n,void(void 0!==a&&a.onTouchStart(n));case"touchend":if(void 0!==a&&(await a.onTouchEnd(n),0===n.touchCount&&await a.onTouchComplete(n)),void 0===o.lastTouchStart)return;for(let e=0;e<n.touchInfo.changedTouches.length;e++){const t=n.touchInfo.changedTouches[e],i=h.BeTouchEvent.findTouchById(o.lastTouchStart.touchInfo.targetTouches,t.identifier);if(void 0!==i){const e=h.BeTouchEvent.getTouchPosition(t,r),n=h.BeTouchEvent.getTouchPosition(i,r);if(e.distance(n)<r.pixelsFromInches(ToolSettings.touchMoveDistanceInches))continue}return void(o.lastTouchStart=void 0)}if(0!==n.touchCount||void 0===o.lastTouchStart)return;return void(void 0===o.touchTapTimer?(o.touchTapTimer=Date.now(),o.touchTapCount=1):void 0!==o.touchTapCount&&o.touchTapCount++);case"touchcancel":return o.lastTouchStart=void 0,void(void 0!==a&&a.onTouchCancel(n));case"touchmove":if(void 0!==a&&a.onTouchMove(n),void 0===o.lastTouchStart)return;if(n.touchInfo.timeStamp-o.lastTouchStart.touchInfo.timeStamp<ToolSettings.touchMoveDelay.milliseconds)return;for(let e=0;e<n.touchInfo.changedTouches.length;e++){const t=n.touchInfo.changedTouches[e],i=h.BeTouchEvent.findTouchById(o.lastTouchStart.touchInfo.targetTouches,t.identifier);if(void 0===i)continue;const s=h.BeTouchEvent.getTouchPosition(t,r),c=h.BeTouchEvent.getTouchPosition(i,r);if(s.distance(c)<r.pixelsFromInches(ToolSettings.touchMoveDistanceInches))continue;const l=o.lastTouchStart;return o.lastTouchStart=void 0,void(void 0!==a&&h.EventHandled.Yes===await a.onTouchMoveStart(n,l)||this.idleTool.onTouchMoveStart(n,l))}return}}async processNextEvent(){const e=this._toolEvents.shift();if(void 0!==e)switch(e.ev.type){case"mousedown":return this.onMouseButton(e,!0);case"mouseup":return this.onMouseButton(e,!1);case"mousemove":return this.onMouseMove(e);case"mouseenter":return this.onMouseEnter(e.vp);case"mouseleave":return this.onMouseLeave(e.vp);case"wheel":return this.onWheel(e);case"keydown":return this.onKeyTransition(e,!0);case"keyup":return this.onKeyTransition(e,!1);case"touchstart":case"touchend":case"touchcancel":case"touchmove":return this.onTouch(e)}}async processEvent(){if(!this._processingEvent)try{this._processingEvent=!0,await this.onTimerEvent(),await this.processNextEvent()}catch(e){throw e}finally{this._processingEvent=!1}}static eventLoop(){ToolAdmin._wantEventLoop&&(a.IModelApp.toolAdmin.processEvent(),a.IModelApp.viewManager.renderLoop(),requestAnimationFrame(ToolAdmin.eventLoop))}get idleTool(){return this._idleTool}filterViewport(e){if(void 0===e)return!0;const t=this.activeTool;return void 0!==t&&!t.isCompatibleViewport(e,!1)}onInstallTool(e){return this.currentInputState.onInstallTool(),e.onInstall()}onPostInstallTool(e){e.onPostInstall()}get viewTool(){return this._viewTool}get primitiveTool(){return this._primitiveTool}get activeTool(){return this._viewTool?this._viewTool:this._inputCollector?this._inputCollector:this._primitiveTool}get currentTool(){return this.activeTool?this.activeTool:this.idleTool}async getToolTip(e){return this.currentTool.getToolTip(e)}onViewportClosed(e){a.IModelApp.accuSnap.clear(),this.currentInputState.clearViewport(e),this.cursorView===e&&(this.cursorView=void 0)}async onMouseEnter(e){this.cursorView=e}async onMouseLeave(e){a.IModelApp.notifications.clearToolTip(),this.cursorView=void 0,this.setCanvasDecoration(e),e.invalidateDecorations()}updateDynamics(e,t,r){if(!a.IModelApp.viewManager.inDynamicsMode||void 0===this.activeTool)return;if(void 0===e&&(e=new h.BeButtonEvent,t?this.fillEventFromLastDataButton(e):this.fillEventFromCursorLocation(e),r&&void 0!==e.viewport&&this.adjustPoint(e.point,e.viewport)),void 0===e.viewport)return;const n=new l.DynamicsContext(e.viewport);this.activeTool.onDynamicFrame(e,n),n.changeDynamics()}async onTimerEvent(){const e=this.activeTool,t=this.currentInputState;if(void 0!==t.touchTapTimer){if(Date.now()-t.touchTapTimer>=ToolSettings.doubleTapTimeout.milliseconds){const r=t.lastTouchStart,n=void 0!==t.lastTouchStart?t.lastTouchStart.touchCount:0,i=void 0!==t.touchTapCount?t.touchTapCount:0;if(t.touchTapTimer=t.touchTapCount=t.lastTouchStart=void 0,void 0!==r&&n>0&&i>0&&(r.tapCount=i,void 0!==e&&h.EventHandled.Yes===await e.onTouchTap(r)||h.EventHandled.Yes===await this.idleTool.onTouchTap(r)))return}}const r=new h.BeButtonEvent;t.toEvent(r,!0),t.wasMotion||(e&&await e.onMouseNoMotion(r),1===t.inputSource&&this.cursorView&&await a.IModelApp.accuSnap.onNoMotion(r)),t.hasMotionStopped&&(e&&await e.onMouseMotionStopped(r),1===t.inputSource&&a.IModelApp.accuSnap.onMotionStopped(r))}async sendEndDragEvent(e){let t=this.activeTool;if(void 0!==t&&(t.isValidLocation(e,!0)&&t.receivedDownEvent?t.receivedDownEvent=!1:t=void 0),void 0===t||h.EventHandled.Yes!==await t.onMouseEndDrag(e))return this.idleTool.onMouseEndDrag(e)}setCanvasDecoration(e,t,r){t!==this._canvasDecoration&&(this._canvasDecoration&&this._canvasDecoration.onMouseLeave&&this._canvasDecoration.onMouseLeave(),this._canvasDecoration=t,r&&t&&t.onMouseEnter&&t.onMouseEnter(r),e.canvas.style.cursor=t?t.decorationCursor?t.decorationCursor:"pointer":a.IModelApp.viewManager.cursor,e.invalidateDecorations())}pickCanvasDecoration(e){const t=e.viewport,r=void 0===this.viewTool?t.pickCanvasDecoration(e.viewPoint):void 0;return this.setCanvasDecoration(t,r,e),r}async onMotion(e,t,r,n=!1){const i=this.currentInputState;if(i.onMotion(t),this.filterViewport(e))return void this.setIncompatibleViewportCursor(!1);const o=new h.BeButtonEvent;i.fromPoint(e,t,r),i.toEvent(o,!1);const s=this.pickCanvasDecoration(o);if(void 0!==s)return void(s.onMouseMove&&s.onMouseMove(o));await a.IModelApp.accuSnap.onMotion(o),i.fromButton(e,t,r,!0),i.toEvent(o,!0),a.IModelApp.accuDraw.onMotion(o);const c=this.activeTool,l=void 0===c||c.isValidLocation(o,!1);if(this.setIncompatibleViewportCursor(l),n||i.isStartDrag(o.button))return i.onStartDrag(o.button),i.changeButtonToDownPoint(o),o.isDragging=!0,void 0!==c&&l&&(c.receivedDownEvent=!0),void 0!==c&&l&&h.EventHandled.Yes===await c.onMouseStartDrag(o)?void 0:this.idleTool.onMouseStartDrag(o);c&&(c.onMouseMotion(o),this.updateDynamics(o)),this.isLocateCircleOn&&e.invalidateDecorations()}async onMouseMove(e){const t=e.vp,r=this.getMousePosition(e);return 1&e.ev.buttons||(this.currentInputState.button[0].isDown=!1),this.onMotion(t,r,1)}adjustPointToACS(e,t,r){if(0!==(2&this.toolState.coordLockOvr))return;let n;n=t.view.is3d()&&t.view.isCameraOn?t.view.camera.eye.vectorTo(e):t.rotation.getRow(2);const i=t.getAuxCoordOrigin(),o=t.getAuxCoordRotation();let a=o.getRow(2);if(a.isPerpendicularTo(n)&&!s.TentativeOrAccuSnap.isHot){const e=o.getRow(0),t=o.getRow(1);a=Math.abs(e.dotProduct(n))>Math.abs(t.dotProduct(n))?e:t}u.linePlaneIntersect(e,e,n,i,a,r)}adjustPointToGrid(e,t){this.gridLock&&0===(4&this.toolState.coordLockOvr)&&t.pointToGrid(e)}adjustPoint(e,t,r=!0,n=!0){Math.abs(e.z)<1e-7&&(e.z=0);let i=!1;if(!n||a.IModelApp.tentativePoint.isActive||a.IModelApp.accuSnap.isHot||(i=a.IModelApp.accuDraw.adjustPoint(e,t,!1)),!i&&t.isPointAdjustmentRequired)n&&this.adjustPointToGrid(e,t),r&&this.adjustPointToACS(e,t,!1);else if(n){const r=e.clone();this.adjustPointToGrid(e,t),i&&!e.isExactEqual(r)&&a.IModelApp.accuDraw.adjustPoint(e,t,!1)}Math.abs(e.z)<1e-7&&(e.z=0)}adjustSnapPoint(e=!0){const t=s.TentativeOrAccuSnap.getCurrentSnap(!1);if(!t)return;const r=t.viewport,n=t.isHot,i=t.getPoint().clone(),o=i.clone();n||this.adjustPointToGrid(i,r),a.IModelApp.accuDraw.adjustPoint(i,r,n)||r.isSnapAdjustmentRequired&&this.adjustPointToACS(i,r,e||a.IModelApp.accuDraw.isActive),i.isExactEqual(o)||t.adjustedPoint.setFrom(i)}async sendButtonEvent(e){const t=this.pickCanvasDecoration(e);if(void 0!==t&&void 0!==t.onMouseButton&&t.onMouseButton(e))return;const r=this.activeTool;let n=r;if(void 0!==n&&(n.isValidLocation(e,!0)?e.isDown?n.receivedDownEvent=!0:n.receivedDownEvent?n.receivedDownEvent=!1:n=void 0:n=void 0),!a.IModelApp.accuDraw.onPreButtonEvent(e)){switch(e.button){case 0:if(void 0===n){if(void 0!==r)break;n=this.idleTool}if(!e.isDown){await n.onDataButtonUp(e);break}await n.onDataButtonDown(e),n instanceof d.PrimitiveTool&&n.autoLockTarget(),this.updateDynamics(void 0,!0);break;case 1:if(void 0===n){if(void 0!==r)break;n=this.idleTool}e.isDown?await n.onResetButtonDown(e):await n.onResetButtonUp(e);break;case 2:e.isDown?void 0!==n&&h.EventHandled.Yes===await n.onMiddleButtonDown(e)||await this.idleTool.onMiddleButtonDown(e):void 0!==n&&h.EventHandled.Yes===await n.onMiddleButtonUp(e)||await this.idleTool.onMiddleButtonUp(e)}a.IModelApp.tentativePoint.onButtonEvent(e),a.IModelApp.accuDraw.onPostButtonEvent(e)}}async onButtonDown(e,t,r,n){if(this.filterViewport(e))return;void 0===this._viewTool&&0===r&&a.IModelApp.viewManager.setSelectedView(e),e.removeAnimator();const i=new h.BeButtonEvent,o=this.currentInputState;return o.fromButton(e,t,n,!0),o.onButtonDown(r),o.toEvent(i,!0),o.updateDownPoint(i),this.sendButtonEvent(i)}async onButtonUp(e,t,r,n){if(this.filterViewport(e))return;const i=new h.BeButtonEvent,o=this.currentInputState,s=o.isDragging(r);return o.fromButton(e,t,n,!0),o.onButtonUp(r),o.toEvent(i,!0),s?this.sendEndDragEvent(i):(o.changeButtonToDownPoint(i),this.sendButtonEvent(i))}async onModifierKeyTransition(e,t,r){if(e===this._modifierKeyWentDown&&t===this._modifierKey)return;const n=this.activeTool,i=n?await n.onModifierKeyTransition(e,t,r):h.EventHandled.No;this._modifierKey=t,this._modifierKeyWentDown=e,i===h.EventHandled.Yes&&(a.IModelApp.viewManager.invalidateDecorationsAllViews(),this.updateDynamics())}static getModifierKey(e){switch(e.key){case"Alt":return 4;case"Shift":return 2;case"Control":return 1}return 0}async onKeyTransition(e,t){const r=this.activeTool;if(!r)return;const n=e.ev;this.currentInputState.setKeyQualifiers(n);const i=ToolAdmin.getModifierKey(n);return 0!==i?this.onModifierKeyTransition(t,i,n):r.onKeyTransition(t,n)}onUnsuspendTool(){const e=this.activeTool;void 0!==e&&(e.onUnsuspend(),this.activeToolChanged.raiseEvent(e,2))}setInputCollector(e){void 0!==this._inputCollector&&(this._inputCollector.onCleanup(),this._inputCollector=void 0),this._inputCollector=e}exitInputCollector(){if(void 0===this._inputCollector)return;let e=!1;this._suspendedByInputCollector&&(this._suspendedByInputCollector.stop(),this._suspendedByInputCollector=void 0,e=!0),a.IModelApp.viewManager.invalidateDecorationsAllViews(),this.setInputCollector(void 0),e&&this.onUnsuspendTool(),a.IModelApp.accuDraw.onInputCollectorExit(),this.updateDynamics()}startInputCollector(e){if(a.IModelApp.accuDraw.onInputCollectorInstall(),void 0!==this._inputCollector)this.setInputCollector(void 0);else{const e=this.activeTool;e&&e.onSuspend(),this._suspendedByInputCollector=new SuspendedToolState}a.IModelApp.viewManager.endDynamicsMode(),this.activeToolChanged.raiseEvent(e,1),a.IModelApp.viewManager.invalidateDecorationsAllViews(),this.setInputCollector(e)}setViewTool(e){void 0!==this._viewTool&&(this._viewTool.onCleanup(),this._viewTool=void 0),this._viewTool=e}exitViewTool(){if(void 0===this._viewTool)return;let e=!1;void 0!==this._suspendedByViewTool&&(this._suspendedByViewTool.stop(),this._suspendedByViewTool=void 0,e=!0),a.IModelApp.viewManager.invalidateDecorationsAllViews(),this.setViewTool(void 0),e&&this.onUnsuspendTool(),a.IModelApp.accuDraw.onViewToolExit(),this.updateDynamics()}startViewTool(e){if(a.IModelApp.accuDraw.onViewToolInstall(),void 0!==this._viewTool)this.setViewTool(void 0);else{const e=this.activeTool;e&&e.onSuspend(),this._suspendedByViewTool=new SuspendedToolState}a.IModelApp.viewManager.endDynamicsMode(),this.activeToolChanged.raiseEvent(e,1),a.IModelApp.viewManager.invalidateDecorationsAllViews(),this.toolState.coordLockOvr=65535,this.toolState.locateCircleOn=!1,a.IModelApp.accuSnap.onStartTool(),this.setCursor(a.IModelApp.viewManager.crossHairCursor),this.setViewTool(e)}setPrimitiveTool(e){void 0!==this._primitiveTool&&(this._primitiveTool.onCleanup(),this._primitiveTool=void 0),this._primitiveTool=e}startPrimitiveTool(e){this.exitViewTool(),void 0!==this._primitiveTool&&this.setPrimitiveTool(void 0),this.exitInputCollector(),a.IModelApp.viewManager.endDynamicsMode(),this.activeToolChanged.raiseEvent(void 0!==e?e:this.idleTool,1),this.setIncompatibleViewportCursor(!0),this.toolState.coordLockOvr=0,this.toolState.locateCircleOn=!1,a.IModelApp.accuDraw.onPrimitiveToolInstall(),a.IModelApp.accuSnap.onStartTool(),void 0!==e&&(this.setCursor(a.IModelApp.viewManager.crossHairCursor),this.setPrimitiveTool(e))}startDefaultTool(){a.IModelApp.tools.run(this.defaultToolId)||this.startPrimitiveTool(void 0)}setCursor(e){void 0===this._saveCursor?a.IModelApp.viewManager.setViewCursor(e):this._saveCursor=e}testDecorationHit(e){return this.currentTool.testDecorationHit(e)}getDecorationGeometry(e){return this.currentTool.getDecorationGeometry(e)}decorate(e){const t=this.activeTool;if(void 0!==t&&(t.decorate(e),void 0!==this._inputCollector&&t!==this._inputCollector&&this._inputCollector.decorateSuspended(e),void 0!==this._primitiveTool&&t!==this._primitiveTool&&this._primitiveTool.decorateSuspended(e)),this.cursorView!==e.viewport)return;const r=new h.BeButtonEvent;this.fillEventFromCursorLocation(r);const n=this.cursorView,i=a.IModelApp.accuDraw.isActive?void 0:a.IModelApp.accuSnap.currHit;n.drawLocateCursor(e,r.point,n.pixelsFromInches(a.IModelApp.locateManager.apertureInches),this.isLocateCircleOn,i)}get isLocateCircleOn(){return this.toolState.locateCircleOn&&1===this.currentInputState.inputSource&&void 0===this._canvasDecoration}beginDynamics(){a.IModelApp.accuDraw.onBeginDynamics(),a.IModelApp.viewManager.beginDynamicsMode(),this.setLocateCursor(!1)}endDynamics(){a.IModelApp.accuDraw.onEndDynamics(),a.IModelApp.viewManager.endDynamicsMode(),this.setLocateCursor(!0)}fillEventFromCursorLocation(e){this.currentInputState.toEvent(e,!0)}fillEventFromLastDataButton(e){this.currentInputState.toEventFromLastDataPoint(e)}setAdjustedDataPoint(e){this.currentInputState.adjustLastDataPoint(e)}async convertTouchTapToButtonDownAndUp(e,t=0){const r=e.getDisplayPoint();return await this.onButtonDown(e.viewport,r,t,2),this.onButtonUp(e.viewport,r,t,2)}async convertTouchMoveStartToButtonDownAndMotion(e,t,r=0){return await this.onButtonDown(e.viewport,e.getDisplayPoint(),r,2),this.onMotion(t.viewport,t.getDisplayPoint(),2,!0)}async convertTouchStartToButtonDown(e,t=0){return this.onButtonDown(e.viewport,e.getDisplayPoint(),t,2)}async convertTouchEndToButtonUp(e,t=0){return this.onButtonUp(e.viewport,e.getDisplayPoint(),t,2)}async convertTouchMoveToMotion(e){return this.onMotion(e.viewport,e.getDisplayPoint(),2)}setIncompatibleViewportCursor(e){if(e){if(void 0===this._saveCursor)return;return this.toolState.locateCircleOn=this._saveLocateCircle,a.IModelApp.viewManager.setViewCursor(this._saveCursor),void(this._saveCursor=void 0)}void 0===this._saveCursor&&(this._saveLocateCircle=this.toolState.locateCircleOn,this._saveCursor=a.IModelApp.viewManager.cursor,this.toolState.locateCircleOn=!1,a.IModelApp.viewManager.setViewCursor("not-allowed"))}async processWheelEvent(e,t){return await WheelEventProcessor.process(e,t),this.updateDynamics(e),a.IModelApp.viewManager.invalidateDecorationsAllViews(),h.EventHandled.Yes}onSelectedViewportChanged(e,t){a.IModelApp.accuDraw.onSelectedViewportChanged(e,t),void 0!==t?(void 0!==this._viewTool&&this._viewTool.onSelectedViewportChanged(e,t),void 0!==this._inputCollector&&this._inputCollector.onSelectedViewportChanged(e,t),void 0!==this._primitiveTool&&this._primitiveTool.onSelectedViewportChanged(e,t)):this.callOnCleanup()}setLocateCircleOn(e){void 0===this._saveCursor?this.toolState.locateCircleOn=e:this._saveLocateCircle=e}setLocateCursor(e){const{viewManager:t}=a.IModelApp;this.setCursor(t.inDynamicsMode?a.IModelApp.viewManager.dynamicsCursor:a.IModelApp.viewManager.crossHairCursor),this.setLocateCircleOn(e),t.invalidateDecorationsAllViews()}callOnCleanup(){this.exitViewTool(),this.exitInputCollector(),void 0!==this._primitiveTool&&this._primitiveTool.onCleanup()}}ToolAdmin._wantEventLoop=!1,ToolAdmin._removals=[],ToolAdmin._keysCurrentlyDown=new Set,ToolAdmin._keyEventHandler=(e=>{if(!e.repeat){if("keydown"===e.type){if(ToolAdmin._keysCurrentlyDown.has(e.code))return;ToolAdmin._keysCurrentlyDown.add(e.code)}else ToolAdmin._keysCurrentlyDown.delete(e.code);a.IModelApp.toolAdmin.addEvent(e)}}),t.ToolAdmin=ToolAdmin;class WheelEventProcessor{static async process(e,t){const r=e.viewport;void 0!==r&&(await this.doZoom(e),t&&(r.synchWithView(!0),a.IModelApp.accuSnap.clear()))}static async doZoom(e){const t=e.viewport;if(void 0===t)return 15;let r=ToolSettings.wheelZoomRatio;r<1&&(r=1),e.wheelDelta>0&&(r=1/r);let n=!1;const o=i.Point3d.create();let s;if(a.IModelApp.tentativePoint.isActive?(n=!0,o.setFrom(a.IModelApp.tentativePoint.getPoint())):(n=1===e.coordsFrom,o.setFrom(n?e.point:e.rawPoint)),t.view.is3d()&&t.isCameraOn){let c=!1;if(!n){const r=t.worldToNpc(o),n=new i.Point3d,s=a.IModelApp.toolAdmin.currentInputState.lastWheelEvent;s&&s.viewport&&s.viewport.view.equals(t.view)&&s.viewPoint.distanceSquaredXY(e.viewPoint)<10?(t.worldToNpc(s.point,n),r.z=n.z,c=!0):void 0!==t.pickNearestVisibleGeometry(o,t.pixelsFromInches(ToolSettings.viewToolPickRadiusInches),n)?(t.worldToNpc(n,n),r.z=n.z):(t.view.getTargetPoint(n),t.worldToNpc(n,n),r.z=n.z),t.npcToWorld(r,o)}const l=t.view,u=i.Transform.createFixedPointAndMatrix(o,i.Matrix3d.createScale(r,r,r)),d=l.getEyePoint(),h=u.multiplyPoint3d(d),p=i.Vector3d.createStartEnd(d,h);!n&&p.magnitude()<ToolSettings.wheelZoomBumpDistance&&(p.scaleToLength(ToolSettings.wheelZoomBumpDistance/3,p),c=!1,o.addInPlace(p));const f=l.getTargetPoint().clone();if(f.addInPlace(p),h.setFrom(d.plus(p)),!c){const t=e.clone();t.point.setFrom(o),a.IModelApp.toolAdmin.currentInputState.lastWheelEvent=t}s=l.lookAt(h,f,l.getYVector()),t.synchWithView(!1)}else{const e=t.worldToNpc(o),n=i.Transform.createFixedPointAndMatrix(e,i.Matrix3d.createScale(r,r,1)),a=i.Point3d.create(.5,.5,.5);n.multiplyPoint3d(a,a),t.npcToWorld(a,a),t.zoom(a,r,{saveInUndo:!1,animateFrustumChange:!1}),s=0}return await a.IModelApp.accuSnap.reEvaluate(),s}}t.WheelEventProcessor=WheelEventProcessor},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(8),o=r(0);!function(e){e[e.Toast=0]="Toast",e[e.Pointer=1]="Pointer",e[e.Sticky=2]="Sticky",e[e.InputField=3]="InputField",e[e.Alert=4]="Alert"}(t.OutputMessageType||(t.OutputMessageType={})),function(e){e[e.None=0]="None",e[e.Error=10]="Error",e[e.Warning=11]="Warning",e[e.Info=12]="Info",e[e.Debug=13]="Debug",e[e.Fatal=17]="Fatal"}(t.OutputMessagePriority||(t.OutputMessagePriority={})),function(e){e[e.None=0]="None",e[e.Dialog=1]="Dialog",e[e.Balloon=2]="Balloon"}(t.OutputMessageAlert||(t.OutputMessageAlert={})),function(e){e[e.Left=0]="Left",e[e.Top=1]="Top",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom",e[e.TopLeft=4]="TopLeft",e[e.TopRight=5]="TopRight",e[e.BottomLeft=6]="BottomLeft",e[e.BottomRight=7]="BottomRight"}(t.RelativePosition||(t.RelativePosition={})),function(e){e[e.Completed=0]="Completed",e[e.Cancelled=1]="Cancelled"}(t.ActivityMessageEndReason||(t.ActivityMessageEndReason={})),function(e){e[e.OkCancel=0]="OkCancel",e[e.Ok=1]="Ok",e[e.LargeOk=2]="LargeOk",e[e.MediumAlert=3]="MediumAlert",e[e.YesNoCancel=4]="YesNoCancel",e[e.YesNo=5]="YesNo"}(t.MessageBoxType||(t.MessageBoxType={})),function(e){e[e.NoSymbol=0]="NoSymbol",e[e.Information=1]="Information",e[e.Question=2]="Question",e[e.Warning=3]="Warning",e[e.Critical=4]="Critical"}(t.MessageBoxIconType||(t.MessageBoxIconType={})),function(e){e[e.Apply=1]="Apply",e[e.Reset=2]="Reset",e[e.Ok=3]="Ok",e[e.Cancel=4]="Cancel",e[e.Default=5]="Default",e[e.Yes=6]="Yes",e[e.No=7]="No",e[e.Retry=8]="Retry",e[e.Stop=9]="Stop",e[e.Help=10]="Help",e[e.YesToAll=11]="YesToAll",e[e.NoToAll=12]="NoToAll"}(t.MessageBoxValue||(t.MessageBoxValue={}));t.NotifyMessageDetails=class NotifyMessageDetails{constructor(e,t,r,n=0,i=0){this.priority=e,this.briefMessage=t,this.detailedMessage=r,this.msgType=n,this.openAlert=i,this.displayTime=o.BeDuration.fromSeconds(3.5),this.relativePosition=5}setPointerTypeDetails(e,t,r=5){this.viewport=e,this.displayPoint=n.Point2d.fromJSON(t),this.relativePosition=r}};t.ActivityMessageDetails=class ActivityMessageDetails{constructor(e,t,r){this.showProgressBar=e,this.showPercentInMessage=t,this.supportsCancellation=r,this.wasCancelled=!1}onActivityCancelled(){this.wasCancelled=!0}onActivityCompleted(){this.wasCancelled=!1}};t.NotificationManager=class NotificationManager{constructor(){this.toolTipLocation=new n.Point2d}outputPromptByKey(e){this.outputPrompt(i.IModelApp.i18n.translate(e))}outputPrompt(e){}outputMessage(e){}openMessageBox(e,t,r){return Promise.resolve(3)}setupActivityMessage(e){return!0}outputActivityMessage(e,t){return!0}endActivityMessage(e){return!0}get isToolTipSupported(){return!1}get isToolTipOpen(){return!1}_showToolTip(e,t,r,n){}openToolTip(e,t,r,n){this.toolTipLocation.setFrom(r),this._showToolTip(e,t,r,n)}clearToolTip(){}closePointerMessage(){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class QuantityConstants{static get LocaleSpecificDecimalSeparator(){if(QuantityConstants._LOCALE_DECIMAL_SEPARATOR.length>0)return QuantityConstants._LOCALE_DECIMAL_SEPARATOR;QuantityConstants._LOCALE_DECIMAL_SEPARATOR=".";const e=12345.6789.toLocaleString().match(/345(.*)67/);return e&&e.length>1&&(QuantityConstants._LOCALE_DECIMAL_SEPARATOR=e[1]),QuantityConstants._LOCALE_DECIMAL_SEPARATOR}static get LocaleSpecificThousandSeparator(){if(QuantityConstants._LOCALE_THOUSAND_SEPARATOR.length>0)return QuantityConstants._LOCALE_THOUSAND_SEPARATOR;QuantityConstants._LOCALE_THOUSAND_SEPARATOR=",";const e=12345.6789.toLocaleString().match(/12(.*)345/);return e&&e.length>0&&(QuantityConstants._LOCALE_THOUSAND_SEPARATOR=e[1]),QuantityConstants._LOCALE_THOUSAND_SEPARATOR}}QuantityConstants.CHAR_COMMA=44,QuantityConstants.CHAR_SPACE=32,QuantityConstants.CHAR_NUMBER=35,QuantityConstants.CHAR_PLUS=43,QuantityConstants.CHAR_MINUS=45,QuantityConstants.CHAR_PERIOD=46,QuantityConstants.CHAR_SLASH=47,QuantityConstants.CHAR_DIVISION_SLASH=8725,QuantityConstants.CHAR_FRACTION_SLASH=8260,QuantityConstants.CHAR_ONE_QUARTER=188,QuantityConstants.CHAR_ONE_HALF=189,QuantityConstants.CHAR_THREE_QUARTER=190,QuantityConstants.CHAR_DIGIT_ZERO=48,QuantityConstants.CHAR_DIGIT_NINE=57,QuantityConstants.CHAR_UPPER_E=69,QuantityConstants.CHAR_LOWER_E=101,QuantityConstants._LOCALE_DECIMAL_SEPARATOR="",QuantityConstants._LOCALE_THOUSAND_SEPARATOR="",t.QuantityConstants=QuantityConstants},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);r(0);class Matrix3{constructor(){this.data=new Float32Array(9)}initIdentity(){this.setValues(1,0,0,0,1,0,0,0,1)}static fromIdentity(e){const t=void 0!==e?e:new Matrix3;return t.initIdentity(),t}copyFrom(e){for(let t=0;t<this.data.length;t++)this.data[t]=e.data[t]}clone(e){const t=void 0!==e?e:new Matrix3;return t.copyFrom(this),t}setValues(e,t,r,n,i,o,s,a,c){this.m00=e,this.m01=t,this.m02=r,this.m10=n,this.m11=i,this.m12=o,this.m20=s,this.m21=a,this.m22=c}static fromValues(e,t,r,n,i,o,s,a,c,l){const u=void 0!==l?l:new Matrix3;return u.setValues(e,t,r,n,i,o,s,a,c),u}initFromMatrix3d(e){this.setValues(e.at(0,0),e.at(0,1),e.at(0,2),e.at(1,0),e.at(1,1),e.at(1,2),e.at(2,0),e.at(2,1),e.at(2,2))}static fromMatrix3d(e,t){const r=void 0!==t?t:new Matrix3;return r.initFromMatrix3d(e),r}toMatrix3d(){const e=this.data;return n.Matrix3d.createRowValues(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}swap(e,t){this.data.length,this.data.length;const r=this.data[e];this.data[e]=this.data[t],this.data[t]=r}transpose(){this.swap(1,3),this.swap(5,7),this.swap(2,6)}static fromTranspose(e,t){const r=e.clone(t);return r.transpose(),r}get(e){return this.data.length,this.data[e]}set(e,t){this.data.length,this.data[e]=t}at(e,t){return this.get(3*t+e)}setAt(e,t,r){this.set(3*t+e,r)}get m00(){return this.at(0,0)}set m00(e){this.setAt(0,0,e)}get m01(){return this.at(0,1)}set m01(e){this.setAt(0,1,e)}get m02(){return this.at(0,2)}set m02(e){this.setAt(0,2,e)}get m10(){return this.at(1,0)}set m10(e){this.setAt(1,0,e)}get m11(){return this.at(1,1)}set m11(e){this.setAt(1,1,e)}get m12(){return this.at(1,2)}set m12(e){this.setAt(1,2,e)}get m20(){return this.at(2,0)}set m20(e){this.setAt(2,0,e)}get m21(){return this.at(2,1)}set m21(e){this.setAt(2,1,e)}get m22(){return this.at(2,2)}set m22(e){this.setAt(2,2,e)}}t.Matrix3=Matrix3;class Matrix4{constructor(){this.data=new Float32Array(16)}copyFrom(e){for(let t=0;t<this.data.length;t++)this.data[t]=e.data[t]}clone(e){const t=void 0!==e?e:new Matrix4;return t.copyFrom(this),t}initIdentity(){this.setValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static fromIdentity(e){const t=void 0!==e?e:new Matrix4;return t.initIdentity(),t}setValues(e,t,r,n,i,o,s,a,c,l,u,d,h,p,f,g){this.m00=e,this.m01=t,this.m02=r,this.m03=n,this.m10=i,this.m11=o,this.m12=s,this.m13=a,this.m20=c,this.m21=l,this.m22=u,this.m23=d,this.m30=h,this.m31=p,this.m32=f,this.m33=g}static fromValues(e,t,r,n,i,o,s,a,c,l,u,d,h,p,f,g,m){const y=void 0!==m?m:new Matrix4;return y.setValues(e,t,r,n,i,o,s,a,c,l,u,d,h,p,f,g),y}getRotation(e){const t=void 0!==e?e:new Matrix3;return t.setValues(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22),t}initFromTransform(e){const t=e.matrix,r=e.origin;this.setValues(t.at(0,0),t.at(0,1),t.at(0,2),r.x,t.at(1,0),t.at(1,1),t.at(1,2),r.y,t.at(2,0),t.at(2,1),t.at(2,2),r.z,0,0,0,1)}static fromTransform(e,t){const r=void 0!==t?t:new Matrix4;return r.initFromTransform(e),r}toTransform(){const e=this.data;0===e[3]&&0===e[7]&&0===e[11]&&e[15];const t=new n.Point3d(e[12],e[13],e[14]),r=n.Matrix3d.createIdentity();for(let n=0;n<3;n++)for(let t=0;t<3;t++)r.setAt(n,t,e[n+4*t]);return n.Transform.createRefs(t,r)}initFromMatrix4d(e){this.setValues(e.atIJ(0,0),e.atIJ(0,1),e.atIJ(0,2),e.atIJ(0,3),e.atIJ(1,0),e.atIJ(1,1),e.atIJ(1,2),e.atIJ(1,3),e.atIJ(2,0),e.atIJ(2,1),e.atIJ(2,2),e.atIJ(2,3),e.atIJ(3,0),e.atIJ(3,1),e.atIJ(3,2),e.atIJ(3,3))}static fromMatrix4d(e,t){const r=void 0!==t?t:new Matrix4;return r.initFromMatrix4d(e),r}toMatrix4d(){const e=this.data;return n.Matrix4d.createRowValues(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}lookAt(e,t,r){const s=o(t,e);if(void 0===s)return!1;const a=i(s,r);if(void 0===a)return!1;const c=n.Vector3d.createCrossProduct(a.x,a.y,a.z,s.x,s.y,s.z);return this.setValues(a.x,a.y,a.z,-a.dotProduct(e),c.x,c.y,c.z,-c.dotProduct(e),-s.x,-s.y,-s.z,s.dotProduct(e),0,0,0,1),!0}static fromLookAt(e,t,r,n){const i=void 0!==n?n:new Matrix4;return i.lookAt(e,t,r)?i:void 0}frustum(e,t,r,n,i,o){this.setValues(2*i/(t-e),0,(t+e)/(t-e),0,0,2*i/(n-r),(n+r)/(n-r),0,0,0,-(o+i)/(o-i),-2*o*i/(o-i),0,0,-1,0)}static fromFrustum(e,t,r,n,i,o,s){const a=void 0!==s?s:new Matrix4;return a.frustum(e,t,r,n,i,o),a}perspective(e,t,r,n){const i=Math.tan(e/360*Math.PI)*r,o=i*t;this.frustum(-o,o,-i,i,r,n)}static fromPerspective(e,t,r,n,i){const o=void 0!==i?i:new Matrix4;return o.perspective(e,t,r,n),o}ortho(e,t,r,n,i,o){this.setValues(2/(t-e),0,0,-(t+e)/(t-e),0,2/(n-r),0,-(n+r)/(n-r),0,0,-2/(o-i),-(o+i)/(o-i),0,0,0,1)}static fromOrtho(e,t,r,n,i,o,s){const a=void 0!==s?s:new Matrix4;return a.ortho(e,t,r,n,i,o),a}invert(){const e=this.data,t=e[0],r=e[1],n=e[2],i=e[3];this.setValues(e[5]*e[10]*e[15]-e[5]*e[11]*e[14]-e[9]*e[6]*e[15]+e[9]*e[7]*e[14]+e[13]*e[6]*e[11]-e[13]*e[7]*e[10],-e[4]*e[10]*e[15]+e[4]*e[11]*e[14]+e[8]*e[6]*e[15]-e[8]*e[7]*e[14]-e[12]*e[6]*e[11]+e[12]*e[7]*e[10],e[4]*e[9]*e[15]-e[4]*e[11]*e[13]-e[8]*e[5]*e[15]+e[8]*e[7]*e[13]+e[12]*e[5]*e[11]-e[12]*e[7]*e[9],-e[4]*e[9]*e[14]+e[4]*e[10]*e[13]+e[8]*e[5]*e[14]-e[8]*e[6]*e[13]-e[12]*e[5]*e[10]+e[12]*e[6]*e[9],-e[1]*e[10]*e[15]+e[1]*e[11]*e[14]+e[9]*e[2]*e[15]-e[9]*e[3]*e[14]-e[13]*e[2]*e[11]+e[13]*e[3]*e[10],e[0]*e[10]*e[15]-e[0]*e[11]*e[14]-e[8]*e[2]*e[15]+e[8]*e[3]*e[14]+e[12]*e[2]*e[11]-e[12]*e[3]*e[10],-e[0]*e[9]*e[15]+e[0]*e[11]*e[13]+e[8]*e[1]*e[15]-e[8]*e[3]*e[13]-e[12]*e[1]*e[11]+e[12]*e[3]*e[9],e[0]*e[9]*e[14]-e[0]*e[10]*e[13]-e[8]*e[1]*e[14]+e[8]*e[2]*e[13]+e[12]*e[1]*e[10]-e[12]*e[2]*e[9],e[1]*e[6]*e[15]-e[1]*e[7]*e[14]-e[5]*e[2]*e[15]+e[5]*e[3]*e[14]+e[13]*e[2]*e[7]-e[13]*e[3]*e[6],-e[0]*e[6]*e[15]+e[0]*e[7]*e[14]+e[4]*e[2]*e[15]-e[4]*e[3]*e[14]-e[12]*e[2]*e[7]+e[12]*e[3]*e[6],e[0]*e[5]*e[15]-e[0]*e[7]*e[13]-e[4]*e[1]*e[15]+e[4]*e[3]*e[13]+e[12]*e[1]*e[7]-e[12]*e[3]*e[5],-e[0]*e[5]*e[14]+e[0]*e[6]*e[13]+e[4]*e[1]*e[14]-e[4]*e[2]*e[13]-e[12]*e[1]*e[6]+e[12]*e[2]*e[5],-e[1]*e[6]*e[11]+e[1]*e[7]*e[10]+e[5]*e[2]*e[11]-e[5]*e[3]*e[10]-e[9]*e[2]*e[7]+e[9]*e[3]*e[6],e[0]*e[6]*e[11]-e[0]*e[7]*e[10]-e[4]*e[2]*e[11]+e[4]*e[3]*e[10]+e[8]*e[2]*e[7]-e[8]*e[3]*e[6],-e[0]*e[5]*e[11]+e[0]*e[7]*e[9]+e[4]*e[1]*e[11]-e[4]*e[3]*e[9]-e[8]*e[1]*e[7]+e[8]*e[3]*e[5],e[0]*e[5]*e[10]-e[0]*e[6]*e[9]-e[4]*e[1]*e[10]+e[4]*e[2]*e[9]+e[8]*e[1]*e[6]-e[8]*e[2]*e[5]);const o=t*e[0]+r*e[4]+n*e[8]+i*e[12];return 0===o?(this.initIdentity(),!1):(this.multiplyByScalar(1/o),!0)}static fromInverse(e,t){const r=e.clone(t);return r.invert()?r:void 0}swap(e,t){this.data.length,this.data.length;const r=this.data[e];this.data[e]=this.data[t],this.data[t]=r}transpose(){this.swap(1,4),this.swap(2,8),this.swap(3,12),this.swap(6,9),this.swap(7,13),this.swap(11,14)}static fromTranspose(e,t){const r=e.clone(t);return r.transpose(),r}multiplyBy(e){const t=this.data,r=e.data;this.setValues(t[0]*r[0]+t[4]*r[1]+t[8]*r[2]+t[12]*r[3],t[0]*r[4]+t[4]*r[5]+t[8]*r[6]+t[12]*r[7],t[0]*r[8]+t[4]*r[9]+t[8]*r[10]+t[12]*r[11],t[0]*r[12]+t[4]*r[13]+t[8]*r[14]+t[12]*r[15],t[1]*r[0]+t[5]*r[1]+t[9]*r[2]+t[13]*r[3],t[1]*r[4]+t[5]*r[5]+t[9]*r[6]+t[13]*r[7],t[1]*r[8]+t[5]*r[9]+t[9]*r[10]+t[13]*r[11],t[1]*r[12]+t[5]*r[13]+t[9]*r[14]+t[13]*r[15],t[2]*r[0]+t[6]*r[1]+t[10]*r[2]+t[14]*r[3],t[2]*r[4]+t[6]*r[5]+t[10]*r[6]+t[14]*r[7],t[2]*r[8]+t[6]*r[9]+t[10]*r[10]+t[14]*r[11],t[2]*r[12]+t[6]*r[13]+t[10]*r[14]+t[14]*r[15],t[3]*r[0]+t[7]*r[1]+t[11]*r[2]+t[15]*r[3],t[3]*r[4]+t[7]*r[5]+t[11]*r[6]+t[15]*r[7],t[3]*r[8]+t[7]*r[9]+t[11]*r[10]+t[15]*r[11],t[3]*r[12]+t[7]*r[13]+t[11]*r[14]+t[15]*r[15])}static fromProduct(e,t,r){const n=e.clone(r);return n.multiplyBy(t),n}multiplyByScalar(e){for(let t=0;t<this.data.length;t++)this.data[t]*=e}get(e){return this.data.length,this.data[e]}set(e,t){this.data.length,this.data[e]=t}at(e,t){return this.get(4*t+e)}setAt(e,t,r){this.set(4*t+e,r)}get m00(){return this.at(0,0)}set m00(e){this.setAt(0,0,e)}get m01(){return this.at(0,1)}set m01(e){this.setAt(0,1,e)}get m02(){return this.at(0,2)}set m02(e){this.setAt(0,2,e)}get m03(){return this.at(0,3)}set m03(e){this.setAt(0,3,e)}get m10(){return this.at(1,0)}set m10(e){this.setAt(1,0,e)}get m11(){return this.at(1,1)}set m11(e){this.setAt(1,1,e)}get m12(){return this.at(1,2)}set m12(e){this.setAt(1,2,e)}get m13(){return this.at(1,3)}set m13(e){this.setAt(1,3,e)}get m20(){return this.at(2,0)}set m20(e){this.setAt(2,0,e)}get m21(){return this.at(2,1)}set m21(e){this.setAt(2,1,e)}get m22(){return this.at(2,2)}set m22(e){this.setAt(2,2,e)}get m23(){return this.at(2,3)}set m23(e){this.setAt(2,3,e)}get m30(){return this.at(3,0)}set m30(e){this.setAt(3,0,e)}get m31(){return this.at(3,1)}set m31(e){this.setAt(3,1,e)}get m32(){return this.at(3,2)}set m32(e){this.setAt(3,2,e)}get m33(){return this.at(3,3)}set m33(e){this.setAt(3,3,e)}}function i(e,t){return e.unitCrossProduct(t)}function o(e,t){return n.Vector3d.createStartEnd(t,e).normalize()}t.Matrix4=Matrix4,t.fromNormalizedCrossProduct=i,t.normalizedDifference=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4),o=r(139),s=r(7),a=r(65),c=r(11),l=r(182);function u(e){return e.materials&&6===e.renderMode}function d(e){return 6===e.renderMode&&(e.sourceLights||e.cameraLights||e.solarLight)}class SurfaceGeometry extends o.MeshGeometry{static create(e,t){const r=a.BufferHandle.createArrayBuffer(t.data);return void 0!==r?new SurfaceGeometry(r,t.length,e):void 0}dispose(){n.dispose(this._indices)}get isLit(){return 1===this.surfaceType||3===this.surfaceType}get isTextured(){return 2===this.surfaceType||3===this.surfaceType}get isGlyph(){return void 0!==this.texture&&this.texture.isGlyph}get isTileSection(){return void 0!==this.texture&&this.texture.isTileSection}get isClassifier(){return 4===this.surfaceType}bindVertexArray(e){e.enableArray(this._indices,3,c.GL.DataType.UnsignedByte,!1,0,0)}draw(){const e=s.System.instance.context,t=1===this.renderOrder;t&&(e.enable(c.GL.POLYGON_OFFSET_FILL),e.polygonOffset(1,1)),this._indices.bind(c.GL.Buffer.Target.ArrayBuffer),e.drawArrays(c.GL.PrimitiveType.Triangles,0,this._numIndices),t&&e.disable(c.GL.POLYGON_OFFSET_FILL)}getTechniqueId(e){return 0}get isLitSurface(){return this.isLit}get hasBakedLighting(){return this._mesh.hasBakedLighting}get renderOrder(){return i.FillFlags.Behind===(this.fillFlags&i.FillFlags.Behind)?1:this.isPlanar?10:2}getColor(e){return i.FillFlags.Background===(this.fillFlags&i.FillFlags.Background)?l.ColorInfo.createFromColorDef(e.bgColor):this.colorInfo}getRenderPass(e){if(this.isClassifier)return 4;const t=this.isLit?this._mesh.material:void 0,r=this.isPlanar?2:3,n=this.fillFlags,o=e.currentViewFlags;if(0===o.renderMode){if(!(i.FillFlags.Always===(n&i.FillFlags.Always)||o.fill&&i.FillFlags.ByView===(n&i.FillFlags.ByView)))return 255}if(!this.isGlyph&&(!o.transparency||4===o.renderMode||3===o.renderMode))return r;if(void 0!==this.texture&&this.wantTextures(e,!0)){if(this.texture.hasTranslucency)return 5;if(void 0===t||void 0!==t.textureMapping&&t.textureMapping.params.weight>=1)return r}return void 0!==t&&u(o)&&t.hasTranslucency||this.getColor(e).hasTranslucency?5:r}_wantWoWReversal(e){const t=this.fillFlags;if(i.FillFlags.None!==(t&i.FillFlags.Background))return!1;if(i.FillFlags.None!==(t&i.FillFlags.Always))return!0;const r=e.currentViewFlags;return 0!==r.renderMode&&!r.visibleEdges&&((!this.isLit||!d(r))&&!this.wantTextures(e,this.isTextured))}get material(){return this._mesh.material}computeSurfaceFlags(e){const t=e.target,r=t.currentViewFlags;let n=u(r)?0:8;switch(this.isLit&&(n|=4,d(r)&&(n|=2,void 0!==t.environmentMap&&(n|=128)),this.isTextured||(n|=64)),this.wantTextures(t,this.isTextured)&&(n|=1),e.renderPass){case 1:case 2:case 3:case 5:{const e=r.renderMode;if(!this.isGlyph&&(3===e||4===e)){n|=16,3===e&&i.FillFlags.Always!==(this.fillFlags&i.FillFlags.Always)&&(n|=32);break}}}return n}constructor(e,t,r){super(r,t),this._indices=e}wantTextures(e,t){if(this.hasScalarAnimation&&void 0!==e.analysisTexture)return!0;if(!t)return!1;if(this.isGlyph)return!0;const r=this.fillFlags,n=e.currentViewFlags;switch(n.renderMode){case 6:return n.textures;case 0:return i.FillFlags.Always===(r&i.FillFlags.Always)||n.fill&&i.FillFlags.ByView===(r&i.FillFlags.ByView);default:return i.FillFlags.Always===(r&i.FillFlags.Always)}}}t.SurfaceGeometry=SurfaceGeometry;class SurfacePrimitive extends o.MeshPrimitive{static create(e,t){const r=SurfaceGeometry.create(t.meshData,e.indices);return void 0!==r?new SurfacePrimitive(r,t):void 0}constructor(e,t){super(e,t)}get renderOrder(){return i.FillFlags.Behind===(this.meshData.fillFlags&i.FillFlags.Behind)?1:this.meshData.isPlanar?10:2}}t.SurfacePrimitive=SurfacePrimitive},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(44),o=r(89),s=r(105),a=r(106),c=r(181),l=r(107),u=r(138),d=r(7),h=r(65),p=r(11);class MeshData{constructor(e,t){this.lut=e,this.features=a.FeaturesInfo.createFromVertexTable(t.vertices),this.texture=t.surface.texture,this.material=t.surface.material,this.type=t.surface.type,this.fillFlags=t.surface.fillFlags,this.isPlanar=t.isPlanar,this.hasBakedLighting=t.surface.hasBakedLighting;const r=t.edges;this.edgeWidth=void 0!==r?r.weight:1,this.edgeLineCode=o.LineCode.valueFromLinePixels(void 0!==r?r.linePixels:0)}static create(e){const t=c.VertexLUT.createFromVertexTable(e.vertices);return void 0!==t?new MeshData(t,e):void 0}dispose(){n.dispose(this.lut),void 0===this.texture||void 0!==this.texture.key||this.texture.isOwned||this.texture.dispose()}}t.MeshData=MeshData;class MeshGraphic extends s.Graphic{constructor(e,t){super(),this._primitives=[],this.meshData=e,this.addPrimitive(u.SurfacePrimitive.create(t.surface,this)),4!==this.surfaceType&&void 0!==t.edges&&(void 0!==t.edges.silhouettes&&this.addPrimitive(SilhouetteEdgePrimitive.create(t.edges.silhouettes,this)),void 0!==t.edges.segments&&this.addPrimitive(EdgePrimitive.create(t.edges.segments,this)),void 0!==t.edges.polylines&&this.addPrimitive(PolylineEdgePrimitive.create(t.edges.polylines,this)))}static create(e){const t=MeshData.create(e);return void 0!==t?new MeshGraphic(t,e):void 0}addPrimitive(e){void 0!==e&&this._primitives.push(e)}dispose(){n.dispose(this.meshData);for(const e of this._primitives)n.dispose(e);this._primitives.length=0}addCommands(e){this._primitives.forEach(t=>t.addCommands(e))}addHiliteCommands(e,t,r){this._primitives.forEach(n=>n.addHiliteCommands(e,t,r))}setUniformFeatureIndices(e){this.meshData.features=a.FeaturesInfo.createUniform(e)}setIsPixelMode(){}get surfaceType(){return this.meshData.type}}t.MeshGraphic=MeshGraphic;class MeshGeometry extends i.LUTGeometry{get edgeWidth(){return this._mesh.edgeWidth}get edgeLineCode(){return this._mesh.edgeLineCode}get featuresInfo(){return this._mesh.features}get surfaceType(){return this._mesh.type}get fillFlags(){return this._mesh.fillFlags}get isPlanar(){return this._mesh.isPlanar}get colorInfo(){return this._mesh.lut.colorInfo}get uniformColor(){return this.colorInfo.isUniform?this.colorInfo.uniform:void 0}get texture(){return this._mesh.texture}get hasBakedLighting(){return this._mesh.hasBakedLighting}get lut(){return this._mesh.lut}get hasScalarAnimation(){return void 0!==this._mesh.lut.auxParams}constructor(e,t){super(),this._numIndices=t,this._mesh=e}computeEdgeWeight(e){return e.target.getEdgeWeight(e,this.edgeWidth)}computeEdgeLineCode(e){return e.target.getEdgeLineCode(e,this.edgeLineCode)}computeEdgeColor(e){return e.isEdgeColorOverridden?e.edgeColor:this.colorInfo}computeEdgePass(e){const t=e.currentViewFlags;return 6!==t.renderMode||t.visibleEdges?0===t.renderMode&&t.transparency&&this.colorInfo.hasTranslucency?5:1:255}}t.MeshGeometry=MeshGeometry;class MeshPrimitive extends l.Primitive{get meshData(){return this.mesh.meshData}constructor(e,t){super(e),this.mesh=t}assignUniformFeatureIndices(e){}}t.MeshPrimitive=MeshPrimitive;class EdgeGeometry extends MeshGeometry{static create(e,t){const r=h.BufferHandle.createArrayBuffer(t.indices.data),n=h.BufferHandle.createArrayBuffer(t.endPointAndQuadIndices);return void 0!==r&&void 0!==n?new EdgeGeometry(r,n,t.indices.length,e):void 0}dispose(){n.dispose(this._indices),n.dispose(this._endPointAndQuadIndices)}bindVertexArray(e){e.enableArray(this._indices,3,p.GL.DataType.UnsignedByte,!1,0,0)}draw(){const e=d.System.instance.context;this._indices.bind(p.GL.Buffer.Target.ArrayBuffer),e.drawArrays(p.GL.PrimitiveType.Triangles,0,this._numIndices)}_wantWoWReversal(e){return!0}_getLineWeight(e){return this.computeEdgeWeight(e)}_getLineCode(e){return this.computeEdgeLineCode(e)}getTechniqueId(e){return 4}getRenderPass(e){return this.computeEdgePass(e)}get renderOrder(){return this.isPlanar?12:4}getColor(e){return this.computeEdgeColor(e)}get endPointAndQuadIndices(){return this._endPointAndQuadIndices}constructor(e,t,r,n){super(n,r),this._indices=e,this._endPointAndQuadIndices=t}}t.EdgeGeometry=EdgeGeometry;class EdgePrimitive extends MeshPrimitive{static create(e,t){const r=EdgeGeometry.create(t.meshData,e);return void 0!==r?new EdgePrimitive(r,t):void 0}constructor(e,t){super(e,t)}get renderOrder(){return this.meshData.isPlanar?12:4}get isEdge(){return!0}}t.EdgePrimitive=EdgePrimitive;class SilhouetteEdgeGeometry extends EdgeGeometry{static createSilhouettes(e,t){const r=h.BufferHandle.createArrayBuffer(t.indices.data),n=h.BufferHandle.createArrayBuffer(t.endPointAndQuadIndices),i=h.BufferHandle.createArrayBuffer(t.normalPairs);return void 0!==r&&void 0!==n&&void 0!==i?new SilhouetteEdgeGeometry(r,n,i,t.indices.length,e):void 0}dispose(){n.dispose(this._normalPairs),super.dispose()}getTechniqueId(e){return 5}get renderOrder(){return this.isPlanar?13:5}get normalPairs(){return this._normalPairs}constructor(e,t,r,n,i){super(e,t,n,i),this._normalPairs=r}}t.SilhouetteEdgeGeometry=SilhouetteEdgeGeometry;class SilhouetteEdgePrimitive extends MeshPrimitive{static create(e,t){const r=SilhouetteEdgeGeometry.createSilhouettes(t.meshData,e);return void 0!==r?new SilhouetteEdgePrimitive(r,t):void 0}constructor(e,t){super(e,t)}get renderOrder(){return this.meshData.isPlanar?13:5}get isEdge(){return!0}}t.SilhouetteEdgePrimitive=SilhouetteEdgePrimitive;class PolylineEdgeGeometry extends MeshGeometry{static create(e,t){const r=i.PolylineBuffers.create(t);return void 0!==r?new PolylineEdgeGeometry(t.indices.length,r,e):void 0}dispose(){n.dispose(this._buffers)}_wantWoWReversal(e){return!0}_getLineWeight(e){return this.computeEdgeWeight(e)}_getLineCode(e){return this.computeEdgeLineCode(e)}getTechniqueId(e){return 1}getRenderPass(e){return this.computeEdgePass(e)}get renderOrder(){return this.isPlanar?12:4}get polylineBuffers(){return this._buffers}bindVertexArray(e){e.enableArray(this._buffers.indices,3,p.GL.DataType.UnsignedByte,!1,0,0)}draw(){const e=d.System.instance.context;this._buffers.indices.bind(p.GL.Buffer.Target.ArrayBuffer),e.drawArrays(p.GL.PrimitiveType.Triangles,0,this._numIndices)}constructor(e,t,r){super(r,e),this._buffers=t}}t.PolylineEdgeGeometry=PolylineEdgeGeometry;class PolylineEdgePrimitive extends MeshPrimitive{static create(e,t){const r=PolylineEdgeGeometry.create(t.meshData,e);return void 0!==r?new PolylineEdgePrimitive(r,t):void 0}constructor(e,t){super(e,t)}get renderOrder(){return this.meshData.isPlanar?12:4}get isEdge(){return!0}}t.PolylineEdgePrimitive=PolylineEdgePrimitive},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(11),i=r(7);class RenderStateFlags{constructor(e){this.cull=!1,this.depthTest=!1,this.blend=!1,this.stencilTest=!1,this.depthMask=!0,this.colorWrite=!0,e&&this.copyFrom(e)}copyFrom(e){this.cull=e.cull,this.depthTest=e.depthTest,this.blend=e.blend,this.stencilTest=e.stencilTest,this.depthMask=e.depthMask,this.colorWrite=e.colorWrite}clone(e){return e?(e.copyFrom(this),e):new RenderStateFlags(this)}equals(e){return this.cull===e.cull&&this.depthTest===e.depthTest&&this.blend===e.blend&&this.stencilTest===e.stencilTest&&this.depthMask===e.depthMask&&this.colorWrite===e.colorWrite}apply(e){RenderStateFlags.enableOrDisable(this.cull,n.GL.Capability.CullFace,e.cull),RenderStateFlags.enableOrDisable(this.depthTest,n.GL.Capability.DepthTest,e.depthTest),RenderStateFlags.enableOrDisable(this.blend,n.GL.Capability.Blend,e.blend),RenderStateFlags.enableOrDisable(this.stencilTest,n.GL.Capability.StencilTest,e.stencilTest),e.depthMask!==this.depthMask&&i.System.instance.context.depthMask(this.depthMask),e.colorWrite!==this.colorWrite&&i.System.instance.context.colorMask(this.colorWrite,this.colorWrite,this.colorWrite,this.colorWrite)}static enableOrDisable(e,t,r){if(e!==r){const r=i.System.instance.context;e?r.enable(t):r.disable(t)}}}t.RenderStateFlags=RenderStateFlags;class RenderStateBlend{constructor(e){this.color=[0,0,0,0],this.equationRgb=n.GL.BlendEquation.Default,this.equationAlpha=n.GL.BlendEquation.Default,this.functionSourceRgb=n.GL.BlendFactor.DefaultSrc,this.functionSourceAlpha=n.GL.BlendFactor.DefaultSrc,this.functionDestRgb=n.GL.BlendFactor.DefaultDst,this.functionDestAlpha=n.GL.BlendFactor.DefaultDst,e&&this.copyFrom(e)}apply(e){const t=i.System.instance.context;void 0!==e&&this.equalColors(e)||t.blendColor(this.color[0],this.color[1],this.color[2],this.color[3]),void 0!==e&&e.equationRgb===this.equationRgb&&e.equationAlpha===this.equationAlpha||t.blendEquationSeparate(this.equationRgb,this.equationAlpha),void 0!==e&&e.functionSourceRgb===this.functionSourceRgb&&e.functionSourceAlpha===this.functionSourceAlpha&&e.functionDestRgb===this.functionDestRgb&&e.functionDestAlpha===this.functionDestAlpha||t.blendFuncSeparate(this.functionSourceRgb,this.functionDestRgb,this.functionSourceAlpha,this.functionDestAlpha)}copyFrom(e){this.setColor(e.color),this.equationRgb=e.equationRgb,this.equationAlpha=e.equationAlpha,this.functionSourceRgb=e.functionSourceRgb,this.functionSourceAlpha=e.functionSourceAlpha,this.functionDestRgb=e.functionDestRgb,this.functionDestAlpha=e.functionDestAlpha}clone(e){return e?(e.copyFrom(this),e):new RenderStateBlend(this)}equals(e){return this.equalColors(e)&&this.equationRgb===e.equationRgb&&this.equationAlpha===e.equationAlpha&&this.functionSourceRgb===e.functionSourceRgb&&this.functionSourceAlpha===e.functionSourceAlpha&&this.functionDestRgb===e.functionDestRgb&&this.functionDestAlpha===e.functionDestAlpha}equalColors(e){return this.color[0]===e.color[0]&&this.color[1]===e.color[1]&&this.color[2]===e.color[2]&&this.color[3]===e.color[3]}setColor(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.color[3]=e[3]}setBlendFunc(e,t){this.setBlendFuncSeparate(e,e,t,t)}setBlendFuncSeparate(e,t,r,n){this.functionSourceRgb=e,this.functionSourceAlpha=t,this.functionDestRgb=r,this.functionDestAlpha=n}}t.RenderStateBlend=RenderStateBlend;class RenderStateStencilOperation{constructor(e){this.fail=n.GL.StencilOperation.Default,this.zFail=n.GL.StencilOperation.Default,this.zPass=n.GL.StencilOperation.Default,e&&this.copyFrom(e)}copyFrom(e){this.fail=e.fail,this.zFail=e.zFail,this.zPass=e.zPass}clone(e){return e?(e.copyFrom(this),e):new RenderStateStencilOperation(this)}equals(e){return this.fail===e.fail&&this.zFail===e.zFail&&this.zPass===e.zPass}}t.RenderStateStencilOperation=RenderStateStencilOperation;class RenderStateStencilFunction{constructor(e){this.function=n.GL.StencilFunction.Default,this.ref=0,this.mask=4294967295,e&&this.copyFrom(e)}copyFrom(e){this.function=e.function,this.ref=e.ref,this.mask=e.mask}clone(e){return e?(e.copyFrom(this),e):new RenderStateStencilFunction(this)}equals(e){return this.function===e.function&&this.ref===e.ref&&this.mask===e.mask}}t.RenderStateStencilFunction=RenderStateStencilFunction;class RenderStateStencil{constructor(e){this.frontFunction=new RenderStateStencilFunction,this.backFunction=new RenderStateStencilFunction,this.frontOperation=new RenderStateStencilOperation,this.backOperation=new RenderStateStencilOperation,e&&this.copyFrom(e)}apply(e){const t=i.System.instance.context;void 0!==e&&e.frontFunction.equals(this.frontFunction)||t.stencilFuncSeparate(n.GL.CullFace.Front,this.frontFunction.function,this.frontFunction.ref,this.frontFunction.mask),void 0!==e&&e.backFunction.equals(this.backFunction)||t.stencilFuncSeparate(n.GL.CullFace.Back,this.backFunction.function,this.backFunction.ref,this.backFunction.mask),void 0!==e&&e.frontOperation.equals(this.frontOperation)||t.stencilOpSeparate(n.GL.CullFace.Front,this.frontOperation.fail,this.frontOperation.zFail,this.frontOperation.zPass),void 0!==e&&e.backOperation.equals(this.backOperation)||t.stencilOpSeparate(n.GL.CullFace.Back,this.backOperation.fail,this.backOperation.zFail,this.backOperation.zPass)}copyFrom(e){this.frontFunction.copyFrom(e.frontFunction),this.backFunction.copyFrom(e.backFunction),this.frontOperation.copyFrom(e.frontOperation),this.backOperation.copyFrom(e.backOperation)}clone(e){return e?(e.copyFrom(this),e):new RenderStateStencil(this)}equals(e){return this.frontFunction.equals(e.frontFunction)&&this.backFunction.equals(e.backFunction)&&this.frontOperation.equals(e.frontOperation)&&this.backOperation.equals(e.backOperation)}}t.RenderStateStencil=RenderStateStencil;class RenderState{constructor(e){this.flags=new RenderStateFlags,this.blend=new RenderStateBlend,this.stencil=new RenderStateStencil,this.frontFace=n.GL.FrontFace.Default,this.cullFace=n.GL.CullFace.Default,this.depthFunc=n.GL.DepthFunc.Default,this.stencilMask=4294967295,e&&this.copyFrom(e)}copyFrom(e){this.flags.copyFrom(e.flags),this.blend.copyFrom(e.blend),this.stencil.copyFrom(e.stencil),this.frontFace=e.frontFace,this.cullFace=e.cullFace,this.depthFunc=e.depthFunc,this.stencilMask=e.stencilMask}clone(e){return e?(e.copyFrom(this),e):new RenderState(this)}set clockwiseFrontFace(e){this.frontFace=e?n.GL.FrontFace.Clockwise:n.GL.FrontFace.CounterClockwise}equals(e){return this.flags.equals(e.flags)&&this.blend.equals(e.blend)&&this.stencil.equals(e.stencil)&&this.frontFace===e.frontFace&&this.cullFace===e.cullFace&&this.depthFunc===e.depthFunc&&this.stencilMask===e.stencilMask}apply(e){this.flags.apply(e.flags),this.flags.blend&&(e.flags.blend?this.blend.apply(e.blend):this.blend.apply()),this.flags.cull&&(e.flags.cull&&e.cullFace===this.cullFace||i.System.instance.context.cullFace(this.cullFace)),this.flags.depthTest&&(e.flags.depthTest&&e.depthFunc===this.depthFunc||i.System.instance.context.depthFunc(this.depthFunc)),this.flags.stencilTest&&(e.flags.stencilTest?this.stencil.apply(e.stencil):this.stencil.apply()),this.frontFace!==e.frontFace&&i.System.instance.context.frontFace(this.frontFace),this.stencilMask!==e.stencilMask&&i.System.instance.context.stencilMask(this.stencilMask)}}RenderState.defaults=new RenderState,t.RenderState=RenderState,Object.freeze(RenderState.defaults)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(41),i=r(298),o=r(11),s=r(7),a=r(296);!function(e){e[e.Unbound=0]="Unbound",e[e.Bound=1]="Bound",e[e.BoundWithAttachments=2]="BoundWithAttachments",e[e.Suspended=3]="Suspended"}(t.FrameBufferBindState||(t.FrameBufferBindState={}));class FrameBuffer{constructor(e,t,r){this._bindState=0,this._colorTextures=[],this._colorAttachments=[],this._fbo=e;const n=s.System.instance.context;this.bind(!1);let o=0;for(const i of t){const e=n.COLOR_ATTACHMENT0+o;this._colorAttachments.push(e),this._colorTextures.push(i);const t=i.getHandle();void 0!==t&&n.framebufferTexture2D(n.FRAMEBUFFER,e,n.TEXTURE_2D,t,0),o++}if(void 0!==r){this.depthBuffer=r;const e=r.getHandle();void 0!==e&&(r instanceof i.RenderBuffer?n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,e,0))}this.unbind()}get isDisposed(){return void 0===this._fbo}get isValid(){return s.System.instance.context.FRAMEBUFFER_COMPLETE===this.checkStatus()}get isBound(){return 1===this._bindState||2===this._bindState}get isSuspended(){return 3===this._bindState}getColor(e){return this._colorTextures.length,this._colorTextures[e]}static create(e,t){const r=s.System.instance.context.createFramebuffer();if(null!==r)return new FrameBuffer(r,e,t)}dispose(){this.isDisposed||(s.System.instance.context.deleteFramebuffer(this._fbo),this._fbo=void 0)}getDebugAttachmentsString(){let e="[";for(const t of this._colorTextures)e+=" "+t.getHandle()._debugId;return e+" ]"}bind(e=!1){if(this._fbo,this.isBound,void 0===this._fbo)return!1;return s.System.instance.context.bindFramebuffer(o.GL.FrameBuffer.TARGET,this._fbo),e?(s.System.instance.setDrawBuffers(this._colorAttachments),this._bindState=2,n.TextureHandle.wantDebugIds&&a.debugPrint("Bound attachments "+this.getDebugAttachmentsString())):this._bindState=1,!0}unbind(){this.isBound,s.System.instance.context.bindFramebuffer(o.GL.FrameBuffer.TARGET,null),this._bindState=0,n.TextureHandle.wantDebugIds&&a.debugPrint("Unbound attachments "+this.getDebugAttachmentsString())}suspend(){this.isBound,this._bindState=3}checkStatus(){return s.System.instance.context.checkFramebufferStatus(o.GL.FrameBuffer.TARGET)}get debugPixels(){if(!this.isBound||0===this._colorTextures.length)return;const e=this._colorTextures[0];if(o.GL.Texture.Format.Rgba!==e.format||o.GL.Texture.DataType.UnsignedByte!==e.dataType)return;const t=new Uint8Array(e.width*e.height*4);for(let r=0;r<t.length;r+=4)t[r]=186,t[r+1]=173,t[r+2]=240,t[r+3]=13;return s.System.instance.context.readPixels(0,0,e.width,e.height,e.format,e.dataType,t),t}}t.FrameBuffer=FrameBuffer;t.FrameBufferStack=class FrameBufferStack{constructor(){this._stack=[]}get _top(){return this.isEmpty?void 0:this._stack[this._stack.length-1]}push(e,t){void 0!==this._top&&this._top.fbo.suspend(),e.isBound,e.bind(t),e.isBound,this._stack.push({fbo:e,withAttachments:t})}pop(){if(this.isEmpty,void 0===this._top)return;const e=this._top.fbo;if(this._stack.pop(),e.isBound,e.unbind(),e.isBound,this.isEmpty)s.System.instance.context.bindFramebuffer(o.GL.FrameBuffer.TARGET,null);else{const e=this._top;e.fbo.isSuspended,e.fbo.bind(e.withAttachments),e.fbo.isBound}}get currentColorBuffer(){return this.isEmpty,void 0!==this._top?this._top.fbo.getColor(0):void 0}get isEmpty(){return 0===this._stack.length}execute(e,t,r){this.push(e,t),r(),this.pop()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.Pick=1]="Pick",e[e.Overrides=2]="Overrides"}(t.FeatureMode||(t.FeatureMode={}));class ClipDef{constructor(e=0,t=0){this.type=e,this.numberOfPlanes=t}static forMask(){return new ClipDef(1)}static forPlanes(e){return new ClipDef(2,e)}}t.ClipDef=ClipDef;class TechniqueFlags{constructor(e=!1){this.isTranslucent=e,this._isHilite=!1,this.isAnimated=!1,this.featureMode=0,this.clip=new ClipDef}get hasClip(){return 0!==this.clip.type}init(e,t,r=!1){7===t||12===t?this.initForHilite(e.clipDef):(this._isHilite=!1,this.isTranslucent=5===t,this.clip=e.clipDef,this.isAnimated=r,void 0!==e.currentOverrides?this.featureMode=2:void 0!==e.currentPickTable?this.featureMode=1:this.featureMode=0)}reset(e,t=!1){this._isHilite=!1,this.featureMode=e,this.isTranslucent=t,this.clip.type=0,this.clip.numberOfPlanes=0}get hasFeatures(){return 0!==this.featureMode}get isHilite(){return this._isHilite}initForHilite(e){this.featureMode=2,this._isHilite=!0,this.isTranslucent=!1,this.clip=e}buildDescription(){const e=[this.isTranslucent?"Translucent":"Opaque"];return this.isHilite&&e.push("hilite"),this.hasClip&&e.push("clip"),this.hasFeatures&&e.push(1===this.featureMode?"pick":"overrides"),e.join("; ")}}TechniqueFlags.defaults=new TechniqueFlags,t.TechniqueFlags=TechniqueFlags},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4),o=r(521),s=r(522),a=r(309),c=r(108),l=r(312),u=r(144),d=r(8),h="imodeljs-frontend.IModelConnection";class IModelConnection extends i.IModel{constructor(e,t,r){super(e.iModelToken),this.transientIds=new n.TransientIdSequence,this.connectionId=n.Guid.createValue(),this._reopenConnectionHandler=(async(e,t,r,o)=>{if(!(t instanceof i.IModelNotFoundResponse))return;const s=e.parameters[0];if(this._token.key===s.key){try{n.Logger.logTrace(h,"Attempting to reopen connection",()=>({iModelId:s.iModelId,changeSetId:s.changeSetId,key:s.key}));const e=await IModelConnection.callOpen(this._openAccessToken,s,this.openMode);this._token=e.iModelToken}catch(e){o(e.message)}n.Logger.logTrace(h,"Resubmitting original request after reopening connection",()=>({iModelId:s.iModelId,changeSetId:s.changeSetId,key:s.key})),e.parameters[0]=this._token,r()}}),super.initialize(e.name,e),this.openMode=t,this.models=new IModelConnection.Models(this),this.elements=new IModelConnection.Elements(this),this.codeSpecs=new IModelConnection.CodeSpecs(this),this.views=new IModelConnection.Views(this),this.hilited=new a.HilitedSet(this),this.selectionSet=new a.SelectionSet(this),this.tiles=new IModelConnection.Tiles(this),this._openAccessToken=r}get isReadonly(){return 1===this.openMode}async loadFontMap(){return this.fontMap||(this.fontMap=new i.FontMap(JSON.parse(await i.IModelReadRpcInterface.getClient().readFontJson(this.iModelToken))))}static registerClass(e,t){this._registry.set(e,t)}static findClass(e){return this._registry.get(e)}async findRegisteredBaseClass(e,t){let r=t;return(await i.IModelReadRpcInterface.getClient().getClassHierarchy(this.iModelToken,e)).some(t=>{const n=IModelConnection.findClass(t);return void 0!==n&&(r=n,IModelConnection.registerClass(e,r),!0)}),r}static async open(e,t,r,o=1,s=i.IModelVersion.latest()){if(!d.IModelApp.initialized)throw new i.IModelError(32768,"Call IModelApp.startup() before calling open");const a=new n.ActivityLoggingContext(n.Guid.createValue()),c=await s.evaluateChangeSet(a,e,r,d.IModelApp.iModelClient),l=new i.IModelToken(void 0,t,r,c,o),u=await IModelConnection.callOpen(e,l,o),h=new IModelConnection(u,o,e);return i.RpcRequest.notFoundHandlers.addListener(h._reopenConnectionHandler),h}static async callOpen(e,t,r){const o=100,s=5e3;let a,c,l=Math.min(o,IModelConnection._connectionTimeout);if(1===r){if(!(a=i.RpcOperation.lookup(i.IModelReadRpcInterface,"openForRead")))throw new i.IModelError(32768,"IModelReadRpcInterface.openForRead() is not available");a.policy.retryInterval=(()=>l)}else{if(!(c=i.RpcOperation.lookup(i.IModelWriteRpcInterface,"openForWrite")))throw new i.IModelError(32768,"IModelWriteRpcInterface.openForWrite() is not available");c.policy.retryInterval=(()=>l)}n.Logger.logTrace(h,"Received open request in IModelConnection.open",()=>Object.assign({},t,{openMode:r})),n.Logger.logTrace(h,`Setting open connection retry interval to ${l} milliseconds in IModelConnection.open`,()=>Object.assign({},t,{openMode:r}));const u=Date.now(),d=i.RpcRequest.events.addListener((e,o)=>{if(e!==i.RpcRequestEvent.PendingUpdateReceived)return;if((!a||o.operation!==a)&&(!c||o.operation!==c))return;n.Logger.logTrace(h,"Received pending open notification in IModelConnection.open",()=>Object.assign({},t,{openMode:r}));const d=Date.now()-u;if(d>IModelConnection._connectionTimeout)throw n.Logger.logError(h,`Timed out opening connection in IModelConnection.open (took longer than ${IModelConnection._connectionTimeout} milliseconds)`,()=>Object.assign({},t,{openMode:r})),new i.IModelError(32768,"Opening a connection was timed out");l=Math.min(s,2*l,IModelConnection._connectionTimeout-d),o.retryInterval!==l&&(o.retryInterval=l,n.Logger.logTrace(h,`Adjusted open connection retry interval to ${o.retryInterval} milliseconds in IModelConnection.open`,()=>Object.assign({},t,{openMode:r})))});let p;try{p=2===r?await i.IModelWriteRpcInterface.getClient().openForWrite(e,t):await i.IModelReadRpcInterface.getClient().openForRead(e,t)}finally{d()}return n.Logger.logTrace(h,"Completed open request in IModelConnection.open",()=>Object.assign({},t,{openMode:r})),p}async close(e){if(this.iModelToken){i.RpcRequest.notFoundHandlers.removeListener(this._reopenConnectionHandler),IModelConnection.onClose.raiseEvent(this),this.models.onIModelConnectionClose();try{await i.IModelReadRpcInterface.getClient().close(e,this.iModelToken)}finally{this._token=void 0}}}static async openStandalone(e,t=1){const r=await i.StandaloneIModelRpcInterface.getClient().openStandalone(e,t);return n.Logger.logTrace(h,"IModelConnection.openStandalone",()=>({fileName:e,openMode:t})),new IModelConnection(r,t)}async closeStandalone(){if(this.iModelToken){IModelConnection.onClose.raiseEvent(this),this.models.onIModelConnectionClose();try{await i.StandaloneIModelRpcInterface.getClient().closeStandalone(this.iModelToken)}finally{this._token=void 0}}}async loadNativeAsset(e){return i.IModelReadRpcInterface.getClient().loadNativeAsset(this.iModelToken,e)}async executeQuery(e,t){return n.Logger.logTrace(h,"IModelConnection.executeQuery",()=>({iModelId:this.iModelToken.iModelId,ecsql:e,bindings:t})),i.IModelReadRpcInterface.getClient().executeQuery(this.iModelToken,e,t)}async queryEntityIds(e){return i.IModelReadRpcInterface.getClient().queryEntityIds(this.iModelToken,e)}async updateProjectExtents(e){return n.Logger.logTrace(h,"IModelConnection.updateProjectExtents",()=>({iModelId:this.iModelToken.iModelId,newExtents:e})),2!==this.openMode?Promise.reject(new i.IModelError(65582,"IModelConnection was opened read-only",n.Logger.logError)):i.IModelWriteRpcInterface.getClient().updateProjectExtents(this.iModelToken,e)}async saveChanges(e){return n.Logger.logTrace(h,"IModelConnection.saveChanges",()=>({iModelId:this.iModelToken.iModelId,description:e})),2!==this.openMode?Promise.reject(new i.IModelError(65582,"IModelConnection was opened read-only",n.Logger.logError)):i.IModelWriteRpcInterface.getClient().saveChanges(this.iModelToken,e)}async changeCacheAttached(){return await o.WipRpcInterface.getClient().isChangeCacheAttached(this.iModelToken)}async attachChangeCache(){await o.WipRpcInterface.getClient().attachChangeCache(this.iModelToken)}async detachChangeCache(){await o.WipRpcInterface.getClient().detachChangeCache(this.iModelToken)}async executeTest(e,t){return s.IModelUnitTestRpcInterface.getClient().executeTest(this.iModelToken,e,t)}async requestSnap(e){return i.IModelReadRpcInterface.getClient().requestSnap(this.iModelToken,this.connectionId,e)}async getToolTipMessage(e){return i.IModelReadRpcInterface.getClient().getToolTipMessage(this.iModelToken,e)}}IModelConnection._connectionTimeout=6e5,IModelConnection.onClose=new n.BeEvent,IModelConnection._registry=new Map,t.IModelConnection=IModelConnection,function(e){e.Models=class Models{constructor(e){this._iModel=e,this.loaded=new Map}get repositoryModelId(){return"0x1"}async getProps(e){return i.IModelReadRpcInterface.getClient().getModelProps(this._iModel.iModelToken,n.Id64.toIdSet(e))}getLoaded(e){return this.loaded.get(e)}async load(t){const r=new Set;for(const e of n.Id64.toIdSet(t))void 0===this.getLoaded(e)&&r.add(e);if(0!==r.size)try{const t=await this.getProps(r);for(const r of t){let t=e.findClass(r.classFullName);void 0===t&&(t=await this._iModel.findRegisteredBaseClass(r.classFullName,u.ModelState));const n=new t(r,this._iModel);this.loaded.set(n.id,n)}}catch(e){}}async queryProps(e){const t=Object.assign({},e);return t.from=e.from||u.ModelState.sqlName,t.where=e.where||"",e.wantPrivate||(t.where.length>0&&(t.where+=" AND "),t.where+="IsPrivate=FALSE "),e.wantTemplate||(t.where.length>0&&(t.where+=" AND "),t.where+="IsTemplate=FALSE "),i.IModelReadRpcInterface.getClient().queryModelProps(this._iModel.iModelToken,t)}onIModelConnectionClose(){this.loaded.forEach(e=>{e.onIModelConnectionClose()})}};e.Elements=class Elements{constructor(e){this._iModel=e}get rootSubjectId(){return"0x1"}async queryIds(e){return this._iModel.queryEntityIds(e)}async getProps(e){return i.IModelReadRpcInterface.getClient().getElementProps(this._iModel.iModelToken,n.Id64.toIdSet(e))}async queryProps(e){return i.IModelReadRpcInterface.getClient().queryElementProps(this._iModel.iModelToken,e)}async formatElements(e){return i.IModelReadRpcInterface.getClient().formatElements(this._iModel.iModelToken,n.Id64.toIdSet(e))}};e.CodeSpecs=class CodeSpecs{constructor(e){this._iModel=e}async _loadAllCodeSpecs(){if(this._loaded)return;this._loaded=[];const e=await i.IModelReadRpcInterface.getClient().getAllCodeSpecs(this._iModel.iModelToken);for(const t of e)this._loaded.push(new i.CodeSpec(this._iModel,n.Id64.fromString(t.id),t.name,t.jsonProperties))}async getById(e){if(!n.Id64.isValid(e))return Promise.reject(new i.IModelError(65559,"Invalid codeSpecId",n.Logger.logWarning,h,()=>({codeSpecId:e})));await this._loadAllCodeSpecs();const t=this._loaded.find(t=>t.id===e);return t||Promise.reject(new i.IModelError(65574,"CodeSpec not found",n.Logger.logWarning,h))}async getByName(e){await this._loadAllCodeSpecs();const t=this._loaded.find(t=>t.name===e);return t||Promise.reject(new i.IModelError(65574,"CodeSpec not found",n.Logger.logWarning,h))}};e.Views=class Views{constructor(e){this._iModel=e}async queryProps(e){const t=Object.assign({},e);t.from=e.from||c.ViewState.sqlName,t.where=e.where||"",void 0!==e.wantPrivate&&e.wantPrivate||(t.where.length>0&&(t.where+=" AND "),t.where+="IsPrivate=FALSE ");const r=await i.IModelReadRpcInterface.getClient().queryElementProps(this._iModel.iModelToken,t);return 0===r.length||r[0],r}async getViewList(e){const t=[];return(await this.queryProps(e)).forEach(e=>{t.push({id:e.id,name:e.code.value,class:e.classFullName})}),t}async queryDefaultViewId(){return i.IModelReadRpcInterface.getClient().getDefaultViewId(this._iModel.iModelToken)}async load(t){const r=await i.IModelReadRpcInterface.getClient().getViewStateData(this._iModel.iModelToken,t),o=new l.CategorySelectorState(r.categorySelectorProps,this._iModel),s=r.viewDefinitionProps.classFullName;let a=e.findClass(s);if(void 0===a&&void 0===(a=await this._iModel.findRegisteredBaseClass(s,void 0)))return Promise.reject(new i.IModelError(65595,"Invalid ViewState class",n.Logger.logError,h,()=>r));const c=a.createFromStateData(r,o,this._iModel);return await c.load(),c}async getThumbnail(e){const t=await i.IModelReadRpcInterface.getClient().getViewThumbnail(this._iModel.iModelToken,e.toString()),r=new Uint16Array(t.buffer);return{format:0===r[1]?"jpeg":"png",width:r[2],height:r[3],image:new Uint8Array(t.buffer,8,r[0])}}async saveThumbnail(e,t){const r=n.Id64.fromString(e.toString()),o=new Uint8Array(t.image.length+16);new Uint16Array(o.buffer).set([t.image.length,"jpeg"===t.format?0:2,t.width,t.height]);const s=n.Id64.getLowerUint32(r),a=n.Id64.getUpperUint32(r);return new Uint32Array(o.buffer,8).set([s,a]),new Uint8Array(o.buffer,16).set(t.image),i.IModelWriteRpcInterface.getClient().saveThumbnail(this._iModel.iModelToken,o)}};e.Tiles=class Tiles{constructor(e){this._iModel=e}async getTileTreeProps(e){return i.IModelTileRpcInterface.getClient().getTileTreeProps(this._iModel.iModelToken,e)}async getTileContent(e,t){return i.IModelTileRpcInterface.getClient().getTileContent(this._iModel.iModelToken,e,t)}}}(IModelConnection=t.IModelConnection||(t.IModelConnection={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(78),o=r(3),s=r(4),a=r(8),c=r(64),l=r(184);class ModelState extends i.EntityState{constructor(e,t){super(e,t),this.modeledElement=s.RelatedElement.fromJSON(e.modeledElement),this.name=e.name?e.name:"",this.parentModel=n.Id64.fromJSON(e.parentModel),this.isPrivate=n.JsonUtils.asBool(e.isPrivate),this.isTemplate=n.JsonUtils.asBool(e.isTemplate)}toJSON(){const e=super.toJSON();return e.modeledElement=this.modeledElement,e.parentModel=this.parentModel,e.name=this.name,this.isPrivate&&(e.isPrivate=this.isPrivate),this.isTemplate&&(e.isTemplate=this.isTemplate),e}getExtents(){return new s.AxisAlignedBox3d}get isGeometricModel(){return!1}onIModelConnectionClose(){}useRangeForFit(){return!0}}t.ModelState=ModelState;class GeometricModelState extends ModelState{constructor(){super(...arguments),this._tileTreeState=new c.TileTreeState(this.iModel,!this.is2d,this.id),this._classifierTileTreeState=new c.TileTreeState(this.iModel,!this.is2d,this.id)}get is2d(){return!this.is3d}tileTree(){return this._tileTreeState.tileTree}get classifierTileTree(){return this._classifierTileTreeState.tileTree}loadStatus(){return this._tileTreeState.loadStatus}setLoadStatus(e){this._tileTreeState.loadStatus=e}get isGeometricModel(){return!0}getOrLoadTileTree(){return void 0===this.tileTree&&this.loadTileTree(),this.tileTree()}loadTileTree(e,t){const r=e?this._classifierTileTreeState:this._tileTreeState;return c.TileTree.LoadStatus.NotLoaded!==r.loadStatus?r.loadStatus:(r.loadStatus=c.TileTree.LoadStatus.Loading,e||void 0===this.jsonProperties.tilesetUrl?this.loadIModelTileTree(r,e,t):(l.RealityModelTileTree.loadRealityModelTileTree(this.jsonProperties.tilesetUrl,this.jsonProperties.tilesetToDbTransform,r),r.loadStatus))}loadIModelTileTree(e,t,r){const n=t?"C:"+r+"_"+this.id:this.id;return this.iModel.tiles.getTileTreeProps(n).then(r=>{e.setTileTree(r,new c.IModelTileLoader(this.iModel,t?1:0)),a.IModelApp.viewManager.onNewTilesReady()}).catch(e=>{this._tileTreeState.loadStatus=c.TileTree.LoadStatus.NotFound}),e.loadStatus}onIModelConnectionClose(){n.dispose(this._tileTreeState.tileTree),super.onIModelConnectionClose()}}t.GeometricModelState=GeometricModelState;class GeometricModel2dState extends GeometricModelState{constructor(e,t){super(e,t),this.globalOrigin=o.Point2d.fromJSON(e.globalOrigin)}get is3d(){return!1}toJSON(){const e=super.toJSON();return e.globalOrigin=this.globalOrigin,e}}t.GeometricModel2dState=GeometricModel2dState;class GeometricModel3dState extends GeometricModelState{get is3d(){return!0}}t.GeometricModel3dState=GeometricModel3dState;t.SheetModelState=class SheetModelState extends GeometricModel2dState{};t.SpatialModelState=class SpatialModelState extends GeometricModel3dState{};class DrawingModelState extends GeometricModel2dState{}t.DrawingModelState=DrawingModelState;t.SectionDrawingModelState=class SectionDrawingModelState extends DrawingModelState{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(27),i=r(186),o="\n  vec4 color = u_color;\n  if (isShaderBitSet(kShaderBit_NonUniformColor)) {\n    // Color table is appended to vertex data. Compute the index of the vertex one-past-the-end of the vertex data\n    float colorTableStart = u_vertParams.z * u_vertParams.w; // num rgba per-vertex times num vertices\n    float colorIndex = decodeUInt16(g_vertexData2);\n    vec2 tc = computeLUTCoords(colorTableStart+colorIndex, u_vertParams.xy, g_vert_center, 1.0);\n    color = TEXTURE(u_vertLUT, tc);\n  }\n",s="\n  if (kRenderPass_OpaqueLinear <= u_renderPass && kRenderPass_OpaqueGeneral >= u_renderPass)\n    color = adjustPreMultipliedAlpha(color, 1.0);\n\n  return color;\n",a=o+s,c=o+"\n  g_baseAlpha = color.a;\n"+s,l="return v_color;";t.addColor=function(e,t=!1){e.vert.addUniform("u_color",5,e=>{e.addGraphicUniform("u_color",(e,t)=>{const r=t.geometry.getColor(t.target);if(r.isUniform){const t=r.uniform;e.setUniform4fv(new Float32Array([t.red,t.green,t.blue,t.alpha]))}})}),e.vert.addFunction(n.GLSLFragment.adjustPreMultipliedAlpha),t&&e.addGlobal("g_baseAlpha",2),i.addRenderPass(e.vert),e.addFunctionComputedVarying("v_color",5,"computeColor",t?c:a),e.frag.set(1,l)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(30),i=r(20),o=r(3),s=r(4),a=r(8),c=r(76),l=r(134);var u,d;!function(e){e[e.Thin=1]="Thin",e[e.Normal=2]="Normal",e[e.Bold=3]="Bold",e[e.VeryBold=4]="VeryBold",e[e.FatDot=8]="FatDot"}(t.ViewHandleWeight||(t.ViewHandleWeight={})),function(e){e[e.None=0]="None",e[e.Rotate=1]="Rotate",e[e.TargetCenter=2]="TargetCenter",e[e.Pan=4]="Pan",e[e.Scroll=8]="Scroll",e[e.Zoom=16]="Zoom",e[e.Walk=32]="Walk",e[e.Fly=64]="Fly",e[e.Look=128]="Look"}(t.ViewHandleType||(t.ViewHandleType={})),function(e){e[e.Low=1]="Low",e[e.Normal=10]="Normal",e[e.Medium=100]="Medium",e[e.High=1e3]="High"}(t.ViewManipPriority||(t.ViewManipPriority={})),function(e){e[e.Success=0]="Success",e[e.NoEvent=1]="NoEvent",e[e.Disabled=2]="Disabled",e[e.RejectedByController=3]="RejectedByController"}(u||(u={})),function(e){e[e.Pan=0]="Pan",e[e.Look=1]="Look",e[e.Travel=2]="Travel"}(d||(d={}));class ViewTool extends n.InteractiveTool{constructor(){super(...arguments),this.inDynamicUpdate=!1}beginDynamicUpdate(){this.inDynamicUpdate=!0}endDynamicUpdate(){this.inDynamicUpdate=!1}run(){const e=a.IModelApp.toolAdmin;return!!e.onInstallTool(this)&&(e.startViewTool(this),e.onPostInstallTool(this),!0)}async onResetButtonUp(e){return this.exitTool(),n.EventHandled.Yes}exitTool(){a.IModelApp.toolAdmin.exitViewTool()}}t.ViewTool=ViewTool;class ViewingToolHandle{constructor(e){this.viewTool=e}onReinitialize(){}focusOut(){}noMotion(e){return!1}motion(e){return!1}checkOneShot(){return!0}getHandleCursor(){return"default"}focusIn(){a.IModelApp.toolAdmin.setCursor(this.getHandleCursor())}drawHandle(e,t){}}t.ViewingToolHandle=ViewingToolHandle;class ViewHandleArray{constructor(e){this.viewTool=e,this.handles=[],this.focus=-1,this.focusDrag=!1,this.hitHandleIndex=0}empty(){this.focus=-1,this.focusDrag=!1,this.hitHandleIndex=-1,this.handles.length=0}get count(){return this.handles.length}get hitHandle(){return this.getByIndex(this.hitHandleIndex)}get focusHandle(){return this.getByIndex(this.focus)}add(e){this.handles.push(e)}getByIndex(e){return e>=0&&e<this.count?this.handles[e]:void 0}focusHitHandle(){this.setFocus(this.hitHandleIndex)}testHit(e,t=0){this.hitHandleIndex=-1;const r={distance:0,priority:10};let n,i=0,o=!1,s=1;for(let a=0;a<this.count;a++){r.priority=10;const c=this.handles[a];if(t){if(c.handleType===t)return this.hitHandleIndex=a,!0}else c.testHandleForHit(e,r)&&r.priority>=s&&(r.priority>s&&(o=!1),s=r.priority,(!o||r.distance<i)&&(o=!0,i=r.distance,n=c,this.hitHandleIndex=a))}return void 0!==n}drawHandles(e){if(0!==this.count){for(let t=0;t<this.count;++t)if(t!==this.hitHandleIndex){this.handles[t].drawHandle(e,this.focus===t)}if(-1!==this.hitHandleIndex){this.handles[this.hitHandleIndex].drawHandle(e,this.focus===this.hitHandleIndex)}}}setFocus(e){if(this.focus===e&&this.focusDrag===this.viewTool.inHandleModify)return;let t;this.focus>=0&&(t=this.getByIndex(this.focus))&&t.focusOut(),e>=0&&(t=this.getByIndex(e))&&t.focusIn(),this.focus=e,this.focusDrag=this.viewTool.inHandleModify,void 0!==this.viewport&&this.viewport.invalidateDecorations()}onReinitialize(){this.handles.forEach(e=>e.onReinitialize())}motion(e){this.handles.forEach(t=>t.motion(e))}hasHandle(e){return this.handles.some(t=>t.handleType===e)}}t.ViewHandleArray=ViewHandleArray;class ViewManip extends ViewTool{constructor(e,t,r,n=!1){super(),this.handleMask=t,this.oneShot=r,this.isDraggingRequired=n,this.viewport=void 0,this.frustumValid=!1,this.targetCenterWorld=new o.Point3d,this.inHandleModify=!1,this.isDragging=!1,this.stoppedOverHandle=!1,this.targetCenterValid=!1,this.targetCenterLocked=!1,this.nPts=0,this._forcedHandle=0,this.lastFrustum=new s.Frustum,this.viewHandles=new ViewHandleArray(this),this.changeViewport(e)}decorate(e){this.viewHandles.drawHandles(e)}onReinitialize(){void 0!==this.viewport&&(this.viewport.synchWithView(!0),this.viewHandles.setFocus(-1)),this.nPts=0,this.inHandleModify=!1,this.inDynamicUpdate=!1,this.frustumValid=!1,this.viewHandles.onReinitialize()}async onDataButtonDown(e){if(0===this.nPts&&this.isDraggingRequired&&!this.isDragging)return n.EventHandled.No;switch(this.nPts){case 0:this.changeViewport(e.viewport),this.processFirstPoint(e)&&(this.nPts=1);break;case 1:this.nPts=2}return this.nPts>1&&(this.inDynamicUpdate=!1,this.processPoint(e,!1)&&this.oneShot?this.exitTool():this.onReinitialize()),n.EventHandled.Yes}async onDataButtonUp(e){return this.nPts<=1&&this.isDraggingRequired&&!this.isDragging&&this.oneShot&&this.exitTool(),n.EventHandled.No}async onMouseWheel(e){const t=e.clone();return 1&this.handleMask&&(t.point=this.targetCenterWorld,t.coordsFrom=1),a.IModelApp.toolAdmin.processWheelEvent(t,!1),n.EventHandled.Yes}async startHandleDrag(e,t){if(this.inHandleModify)return n.EventHandled.No;if(void 0!==t){if(!this.viewHandles.hasHandle(t))return n.EventHandled.No;this._forcedHandle=t}return this.receivedDownEvent=!0,this.isDragging=!0,0===this.nPts&&this.onDataButtonDown(e),n.EventHandled.Yes}async onMouseStartDrag(e){switch(e.button){case 1:return n.EventHandled.No;case 2:if(!this.viewHandles.hasHandle(32)&&!this.viewHandles.hasHandle(64))return n.EventHandled.No}return this.startHandleDrag(e)}async onMouseEndDrag(e){return this.inHandleModify?(this.isDragging=!1,0===this.nPts?n.EventHandled.Yes:this.onDataButtonDown(e)):n.EventHandled.No}async onMouseMotion(e){this.stoppedOverHandle=!1,0===this.nPts&&this.viewHandles.testHit(e.viewPoint)&&this.viewHandles.focusHitHandle(),0!==this.nPts&&this.processPoint(e,!0),this.viewHandles.motion(e)}async onMouseMotionStopped(e){e.viewport===this.viewport&&0===this.nPts&&(this.viewHandles.testHit(e.viewPoint)?(this.stoppedOverHandle=!0,this.viewHandles.focusHitHandle()):this.stoppedOverHandle&&(this.stoppedOverHandle=!1,this.viewport.invalidateDecorations()))}async onMouseNoMotion(e){if(0===this.nPts||!e.viewport)return;const t=this.viewHandles.hitHandle;t&&t.noMotion(e)}async onTouchTap(e){return e.isSingleTap?n.EventHandled.Yes:n.EventHandled.No}async onTouchMoveStart(e,t){return!this.inHandleModify&&t.isSingleTouch&&await a.IModelApp.toolAdmin.convertTouchMoveStartToButtonDownAndMotion(t,e),this.inHandleModify?n.EventHandled.Yes:n.EventHandled.No}async onTouchMove(e){this.inHandleModify&&a.IModelApp.toolAdmin.convertTouchMoveToMotion(e)}async onTouchComplete(e){this.inHandleModify&&a.IModelApp.toolAdmin.convertTouchEndToButtonUp(e)}async onTouchCancel(e){this.inHandleModify&&a.IModelApp.toolAdmin.convertTouchEndToButtonUp(e,1)}onPostInstall(){super.onPostInstall(),this.onReinitialize()}onCleanup(){let e=!1;this.inDynamicUpdate&&(this.endDynamicUpdate(),e=!0);const t=this.viewport;void 0!==t&&(t.synchWithView(!0),e&&t.doUndo(l.ToolSettings.animationTime),t.invalidateDecorations()),this.viewHandles.empty(),this.viewport=void 0}frustumDidNotChange(){const e=this.viewport.getWorldFrustum();return!(!this.frustumValid||!e.equals(this.lastFrustum))||(this.lastFrustum.setFrom(e),this.frustumValid=!0,!1)}updateTargetCenter(){const e=this.viewport;if(!e)return;if(this.targetCenterValid){if(this.inHandleModify)return;return void(a.IModelApp.tentativePoint.isActive&&(this.setTargetCenterWorld(a.IModelApp.tentativePoint.getPoint(),!0,!1),a.IModelApp.tentativePoint.clear(!0)))}if(a.IModelApp.tentativePoint.isActive)return this.setTargetCenterWorld(a.IModelApp.tentativePoint.getPoint(),!0,!1);if(c.TentativeOrAccuSnap.isHot)return this.setTargetCenterWorld(c.TentativeOrAccuSnap.getCurrentPoint(),!0,!1);if(e.viewCmdTargetCenter&&this.isPointVisible(e.viewCmdTargetCenter))return this.setTargetCenterWorld(e.viewCmdTargetCenter,!0,!0);if(!e.view.allow3dManipulations()){const t=e.npcToWorld(s.NpcCenter);return t.z=0,this.setTargetCenterWorld(t,!1,!1)}const t=e.pickNearestVisibleGeometry(e.npcToWorld(s.NpcCenter),e.pixelsFromInches(l.ToolSettings.viewToolPickRadiusInches));this.setTargetCenterWorld(void 0!==t?t:e.view.getTargetPoint(),!1,!1)}processFirstPoint(e){const t=this._forcedHandle;if(this._forcedHandle=0,this.frustumValid=!1,this.viewHandles.testHit(e.viewPoint,t)){this.inHandleModify=!0,this.viewHandles.focusHitHandle();const t=this.viewHandles.hitHandle;if(void 0!==t&&!t.firstPoint(e))return!1}return!0}processPoint(e,t){const r=this.viewHandles.hitHandle;if(void 0===r)return!0;const n=r.doManipulation(e,t);return t||n&&r.checkOneShot()}lensAngleMatches(e,t){const r=this.viewport.view;return!!r.is3d()&&Math.abs(r.calcLensAngle().radians-e.radians)<t}get isZUp(){const e=this.viewport.view,t=e.getXVector(),r=e.getXVector(),n=o.Vector3d.unitZ();return Math.abs(n.dotProduct(r))>.99&&Math.abs(n.dotProduct(t))<.01}static getFocusPlaneNpc(e){const t=e.view.getTargetPoint();if(t.z<0||t.z>1){t.set(.5,.5,0);const r=new o.Point3d(.5,.5,1);e.npcToWorld(t,t),e.npcToWorld(r,r),t.interpolate(.5,r,t),e.worldToNpc(t,t)}return t.z}setTargetCenterWorld(e,t,r){this.targetCenterWorld.setFrom(e),this.targetCenterValid=!0,this.targetCenterLocked=t,this.viewport&&(this.viewport.view.allow3dManipulations()||(this.targetCenterWorld.z=0),this.viewport.viewCmdTargetCenter=r?e:void 0)}isPointVisible(e){const t=this.viewport;if(!t)return!1;const r=t.worldToView(e),n=t.getFrustum(0,!1),i=o.Point3d.create(n.points[0].distance(n.points[1]),n.points[0].distance(n.points[2]),n.points[0].distance(n.points[4]));return!(r.x<0||r.x>i.x||r.y<0||r.y>i.y)}static fitView(e,t,r){const n=e.computeViewRange(),i=e.viewRect.aspect,o=e.getWorldFrustum();this._useViewAlignedVolume?e.view.lookAtViewAlignedVolume(n,i,r):e.view.lookAtVolume(n,i,r),e.synchWithView(!1),e.viewCmdTargetCenter=void 0,t&&e.animateFrustumChange(o,e.getFrustum()),e.synchWithView(!0)}setCameraLensAngle(e,t){const r=this.viewport;if(!r)return 15;const n=r.view;if(!n||!n.is3d()||!n.allow3dManipulations())return 15;const i=t&&n.isCameraOn?n.lookAtUsingLensAngle(n.getEyePoint(),n.getTargetPoint(),n.getYVector(),e):r.turnCameraOn(e);return 0!==i?i:(r.synchWithView(!1),this.targetCenterLocked||(this.targetCenterValid=!1,this.updateTargetCenter()),0)}enforceZUp(e){const t=this.viewport;if(!t||this.isZUp)return!1;const r=t.view.getYVector(),n=o.Matrix3d.createRotationVectorToVector(r,o.Vector3d.unitZ());if(!n)return!1;const i=o.Transform.createFixedPointAndMatrix(e,n),s=t.getWorldFrustum();return s.multiply(i),t.setupViewFromFrustum(s),!0}changeViewport(e){e!==this.viewport&&(void 0!==this.viewport&&(this.viewport.invalidateDecorations(),this.viewHandles.empty()),void 0!==(this.viewport=e)&&(this.viewHandles.viewport=e,this.targetCenterValid=!1,this.updateTargetCenter(),1&this.handleMask&&this.viewHandles.add(new ViewRotate(this)),2&this.handleMask&&this.viewHandles.add(new ViewTargetCenter(this)),4&this.handleMask&&this.viewHandles.add(new ViewPan(this)),8&this.handleMask&&this.viewHandles.add(new ViewScroll(this)),16&this.handleMask&&this.viewHandles.add(new ViewZoom(this)),32&this.handleMask&&this.viewHandles.add(new ViewWalk(this)),64&this.handleMask&&this.viewHandles.add(new ViewFly(this)),128&this.handleMask&&this.viewHandles.add(new ViewLook(this))))}}ViewManip._useViewAlignedVolume=!1,t.ViewManip=ViewManip;class ViewTargetCenter extends ViewingToolHandle{get handleType(){return 2}checkOneShot(){return!1}firstPoint(e){return!!e.viewport&&(a.IModelApp.accuSnap.enableSnap(!0),!0)}testHandleForHit(e,t){if(this.viewTool.isDraggingRequired)return!1;const r=this.viewTool.viewport.worldToView(this.viewTool.targetCenterWorld).distanceXY(e);return!(r>this.viewTool.viewport.pixelsFromInches(.15))&&(t.distance=r,t.priority=1e3,!0)}drawHandle(e,t){if(e.viewport!==this.viewTool.viewport)return;let r=.2;!t&&this.viewTool.inHandleModify&&(r=.1,t=!1);const n=Math.floor(e.viewport.pixelsFromInches(r))+.5,i=n+1,o=this.viewTool.viewport.worldToView(this.viewTool.targetCenterWorld);o.x=Math.floor(o.x)+.5,o.y=Math.floor(o.y)+.5;e.addCanvasDecoration({position:o,drawDecoration:e=>{e.beginPath(),e.strokeStyle="rgba(0,0,0,.5)",e.lineWidth=t?5:3,e.moveTo(-i,0),e.lineTo(i,0),e.moveTo(0,-i),e.lineTo(0,i),e.stroke(),e.beginPath(),e.strokeStyle="white",e.lineWidth=t?3:1,e.shadowColor="black",e.shadowBlur=t?7:5,e.moveTo(-n,0),e.lineTo(n,0),e.moveTo(0,-n),e.lineTo(0,n),e.stroke()}})}doManipulation(e,t){return e.viewport===this.viewTool.viewport&&(this.viewTool.setTargetCenterWorld(e.point,!t,2!==e.inputSource&&!t),e.viewport.invalidateDecorations(),t||a.IModelApp.accuSnap.enableSnap(!1),!1)}}class ViewPan extends ViewingToolHandle{constructor(){super(...arguments),this._anchorPt=new o.Point3d,this._lastPtNpc=new o.Point3d}get handleType(){return 4}getHandleCursor(){return this.viewTool.inHandleModify?a.IModelApp.viewManager.grabbingCursor:a.IModelApp.viewManager.grabCursor}doManipulation(e,t){const r=e.viewport,n=e.point.clone(),i=r.worldToNpc(n),o=r.worldToNpc(this._anchorPt);return i.z=o.z,!!this._lastPtNpc.isAlmostEqual(i,1e-10)||(r.npcToWorld(i,n),this._lastPtNpc.setFrom(i),this.doPan(n))}firstPoint(e){const t=e.viewport;if(this._anchorPt.setFrom(e.rawPoint),0===e.coordsFrom&&t.isCameraOn){const e=t.pickNearestVisibleGeometry(this._anchorPt,t.pixelsFromInches(l.ToolSettings.viewToolPickRadiusInches));if(void 0!==e)this._anchorPt.setFrom(e);else{const e=t.worldToNpc(this._anchorPt);e.z=ViewManip.getFocusPlaneNpc(t),this._anchorPt=t.npcToWorld(e,this._anchorPt)}}return this.viewTool.beginDynamicUpdate(),!0}onReinitialize(){this.viewTool.viewHandles.hitHandle===this&&a.IModelApp.toolAdmin.setCursor(this.getHandleCursor())}testHandleForHit(e,t){return t.distance=0,t.priority=1,!0}doPan(e){const t=this.viewTool.viewport,r=t.view,n=e.vectorTo(this._anchorPt);if(r.is3d()){if(0!==r.moveCameraWorld(n))return!1}else r.setOrigin(r.getOrigin().plus(n));return t.synchWithView(!1),!0}}class ViewRotate extends ViewingToolHandle{constructor(){super(...arguments),this._lastPtNpc=new o.Point3d,this._firstPtNpc=new o.Point3d,this._frustum=new s.Frustum,this._activeFrustum=new s.Frustum}get handleType(){return 1}getHandleCursor(){return"move"}testHandleForHit(e,t){const r=this.viewTool.viewport.worldToView(this.viewTool.targetCenterWorld);return t.distance=r.distanceXY(e),t.priority=10,!0}firstPoint(e){const t=this.viewTool,r=e.viewport;if(!t.targetCenterLocked&&r.view.allow3dManipulations()){const n=r.pickNearestVisibleGeometry(e.rawPoint,r.pixelsFromInches(l.ToolSettings.viewToolPickRadiusInches));void 0!==n&&t.setTargetCenterWorld(n,!1,!1)}const n=e.rawPoint.clone().clone();return r.worldToNpc(n,this._firstPtNpc),this._lastPtNpc.setFrom(this._firstPtNpc),r.getWorldFrustum(this._activeFrustum),this._frustum.setFrom(this._activeFrustum),t.beginDynamicUpdate(),!0}doManipulation(e,t){const r=this.viewTool,n=r.viewport,i=n.worldToNpc(e.point);if(this._lastPtNpc.isAlmostEqual(i,1e-10))return!0;this._firstPtNpc.isAlmostEqual(i,.01)&&i.setFrom(this._firstPtNpc),this._lastPtNpc.setFrom(i);const s=n.getWorldFrustum(),a=!s.equals(this._activeFrustum);if(a)this._frustum.setFrom(s);else if(!n.setupViewFromFrustum(this._frustum))return!1;const c=n.npcToView(i);let u,d;a&&this._firstPtNpc.setFrom(i);const h=r.targetCenterWorld;if(n.view.allow3dManipulations()){const e=n.viewRect,t=e.width,r=e.height;n.npcToView(i,c);const s=n.npcToView(this._firstPtNpc),a=c.x-s.x,h=c.y-s.y,p=l.ToolSettings.preserveWorldUp?o.Vector3d.unitZ():n.rotation.getRow(1),f=n.rotation.getRow(0),g=a?o.Matrix3d.createRotationAroundVector(p,o.Angle.createRadians(Math.PI/(t/a))):o.Matrix3d.createIdentity(),m=(h?o.Matrix3d.createRotationAroundVector(f,o.Angle.createRadians(Math.PI/(r/h))):o.Matrix3d.createIdentity()).multiplyMatrixMatrix(g).getAxisAndAngleOfRotation();u=o.Angle.createRadians(-m.angle.radians),d=m.axis}else{const e=n.worldToView(h),t=n.npcToView(this._firstPtNpc),r=o.Vector2d.createStartEnd(e,t),i=o.Vector2d.createStartEnd(e,c);u=r.angleTo(i),d=o.Vector3d.unitZ()}return this.rotateViewWorld(h,d,u),n.getWorldFrustum(this._activeFrustum),!0}rotateViewWorld(e,t,r){const n=o.Matrix3d.createRotationAroundVector(t,r);if(!n)return;const i=o.Transform.createFixedPointAndMatrix(e,n),s=this._frustum.transformBy(i);this.viewTool.viewport.setupViewFromFrustum(s)}}class ViewLook extends ViewingToolHandle{constructor(){super(...arguments),this._eyePoint=new o.Point3d,this._firstPtView=new o.Point3d,this._rotation=new o.Matrix3d,this._frustum=new s.Frustum}get handleType(){return 128}getHandleCursor(){return a.IModelApp.viewManager.crossHairCursor}testHandleForHit(e,t){return t.distance=0,t.priority=1,!0}firstPoint(e){const t=this.viewTool,r=e.viewport,n=r.view;return!!(n&&n.is3d()&&n.allow3dManipulations())&&(this._firstPtView.setFrom(e.viewPoint),this._eyePoint.setFrom(n.getEyePoint()),this._rotation.setFrom(r.rotation),r.getWorldFrustum(this._frustum),t.beginDynamicUpdate(),!0)}doManipulation(e,t){const r=this.viewTool.viewport;if(e.viewport!==r)return!1;const n=this.getLookTransform(r,this._firstPtView,e.viewPoint),i=this._frustum.transformBy(n);return this.viewTool.viewport.setupViewFromFrustum(i),!0}getLookTransform(e,t,r){const n=e.viewRect,i=n.width,s=n.height,a=r.x-t.x,c=r.y-t.y,l=-a/i*Math.PI,u=-c/s*Math.PI,d=this._rotation.inverse(),h=o.Matrix3d.createRotationAroundVector(o.Vector3d.unitZ(),o.Angle.createRadians(l)),p=o.Matrix3d.createRotationAroundVector(o.Vector3d.unitX(),o.Angle.createRadians(u));if(void 0===d||void 0===h||void 0===p)return o.Transform.createIdentity();p.multiplyMatrixMatrix(this._rotation,p),d.multiplyMatrixMatrix(p,p);const f=h.multiplyMatrixMatrix(p);return o.Transform.createFixedPointAndMatrix(this._eyePoint,f)}}class ViewScroll extends ViewingToolHandle{constructor(){super(...arguments),this._anchorPtView=new o.Point3d,this._lastPtView=new o.Point3d}get handleType(){return 8}getHandleCursor(){return a.IModelApp.viewManager.crossHairCursor}testHandleForHit(e,t){return t.distance=0,t.priority=1,!0}drawHandle(e,t){if(e.viewport!==this.viewTool.viewport||!this.viewTool.inDynamicUpdate)return;const r=Math.floor(e.viewport.pixelsFromInches(.15))+.5,n=this._anchorPtView.clone();n.x=Math.floor(n.x)+.5,n.y=Math.floor(n.y)+.5;const i=this._lastPtView.clone();i.x=Math.floor(i.x)+.5,i.y=Math.floor(i.y)+.5;const s=i.minus(n);e.addCanvasDecoration({position:n,drawDecoration:e=>{e.beginPath(),e.strokeStyle="green",e.lineWidth=2,e.moveTo(0,0),e.lineTo(s.x,s.y),e.stroke(),e.beginPath(),e.strokeStyle="rgba(0,0,0,.5)",e.lineWidth=1,e.fillStyle="rgba(255,255,255,.5)",e.arc(0,0,r,0,2*Math.PI),e.fill(),e.stroke();let t=o.Vector2d.createStartEnd(n,i);void 0===t?t=o.Vector2d.unitX():t.normalize(t);const a=[new o.Point2d,new o.Point2d];a[0].plusScaled(t,r,a[0]),a[1].plusScaled(t,-r,a[1]),e.beginPath(),e.strokeStyle="black",e.lineWidth=2,e.moveTo(a[0].x,a[0].y),e.lineTo(a[1].x,a[1].y),e.stroke()}},!0)}firstPoint(e){const t=this.viewTool;return this._anchorPtView.setFrom(e.viewPoint),this._lastPtView.setFrom(e.viewPoint),t.beginDynamicUpdate(),!0}doManipulation(e,t){const r=this.viewTool.viewport;return e.viewport===r&&this.doScroll(e)}noMotion(e){return e.viewport===this.viewTool.viewport&&(this.viewTool.beginDynamicUpdate(),this.doScroll(e),!1)}doScroll(e){if(this._lastPtView.setFrom(e.viewPoint),Math.abs(this._anchorPtView.x-this._lastPtView.x)<5&&Math.abs(this._anchorPtView.y-this._lastPtView.y)<5)return!1;const t=this._anchorPtView.minus(this._lastPtView);t.z=0;const r=e.viewport,n=r.view;if(n.is3d()&&n.isCameraOn){const e=new Array(2);e[0]=this._anchorPtView.clone(),e[1]=e[0].plusScaled(t,-1/8.5),r.viewToNpcArray(e),e[0].z=e[1].z=ViewManip.getFocusPlaneNpc(r),r.npcToWorldArray(e);const n=e[1].minus(e[0]),i=o.Transform.createTranslation(n),s=r.getWorldFrustum();s.transformBy(i,s),r.setupViewFromFrustum(s)}else{const e=o.Point2d.create(Math.floor(t.x*(-1/8.5)),Math.floor(t.y*(-1/8.5)));r.scroll(e,{saveInUndo:!1,animateFrustumChange:!1})}return!0}}class ViewZoom extends ViewingToolHandle{constructor(){super(...arguments),this._anchorPtView=new o.Point3d,this._anchorPtNpc=new o.Point3d,this._lastPtView=new o.Point3d,this._lastZoomRatio=1}get handleType(){return 16}getHandleCursor(){return a.IModelApp.viewManager.crossHairCursor}testHandleForHit(e,t){return t.distance=0,t.priority=1,!0}drawHandle(e,t){if(e.viewport!==this.viewTool.viewport||!this.viewTool.inDynamicUpdate)return;const r=Math.floor(e.viewport.pixelsFromInches(.15))+.5,n=.6*r,i=this._anchorPtView.clone();i.x=Math.floor(i.x)+.5,i.y=Math.floor(i.y)+.5;e.addCanvasDecoration({position:i,drawDecoration:e=>{e.beginPath(),e.strokeStyle="rgba(0,0,0,.5)",e.lineWidth=1,e.fillStyle="rgba(255,255,255,.5)",e.arc(0,0,r,0,2*Math.PI),e.fill(),e.stroke(),e.beginPath(),e.strokeStyle="black",e.lineWidth=2,e.moveTo(-n,0),e.lineTo(n,0),this._lastZoomRatio<1&&(e.moveTo(0,-n),e.lineTo(0,n)),e.stroke()}},!0)}firstPoint(e){const t=this.viewTool,r=t.viewport,n=r.view;if(n.is3d()&&n.isCameraOn){const n=r.pickNearestVisibleGeometry(0===e.coordsFrom?e.rawPoint:e.point,r.pixelsFromInches(l.ToolSettings.viewToolPickRadiusInches));if(void 0!==n)return this._anchorPtView.setFrom(n),r.worldToView(this._anchorPtView,this._anchorPtView),this._lastPtView.setFrom(this._anchorPtView),t.viewport.viewToNpc(this._anchorPtView,this._anchorPtNpc),t.beginDynamicUpdate(),!0}return 0===e.coordsFrom?this._anchorPtView.setFrom(e.viewPoint):r.worldToView(e.point,this._anchorPtView),this._lastPtView.setFrom(this._anchorPtView),t.viewport.viewToNpc(this._anchorPtView,this._anchorPtNpc),t.beginDynamicUpdate(),!0}doManipulation(e,t){return e.viewport===this.viewTool.viewport&&this.doZoom(e)}noMotion(e){return e.viewport===this.viewTool.viewport&&(this.viewTool.beginDynamicUpdate(),this.doZoom(e),!1)}doZoom(e){if(this._lastPtView.setFrom(e.viewPoint),Math.abs(this._anchorPtView.x-this._lastPtView.x)<5&&Math.abs(this._anchorPtView.y-this._lastPtView.y)<5)return!1;const t=e.viewport,r=t.view,n=t.viewToNpc(this._lastPtView),i=this._anchorPtNpc.minus(n);i.z=0;let s=1+.35*i.magnitude();if(i.y<0&&(s=1/s),this._lastZoomRatio=s,r.is3d()&&r.isCameraOn){const e=t.npcToWorld(this._anchorPtNpc),n=o.Transform.createFixedPointAndMatrix(e,o.Matrix3d.createScale(s,s,s)),i=r.getEyePoint(),a=n.multiplyPoint3d(i).minus(i),c=o.Transform.createTranslation(a),l=t.getWorldFrustum();l.transformBy(c,l),t.setupViewFromFrustum(l)}else{const e=o.Transform.createFixedPointAndMatrix(this._anchorPtNpc,o.Matrix3d.createScale(s,s,1)),r=t.getFrustum(1,!0);r.transformBy(e,r),t.npcToWorldArray(r.points),t.setupViewFromFrustum(r)}return!0}}class NavigateMotion{constructor(e){this.viewport=e,this.deltaTime=0,this.transform=o.Transform.createIdentity()}init(e){this.deltaTime=.001*e,this.transform.setIdentity()}getViewUp(e){return this.viewport.rotation.getRow(1,e)}getViewDirection(e){const t=this.viewport.rotation.getRow(2,e);return t.scale(-1,t),t}takeElevator(e){const t=o.Point3d.create(0,0,e*this.deltaTime);o.Transform.createTranslation(t,this.transform)}modifyPitchAngleToPreventInversion(e){const t=o.Angle.degreesToRadians(85),r=o.Angle.degreesToRadians(.01);if(0===e)return 0;const n=this.getViewUp(),i=this.getViewDirection();let s=o.Vector3d.unitZ().angleTo(n).radians;i.z<0&&(s*=-1);let a=e+s;if(Math.abs(a)<t)return e;if(e>0!==s>0&&Math.abs(e)<Math.PI/2)return e;if(Math.abs(s)>=t-r)return 0;const c=Math.abs(a)-t;return a=e>0?e-c:e+c}generateRotationTransform(e,t,r){const n=this.viewport,i=n.view,s=n.rotation,a=s.inverse(),c=o.Angle.createRadians(this.modifyPitchAngleToPreventInversion(t*this.deltaTime)),l=o.Matrix3d.createRotationAroundVector(o.Vector3d.unitX(),c).multiplyMatrixMatrix(s),u=a.multiplyMatrixMatrix(l),d=o.Matrix3d.createRotationAroundVector(o.Vector3d.unitZ(),o.Angle.createRadians(e*this.deltaTime)).multiplyMatrixMatrix(u);return o.Transform.createFixedPointAndMatrix(i.getEyePoint(),d,r)}generateTranslationTransform(e,t,r){const n=new Array(3);n[0]=new o.Point3d(0,0,0),n[1]=new o.Point3d(1,0,0),n[2]=new o.Point3d(0,1,0),this.viewport.isCameraOn&&(this.viewport.viewToNpcArray(n),n[0].z=n[1].z=n[2].z=ViewManip.getFocusPlaneNpc(this.viewport),this.viewport.npcToViewArray(n)),this.viewport.viewToWorldArray(n);const i=o.Vector3d.createStartEnd(n[0],n[1]);i.normalizeInPlace();const s=o.Vector3d.createStartEnd(n[0],n[2]);s.normalizeInPlace();const a=this.getViewDirection();if(t){const e=o.Vector3d.unitZ();e.crossProduct(a).crossProduct(e,a),a.normalizeInPlace()}return i.scale(e.x*this.deltaTime,i),s.scale(e.y*this.deltaTime,s),a.scale(e.z*this.deltaTime,a),i.plus(s,i).plus(a,i),o.Transform.createTranslation(i,r)}moveAndLook(e,t,r,n){const i=this.generateRotationTransform(t,r),o=this.generateTranslationTransform(e,n);this.transform.setMultiplyTransformTransform(i,o)}pan(e,t){const r=new o.Vector3d(e,t,0);this.moveAndLook(r,0,0,!1)}travel(e,t,r,n){const i=new o.Vector3d(0,0,r);this.moveAndLook(i,e,t,n)}look(e,t){this.generateRotationTransform(e,t,this.transform)}resetToLevel(){const e=this.viewport.view;if(!e.is3d()||!e.isCameraOn)return;const t=o.YawPitchRollAngles.createFromMatrix3d(this.viewport.rotation);t.pitch.setRadians(0),o.Transform.createFixedPointAndMatrix(e.getEyePoint(),t.toMatrix3d(),this.transform)}}class ViewNavigate extends ViewingToolHandle{constructor(e){super(e),this._anchorPtView=new o.Point3d,this._lastPtView=new o.Point3d,this._initialized=!1,this._lastMotionTime=0,this._orientationValid=!1,this._orientationTime=0,this._orientationZ=new o.Vector3d}haveStaticOrientation(e,t){return!this._orientationValid||e.angleTo(this._orientationZ).radians>ViewNavigate._angleLimit||this._orientationZ.isAlmostZero?(this._orientationValid=!0,this._orientationTime=t,this._orientationZ=e,!1):t-this._orientationTime>ViewNavigate._timeLimit}tryOrientationEvent(e,t){return{eventsEnabled:!1,result:1}}getElapsedTime(e){let t=e-this._lastMotionTime;return(0===this._lastMotionTime||t<0||t>1e3)&&(t=100),t}getMaxLinearVelocity(){return l.ToolSettings.walkVelocity}getMaxAngularVelocity(){return Math.PI/4}testHandleForHit(e,t){return t.distance=0,t.priority=1,!0}getInputVector(e){const t=this._anchorPtView.vectorTo(this._lastPtView,e),r=this.viewTool.viewport.viewRect;return Math.abs(t.x)<5?t.x=0:t.x=2*t.x/r.width,Math.abs(t.y)<5?t.y=0:t.y=2*t.y/r.height,t.x=Math.min(t.x,1),t.y=Math.min(t.y,1),t}getCenterPoint(e){const t=e||new o.Point3d;t.setZero();const r=this.viewTool.viewport.viewRect,n=r.width,i=r.height;return n>0&&(t.x=n/2),i>0&&(t.y=i/2),t}getNavigateMode(){const e=a.IModelApp.toolAdmin.currentInputState;return e.isShiftDown||!this.viewTool.viewport.isCameraOn?0:e.isControlDown?1:2}doNavigate(e){const t=Date.now(),r=new o.Vector3d,n=this.tryOrientationEvent(r,e).result,i=this.getElapsedTime(t);this._lastMotionTime=t;const s=this.viewTool.viewport,a=this.getNavigateMotion(i);let c=!!a;if(c){const e=s.getWorldFrustum();return e.multiply(a.transform),!(!s.setupViewFromFrustum(e)&&(c=!1,1===n))}switch(n){case 2:case 1:return!0;case 3:case 0:return this.haveStaticOrientation(r,t);default:return!1}}doManipulation(e,t){return!t||e.viewport===this.viewTool.viewport&&(this._lastPtView.setFrom(e.viewPoint),this.doNavigate(e))}noMotion(e){return e.viewport===this.viewTool.viewport&&(this.viewTool.beginDynamicUpdate(),this.doNavigate(e),!1)}onReinitialize(){if(this._initialized)return;this._initialized=!0;const e=this.viewTool,t=e.viewport,r=t.view;if(!r.allow3dManipulations())return;const n=t.getWorldFrustum(),i=l.ToolSettings.walkCameraAngle;e.lensAngleMatches(i,o.Angle.degreesToRadians(10))&&e.isZUp||e.setCameraLensAngle(i,e.lensAngleMatches(i,o.Angle.degreesToRadians(45))),l.ToolSettings.walkEnforceZUp&&this.viewTool.enforceZUp(r.getTargetPoint());const s=t.getWorldFrustum();n.equals(s)||t.animateFrustumChange(n,s),this.getCenterPoint(this._anchorPtView)}onCleanup(){}firstPoint(e){return this.viewTool.beginDynamicUpdate(),this._lastPtView.setFrom(e.viewPoint),this._anchorPtView.setFrom(this._lastPtView),!0}getHandleCursor(){return a.IModelApp.viewManager.crossHairCursor}drawHandle(e,t){if(e.viewport!==this.viewTool.viewport||!this.viewTool.inDynamicUpdate)return;const r=this._anchorPtView.clone();r.x=Math.floor(r.x)+.5,r.y=Math.floor(r.y)+.5;e.addCanvasDecoration({position:r,drawDecoration:e=>{e.strokeStyle="black",e.lineWidth=1,e.strokeRect(-2,-2,5,5),e.fillStyle="white",e.fillRect(-1,-1,3,3)}})}}ViewNavigate._angleLimit=.075,ViewNavigate._timeLimit=500;class ViewWalk extends ViewNavigate{constructor(e){super(e),this._navigateMotion=new NavigateMotion(this.viewTool.viewport)}get handleType(){return 32}getNavigateMotion(e){const t=this.getInputVector();if(0===t.x&&0===t.y)return;const r=this._navigateMotion;switch(r.init(e),this.getNavigateMode()){case 0:t.scale(this.getMaxLinearVelocity(),t),r.pan(t.x,t.y);break;case 1:t.scale(-this.getMaxAngularVelocity(),t),r.look(t.x,t.y);break;case 2:r.travel(-t.x*this.getMaxAngularVelocity(),0,-t.y*this.getMaxLinearVelocity(),!0)}return r}}class ViewFly extends ViewNavigate{constructor(e){super(e),this._navigateMotion=new NavigateMotion(this.viewTool.viewport)}get handleType(){return 64}getNavigateMotion(e){const t=this.getInputVector(),r=this._navigateMotion;switch(r.init(e),this.getNavigateMode()){case 0:if(0===t.x&&0===t.y)return;t.scale(this.getMaxLinearVelocity(),t),r.pan(t.x,t.y);break;case 1:if(0===t.x&&0===t.y)return;t.scale(-this.getMaxAngularVelocity(),t),r.look(t.x,t.y);break;case 2:t.scale(2*-this.getMaxAngularVelocity(),t),r.travel(t.x,t.y,this.getMaxLinearVelocity(),!1)}return r}}class PanViewTool extends ViewManip{constructor(e,t=!1,r=!1){super(e,4,t,r)}}PanViewTool.toolId="View.Pan",t.PanViewTool=PanViewTool;class RotateViewTool extends ViewManip{constructor(e,t=!1,r=!1){super(e,7,t,r)}}RotateViewTool.toolId="View.Rotate",t.RotateViewTool=RotateViewTool;class LookViewTool extends ViewManip{constructor(e,t=!1,r=!1){super(e,128,t,r)}}LookViewTool.toolId="View.Look",t.LookViewTool=LookViewTool;class ScrollViewTool extends ViewManip{constructor(e,t=!1,r=!1){super(e,8,t,r)}}ScrollViewTool.toolId="View.Scroll",t.ScrollViewTool=ScrollViewTool;class ZoomViewTool extends ViewManip{constructor(e,t=!1,r=!1){super(e,16,t,r)}}ZoomViewTool.toolId="View.Zoom",t.ZoomViewTool=ZoomViewTool;class WalkViewTool extends ViewManip{constructor(e,t=!1,r=!1){super(e,32,t,r)}}WalkViewTool.toolId="View.Walk",t.WalkViewTool=WalkViewTool;class FlyViewTool extends ViewManip{constructor(e,t=!1,r=!1){super(e,64,t,r)}}FlyViewTool.toolId="View.Fly",t.FlyViewTool=FlyViewTool;class FitViewTool extends ViewTool{constructor(e,t,r=!0){super(),this.viewport=e,this.oneShot=t,this.doAnimate=r}async onDataButtonDown(e){return e.viewport&&this.doFit(e.viewport,!1,this.doAnimate)?n.EventHandled.Yes:n.EventHandled.No}onPostInstall(){super.onPostInstall(),this.viewport&&this.doFit(this.viewport,this.oneShot,this.doAnimate)}doFit(e,t,r=!0){return ViewManip.fitView(e,r),t&&this.exitTool(),t}}FitViewTool.toolId="View.Fit",t.FitViewTool=FitViewTool;class WindowAreaTool extends ViewTool{constructor(e){super(),this._haveFirstPoint=!1,this._firstPtWorld=o.Point3d.create(),this._secondPtWorld=o.Point3d.create(),this._corners=[new o.Point3d,new o.Point3d],this._shapePts=[new o.Point3d,new o.Point3d,new o.Point3d,new o.Point3d,new o.Point3d],this._fillColor=s.ColorDef.from(0,0,255,200),this._viewport=e}onReinitialize(){this._haveFirstPoint=!1,this._firstPtWorld.setZero(),this._secondPtWorld.setZero()}async onResetButtonUp(e){return this._haveFirstPoint?(this.onReinitialize(),n.EventHandled.Yes):super.onResetButtonUp(e)}async onDataButtonDown(e){return this._haveFirstPoint?(this._secondPtWorld.setFrom(e.point),this.doManipulation(e,!1),this.onReinitialize(),this._viewport.invalidateDecorations()):(this._firstPtWorld.setFrom(e.point),this._secondPtWorld.setFrom(this._firstPtWorld),this._haveFirstPoint=!0,this._lastPtView=e.viewPoint),n.EventHandled.Yes}async onMouseMotion(e){this.doManipulation(e,!0)}async onTouchTap(e){return e.isSingleTap?n.EventHandled.Yes:n.EventHandled.No}async onTouchMoveStart(e,t){return!this._haveFirstPoint&&t.isSingleTouch&&await a.IModelApp.toolAdmin.convertTouchMoveStartToButtonDownAndMotion(t,e),this._haveFirstPoint?n.EventHandled.Yes:n.EventHandled.No}async onTouchMove(e){this._haveFirstPoint&&a.IModelApp.toolAdmin.convertTouchMoveToMotion(e)}async onTouchComplete(e){this._haveFirstPoint&&a.IModelApp.toolAdmin.convertTouchEndToButtonUp(e)}async onTouchCancel(e){this._haveFirstPoint&&a.IModelApp.toolAdmin.convertTouchEndToButtonUp(e,1)}computeWindowCorners(){const e=this._viewport,t=this._corners;t[0].setFrom(this._firstPtWorld),t[1].setFrom(this._secondPtWorld),e.worldToViewArray(t);const r=t[1].minus(t[0]);if(r.magnitudeXY()<e.pixelsFromInches(l.ToolSettings.startDragDistanceInches))return;const n=this._viewport.viewDelta;if(0===n.x||0===r.x)return;const i=n.y/n.x;let o,s;Math.abs(r.y/r.x)<i?s=(o=Math.abs(r.x)/2)*i:o=(s=Math.abs(r.y)/2)/i;const a=t[0].plusScaled(r,.5);return t[0].x=a.x-o,t[0].y=a.y-s,t[1].x=a.x+o,t[1].y=a.y+s,t}decorate(e){const t=this._viewport.getContrastToBackgroundColor();if(this._haveFirstPoint){const r=this.computeWindowCorners();if(void 0===r)return;this._shapePts[0].x=this._shapePts[3].x=r[0].x,this._shapePts[1].x=this._shapePts[2].x=r[1].x,this._shapePts[0].y=this._shapePts[1].y=r[0].y,this._shapePts[2].y=this._shapePts[3].y=r[1].y,this._shapePts[0].z=this._shapePts[1].z=this._shapePts[2].z=this._shapePts[3].z=r[0].z,this._shapePts[4].setFrom(this._shapePts[0]),this._viewport.viewToWorldArray(this._shapePts);const n=e.createGraphicBuilder(3);return n.setBlankingFill(this._fillColor),n.addShape(this._shapePts),n.setSymbology(t,t,1),n.addLineString(this._shapePts),n.setSymbology(t,t,8),n.addPointString([this._firstPtWorld]),void e.addDecorationFromBuilder(n)}if(void 0===this._lastPtView)return;const r=this._lastPtView.clone();r.x=Math.floor(r.x)+.5,r.y=Math.floor(r.y)+.5;const n=this._viewport.viewRect;e.addCanvasDecoration({drawDecoration:e=>{e.beginPath(),e.strokeStyle=s.ColorDef.black===t?"black":"white",e.lineWidth=1,e.moveTo(n.left,r.y),e.lineTo(n.right,r.y),e.moveTo(r.x,n.top),e.lineTo(r.x,n.bottom),e.stroke()}})}doManipulation(e,t){if(this._secondPtWorld.setFrom(e.point),t)return this._lastPtView=e.viewPoint,void a.IModelApp.viewManager.invalidateDecorationsAllViews();const r=this.computeWindowCorners();if(!r)return;let n;const s=this._viewport,c=s.getWorldFrustum();if(s.viewToWorldArray(r),s.view.is3d()&&s.view.isCameraOn){const e=s.view,t=[r[0].clone(),r[1].clone()];s.worldToViewArray(t);const a=new i.ViewRect(t[0].x,t[0].y,t[1].x,t[1].y);let c=s.determineVisibleDepthRange(a);c||(c=new i.DepthRangeNpc(0,ViewManip.getFocusPlaneNpc(s)));const l=e.getLensAngle();s.worldToNpcArray(r),r[0].z=r[1].z=c.maximum,s.npcToWorldArray(r);const u=[r[0].clone(),r[1].clone()];s.rotation.multiplyVectorArrayInPlace(u);const d=o.Range3d.createArray(u);n=o.Vector3d.createStartEnd(d.low,d.high);const h=Math.max(n.x,n.y)/(2*Math.tan(l.radians/2)),p=r[0].interpolate(.5,r[1]),f=p.plusScaled(e.getZVector(),h);if(0!==e.lookAtUsingLensAngle(f,p,e.getYVector(),l,h))return}else{s.rotation.multiplyVectorArrayInPlace(r);const e=o.Range3d.createArray(r);if((n=o.Vector3d.createStartEnd(e.low,e.high)).z=s.view.getExtents().z,0!==s.view.validateViewDelta(n,!0))return;s.view.setExtents(n);const t=s.rotation.multiplyTransposeXYZ(e.low.x,e.low.y,e.low.z);s.view.setOrigin(o.Point3d.createFrom(t))}s.synchWithView(!0),s.animateFrustumChange(c,s.getFrustum())}}WindowAreaTool.toolId="View.WindowArea",t.WindowAreaTool=WindowAreaTool;class DefaultViewTouchTool extends ViewManip{constructor(e,t){super(e.viewport,0,!0,!1),this._lastPtView=new o.Point3d,this._startPtWorld=new o.Point3d,this._startPtView=new o.Point3d,this._startDirection=new o.Vector2d,this._startDistance=0,this._startTouchCount=0,this._frustum=new s.Frustum,this.onStart(e),this.handleEvent(t)}onStart(e){const t=this.viewport;t.getWorldFrustum(this._frustum);const r=t.pickNearestVisibleGeometry(e.rawPoint,t.pixelsFromInches(l.ToolSettings.viewToolPickRadiusInches));void 0!==r?(this._startPtWorld.setFrom(r),t.worldToView(this._startPtWorld,this._startPtView)):(this._startPtView.setFrom(e.viewPoint),this._startPtView.z=t.worldToView(t.view.getTargetPoint()).z,t.viewToWorld(this._startPtView,this._startPtWorld)),this._lastPtView.setFrom(this._startPtView),this._startTouchCount=e.touchCount,this._startDirection=2<=e.touchCount?o.Vector2d.createStartEnd(n.BeTouchEvent.getTouchPosition(e.touchInfo.targetTouches[0],t),n.BeTouchEvent.getTouchPosition(e.touchInfo.targetTouches[1],t)):o.Vector2d.createZero(),this._startDistance=2===e.touchCount?this._startDirection.magnitude():0}computeZoomRatio(e){if(0===this._startDistance)return 1;const t=this.viewport,r=2===e.touchCount?n.BeTouchEvent.getTouchPosition(e.touchInfo.targetTouches[0],t).distance(n.BeTouchEvent.getTouchPosition(e.touchInfo.targetTouches[1],t)):0;if(0===r)return 1;if(Math.abs(this._startDistance-r)<this.viewport.pixelsFromInches(.2))return 1;let i=this._startDistance/r;return i<.1?i=.1:i>10&&(i=10),i}computeRotation(e){if(e.touchCount<2)return o.Angle.createDegrees(0);const t=this.viewport,r=o.Vector2d.createStartEnd(n.BeTouchEvent.getTouchPosition(e.touchInfo.targetTouches[0],t),n.BeTouchEvent.getTouchPosition(e.touchInfo.targetTouches[1],t)),i=this._startDirection.angleTo(r);if(Math.abs(i.radians)<o.Angle.createDegrees(5).radians)return o.Angle.createDegrees(0);const s=Math.abs(r.magnitude()/2*Math.sin(Math.abs(i.radians))),a=Math.abs(r.magnitude()-this._startDirection.magnitude()),c=this._startPtView.distanceXY(this._lastPtView);return Math.abs(i.radians)>o.Angle.createDegrees(18).radians||s>a&&s>.75*c?i:o.Angle.createDegrees(0)}handle2dPan(e){const t=this.viewport,r=o.Point2d.create(this._startPtView.x-this._lastPtView.x,this._startPtView.y-this._lastPtView.y);t.scroll(r,{saveInUndo:!1,animateFrustumChange:!1})}handle2dRotateZoom(e){const t=this.viewport,r=this.computeRotation(e),n=this.computeZoomRatio(e),i=t.viewToWorld(this._lastPtView),s=o.Transform.createTranslation(this._startPtWorld.minus(i)),a=o.Transform.createFixedPointAndMatrix(i,o.Matrix3d.createRotationAroundVector(t.view.getZVector(),r)),c=o.Transform.createScaleAboutPoint(this._startPtWorld,n),l=s.multiplyTransformTransform(a);c.multiplyTransformTransform(l,l);const u=this._frustum.transformBy(l);t.setupViewFromFrustum(u)}handle3dRotate(e){const t=this.viewport,r=t.viewRect,n=r.width,i=r.height,s=this._lastPtView.x-this._startPtView.x,a=this._lastPtView.y-this._startPtView.y,c=l.ToolSettings.preserveWorldUp?o.Vector3d.unitZ():t.rotation.getRow(1),u=t.rotation.getRow(0),d=0!==s?o.Matrix3d.createRotationAroundVector(c,o.Angle.createRadians(Math.PI/(n/s))):o.Matrix3d.identity,h=(0!==a?o.Matrix3d.createRotationAroundVector(u,o.Angle.createRadians(Math.PI/(i/a))):o.Matrix3d.identity).multiplyMatrixMatrix(d).getAxisAndAngleOfRotation(),p=o.Angle.createRadians(-h.angle.radians),f=h.axis,g=o.Matrix3d.createRotationAroundVector(f,p);if(!g)return;const m=o.Transform.createFixedPointAndMatrix(this._startPtWorld,g),y=this._frustum.transformBy(m);t.setupViewFromFrustum(y)}handle3dPanZoom(e){const t=this.viewport,r=this.computeZoomRatio(e);if(t.isCameraOn){const e=t.viewToWorld(this._lastPtView),n=o.Transform.createTranslationXYZ(-e.x,-e.y,-e.z),i=o.Transform.createTranslation(this._startPtWorld);n.origin.scaleInPlace(r),n.matrix.scale(r,n.matrix);const s=i.multiplyTransformTransform(n),a=t.view.getEyePoint(),c=s.multiplyPoint3d(a).minus(a),l=o.Transform.createTranslation(c),u=this._frustum.transformBy(l);return void t.setupViewFromFrustum(u)}const n=t.viewToNpc(this._lastPtView),i=o.Transform.createFixedPointAndMatrix(n,o.Matrix3d.createScale(r,r,1)),s=o.Point3d.create(.5,.5,.5),a=t.viewToNpc(this._startPtView).minus(n);a.z=0,o.Transform.createTranslation(a).multiplyTransformTransform(i,i),i.multiplyPoint3d(s,s),t.npcToWorld(s,s),t.zoom(s,r,{saveInUndo:!1,animateFrustumChange:!1})}handleEvent(e){if(void 0===this.viewport)return;if(this._startTouchCount!==e.touchCount)return void this.onStart(e);const t=this.viewport.pixelsFromInches(.05);return!this._lastPtView.isAlmostEqualXY(e.viewPoint,t)&&(this._startPtView.isAlmostEqualXY(e.viewPoint,t)?this._lastPtView.setFrom(this._startPtView):(this._lastPtView.setFrom(e.viewPoint),this._lastPtView.z=this._startPtView.z),this.viewport.setupViewFromFrustum(this._frustum))?this.viewport.view.allow3dManipulations()?e.isSingleTouch?this.handle3dRotate(e):this.handle3dPanZoom(e):e.isSingleTouch?this.handle2dPan(e):this.handle2dRotateZoom(e):void 0}async onTouchMove(e){this.handleEvent(e)}async onTouchComplete(e){this.exitTool()}async onTouchCancel(e){this.exitTool()}async onDataButtonDown(e){return n.EventHandled.Yes}async onDataButtonUp(e){return n.EventHandled.Yes}}DefaultViewTouchTool.toolId="",t.DefaultViewTouchTool=DefaultViewTouchTool;class ViewUndoTool extends ViewTool{constructor(e){super(),this._viewport=e}onPostInstall(){this._viewport.doUndo(l.ToolSettings.animationTime),this.exitTool()}}ViewUndoTool.toolId="View.Undo",t.ViewUndoTool=ViewUndoTool;class ViewRedoTool extends ViewTool{constructor(e){super(),this._viewport=e}onPostInstall(){this._viewport.doRedo(l.ToolSettings.animationTime),this.exitTool()}}ViewRedoTool.toolId="View.Redo",t.ViewRedoTool=ViewRedoTool;class ViewToggleCameraTool extends ViewTool{constructor(e){super(),this._viewport=e}onInstall(){return void 0!==this._viewport&&this._viewport.view.allow3dManipulations()}onPostInstall(){this._viewport.isCameraOn?this._viewport.view.turnCameraOff():this._viewport.turnCameraOn(),this._viewport.synchWithView(!0),this.exitTool()}}ViewToggleCameraTool.toolId="View.ToggleCamera",t.ViewToggleCameraTool=ViewToggleCameraTool;class ViewChangeRenderModeTool extends ViewTool{constructor(e,t,r,n){super(),this._viewport=e,this._renderOptions=t,this._renderMenu=r,this._renderMode=n}onPostInstall(){const e=s.ViewFlags.createFrom(this._viewport.viewFlags);e.renderMode=this._renderMode,e.acsTriad=this._renderOptions.get("ACSTriad"),e.fill=this._renderOptions.get("fill"),e.grid=this._renderOptions.get("grid"),e.textures=this._renderOptions.get("textures"),e.visibleEdges=this._renderOptions.get("visibleEdges"),e.materials=this._renderOptions.get("materials"),e.monochrome=this._renderOptions.get("monochrome"),e.constructions=this._renderOptions.get("constructions"),e.transparency=this._renderOptions.get("transparency"),e.hiddenEdges=this._renderOptions.get("hiddenEdges"),e.weights=this._renderOptions.get("weights"),e.styles=this._renderOptions.get("styles"),e.clipVolume=this._renderOptions.get("clipVolume"),e.backgroundMap=this._renderOptions.get("backgroundMap");const t=this._renderOptions.get("lights");if(e.sourceLights=t,e.solarLight=t,e.cameraLights=t,this._viewport.view.is3d()){const e=this._viewport.view.getDisplayStyle3d().environment;e.ground.display=this._renderOptions.get("groundplane"),e.sky.display=this._renderOptions.get("skybox")}this._viewport.view.viewFlags=e,this._viewport.sync.invalidateController()}async onDataButtonDown(e){return this._renderMenu.style.display="none",this.exitTool(),n.EventHandled.Yes}}ViewChangeRenderModeTool.toolId="View.ChangeRenderMode",t.ViewChangeRenderModeTool=ViewChangeRenderModeTool},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:this.props.className}),s.createElement("i",null),s.createElement("i",null),s.createElement("i",null),s.createElement("i",null),s.createElement("i",null),s.createElement("i",null))},t}(s.Component);t.Loader=a,t.default=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=r(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e="step-"+(this.props.stepCount&&this.props.stepCount<13?Math.floor(12*this.props.stepNum/(this.props.stepCount-1)):this.props.stepNum%16);return o.createElement("div",{className:s("bwc-tiles-tile",e,{featured:this.props.featured,minimal:this.props.minimal}),style:this.props.style},o.createElement("a",{className:"link",href:this.props.href,onClick:this.props.onClick},o.createElement("div",{className:"icon"},o.createElement("img",{src:"/components/tiles/icon.png"})),o.createElement("p",{className:"title"},this.props.title)),this.props.children&&!this.props.minimal&&o.createElement("div",{className:"children"},this.props.children))},t.defaultProps={stepNum:0},t}(o.Component);t.Tile=a,t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SelectionLimitOne=1]="SelectionLimitOne",e[e.DragEnabled=2]="DragEnabled",e[e.ToggleEnabled=4]="ToggleEnabled",e[e.KeysEnabled=8]="KeysEnabled"}(t.SelectionModeFlags||(t.SelectionModeFlags={})),function(e){e[e.Single=1]="Single",e[e.Multiple=6]="Multiple",e[e.Extended=12]="Extended",e[e.SingleAllowDeselect=5]="SingleAllowDeselect"}(t.SelectionMode||(t.SelectionMode={})),t.hasFlag=((e,t)=>0!==(e&t))},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var i=r(345),o=r(28),s=r(111);t.BEGIN_DRAG="dnd-core/BEGIN_DRAG",t.PUBLISH_DRAG_SOURCE="dnd-core/PUBLISH_DRAG_SOURCE",t.HOVER="dnd-core/HOVER",t.DROP="dnd-core/DROP",t.END_DRAG="dnd-core/END_DRAG",t.default=function(e){return{beginDrag:function(r,n){void 0===r&&(r=[]);var i=void 0===n?{publishSource:!0}:n,a=i.publishSource,c=i.clientOffset,l=i.getSourceClientOffset,u=e.getMonitor(),d=e.getRegistry();o(!u.isDragging(),"Cannot call beginDrag while dragging.");for(var h=0,p=r;h<p.length;h++){var f=p[h];o(d.getSource(f),"Expected sourceIds to be registered.")}for(var g=null,m=r.length-1;m>=0;m--)if(u.canDragSource(r[m])){g=r[m];break}if(null!==g){var y=null;c&&(o("function"===typeof l,"When clientOffset is provided, getSourceClientOffset must be a function."),y=l(g));var v=d.getSource(g).beginDrag(u,g);o(s(v),"Item must be an object."),d.pinSource(g);var _=d.getSourceType(g);return{type:t.BEGIN_DRAG,payload:{itemType:_,item:v,sourceId:g,clientOffset:c||null,sourceClientOffset:y||null,isSourcePublic:!!a}}}},publishDragSource:function(){if(e.getMonitor().isDragging())return{type:t.PUBLISH_DRAG_SOURCE}},hover:function(r,n){var s=(void 0===n?{}:n).clientOffset;o(Array.isArray(r),"Expected targetIds to be an array.");var a=r.slice(0),c=e.getMonitor(),l=e.getRegistry();o(c.isDragging(),"Cannot call hover while not dragging."),o(!c.didDrop(),"Cannot call hover after drop.");for(var u=0;u<a.length;u++){var d=a[u];o(a.lastIndexOf(d)===u,"Expected targetIds to be unique in the passed array.");var h=l.getTarget(d);o(h,"Expected targetIds to be registered.")}var p=c.getItemType();for(u=a.length-1;u>=0;u--){d=a[u];var f=l.getTargetType(d);i.default(f,p)||a.splice(u,1)}for(var g=0,m=a;g<m.length;g++)d=m[g],(h=l.getTarget(d)).hover(c,d);return{type:t.HOVER,payload:{targetIds:a,clientOffset:s||null}}},drop:function(r){void 0===r&&(r={});var i=e.getMonitor(),a=e.getRegistry();o(i.isDragging(),"Cannot call drop while not dragging."),o(!i.didDrop(),"Cannot call drop twice during one drag operation.");var c=i.getTargetIds().filter(i.canDropOnTarget,i);c.reverse(),c.forEach(function(c,l){var u=a.getTarget(c).drop(i,c);o("undefined"===typeof u||s(u),"Drop result must either be an object or undefined."),"undefined"===typeof u&&(u=0===l?{}:i.getDropResult());var d={type:t.DROP,payload:{dropResult:n({},r,u)}};e.dispatch(d)})},endDrag:function(){var r=e.getMonitor(),n=e.getRegistry();o(r.isDragging(),"Cannot call endDrag while not dragging.");var i=r.getSourceId();return n.getSource(i,!0).endDrag(r,i),n.unpinSource(),{type:t.END_DRAG}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADD_SOURCE="dnd-core/ADD_SOURCE",t.ADD_TARGET="dnd-core/ADD_TARGET",t.REMOVE_SOURCE="dnd-core/REMOVE_SOURCE",t.REMOVE_TARGET="dnd-core/REMOVE_TARGET",t.addSource=function(e){return{type:t.ADD_SOURCE,payload:{sourceId:e}}},t.addTarget=function(e){return{type:t.ADD_TARGET,payload:{targetId:e}}},t.removeSource=function(e){return{type:t.REMOVE_SOURCE,payload:{sourceId:e}}},t.removeTarget=function(e){return{type:t.REMOVE_TARGET,payload:{targetId:e}}}},function(e,t,r){var n=r(153)(Object,"create");e.exports=n},function(e,t,r){var n=r(739),i=r(745);e.exports=function(e,t){var r=i(e,t);return n(r)?r:void 0}},function(e,t,r){var n=r(113).Symbol;e.exports=n},function(e,t,r){var n=r(203);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},function(e,t,r){var n=r(758);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}},function(e,t,r){var n=r(208),i=r(94);e.exports=function(e){return i(e)&&n(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n]}},function(e,t,r){"use strict";var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,s,a=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),c=1;c<arguments.length;c++){for(var l in r=Object(arguments[c]))i.call(r,l)&&(a[l]=r[l]);if(n){s=n(r);for(var u=0;u<s.length;u++)o.call(r,s[u])&&(a[s[u]]=r[s[u]])}}return a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(8),i=r(3),o=r(131),s=r(20),a=r(108),c=r(4),l=r(30),u=r(76),d=r(146);var h,p;!function(e){e[e.SetModePolar=1]="SetModePolar",e[e.SetModeRect=2]="SetModeRect",e[e.SetOrigin=4]="SetOrigin",e[e.FixedOrigin=8]="FixedOrigin",e[e.SetRMatrix=16]="SetRMatrix",e[e.SetXAxis=32]="SetXAxis",e[e.SetNormal=64]="SetNormal",e[e.SetDistance=128]="SetDistance",e[e.LockDistance=256]="LockDistance",e[e.Lock_X=512]="Lock_X",e[e.Lock_Y=1024]="Lock_Y",e[e.Lock_Z=2048]="Lock_Z",e[e.Disable=4096]="Disable",e[e.OrientDefault=16384]="OrientDefault",e[e.SetFocus=32768]="SetFocus",e[e.OrientACS=131072]="OrientACS",e[e.SetXAxis2=262144]="SetXAxis2",e[e.LockAngle=524288]="LockAngle",e[e.AlwaysSetOrigin=2097156]="AlwaysSetOrigin",e[e.RedrawCompass=4194304]="RedrawCompass",e[e.UpdateRotation=8388608]="UpdateRotation",e[e.SmartRotation=16777216]="SmartRotation"}(t.AccuDrawFlags||(t.AccuDrawFlags={})),function(e){e[e.Polar=0]="Polar",e[e.Rectangular=1]="Rectangular"}(t.CompassMode||(t.CompassMode={})),function(e){e[e.Top=1]="Top",e[e.Front=2]="Front",e[e.Side=3]="Side",e[e.View=4]="View",e[e.ACS=5]="ACS",e[e.Context=6]="Context"}(t.RotationMode||(t.RotationMode={})),function(e){e[e.NONE_LOCKED=0]="NONE_LOCKED",e[e.X_BM=1]="X_BM",e[e.Y_BM=2]="Y_BM",e[e.VEC_BM=4]="VEC_BM",e[e.DIST_BM=8]="DIST_BM",e[e.XY_BM=3]="XY_BM",e[e.ANGLE_BM=7]="ANGLE_BM"}(t.LockedStates||(t.LockedStates={})),function(e){e[e.NotEnabled=0]="NotEnabled",e[e.Deactivated=1]="Deactivated",e[e.Inactive=2]="Inactive",e[e.Active=3]="Active"}(t.CurrentState||(t.CurrentState={})),function(e){e[e.Locked=0]="Locked",e[e.XAxis=1]="XAxis",e[e.YAxis=2]="YAxis",e[e.ZAxis=3]="ZAxis",e[e.XAxis2=4]="XAxis2",e[e.None=15]="None"}(t.ContextMode||(t.ContextMode={})),function(e){e[e.DIST_Item=0]="DIST_Item",e[e.ANGLE_Item=1]="ANGLE_Item",e[e.X_Item=2]="X_Item",e[e.Y_Item=3]="Y_Item",e[e.Z_Item=4]="Z_Item"}(t.ItemField||(t.ItemField={})),function(e){e[e.Dynamic=0]="Dynamic",e[e.Partial=1]="Partial",e[e.DontUpdate=2]="DontUpdate"}(h=t.KeyinStatus||(t.KeyinStatus={})),function(e){e[e.MAX_SAVED_VALUES=20]="MAX_SAVED_VALUES",e[e.SMALL_ANGLE=1e-12]="SMALL_ANGLE",e[e.SMALL_DELTA=1e-5]="SMALL_DELTA"}(p||(p={}));class AccudrawData{constructor(){this.flags=0,this.origin=new i.Point3d,this.delta=new i.Point3d,this.rMatrix=new i.Matrix3d,this.vector=new i.Vector3d,this.distance=0,this.angle=0}zero(){this.flags=this.distance=this.angle=0,this.origin.setZero(),this.delta.setZero(),this.vector.setZero(),this.rMatrix.setIdentity()}}t.AccudrawData=AccudrawData;class Flags{constructor(){this.redrawCompass=!1,this.dialogNeedsUpdate=!1,this.rotationNeedsUpdate=!0,this.lockedRotation=!1,this.indexLocked=!1,this.haveValidOrigin=!1,this.fixedOrg=!1,this.auxRotationPlane=1,this.contextRotMode=0,this.baseRotation=4,this.baseMode=0,this.pointIsOnPlane=!1,this.softAngleLock=!1,this.bearingFixToPlane2D=!1,this.inDataPoint=!1,this.ignoreDataButton=!1,this.animateRotation=!1}}t.Flags=Flags;class RoundOff{constructor(){this.active=!1,this.units=new Set}}t.RoundOff=RoundOff;class SavedState{constructor(){this.state=0,this.mode=0,this.rotationMode=4,this.axes=new ThreeAxes,this.origin=new i.Point3d,this.auxRotationPlane=0,this.contextRotMode=0,this.fixedOrg=!1,this.ignoreDataButton=!0,this.ignoreFlags=0}}t.SavedState=SavedState;class SavedCoords{constructor(){this.nSaveValues=0,this.savedValues=[],this.savedValIsAngle=[]}}class ThreeAxes{constructor(){this.x=i.Vector3d.unitX(),this.y=i.Vector3d.unitY(),this.z=i.Vector3d.unitZ()}setFrom(e){this.x.setFrom(e.x),this.y.setFrom(e.y),this.z.setFrom(e.z)}fromMatrix3d(e){e.getRow(0,this.x),e.getRow(1,this.y),e.getRow(2,this.z)}static createFromMatrix3d(e,t){return(t=t||new ThreeAxes).fromMatrix3d(e),t}toMatrix3d(e){return i.Matrix3d.createRows(this.x,this.y,this.z,e)}clone(){const e=new ThreeAxes;return e.setFrom(this),e}equals(e){return this.x.isExactEqual(e.x)&&this.y.isExactEqual(e.y)&&this.z.isExactEqual(e.z)}}t.ThreeAxes=ThreeAxes;class AccuDraw{constructor(){this.currentState=0,this.compassMode=1,this.rotationMode=4,this.published=new AccudrawData,this.origin=new i.Point3d,this.axes=new ThreeAxes,this.delta=i.Vector3d.unitZ(),this._distance=0,this._angle=0,this.locked=0,this.indexed=0,this._distanceRoundOff=new RoundOff,this._angleRoundOff=new RoundOff,this.flags=new Flags,this._fieldLocked=[],this._keyinStatus=[],this.savedStateViewTool=new SavedState,this.savedStateInputCollector=new SavedState,this._savedCoords=new SavedCoords,this.baseAxes=new ThreeAxes,this.lastAxes=new ThreeAxes,this._lastDistance=0,this._tolerance=0,this._percentChanged=0,this._threshold=0,this.planePt=new i.Point3d,this._rawDelta=new i.Point2d,this._rawPoint=new i.Point3d,this._rawPointOnPlane=new i.Point3d,this.point=new i.Point3d,this.vector=i.Vector3d.unitZ(),this._xIsNegative=!1,this._yIsNegative=!1,this._xIsExplicit=!1,this._yIsExplicit=!1,this.dontMoveFocus=!1,this.newFocus=2,this._rMatrix=new i.Matrix3d,this._compassSizeInches=.44,this._animationFrames=12,this._indexToleranceInches=.11,this._frameColor=new c.ColorDef(c.ColorByName.lightGrey),this._fillColor=new c.ColorDef(c.ColorByName.blue),this._xColor=new c.ColorDef(c.ColorByName.red),this._yColor=new c.ColorDef(c.ColorByName.green),this._indexColor=new c.ColorDef(c.ColorByName.white),this._frameColorNoFocus=new c.ColorDef(c.ColorByName.darkGrey),this._fillColorNoFocus=new c.ColorDef(c.ColorByName.lightGrey),this.smartKeyin=!0,this.floatingOrigin=!0,this.stickyZLock=!1,this.alwaysShowCompass=!1,this.contextSensitive=!0,this.axisIndexing=!0,this.distanceIndexing=!0,this.autoFocusFields=!0,this.autoPointPlacement=!1}onInitialized(){this.enableForSession()}getRotation(e){return e||(e=this._rMatrix),i.Matrix3d.createRows(this.axes.x,this.axes.y,this.axes.z,e),e}get isActive(){return 3===this.currentState}get isEnabled(){return this.currentState>0}get isInactive(){return 2===this.currentState}get isDeactivated(){return 1===this.currentState}setNewFocus(e){this.newFocus=e}getFieldLock(e){return this._fieldLocked[e]}getKeyinStatus(e){return this._keyinStatus[e]}grabInputFocus(){}activate(){1===this.currentState&&(this.currentState=2),this.upgradeToActiveState()}deactivate(){this.downgradeInactiveState(),2===this.currentState&&(this.currentState=1)}setCompassMode(e){e!==this.compassMode&&(this.compassMode=e,this.onCompassModeChange())}setRotationMode(e){e!==this.rotationMode&&(this.rotationMode=e,this.onRotationModeChange())}setFieldLock(e,t){t!==this._fieldLocked[e]&&(this._fieldLocked[e]=t,this.onFieldLockChange(e))}setKeyinStatus(e,t){this._keyinStatus[e]=t,h.Dynamic!==t&&(this.dontMoveFocus=!0),h.Partial===t&&(this._threshold=Math.abs(2===e?this._rawDelta.y:this._rawDelta.x)+this._tolerance)}needsRefresh(e){if(!this.isEnabled||this.isDeactivated)return!1;let t=0,r=this._rawPoint;const i=this.point,o=u.TentativeOrAccuSnap.getCurrentSnap();o&&(r=o.snapPoint,t=i.distance(r));const s=1===this.compassMode,a=(u.TentativeOrAccuSnap.isHot||n.IModelApp.tentativePoint.isActive)&&(this.locked||t>0);if(a&&s){let e=!1,t=!1;const r=i.vectorTo(this._rawPointOnPlane),n=r.dotProduct(this.axes.x),o=r.dotProduct(this.axes.y);if(e=Math.abs(n)>1,t=Math.abs(o)>1,e||t)return!0}const c=!e.view.is3d()||this.flags.pointIsOnPlane||this.isZLocked(e);if(a&&c){const e=r.distance(this._rawPointOnPlane);if(e>p.SMALL_ANGLE||e<-p.SMALL_ANGLE)return!0}if(a)return!0;let l=!1;if(s?3&this.indexed&&(this.flags.pointIsOnPlane||this._fieldLocked[4])&&(l=!0):(7&this.indexed||7&this.locked)&&(this.flags.pointIsOnPlane||this._fieldLocked[4])&&(l=!0),l)return!0;if(8&this.indexed)return!0;if(s&&!l){const e=3&this.locked;if(0!==e&&c)switch(e){case 1:case 2:case 3:return!0}}return!1}adjustPoint(e,t,r){if(!this.isEnabled)return!1;const i=0!==this.indexed;let o=!1,s=!1;if(0===e.z||t.isPointAdjustmentRequired||(e.z=0),this.isInactive)this.point.setFrom(e),this.currentView=t,this.fixPoint(e,t),!r&&n.IModelApp.accuSnap.currHit&&(this.flags.redrawCompass=!0);else if(this.isActive){const r=this.point.clone();this.fixPoint(e,t),o=!r.isExactEqual(this.point),this.processHints(),s=!0}else this.currentView=t;return!this.flags.redrawCompass&&this.isActive&&o&&(i||this.needsRefresh(t))&&(this.flags.redrawCompass=!0),this.flags.redrawCompass&&t.invalidateDecorations(),s}setDefaultOrigin(e){if(!e||this.locked||this._fieldLocked[4])return;const t=e.view,r=t.getRotation(),n=e.getAuxCoordOrigin();r.multiplyVectorInPlace(n);const i=t.getCenter();t.getRotation().multiplyVectorInPlace(i),i.z=n.z,t.getRotation().multiplyTransposeVectorInPlace(i),this.origin.setFrom(i),this.planePt.setFrom(i)}isZLocked(e){return!!this._fieldLocked[4]||!!e.isSnapAdjustmentRequired}accountForAuxRotationPlane(e,t){switch(t){case 1:return;case 2:const r=e.y.clone();return e.y.setFrom(e.z),void r.scale(-1,e.z);case 3:const n=e.x.clone();e.x.setFrom(e.y),e.y.setFrom(e.z),e.z.setFrom(n)}}accountForACSContextLock(e){if(!this.currentView||!this.currentView.isContextRotationRequired)return;AccuDraw.getStandardRotation(0,this.currentView,!0).multiplyTransposeVectorInPlace(e)}static useACSContextRotation(e,t){if(t){if(!e.isSnapAdjustmentRequired)return!1}else if(!e.isContextRotationRequired)return!1;return!0}getStandardVector(e){const t=this.currentView;let r,n;const o=i.Vector3d.createZero();switch(this.flags.baseRotation){case 1:switch(e){case 0:o.x=1;break;case 1:o.y=1;break;case 2:o.z=1}this.accountForACSContextLock(o);break;case 2:switch(e){case 0:o.x=1;break;case 1:o.z=1;break;case 2:o.y=-1}this.accountForACSContextLock(o);break;case 3:switch(e){case 0:o.y=1;break;case 1:o.z=1;break;case 2:o.x=1}this.accountForACSContextLock(o);break;case 5:switch(r=t?t.getAuxCoordRotation():i.Matrix3d.createIdentity(),n=ThreeAxes.createFromMatrix3d(r),this.accountForAuxRotationPlane(n,this.flags.auxRotationPlane),e){case 0:o.setFrom(n.x);break;case 1:o.setFrom(n.y);break;case 2:o.setFrom(n.z)}break;case 4:(r=t?t.rotation:i.Matrix3d.createIdentity()).getRow(e,o);break;case 6:switch(n=this.baseAxes.clone(),this.accountForAuxRotationPlane(n,this.flags.auxRotationPlane),e){case 0:o.setFrom(n.x);break;case 1:o.setFrom(n.y);break;case 2:o.setFrom(n.z)}}return o}getBestViewedRotationFromXVector(e,t){const r=t.rotation.getRow(2),n=this.getStandardVector(2),o=this.getStandardVector(1),s=this.getStandardVector(0),a=n.crossProduct(e.x),c=o.crossProduct(e.x),l=s.crossProduct(e.x),u=a.normalizeWithLength(a).mag>1e-5,d=c.normalizeWithLength(c).mag>1e-5,h=l.normalizeWithLength(l).mag>1e-5,p=u?Math.abs(e.x.crossProduct(a).dotProduct(r)):-1,f=d?Math.abs(e.x.crossProduct(c).dotProduct(r)):-1,g=h?Math.abs(e.x.crossProduct(l).dotProduct(r)):-1,m=Math.max(p,f,g);i.Geometry.isDistanceWithinTol(p-f,.1)&&m!==g?e.y.setFrom(a):m===p?e.y.setFrom(a):m===f?e.y.setFrom(c):e.y.setFrom(l),e.z.setFrom(e.x.crossProduct(e.y))}getRotationFromVector(e,t){let r;switch(t){case 0:(r=this.getStandardVector(2)).crossProduct(e.x,e.y),e.y.normalizeWithLength(e.y).mag<1e-5&&((r=this.getStandardVector(1)).crossProduct(e.x,e.y),e.y.normalizeInPlace()),e.x.crossProduct(e.y,e.z);break;case 1:(r=this.getStandardVector(2)).crossProduct(e.y,e.x),e.x.normalizeWithLength(e.x).mag<1e-5&&((r=this.getStandardVector(0)).crossProduct(e.y,e.x),e.x.normalizeInPlace()),e.x.crossProduct(e.y,e.z);break;case 2:r=this.getStandardVector(0),e.z.crossProduct(r,e.y),e.y.normalizeWithLength(e.y).mag<1e-5?((r=this.getStandardVector(1)).crossProduct(e.z,e.x),e.x.normalizeInPlace(),e.z.crossProduct(e.x,e.y)):e.y.crossProduct(e.z,e.x)}}updateRotation(e=!1,t){let r=!0;const n=this.axes.clone();let o,s;s=t?ThreeAxes.createFromMatrix3d(t):this.axes.clone();const a=this.currentView,c=!!a&&a.isContextRotationRequired;switch(this.rotationMode){case 1:s.fromMatrix3d(AccuDraw.getStandardRotation(0,a,c)),this.flags.lockedRotation=!0;break;case 2:s.fromMatrix3d(AccuDraw.getStandardRotation(4,a,c)),this.flags.lockedRotation=!0;break;case 3:s.fromMatrix3d(AccuDraw.getStandardRotation(3,a,c)),this.flags.lockedRotation=!0;break;case 5:o=a?a.getAuxCoordRotation():i.Matrix3d.createIdentity(),s.fromMatrix3d(o),this.accountForAuxRotationPlane(s,this.flags.auxRotationPlane),this.flags.lockedRotation=!0;break;case 4:o=a?a.rotation:i.Matrix3d.createIdentity(),s.fromMatrix3d(o),this.flags.lockedRotation=!1;break;case 6:switch(this.flags.contextRotMode){case 1:this.getRotationFromVector(s,0),r=2!==this.locked||!n.x.isExactEqual(s.x);break;case 4:a?this.getBestViewedRotationFromXVector(s,a):this.getRotationFromVector(s,0),r=2!==this.locked||!n.x.isExactEqual(s.x);break;case 2:this.getRotationFromVector(s,1),r=1!==this.locked||!n.y.isExactEqual(s.y);break;case 3:this.getRotationFromVector(s,2)}}!n.equals(s)&&r&&(1===this.compassMode||!this._fieldLocked[0]||e)&&(this.locked=this.indexed=0,this.unlockAllFields()),this.axes.setFrom(s),this.lastAxes.setFrom(s),this.flags.redrawCompass=!0}enableForSession(){0===this.currentState&&(this.currentState=2)}disableForSession(){this.currentState=0,this.flags.redrawCompass=!0}setLastPoint(e){const t=this.currentView;if(!t)return;const r=new l.BeButtonEvent;r.initEvent(e,e,t.worldToView(e),t,0),n.IModelApp.toolAdmin.setAdjustedDataPoint(r)}sendDataPoint(e,t){const r=new l.BeButtonEvent;r.initEvent(e,e,t.worldToView(e),t,0),n.IModelApp.toolAdmin.sendButtonEvent(r),r.isDown=!1,n.IModelApp.toolAdmin.sendButtonEvent(r)}clearTentative(){if(!n.IModelApp.tentativePoint.isActive)return!1;const e=n.IModelApp.tentativePoint.isSnapped;return n.IModelApp.tentativePoint.clear(!0),e}doAutoPoint(e,t){const r=this.currentView;if(r)if(0!==t){if(this._fieldLocked[2]&&this._fieldLocked[3]){if(!this.isActive){if(!r.view.is3d()||this._fieldLocked[4]){const e=new i.Point3d;r.view.isSpatialView()&&e.setFrom(r.view.iModel.globalOrigin),this.sendDataPoint(e.plus(this.delta),r)}return}if(!this.autoPointPlacement||h.Dynamic!==this._keyinStatus[e])return;return this.origin.plus3Scaled(this.axes.x,this.delta.x,this.axes.y,this.delta.y,this.axes.z,this.delta.z,this.point),void this.sendDataPoint(this.point,r)}this.autoPointPlacement&&h.Dynamic===this._keyinStatus[e]&&(2===e&&this._fieldLocked[2]&&2&this.indexed||3===e&&this._fieldLocked[3]&&1&this.indexed)&&(this.origin.plus3Scaled(this.axes.x,this.delta.x,this.axes.y,this.delta.y,this.axes.z,this.delta.z,this.point),this.sendDataPoint(this.point,r))}else{if(!this.autoPointPlacement)return;this._fieldLocked[0]&&(this._fieldLocked[1]||7&this.indexed)&&h.Dynamic===this._keyinStatus[e]&&(this.fixPointPolar(r),this.sendDataPoint(this.point,r))}}getValueByIndex(e){switch(e){case 2:return this.delta.x;case 3:return this.delta.y;case 4:return this.delta.z;case 0:return this._distance;case 1:return this._angle;default:return 0}}setValueByIndex(e,t){switch(e){case 2:this.delta.x=t;break;case 3:this.delta.y=t;break;case 4:this.delta.z=t;break;case 0:this._distance=t;break;case 1:this._angle=t}}updateVector(e){this.vector.set(Math.cos(e),Math.sin(e),0),this.getRotation().multiplyTransposeVector(this.vector)}stringToUORs(e,t){return 0}stringToAngle(e,t,r,n){return 0}updateFieldValue(e,t,r){if(0===t.length)return 32768;if(1===t.length)switch(t){case":":case"-":case"+":case".":return 32768}switch(e){case 0:if(0!==this.stringToUORs([this._distance],t))return 32768;break;case 1:if(0!==this.stringToAngle([this._angle],r,t,!0))return 32768;break;case 2:if(0!==this.stringToUORs([this.delta.x],t))return 32768;this._xIsExplicit="+"===t[0]||"-"===t[0],this._xIsExplicit||this.smartKeyin&&this.isActive&&this._xIsNegative===this.delta.x>=0&&(this.delta.x=-this.delta.x);break;case 3:if(0!==this.stringToUORs([this.delta.y],t))return 32768;this._yIsExplicit="+"===t[0]||"-"===t[0],this._yIsExplicit||this.smartKeyin&&this.isActive&&this._yIsNegative===this.delta.y>=0&&(this.delta.y=-this.delta.y);break;case 4:if(0!==this.stringToUORs([this.delta.z],t))return 32768}return 0}unlockAllFields(){this.locked=0,0===this.compassMode?(this._fieldLocked[0]&&this.setFieldLock(0,!1),this._fieldLocked[1]&&this.setFieldLock(1,!1)):(this._fieldLocked[2]&&this.setFieldLock(2,!1),this._fieldLocked[3]&&this.setFieldLock(3,!1)),this._fieldLocked[4]&&(this.stickyZLock?this.delta.z=0:this.setFieldLock(4,!1)),this.setKeyinStatus(0,h.Dynamic),this.setKeyinStatus(1,h.Dynamic),this.setKeyinStatus(2,h.Dynamic),this.setKeyinStatus(3,h.Dynamic),this.setKeyinStatus(4,h.Dynamic),this.smartKeyin||this.setFocusItem(0===this.compassMode?0:2),this.dontMoveFocus=!1}planeByVectorAndView(e,t,r){if(!r.view.is3d())return e.setFrom(i.Vector3d.unitZ()),!0;const n=r.rotation.getRow(2),o=n.crossProduct(t);return o.normalizeInPlace()?(t.crossProduct(o,e),!0):(e=n,!1)}handleDegeneratePolarCase(){8&this.locked||(this._distance=0),4&this.locked?this._angle=Math.acos(this.vector.dotProduct(this.axes.x)):2&this.locked?(this.vector.setFrom(this.axes.y),this._angle=Math.PI/2,this.indexed=this.locked):1&this.locked?(this.vector.setFrom(this.axes.x),this._angle=0,this.indexed=this.locked):this._angle=Math.acos(this.vector.dotProduct(this.axes.x)),this.origin.plusScaled(this.vector,this._distance,this.point)}rawDeltaIsValid(e){return 0!==e||(0===(4&n.IModelApp.toolAdmin.toolState.coordLockOvr)||!n.IModelApp.toolAdmin.gridLock)}processFieldInput(e,t,r){if(0!==this.updateFieldValue(e,t,{isBearing:!1})){const t=this._keyinStatus[e];return this.updateFieldLock(e,!1),void(this._keyinStatus[e]=t)}switch(e){case 0:this.distanceLock(r,!0),this.doAutoPoint(e,0);break;case 1:this.setFieldLock(e,!0),r&&(this.onFieldValueChange(e),this.setKeyinStatus(e,h.Dynamic)),this.updateVector(this._angle),this.locked|=4,this.doAutoPoint(e,0);break;case 2:case 3:this.locked|=2===e?1:2;case 4:this.setFieldLock(e,!0),r&&(this.onFieldValueChange(e),this.setKeyinStatus(e,h.Dynamic)),this.doAutoPoint(e,this.compassMode)}this.refreshDecorationsAndDynamics()}updateFieldLock(e,t){if(t){if(!this._fieldLocked[e])switch(this.setFieldLock(e,!0),e){case 0:this.distanceLock(!0,!1);break;case 1:this.angleLock();break;case 2:this.locked|=1;break;case 3:this.locked|=2}}else{switch(e){case 0:this.locked&=-9;break;case 1:this.locked&=-5;break;case 2:this.locked&=-2;break;case 3:this.locked&=-3}4===e&&this.stickyZLock||this.setFieldLock(e,!1),this.setKeyinStatus(e,h.Dynamic)}}static getSnapRotation(e,t,r){const n=void 0!==t?t:e.viewport,o=r||new i.Matrix3d,s=n.rotation.rowZ(),a=void 0!==e.primitive?e.primitive.closestPoint(e.snapPoint,!1):void 0;if(void 0!==a){const t=e.primitive.fractionToFrenetFrame(a.fraction),r=void 0!==t?t.matrix.columnZ():i.Vector3d.unitZ();let c=void 0!==t?t.matrix.columnX():i.Vector3d.unitX();const l=n.view.allow3dManipulations()?void 0!==e.normal?e.normal.clone():r.clone():i.Vector3d.unitZ();!n.isCameraOn&&s.isPerpendicularTo(l)&&l.setFrom(s),c.normalizeInPlace(),l.normalizeInPlace();let u=c.unitCrossProduct(l);if(void 0!==u){const t=n.rotation.rowX();if(e.primitive instanceof i.LineString3d){if(Math.abs(c.dotProduct(t))<Math.abs(u.dotProduct(t))){const e=c;c=u,u=e}c.dotProduct(t)<0&&c.negate(c)}else{const r=e.primitive.fractionToPointAndUnitTangent(0);r.direction.dotProduct(t)<0&&r.direction.dotProduct(c)>0&&c.negate(c)}if(l.dotProduct(s)<0&&l.negate(l),void 0!==(u=c.unitCrossProduct(l)))return o.setColumns(c,u,l),i.Matrix3d.createRigidFromMatrix3d(o,4,o),o.transposeInPlace(),o}}if(void 0!==e.normal){const t=n.view.allow3dManipulations()?e.normal.clone():i.Vector3d.unitZ();return!n.isCameraOn&&s.isPerpendicularTo(t)&&t.setFrom(s),t.normalizeInPlace(),i.Matrix3d.createRigidHeadsUp(t,void 0,o),o.transposeInPlace(),o}}static getStandardRotation(e,t,r,o){const s=o||new i.Matrix3d;s.setFrom(a.ViewState.getStandardViewMatrix(e));const c=t||n.IModelApp.viewManager.selectedView;return r&&c?(s.multiplyMatrixMatrix(c.getAuxCoordRotation(AccuDraw._tempRot),s),s):s}static getCurrentOrientation(e,t,r,o){if(t&&n.IModelApp.accuDraw.isActive)return n.IModelApp.accuDraw.getRotation(o);const s=e||n.IModelApp.viewManager.selectedView;return s?r&&s.isContextRotationRequired?s.getAuxCoordRotation(o):s.rotation:i.Matrix3d.createIdentity(o)}static updateAuxCoordinateSystem(e,t,r=!0){r&&t.view.isSpatialView()&&n.IModelApp.viewManager.forEachViewport(r=>{r!==t&&r.view.isSpatialView()&&r.view.setAuxiliaryCoordinateSystem(e)}),t.view.setAuxiliaryCoordinateSystem(e),n.IModelApp.accuDraw.setContext(131072)}distanceLock(e,t){this.locked|=8,this._fieldLocked[0]||this.setFieldLock(0,!0),t&&this.saveCoordinate(0,this._distance),e&&(this.onFieldValueChange(0),this.setKeyinStatus(0,h.Dynamic))}angleLock(){2&this.indexed?this.locked|=2:1&this.indexed?this.locked|=1:this.locked|=4,this.clearTentative(),this._fieldLocked[1]||(this.setFieldLock(1,!0),this.setKeyinStatus(1,h.Dynamic)),this.flags.lockedRotation=!0,this.flags.softAngleLock=!1}doLockAngle(e){if(0!==this.compassMode){this.locked=0,this._rawPoint.setFrom(this.point);const e=this.currentView;e&&this.fixPointPolar(e),this.changeCompassMode(!0)}this.setFieldLock(1,!this._fieldLocked[1]),this._fieldLocked[1]?(!e&&this.autoFocusFields&&this.setFocusItem(1),this.angleLock(),e||(this.flags.softAngleLock=!0)):(this.locked&=-8,this.saveCoordinate(1,this._angle))}saveCoordinate(e,t){const r=1===e;let n=this._savedCoords.nSaveValues+1;if(n>=p.MAX_SAVED_VALUES&&(n=0),this._savedCoords.savedValues[this._savedCoords.nSaveValues]!==t||this._savedCoords.savedValIsAngle[this._savedCoords.nSaveValues]!==r){if(r){if(0===t||t===Math.PI||t===Math.PI/2||t===-Math.PI)return}else if((t=Math.abs(t))<p.SMALL_ANGLE)return;this._savedCoords.savedValues[n]=t,this._savedCoords.savedValIsAngle[n]=r,this._savedCoords.nSaveValues=n,r||(this._lastDistance=t)}}changeCompassMode(e=!1){this.setCompassMode(0===this.compassMode?1:0);this.currentView}changeBaseRotationMode(e){if(!(e>6)){if(6===e){if(6!==this.flags.baseRotation){if(this.getBaseRotation().getRow(2).isParallelTo(this.axes.z))return}this.baseAxes.setFrom(this.axes),this.flags.auxRotationPlane=1}this.flags.baseRotation=e}}getBaseRotation(){const e=this.currentView;let t;const r=!!e&&e.isContextRotationRequired;switch(this.flags.baseRotation){case 1:t=AccuDraw.getStandardRotation(0,e,r);break;case 2:t=AccuDraw.getStandardRotation(4,e,r);break;case 3:t=AccuDraw.getStandardRotation(3,e,r);break;case 5:{t=e?e.getAuxCoordRotation():i.Matrix3d.createIdentity();const r=ThreeAxes.createFromMatrix3d(t);this.accountForAuxRotationPlane(r,this.flags.auxRotationPlane),r.toMatrix3d(t);break}case 4:t=e?e.rotation:i.Matrix3d.createIdentity();break;case 6:{const e=new ThreeAxes;e.setFrom(this.baseAxes),this.accountForAuxRotationPlane(e,this.flags.auxRotationPlane),t=e.toMatrix3d();break}default:t=i.Matrix3d.createIdentity()}return t}setContextRotation(e,t,r){this.flags.lockedRotation=t,this.flags.contextRotMode=t?0:15,this.setRotationMode(6),this.updateRotation(r,e)}clearContext(){this.published.flags=0,this.flags.rotationNeedsUpdate=!0,this.flags.fixedOrg=!1,this.setNewFocus(2),this.unlockAllFields(),this.rotationMode!==this.flags.baseRotation&&this.setRotationMode(this.flags.baseRotation),this.compassMode!==this.flags.baseMode&&this.setCompassMode(this.flags.baseMode)}setContext(e,t,r,n,i,o,s){return this.published.flags|=e,4&e&&t&&(this.published.origin.setFrom(t),s&&s.multiplyPoint3d(this.published.origin,this.published.origin)),n&&(this.published.delta.setFrom(n),s&&this.published.delta.scaleInPlace(s.matrix.columnX().magnitude())),"number"===typeof i&&(this.published.distance=i,s&&(this.published.distance*=s.matrix.columnX().magnitude())),"number"===typeof o&&(this.published.angle=o),r&&(32&e||64&e||262144&e?(this.published.vector.setFrom(r),s&&s.matrix.multiplyVectorInPlace(this.published.vector),this.published.vector.normalizeInPlace()):16&e&&(this.published.rMatrix.setFrom(r),s&&(this.published.rMatrix.multiplyMatrixMatrix(s.matrix,this.published.rMatrix),this.published.rMatrix.normalizeColumnsInPlace()))),e&&(this.onEventCommon(),this.flags.haveValidOrigin||this.setDefaultOrigin(this.currentView)),this.isEnabled?0:32768}onEventCommon(){4194304&this.published.flags&&(this.flags.indexLocked=!0,this.flags.redrawCompass=!0),8388608&this.published.flags&&(this.flags.indexLocked=!0,this.flags.contextRotMode=1,this.setRotationMode(6),this.updateRotation(),this.flags.indexLocked=!0)}onPrimitiveToolInstall(){return!!this.isEnabled&&(this.onEventCommon(),this.saveLockedCoords(),this.currentState=2,this.clearContext(),this.alwaysShowCompass&&this.activate(),!1)}onViewToolInstall(){if(!this.isEnabled)return!1;this.onEventCommon();const e=n.IModelApp.toolAdmin.activeTool;return!e||e instanceof d.ViewTool||this.saveState(this.savedStateViewTool),this.currentState=1,!1}onViewToolExit(){return!!this.isEnabled&&(this.onEventCommon(),this.restoreState(this.savedStateViewTool),!1)}onInputCollectorInstall(){if(!this.isEnabled)return!1;this.onEventCommon();const e=n.IModelApp.toolAdmin.activeTool;return!e||e instanceof l.InputCollector||this.saveState(this.savedStateInputCollector),this.currentState=2,!1}onInputCollectorExit(){return!!this.isEnabled&&(this.onEventCommon(),this.restoreState(this.savedStateInputCollector),!1)}saveState(e){e.state=this.currentState,e.mode=this.compassMode,e.rotationMode=this.rotationMode,e.axes.setFrom(this.axes),e.origin.setFrom(this.origin),e.auxRotationPlane=this.flags.auxRotationPlane,e.contextRotMode=this.flags.contextRotMode,e.fixedOrg=this.flags.fixedOrg,e.ignoreDataButton=!0,e.ignoreFlags=0}restoreState(e){0===(4096&e.ignoreFlags)&&(this.currentState=e.state),0===(4&e.ignoreFlags)&&(this.origin.setFrom(e.origin),this.planePt.setFrom(e.origin)),0===(16&e.ignoreFlags)&&(this.axes.setFrom(e.axes),this.setRotationMode(e.rotationMode),this.flags.auxRotationPlane=e.auxRotationPlane,this.flags.contextRotMode=e.contextRotMode),this.flags.fixedOrg=e.fixedOrg,this.setCompassMode(e.mode),this.updateRotation(),e.ignoreDataButton&&(this.flags.ignoreDataButton=!!this.flags.inDataPoint)}getCompassPlanePoint(e,t){return e.setFrom(this.origin),!(!this._fieldLocked[4]||!t.view.is3d()||0===this.delta.z||this.delta.z<p.SMALL_ANGLE&&this.delta.z>-p.SMALL_ANGLE)&&(e.addScaledInPlace(this.axes.z,this.delta.z),!0)}getDisplayTransform(e){const t=this.flags.animateRotation&&0!==this._percentChanged?this.lastAxes.toMatrix3d():this.axes.toMatrix3d(),r=new i.Point3d;this.getCompassPlanePoint(r,e);const n=e.pixelsFromInches(this._compassSizeInches)*e.getPixelSizeAtPoint(r);return t.transposeInPlace(),t.scaleColumns(n,n,n,t),i.Transform.createRefs(r,t)}setIndexingTolerance(e){const t=new i.Point3d;this.getCompassPlanePoint(t,e),this._tolerance=e.pixelsFromInches(this._indexToleranceInches)*e.getPixelSizeAtPoint(t),p.SMALL_ANGLE>this._tolerance&&(this._tolerance=p.SMALL_ANGLE)}displayAlignments(e,t){const r=t.view.backgroundColor,o=this._indexColor.adjustForContrast(r,130),s=new i.Point3d;if(this.getCompassPlanePoint(s,t)){const t=this._frameColor.adjustForContrast(r,155);e.setSymbology(t,t,2),e.addLineString([s,this.origin]),e.setSymbology(t,t,4),e.addPointString([this.origin])}let a=0,c=this._rawPoint;const l=u.TentativeOrAccuSnap.getCurrentSnap();l&&(c=l.snapPoint,a=this.point.distance(c));const d=1===this.compassMode,h=(u.TentativeOrAccuSnap.isHot||n.IModelApp.tentativePoint.isActive)&&(this.locked||a>0);if(h&&d){const t=this.point.vectorTo(this._rawPointOnPlane),r=t.dotProduct(this.axes.x),n=t.dotProduct(this.axes.y),i=Math.abs(r)>1,s=Math.abs(n)>1;if(i)if(s){const t=[this.point,this.point.plusScaled(this.axes.y,n),this._rawPointOnPlane,this.point.plusScaled(this.axes.x,r)];t[4]=t[0],e.setSymbology(o,o,2,3772834016),e.addLineString(t)}else e.setSymbology(o,o,2,3772834016),e.addLineString([this.point,this._rawPointOnPlane]);else s&&(e.setSymbology(o,o,2,3772834016),e.addLineString([this.point,this._rawPointOnPlane]))}const f=!t.view.is3d()||this.flags.pointIsOnPlane||this.isZLocked(t);if(h&&f)if(d){const t=c.distance(this._rawPointOnPlane);(t>p.SMALL_ANGLE||t<-p.SMALL_ANGLE)&&(e.setSymbology(o,o,2,3772834016),e.addLineString([this._rawPointOnPlane,this._rawPoint]))}else e.setSymbology(o,o,2,3772834016),e.addLineString([this.point,this._rawPoint]);h&&(e.setSymbology(o,o,8),e.addPointString([this.point]));let g=!1;if(d?3&this.indexed&&(this.flags.pointIsOnPlane||this._fieldLocked[4])&&(g=!0):(7&this.indexed||7&this.locked)&&(this.flags.pointIsOnPlane||this._fieldLocked[4])&&(g=!0),g&&(e.setSymbology(o,o,4),e.addLineString([this.point,this.planePt])),8&this.indexed){const t=this._tolerance;let r;if(d){let e=3&this.indexed;e||(e=3&this.locked),r=1===e?this.axes.x:this.axes.y}else{const e=this.origin.vectorTo(this.point);(r=this.axes.z.crossProduct(e)).normalizeInPlace()}e.setSymbology(o,o,3),e.addLineString([this.point.plusScaled(r,t),this.point.plusScaled(r,-t)])}if(d&&!g){const t=3&this.locked;if(0!==t&&f){const r=[this.point,this.point,this.point];switch(1&t&&r[2].setFrom(this.planePt.plusScaled(this.axes.x,this.delta.x)),2&t&&r[0].setFrom(this.planePt.plusScaled(this.axes.y,this.delta.y)),t){case 1:e.setSymbology(o,o,2,3772834016),e.addLineString([r[1],r[2]]);break;case 2:e.setSymbology(o,o,2,3772834016),e.addLineString([r[0],r[1]]);break;case 3:e.setSymbology(o,o,2,3772834016),e.addLineString(r)}}}}testDecorationHit(e){return e===this._acsPickId}getDecorationGeometry(e){if(!e.viewport.viewFlags.acsTriad)return;const t=o.IModelJson.Writer.toIModelJson(i.PointString3d.create(e.viewport.view.auxiliaryCoordinateSystem.getOrigin()));return void 0!==t?[t]:void 0}decorate(e){if(e.viewport.viewFlags.acsTriad){e.viewport.view.auxiliaryCoordinateSystem.display(e,9),void 0===this._acsPickId&&(this._acsPickId=e.viewport.iModel.transientIds.next);const t=e.createGraphicBuilder(2,void 0,this._acsPickId),r=c.ColorDef.blue.adjustForContrast(e.viewport.view.backgroundColor,50);t.setSymbology(r,r,6),t.addPointString([e.viewport.view.auxiliaryCoordinateSystem.getOrigin()]),e.addDecorationFromBuilder(t)}if(this.flags.redrawCompass=!1,!this.isActive)return;const t=e.viewport;if(this.currentView!==t)return;this.setIndexingTolerance(t);let r=e.createGraphicBuilder(3);this.displayAlignments(r,t),e.addDecorationFromBuilder(r),r=e.createGraphicBuilder(3,this.getDisplayTransform(t));const n=this.hasInputFocus,o=t.view.backgroundColor,s=(n?this._frameColor:this._frameColorNoFocus).adjustForContrast(o,155),a=(n?this._fillColor:this._fillColorNoFocus).adjustForContrast(o,75),l=(n?this._xColor:this._frameColorNoFocus).adjustForContrast(o,155),u=(n?this._yColor:this._frameColorNoFocus).adjustForContrast(o,155),d=s;r.setSymbology(d,a,1);const h=i.Point3d.createZero();if(this.flags.animateRotation||0===this._percentChanged)if(0===this.compassMode){const e=i.Arc3d.createXYEllipse(h,1,1);r.addArc(e,!0,!0),r.addArc(e,!1,!1)}else{const e=[new i.Point3d(-1,1,0),new i.Point3d(1,1,0),new i.Point3d(1,-1,0),new i.Point3d(-1,-1,0)];e[4]=e[0].clone(),r.addShape(e),r.addLineString(e)}else{let e,t;const n=7,o=24,s=.2;0===this.compassMode?(e=n+Math.floor(o*this._percentChanged),t=1+s-s*this._percentChanged):(e=o-Math.floor(o*this._percentChanged)+n,t=1+s*this._percentChanged);let a=0;const c=2*Math.PI/e,l=[];for(let r=0;r<e;r++,a+=c)l[r]=new i.Point3d(t*Math.cos(a),t*Math.sin(a),0);l[e]=l[0].clone(),r.addShape(l),r.addLineString(l)}if(this._fieldLocked[4]&&this.stickyZLock&&t.view.is3d())if(r.setSymbology(s,a,1),0===this.compassMode){const e=i.Arc3d.createXYEllipse(h,.5,.5);r.addArc(e,!1,!1)}else{const e=[new i.Point3d(-.5,.5,0),new i.Point3d(.5,.5,0),new i.Point3d(.5,-.5,0),new i.Point3d(-.5,-.5,0)];e[4]=e[0].clone(),r.addLineString(e)}r.setSymbology(s,s,8),r.addPointString([h]),r.setSymbology(l,l,4),r.addLineString([new i.Point3d(1.2,0,0),new i.Point3d(.8,0,0)]),r.setSymbology(s,s,1),r.addLineString([new i.Point3d(-1.2,0,0),new i.Point3d(-.8,0,0)]),r.setSymbology(u,u,4),r.addLineString([new i.Point3d(0,1.2,0),new i.Point3d(0,.8,0)]),r.setSymbology(s,s,1),r.addLineString([new i.Point3d(0,-1.2,0),new i.Point3d(0,-.8,0)]),e.addDecorationFromBuilder(r)}checkRotation(){if(this.updateRotation(),4===this.rotationMode||!this.flags.lockedRotation)return;const e=this.currentView;if(!e||e.isCameraOn)return;const t=e.rotation.getRow(2);if(!this.axes.z.isPerpendicularTo(t))return;const r=Math.abs(this.axes.x.dotProduct(t))<Math.abs(this.axes.y.dotProduct(t));switch(this.rotationMode){case 1:this.setRotationMode(r?2:3);break;case 2:this.setRotationMode(r?1:3);break;case 3:this.setRotationMode(r?1:2);break;case 5:switch(this.flags.auxRotationPlane){case 1:this.flags.auxRotationPlane=r?2:3;break;case 2:this.flags.auxRotationPlane=r?1:3;break;case 3:this.flags.auxRotationPlane=r?1:2;break;default:return}break;default:return}this.updateRotation(),this.flags.baseRotation=this.rotationMode}saveLockedCoords(){0===this.compassMode?(this._fieldLocked[0]&&this.saveCoordinate(0,this._distance),this._fieldLocked[1]&&this.saveCoordinate(1,this._angle)):(this._fieldLocked[2]&&this.saveCoordinate(2,this.delta.x),this._fieldLocked[3]&&this.saveCoordinate(3,this.delta.y));const e=this.currentView;e&&e.view.is3d()&&this._fieldLocked[4]&&this.saveCoordinate(4,this.delta.z)}onCompassModeChange(){}onRotationModeChange(){}onFieldLockChange(e){}onFieldValueChange(e){}get hasInputFocus(){return!0}setFocusItem(e){}static getMinPolarMag(e){return 1e-12*(1+e.magnitude())}constructionPlane(e,t,r,n,o,a){let c,l,u,d=new i.Vector3d;if(a)if(AccuDraw.useACSContextRotation(o,!0)){const i=o.getAuxCoordRotation(AccuDraw._tempRot),a=ThreeAxes.createFromMatrix3d(i);this.accountForAuxRotationPlane(a,this.flags.auxRotationPlane),s.linePlaneIntersect(e,t,a.z,r,n,!1)}else u=(d=t.vectorTo(r)).dotProduct(n),t.plusScaled(n,u,e);else{const i=o.isCameraOn;if(o.view.is3d()&&i){(c=o.view.getEyePoint()).vectorTo(t,d).normalizeInPlace()}else{c=t,o.rotation.getRow(2,d)}if(l=d.dotProduct(n),Math.abs(l)<p.SMALL_DELTA)return 32768;if(u=(n.dotProduct(r)-n.dotProduct(c))/l,i&&u<p.SMALL_DELTA)return 32768;c.plusScaled(d,u,e)}return 0}softConstructionPlane(e,t,r,n,i,o){if(!i.isPointAdjustmentRequired)return e.setFrom(t),!0;if(o){e.setFrom(t);const i=r.vectorTo(e);return Math.abs(n.dotProduct(i))<p.SMALL_DELTA}if(0!==this.constructionPlane(e,t,r,n,i,!1)){const o=i.rotation.getRow(2);return this.constructionPlane(e,t,r,o,i,!1),this.constructionPlane(e,e,r,n,i,!0),!1}return!0}hardConstructionPlane(e,t,r,n,i,o){if(!i.isPointAdjustmentRequired)return e.setFrom(t),!0;if(0!==this.constructionPlane(e,t,r,n,i,o)){const o=i.rotation.getRow(2);this.constructionPlane(e,t,r,o,i,!1),this.constructionPlane(e,e,r,n,i,!0)}return!0}static allowAxisIndexing(e){if(!u.TentativeOrAccuSnap.isHot)return!0;if(!e)return!1;const t=n.IModelApp.accuSnap.getCurrSnapDetail();return void 0!==t&&1===t.snapMode}applyDistanceRoundOff(e,t){if(!this._distanceRoundOff.active||!this._distanceRoundOff.units.size)return;let r=this._distanceRoundOff.units.values().next().value;if(this._distanceRoundOff.units.size>1){if(this._distanceRoundOff.units.forEach(e=>{e<r&&(r=e)}),t.viewDelta.magnitudeXY()<r)return;const e=.0787402,n=t.getPixelSizeAtPoint(this.origin),i=t.pixelsFromInches(e)*n;this._distanceRoundOff.units.forEach(e=>{e>r&&e<i&&(r=e)})}return r<=0?void 0:r*Math.floor(e/r+.5)}applyAngleRoundOff(e,t,r){if(!this._angleRoundOff.active||!this._angleRoundOff.units.size)return;let n=this._angleRoundOff.units.values().next().value;if(this._angleRoundOff.units.size>1){this._angleRoundOff.units.forEach(e=>{e<n&&(n=e)});const e=2*Math.PI*t,i=e/(2*Math.PI/n);if(r.viewDelta.magnitudeXY()<i)return;const o=.0787402,s=r.getPixelSizeAtPoint(this.origin),a=r.pixelsFromInches(o)*s;this._angleRoundOff.units.forEach(t=>{const r=e/(2*Math.PI/t);t>n&&r<a&&(n=t)})}return n<=0?void 0:n*Math.floor(e/n+.5)}fixPointPolar(e){let t=!1,r=!1;const n=this.isZLocked(e),o=new i.Point3d;if(this.planePt.setFrom(this.origin),!n||this.delta.z<p.SMALL_ANGLE&&this.delta.z>-p.SMALL_ANGLE||this.planePt.addScaledInPlace(this.axes.z,this.delta.z),4&this.locked)if(u.TentativeOrAccuSnap.isHot)this._rawPointOnPlane.setFrom(this._rawPoint),this.flags.pointIsOnPlane=!1;else{const t=new i.Vector3d;this.planeByVectorAndView(t,this.vector,e),this.softConstructionPlane(this._rawPointOnPlane,this._rawPoint,this.planePt,t,e,!1)}else n?(this.hardConstructionPlane(this._rawPointOnPlane,this._rawPoint,this.planePt,this.axes.z,e,u.TentativeOrAccuSnap.isHot),this.flags.pointIsOnPlane=!0):this.flags.pointIsOnPlane=this.softConstructionPlane(this._rawPointOnPlane,this._rawPoint,this.planePt,this.axes.z,e,u.TentativeOrAccuSnap.isHot)||!!(3&this.locked);let s;s=n?this.planePt.vectorTo(this._rawPointOnPlane):this.origin.vectorTo(this._rawPointOnPlane);const a=AccuDraw.getMinPolarMag(this.origin);let c;if(4&this.locked){if(c=s.dotProduct(this.vector),o.x-=s.x-c*this.vector.x,o.y-=s.y-c*this.vector.y,o.z-=s.z-c*this.vector.z,this.vector.scale(c,s),c<0&&(c=-c),c<a)return void this.handleDegeneratePolarCase();this.flags.pointIsOnPlane=Math.abs(this.axes.z.dotProduct(s))<p.SMALL_DELTA}else if((c=s.magnitude())<a)return void this.handleDegeneratePolarCase();const l=this._rawPointOnPlane.plus(o);o.setZero();const d=new i.Point3d;if(d.x=this.axes.x.dotProduct(s),d.y=this.axes.y.dotProduct(s),this._angle=Math.atan2(d.y,d.x),this.flags.pointIsOnPlane&&!(4&this.locked)){if(!u.TentativeOrAccuSnap.isHot){const r=this.applyAngleRoundOff(this._angle,c,e);void 0!==r&&(t=!0,this._angle=r,o.x+=Math.cos(this._angle)*c-d.x,o.y+=Math.sin(this._angle)*c-d.y,d.x=Math.cos(this._angle)*c,d.y=Math.sin(this._angle)*c)}if((1&this.locked||AccuDraw.allowAxisIndexing(this.flags.pointIsOnPlane)&&d.x<this._tolerance&&d.x>-this._tolerance&&!this.flags.indexLocked&&this.axisIndexing)&&(this.indexed|=1,o.x-=d.x,d.x=0,u.TentativeOrAccuSnap.isHot&&(o.z-=s.dotProduct(this.axes.z)),this._angle=d.y<0?-Math.PI/2:Math.PI/2,t=!0),2&this.locked||AccuDraw.allowAxisIndexing(this.flags.pointIsOnPlane)&&d.y<this._tolerance&&d.y>-this._tolerance&&!this.flags.indexLocked&&this.axisIndexing){if(1&this.indexed)return void this.handleDegeneratePolarCase();this.indexed|=2,o.y-=d.y,u.TentativeOrAccuSnap.isHot&&(o.z-=s.dotProduct(this.axes.z)),d.y=0,this._angle=d.x<0?Math.PI:0,t=!0}if(t&&(this.axes.x.scale(d.x,s),s.addScaledInPlace(this.axes.y,d.y),(c=s.magnitude())<a))return void this.handleDegeneratePolarCase()}const h=c;if(8&this.locked)c=this._distance,r=!0,this.indexed&=-9;else if(!u.TentativeOrAccuSnap.isHot){const t=this.applyDistanceRoundOff(c,e);void 0!==t&&(r=!0,c=t),i.Geometry.isDistanceWithinTol(c-this._lastDistance,this._tolerance)&&!this.flags.indexLocked&&this.distanceIndexing&&(this.indexed|=8,c=this._lastDistance,r=!0)}if(l.plus3Scaled(this.axes.x,o.x,this.axes.y,o.y,this.axes.z,o.z,l),u.TentativeOrAccuSnap.isHot&&this.flags.pointIsOnPlane&&(Math.abs(d.x)<p.SMALL_ANGLE?this.indexed|=1:Math.abs(d.y)<p.SMALL_ANGLE&&(this.indexed|=2)),r){if(c<a&&c>-a)return void this.handleDegeneratePolarCase();l.addScaledInPlace(s,c/h-1),s.scaleInPlace(c/h)}this.point.setFrom(l),this._distance=c,4&this.locked||s.scale(1/c,this.vector),3&this.locked&&(this.indexed|=this.locked),n||(this.delta.z=this.flags.pointIsOnPlane?0:s.dotProduct(this.axes.z))}fixPointRectangular(e){const t=this.isZLocked(e),r=new i.Vector3d;this.planePt.setFrom(this.origin),this.indexed=0,t?(this.flags.pointIsOnPlane=this.delta.z<p.SMALL_ANGLE&&this.delta.z>-p.SMALL_ANGLE,this.flags.pointIsOnPlane||this.planePt.addScaledInPlace(this.axes.z,this.delta.z),this.hardConstructionPlane(this._rawPointOnPlane,this._rawPoint,this.planePt,this.axes.z,e,u.TentativeOrAccuSnap.isHot)):this.flags.pointIsOnPlane=this.softConstructionPlane(this._rawPointOnPlane,this._rawPoint,this.origin,this.axes.z,e,u.TentativeOrAccuSnap.isHot);const n=this.origin.vectorTo(this._rawPointOnPlane);if(this._rawDelta.x=n.dotProduct(this.axes.x),this._xIsNegative=this._rawDelta.x<-p.SMALL_ANGLE,this._rawDelta.y=n.dotProduct(this.axes.y),this._yIsNegative=this._rawDelta.y<-p.SMALL_ANGLE,t||(this.delta.z=this.flags.pointIsOnPlane?0:n.dotProduct(this.axes.z)),AccuDraw.allowAxisIndexing(this.flags.pointIsOnPlane)){if(!(1&this.locked)){const t=this.applyDistanceRoundOff(this._rawDelta.x,e);void 0!==t&&(r.x=t-this._rawDelta.x,this._rawDelta.x=t),this._rawDelta.x<this._tolerance&&this._rawDelta.x>-this._tolerance&&!this.flags.indexLocked&&this.axisIndexing&&(this.indexed|=1,r.x-=this._rawDelta.x,this._rawDelta.x=0)}if(!(2&this.locked)){const t=this.applyDistanceRoundOff(this._rawDelta.y,e);void 0!==t&&(r.y=t-this._rawDelta.y,this._rawDelta.y=t),this._rawDelta.y<this._tolerance&&this._rawDelta.y>-this._tolerance&&!this.flags.indexLocked&&this.axisIndexing&&(this.indexed|=2,r.y-=this._rawDelta.y,this._rawDelta.y=0)}}if(1&this.locked)this.rawDeltaIsValid(this._rawDelta.x)&&this.delta.x<-p.SMALL_ANGLE!==this._xIsNegative&&this.smartKeyin&&this._keyinStatus[2]===h.Partial&&!this._xIsExplicit&&(this.delta.x=-this.delta.x),r.x=this.delta.x-this._rawDelta.x;else{const e=this._rawDelta.x<0?-this._lastDistance:this._lastDistance;u.TentativeOrAccuSnap.isHot||!(2&this.locked||2&this.indexed)||1&this.indexed||!i.Geometry.isDistanceWithinTol(this._rawDelta.x-e,this._tolerance)||this.flags.indexLocked||!this.distanceIndexing?this.delta.x=this._rawDelta.x:(r.x+=e-this._rawDelta.x,this.delta.x=e,this.indexed|=8)}if(2&this.locked)this.rawDeltaIsValid(this._rawDelta.y)&&this.delta.y<-p.SMALL_ANGLE!==this._yIsNegative&&this.smartKeyin&&this._keyinStatus[3]===h.Partial&&!this._yIsExplicit&&(this.delta.y=-this.delta.y),r.y=this.delta.y-this._rawDelta.y;else{const e=this._rawDelta.y<p.SMALL_ANGLE?-this._lastDistance:this._lastDistance;u.TentativeOrAccuSnap.isHot||!(1&this.locked||1&this.indexed)||2&this.indexed||!i.Geometry.isDistanceWithinTol(this._rawDelta.y-e,this._tolerance)||this.flags.indexLocked||!this.distanceIndexing?this.delta.y=this._rawDelta.y:(r.y+=e-this._rawDelta.y,this.delta.y=e,this.indexed|=8)}this._rawPointOnPlane.plus2Scaled(this.axes.x,r.x,this.axes.y,r.y,this.point),t&&!this.flags.pointIsOnPlane&&this.hardConstructionPlane(this.point,this.point,this.planePt,this.axes.z,e,u.TentativeOrAccuSnap.isHot),1&this.locked&&0===this.delta.x||2&this.locked&&0===this.delta.y?this.indexed|=this.locked:u.TentativeOrAccuSnap.isHot&&(Math.abs(this.delta.x)<p.SMALL_ANGLE?this.indexed|=1:Math.abs(this.delta.y)<p.SMALL_ANGLE&&(this.indexed|=2));const o=3&this.locked,s=3&this.indexed;if(2===o&&1!==s){if(this._keyinStatus[3]!==h.Dynamic&&Math.abs(this._rawDelta.x)<this._threshold)return;this.newFocus=2,this.dontMoveFocus=!1}else if(1===o&&2!==s){if(this._keyinStatus[2]!==h.Dynamic&&Math.abs(this._rawDelta.y)<this._threshold)return;this.newFocus=3,this.dontMoveFocus=!1}else this.newFocus=Math.abs(this._rawDelta.x)>Math.abs(this._rawDelta.y)?2:3}fixPoint(e,t){if(this.isActive&&(t!==this.currentView||this.flags.rotationNeedsUpdate)&&(this.currentView=t,7&this.locked||this._fieldLocked[4]||(this.flags.haveValidOrigin||this.setDefaultOrigin(t),this.flags.lockedRotation||(this.updateRotation(),this.flags.rotationNeedsUpdate=!1))),this.isInactive||this.isDeactivated)return this.point.setFrom(e),this.currentView=t,void this.processHints();this.isActive?(this._rawPoint.setFrom(e),this.currentView=t,this.flags.dialogNeedsUpdate=!0,u.TentativeOrAccuSnap.isHot&&0===this.compassMode?this.indexed=this.locked:this.indexed=0,0===this.compassMode?this.fixPointPolar(t):this.fixPointRectangular(t),e.setFrom(this.point)):1===this.compassMode&&(this._fieldLocked[2]&&(e.x=this.delta.x),this._fieldLocked[3]&&(e.y=this.delta.y),this._fieldLocked[4]&&(e.z=this.delta.z))}refreshDecorationsAndDynamics(){this.flags.inDataPoint||this.processHints(),void 0!==this.currentView&&this.currentView.invalidateDecorations(),n.IModelApp.toolAdmin.updateDynamics(void 0,void 0,!0)}upgradeToActiveState(){if(!this.isEnabled)return!1;if(this.onEventCommon(),!this.isInactive)return!1;const e=this.currentView;if(!e)return!1;if(e&&AccuDraw.useACSContextRotation(e,!1)&&(this.setRotationMode(5),this.flags.baseRotation=5,this.flags.auxRotationPlane=1),16777216&this.published.flags){const t=u.TentativeOrAccuSnap.getCurrentSnap(!1);if(void 0!==t){const r=AccuDraw.getSnapRotation(t,e);void 0!==r&&(this.setContextRotation(r,!0,!1),this.changeBaseRotationMode(6))}}return this.checkRotation(),this.flags.haveValidOrigin||this.setDefaultOrigin(e),this._rawPoint.setFrom(this.point),this._rawPointOnPlane.setFrom(this.point),this.currentState=3,!1}downgradeInactiveState(){return!!this.isEnabled&&(this.onEventCommon(),!!this.isActive&&(this.currentState=2,!1))}onBeginDynamics(){return this.upgradeToActiveState()}onEndDynamics(){return this.downgradeInactiveState()}onMotion(e){}onPreButtonEvent(e){return 1!==e.button||e.isDown||e.isDragging?!(0!==e.button||!e.isDown||!this.isEnabled)&&(this.onEventCommon(),this.flags.inDataPoint=!0,!(this.currentState<2)&&(this.currentView||(this.currentView=e.viewport),this.updateRotation(),!1)):n.IModelApp.tentativePoint.isActive&&this.isActive?(n.IModelApp.tentativePoint.clear(!0),this.refreshDecorationsAndDynamics(),!0):(this.isEnabled&&this.onEventCommon(),!1)}onPostButtonEvent(e){return!(0!==e.button||!e.isDown||!this.isEnabled)&&(this.onEventCommon(),this.flags.ignoreDataButton?this.flags.ignoreDataButton=!1:!this.flags.fixedOrg&&this.currentState>=2&&((this.contextSensitive||2097152&this.published.flags)&&4&this.published.flags||(this.published.flags|=4,this.currentState>=2?this.published.origin.setFrom(e.point):this.published.origin.setFrom(this.point)),this.saveLockedCoords(),this.processHints(),this.currentState>=2&&this.updateRotation()),this.flags.inDataPoint=!1,this.flags.indexLocked=!1,!1)}onTentative(){return(this.isActive||this.isInactive)&&this.grabInputFocus(),!1}intersectXYCurve(e,t,r){if(void 0===this.currentView)return;const n=e.getCurvePrimitive();if(void 0===n)return;const o=this.currentView.worldToViewMap.transform0,s=i.CurveCurve.IntersectionProjectedXY(o,r?n:t,!0,r?t:n,!0);if(0===s.dataA.length)return;let a=0;if(s.dataA.length>1){const t=o.multiplyPoint3d(e.getPoint(),1);let r;for(let e=0;e<s.dataA.length;e++){const n=o.multiplyPoint3d(s.dataA[e].point,1),i=t.realDistanceXY(n);void 0!==i&&(void 0===r||i<r)&&(r=i,a=e)}}e.setSnapPoint(s.dataA[a].point,1)}intersectLine(e,t,r){const n=i.Vector3d.createStartEnd(t,e.getPoint()),o=t.plusScaled(r,n.dotProduct(r)),s=i.LineSegment3d.create(t,o);this.intersectXYCurve(e,s,!0)}intersectCircle(e,t,r,n){const o=i.Matrix3d.createRigidHeadsUp(r),s=o.columnX(),a=o.columnY();s.scaleToLength(n,s),a.scaleToLength(n,a);const c=i.Arc3d.create(t,s,a);this.intersectXYCurve(e,c,!1)}onSnap(e){if(!this.isActive||!this.locked)return!1;if(1!==e.snapMode)return!1;if(!e.primitive)return!1;switch(this.locked){case 4:this.intersectLine(e,this.origin,this.vector);break;case 1:{const t=1===this.compassMode?this.planePt.plusScaled(this.axes.x,this.delta.x):this.origin;this.intersectLine(e,t,this.axes.y);break}case 2:{const t=1===this.compassMode?this.planePt.plusScaled(this.axes.y,this.delta.y):this.origin;this.intersectLine(e,t,this.axes.x);break}case 8:this.intersectCircle(e,this.origin,this.axes.z,this._distance)}return!1}onSelectedViewportChanged(e,t){void 0!==this.currentView&&this.currentView===e&&(this.currentView=t),void 0!==t&&void 0!==e&&t.view.classFullName===e.view.classFullName&&t.view.iModel===e.view.iModel||(this.currentView=void 0,this.flags.redrawCompass=!1,this.flags.baseRotation=4,this.flags.auxRotationPlane=1,this.flags.rotationNeedsUpdate=!0,this.flags.haveValidOrigin=!1,this.flags.indexLocked=!1,this.flags.bearingFixToPlane2D=!1,this.setRotationMode(4),this.updateRotation(),this.saveState(this.savedStateViewTool),this.saveState(this.savedStateInputCollector))}doProcessHints(){if(!this.floatingOrigin)return void(4&this.published.flags&&this.unlockAllFields());if(4&this.published.flags&&(this.floatingOrigin&&(this.origin.setFrom(this.published.origin),this.point.setFrom(this.origin),this.planePt.setFrom(this.origin)),this.flags.haveValidOrigin=!0,this.setLastPoint(this.origin),this.unlockAllFields(),this.updateRotation()),!this.contextSensitive)return;3&this.published.flags&&this.compassMode!==(1&this.published.flags?0:1)&&this.changeCompassMode(),8&this.published.flags&&(this.flags.fixedOrg=!0),384&this.published.flags&&this.saveCoordinate(0,this.published.distance);const e=this.currentView;switch(16&this.published.flags?(this.axes.fromMatrix3d(this.published.rMatrix),this.flags.lockedRotation=!0,this.flags.contextRotMode=0,this.setRotationMode(6),this.updateRotation()):32&this.published.flags?(this.axes.x.setFrom(this.published.vector),this.flags.contextRotMode=1,this.setRotationMode(6),this.updateRotation()):262144&this.published.flags?(this.axes.x.setFrom(this.published.vector),this.flags.contextRotMode=4,this.setRotationMode(6),this.updateRotation()):64&this.published.flags?e&&e.view.is3d()&&(this.axes.z.setFrom(this.published.vector),this.flags.contextRotMode=3,this.setRotationMode(6),this.updateRotation()):131072&this.published.flags?(this.flags.lockedRotation=!0,this.flags.baseRotation=5,this.setRotationMode(5),this.updateRotation()):(this.isInactive||16384&this.published.flags)&&(this.setRotationMode(this.flags.baseRotation),this.updateRotation()),this.compassMode){case 0:256&this.published.flags&&(this._distance=this.published.distance,this.distanceLock(!0,!0)),524288&this.published.flags&&(this.updateVector(this.published.angle),this.indexed=0,this.angleLock(),this.saveCoordinate(1,this.published.angle));break;case 1:512&this.published.flags&&(this.locked|=1,this.delta.x=this.published.delta.x,this.setFieldLock(2,!0),this.saveCoordinate(2,this.published.delta.x)),1024&this.published.flags&&(this.locked|=2,this.delta.y=this.published.delta.y,this.setFieldLock(3,!0),this.saveCoordinate(3,this.published.delta.y)),2048&this.published.flags&&e&&e.view.is3d()&&(this.delta.z=this.published.delta.z,this.setFieldLock(4,!0),this.saveCoordinate(4,this.published.delta.z))}}processHints(){if(!this.published.flags||!this.isEnabled)return;if(4096&this.published.flags)return this.published.flags=0,void(this.currentState=1);const e=!!(32768&this.published.flags);this.doProcessHints(),this.published.zero(),(this.isEnabled||e)&&this.grabInputFocus()}}AccuDraw._tempRot=new i.Matrix3d,t.AccuDraw=AccuDraw;t.AccuDrawHintBuilder=class AccuDrawHintBuilder{constructor(){this._flagOrigin=!1,this._flagNormal=!1,this._flagRotation=!1,this._flagXAxis=!1,this._flagXAxis2=!1,this._flagDistance=!1,this._flagAngle=!1,this._flagModePolar=!1,this._flagModeRectangular=!1,this._distance=0,this._angle=0,this.setOriginFixed=!1,this.setOriginAlways=!1,this.setLockDistance=!1,this.setLockAngle=!1,this.setLockX=!1,this.setLockY=!1,this.setLockZ=!1,this.enableSmartRotation=!1}setOrigin(e){this._origin=e.clone(),this._flagOrigin=!0}setRotation(e){this._rMatrix=e.clone(),this._flagRotation=!0,this._flagXAxis=this._flagNormal=!1}setXAxis(e){this._axis=e.clone(),this._flagXAxis=!0,this._flagRotation=this._flagNormal=this._flagXAxis2=!1}setXAxis2(e){this._axis=e.clone(),this._flagXAxis2=!0,this._flagRotation=this._flagNormal=this._flagXAxis=!1}setNormal(e){this._axis=e.clone(),this._flagNormal=!0,this._flagRotation=this._flagXAxis=this._flagXAxis2=!1}setModePolar(){this._flagModePolar=!0,this._flagModeRectangular=!1}setModeRectangular(){this._flagModeRectangular=!0,this._flagModePolar=!1}setDistance(e){this._distance=e,this._flagDistance=!0}setAngle(e){this._angle=e,this._flagAngle=!0}sendHints(e=!0){let t=0;this._flagOrigin&&(t|=4),this.setOriginFixed&&(t|=8),this.setOriginAlways&&(t|=2097156),this._flagRotation&&(t|=16),this._flagXAxis&&(t|=32),this._flagXAxis2&&(t|=262144),this._flagNormal&&(t|=64),this._flagModePolar&&(t|=1),this._flagModeRectangular&&(t|=2),this.setLockDistance&&(t|=256),this.setLockAngle&&(t|=524288),this.setLockX&&(t|=512),this.setLockY&&(t|=1024),this.setLockZ&&(t|=2048),this.enableSmartRotation&&(t|=16777216);const r=n.IModelApp.accuDraw;return 0===r.setContext(t,this._origin,this._flagRotation?this._rMatrix:this._axis,void 0,this._flagDistance?this._distance:void 0,this._flagAngle?this._angle:void 0)&&(e&&r.activate(),!0)}}},function(e,t,r){"use strict";function n(e){return e}function i(e,t,r){let n=0,i=t.length;for(;n<i;){const o=Math.floor((n+i)/2),s=r(e,t[o]);if(0===s)return{index:o,equal:!0};s<0?i=o:n=o+1}return{index:n,equal:!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.defaultClone=n,t.lowerBound=i;t.SortedArray=class SortedArray{constructor(e,t=!1,r=n){this._array=[],this._compare=e,this._clone=r,this._allowDuplicates=t}get length(){return this._array.length}clear(){this._array=[]}extractArray(){const e=this._array;return this.clear(),e}insert(e,t){const r=this.lowerBound(e);return r.equal&&!this._allowDuplicates||this._array.splice(r.index,0,this._clone(e)),void 0!==t&&t(e),r.index}indexOf(e){const t=this.lowerBound(e);return t.equal?t.index:-1}findEqual(e){const t=this.indexOf(e);return-1!==t?this._array[t]:void 0}get(e){return e<this.length?this._array[e]:void 0}lowerBound(e){return i(e,this._array,this._compare)}}},function(e,t,r){"use strict";var n=r(122).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!==typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=h,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!==(192&t[0]))return e.lastNeed=0,"\ufffd";if(e.lastNeed>1&&t.length>1){if(128!==(192&t[1]))return e.lastNeed=1,"\ufffd";if(e.lastNeed>2&&t.length>2&&128!==(192&t[2]))return e.lastNeed=2,"\ufffd"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=s(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,r){"use strict";var n=r(432),i=r(433);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=_,t.resolve=function(e,t){return _(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?_(e,!1,!0).resolveObject(t):t},t.format=function(e){i.isString(e)&&(e=_(e));return e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(l),d=["%","/","?",";","#"].concat(u),h=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=r(434);function _(e,t,r){if(e&&i.isObject(e)&&e instanceof o)return e;var n=new o;return n.parse(e,t,r),n}o.prototype.parse=function(e,t,r){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",l=e.split(a);l[0]=l[0].replace(/\\/g,"/");var _=e=l.join(a);if(_=_.trim(),!r&&1===e.split("#").length){var w=c.exec(_);if(w)return this.path=_,this.href=_,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var S=s.exec(_);if(S){var b=(S=S[0]).toLowerCase();this.protocol=b,_=_.substr(S.length)}if(r||S||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var x="//"===_.substr(0,2);!x||S&&m[S]||(_=_.substr(2),this.slashes=!0)}if(!m[S]&&(x||S&&!y[S])){for(var P,C,T=-1,M=0;M<h.length;M++){-1!==(E=_.indexOf(h[M]))&&(-1===T||E<T)&&(T=E)}-1!==(C=-1===T?_.lastIndexOf("@"):_.lastIndexOf("@",T))&&(P=_.slice(0,C),_=_.slice(C+1),this.auth=decodeURIComponent(P)),T=-1;for(M=0;M<d.length;M++){var E;-1!==(E=_.indexOf(d[M]))&&(-1===T||E<T)&&(T=E)}-1===T&&(T=_.length),this.host=_.slice(0,T),_=_.slice(T),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var A=this.hostname.split(/\./),R=(M=0,A.length);M<R;M++){var O=A[M];if(O&&!O.match(p)){for(var D="",k=0,F=O.length;k<F;k++)O.charCodeAt(k)>127?D+="x":D+=O[k];if(!D.match(p)){var N=A.slice(0,M),L=A.slice(M+1),B=O.match(f);B&&(N.push(B[1]),L.unshift(B[2])),L.length&&(_="/"+L.join(".")+_),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=n.toASCII(this.hostname));var V=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+V,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!g[b])for(M=0,R=u.length;M<R;M++){var z=u[M];if(-1!==_.indexOf(z)){var j=encodeURIComponent(z);j===z&&(j=escape(z)),_=_.split(z).join(j)}}var G=_.indexOf("#");-1!==G&&(this.hash=_.substr(G),_=_.slice(0,G));var H=_.indexOf("?");if(-1!==H?(this.search=_.substr(H),this.query=_.substr(H+1),t&&(this.query=v.parse(this.query)),_=_.slice(0,H)):t&&(this.search="",this.query={}),_&&(this.pathname=_),y[b]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){V=this.pathname||"";var q=this.search||"";this.path=V+q}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=v.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(e){return this.resolveObject(_(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var r=new o,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var c=Object.keys(e),l=0;l<c.length;l++){var u=c[l];"protocol"!==u&&(r[u]=e[u])}return y[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!y[e.protocol]){for(var d=Object.keys(e),h=0;h<d.length;h++){var p=d[h];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||m[e.protocol])r.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var g=r.pathname||"",v=r.search||"";r.path=g+v}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),S=w||_||r.host&&e.pathname,b=S,x=r.pathname&&r.pathname.split("/")||[],P=(f=e.pathname&&e.pathname.split("/")||[],r.protocol&&!y[r.protocol]);if(P&&(r.hostname="",r.port=null,r.host&&(""===x[0]?x[0]=r.host:x.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),S=S&&(""===f[0]||""===x[0])),w)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,x=f;else if(f.length)x||(x=[]),x.pop(),x=x.concat(f),r.search=e.search,r.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(P)r.hostname=r.host=x.shift(),(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift());return r.search=e.search,r.query=e.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!x.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var C=x.slice(-1)[0],T=(r.host||e.host||x.length>1)&&("."===C||".."===C)||""===C,M=0,E=x.length;E>=0;E--)"."===(C=x[E])?x.splice(E,1):".."===C?(x.splice(E,1),M++):M&&(x.splice(E,1),M--);if(!S&&!b)for(;M--;M)x.unshift("..");!S||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),T&&"/"!==x.join("/").substr(-1)&&x.push("");var I,A=""===x[0]||x[0]&&"/"===x[0].charAt(0);P&&(r.hostname=r.host=A?"":x.length?x.shift():"",(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift()));return(S=S||r.host&&x.length)&&!A&&x.unshift(""),x.length?r.pathname=x.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IndexedXYZCollection=class IndexedXYZCollection{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(13),o=r(22),s=r(83);class AbstractNewtonIterator{constructor(e=1e-11,t=2,r=15){this._numAccepted=0,this.numIterations=0,this._stepSizeTolerance=e,this._successiveConvergenceTarget=t,this._maxIterations=r}testConvergence(e){return Math.abs(e)<this._stepSizeTolerance?(this._numAccepted++,this._numAccepted>=this._successiveConvergenceTarget):(this._numAccepted=0,!1)}runIterations(){for(this._numAccepted=0,this.numIterations=0;this.numIterations++<this._maxIterations&&this.computeStep();){if(this.testConvergence(this.currentStepSize())&&this.applyCurrentStep(!0))return!0;this.applyCurrentStep(!1)}return!1}}t.AbstractNewtonIterator=AbstractNewtonIterator;t.NewtonEvaluatorRtoRD=class NewtonEvaluatorRtoRD{};t.Newton1dUnbounded=class Newton1dUnbounded extends AbstractNewtonIterator{constructor(e){super(),this._func=e,this.setTarget(0)}setX(e){return this._currentX=e,!0}getX(){return this._currentX}setTarget(e){this._target=e}applyCurrentStep(){return this.setX(this._currentX-this._currentStep)}computeStep(){if(this._func.evaluate(this._currentX)){const e=n.Geometry.conditionalDivideFraction(this._func.currentF-this._target,this._func.currentdFdX);if(void 0!==e)return this._currentStep=e,!0}return!1}currentStepSize(){return Math.abs(this._currentStep/(1+Math.abs(this._currentX)))}};t.NewtonEvaluatorRtoR=class NewtonEvaluatorRtoR{};t.Newton1dUnboundedApproximateDerivative=class Newton1dUnboundedApproximateDerivative extends AbstractNewtonIterator{constructor(e){super(),this._func=e,this.derivativeH=1e-8}setX(e){return this._currentX=e,!0}getX(){return this._currentX}applyCurrentStep(){return this.setX(this._currentX-this._currentStep)}computeStep(){if(this._func.evaluate(this._currentX)){const e=this._func.currentF;if(this._func.evaluate(this._currentX+this.derivativeH)){const t=this._func.currentF,r=n.Geometry.conditionalDivideFraction(e,(t-e)/this.derivativeH);if(void 0!==r)return this._currentStep=r,!0}}return!1}currentStepSize(){return Math.abs(this._currentStep/(1+Math.abs(this._currentX)))}};t.NewtonEvaluatorRRtoRRD=class NewtonEvaluatorRRtoRRD{constructor(){this.currentF=o.Plane3dByOriginAndVectors.createXYPlane()}};t.Newton2dUnboundedWithDerivative=class Newton2dUnboundedWithDerivative extends AbstractNewtonIterator{constructor(e){super(),this._func=e,this._currentStep=i.Vector2d.createZero(),this._currentUV=i.Point2d.createZero()}setUV(e,t){return this._currentUV.set(e,t),!0}getU(){return this._currentUV.x}getV(){return this._currentUV.y}applyCurrentStep(){return this.setUV(this._currentUV.x-this._currentStep.x,this._currentUV.y-this._currentStep.y)}computeStep(){if(this._func.evaluate(this._currentUV.x,this._currentUV.y)){const e=this._func.currentF;if(s.SmallSystem.linearSystem2d(e.vectorU.x,e.vectorV.x,e.vectorU.y,e.vectorV.y,e.origin.x,e.origin.y,this._currentStep))return!0}return!1}currentStepSize(){return n.Geometry.maxAbsXY(this._currentStep.x/(1+Math.abs(this._currentUV.x)),this._currentStep.y/(1+Math.abs(this._currentUV.y)))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class Quadrature{static mapWeights(e,t,r,n,i,o){const s=r.length;for(let a=0;a<s;a++)i[a]=e+t*r[a],o[a]=t*n[a];return s}static setupGauss1(e,t,r,n){return Quadrature.mapWeights(e,t-e,Quadrature.gaussX1Interval01,Quadrature.gaussW1Interval01,r,n)}static setupGauss2(e,t,r,n){return Quadrature.mapWeights(e,t-e,Quadrature.gaussX2Interval01,Quadrature.gaussW2Interval01,r,n)}static setupGauss3(e,t,r,n){return Quadrature.mapWeights(e,t-e,Quadrature.gaussX3Interval01,Quadrature.gaussW3Interval01,r,n)}static setupGauss5(e,t,r,n){return Quadrature.mapWeights(e,t-e,Quadrature.gaussX5Interval01,Quadrature.gaussW5Interval01,r,n)}static setupGauss4(e,t,r,n){return Quadrature.mapWeights(e,t-e,Quadrature.gaussX4Interval01,Quadrature.gaussW4Interval01,r,n)}static sum1(e,t,r,n){let i=0;for(let o=0;o<r;o++)i+=t[o]*n(e[o]);return i}}Quadrature.gaussX1Interval01=new Float64Array([.5]),Quadrature.gaussW1Interval01=new Float64Array([1]),Quadrature.gaussX2Interval01=new Float64Array([.21132486540518708,.7886751345948129]),Quadrature.gaussW2Interval01=new Float64Array([.5,.5]),Quadrature.gaussX3Interval01=new Float64Array([.1127016653792583,.5,.8872983346207417]),Quadrature.gaussW3Interval01=new Float64Array([.2777777777777778,.4444444444444444,.2777777777777778]),Quadrature.gaussX4Interval01=new Float64Array([.06943184420297371,.33000947820757187,.6699905217924281,.9305681557970262]),Quadrature.gaussW4Interval01=new Float64Array([.17392742256872692,.3260725774312731,.3260725774312731,.17392742256872692]),Quadrature.gaussX5Interval01=new Float64Array([.04691007703066802,.23076534494715845,.5,.7692346550528415,.9530899229693319]),Quadrature.gaussW5Interval01=new Float64Array([.11846344252809454,.23931433524968324,.28444444444444444,.23931433524968324,.11846344252809454]),t.Quadrature=Quadrature},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(19),o=r(257),s=r(5),a=r(37),c=r(83),l=r(126);class ClipPlane{constructor(e,t,r,n){this._invisible=r,this._interior=n,this._inwardNormal=e,this._distanceFromOrigin=t}isAlmostEqual(e){return s.Geometry.isSameCoordinate(this._distanceFromOrigin,e._distanceFromOrigin)&&this._inwardNormal.isAlmostEqual(e._inwardNormal)&&this._interior===e._interior&&this._invisible===e._invisible}clone(){return new ClipPlane(this._inwardNormal.clone(),this._distanceFromOrigin,this._invisible,this._interior)}cloneNegated(){const e=new ClipPlane(this._inwardNormal.clone(),this._distanceFromOrigin,this._invisible,this._interior);return e.negateInPlace(),e}static createPlane(e,t=!1,r=!1,n){const i=e.getNormalRef().dotProduct(e.getOriginRef());return n?(n._invisible=t,n._interior=r,n._inwardNormal=e.getNormalRef().clone(),n._distanceFromOrigin=i,n):new ClipPlane(e.getNormalRef().clone(),i,t,r)}static createNormalAndDistance(e,t,r=!1,n=!1,i){const o=e.normalize();if(o)return i&&(i._invisible=r,i._interior=n,i._inwardNormal=o,i._distanceFromOrigin=t),new ClipPlane(o,t,r,n)}static createNormalAndPoint(e,t,r=!1,n=!1,i){const o=e.normalize();if(o){const e=o.dotProduct(t);return i&&(i._invisible=r,i._interior=n,i._inwardNormal=o,i._distanceFromOrigin=e),new ClipPlane(o,e,r,n)}}static createNormalAndPointXYZXYZ(e,t,r,i,o,s,a=!1,c=!1){const l=n.Vector3d.create(e,t,r);if(l.normalizeInPlace()){const e=l.dotProductXYZ(i,o,s);return new ClipPlane(l,e,a,c)}}toJSON(){const e={};return e.normal=this.inwardNormalRef.toJSON(),e.dist=this.distance,this.interior&&(e.interior=!0),this.invisible&&(e.invisible=!0),e}static fromJSON(e,t){return e&&e.normal&&Number.isFinite(e.dist)?ClipPlane.createNormalAndDistance(n.Vector3d.fromJSON(e.normal),e.dist,!!e.invisible,!!e.interior):ClipPlane.createNormalAndDistance(n.Vector3d.unitZ(),0,!1,!1,t)}setFlags(e,t){this._invisible=e,this._interior=t}get distance(){return this._distanceFromOrigin}get inwardNormalRef(){return this._inwardNormal}get interior(){return this._interior}get invisible(){return this._invisible}static createEdgeAndUpVector(e,t,r,i,o){const s=n.Vector3d.createFrom(t.minus(e));let a=r.crossProduct(s).normalize();if(a){if(!i.isAlmostZero){const e=n.Vector3d.createRotateVectorAroundVector(a,s,i);e&&(a=e.clone())}return a.negate(a),ClipPlane.createNormalAndPoint(a,e,!1,!1,o)}}static createEdgeXY(e,t,r){const i=n.Vector3d.create(e.y-t.y,t.x-e.x);if(i.normalizeInPlace())return ClipPlane.createNormalAndPoint(i,e,!1,!1,r)}getPlane3d(){const e=this._distanceFromOrigin;return o.Plane3dByOriginAndUnitNormal.create(n.Point3d.create(this._inwardNormal.x*e,this._inwardNormal.y*e,this._inwardNormal.z*e),this._inwardNormal)}getPlane4d(){return i.Point4d.create(this._inwardNormal.x,this._inwardNormal.y,this._inwardNormal.z,-this._distanceFromOrigin)}setPlane4d(e){const t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),r=0===t?1:1/t;this._inwardNormal.x=r*e.x,this._inwardNormal.y=r*e.y,this._inwardNormal.z=r*e.z,this._distanceFromOrigin=-r*e.w}evaluatePoint(e){return e.x*this._inwardNormal.x+e.y*this._inwardNormal.y+e.z*this._inwardNormal.z-this._distanceFromOrigin}dotProductVector(e){return e.x*this._inwardNormal.x+e.y*this._inwardNormal.y+e.z*this._inwardNormal.z}dotProductPlaneNormalPoint(e){return e.x*this._inwardNormal.x+e.y*this._inwardNormal.y+e.z*this._inwardNormal.z}isPointOnOrInside(e,t){let r=this.evaluatePoint(e);return t&&(r+=t),r>=0}isPointInside(e,t){let r=this.evaluatePoint(e);return t&&(r+=t),r>0}isPointOn(e,t=s.Geometry.smallMetricDistance){return Math.abs(this.evaluatePoint(e))<=t}appendIntersectionRadians(e,t){const r=e.toVectors(),n=this.evaluatePoint(e.center),i=this.dotProductVector(r.vector0),o=this.dotProductVector(r.vector90);c.AnalyticRoots.appendImplicitLineUnitCircleIntersections(n,i,o,void 0,void 0,t)}announceClippedArcIntervals(e,t){const r=ClipPlane._clipArcFractionArray;return r.clear(),this.appendIntersectionRadians(e,r),e.sweep.radiansArraytoPositivePeriodicFractions(r),l.ClipUtilities.selectIntervals01(e,r,this,t)}getBoundedSegmentSimpleIntersection(e,t){const r=this.evaluatePoint(e),n=this.evaluatePoint(t);if(!(r*n>0)&&(0!==r||0!==n))return-r/(n-r)}transformInPlace(e){const t=this.getPlane3d(),r=e.matrix,n=e.multiplyPoint3d(t.getOriginRef()),i=r.multiplyInverseTranspose(t.getNormalRef());if(!i)return!1;t.set(n,i);const o=t.getNormalRef().normalize();return!!o&&(this._inwardNormal=o,this._distanceFromOrigin=this._inwardNormal.dotProduct(t.getOriginRef()),!0)}setInvisible(e){this._invisible=e}negateInPlace(){this._inwardNormal=this._inwardNormal.negate(),this._distanceFromOrigin=-this._distanceFromOrigin}offsetDistance(e){this._distanceFromOrigin+=e}convexPolygonClipInPlace(e,t){t.length=0;let r=0;if(ClipPlane.fractionTol=1e-8,e.length>2){let i=e[e.length-1],o=this.evaluatePoint(i);for(const s of e){const e=this.evaluatePoint(s);if(e<0&&r++,o*e<0){const r=-o/(e-o);r>1-ClipPlane.fractionTol&&e>=0||t.push(i.interpolate(r,s))}e>=0&&t.push(s),i=n.Point3d.createFrom(s),o=e}}if(t.length<=2)e.length=0;else if(r>0){e.length=0;for(const r of t)e.push(r);t.length=0}}polygonCrossings(e,t){if(t.length=0,e.length>=2){let r=e[e.length-1],i=this.evaluatePoint(r);for(const o of e){const e=this.evaluatePoint(o);if(i*e<0){const n=-i/(e-i);t.push(r.interpolate(n,o))}0===e&&t.push(o),r=n.Point3d.createFrom(o),i=e}}}convexPolygonSplitInsideOutside(e,t,r,i){if(r.length=0,t.length=0,ClipPlane.fractionTol=1e-8,e.length>2){let o=e[e.length-1];i.setNull();let s=this.evaluatePoint(o);i.extendX(s);for(const a of e){const e=this.evaluatePoint(a);i.extendX(e);let c=!1;if(s*e<0){const n=-s/(e-s);if(n>1-ClipPlane.fractionTol&&e>=0)c=!0;else{const e=o.interpolate(n,a);t.push(e),r.push(e)}}(e>=0||c)&&t.push(a),(e<=0||c)&&r.push(a),o=n.Point3d.createFrom(a),s=e}}}multiplyPlaneByMatrix(e){const t=this.getPlane4d();e.multiplyTransposePoint4d(t,t),this.setPlane4d(t)}announceClippedSegmentIntervals(e,t,r,n,i){if(t<e)return!1;const o=-this.evaluatePoint(r),a=-this.evaluatePoint(n)-o,c=s.Geometry.conditionalDivideFraction(-o,a);return void 0===c?o<=0&&(i&&i(e,t),!0):(a>0?c<t&&(t=c):c>e&&(e=c),!(t<e)&&(i&&i(e,t),!0))}}ClipPlane.fractionTol=1e-8,ClipPlane._clipArcFractionArray=new a.GrowableFloat64Array,t.ClipPlane=ClipPlane},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(23),o=r(23),s=r(10),a=r(5),c=r(24),l=r(37),u=r(168),d=r(126);class ConvexClipPlaneSet{constructor(e){this._planes=e||[]}toJSON(){const e=[];for(const t of this._planes)e.push(t.toJSON());return e}static fromJSON(e,t){if((t=t||new ConvexClipPlaneSet)._planes.length=0,!Array.isArray(e))return t;for(const r of e){const e=u.ClipPlane.fromJSON(r);e&&t._planes.push(e)}return t}isAlmostEqual(e){if(this._planes.length!==e._planes.length)return!1;for(let t=0;t<this._planes.length;t++)if(!this._planes[t].isAlmostEqual(e._planes[t]))return!1;return!0}static createPlanes(e,t){t=t||new ConvexClipPlaneSet;for(const r of e)t._planes.push(r);return t}static createRange3dPlanes(e,t=!0,r=!0,n=!0,i=!0,o=!0,s=!0){const a=ConvexClipPlaneSet.createEmpty();return t&&a.planes.push(u.ClipPlane.createNormalAndPointXYZXYZ(1,0,0,e.low.x,0,0)),r&&a.planes.push(u.ClipPlane.createNormalAndPointXYZXYZ(-1,0,0,e.high.x,0,0)),n&&a.planes.push(u.ClipPlane.createNormalAndPointXYZXYZ(0,1,0,0,e.low.y,0)),i&&a.planes.push(u.ClipPlane.createNormalAndPointXYZXYZ(0,-1,0,0,e.high.y,0)),o&&a.planes.push(u.ClipPlane.createNormalAndPointXYZXYZ(0,0,1,0,0,e.low.z)),s&&a.planes.push(u.ClipPlane.createNormalAndPointXYZXYZ(0,0,-1,0,0,e.high.z)),a}static createEmpty(e){return e?(e._planes.length=0,e):new ConvexClipPlaneSet}negateAllPlanes(){for(const e of this._planes)e.negateInPlace()}static createXYBox(e,t,r,i,o){(o=o||new ConvexClipPlaneSet)._planes.length=0;const s=u.ClipPlane.createNormalAndDistance(n.Vector3d.create(-1,0,0),-r,!1,!0),a=u.ClipPlane.createNormalAndDistance(n.Vector3d.create(1,0,0),e,!1,!0),c=u.ClipPlane.createNormalAndDistance(n.Vector3d.create(0,-1,0),-i,!1,!0),l=u.ClipPlane.createNormalAndDistance(n.Vector3d.create(0,1,0),t,!1,!0);return s&&a&&c&&l&&o._planes.push(s,a,c,l),o}static createXYPolyLine(e,t,r,i){(i=i||new ConvexClipPlaneSet)._planes.length=0;for(let o=0;o+1<e.length;o++){const s=n.Vector3d.createStartEnd(e[o],e[o+1]).unitPerpendicularXY();if(s.z=0,r||s.negate(),s.normalize()){const r=u.ClipPlane.createNormalAndPoint(s,e[o],t[o],t[o]);r&&i._planes.push(r)}}return i}static createXYPolyLineInsideLeft(e,t){(t=t||new ConvexClipPlaneSet)._planes.length=0;for(let r=0;r+1<e.length;r++){const i=n.Vector3d.createStartEnd(e[r],e[r+1]).unitPerpendicularXY();if(i.z=0,i.normalize()){const n=u.ClipPlane.createNormalAndPoint(i,e[r],!1,!1);n&&t._planes.push(n)}}return t}clone(e){(e=e||new ConvexClipPlaneSet)._planes.length=0;for(const t of this._planes)e._planes.push(t.clone());return e}get planes(){return this._planes}static testRayIntersections(e,t,r,n){e[0]=-ConvexClipPlaneSet.hugeVal;let i=ConvexClipPlaneSet.hugeVal;for(const o of n._planes){const n=o.dotProductVector(r),s=o.evaluatePoint(t);if(0===n){if(s<0)return!1}else{const t=-s/n;n<0?t<i&&(i=t):t>e[0]&&(e[0]=t)}}return e[0]<=i}multiplyPlanesByMatrix(e){for(const t of this._planes)t.multiplyPlaneByMatrix(e)}isPointInside(e){for(const t of this._planes)if(!t.isPointInside(e))return!1;return!0}isPointOnOrInside(e,t){const r=Math.abs(t);for(const n of this._planes)if(!n.isPointOnOrInside(e,n.interior?r:t))return!1;return!0}isSphereInside(e,t){for(const r of this._planes)if(!r.isPointOnOrInside(e,t))return!1;return!0}announceClippedSegmentIntervals(e,t,r,n,i){let o;if(t<e)return!1;for(const s of this._planes){const i=-s.evaluatePoint(r),c=-s.evaluatePoint(n);if(void 0===(o=a.Geometry.safeDivideFraction(-i,c-i,0))){if(i>0)return!1}else if(c>i){if(o<e)return!1;o<t&&(t=o)}else if(i>c){if(o>t)return!1;o>e&&(e=o)}else if(i>0)return!1}return t>=e&&(i&&i(e,t),!0)}announceClippedArcIntervals(e,t){const r=ConvexClipPlaneSet._clipArcFractionArray;r.clear();for(const n of this.planes)n.appendIntersectionRadians(e,r);return e.sweep.radiansArraytoPositivePeriodicFractions(r),d.ClipUtilities.selectIntervals01(e,r,this,t)}clipUnboundedSegment(e,t,r){return this.announceClippedSegmentIntervals(-Number.MAX_VALUE,Number.MAX_VALUE,e,t,r)}transformInPlace(e){for(const t of this._planes)t.transformInPlace(e)}classifyPointContainment(e,t){let r=!0;const n=t?1e-8:-1e-8;for(const i of this._planes){let t=0;for(const o of e)i.evaluatePoint(o)<(i.interior?1e-8:n)&&(t++,r=!1);if(t===e.length)return 3}return r?1:2}static createSweptPolyline(e,t,r){const n=ConvexClipPlaneSet.createEmpty();let i=!1;if(e.length>3&&e[0].isAlmostEqual(e[e.length-1])){c.PolygonOps.areaNormal(e).dotProduct(t)>0&&(i=!0)}for(let o=0;o+1<e.length;o++)if(i){const i=u.ClipPlane.createEdgeAndUpVector(e[o+1],e[o],t,r);if(!i)return;n.addPlaneToConvexSet(i)}else{const i=u.ClipPlane.createEdgeAndUpVector(e[o],e[o+1],t,r);if(!i)return;n.addPlaneToConvexSet(i)}return n}addPlaneToConvexSet(e){e&&this._planes.push(e)}clipPointsOnOrInside(e,t,r){t.length=0,r.length=0;for(const n of e)this.isPointOnOrInside(n,0)?t.push(n):r.push(n)}polygonClip(e,t,r){t.length=0;for(const n of e)t.push(n);for(const n of this._planes){if(0===t.length)break;n.convexPolygonClipInPlace(t,r)}}reloadSweptPolygon(e,t,r){this._planes.length=0;const i=e.length;if(i<=2)return 0;const o=c.PolygonOps.areaNormal(e),s=t.dotProduct(o)>0,a=s?1:i-1;for(let c=0;c<i;c++){const r=(c+a)%i,o=e[c],s=e[r];if(o.isAlmostEqual(s))continue;const l=n.Vector3d.createStartEnd(o,s),d=n.Vector3d.createCrossProduct(t.x,t.y,t.z,l.x,l.y,l.z).normalize();let h;if(d){h=d.dotProduct(o);const e=u.ClipPlane.createNormalAndDistance(d,h,!1,!1);e&&this._planes.push(e)}}if(0!==r){let n=o.normalize();if(n){t.dotProduct(n)*r<0&&(n=n.negate());const i=e[0],o=n.dotProduct(i),s=u.ClipPlane.createNormalAndDistance(n,o,!1,!1);s&&this._planes.push(s)}}return s?1:-1}getRangeOfAlignedPlanes(e,t){const r=s.Matrix3d.createIdentity(),n=o.Range3d.createXYZXYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=n.clone(t);for(const o of this._planes){e&&o.transformInPlace(e);const t=[i.Range1d.createXX(a.low.x,a.high.x),i.Range1d.createXX(a.low.y,a.high.y),i.Range1d.createXX(a.low.z,a.high.z)];for(let e=0;e<3;e++){let n,i;n=t[e].low,i=t[e].high;const s=r.getColumn(e);o.inwardNormalRef.isParallelTo(s,!0)&&(o.inwardNormalRef.dotProduct(s)>0?o.distance>n&&(t[e].low=o.distance):-o.distance<i&&(t[e].high=-o.distance))}a.low.x=t[0].low,a.high.x=t[0].high,a.low.y=t[1].low,a.high.y=t[1].high,a.low.z=t[2].low,a.high.z=t[2].high}return a.isAlmostEqual(n)?void 0:a}setInvisible(e){for(const t of this._planes)t.setInvisible(e)}addZClipPlanes(e,t,r){void 0!==t&&this._planes.push(u.ClipPlane.createNormalAndDistance(n.Vector3d.create(0,0,1),t,e)),void 0!==r&&this._planes.push(u.ClipPlane.createNormalAndDistance(n.Vector3d.create(0,0,-1),-r,e))}}ConvexClipPlaneSet.hugeVal=1e37,ConvexClipPlaneSet._clipArcFractionArray=new l.GrowableFloat64Array,t.ConvexClipPlaneSet=ConvexClipPlaneSet},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(261),i=r(6),o=r(5),s=r(23);class Triangulator{static flipTriangles(e,t,r,i,o,s){n.HalfEdge.pinch(e,o),n.HalfEdge.pinch(r,i),n.HalfEdge.pinch(s,r),n.HalfEdge.pinch(o,t),o.x=t.x,o.y=t.y,o.z=t.z,o.i=t.i,r.i=s.i,r.x=s.x,r.y=s.y,r.z=s.z}static computeInCircleDeterminant(e){const t=e.faceSuccessor,r=t.faceSuccessor;if(r.faceSuccessor!==e)return;const n=e.edgeMate,i=n.faceSuccessor.faceSuccessor;if(i.faceSuccessor!==n)return;const s=t.x-e.x,a=t.y-e.y,c=r.x-e.x,l=r.y-e.y,u=i.x-e.x,d=i.y-e.y;return o.Geometry.tripleProduct(u,d,u*u+d*d,c,l,c*c+l*l,s,a,s*s+a*a)}static cleanupTriangulation(e){const t=e.allHalfEdges;e.clearMask(8192);let r=!1;for(let n=0;n<t.length;n++){const e=t[n];if(e.isMaskSet(8192))continue;if(e.setMask(8192),void 0===e.edgeMate||e.isMaskSet(1)||e.isMaskSet(512))continue;r=!0;const i=Triangulator.computeInCircleDeterminant(e);void 0!==i&&i>0&&(e.facePredecessor.clearMask(8192),e.faceSuccessor.clearMask(8192),e.edgeMate.facePredecessor.clearMask(8192),e.edgeMate.faceSuccessor.clearMask(8192),Triangulator.flipTriangles(e.edgeMate.faceSuccessor,e.edgeMate.facePredecessor,e.edgeMate,e.faceSuccessor,e,e.facePredecessor)),n===t.length-1&&r&&(n=-1,r=!1)}e.clearMask(8192)}static triangulateStrokedLoops(e){if(e.length<1)return;Triangulator._returnGraph=new n.HalfEdgeGraph;let t=e[0].areaXY(),r=0;for(let n=0;n<e.length;n++){const i=Math.abs(e[n].areaXY());i>t&&(t=i,r=n)}const i=[];let o=Triangulator.createFaceLoopFromIndexedXYZCollection(e[r],!0,!0);if(!o)return Triangulator._returnGraph;for(let n=0;n<e.length;n++)if(n!==r){const t=Triangulator.createFaceLoopFromIndexedXYZCollection(e[n],!1,!0);t&&i.push(Triangulator.getLeftmost(t))}return o=Triangulator.spliceLeftMostNodesOfHoles(o,i,!1),Triangulator.earcutLinked(o),Triangulator._returnGraph}static earcutSingleLoop(e){Triangulator._returnGraph=new n.HalfEdgeGraph;const t=Triangulator.createFaceLoopFromXAndYArray(e,!0,!0);if(!t)return Triangulator._returnGraph;let r,i,o,s,a,c,l;if(e.length>80){r=o=e[0].x,i=s=e[0].y;const t=e.length;for(let n=1;n<t;n++)a=e[n].x,c=e[n].y,a<r&&(r=a),c<i&&(i=c),a>o&&(o=a),c>s&&(s=c);l=Math.max(o-r,s-i)}return Triangulator.earcutLinked(t,r,i,l),Triangulator._returnGraph}static earcutOuterAndInnerLoops(e){Triangulator._returnGraph=new n.HalfEdgeGraph;const t=s.Range2d.createNull(),r=e.length;for(const n of e){const e=n.length;for(let r=0;r<e;r++)t.extendXY(n[r].x,n[r].y)}let i=Triangulator.createFaceLoopFromXAndYArray(e[0],!0,!0);return i?(r>1&&(i=Triangulator.constructAndSpliceHoles(e,i)),Triangulator.earcutLinked(i),Triangulator._returnGraph):Triangulator._returnGraph}static interiorEdgeSplit(e,t,r){const n=r.hasOwnProperty("z")?r.z:0;return t?Triangulator.equalXAndY(t,r)?t:Triangulator.equalXAndY(t.faceSuccessor,r)?t:e.splitEdge(t,r.x,r.y,n):e.splitEdge(t,r.x,r.y,n)}static directcreateFaceLoopFromIndexedXYZCollection(e,t){let r,n;const o=i.Point3d.create();for(r=0;r<t.length;r++)t.atPoint3dIndex(r,o),n=Triangulator.interiorEdgeSplit(e,n,o);return n}static directCreateFaceLoopFromXAndYArray(e,t){let r;for(const n of t)r=Triangulator.interiorEdgeSplit(e,r,n);return r}static assignMasksToNewFaceLoop(e,t,r,n){if(t){const e=(t=t.faceSuccessor).signedFaceArea(),i=t.edgeMate;t.setMaskAroundFace(514),i.setMaskAroundFace(514);let o=t;r===e<0&&(o=i);const s=o.vertexSuccessor;return n&&s.setMaskAroundFace(1),o}}static createFaceLoopFromXAndYArray(e,t,r){const n=Triangulator._returnGraph,i=Triangulator.directCreateFaceLoopFromXAndYArray(n,e);return Triangulator.assignMasksToNewFaceLoop(n,i,t,r)}static createFaceLoopFromIndexedXYZCollection(e,t,r){const n=Triangulator._returnGraph,i=Triangulator.directcreateFaceLoopFromIndexedXYZCollection(n,e);return Triangulator.assignMasksToNewFaceLoop(n,i,t,r)}static filterPoints(e,t){if(!e)return e;t||(t=e);let r,n=e;do{if(r=!1,n.steiner||!Triangulator.equalXAndY(n,n.faceSuccessor)&&0!==Triangulator.signedTriangleArea(n.facePredecessor,n,n.faceSuccessor))n=n.faceSuccessor;else{if(Triangulator.joinNeighborsOfEar(n),(n=t=n.facePredecessor)===n.faceSuccessor)return;r=!0}}while(r||n!==t);return t}static joinNeighborsOfEar(e){const t=Triangulator._returnGraph.createEdgeXYZXYZ(e.facePredecessor.x,e.facePredecessor.y,e.facePredecessor.z,e.facePredecessor.i,e.faceSuccessor.x,e.faceSuccessor.y,e.faceSuccessor.z,e.faceSuccessor.i),r=t.edgeMate;e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ),n.HalfEdge.pinch(e.faceSuccessor,r),n.HalfEdge.pinch(e.facePredecessor,t),e.setMaskAroundFace(16384)}static earcutLinked(e,t,r,n,i){if(!e)return;!i&&n&&Triangulator.indexCurve(e,t,r,n);let o,s=e;for(;!e.isMaskSet(16384);)if(o=e.faceSuccessor,n?Triangulator.isEarHashed(e,t,r,n):Triangulator.isEar(e))s=o.faceSuccessor,e.faceSuccessor.faceSuccessor!==e.facePredecessor?(Triangulator.joinNeighborsOfEar(e),e=e.faceSuccessor.edgeMate.faceSuccessor.faceSuccessor):(e.setMask(16384),e.faceSuccessor.setMask(16384),e.facePredecessor.setMask(16384),e=o.faceSuccessor);else if((e=o)===s){i?2===i&&Triangulator.splitEarcut(e,t,r,n):(e=Triangulator.cureLocalIntersections(e),Triangulator.earcutLinked(e,t,r,n,2));break}}static isEar(e){const t=e.facePredecessor,r=e,n=e.faceSuccessor;if(Triangulator.signedTriangleArea(t,r,n)>=0)return!1;let i=e.faceSuccessor.faceSuccessor;for(;i!==e.facePredecessor;){if(Triangulator.pointInTriangle(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Triangulator.signedTriangleArea(i.facePredecessor,i,i.faceSuccessor)>=0)return!1;i=i.faceSuccessor}return!0}static isEarHashed(e,t,r,n){const i=e.facePredecessor,o=e,s=e.faceSuccessor;if(Triangulator.signedTriangleArea(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,c=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,l=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,d=Triangulator.zOrder(a,c,t,r,n),h=Triangulator.zOrder(l,u,t,r,n);let p=e.nextZ;for(;p&&p.zOrder<=h;){if(p!==e.facePredecessor&&p!==e.faceSuccessor&&Triangulator.pointInTriangle(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Triangulator.signedTriangleArea(p.facePredecessor,p,p.faceSuccessor)>=0)return!1;p=p.nextZ}for(p=e.prevZ;p&&p.zOrder>=d;){if(p!==e.facePredecessor&&p!==e.faceSuccessor&&Triangulator.pointInTriangle(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Triangulator.signedTriangleArea(p.facePredecessor,p,p.faceSuccessor)>=0)return!1;p=p.prevZ}return!0}static cureLocalIntersections(e){let t=e;do{const r=t.facePredecessor,n=t.faceSuccessor.faceSuccessor;!Triangulator.equalXAndY(r,n)&&Triangulator.intersects(r,t,t.faceSuccessor,n)&&Triangulator.locallyInside(r,n)&&Triangulator.locallyInside(n,r)&&(Triangulator.joinNeighborsOfEar(t),Triangulator.joinNeighborsOfEar(t.faceSuccessor),t=e=n),t=t.faceSuccessor}while(t!==e);return t}static splitEarcut(e,t,r,n){let i=e;do{let e=i.faceSuccessor.faceSuccessor;for(;e!==i.facePredecessor;){if(i.i!==e.i&&Triangulator.isValidDiagonal(i,e)){let o=Triangulator.splitPolygon(i,e);return i=Triangulator.filterPoints(i,i.faceSuccessor),o=Triangulator.filterPoints(o,o.faceSuccessor),Triangulator.earcutLinked(i,t,r,n),void Triangulator.earcutLinked(o,t,r,n)}e=e.faceSuccessor}i=i.faceSuccessor}while(i!==e)}static constructAndSpliceHoles(e,t){const r=[];let n;for(let i=1;i<e.length;i++)(n=Triangulator.createFaceLoopFromXAndYArray(e[i],!1,!0))&&n===n.faceSuccessor&&(n.steiner=!0),r.push(Triangulator.getLeftmost(n));return t=Triangulator.spliceLeftMostNodesOfHoles(t,r,!0)}static spliceLeftMostNodesOfHoles(e,t,r=!0){t.sort(Triangulator.compareX);for(const n of t)Triangulator.eliminateHole(n,e,r),r&&(e=Triangulator.filterPoints(e,e?e.faceSuccessor:void 0));return e}static compareX(e,t){return e.x-t.x}static eliminateHole(e,t,r){if(t=Triangulator.findHoleBridge(e,t)){const n=Triangulator.splitPolygon(t,e);r&&Triangulator.filterPoints(n,n.faceSuccessor)}}static findHoleBridge(e,t){let r=t;if(!r)return;const n=e.x,i=e.y;let o,s=-1/0;do{if(i<=r.y&&i>=r.faceSuccessor.y&&r.faceSuccessor.y!==r.y){const e=r.x+(i-r.y)*(r.faceSuccessor.x-r.x)/(r.faceSuccessor.y-r.y);if(e<=n&&e>s){if(s=e,e===n){if(i===r.y)return r;if(i===r.faceSuccessor.y)return r.faceSuccessor}o=r.x<r.faceSuccessor.x?r:r.faceSuccessor}}r=r.faceSuccessor}while(r!==t);if(!o)return;if(n===s)return o.facePredecessor;const a=o,c=o.x,l=o.y;let u,d=1/0;for(r=o.faceSuccessor;r!==a;)n>=r.x&&r.x>=c&&n!==r.x&&Triangulator.pointInTriangle(i<l?n:s,i,c,l,i<l?s:n,i,r.x,r.y)&&((u=Math.abs(i-r.y)/(n-r.x))<d||u===d&&r.x>o.x)&&Triangulator.locallyInside(r,e)&&(o=r,d=u),r=r.faceSuccessor;return o}static indexCurve(e,t,r,n){let i=e;do{void 0===i.zOrder&&(i.zOrder=Triangulator.zOrder(i.x,i.y,t,r,n)),i.prevZ=i.facePredecessor,i.nextZ=i.faceSuccessor,i=i.faceSuccessor}while(i!==e);i.prevZ.nextZ=void 0,i.prevZ=void 0,Triangulator.sortLinked(i)}static sortLinked(e){let t,r,n,i,o,s,a,c,l=1;do{for(r=e,e=void 0,o=void 0,s=0;r;){for(s++,n=r,a=0,t=0;t<l&&(a++,n=n.nextZ);t++);for(c=l;a>0||c>0&&n;)0!==a&&(0===c||!n||r.zOrder<=n.zOrder)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=void 0,l*=2}while(s>1);return e}static zOrder(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}static getLeftmost(e){let t=e,r=e;do{t.x<r.x&&(r=t),t=t.faceSuccessor}while(t!==e);return r}static pointInTriangle(e,t,r,n,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}static isValidDiagonal(e,t){return e.faceSuccessor.i!==t.i&&e.facePredecessor.i!==t.i&&!Triangulator.intersectsPolygon(e,t)&&Triangulator.locallyInside(e,t)&&Triangulator.locallyInside(t,e)&&Triangulator.middleInside(e,t)}static signedTriangleArea(e,t,r){return.5*((t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y))}static equalXAndY(e,t){return o.Geometry.isSameCoordinate(e.x,t.x)&&o.Geometry.isSameCoordinate(e.y,t.y)}static intersects(e,t,r,n){return!!(Triangulator.equalXAndY(e,t)&&Triangulator.equalXAndY(r,n)||Triangulator.equalXAndY(e,n)&&Triangulator.equalXAndY(r,t))||Triangulator.signedTriangleArea(e,t,r)>0!==Triangulator.signedTriangleArea(e,t,n)>0&&Triangulator.signedTriangleArea(r,n,e)>0!==Triangulator.signedTriangleArea(r,n,t)>0}static intersectsPolygon(e,t){let r=e;do{if(r.i!==e.i&&r.faceSuccessor.i!==e.i&&r.i!==t.i&&r.faceSuccessor.i!==t.i&&Triangulator.intersects(r,r.faceSuccessor,e,t))return!0;r=r.faceSuccessor}while(r!==e);return!1}static locallyInside(e,t){return Triangulator.signedTriangleArea(e.facePredecessor,e,e.faceSuccessor)<0?Triangulator.signedTriangleArea(e,t,e.faceSuccessor)>=0&&Triangulator.signedTriangleArea(e,e.facePredecessor,t)>=0:Triangulator.signedTriangleArea(e,t,e.facePredecessor)<0||Triangulator.signedTriangleArea(e,e.faceSuccessor,t)<0}static middleInside(e,t){let r=e,n=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!==r.faceSuccessor.y>o&&r.faceSuccessor.y!==r.y&&i<(r.faceSuccessor.x-r.x)*(o-r.y)/(r.faceSuccessor.y-r.y)+r.x&&(n=!n),r=r.faceSuccessor}while(r!==e);return n}static splitPolygon(e,t){const r=Triangulator._returnGraph.createEdgeXYZXYZ(e.x,e.y,e.z,e.i,t.x,t.y,t.z,t.i),i=r.faceSuccessor;return n.HalfEdge.pinch(e,r),n.HalfEdge.pinch(t,i),r}}t.Triangulator=Triangulator},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(279);class AxisAlignedBox3d extends n.Range3d{constructor(e,t){void 0===e||void 0===t?super():super(e.x,e.y,e.z,t.x,t.y,t.z)}clone(){return new AxisAlignedBox3d(this.low,this.high)}static fromRange2d(e){const t=new AxisAlignedBox3d;return t.low.x=e.low.x,t.low.y=e.low.y,t.high.x=e.high.x,t.high.y=e.high.y,t}get center(){return this.low.interpolate(.5,this.high)}ensureMinLengths(e=.001){let t=(e-this.xLength())/2;t>0&&(this.low.x-=t,this.high.x+=t),(t=(e-this.yLength())/2)>0&&(this.low.y-=t,this.high.y+=t),(t=(e-this.zLength())/2)>0&&(this.low.z-=t,this.high.z+=t)}static fromJSON(e){const t=new AxisAlignedBox3d;return t.setFromJSON(e),t}}t.AxisAlignedBox3d=AxisAlignedBox3d;class ElementAlignedBox3d extends n.Range3d{static createFromPoints(e,t){return new ElementAlignedBox3d(e.x,e.y,e.z,t.x,t.y,t.z)}get left(){return this.low.x}get bottom(){return this.low.y}get front(){return this.low.z}get right(){return this.high.x}get top(){return this.high.y}get back(){return this.high.z}get width(){return this.xLength()}get depth(){return this.yLength()}get height(){return this.zLength()}get isValid(){const e=n.Constant.circumferenceOfEarth,t=this.low,r=this.high;return!this.isNull&&t.x>-e&&t.y>-e&&t.z>-e&&r.x<e&&r.y<e&&r.z<e}static fromJSON(e){const t=new ElementAlignedBox3d;return e&&t.setFromJSON(e),t}}t.ElementAlignedBox3d=ElementAlignedBox3d;class ElementAlignedBox2d extends n.Range2d{static createFromPoints(e,t){return new ElementAlignedBox2d(e.x,e.y,t.x,t.y)}get left(){return this.low.x}get bottom(){return this.low.y}get right(){return this.high.x}get top(){return this.high.y}get width(){return this.xLength()}get height(){return this.yLength()}static fromJSON(e){const t=new ElementAlignedBox2d;return e&&t.setFromJSON(e),t}get isValid(){const e=n.Constant.circumferenceOfEarth,t=this.low,r=this.high;return!this.isNull&&t.x>-e&&t.y>-e&&r.x<e&&r.y<e}}t.ElementAlignedBox2d=ElementAlignedBox2d;class Placement3d{constructor(e,t,r){this.origin=e,this.angles=t,this.bbox=r}get rotation(){return this.angles.toMatrix3d()}get transform(){return n.Transform.createOriginAndMatrix(this.origin,this.rotation)}static fromJSON(e){const t=e||{};return new Placement3d(n.Point3d.fromJSON(t.origin),n.YawPitchRollAngles.fromJSON(t.angles),ElementAlignedBox3d.fromJSON(t.bbox))}getWorldCorners(e){const t=i.Frustum.fromRange(this.bbox,e);return t.multiply(this.transform),t}setFrom(e){this.origin.setFrom(e.origin),this.angles.setFrom(e.angles),this.bbox.setFrom(e.bbox)}get isValid(){return this.bbox.isValid&&this.origin.maxAbs()<n.Constant.circumferenceOfEarth}calculateRange(){const e=new AxisAlignedBox3d;return this.isValid?(this.transform.multiplyRange(this.bbox,e),e.ensureMinLengths(),e):e}}t.Placement3d=Placement3d;class Placement2d{constructor(e,t,r){this.origin=e,this.angle=t,this.bbox=r}get rotation(){return n.Matrix3d.createRotationAroundVector(n.Vector3d.unitZ(),this.angle)}get transform(){return n.Transform.createOriginAndMatrix(n.Point3d.createFrom(this.origin),this.rotation)}static fromJSON(e){const t=e||{};return new Placement2d(n.Point2d.fromJSON(t.origin),n.Angle.fromJSON(t.angle),ElementAlignedBox2d.fromJSON(t.bbox))}getWorldCorners(e){const t=i.Frustum.fromRange(this.bbox,e);return t.multiply(this.transform),t}get isValid(){return this.bbox.isValid&&this.origin.maxAbs()<n.Constant.circumferenceOfEarth}setFrom(e){this.origin.setFrom(e.origin),this.angle.setFrom(e.angle),this.bbox.setFrom(e.bbox)}calculateRange(){const e=new AxisAlignedBox3d;return this.isValid?(this.transform.multiplyRange(n.Range3d.createRange2d(this.bbox,0),e),e.ensureMinLengths(),e.low.z=-1,e.high.z=1,e):e}}t.Placement2d=Placement2d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(15),i=r(0),o=r(0),s=r(42),a=r(73),c=r(52),l=r(62),u=r(74),d=r(102),h=r(25);t.RpcInvocation=class RpcInvocation{constructor(e,t){this._threw=!1,this._pending=!1,this._notFound=!1,this._timeIn=0,this._timeOut=0,this.operation=void 0,this._timeIn=(new Date).getTime(),this.protocol=e,this.request=t;try{try{this.operation=a.RpcOperation.lookup(this.request.operation.interfaceDefinition,this.request.operation.operationName);const e=this.operation.interfaceVersion,t=this.request.operation.interfaceVersion;if(!s.RpcInterface.isVersionCompatible(t,e))throw new n.IModelError(i.RpcInterfaceStatus.IncompatibleVersion,`Backend version ${e} does not match frontend version ${t} for RPC interface ${this.operation.operationName}.`)}catch(e){if(!this.handleUnknownOperation(e))throw e;this.operation=a.RpcOperation.lookup(this.request.operation.interfaceDefinition,this.request.operation.operationName)}this.operation.policy.invocationCallback(this),e.events.raiseEvent(h.RpcProtocolEvent.RequestReceived,this),this.result=this.resolve()}catch(e){this.result=this.reject(e)}this.fulfillment=this.result.then(e=>this.fulfillResolved(e),e=>this.fulfillRejected(e))}get status(){return this._threw?h.RpcRequestStatus.Rejected:this._pending?h.RpcRequestStatus.Pending:this._notFound?h.RpcRequestStatus.NotFound:h.RpcRequestStatus.Resolved}get elapsed(){return this._timeOut-this._timeIn}static current(e){return e[c.CURRENT_INVOCATION]}handleUnknownOperation(e){return this.protocol.configuration.controlChannel.handleUnknownOperation(this,e)}resolve(){const e=u.RpcMarshaling.deserialize(this.operation,this.protocol,this.request.parameters),t=c.RpcRegistry.instance.getImplForInterface(this.operation.interfaceDefinition);t[c.CURRENT_INVOCATION]=this;const r=this.lookupOperationFunction(t);return new o.ActivityLoggingContext(this.request.id).enter(),Promise.resolve(r.call(t,...e))}reject(e){return this._threw=!0,this.protocol.events.raiseEvent(h.RpcProtocolEvent.BackendErrorOccurred,this),Promise.reject(e)}fulfillResolved(e){this._timeOut=(new Date).getTime(),this.protocol.events.raiseEvent(h.RpcProtocolEvent.BackendResponseCreated,this);const t=u.RpcMarshaling.serialize(this.operation,this.protocol,e);return this.fulfill(t,e)}fulfillRejected(e){this._timeOut=(new Date).getTime(),l.RpcConfiguration.developmentMode||(e.stack=void 0);const t=u.RpcMarshaling.serialize(this.operation,this.protocol,e);return e instanceof d.RpcPendingResponse?(this._pending=!0,t.objects=e.message,this.protocol.events.raiseEvent(h.RpcProtocolEvent.BackendReportedPending,this)):e instanceof d.RpcNotFoundResponse?(this._notFound=!0,this.protocol.events.raiseEvent(h.RpcProtocolEvent.BackendReportedNotFound,this)):(this._threw=!0,this.protocol.events.raiseEvent(h.RpcProtocolEvent.BackendErrorOccurred,this)),this.fulfill(t,e)}fulfill(e,t){return{result:e,rawResult:t,status:this.protocol.getCode(this.status),id:this.request.id,interfaceName:this.operation.interfaceDefinition.name}}lookupOperationFunction(e){const t=e[this.operation.operationName];if(!t||"function"!==typeof t)throw new n.IModelError(32768,`RPC interface class "${e.constructor.name}" does not implement operation "${this.operation.operationName}".`,o.Logger.logError,"imodeljs-backend.RpcInterface");return t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(58),o=r(43),s=r(3),a=r(281);var c,l,u;!function(e){e[e.None=0]="None",e[e.ByView=1]="ByView",e[e.Always=2]="Always",e[e.Behind=4]="Behind",e[e.Blanking=6]="Blanking",e[e.Background=8]="Background"}(c=t.FillFlags||(t.FillFlags={})),function(e){e[e.Normal=0]="Normal",e[e.Edge=1]="Edge",e[e.Outline=2]="Outline"}(l=t.PolylineTypeFlags||(t.PolylineTypeFlags={}));class PolylineFlags{constructor(e=!1,t=!1,r=!1,n=l.Normal){this.isDisjoint=r,this.isPlanar=t,this.is2d=e,this.type=n}clone(){return new PolylineFlags(this.is2d,this.isPlanar,this.isDisjoint,this.type)}static unpack(e){const t=0!==(1&e),r=0!==(2&e),n=0!==(4&e),i=e>>3;return i===l.Normal||i===l.Edge||l.Outline,new PolylineFlags(n,r,t,i)}initDefaults(){this.isDisjoint=this.isPlanar=this.is2d=!1,this.type=l.Normal}get isOutlineEdge(){return l.Outline===this.type}get isNormalEdge(){return l.Edge===this.type}get isAnyEdge(){return l.Normal!==this.type}setIsNormalEdge(){this.type=l.Edge}setIsOutlineEdge(){this.type=l.Outline}pack(){let e=0;return this.isDisjoint&&(e+=1),this.isPlanar&&(e+=2),this.is2d&&(e+=4),e+=this.type<<3}equals(e){return this.type===e.type&&this.is2d===e.is2d&&this.isPlanar===e.isPlanar&&this.isDisjoint===e.isDisjoint}}t.PolylineFlags=PolylineFlags;t.PolylineData=class PolylineData{constructor(e=[],t=0,r=0){this.vertIndices=e,this.numIndices=t,this.startDistance=r}get isValid(){return 0<this.numIndices}reset(){this.numIndices=0,this.vertIndices=[],this.startDistance=0}init(e){return this.numIndices=e.indices.length,this.vertIndices=0<this.numIndices?e.indices:[],this.startDistance=e.startDistance,this.isValid}};t.MeshPolyline=class MeshPolyline{constructor(e=0,t=[]){this.indices=t.slice(),this.startDistance=e}addIndex(e){const{indices:t}=this;0!==t.length&&t[t.length-1]===e||t.push(e)}clear(){this.indices.length=0}};class MeshPolylineList extends Array{constructor(...e){super(...e)}}t.MeshPolylineList=MeshPolylineList;t.MeshEdge=class MeshEdge{constructor(e,t){this.indices=[0,0],void 0!==e&&void 0!==t&&(e<t?(this.indices[0]=e,this.indices[1]=t):(this.indices[0]=t,this.indices[1]=e))}};t.MeshEdges=class MeshEdges{constructor(){this.visible=[],this.silhouette=[],this.polylines=new MeshPolylineList,this.silhouetteNormals=[]}};class EdgeArgs{init(e){return this.clear(),void 0!==e&&0<e.visible.length&&(this.edges=e.visible),this.isValid}clear(){this.edges=void 0}get isValid(){return 0<this.numEdges}get numEdges(){return void 0!==this.edges?this.edges.length:0}}t.EdgeArgs=EdgeArgs;t.SilhouetteEdgeArgs=class SilhouetteEdgeArgs extends EdgeArgs{init(e){return this.clear(),void 0!==e&&0<e.silhouette.length&&(this.edges=e.silhouette,this.normals=e.silhouetteNormals),this.isValid}clear(){this.normals=void 0,super.clear()}};t.PolylineEdgeArgs=class PolylineEdgeArgs{constructor(e){this.init(e)}init(e){return this.lines=void 0!==e&&0<e.length?e:void 0,this.isValid}get numLines(){return void 0!==this.lines?this.lines.length:0}get isValid(){return this.numLines>0}clear(){this.lines=void 0}};class RenderTexture{get isTileSection(){return 2===this.type}get isGlyph(){return 1===this.type}get isSkyBox(){return 3===this.type}constructor(e){this.key=e.key,this.type=e.type,this.isOwned=e.isOwned}}t.RenderTexture=RenderTexture,function(e){let t;!function(e){e[e.Normal=0]="Normal",e[e.Glyph=1]="Glyph",e[e.TileSection=2]="TileSection",e[e.SkyBox=3]="SkyBox"}(t=e.Type||(e.Type={}));class Params{constructor(e,t=0,r=!1){this.key=e,this.type=t,this.isOwned=r}get isTileSection(){return 2===this.type}get isGlyph(){return 1===this.type}get isSkyBox(){return 3===this.type}}Params.defaults=new Params,e.Params=Params}(RenderTexture=t.RenderTexture||(t.RenderTexture={}));class RenderMaterial{constructor(e){this.key=e.key,this.textureMapping=e.textureMapping}get hasTexture(){return void 0!==this.textureMapping&&void 0!==this.textureMapping.texture}}t.RenderMaterial=RenderMaterial,function(e){class Params{constructor(e){this.diffuse=.6,this.specular=.4,this.specularExponent=13.5,this.reflect=0,this.transparency=0,this.refract=1,this.ambient=.3,this.shadows=!0,this.key=e}static fromColors(e,t,r,n,i,o){const s=new Params;return s.key=e,s.diffuseColor=t,s.specularColor=r,s.emissiveColor=n,s.reflectColor=i,s.textureMapping=o,s}}Params.defaults=new Params,e.Params=Params}(RenderMaterial=t.RenderMaterial||(t.RenderMaterial={})),Object.freeze(RenderMaterial.Params.defaults),function(e){e.Solar=class Solar{constructor(e=new s.Vector3d,t=i.ColorDef.white,r=0){this.direction=e,this.color=t,this.intensity=r}}}(t.ImageLight||(t.ImageLight={}));class GraphicParams{constructor(){this.fillFlags=c.None,this.linePixels=0,this.rasterWidth=1,this.lineColor=new i.ColorDef,this.fillColor=new i.ColorDef,this.trueWidthStart=0,this.trueWidthEnd=0}setLineColor(e){this.lineColor.setFrom(e)}setLineTransparency(e){this.lineColor.setAlpha(e)}setFillColor(e){this.fillColor.setFrom(e)}setFillTransparency(e){this.fillColor.setAlpha(e)}setLinePixels(e){this.linePixels=e,this.lineTexture=void 0}static fromSymbology(e,t,r,n=0){const i=new GraphicParams;return i.setLineColor(e),i.setFillColor(t),i.rasterWidth=r,i.setLinePixels(n),i}static fromBlankingFill(e){const t=new GraphicParams;return t.setFillColor(e),t.fillFlags=c.Blanking,t}}t.GraphicParams=GraphicParams,function(e){e[e.Detect=0]="Detect",e[e.On=1]="On",e[e.Off=2]="Off"}(t.AntiAliasPref||(t.AntiAliasPref={})),function(e){e[e.Wireframe=0]="Wireframe",e[e.SmoothShade=6]="SmoothShade",e[e.HiddenLine=3]="HiddenLine",e[e.SolidFill=4]="SolidFill"}(t.RenderMode||(t.RenderMode={}));class Camera{static isValidLensAngle(e){return e.radians>Math.PI/8&&e.radians<Math.PI}static validateLensAngle(e){this.isValidLensAngle(e)||e.setRadians(Math.PI/2)}invalidateFocus(){this.focusDist=0}get isFocusValid(){return this.focusDist>0&&this.focusDist<1e14}getFocusDistance(){return this.focusDist}setFocusDistance(e){this.focusDist=e}get isLensValid(){return Camera.isValidLensAngle(this.lens)}validateLens(){Camera.validateLensAngle(this.lens)}getLensAngle(){return this.lens}setLensAngle(e){this.lens.setFrom(e)}getEyePoint(){return this.eye}setEyePoint(e){this.eye.setFrom(e)}get isValid(){return this.isLensValid&&this.isFocusValid}equals(e){return this.lens===e.lens&&this.focusDist===e.focusDist&&this.eye.isExactEqual(e.eye)}clone(){return new Camera(this)}copyFrom(e){this.lens.setFrom(e.lens),this.focusDist=e.focusDist,this.eye.setFrom(e.eye)}constructor(e){this.lens=s.Angle.fromJSON(e.lens),this.focusDist=n.JsonUtils.asDouble(e.focusDist),this.eye=s.Point3d.fromJSON(e.eye)}}t.Camera=Camera;class ViewFlags{constructor(){this.renderMode=0,this.dimensions=!0,this.patterns=!0,this.weights=!0,this.styles=!0,this.transparency=!0,this.continuousRendering=!1,this.fill=!0,this.textures=!0,this.materials=!0,this.acsTriad=!1,this.grid=!1,this.visibleEdges=!1,this.hiddenEdges=!1,this.sourceLights=!1,this.cameraLights=!1,this.solarLight=!1,this.shadows=!1,this.clipVolume=!0,this.constructions=!1,this.monochrome=!1,this.noGeometryMap=!1,this.backgroundMap=!1,this.hLineMaterialColors=!1,this.edgeMask=0}clone(e){return ViewFlags.createFrom(this,e)}static createFrom(e,t){const r=void 0!==t?t:new ViewFlags;return e&&(r.renderMode=e.renderMode,r.dimensions=e.dimensions,r.patterns=e.patterns,r.weights=e.weights,r.styles=e.styles,r.transparency=e.transparency,r.continuousRendering=e.continuousRendering,r.fill=e.fill,r.textures=e.textures,r.materials=e.materials,r.acsTriad=e.acsTriad,r.grid=e.grid,r.visibleEdges=e.visibleEdges,r.hiddenEdges=e.hiddenEdges,r.sourceLights=e.sourceLights,r.cameraLights=e.cameraLights,r.solarLight=e.solarLight,r.shadows=e.shadows,r.clipVolume=e.clipVolume,r.constructions=e.constructions,r.monochrome=e.monochrome,r.noGeometryMap=e.noGeometryMap,r.hLineMaterialColors=e.hLineMaterialColors,r.backgroundMap=e.backgroundMap,r.edgeMask=e.edgeMask),r}hiddenEdgesVisible(){switch(this.renderMode){case 4:case 3:return this.hiddenEdges;case 6:return this.visibleEdges&&this.hiddenEdges}return!0}toJSON(){const e={};return this.constructions||(e.noConstruct=!0),this.dimensions||(e.noDim=!0),this.patterns||(e.noPattern=!0),this.weights||(e.noWeight=!0),this.styles||(e.noStyle=!0),this.transparency||(e.noTransp=!0),this.continuousRendering&&(e.contRend=!0),this.fill||(e.noFill=!0),this.grid&&(e.grid=!0),this.acsTriad&&(e.acs=!0),this.textures||(e.noTexture=!0),this.materials||(e.noMaterial=!0),this.cameraLights||(e.noCameraLights=!0),this.sourceLights||(e.noSourceLights=!0),this.solarLight||(e.noSolarLight=!0),this.visibleEdges&&(e.visEdges=!0),this.hiddenEdges&&(e.hidEdges=!0),this.shadows&&(e.shadows=!0),this.clipVolume&&(e.clipVol=!0),this.hLineMaterialColors&&(e.hlMatColors=!0),this.monochrome&&(e.monochrome=!0),this.backgroundMap&&(e.backgroundMap=!0),0!==this.edgeMask&&(e.edgeMask=this.edgeMask),e.renderMode=this.renderMode,e}static fromJSON(e){const t=new ViewFlags;if(!e)return t;t.constructions=!n.JsonUtils.asBool(e.noConstruct),t.dimensions=!n.JsonUtils.asBool(e.noDim),t.patterns=!n.JsonUtils.asBool(e.noPattern),t.weights=!n.JsonUtils.asBool(e.noWeight),t.styles=!n.JsonUtils.asBool(e.noStyle),t.transparency=!n.JsonUtils.asBool(e.noTransp),t.continuousRendering=n.JsonUtils.asBool(e.contRend),t.fill=!n.JsonUtils.asBool(e.noFill),t.grid=n.JsonUtils.asBool(e.grid),t.acsTriad=n.JsonUtils.asBool(e.acs),t.textures=!n.JsonUtils.asBool(e.noTexture),t.materials=!n.JsonUtils.asBool(e.noMaterial),t.cameraLights=!n.JsonUtils.asBool(e.noCameraLights),t.sourceLights=!n.JsonUtils.asBool(e.noSourceLights),t.solarLight=!n.JsonUtils.asBool(e.noSolarLight),t.visibleEdges=n.JsonUtils.asBool(e.visEdges),t.hiddenEdges=n.JsonUtils.asBool(e.hidEdges),t.shadows=n.JsonUtils.asBool(e.shadows),t.clipVolume=n.JsonUtils.asBool(e.clipVol),t.monochrome=n.JsonUtils.asBool(e.monochrome),t.edgeMask=n.JsonUtils.asInt(e.edgeMask),t.hLineMaterialColors=n.JsonUtils.asBool(e.hlMatColors),t.backgroundMap=n.JsonUtils.asBool(e.backgroundMap);const r=n.JsonUtils.asInt(e.renderMode);return t.renderMode=r<3?0:r>4?6:r,t}equals(e){return this.renderMode===e.renderMode&&this.dimensions===e.dimensions&&this.patterns===e.patterns&&this.weights===e.weights&&this.styles===e.styles&&this.transparency===e.transparency&&this.continuousRendering===e.continuousRendering&&this.fill===e.fill&&this.textures===e.textures&&this.materials===e.materials&&this.acsTriad===e.acsTriad&&this.grid===e.grid&&this.visibleEdges===e.visibleEdges&&this.hiddenEdges===e.hiddenEdges&&this.sourceLights===e.sourceLights&&this.cameraLights===e.cameraLights&&this.solarLight===e.solarLight&&this.shadows===e.shadows&&this.clipVolume===e.clipVolume&&this.constructions===e.constructions&&this.monochrome===e.monochrome&&this.noGeometryMap===e.noGeometryMap&&this.hLineMaterialColors===e.hLineMaterialColors&&this.backgroundMap===e.backgroundMap&&this.edgeMask===e.edgeMask}}t.ViewFlags=ViewFlags,function(e){let t;!function(e){e[e.kRenderMode=0]="kRenderMode",e[e.kText=1]="kText",e[e.kDimensions=2]="kDimensions",e[e.kPatterns=3]="kPatterns",e[e.kWeights=4]="kWeights",e[e.kStyles=5]="kStyles",e[e.kTransparency=6]="kTransparency",e[e.kContinuousRendering=7]="kContinuousRendering",e[e.kFill=8]="kFill",e[e.kTextures=9]="kTextures",e[e.kMaterials=10]="kMaterials",e[e.kVisibleEdges=11]="kVisibleEdges",e[e.kHiddenEdges=12]="kHiddenEdges",e[e.kSourceLights=13]="kSourceLights",e[e.kCameraLights=14]="kCameraLights",e[e.kSolarLight=15]="kSolarLight",e[e.kShadows=16]="kShadows",e[e.kClipVolume=17]="kClipVolume",e[e.kConstructions=18]="kConstructions",e[e.kMonochrome=19]="kMonochrome",e[e.kGeometryMap=20]="kGeometryMap",e[e.kHlineMaterialColors=21]="kHlineMaterialColors",e[e.kEdgeMask=22]="kEdgeMask",e[e.kBackgroundMap=23]="kBackgroundMap"}(t=e.PresenceFlag||(e.PresenceFlag={}));class Overrides{constructor(e){this._present=0,this._values=new ViewFlags,void 0!==e&&this.overrideAll(e)}setPresent(e){this._present|=1<<e}isPresent(e){return 0!==(this._present&1<<e)}overrideAll(e){ViewFlags.createFrom(e,this._values),this._present=4294967295}clone(e){const t=void 0!==e?e:new Overrides;return t.copyFrom(this),t}copyFrom(e){e._values.clone(this._values),this._present=e._present}setShowDimensions(e){this._values.dimensions=e,this.setPresent(2)}setShowPatterns(e){this._values.patterns=e,this.setPresent(3)}setShowWeights(e){this._values.weights=e,this.setPresent(4)}setShowStyles(e){this._values.styles=e,this.setPresent(5)}setShowTransparency(e){this._values.transparency=e,this.setPresent(6)}setShowFill(e){this._values.fill=e,this.setPresent(8)}setShowTextures(e){this._values.textures=e,this.setPresent(9)}setShowMaterials(e){this._values.materials=e,this.setPresent(10)}setShowSourceLights(e){this._values.sourceLights=e,this.setPresent(13)}setShowCameraLights(e){this._values.cameraLights=e,this.setPresent(14)}setShowSolarLight(e){this._values.solarLight=e,this.setPresent(15)}setShowVisibleEdges(e){this._values.visibleEdges=e,this.setPresent(11)}setShowHiddenEdges(e){this._values.hiddenEdges=e,this.setPresent(12)}setShowShadows(e){this._values.shadows=e,this.setPresent(16)}setShowClipVolume(e){this._values.clipVolume=e,this.setPresent(17)}setShowConstructions(e){this._values.constructions=e,this.setPresent(18)}setMonochrome(e){this._values.monochrome=e,this.setPresent(19)}setIgnoreGeometryMap(e){this._values.noGeometryMap=e,this.setPresent(20)}setShowBackgroundMap(e){this._values.backgroundMap=e,this.setPresent(23)}setUseHlineMaterialColors(e){this._values.hLineMaterialColors=e,this.setPresent(21)}setEdgeMask(e){this._values.edgeMask=e,this.setPresent(22)}setRenderMode(e){this._values.renderMode=e,this.setPresent(0)}anyOverridden(){return 0!==this._present}clear(){this._present=0}apply(e){return this.anyOverridden()?(this.isPresent(2)&&(e.dimensions=this._values.dimensions),this.isPresent(3)&&(e.patterns=this._values.patterns),this.isPresent(4)&&(e.weights=this._values.weights),this.isPresent(5)&&(e.styles=this._values.styles),this.isPresent(6)&&(e.transparency=this._values.transparency),this.isPresent(8)&&(e.fill=this._values.fill),this.isPresent(9)&&(e.textures=this._values.textures),this.isPresent(10)&&(e.materials=this._values.materials),this.isPresent(15)&&(e.solarLight=this._values.solarLight),this.isPresent(14)&&(e.cameraLights=this._values.cameraLights),this.isPresent(13)&&(e.sourceLights=this._values.sourceLights),this.isPresent(11)&&(e.visibleEdges=this._values.visibleEdges),this.isPresent(12)&&(e.hiddenEdges=this._values.hiddenEdges),this.isPresent(16)&&(e.shadows=this._values.shadows),this.isPresent(17)&&(e.clipVolume=this._values.clipVolume),this.isPresent(18)&&(e.constructions=this._values.constructions),this.isPresent(19)&&(e.monochrome=this._values.monochrome),this.isPresent(20)&&(e.noGeometryMap=this._values.noGeometryMap),this.isPresent(23)&&(e.backgroundMap=this._values.backgroundMap),this.isPresent(21)&&(e.hLineMaterialColors=this._values.hLineMaterialColors),this.isPresent(22)&&(e.edgeMask=this._values.edgeMask),this.isPresent(0)&&(e.renderMode=this._values.renderMode),e):e}}e.Overrides=Overrides}(t.ViewFlag||(t.ViewFlag={})),function(e){e[e.Solid=0]="Solid",e[e.Code0=0]="Code0",e[e.Code1=2155905152]="Code1",e[e.Code2=4177066232]="Code2",e[e.Code3=4292935648]="Code3",e[e.Code4=4262526480]="Code4",e[e.Code5=3772834016]="Code5",e[e.Code6=4169726088]="Code6",e[e.Code7=4279828248]="Code7",e[e.HiddenLine=3435973836]="HiddenLine",e[e.Invisible=1]="Invisible",e[e.Invalid=-1]="Invalid"}(t.LinePixels||(t.LinePixels={}));class FrustumPlanes{constructor(e){void 0!==e&&this.init(e)}get isValid(){return void 0!==this._planes}init(e){void 0===this._planes?this._planes=[]:this._planes.length=0,FrustumPlanes.addPlaneFromPoints(this._planes,e.points,1,3,5),FrustumPlanes.addPlaneFromPoints(this._planes,e.points,0,4,2),FrustumPlanes.addPlaneFromPoints(this._planes,e.points,2,6,3),FrustumPlanes.addPlaneFromPoints(this._planes,e.points,0,1,4),FrustumPlanes.addPlaneFromPoints(this._planes,e.points,0,2,1),FrustumPlanes.addPlaneFromPoints(this._planes,e.points,4,5,6)}computeFrustumContainment(e){return this.computeContainment(e.points)}intersectsFrustum(e){return 0!==this.computeFrustumContainment(e)}containsPoint(e,t=1e-8){return 0!==this.computeContainment([e],t)}computeContainment(e,t=1e-8){if(this.isValid,void 0===this._planes)return 0;let r=!0;for(const n of this._planes){let i=0;for(const o of e)n.evaluatePoint(o)+t<0&&(++i,r=!1);if(i===e.length)return 0}return r?2:1}intersectsRay(e,t){if(this.isValid,void 0===this._planes)return!1;let r=1e37,n=-r;for(const i of this._planes){const o=i.dotProductVector(t),s=i.evaluatePoint(e);if(0===o){if(s<0)return!1}else{const e=-s/o;o<0?r=Math.min(e,r):n=Math.max(e,n)}}return n<=r}}t.FrustumPlanes=FrustumPlanes,function(e){let t;!function(e){e[e.Outside=0]="Outside",e[e.Partial=1]="Partial",e[e.Inside=2]="Inside"}(t=e.Containment||(e.Containment={})),e.addPlaneFromPoints=function(e,t,r,n,i,o=1e-6){const a=s.Vector3d.createCrossProductToPoints(t[i],t[n],t[r]);a.normalizeInPlace();const c=s.ClipPlane.createNormalAndDistance(a,a.dotProduct(t[r])-o);void 0!==c&&e.push(c)}}(FrustumPlanes=t.FrustumPlanes||(t.FrustumPlanes={})),function(e){class Style{constructor(e){if(void 0!==e){if(void 0!==e.color&&!1!==e.ovrColor&&(this.color=i.ColorDef.fromJSON(e.color)),void 0!==e.pattern){const t=n.JsonUtils.asInt(e.pattern,-1);-1!==t&&(this.pattern=t)}if(void 0!==e.width){let t=n.JsonUtils.asInt(e.width,0);0!==t&&(t=Math.max(1,t),this.width=Math.min(32,t))}}}get ovrColor(){return void 0!==this.color}static fromJSON(e){return void 0!==e?new Style(e):this.defaults}overrideColor(e){return void 0!==this.color&&this.color.equals(e)?this:Style.fromJSON({color:e,ovrColor:!0,pattern:this.pattern,width:this.width})}equals(e){return this===e||this.ovrColor===e.ovrColor&&this.pattern===e.pattern&&this.width===e.width&&(void 0===this.color||this.color.equals(e.color))}toJSON(){return{ovrColor:this.ovrColor,color:void 0!==this.color?this.color:i.ColorDef.white,pattern:void 0!==this.pattern?this.pattern:-1,width:void 0!==this.width?this.width:0}}}Style.defaults=new Style({}),e.Style=Style;class Settings{constructor(e){this.visible=Style.fromJSON(e.visible),this.hidden=Style.fromJSON(e.hidden),this.transparencyThreshold=n.JsonUtils.asDouble(e.transThreshold,1)}get transThreshold(){return this.transparencyThreshold}static fromJSON(e){return void 0===e?this.defaults:e instanceof Settings?e:new Settings(e)}toJSON(){return{visible:this.visible.toJSON(),hidden:this.hidden.toJSON(),transThreshold:this.transThreshold}}}Settings.defaults=new Settings({}),e.Settings=Settings}(t.HiddenLine||(t.HiddenLine={})),function(e){let t,r,n,o;!function(e){e[e.None=0]="None",e[e.Invert=1]="Invert",e[e.Outline=2]="Outline"}(t=e.Flags||(e.Flags={})),function(e){e[e.None=0]="None",e[e.Linear=1]="Linear",e[e.Curved=2]="Curved",e[e.Cylindrical=3]="Cylindrical",e[e.Spherical=4]="Spherical",e[e.Hemispherical=5]="Hemispherical",e[e.Thematic=6]="Thematic"}(r=e.Mode||(e.Mode={})),function(e){e[e.Smooth=0]="Smooth",e[e.Stepped=1]="Stepped",e[e.SteppedWithDelimiter=2]="SteppedWithDelimiter",e[e.IsoLines=3]="IsoLines"}(n=e.ThematicMode||(e.ThematicMode={})),function(e){e[e.BlueRed=0]="BlueRed",e[e.RedBlue=1]="RedBlue",e[e.Monochrome=2]="Monochrome",e[e.Topographic=3]="Topographic",e[e.SeaMountain=4]="SeaMountain",e[e.Custom=5]="Custom"}(o=e.ThematicColorScheme||(e.ThematicColorScheme={}));class ThematicSettings{constructor(){this.mode=0,this.stepCount=10,this.marginColor=i.ColorDef.from(63,63,63),this.colorScheme=0,this.rangeLow=1e200,this.rangeHigh=-1e200}get range(){return this.rangeLow>this.rangeHigh?s.Range1d.createNull():s.Range1d.createXX(this.rangeLow,this.rangeHigh)}set range(e){this.rangeLow=e.low,this.rangeHigh=e.high}static get margin(){return.001}static get contentRange(){return 1-2*ThematicSettings.margin}static get contentMax(){return 1-ThematicSettings.margin}static fromJSON(e){const t=new ThematicSettings;return t.mode=e.mode,t.stepCount=e.stepCount,t.marginColor=new i.ColorDef(e.marginColor),t.colorScheme=e.colorScheme,t.rangeLow=e.rangeLow,t.rangeHigh=e.rangeHigh,t}clone(e){const t=void 0!==e?e:new ThematicSettings;return t.copyFrom(this),t}copyFrom(e){this.mode=e.mode,this.stepCount=e.stepCount,this.marginColor=new i.ColorDef(e.marginColor),this.colorScheme=e.colorScheme,this.rangeLow=e.rangeLow,this.rangeHigh=e.rangeHigh}}ThematicSettings.defaults=new ThematicSettings,e.ThematicSettings=ThematicSettings;class KeyColor{constructor(e){this.value=e.value,this.color=new i.ColorDef(e.color)}}e.KeyColor=KeyColor;class Symb{constructor(){this.mode=0,this.flags=0,this.shift=0,this.keys=[]}static fromJSON(e){const t=new Symb;return e?(t.mode=e.mode,t.flags=void 0===e.flags?0:e.flags,t.angle=e.angle?s.Angle.fromJSON(e.angle):void 0,t.tint=e.tint,t.shift=e.shift?e.shift:0,e.keys.forEach(e=>t.keys.push(new KeyColor(e))),t.thematicSettings=void 0===e.thematicSettings?void 0:ThematicSettings.fromJSON(e.thematicSettings),t):t}static createThematic(e){const t=new Symb;if(t.mode=6,t.thematicSettings=e,e.colorScheme<5){const r=[[[0,0,255,0],[.25,0,255,255],[.5,0,0,255],[.75,255,0,255],[1,255,0,0]],[[0,255,0,0],[.25,255,0,255],[.5,0,0,255],[.75,0,255,255],[1,0,255,0]],[[0,0,0,0],[1,255,255,255]],[[0,152,148,188],[.5,204,160,204],[1,152,72,128]],[[0,0,255,0],[.2,72,96,160],[.4,152,96,160],[.6,128,32,104],[.7,148,180,128],[1,240,240,240]]];for(const n of r[e.colorScheme])t.keys.push(new KeyColor({value:n[0],color:i.ColorDef.from(n[1],n[3],n[2])}))}return t}clone(){return Symb.fromJSON(this)}equals(e){return 0===Symb.compareSymb(this,e)}static compareSymb(e,t){if(e===t)return 0;if(e.mode!==t.mode)return e.mode-t.mode;if(e.flags!==t.flags)return void 0===e.flags?-1:void 0===t.flags?1:e.flags-t.flags;if(e.tint!==t.tint)return void 0===e.tint?-1:void 0===t.tint?1:e.tint-t.tint;if(e.shift!==t.shift)return void 0===e.shift?-1:void 0===t.shift?1:e.shift-t.shift;if(void 0===e.angle!==(void 0===t.angle))return void 0===e.angle?-1:1;if(e.angle&&!e.angle.isAlmostEqualNoPeriodShift(t.angle))return e.angle.radians-t.angle.radians;if(e.keys.length!==t.keys.length)return e.keys.length-t.keys.length;for(let r=0;r<e.keys.length;r++){if(e.keys[r].value!==t.keys[r].value)return e.keys[r].value-t.keys[r].value;if(!e.keys[r].color.equals(t.keys[r].color))return e.keys[r].color.tbgr-t.keys[r].color.tbgr}return 0}compare(t){return e.Symb.compareSymb(this,t)}roundToByte(e){return 255&Math.min(e+.5,255)}mapColor(e){e<0?e=0:e>1&&(e=1),0!==(1&this.flags)&&(e=1-e);let t,r,n,o=0;if(this.keys.length<=2)r=1-e,n=e;else{for(;o<this.keys.length-2&&e>this.keys[o+1].value;)o++;r=1-(n=(t=this.keys[o+1].value-this.keys[o].value)<1e-4?0:(e-this.keys[o].value)/t)}const s=this.keys[o].color,a=this.keys[o+1].color,c=s.colors,l=a.colors,u=r*c.r+n*l.r,d=r*c.g+n*l.g,h=r*c.b+n*l.b,p=r*c.t+n*l.t;return i.ColorDef.from(this.roundToByte(u),this.roundToByte(d),this.roundToByte(h),this.roundToByte(p))}get hasTranslucency(){for(const e of this.keys)if(!e.color.isOpaque)return!0;return!1}get isOutlined(){return 0!==(2&this.flags)}getImage(e,t){6===this.mode&&(e=1,t=8192);const r=this.hasTranslucency,n=void 0===this.angle?0:this.angle.radians,o=Math.cos(n),s=Math.sin(n),c=new Uint8Array(e*t*(r?4:3));let l=c.length-1;const u=Math.min(1,Math.abs(this.shift));switch(this.mode){case 1:case 3:{const n=.5-.25*u*o,i=.5-.25*u*s;let a,d,h=a=0;for(let e=0;e<2;e++)for(let t=0;t<2;t++)(d=(t-n)*o+(e-i)*s)<h&&(h=d),d>a&&(a=d);for(let u=0;u<t;u++){const p=u/t-i;for(let t=0;t<e;t++){let i;d=(t/e-n)*o+p*s,i=1===this.mode?d>0?.5+.5*d/a:.5-.5*d/h:d>0?Math.sin(Math.PI/2*(1-d/a)):Math.sin(Math.PI/2*(1-d/h));const u=this.mapColor(i);r&&(c[l--]=u.getAlpha()),c[l--]=u.colors.b,c[l--]=u.colors.g,c[l--]=u.colors.r}}break}case 2:{const n=.5+.5*s-.25*u*o,i=.5-.5*o-.25*u*s;for(let a=0;a<t;a++){const u=a/t-i;for(let t=0;t<e;t++){const i=t/e-n,a=.8*(i*o+u*s),d=u*o-i*s,h=Math.sin(Math.PI/2*(1-Math.sqrt(a*a+d*d))),p=this.mapColor(h);r&&(c[l--]=p.getAlpha()),c[l--]=p.colors.b,c[l--]=p.colors.g,c[l--]=p.colors.r}}break}case 4:{const i=.5+.125*Math.sin(2*n),a=.5*u*(o+s)*i,d=.5*u*(s-o)*i;for(let n=0;n<t;n++){const o=d+n/t-.5;for(let t=0;t<e;t++){const n=a+t/e-.5,s=Math.sin(Math.PI/2*(1-Math.sqrt(n*n+o*o)/i)),u=this.mapColor(s);r&&(c[l--]=u.getAlpha()),c[l--]=u.colors.b,c[l--]=u.colors.g,c[l--]=u.colors.r}}break}case 5:{const n=.5+.5*s-.5*u*o,i=.5-.5*o-.5*u*s;for(let o=0;o<t;o++){const s=o/t-i;for(let t=0;t<e;t++){const i=t/e-n,o=Math.sin(Math.PI/2*(1-Math.sqrt(i*i+s*s))),a=this.mapColor(o);r&&(c[l--]=a.getAlpha()),c[l--]=a.colors.b,c[l--]=a.colors.g,c[l--]=a.colors.r}}break}case 6:{let n=this.thematicSettings;void 0===n&&(n=ThematicSettings.defaults);for(let o=0;o<t;o++){let s,a=1-o/t;if(a<ThematicSettings.margin||a>ThematicSettings.contentMax)s=n.marginColor;else switch(a=(a-ThematicSettings.margin)/ThematicSettings.contentRange,n.mode){case 2:case 1:if(0!==n.stepCount){const e=Math.floor(a*n.stepCount+.99999)/n.stepCount,t=1/1024;s=2===n.mode&&Math.abs(e-a)<t?new i.ColorDef(4278190080):this.mapColor(e)}break;case 0:s=this.mapColor(a)}for(let t=0;t<e;t++)r&&(c[l--]=s.getAlpha()),c[l--]=s.colors.b,c[l--]=s.colors.g,c[l--]=s.colors.r}}}const d=a.ImageBuffer.create(c,r?0:2,e);return d}}e.Symb=Symb}(u=t.Gradient||(t.Gradient={})),function(e){e[e.Never=0]="Never",e[e.ByView=1]="ByView",e[e.Always=2]="Always",e[e.Blanking=3]="Blanking"}(t.FillDisplay||(t.FillDisplay={})),function(e){e[e.None=0]="None",e[e.Solid=1]="Solid",e[e.Outline=2]="Outline"}(t.BackgroundFill||(t.BackgroundFill={})),function(e){e[e.Primary=0]="Primary",e[e.Construction=1]="Construction",e[e.Dimension=2]="Dimension",e[e.Pattern=3]="Pattern"}(t.GeometryClass||(t.GeometryClass={}));t.SceneLights=class SceneLights{constructor(e,t=0){this.imageBased=e,this.fstop=t,this._list=[]}get isEmpty(){return 0===this._list.length}addLight(e){e.isValid&&this._list.push(e)}};class GeometryParams{constructor(e,t=n.Id64.invalid){this.categoryId=e,this.subCategoryId=t,n.Id64.isValid(t)&&(this.subCategoryId=o.IModel.getDefaultSubCategoryId(e))}clone(){const e=new GeometryParams(this.categoryId,this.subCategoryId);return e.materialId=this.materialId,e.elmPriority=this.elmPriority,e.weight=this.weight,e.lineColor=this.lineColor?this.lineColor.clone():void 0,e.fillColor=this.fillColor?this.fillColor.clone():void 0,e.backgroundFill=this.backgroundFill,e.fillDisplay=this.fillDisplay,e.elmTransparency=this.elmTransparency,e.fillTransparency=this.fillTransparency,e.geometryClass=this.geometryClass,e.styleInfo=this.styleInfo?this.styleInfo.clone():void 0,e.gradient=this.gradient?this.gradient.clone():void 0,e.pattern=this.pattern?this.pattern.clone():void 0,e}resetAppearance(){this.materialId=void 0,this.elmPriority=void 0,this.weight=void 0,this.lineColor=void 0,this.fillColor=void 0,this.backgroundFill=void 0,this.fillDisplay=void 0,this.elmTransparency=void 0,this.fillTransparency=void 0,this.geometryClass=void 0,this.styleInfo=void 0,this.gradient=void 0,this.pattern=void 0}isEquivalent(e){if(this===e)return!0;if(this.categoryId!==e.categoryId)return!1;if(this.subCategoryId!==e.subCategoryId)return!1;if(this.geometryClass!==e.geometryClass)return!1;if(this.elmPriority!==e.elmPriority)return!1;if(this.elmTransparency!==e.elmTransparency)return!1;if(this.fillTransparency!==e.fillTransparency)return!1;if(void 0===this.lineColor!==(void 0===e.lineColor))return!1;if(this.lineColor&&!this.lineColor.equals(e.lineColor))return!1;if(this.weight!==e.weight)return!1;if(void 0===this.materialId!==(void 0===e.materialId))return!1;if(this.materialId&&this.materialId!==e.materialId)return!1;if(void 0===this.styleInfo!==(void 0===e.styleInfo))return!1;if(this.styleInfo&&!this.styleInfo.equals(e.styleInfo))return!1;if(this.fillDisplay!==e.fillDisplay)return!1;if(void 0!==this.fillDisplay&&0!==this.fillDisplay){if(void 0===this.gradient!==(void 0===e.gradient))return!1;if(this.gradient&&!this.gradient.equals(e.gradient))return!1;if(this.backgroundFill!==e.backgroundFill)return!1;if(void 0===this.backgroundFill||0===this.backgroundFill){if(void 0===this.fillColor!==(void 0===e.fillColor))return!1;if(this.fillColor&&!this.fillColor.equals(e.fillColor))return!1}}return void 0===this.pattern===(void 0===e.pattern)&&!(this.pattern&&!this.pattern.equals(e.pattern))}setCategoryId(e,t=!0){this.categoryId=e,this.subCategoryId=o.IModel.getDefaultSubCategoryId(e),t&&this.resetAppearance()}setSubCategoryId(e,t=!0){this.subCategoryId=e,t&&this.resetAppearance()}}t.GeometryParams=GeometryParams,function(e){let t;!function(e){e[e.None=0]="None",e[e.Thin=1]="Thin",e[e.Thick=2]="Thick"}(t=e.Silhouette||(e.Silhouette={}));class Settings{constructor(e=i.ColorDef.from(35,187,252),t=.25,r=0,n=1){this.color=e,this.silhouette=n,this.visibleRatio=Settings.clamp(t),this.hiddenRatio=Settings.clamp(r)}static clamp(e){return Math.min(1,Math.max(0,e))}}e.Settings=Settings}(t.Hilite||(t.Hilite={}));t.Feature=class Feature{constructor(e=n.Id64.invalid,t=n.Id64.invalid,r=0){this.elementId=e,this.subCategoryId=t,this.geometryClass=r}get isDefined(){return!n.Id64.isInvalid(this.elementId)||!n.Id64.isInvalid(this.subCategoryId)||0!==this.geometryClass}get isUndefined(){return!this.isDefined}equals(e){return 0===this.compare(e)}compare(e){if(this===e)return 0;let t=n.compareNumbers(this.geometryClass,e.geometryClass);return 0===t&&0===(t=n.compareStrings(this.elementId,e.elementId))&&(t=n.compareStrings(this.subCategoryId,e.subCategoryId)),t}},function(e){e[e.Primary=0]="Primary",e[e.Classifier=1]="Classifier"}(t.BatchType||(t.BatchType={}));t.FeatureTable=class FeatureTable extends n.IndexMap{constructor(e,t=n.Id64.invalid,r=0){super(n.compare,e),this.modelId=t,this.type=r}get maxFeatures(){return this._maximumSize}get anyDefined(){return this.length>1||1===this.length&&this._array[0].value.isDefined}get isUniform(){return 1===this.length}get uniform(){return 1===this.length?this._array[0].value:void 0}get isClassifier(){return 1===this.type}findFeature(e){for(const t of this._array)if(t.index===e)return t.value}insertWithIndex(e,t){const r=this.lowerBound(e);r.equal,this.isFull;const i=new n.IndexedValue(e,t);this._array.splice(r.index,0,i)}getArray(){return this._array}};class TextureMapping{constructor(e,t){this.texture=e,this.params=t}computeUVParams(e,t){return this.params.computeUVParams(e,t)}}t.TextureMapping=TextureMapping,function(e){let t;!function(e){e[e.None=-1]="None",e[e.Parametric=0]="Parametric",e[e.ElevationDrape=1]="ElevationDrape",e[e.Planar=2]="Planar",e[e.DirectionalDrape=3]="DirectionalDrape",e[e.Cubic=4]="Cubic",e[e.Spherical=5]="Spherical",e[e.Cylindrical=6]="Cylindrical",e[e.Solid=7]="Solid",e[e.FrontProject=8]="FrontProject"}(t=e.Mode||(e.Mode={}));class Trans2x3{constructor(e=1,t=0,r=0,n=0,i=1,o=0){this._vals=new Array(2);const s=this._vals;s[0]=[e,t,r],s[1]=[n,i,o]}setTransform(){const e=s.Transform.createIdentity(),t=this._vals,r=e.matrix;for(let n=0,i=2;n<2;++n)for(let e=0;e<i;++e)r.setAt(n,e,t[n][e]);e.origin.x=t[0][2],e.origin.y=t[1][2],this._transform=e}get transform(){return void 0===this._transform&&this.setTransform(),this._transform}}e.Trans2x3=Trans2x3;e.Params=class Params{constructor(e={}){const{textureMat2x3:t=new Trans2x3,textureWeight:r=1,mapMode:n=0,worldMapping:i=!1}=e;this.textureMatrix=t,this.weight=r,this.mode=n,this.worldMapping=i}computeUVParams(e,t){switch(this.mode){default:case 0:return this.computeParametricUVParams(e,this.textureMatrix.transform,!this.worldMapping);case 2:{const t=e.normalIndex;if(!t)return;return this.worldMapping&&(void 0===e.normalIndex||t[0]===t[1]&&t[0]===t[2])?this.computePlanarUVParams(e,this.textureMatrix.transform):this.computeParametricUVParams(e,this.textureMatrix.transform,!this.worldMapping)}case 1:return this.computeElevationDrapeUVParams(e,this.textureMatrix.transform,t)}}computeParametricUVParams(e,t,r){const n=[];for(let i=0;i<e.numEdgesThisFacet;i++){let o=s.Point2d.create();!r&&e.tryGetDistanceParameter(i,o)||e.tryGetNormalizedParameter(i,o)||(o=e.getParam(i)),n.push(t.multiplyPoint2d(o))}return n}computePlanarUVParams(e,t){const r=[],n=e.point;let i;if(!(i=void 0===e.normal?n.getPoint3dAt(0).crossProductToPoints(n.getPoint3dAt(1),n.getPoint3dAt(2)):e.normal[0]).normalize(i))return;i.scale(-1,i);const o=s.Vector3d.create(i.y,-i.x,0),a=o.magnitude();o.normalize(o),a<.001&&(i.set(0,0,-1),o.set(1,0,0));const c=o.crossProduct(i).normalize();if(!c)return;const l=e.numEdgesThisFacet;for(let u=0;u<l;u++){const e=s.Vector3d.createFrom(n.getPoint3dAt(u));r.push(s.Point2d.create(e.dotProduct(o),e.dotProduct(c))),t.multiplyPoint2d(r[u],r[u])}return r}computeElevationDrapeUVParams(e,t,r){const n=[],i=e.numEdgesThisFacet;for(let o=0;o<i;o++){const i=e.point.getPoint3dAt(o);void 0!==r&&r.multiplyPoint3d(i,i),n.push(s.Point2d.createFrom(i)),t.multiplyPoint2d(n[o],n[o])}return n}}}(TextureMapping=t.TextureMapping||(t.TextureMapping={}));class AnalysisStyle{static fromJSON(e){const t=new AnalysisStyle;return e?(t.inputName=e.inputName,t.displacementChannelName=e.displacementChannelName,t.scalarChannelName=e.scalarChannelName,t.normalChannelName=e.normalChannelName,t.displacementScale=e.displacementScale,t.scalarRange=e.scalarRange?s.Range1d.fromJSON(e.scalarRange):void 0,t.scalarThematicSettings=e.scalarThematicSettings?u.ThematicSettings.fromJSON(e.scalarThematicSettings):void 0,t.inputRange=e.inputRange?s.Range1d.fromJSON(e.inputRange):void 0,t):t}copyFrom(e){this.inputName=e.inputName,this.displacementChannelName=e.displacementChannelName,this.scalarChannelName=e.scalarChannelName,this.normalChannelName=e.normalChannelName,this.displacementScale=e.displacementScale,e.scalarRange&&(this.scalarRange=e.scalarRange.clone()),e.scalarThematicSettings&&(this.scalarThematicSettings=e.scalarThematicSettings.clone()),this.scalarThematicSettings=e.scalarThematicSettings,e.inputRange&&(this.inputRange=e.inputRange.clone())}clone(e){const t=void 0!==e?e:new AnalysisStyle;return t.copyFrom(this),t}}t.AnalysisStyle=AnalysisStyle;t.GroundPlane=class GroundPlane{constructor(e){this.display=!1,this.elevation=0,e=e||{},this.display=n.JsonUtils.asBool(e.display,!1),this.elevation=n.JsonUtils.asDouble(e.elevation,-.01),this.aboveColor=void 0!==e.aboveColor?i.ColorDef.fromJSON(e.aboveColor):new i.ColorDef(i.ColorByName.darkGreen),this.belowColor=void 0!==e.belowColor?i.ColorDef.fromJSON(e.belowColor):new i.ColorDef(i.ColorByName.darkBrown)}toJSON(){return{display:this.display,elevation:this.elevation,aboveColor:this.aboveColor.toJSON(),belowColor:this.belowColor.toJSON()}}getGroundPlaneGradient(e){let t=e?this._aboveSymb:this._belowSymb;if(void 0!==t)return t;const r=[0,.25,.5],n=e?this.aboveColor:this.belowColor,i=e?128:133,o=[n.clone(),n.clone(),n.clone()];return o[0].setTransparency(255),o[1].setTransparency(i),o[2].setTransparency(i),(t=new u.Symb).mode=4,t.keys=[{color:o[0],value:r[0]},{color:o[1],value:r[1]},{color:o[2],value:r[2]}],e?this._aboveSymb=t:this._belowSymb=t,t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(85),i=r(288),o=r(482),s=r(483),a=r(25);t.WebAppRpcProtocol=class WebAppRpcProtocol extends n.RpcProtocol{constructor(e){super(e),this.pathPrefix="",this.requestType=i.WebAppRpcRequest,this.events.addListener(s.WebAppRpcLogging.logProtocolEvent)}async handleOperationGetRequest(e,t){return this.handleOperationPostRequest(e,t)}async handleOperationPostRequest(e,t){const r=await i.WebAppRpcRequest.parseRequest(this,e),n=await this.fulfill(r);i.WebAppRpcRequest.sendResponse(this,r,n,t)}handleOpenApiDescriptionRequest(e,t){const r=JSON.stringify(this.openAPIDescription);t.send(r)}static computeContentType(e){return e?0===e.indexOf(a.WEB_RPC_CONSTANTS.ANY_TEXT)?a.RpcContentType.Text:0===e.indexOf(a.WEB_RPC_CONSTANTS.BINARY)?a.RpcContentType.Binary:0===e.indexOf(a.WEB_RPC_CONSTANTS.MULTIPART)?a.RpcContentType.Multipart:a.RpcContentType.Unknown:a.RpcContentType.Unknown}getStatus(e){switch(e){case 404:return a.RpcRequestStatus.NotFound;case 202:return a.RpcRequestStatus.Pending;case 200:return a.RpcRequestStatus.Resolved;case 500:return a.RpcRequestStatus.Rejected;default:return a.RpcRequestStatus.Unknown}}getCode(e){switch(e){case a.RpcRequestStatus.NotFound:return 404;case a.RpcRequestStatus.Pending:return 202;case a.RpcRequestStatus.Resolved:return 200;case a.RpcRequestStatus.Rejected:return 500;default:return 501}}get openAPIDescription(){return new o.RpcOpenAPIDescription(this)}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(74),i=r(15);class RpcMultipart{static createForm(e){const t=new FormData;return RpcMultipart.writeValueToForm(t,e),t}static createStream(e){throw new i.IModelError(32768,"Not implemented.")}static parseRequest(e){throw new i.IModelError(32768,"Not implemented.")}static parseForm(e){return new Promise(async(t,r)=>{const i=n.RpcSerializedValue.create(e.get("objects"),[]);let o=0;for(;;){const t=e.get(`data-${o}`);if(!t)break;try{const e=await RpcMultipart.readFormBlob(t);i.data.push(new Uint8Array(e))}catch(e){r(e)}++o}t(i)})}static writeValueToForm(t,r){t.append("objects",r.objects);for(let n=0;n!==r.data.length;++n)if("undefined"!==typeof Blob)t.append(`data-${n}`,new Blob([r.data[n]],{type:"application/octet-stream"}));else{const i=r.data[n];t.append(`data-${n}`,e.from(i.buffer,i.byteOffset,i.byteLength))}}static readFormBlob(e){return new Promise((t,r)=>{const n=new FileReader;n.addEventListener("load",()=>{t(n.result)}),n.addEventListener("error",()=>{r(n.error)}),n.readAsArrayBuffer(e)})}}t.RpcMultipart=RpcMultipart}).call(this,r(36).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);let i;function o(){return void 0!==i?i:((i=[])[0]=n.Matrix3d.identity,i[1]=n.Matrix3d.createRowValues(1,0,0,0,-1,0,0,0,-1),i[2]=n.Matrix3d.createRowValues(0,-1,0,0,0,1,-1,0,0),i[3]=n.Matrix3d.createRowValues(0,1,0,0,0,1,1,0,0),i[4]=n.Matrix3d.createRowValues(1,0,0,0,0,1,0,-1,0),i[5]=n.Matrix3d.createRowValues(-1,0,0,0,0,1,0,1,0),i[6]=n.Matrix3d.createRowValues(.707106781186548,-.7071067811865476,0,.408248290463863,.408248290463863,.816496580927726,-.577350269189626,-.5773502691896257,.5773502691896257),i[7]=n.Matrix3d.createRowValues(.707106781186548,.7071067811865476,0,-.408248290463863,.408248290463863,.816496580927726,.577350269189626,-.5773502691896257,.5773502691896257),i.forEach(e=>Object.freeze(e)),i)}!function(e){e[e.NotStandard=-1]="NotStandard",e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.Left=2]="Left",e[e.Right=3]="Right",e[e.Front=4]="Front",e[e.Back=5]="Back",e[e.Iso=6]="Iso",e[e.RightIso=7]="RightIso"}(t.StandardViewId||(t.StandardViewId={}));t.StandardView=class StandardView{static get top(){return this.getStandardRotation(0)}static get bottom(){return this.getStandardRotation(1)}static get left(){return this.getStandardRotation(2)}static get right(){return this.getStandardRotation(3)}static get front(){return this.getStandardRotation(4)}static get back(){return this.getStandardRotation(5)}static get iso(){return this.getStandardRotation(6)}static get rightIso(){return this.getStandardRotation(7)}static getStandardRotation(e){return(e<0||e>7)&&(e=0),o()[e]}static adjustToStandardRotation(e){o().some(t=>!(t.maxDiff(e)>1e-7)&&(e.setFrom(t),!0))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(3),i=r(4),o=r(8);class VertexIndices{constructor(e){this.data=e,this.data.length}get length(){return this.data.length/3}static fromArray(e){const t=new Uint8Array(3*e.length);for(let r=0;r<e.length;r++)this.encodeIndex(e[r],t,3*r);return new VertexIndices(t)}static encodeIndex(e,t,r){t.length,t[r+0]=255&e,t[r+1]=(65280&e)>>8,t[r+2]=(16711680&e)>>16}}t.VertexIndices=VertexIndices;const s=new i.ColorDef;class AuxChannelBase{constructor(e){this.name=e.name,this.inputs=e.inputs,this.indices=e.indices}}t.AuxChannelBase=AuxChannelBase;t.AuxDisplacement=class AuxDisplacement extends AuxChannelBase{constructor(e){super(e),this.qOrigin=new Float32Array(3),this.qScale=new Float32Array(3);for(let t=0;t<3;t++)this.qOrigin[t]=e.qOrigin[t],this.qScale[t]=e.qScale[t]}};t.AuxParam=class AuxParam extends AuxChannelBase{constructor(e){super(e),this.qOrigin=e.qOrigin[0],this.qScale=e.qScale[0]}};t.AuxNormal=class AuxNormal extends AuxChannelBase{constructor(e){super(e)}};class VertexTable{constructor(e){this.data=e.data,this.qparams=e.qparams,this.width=e.width,this.height=e.height,this.hasTranslucency=!0===e.hasTranslucency,this.uniformColor=e.uniformColor,this.featureIndexType=e.featureIndexType,this.uniformFeatureID=e.uniformFeatureID,this.numVertices=e.numVertices,this.numRgbaPerVertex=e.numRgbaPerVertex,this.uvParams=e.uvParams,this.auxDisplacements=e.auxDisplacements,this.auxNormals=e.auxNormals,this.auxParams=e.auxParams}static buildFrom(e,t,r){const{numVertices:n,numRgbaPerVertex:i}=e,s=t.isUniform?0:t.numColors,a=function(e,t,r){const n=o.IModelApp.renderSystem.maxTextureSize,i=e*t+r;if(i<n)return{width:i,height:1};let s=Math.ceil(Math.sqrt(i));const a=s%t;0!==a&&(s+=t-a);const c=Math.ceil(i/s);return Math.floor(c),Math.floor(s),{width:s,height:c}}(n,i,s);0===a.width%i||0<s&&a.height;const c=new Uint8Array(a.width*a.height*4);e.data=c;for(let o=0;o<n;o++)e.appendVertex(o);return e.appendColorTable(t),e.data=void 0,new VertexTable({data:c,qparams:e.qparams,width:a.width,height:a.height,hasTranslucency:t.hasAlpha,uniformColor:t.uniform,numVertices:n,numRgbaPerVertex:i,uvParams:e.uvParams,featureIndexType:r.type,uniformFeatureID:1===r.type?r.featureID:void 0})}static createForPolylines(e){return 0<e.polylines.length?this.buildFrom(new SimpleBuilder(e),e.colors,e.features):void 0}}t.VertexTable=VertexTable;class PointStringParams{constructor(e,t,r){this.vertices=e,this.indices=t,this.weight=r}static create(e){if(!e.flags.isDisjoint)return;const t=VertexTable.createForPolylines(e);if(void 0===t)return;const r=e.polylines;let n=r[0].vertIndices;if(1<r.length){n=[];for(const e of r)for(const t of e.vertIndices)n.push(t)}const i=VertexIndices.fromArray(n);return i.length,n.length,new PointStringParams(t,i,e.width)}}var a;t.PointStringParams=PointStringParams,function(e){e[e.kNone=0]="kNone",e[e.kSquare=3]="kSquare",e[e.kMiter=6]="kMiter",e[e.kMiterInsideOnly=9]="kMiterInsideOnly",e[e.kJointBase=12]="kJointBase",e[e.kNegatePerp=24]="kNegatePerp",e[e.kNegateAlong=48]="kNegateAlong",e[e.kNoneAdjustWeight=96]="kNoneAdjustWeight"}(a||(a={}));class PolylineVertex{constructor(){this.isSegmentStart=!1,this.isPolylineStartOrEnd=!1,this.vertexIndex=0,this.prevIndex=0,this.nextIndex=0,this.distance=0}init(e,t,r,n,i,o){this.isSegmentStart=e,this.isPolylineStartOrEnd=t,this.vertexIndex=r,this.prevIndex=n,this.nextIndex=i,this.distance=o}computeParam(e,t=!1,r=!1,n=!1){if(r)return 12;let i=0;i=n?96:t?9:this.isPolylineStartOrEnd?3:6;let o=0;return e&&(o=24),this.isSegmentStart||(o+=48),i+o}}class PolylineTesselator{constructor(e,t,r){this._numIndices=0,this._vertIndex=[],this._prevIndex=[],this._nextIndex=[],this._nextParam=[],this._distance=[],this._position=[],this._polylines=e,this._points=t,this._doJoints=r}static fromPolyline(e){return new PolylineTesselator(e.polylines,e.points,l(e.width,e.flags.is2d))}static fromMesh(e){if(void 0!==e.edges.polylines.lines&&void 0!==e.points)return new PolylineTesselator(e.edges.polylines.lines,e.points,l(e.edges.width,e.is2d))}tesselate(){for(const i of this._points.list)this._position.push(i.unquantize(this._points.params));this._tesselate();const e=VertexIndices.fromArray(this._vertIndex),t=VertexIndices.fromArray(this._prevIndex),r=new Uint8Array(4*this._numIndices);for(let i=0;i<this._numIndices;i++){const e=this._nextIndex[i],t=4*i;VertexIndices.encodeIndex(e,r,t),r[t+3]=255&this._nextParam[i]}const n=new Float32Array(this._numIndices);for(let i=0;i<this._numIndices;++i)n[i]=this._distance[i];return{indices:e,prevIndices:t,nextIndicesAndParams:r,distances:n}}_tesselate(){const e=new PolylineVertex,t=new PolylineVertex;for(const r of this._polylines){if(r.numIndices<2)continue;let n=r.startDistance;const i=r.numIndices-1,o=r.vertIndices[0]===r.vertIndices[i];for(let s=0;s<i;++s){const a=r.vertIndices[s],c=r.vertIndices[s+1],l=this._position[a],u=this._position[c],d=l.distance(u),h=0===s,p=i-1===s,f=h?o?r.vertIndices[i-1]:a:r.vertIndices[s-1],g=p?o?r.vertIndices[1]:c:r.vertIndices[s+2];e.init(!0,h&&!o,a,f,c,n),t.init(!1,p&&!o,c,g,a,n+=d);const m=this._doJoints&&(o||!h)&&this._dotProduct(e)>-.7,y=this._doJoints&&(o||!p)&&this._dotProduct(t)>-.7;m||y?(this._addVertex(e,e.computeParam(!0,m,!1,!1)),this._addVertex(t,t.computeParam(!1,y,!1,!1)),this._addVertex(e,e.computeParam(!1,m,!1,!0)),this._addVertex(e,e.computeParam(!1,m,!1,!0)),this._addVertex(t,t.computeParam(!1,y,!1,!1)),this._addVertex(t,t.computeParam(!1,y,!1,!0)),this._addVertex(e,e.computeParam(!1,m,!1,!0)),this._addVertex(t,t.computeParam(!1,y,!1,!0)),this._addVertex(e,e.computeParam(!1,m,!1,!1)),this._addVertex(e,e.computeParam(!1,m,!1,!1)),this._addVertex(t,t.computeParam(!1,y,!1,!0)),this._addVertex(t,t.computeParam(!0,y,!1,!1))):(this._addVertex(e,e.computeParam(!0)),this._addVertex(t,t.computeParam(!1)),this._addVertex(e,e.computeParam(!1)),this._addVertex(e,e.computeParam(!1)),this._addVertex(t,t.computeParam(!1)),this._addVertex(t,t.computeParam(!0)))}}}_dotProduct(e){const t=this._position[e.vertexIndex],r=n.Vector3d.createStartEnd(this._position[e.prevIndex],t),i=n.Vector3d.createStartEnd(this._position[e.nextIndex],t);return r.dotProduct(i)}_addVertex(e,t){this._vertIndex[this._numIndices]=e.vertexIndex,this._prevIndex[this._numIndices]=e.prevIndex,this._nextIndex[this._numIndices]=e.nextIndex,this._nextParam[this._numIndices]=t,this._distance[this._numIndices]=e.distance,this._numIndices++}}function c(e,t){let r=void 0!==t?t.length:0;if(void 0!==e)for(const c of e)r+=c.vertIndices.length-1;if(0===r)return;r*=6;const n=new Uint8Array(3*r),i=new Uint8Array(4*r);let o=0,s=0;const a=(e,t,r)=>{VertexIndices.encodeIndex(e,n,o),o+=3,VertexIndices.encodeIndex(t,i,s),i[s+3]=r,s+=4};if(void 0!==e)for(const c of e){const e=c.vertIndices.length-1;for(let t=0;t<e;++t){let e=c.vertIndices[t],r=c.vertIndices[t+1];r<e&&(e=r,r=c.vertIndices[t]),a(e,r,0),a(r,e,2),a(e,r,1),a(e,r,1),a(r,e,2),a(r,e,3)}}if(void 0!==t)for(const c of t){const e=c.indices[0],t=c.indices[1];a(e,t,0),a(t,e,2),a(e,t,1),a(e,t,1),a(t,e,2),a(t,e,3)}return{indices:new VertexIndices(n),endPointAndQuadIndices:i}}function l(e,t){return t||e>5}function u(e){const t=e.edges;if(void 0===t)return;let r,n;if(l(t.width,e.is2d))n=c(t.polylines.lines,t.edges.edges);else{n=c(void 0,t.edges.edges);const i=PolylineTesselator.fromMesh(e);void 0!==i&&(r=i.tesselate())}const i=void 0!==t.silhouettes.edges&&void 0!==t.silhouettes.normals?function(e,t){const r=c(void 0,e);if(void 0===r)return;const n=new Uint8Array(6*t.length*4),i=new Uint16Array(n.buffer);let o=0;for(const s of t)for(let e=0;e<6;e++)i[o++]=s.first.value,i[o++]=s.second.value;return{indices:r.indices,endPointAndQuadIndices:r.endPointAndQuadIndices,normalPairs:n}}(t.silhouettes.edges,t.silhouettes.normals):void 0;return void 0!==n||void 0!==i||void 0!==r?{weight:t.width,linePixels:t.linePixels,segments:n,silhouettes:i,polylines:r}:void 0}!function(e){e[e.Unlit=0]="Unlit",e[e.Lit=1]="Lit",e[e.Textured=2]="Textured",e[e.TexturedLit=3]="TexturedLit",e[e.Classifier=4]="Classifier"}(t.SurfaceType||(t.SurfaceType={})),t.isValidSurfaceType=function(e){switch(e){case 0:case 1:case 2:case 3:case 4:return!0;default:return!1}};class MeshParams{constructor(e,t,r,n){this.vertices=e,this.surface=t,this.edges=r,this.isPlanar=!0===n}static create(e){const t=MeshBuilder.create(e),r=VertexTable.buildFrom(t,e.colors,e.features),n=VertexIndices.fromArray(e.vertIndices),i={type:t.type,indices:n,fillFlags:e.fillFlags,hasBakedLighting:e.hasBakedLighting,texture:e.texture,material:e.material},o=u(e);return new MeshParams(r,i,o,e.isPlanar)}}t.MeshParams=MeshParams;class PolylineParams{constructor(e,t,r,n,o,s=i.PolylineTypeFlags.Normal){this.vertices=e,this.polyline=t,this.isPlanar=o,this.weight=r,this.linePixels=n,this.type=s}static create(e){e.flags.isDisjoint;const t=VertexTable.createForPolylines(e);if(void 0===t)return;const r=PolylineTesselator.fromPolyline(e);return void 0!==r?new PolylineParams(t,r.tesselate(),e.width,e.linePixels,e.flags.isPlanar,e.flags.type):void 0}}t.PolylineParams=PolylineParams;class VertexTableBuilder{constructor(){this._curIndex=0}get uvParams(){}appendColorTable(e){if(void 0!==e.nonUniform)for(const t of e.nonUniform.colors)this.appendColor(t)}advance(e){this._curIndex+=e,this._curIndex,this.data.length}append8(e){Math.floor(e),this.data[this._curIndex]=e,this.advance(1)}append16(e){this.append8(255&e),this.append8(e>>>8)}append32(e){this.append16(65535&e),this.append16(e>>>16)}appendColor(e){const t=s;t.tbgr=e;const r=t.colors;switch(r.t=255-r.t,r.t){case 0:r.r=r.g=r.b=0;break;case 255:break;default:{const e=r.t/255;r.r=Math.floor(r.r*e+.5),r.g=Math.floor(r.g*e+.5),r.b=Math.floor(r.b*e+.5);break}}this.append8(r.r),this.append8(r.g),this.append8(r.b),this.append8(r.t)}}t.VertexTableBuilder=VertexTableBuilder;class SimpleBuilder extends VertexTableBuilder{constructor(e){super(),this.args=e,this.args.points}get numVertices(){return this.args.points.length}get numRgbaPerVertex(){return 3}get qparams(){return this.args.points.params}appendVertex(e){this.appendPosition(e),this.appendColorIndex(e),this.appendFeatureIndex(e)}appendPosition(e){const t=this.args.points;this.append16(t.list[e].x),this.append16(t.list[e].y),this.append16(t.list[e].z)}appendColorIndex(e){void 0!==this.args.colors.nonUniform?this.append16(this.args.colors.nonUniform.indices[e]):this.advance(2)}appendFeatureIndex(e){void 0!==this.args.features.featureIDs?this.append32(this.args.features.featureIDs[e]):this.advance(4)}}class MeshBuilder extends SimpleBuilder{constructor(e,t){super(e),this.type=t}static create(e){if(e.asClassifier)return new MeshBuilder(e,4);const t=void 0!==e.normals&&0<e.normals.length,r=void 0!==e.texture;let o;if(r){const t=n.Range2d.createNull(),r=e.textureUv,s=new n.Point2d;if(void 0!==r&&r.length>0)for(let i=0;i<e.points.length;i++)t.extendPoint(n.Point2d.create(r[i].x,r[i].y,s));o=i.QParams2d.fromRange(t)}return t?r?new TexturedLitMeshBuilder(e,o):new LitMeshBuilder(e):r?new TexturedMeshBuilder(e,o):new MeshBuilder(e,0)}}class TexturedMeshBuilder extends MeshBuilder{constructor(e,t,r=2){super(e,r),this._qpoint=new i.QPoint2d,this._qparams=t,e.textureUv}get numRgbaPerVertex(){return 4}get uvParams(){return this._qparams}appendVertex(e){this.appendPosition(e),this.appendNormal(e),this.appendFeatureIndex(e),this.appendUVParams(e)}appendNormal(e){this.advance(2)}appendUVParams(e){this._qpoint.init(this.args.textureUv[e],this._qparams),this.append16(this._qpoint.x),this.append16(this._qpoint.y)}}class TexturedLitMeshBuilder extends TexturedMeshBuilder{constructor(e,t){super(e,t,3),e.normals}appendNormal(e){this.append16(this.args.normals[e].value)}}class LitMeshBuilder extends MeshBuilder{constructor(e){super(e,1),e.normals}get numRgbaPerVertex(){return 4}appendVertex(e){super.appendVertex(e),this.append16(this.args.normals[e].value),this.advance(2)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(88),i=r(87),o=r(53),s=r(4),a=r(0),c=r(3),l=r(26),u=r(53),d=r(63);!function(e){let t,r,h,p;!function(e){e[e.Version1=1]="Version1",e[e.Version2=2]="Version2",e[e.CurrentVersion=1]="CurrentVersion",e[e.SceneFormat=0]="SceneFormat"}(t=e.Versions||(e.Versions={}));class Header extends n.TileIO.Header{constructor(e){super(e),this.gltfLength=e.nextUint32,this.sceneStrLength=e.nextUint32,this.gltfSceneFormat=e.nextUint32,(1!==this.version&&2!==this.version||0!==this.gltfSceneFormat)&&this.invalidate()}get isValid(){return 1179937895===this.format}}e.Header=Header,function(e){e[e.Lines=1]="Lines",e[e.LineStrip=3]="LineStrip",e[e.Triangles=4]="Triangles"}(r=e.PrimitiveType||(e.PrimitiveType={})),function(e){e[e.UnsignedByte=5121]="UnsignedByte",e[e.UnsignedShort=5123]="UnsignedShort",e[e.UInt32=5125]="UInt32",e[e.Float=5126]="Float"}(h=e.DataType||(e.DataType={})),function(e){e[e.CullFace=2884]="CullFace",e[e.DepthTest=2929]="DepthTest",e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.LinearMipmapLinear=9987]="LinearMipmapLinear",e[e.ClampToEdge=33071]="ClampToEdge",e[e.ArrayBuffer=34962]="ArrayBuffer",e[e.ElementArrayBuffer=34963]="ElementArrayBuffer",e[e.FragmentShader=35632]="FragmentShader",e[e.VertexShader=35633]="VertexShader"}(p=e.Constants||(e.Constants={}));class BufferData{constructor(e,t){this.buffer=e,this.count=t}static create(e,t,r,n){if(r!==t)switch(r){case 5126:case 5121:return;case 5123:if(5121!==t)return;break;case 5125:if(5121!==t&&5123!==t)return}const i=this.createDataBuffer(e,t);return void 0!==i?new BufferData(i,n):void 0}static createDataBuffer(e,t){switch(t){case 5121:return e;case 5123:return new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);case 5125:return new Uint32Array(e.buffer,e.byteOffset,e.byteLength/4);case 5126:return new Float32Array(e.buffer,e.byteOffset,e.byteLength/4);default:return}}}e.BufferData=BufferData;class BufferView{constructor(e,t,r,n){this.data=e,this.count=t,this.type=r,this.accessor=n}get byteLength(){return this.data.length}toBufferData(e){return BufferData.create(this.data,this.type,e,this.count)}}e.BufferView=BufferView;class ReaderProps{constructor(e,t,r,n,i,o,s,a,c,l){this.buffer=e,this.binaryData=t,this.accessors=r,this.bufferViews=n,this.scene=i,this.meshes=o,this.materials=s,this.extensions=a,this.samplers=c,this.yAxisUp=l}static create(e,t=!1){const r=new Header(e);if(!r.isValid)return;const n=new Uint8Array(e.arrayBuffer,e.curPos+r.sceneStrLength),i=e.nextBytes(r.sceneStrLength),o=a.utf8ToString(i);if(void 0!==o)try{const r=JSON.parse(o),i=a.JsonUtils.asObject(r.meshes),s=a.JsonUtils.asObject(r.materials),c=a.JsonUtils.asObject(r.accessors),l=a.JsonUtils.asObject(r.bufferViews),u=a.JsonUtils.asObject(r.extensions),d=a.JsonUtils.asObject(r.samplers);if(void 0===i)return;return new ReaderProps(e,n,c,l,r,i,s,u,d,t)}catch(e){return}}}e.ReaderProps=ReaderProps;e.Reader=class Reader{constructor(e,t,r,n,i,o=1,s){this._buffer=e.buffer,this._binaryData=e.binaryData,this._accessors=e.accessors,this._bufferViews=e.bufferViews,this._meshes=e.meshes,this._materialValues=e.materials,this._samplers=e.samplers,this._yAxisUp=e.yAxisUp,this._returnToCenter=this.extractReturnToCenter(e.extensions),this._textures=e.scene.textures,this._images=e.scene.images,this._renderMaterials=e.scene.renderMaterials,this._namedTextures=e.scene.namedTextures,this._iModel=t,this._modelId=r,this._is3d=n,this._system=i,this._type=o,this._canceled=s}get _isCanceled(){return void 0!==this._canceled&&this._canceled(this)}get _hasBakedLighting(){return!1}get _isClassifier(){return 1===this._type}readGltfAndCreateGraphics(e,t,r,i,o,s){if(this._isCanceled)return{readStatus:6,isLeaf:e,sizeMultiplier:s};const a=new n.TileIO.GeometryCollection(new u.MeshList(i),r,t),d=this.readGltf(a);let h;if(!a.isEmpty){const e=new u.MeshGraphicArgs;if(1===a.meshes.length)h=a.meshes[0].getGraphics(e,this._system);else{const t=[];for(const r of a.meshes)void 0!==(h=r.getGraphics(e,this._system))&&t.push(h);h=this._system.createGraphicList(t)}if(void 0!==h&&(h=this._system.createBatch(h,l.PackedFeatureTable.pack(i),o),void 0!==this._returnToCenter||this._yAxisUp)){const e=new l.GraphicBranch;e.add(h);let t=void 0===this._returnToCenter?c.Transform.createIdentity():c.Transform.createTranslationXYZ(this._returnToCenter[0],this._returnToCenter[1],this._returnToCenter[2]);this._yAxisUp&&(t=t.multiplyTransformMatrix3d(c.Matrix3d.createRotationAroundVector(c.Vector3d.create(1,0,0),c.Angle.createRadians(c.Angle.piOver2Radians)))),h=this._system.createBranch(e,t)}}return{readStatus:d,isLeaf:e,sizeMultiplier:s,contentRange:o,renderGraphic:h}}getBufferView(e,t){try{const r=a.JsonUtils.asString(e[t]),n=0<r.length?a.JsonUtils.asObject(this._accessors[r]):void 0,i=void 0!==n?a.JsonUtils.asString(n.bufferView):"",o=0<i.length?a.JsonUtils.asObject(this._bufferViews[i]):void 0;if(void 0===o||void 0===n)return;const s=n.componentType;let c=0;switch(s){case 5121:c=1;break;case 5123:c=2;break;case 5125:case 5126:c=4;break;default:return}const l=o.byteOffset+n.byteOffset,u=0===(this._binaryData.byteOffset+l)%c?this._binaryData.subarray(l,l+o.byteLength):this._binaryData.slice(l,l+o.byteLength);return new BufferView(u,n.count,s,n)}catch(e){return}}readBufferData32(e,t){return this.readBufferData(e,t,5125)}readBufferData16(e,t){return this.readBufferData(e,t,5123)}readBufferData8(e,t){return this.readBufferData(e,t,5121)}readBufferDataFloat(e,t){return this.readBufferData(e,t,5126)}readBufferData(e,t,r){const n=this.getBufferView(e,t);return void 0!==n?n.toBufferData(r):void 0}readFeatureIndices(e){}readGltf(e){for(const t of Object.keys(this._meshes)){const r=this._meshes[t],n=a.JsonUtils.asArray(r.primitives);if(void 0!==n)for(const t of n){const r=this.readMeshPrimitive(t,e.meshes.features);void 0!==r&&e.meshes.push(r)}}return 0}readMeshPrimitive(e,t){const r=a.JsonUtils.asString(e.material),n=0<r.length?a.JsonUtils.asObject(this._materialValues[r]):void 0,i=void 0!==n?this.createDisplayParams(n):void 0;if(void 0===i)return;const s=a.JsonUtils.asInt(e.type,0),l=a.JsonUtils.asBool(e.isPlanar),u=this._hasBakedLighting,d=this._isClassifier,h=o.Mesh.create({displayParams:i,features:void 0!==t?new o.Mesh.Features(t):void 0,type:s,range:c.Range3d.createNull(),is2d:!this._is3d,isPlanar:l,hasBakedLighting:u,asClassifier:d});if(!this.readVertices(h.points,e))return;if(!this.readColorTable(h.colorMap,e))return;const p=this.readColorIndices(e);if(void 0!==p)h.colors=p;else if(1!==h.colorMap.length)return;if(void 0===h.features||this.readFeatures(h.features,e)){switch(s){case 0:if(!this.readMeshIndices(h,e))return;if(!i.ignoreLighting&&!this.readNormals(h.normals,e.attributes,"NORMAL"))return;this.readUVParams(h.uvParams,e.attributes,"TEXCOORD_0"),this.readMeshEdges(h,e.edges);break;case 1:case 2:if(void 0!==h.polylines&&!this.readPolylines(h.polylines,e,"indices",2===s))return;break;default:return}return h}}readVertices(e,t){const r=this.getBufferView(t.attributes,"POSITION");if(void 0===r||5123!==r.type)return!1;const n=a.JsonUtils.asObject(r.accessor.extensions),i=void 0!==n?a.JsonUtils.asObject(n.WEB3D_quantized_attributes):void 0;if(void 0===i)return!1;const o=a.JsonUtils.asArray(i.decodedMin),l=a.JsonUtils.asArray(i.decodedMax);if(void 0===o||void 0===l)return!1;const u=r.toBufferData(5123);if(void 0===u)return!1;const d=s.QPoint3d.fromScalars(0,0,0);e.reset(s.QParams3d.fromRange(c.Range3d.create(c.Point3d.create(o[0],o[1],o[2]),c.Point3d.create(l[0],l[1],l[2]))));for(let s=0;s<r.count;s++){const t=3*s;d.setFromScalars(u.buffer[t],u.buffer[t+1],u.buffer[t+2]),e.push(d)}return!0}readIndices(e,t){const r=this.readBufferData32(e,t);if(void 0===r)return;const n=[];for(let i=0;i<r.count;i++)n.push(r.buffer[i]);return n}readFeatures(e,t){const r=this.readFeatureIndices(t);return void 0!==r&&(e.setIndices(r),!0)}readColorIndices(e){const t=this.readBufferData16(e.attributes,"_COLORINDEX");if(void 0===t)return;const r=new Uint16Array(t.count);for(let n=0;n<t.count;n++)r[n]=t.buffer[n];return r}readMeshIndices(e,t){const r=this.readBufferData32(t,"indices");if(void 0===r)return!1;r.count;const n=new i.Triangle(!1);for(let i=0;i<r.count;i+=3)n.setIndices(r.buffer[i],r.buffer[i+1],r.buffer[i+2]),e.addTriangle(n);return!0}readNormals(e,t,r){const n=this.readBufferData8(t,r);if(void 0===n)return!1;for(let i=0;i<n.count;i++){const t=2*i,r=n.buffer[t]|n.buffer[t+1]<<8;e.push(new s.OctEncodedNormal(r))}return!0}readUVParams(e,t,r){const n=this.getBufferView(t,r);let i;if(void 0===n)return!1;switch(n.type){case 5126:i=this.readBufferDataFloat(t,r);for(let t=0;t<i.count;t++){const r=2*t;e.push(new c.Point2d(i.buffer[r],i.buffer[r+1]))}break;case 5123:{const t=a.JsonUtils.asObject(n.accessor.extensions),r=void 0!==t?a.JsonUtils.asObject(t.WEB3D_quantized_attributes):void 0;if(void 0===r)return!1;const i=a.JsonUtils.asArray(r.decodeMatrix);if(void 0===i)return!1;const o=n.toBufferData(5123);if(void 0===o)return!1;for(let s=0;s<n.count;s++){const t=2*s;e.push(new c.Point2d(o.buffer[t]*i[0]+i[6],o.buffer[t+1]*i[4]+i[7]))}break}}return!0}readMeshEdges(e,t){if(void 0===t||void 0===e)return!1;e.edges=new s.MeshEdges;const r=this.readEdgeIndices(t,"visibles");if(void 0!==r&&(e.edges.visible=r),void 0!==t.silhouettes){const r=this.readNormalPairs(t.silhouettes,"normalPairs");void 0!==r&&(e.edges.silhouetteNormals=r);const n=this.readEdgeIndices(t.silhouettes,"indices");void 0!==n&&(e.edges.silhouette=n)}return e.edges.polylines=new s.MeshPolylineList,this.readPolylines(e.edges.polylines,t,"polylines",!1)}readEdgeIndices(e,t){const r=this.readBufferData32(e,t);if(void 0===r)return;const n=new Array(r.count/2);let i=0;for(let o=0;o<r.count;o+=2)n[i++]=new s.MeshEdge(r.buffer[o],r.buffer[o+1]);return n}readNormalPairs(e,t){const r=this.readBufferData8(e,t);if(void 0===r)return;const n=new Array(r.count);for(let i=0;i<r.count;i++){const e=4*i,t=r.buffer[e]|r.buffer[e+1]<<8,o=r.buffer[e+2]|r.buffer[e+3]<<8;n[i]=new s.OctEncodedNormalPair(new s.OctEncodedNormal(t),new s.OctEncodedNormal(o))}return n}readPolylines(e,t,r,n){const i=this.getBufferView(t,r);if(void 0===i)return!1;const o=new Float32Array(1),a=new Uint8Array(o.buffer),c=new Uint32Array(1),l=new Uint8Array(c.buffer),u=new Uint16Array(1),d=new Uint8Array(u.buffer),h=new Uint32Array(1),p=new Uint8Array(h.buffer);let f=0;for(let g=0;g<i.count;++g){for(let e=0;e<4;++e)a[e]=i.data[f++];for(let e=0;e<4;++e)l[e]=i.data[f++];if(!n&&c[0]<2)continue;const t=new Array(c[0]);if(5123===i.type){for(let e=0;e<c[0];++e){for(let e=0;e<2;++e)d[e]=i.data[f++];t[e]=u[0]}0!==c[0]%2&&(f+=2)}else if(5125===i.type)for(let e=0;e<c[0];++e){for(let e=0;e<4;++e)p[e]=i.data[f++];t[e]=h[0]}e.push(new s.MeshPolyline(o[0],t))}return!0}async loadTextures(){if(void 0===this._textures)return Promise.resolve();const e=new Array;for(const t of Object.keys(this._textures))e.push(this.loadTexture(t));return e.length>0?Promise.all(e).then(e=>void 0):Promise.resolve()}async loadTextureImage(e,t){try{const r=a.JsonUtils.asObject(e.extensions.KHR_binary_glTF),n=this._bufferViews[r.bufferView],i=a.JsonUtils.asString(r.mimeType),o=d.getImageSourceFormatForMimeType(i);if(void 0===o)return;const c=n.byteOffset,l=this._binaryData.subarray(c,c+n.byteLength),u=new s.ImageSource(l,o);let h=0;void 0===t||void 0===t.wrapS&&void 0===t.wrapS||(h=2);const p=new s.RenderTexture.Params(void 0,h);return d.imageElementFromImageSource(u).then(e=>this._isCanceled?void 0:this._system.createTextureFromImage(e,2===o,this._iModel,p)).catch(e=>void 0)}catch(e){return}}async loadTexture(e){const t=a.JsonUtils.asObject(this._textures[e]);return void 0===t?Promise.resolve():this.loadTextureImage(this._images[t.source],void 0===this._samplers?void 0:this._samplers[t.sampler]).then(e=>{t.renderTexture=e})}findTextureMapping(e){const t=a.JsonUtils.asObject(this._textures[e]),r=void 0!==t?t.renderTexture:void 0;return void 0!==r?new s.TextureMapping(r,new s.TextureMapping.Params):void 0}}}(t.GltfTileIO||(t.GltfTileIO={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(30),i=r(8),o=r(220),s=r(135);!function(e){e[e.Unknown=0]="Unknown",e[e.Selected=1]="Selected",e[e.SelectionSet=2]="SelectionSet",e[e.Fence=3]="Fence",e[e.Group=4]="Group",e[e.DragSelect=5]="DragSelect"}(t.ModifyElementSource||(t.ModifyElementSource={}));t.PrimitiveTool=class PrimitiveTool extends n.InteractiveTool{constructor(){super(...arguments),this.targetIsLocked=!1}get iModel(){return this.targetView.view.iModel}run(){const{toolAdmin:e,viewManager:t}=i.IModelApp;return!(!this.isCompatibleViewport(t.selectedView,!1)||!e.onInstallTool(this))&&(e.startPrimitiveTool(this),e.onPostInstallTool(this),!0)}isCompatibleViewport(e,t){if(void 0===e)return!1;const r=e.view,n=r.iModel;if(this.requireWriteableTarget()&&n.isReadonly)return!1;if(void 0===this.targetView)this.targetView=e;else if(n!==this.iModel)return!1;return this.targetIsLocked?!(this.targetModelId&&!r.viewsModel(this.targetModelId))&&(this.requireWriteableTarget(),!0):(t&&(this.targetView=e),!0)}isValidLocation(e,t){const r=e.viewport;if(void 0===r)return!1;if(t&&0!==e.button)return!0;const n=r.view;return!n.isSpatialView()||0!==(2&i.IModelApp.toolAdmin.toolState.coordLockOvr)||!i.IModelApp.accuSnap.isSnapEnabled||!!n.iModel.projectExtents.containsPoint(e.point)||(t&&e.isDown&&i.IModelApp.notifications.outputMessage(new s.NotifyMessageDetails(10,i.IModelApp.i18n.translate("CoreTools:tools.ElementSet.Error.ProjectExtents"))),!1)}autoLockTarget(){void 0===this.targetView&&(this.targetIsLocked=!0)}getPrompt(){return""}requireWriteableTarget(){return!0}onSelectedViewportChanged(e,t){this.isCompatibleViewport(t,!0)||this.onRestartTool()}onReinitialize(){this.onRestartTool()}exitTool(){i.IModelApp.toolAdmin.startDefaultTool()}onUndoPreviousStep(){return!1}undoPreviousStep(){return!!this.onUndoPreviousStep()&&(o.AccuDrawShortcuts.processPendingHints(),i.IModelApp.toolAdmin.updateDynamics(),!0)}async saveChanges(){return this.iModel.saveChanges(this.toolId)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(118);!function(e){e[e.QUANTITY_ERROR_BASE=35039]="QUANTITY_ERROR_BASE",e[e.Success=0]="Success",e[e.InvalidJson=35040]="InvalidJson",e[e.InvalidCompositeFormat=35041]="InvalidCompositeFormat"}(t.QuantityStatus||(t.QuantityStatus={}));t.QuantityError=class QuantityError extends n.BentleyError{constructor(e,t){super(e,t),this.errorNumber=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(182),o=r(41),s=r(65);class VertexLUT{static createFromVertexTable(e){const t=o.TextureHandle.createForData(e.width,e.height,e.data);return void 0!==t?new VertexLUT(t,e,i.ColorInfo.createFromVertexTable(e),e.qparams,e.uvParams):void 0}constructor(e,t,r,n,i){if(this.texture=e,this.numVertices=t.numVertices,this.numRgbaPerVertex=t.numRgbaPerVertex,this.colorInfo=r,this.qOrigin=s.qorigin3dToArray(n.origin),this.qScale=s.qscale3dToArray(n.scale),void 0!==i&&(this.uvQParams=s.qparams2dToArray(i)),void 0!==t.auxDisplacements){this.auxDisplacements=new Map;for(const e of t.auxDisplacements)this.auxDisplacements.set(e.name,e)}if(void 0!==t.auxParams){this.auxParams=new Map;for(const e of t.auxParams)this.auxParams.set(e.name,e)}if(void 0!==t.auxNormals){this.auxNormals=new Map;for(const e of t.auxNormals)this.auxNormals.set(e.name,e)}}dispose(){n.dispose(this.texture)}}t.VertexLUT=VertexLUT},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(54);class ColorInfo{constructor(e,t){this.hasTranslucency=e,this._uniform=t}static createUniform(e){return new ColorInfo(e.hasTranslucency,e)}static createNonUniform(e){return e?this._nonUniformTranslucent:this._nonUniformOpaque}static createFromColorDef(e){return this.createUniform(n.FloatPreMulRgba.fromColorDef(e))}static createFromColorIndex(e){return void 0!==e.uniform?this.createFromColorDef(e.uniform):this.createNonUniform(e.hasAlpha)}static createFromVertexTable(e){return void 0!==e.uniformColor?this.createFromColorDef(e.uniformColor):this.createNonUniform(e.hasTranslucency)}get isUniform(){return void 0!==this._uniform}get isNonUniform(){return!this.isUniform}get uniform(){return this.isUniform,this._uniform}}ColorInfo._nonUniformTranslucent=new ColorInfo(!0),ColorInfo._nonUniformOpaque=new ColorInfo(!1),t.ColorInfo=ColorInfo},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(78),o=r(0),s=r(523),a=r(64),c=r(184);class ContextModelState{constructor(e,t){this._name=e.name?e.name:"",this._tilesetUrl=e.tilesetUrl,this._tileTreeState=new a.TileTreeState(t,!0,"")}tileTree(){return this._tileTreeState.tileTree}loadStatus(){return this._tileTreeState.loadStatus}loadTileTree(e,t){const r=this._tileTreeState;return a.TileTree.LoadStatus.NotLoaded!==r.loadStatus?r.loadStatus:(r.loadStatus=a.TileTree.LoadStatus.Loading,c.RealityModelTileTree.loadRealityModelTileTree(this._tilesetUrl,void 0,r),r.loadStatus)}}class DisplayStyleState extends i.ElementState{constructor(e,t){super(e,t);const r=this.jsonProperties.styles,n=void 0!==r?r.backgroundMap:void 0,i=void 0!==n?n:{};if(this._backgroundMap=new s.BackgroundMapState(i,t),this._contextModels=[],r&&r.contextModels)for(const o of r.contextModels)this._contextModels.push(new ContextModelState(o,this.iModel))}setBackgroundMap(e){this.backgroundMap.equalsProps(e)||(this._backgroundMap=new s.BackgroundMapState(e,this.iModel),this.settings.backgroundMap=e)}forEachContextModel(e){for(const t of this._contextModels)e(t)}equalState(e){return JSON.stringify(this.settings)===JSON.stringify(e.settings)}get backgroundMap(){return this._backgroundMap}get name(){return this.code.getValue()}get viewFlags(){return this.settings.viewFlags}set viewFlags(e){this.settings.viewFlags=e}get backgroundColor(){return this.settings.backgroundColor}set backgroundColor(e){this.settings.backgroundColor=e}get monochromeColor(){return this.settings.monochromeColor}set monochromeColor(e){this.settings.monochromeColor=e}get backgroundMapPlane(){return this.viewFlags.backgroundMap?this.backgroundMap.getPlane():void 0}is3d(){return this instanceof DisplayStyle3dState}overrideSubCategory(e,t){this.settings.overrideSubCategory(e,t)}dropSubCategoryOverride(e){this.settings.dropSubCategoryOverride(e)}get hasSubCategoryOverride(){return this.settings.hasSubCategoryOverride}getSubCategoryOverride(e){return this.settings.getSubCategoryOverride(e)}}t.DisplayStyleState=DisplayStyleState;t.DisplayStyle2dState=class DisplayStyle2dState extends DisplayStyleState{get settings(){return this._settings}constructor(e,t){super(e,t),this._settings=new n.DisplayStyleSettings(this.jsonProperties)}};class SkyBox{constructor(e){this.display=!1,this.display=void 0!==e&&o.JsonUtils.asBool(e.display,!1)}toJSON(){return{display:this.display}}static createFromJSON(e){let t,r=0;switch(void 0!==e&&void 0!==e.image&&void 0!==e.image.type&&(r=e.image.type),r){case 1:t=SkySphere.fromJSON(e);break;case 2:t=SkyCube.fromJSON(e)}return void 0!==t?t:new SkyGradient(e)}}t.SkyBox=SkyBox,function(e){e.SphereParams=class SphereParams{constructor(e,t){this.texture=e,this.rotation=t}};class CreateParams{constructor(e,t,r,n){this.gradient=t,this.sphere=r,this.cube=n,this.zOffset=e}static createForGradient(e,t){return new CreateParams(t,e)}static createForSphere(e,t){return new CreateParams(t,void 0,e)}static createForCube(e){return new CreateParams(0,void 0,void 0,e)}}e.CreateParams=CreateParams}(SkyBox=t.SkyBox||(t.SkyBox={}));class SkyGradient extends SkyBox{constructor(e){super(e),this.twoColor=!1,this.groundExponent=4,this.skyExponent=4,e=e||{},this.twoColor=o.JsonUtils.asBool(e.twoColor,!1),this.groundExponent=o.JsonUtils.asDouble(e.groundExponent,4),this.skyExponent=o.JsonUtils.asDouble(e.skyExponent,4),this.groundColor=void 0!==e.groundColor?n.ColorDef.fromJSON(e.groundColor):n.ColorDef.from(120,143,125),this.zenithColor=void 0!==e.zenithColor?n.ColorDef.fromJSON(e.zenithColor):n.ColorDef.from(54,117,255),this.nadirColor=void 0!==e.nadirColor?n.ColorDef.fromJSON(e.nadirColor):n.ColorDef.from(40,15,0),this.skyColor=void 0!==e.skyColor?n.ColorDef.fromJSON(e.skyColor):n.ColorDef.from(143,205,255)}toJSON(){const e=super.toJSON();return e.twoColor=!!this.twoColor||void 0,e.groundExponent=4!==this.groundExponent?this.groundExponent:void 0,e.skyExponent=4!==this.skyExponent?this.skyExponent:void 0,e.groundColor=this.groundColor.toJSON(),e.zenithColor=this.zenithColor.toJSON(),e.nadirColor=this.nadirColor.toJSON(),e.skyColor=this.skyColor.toJSON(),e}async loadParams(e,t){return Promise.resolve(SkyBox.CreateParams.createForGradient(this,t.globalOrigin.z))}}t.SkyGradient=SkyGradient;class SkySphere extends SkyBox{constructor(e,t){super({display:t}),this.textureId=e}static fromJSON(e){const t=o.Id64.fromJSON(void 0!==e.image?e.image.texture:void 0);return void 0!==t&&o.Id64.isValid(t)?new SkySphere(t,e.display):void 0}toJSON(){const e=super.toJSON();return e.image={type:1,texture:this.textureId},e}async loadParams(e,t){const r=await e.loadTexture(this.textureId,t);if(void 0===r)return;return SkyBox.CreateParams.createForSphere(new SkyBox.SphereParams(r,0),t.globalOrigin.z)}}t.SkySphere=SkySphere;class SkyCube extends SkyBox{constructor(e,t,r,n,i,o,s){super({display:s}),this.front=e,this.back=t,this.top=r,this.bottom=n,this.right=i,this.left=o}static fromJSON(e){const t=e.image,r=void 0!==t&&2===t.type?t.textures:void 0;if(void 0!==r)return this.create(o.Id64.fromJSON(r.front),o.Id64.fromJSON(r.back),o.Id64.fromJSON(r.top),o.Id64.fromJSON(r.bottom),o.Id64.fromJSON(r.right),o.Id64.fromJSON(r.left),e.display)}toJSON(){const e=super.toJSON();return e.image={type:2,textures:{front:this.front,back:this.back,top:this.top,bottom:this.bottom,right:this.right,left:this.left}},e}static create(e,t,r,n,i,s,a){return o.Id64.isValid(e)&&o.Id64.isValid(t)&&o.Id64.isValid(r)&&o.Id64.isValid(n)&&o.Id64.isValid(i)&&o.Id64.isValid(s)?new SkyCube(e,t,r,n,i,s,a):void 0}async loadParams(e,t){const r=new Set([this.front,this.back,this.top,this.bottom,this.right,this.left]),i=new Array;for(const n of r)i.push(e.loadTextureImage(n,t));try{const o=await Promise.all(i),s=new Map;let a=0;for(const e of r){const t=o[a++];if(void 0===t||void 0===t.image)return;s.set(e,t.image)}const c=new n.RenderTexture.Params(void 0,3),l=[s.get(this.front),s.get(this.back),s.get(this.top),s.get(this.bottom),s.get(this.right),s.get(this.left)],u=e.createTextureFromCubeImages(l[0],l[1],l[2],l[3],l[4],l[5],t,c);return void 0!==u?SkyBox.CreateParams.createForCube(u):void 0}catch(e){return}}}t.SkyCube=SkyCube;class Environment{constructor(e){this.sky=SkyBox.createFromJSON(void 0!==e?e.sky:void 0),this.ground=new n.GroundPlane(void 0!==e?e.ground:void 0)}toJSON(){return{sky:this.sky.toJSON(),ground:this.ground.toJSON()}}}t.Environment=Environment;class DisplayStyle3dState extends DisplayStyleState{get settings(){return this._settings}constructor(e,t){super(e,t),this._settings=new n.DisplayStyle3dSettings(this.jsonProperties)}get environment(){return void 0===this._environment&&(this._environment=new Environment(this.settings.environment)),this._environment}set environment(e){this.settings.environment=e.toJSON(),this._environment=void 0}loadSkyBoxParams(e){if(void 0===this._skyBoxParams&&void 0===this._skyBoxParamsLoaded){this._skyBoxParamsLoaded=!1,this.environment.sky.loadParams(e,this.iModel).then(e=>{this._skyBoxParams=e,this._skyBoxParamsLoaded=!0}).catch(e=>this._skyBoxParamsLoaded=!0)}return this._skyBoxParams}}t.DisplayStyle3dState=DisplayStyle3dState},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(143),o=r(0),s=r(3),a=r(69),c=r(64),l=r(8);class CesiumUtils{static rangeFromBoundingVolume(e){const t=e.box,r=s.Point3d.create(t[0],t[1],t[2]),n=s.Vector3d.create(t[3],t[4],t[5]),i=s.Vector3d.create(t[6],t[7],t[8]),o=s.Vector3d.create(t[9],t[10],t[11]),a=[];for(let s=0;s<2;s++)for(let e=0;e<2;e++)for(let t=0;t<2;t++)a.push(r.plus3Scaled(n,s?-1:1,i,e?-1:1,o,t?-1:1));return s.Range3d.createArray(a)}static maximumSizeFromGeometricTolerance(e,t){return.5*e.diagonal().magnitude()/t}static transformFromJson(e){return void 0===e?s.Transform.createIdentity():s.Transform.createOriginAndMatrix(s.Point3d.create(e[12],e[13],e[14]),s.Matrix3d.createRowValues(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]))}}class RealityModelTileTreeProps{constructor(e,t,r){this.client=t,this.id="",this.yAxisUp=!1,this.tilesetJson=e.root,this.rootTile=new RealityModelTileProps(e.root,""),this.location=r.toJSON(),void 0!==e.asset.gltfUpAxis&&"y"!==e.asset.gltfUpAxis||(this.yAxisUp=!0)}}class RealityModelTileProps{constructor(e,t){this.contentId=t,this.range=CesiumUtils.rangeFromBoundingVolume(e.boundingVolume),this.isLeaf=!Array.isArray(e.children)||0===e.children.length,this.hasContents=void 0!==e.content&&void 0!==e.content.url,this.hasContents?(this.contentRange=e.content.boundingVolume&&CesiumUtils.rangeFromBoundingVolume(e.content.boundingVolume),this.maximumSize=CesiumUtils.maximumSizeFromGeometricTolerance(s.Range3d.fromJSON(this.range),e.geometricError)):this.maximumSize=0}}class FindChildResult{constructor(e,t){this.id=e,this.json=t}}class RealityModelTileLoader extends c.TileLoader{constructor(e){super(),this._tree=e}get maxDepth(){return 32}tileRequiresLoading(e){return 0!==e.maximumSize}async getChildrenProps(e){const t=[],r=e.contentId,n=r.length?r+"_":"",i=await this.findTileInJson(this._tree.tilesetJson,r,"");if(void 0!==i&&Array.isArray(i.json.children))for(let o=0;o<i.json.children.length;o++){const e=n+o,r=await this.findTileInJson(this._tree.tilesetJson,e,"");void 0!==r&&t.push(new RealityModelTileProps(r.json,r.id))}return t}async loadTileContents(e){await Promise.all(e.map(async e=>{if(e.isNotLoaded,e.isNotLoaded){const t=await this.findTileInJson(this._tree.tilesetJson,e.contentId,"");if(void 0!==t){e.setIsQueued();const r=await this._tree.client.getTileContent(t.json.content.url);void 0!==r&&this.loadGraphics(e,r)}}}))}async findTileInJson(e,t,r){if(0===t.length)return new FindChildResult(t,e);const n=t.indexOf("_"),i=n<0?t:t.substring(0,n),o=parseInt(i,10);if(isNaN(o)||void 0===e||void 0===e.children||o>=e.children.length)return;let s=e.children[o];const a=r.length?r+"_"+i:i;if(n>=0)return await this.findTileInJson(s,t.substring(n+1),a);if(void 0!==s.content&&s.content.url.endsWith("json")){const t=await this._tree.client.getTileJson(s.content.url);s=t.root,e.children[o]=t.root}return new FindChildResult(a,s)}}t.RealityModelTileTree=class RealityModelTileTree{static loadRealityModelTileTree(e,t,r){this.getTileTreeProps(e,t,r.iModel).then(e=>{r.setTileTree(e,new RealityModelTileLoader(e)),l.IModelApp.viewManager.onNewTilesReady()}).catch(e=>r.loadStatus=c.TileTree.LoadStatus.NotFound)}static async getTileTreeProps(e,t,r){if(void 0!==e){await RealityModelTileClient.setToken();const n=new RealityModelTileClient(e),i=await n.getRootDocument(e),o=r.ecefLocation,a=CesiumUtils.transformFromJson(i.root.transform);let c=s.Transform.createIdentity();void 0!==t?c.setFromJSON(t):void 0!==o&&(c=s.Transform.createOriginAndMatrix(o.origin,o.orientation.toMatrix3d()).inverse());const l=s.Transform.createIdentity();return l.setMultiplyTransformTransform(c,a),new RealityModelTileTreeProps(i,n,l)}throw new n.IModelError(32768,"Unable to read reality data")}};class RealityModelTileClient{constructor(e){this._baseUrl="",this.rdsProps=this.parseUrl(e)}parseUrl(e){const t=e.split("/").map(e=>e.replace(/%2D/g,"-")),r=t.find(o.Guid.isGuid);let n;if(void 0!==r){let e=t.find(e=>e.includes("--")).split("--")[1];"Server"===e&&(e="fb1696c8-c074-4c76-a539-a5546e048cc6"),n={projectId:e,tilesId:r}}return n}static async setToken(e){if(void 0!==e)RealityModelTileClient._token=e;else if(void 0===RealityModelTileClient._token){const e=new o.ActivityLoggingContext(o.Guid.createValue()),t=await(new a.ImsActiveSecureTokenClient).getToken(e,a.Config.App.getString("imjs_test_regular_user_name"),a.Config.App.getString("imjs_test_regular_user_password"));RealityModelTileClient._token=await RealityModelTileClient._client.getAccessToken(e,t)}void 0===RealityModelTileClient._onCloseListener&&(RealityModelTileClient._onCloseListener=i.IModelConnection.onClose.addListener(RealityModelTileClient.removeToken))}static removeToken(){RealityModelTileClient._token=void 0}setBaseUrl(e){const t=e.split("/");t.pop(),this._baseUrl=t.join("/")+"/"}async getRootDocument(e){const t=new o.ActivityLoggingContext(o.Guid.createValue());return void 0!==this.rdsProps&&void 0!==RealityModelTileClient._token?RealityModelTileClient._client.getRootDocumentJson(t,RealityModelTileClient._token,this.rdsProps.projectId,this.rdsProps.tilesId):(this.setBaseUrl(e),a.getJson(t,e))}async getTileContent(e){const t=new o.ActivityLoggingContext(o.Guid.createValue());if(void 0!==this.rdsProps&&void 0!==RealityModelTileClient._token)return RealityModelTileClient._client.getTileContent(t,RealityModelTileClient._token,this.rdsProps.projectId,this.rdsProps.tilesId,e);if(void 0!==this._baseUrl){const r=this._baseUrl+e;return a.getArrayBuffer(t,r)}throw new n.IModelError(32768,"Unable to determine reality data content url")}async getTileJson(e){const t=new o.ActivityLoggingContext(o.Guid.createValue());if(void 0!==this.rdsProps&&void 0!==RealityModelTileClient._token)return RealityModelTileClient._client.getTileJson(t,RealityModelTileClient._token,this.rdsProps.projectId,this.rdsProps.tilesId,e);if(void 0!==this._baseUrl){const r=this._baseUrl+e;return a.getJson(t,r)}throw new n.IModelError(32768,"Unable to determine reality data json url")}}RealityModelTileClient._client=new a.RealityDataServicesClient,t.RealityModelTileClient=RealityModelTileClient},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(45),i=r(27),o=r(31),s=r(109),a=r(145),c=r(525),l=r(54),u=r(91),d=r(46),h=r(138),p=r(34),f=(r(0),r(187)),g=r(7),m="\n  vec4 sampleSurfaceTexture() {\n    // Textures do NOT contain premultiplied alpha. Multiply in shader.\n    vec4 texColor = TEXTURE(s_texture, v_texCoord);\n    return applyPreMultipliedAlpha(texColor);\n  }\n",y="\n  bool isTextured = isSurfaceBitSet(kSurfaceBit_HasTexture);\n  bool useTextureWeight = isTextured && u_textureWeight < 1.0;\n  bool useMatColor = !isSurfaceBitSet(kSurfaceBit_IgnoreMaterial) && (!isTextured || useTextureWeight);\n\n  if (useMatColor) {\n    // u_matRgb.a = 1.0 if color overridden by material, 0.0 otherwise.\n    if (u_matRgb.a > 0.5)\n      baseColor.rgb = u_matRgb.rgb * baseColor.a;\n\n    // u_matAlpha.y = 1.0 if alpha overridden by material.\n    if (u_matAlpha.y > 0.5)\n      baseColor = adjustPreMultipliedAlpha(baseColor, u_matAlpha.x);\n  }\n\n  if (useTextureWeight) {\n    vec4 texColor = sampleSurfaceTexture();\n    baseColor = mix(baseColor, texColor, u_textureWeight);\n  }\n\n  return baseColor;\n";t.addMaterial=function(e){e.addFunction(i.GLSLFragment.revertPreMultipliedAlpha),e.addFunction(i.GLSLFragment.adjustPreMultipliedAlpha),e.set(2,y),e.addUniform("u_matRgb",5,e=>{e.addGraphicUniform("u_matRgb",(e,t)=>{const r=t.target.currentViewFlags.materials&&t.geometry.material?t.geometry.material:f.Material.default;e.setUniform4fv(r.diffuseUniform)})}),e.addUniform("u_matAlpha",3,e=>{e.addGraphicUniform("u_matAlpha",(e,t)=>{const r=t.target.currentViewFlags.materials&&t.geometry.material?t.geometry.material:f.Material.default;e.setUniform2fv(r.alphaUniform)})}),e.addUniform("u_textureWeight",2,e=>{e.addGraphicUniform("u_textureWeight",(e,t)=>{const r=t.target.currentViewFlags.materials&&t.geometry.material?t.geometry.material:f.Material.default;e.setUniform1f(r.textureWeight)})})};const v="\n  vec4 pos = u_mv * rawPos;\n  v_pos = pos.xyz;\n  return u_proj * pos;\n";function _(e){const t=new n.ProgramBuilder(!0,e),r=t.vert;return e&&o.addAnimation(r,!0,!0),o.addProjectionMatrix(r),o.addModelViewMatrix(r),t.addVarying("v_pos",4),r.set(3,v),t}t.createSurfaceHiliter=function(){const e=_(!1);return R(e,!0),O(e,!1),u.addSurfaceHiliter(e),e};const w="\nbool isSurfaceBitSet(float flag) { return 0.0 != extractNthBit(floor(v_surfaceFlags + 0.5), flag); }\n";function S(e){e.addConstant("kSurfaceBit_HasTexture",2,"0.0"),e.addConstant("kSurfaceBit_ApplyLighting",2,"1.0"),e.addConstant("kSurfaceBit_HasNormals",2,"2.0"),e.addConstant("kSurfaceBit_IgnoreMaterial",2,"3.0"),e.addConstant("kSurfaceBit_TransparencyThreshold",2,"4.0"),e.addConstant("kSurfaceBit_BackgroundFill",2,"5.0"),e.addConstant("kSurfaceBit_HasColorAndNormal",2,"6.0"),e.addConstant("kSurfaceBit_EnvironmentMap",2,"7.0"),e.addConstant("kSurfaceMask_None",2,"0.0"),e.addConstant("kSurfaceMask_HasTexture",2,"1.0"),e.addConstant("kSurfaceMask_ApplyLighting",2,"2.0"),e.addConstant("kSurfaceMask_HasNormals",2,"4.0"),e.addConstant("kSurfaceMask_IgnoreMaterial",2,"8.0"),e.addConstant("kSurfaceMask_TransparencyThreshold",2,"16.0"),e.addConstant("kSurfaceMask_BackgroundFill",2,"32.0"),e.addConstant("kSurfaceMask_HasColorAndNormal",2,"64.0"),e.addConstant("kSurfaceMask_EnvironmentMap",2,"128.0"),e.addFunction(d.GLSLCommon.extractNthBit),e.addFunction(w)}const b="return u_surfaceFlags;",x="\n  float flags = u_surfaceFlags;\n  if (feature_ignore_material) {\n    bool hasTexture = 0.0 != fract(flags / 2.0); // kSurfaceMask_HasTexture = 1.0...\n    if (hasTexture)\n      flags -= kSurfaceMask_HasTexture;\n\n    flags += kSurfaceMask_IgnoreMaterial;\n  }\n\n  return flags;\n";t.octDecodeNormal="\nvec3 octDecodeNormal(vec2 e) {\n  e = e / 255.0 * 2.0 - 1.0;\n  vec3 n = vec3(e.x, e.y, 1.0 - abs(e.x) - abs(e.y));\n  if (n.z < 0.0) {\n    vec2 signNotZero = vec2(n.x >= 0.0 ? 1.0 : -1.0, n.y >= 0.0 ? 1.0 : -1.0);\n    n.xy = (1.0 - abs(n.yx)) * signNotZero;\n  }\n\n  return normalize(n);\n}\n";const P="\n  if (!isSurfaceBitSet(kSurfaceBit_HasNormals))\n    return vec3(0.0);\n\n  vec2 normal = g_vertexData2;\n  if (isSurfaceBitSet(kSurfaceBit_HasColorAndNormal)) {\n    vec2 tc = g_vertexBaseCoords;\n    tc.x += 3.0 * g_vert_stepX;\n    vec4 enc = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n    normal = enc.xy;\n  }\n\n  return normalize(u_nmx * octDecodeNormal(normal));\n",C="\n  if (u_animNormalParams.x >= 0.0)\n    return normalize(u_nmx * computeAnimationNormal(u_animNormalParams.x, u_animNormalParams.y, u_animNormalParams.z));\n"+P,T="\n  if (isSurfaceBitSet(kSurfaceBit_BackgroundFill))\n    baseColor.rgb = u_bgColor.rgb;\n\n  return baseColor;\n",M="\n  if (!isSurfaceBitSet(kSurfaceBit_HasTexture))\n    return vec2(0.0);\n  vec2 tc = g_vertexBaseCoords;\n  tc.x += 3.0 * g_vert_stepX;  vec4 rgba = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  vec2 qcoords = vec2(decodeUInt16(rgba.xy), decodeUInt16(rgba.zw));\n  return unquantize2d(qcoords, u_qTexCoordParams);\n",E="\n  if (u_animScalarQParams.x >= 0.0)\n    return computeAnimationParam(u_animScalarParams.x, u_animScalarParams.y, u_animScalarParams.z, u_animScalarQParams.x, u_animScalarQParams.y);\n"+M,I="\nvec4 getSurfaceColor() { return v_color; }\n",A="\n  if (isSurfaceBitSet(kSurfaceBit_HasTexture) && u_textureWeight >= 1.0) {\n    // if a glyph texture, must mix getSurfaceColor() with texCol so texCol.a is applied 100% and\n    // surfCol.rgb is scaled by texCol.rgb (texCol.rgb = full white originally but stretched via mipMapping)\n    if (u_applyGlyphTex > 0) {\n      vec4 surfCol = getSurfaceColor();\n      const vec3 white = vec3(1.0);\n      const vec3 epsilon = vec3(0.0001);\n      vec3 color = surfCol.a > 0.0 ? surfCol.rgb / surfCol.a : surfCol.rgb; // revert premultiplied alpha\n      vec3 delta = (color + epsilon) - white;\n      if (u_reverseWhiteOnWhite > 0.5 && delta.x > 0.0 && delta.y > 0.0 && delta.z > 0.0)\n        surfCol.rgb = vec3(0.0);\n\n      vec4 texCol = sampleSurfaceTexture();\n      return vec4(surfCol.rgb * texCol.rgb, texCol.a);\n    } else {\n      return sampleSurfaceTexture();\n    }\n  } else {\n    return getSurfaceColor(); // if textured, compute surface/material color first then mix with texture in applyMaterialOverrides...\n  }\n";function R(e,t){e.addFunctionComputedVarying("v_surfaceFlags",2,"computeSurfaceFlags",t?x:b),S(e.vert),S(e.frag),e.addUniform("u_surfaceFlags",2,e=>{e.addGraphicUniform("u_surfaceFlags",(e,t)=>{t.geometry,h.SurfaceGeometry;const r=t.geometry.computeSurfaceFlags(t.programParams);e.setUniform1f(r)})})}function O(e,t){e.vert.addFunction(s.GLSLDecode.unquantize2d),e.addFunctionComputedVarying("v_texCoord",3,"computeTexCoord",t?E:M),e.vert.addUniform("u_qTexCoordParams",5,e=>{e.addGraphicUniform("u_qTexCoordParams",(e,t)=>{const r=t.geometry;if(0!==(1&r.computeSurfaceFlags(t.programParams))){const t=r.lut.uvQParams;void 0!==t&&e.setUniform4fv(t)}})}),e.frag.addFunction(i.GLSLFragment.applyPreMultipliedAlpha),e.frag.addFunction(m),e.frag.addUniform("s_texture",8,e=>{e.addGraphicUniform("s_texture",(e,t)=>{const r=t.geometry;if(0!==(1&r.computeSurfaceFlags(t.programParams))){const n=t.target.analysisTexture?t.target.analysisTexture:r.texture;n.texture.bindSampler(e,p.TextureUnit.SurfaceTexture)}else g.System.instance.ensureSamplerBound(e,p.TextureUnit.SurfaceTexture)})})}t.createSurfaceBuilder=function(e,r){const n=_(r);return d.addShaderFlags(n),u.addFeatureSymbology(n,e,2===e?28:0),R(n,2===e),u.addSurfaceDiscard(n,e),function(e,r){o.addNormalMatrix(e.vert),e.vert.addFunction(t.octDecodeNormal),e.addFunctionComputedVarying("v_n",4,"computeLightingNormal",r?C:P)}(n,r),n.frag.set(4,T),n.frag.addUniform("u_bgColor",4,e=>{e.addProgramUniform("u_bgColor",(e,t)=>{const r=t.target.bgColor,n=l.FloatPreMulRgba.fromColorDef(r);e.setUniform3fv(new Float32Array([n.red,n.green,n.blue]))})}),O(n,r),n.frag.addUniform("u_applyGlyphTex",1,e=>{e.addGraphicUniform("u_applyGlyphTex",(e,t)=>{const r=t.geometry;0!==(1&r.computeSurfaceFlags(t.programParams))&&e.setUniform1i(r.isGlyph?1:0)})}),a.addColor(n,!0),n.frag.addFunction(I),c.addLighting(n),i.addWhiteOnWhiteReversal(n.frag),0===e?n.frag.set(13,i.GLSLFragment.assignFragColor):(n.frag.addFunction(s.GLSLDecode.depthRgb),i.addPickBufferOutputs(n.frag)),n.frag.set(1,A),n};const D="return isSurfaceBitSet(kSurfaceBit_HasTexture) && alpha == 0.0;";t.addSurfaceDiscardByAlpha=function(e){e.set(6,D)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addRenderPass=function(e){e.addUniform("u_renderPass",2,e=>{e.addProgramUniform("u_renderPass",(e,t)=>{let r=t.renderPass;6===r&&(r=3),e.setUniform1f(r)})}),e.addGlobal("kRenderPass_Background",2,"0.0",!0),e.addGlobal("kRenderPass_OpaqueLinear",2,"1.0",!0),e.addGlobal("kRenderPass_OpaquePlanar",2,"2.0",!0),e.addGlobal("kRenderPass_OpaqueGeneral",2,"3.0",!0),e.addGlobal("kRenderPass_Classification",2,"4.0",!0),e.addGlobal("kRenderPass_Translucent",2,"5.0",!0),e.addGlobal("kRenderPass_HiddenEdge",2,"6.0",!0),e.addGlobal("kRenderPass_Hilite",2,"7.0",!0),e.addGlobal("kRenderPass_WorldOverlay",2,"8.0",!0),e.addGlobal("kRenderPass_ViewOverlay",2,"9.0",!0)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);class Material extends n.RenderMaterial{constructor(e){if(super(e),this.diffuseUniform=new Float32Array(4),this.alphaUniform=new Float32Array(2),this.specular=new Float32Array(4),this.weights=new Float32Array(3),this.diffuseUniform[3]=void 0!==e.diffuseColor?1:0,void 0!==e.diffuseColor){const t=e.diffuseColor.colors;this.diffuseUniform[0]=t.r/255,this.diffuseUniform[1]=t.g/255,this.diffuseUniform[2]=t.b/255}else this.diffuseUniform[0]=this.diffuseUniform[1]=this.diffuseUniform[2]=1;if(this.specular[3]=e.specularExponent,e.specularColor){const t=e.specularColor.colors;this.specular[0]=t.r/255,this.specular[1]=t.g/255,this.specular[2]=t.b/255}else this.specular[0]=this.specular[1]=this.specular[2]=1;e.reflectColor&&(this.reflectColor=e.reflectColor.clone()),this.weights[0]=e.diffuse,this.weights[1]=e.specular,this.weights[2]=e.reflect,0!==e.transparency?(this.alphaUniform[0]=1-e.transparency,this.alphaUniform[1]=1):(this.alphaUniform[0]=1,this.alphaUniform[1]=0)}get textureWeight(){return void 0!==this.textureMapping?this.textureMapping.params.weight:1}get overridesRgb(){return 1===this.diffuseUniform[3]}get overridesAlpha(){return 1===this.alphaUniform[1]}get hasTranslucency(){return this.overridesAlpha&&this.alphaUniform[0]<1}}Material.default=new Material(n.RenderMaterial.Params.defaults),t.Material=Material,Object.freeze(Material.default)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);var i;!function(e){e[e.Success=0]="Success",e[e.Error=65536]="Error",e[e.NotInitialized=65537]="NotInitialized",e[e.UseAfterDisposal=65538]="UseAfterDisposal",e[e.InvalidArgument=65539]="InvalidArgument",e[e.InvalidResponse=65540]="InvalidResponse",e[e.NoContent=65541]="NoContent",e[e.BackendOutOfSync=65542]="BackendOutOfSync"}(i=t.PresentationStatus||(t.PresentationStatus={}));t.PresentationError=class PresentationError extends n.BentleyError{constructor(e,t,r,n){super(e,t,r,"Presentation",n)}_initName(){let e=i[this.errorNumber];return e||(e=`Unknown Error (${this.errorNumber})`),e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class UiCore{constructor(){}static async initialize(e){UiCore._i18n=e,await UiCore._i18n.registerNamespace("UiCore").readFinished}static terminate(){UiCore._i18n=void 0}static get i18n(){if(!UiCore._i18n)throw new Error("UiCore not initialized");return UiCore._i18n}}t.default=UiCore},function(e,t,r){"use strict";function n(e){for(var r=e.trim().toLowerCase(),n=0,i=0;i<r.length;i++){n=(n+r.charCodeAt(i))%t.COLORS.length}return t.COLORS[n]}Object.defineProperty(t,"__esModule",{value:!0}),t.COLORS=["#6ab9ec","#b1c854","#f7706c","#4585a5","#ffc335","#f7963e","#73c7c1","#85a9cf","#a3779f","#c8c2b4","#a47854"],t.getUserColor=n,t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),c=r(190),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.email,r=e.fullName,n=e.initials,i=e.image,l=s(e,["email","fullName","initials","image"]),u=c.default(t);return a.createElement("span",o({},l,{title:r}),a.createElement("span",{style:{backgroundColor:u}},n),!!i&&a.createElement("img",{src:i,alt:r}))},t}(a.Component);t.UserIconsIcon=l,t.default=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),c=r(190),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.email,r=e.fullName,n=e.initials,i=e.image,l=s(e,["email","fullName","initials","image"]),u=c.default(t);return a.createElement("div",o({},l,{title:r}),a.createElement("span",{style:{backgroundColor:u}},n),!!i&&a.createElement("img",{src:i,alt:r}))},t}(a.Component);t.UserIconsBlock=l,t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class Timer{constructor(e){this._isRunning=!1,this._timerId=0,this._delay=e}get isRunning(){return this._isRunning}set delay(e){this._delay=e}get delay(){return this._delay}setOnExecute(e){this._onExecute=e}start(){this._isRunning&&this.clearTimeout(),this._isRunning=!0,this.setTimeout()}stop(){this._isRunning&&(this._isRunning=!1,this.clearTimeout())}execute(){this._onExecute&&this._onExecute(),this._isRunning=!1}setTimeout(){this._timerId=window.setTimeout(()=>this.execute(),this._delay)}clearTimeout(){window.clearTimeout(this._timerId)}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});var i=r(92);t.UiComponents=i.default,n(r(718)),n(r(867)),n(r(868)),n(r(93)),n(r(878)),n(r(879)),n(r(375)),n(r(884)),n(r(213)),n(r(195)),n(r(890))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(341));var n=r(342);t.Tree=n.Tree;var i=r(726);t.withTreeDragDrop=i.withDragDrop;var o=r(848);t.SimpleTreeDataProvider=o.default},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(724)),o=r(0);var s;!function(e){e.ChangesApplied="changes.applied",e.ChildrenLoaded="children.loaded",e.DataLoaded="data.loaded",e.DataLoadError="data.loaderror",e.ModelLoaded="model.loaded",e.NodeAdded="node.added",e.NodeBlurred="node.blurred",e.NodeChecked="node.checked",e.NodeCollapsed="node.collapsed",e.NodeDeselected="node.deselected",e.NodeEdited="node.edited",e.NodeExpanded="node.expanded",e.NodeFocused="node.focused",e.NodeHidden="node.hidden",e.NodeMoved="node.moved",e.NodePaginated="node.paginated",e.NodeRemoved="node.removed",e.NodeSelected="node.selected",e.NodeShown="node.shown",e.NodeUnchecked="node.unchecked"}(s=t.BeInspireTreeEvent||(t.BeInspireTreeEvent={}));class EventsMuteContext{constructor(e,t,r,n,i,o=0){this._events=e,this._mute=t,this._unmute=r,this._emit=n,this._listen=i,this._triggeredEventsCount=0,this.init(o)}init(e){if(0===e||!this._listen)return void this._mute(this._events);let t;t=this._listen(this._events,()=>{++this._triggeredEventsCount>=e&&(this._mute(this._events),t())})}dispose(){this._unmute(this._events)&&this._emit&&this._emit(this._events)}}t.EventsMuteContext=EventsMuteContext;t.BeInspireTree=class BeInspireTree{constructor(e){this.doMute=(e=>{e.forEach(e=>{this._eventMutes.has(e)?this._eventMutes.set(e,this._eventMutes.get(e)+1):this._eventMutes.set(e,1)}),"boolean"!==typeof this._tree.muted()?this._tree.mute(e.concat(this._tree.muted())):this._tree.mute(e)}),this.doUnmute=(e=>{const t=e.filter(e=>{let t=this._eventMutes.get(e);return void 0!==t&&0!==t&&(this._eventMutes.set(e,--t),0===t)});return this._tree.unmute(t),t.length>0}),this.doEmit=(e=>{this._tree.emit(e)}),this._eventMutes=new Map,this._tree=new i.default({data:d(this,e.dataProvider,e.mapPayloadToInspireNodeConfig),pagination:{limit:e.pageSize},deferredLoading:!0,selection:{multiple:!0,autoDeselect:!1}}),this._tree.on([s.ChangesApplied],()=>e.renderer(this.visible())),this.onModelInvalidated()}onModelInvalidated(){this._readyPromise=new Promise(e=>{this._tree.once([s.ModelLoaded],e)}).then(async e=>{await o.using(this.pauseRendering(),async()=>{await l(e)})})}get ready(){return this._readyPromise}mute(e){return new EventsMuteContext(e,this.doMute,this.doUnmute)}pauseRendering(e=0){return new EventsMuteContext([s.ChangesApplied],this.doMute,this.doUnmute,e=>{this._tree.nodes().some(e=>t.toNode(e).isDirty())&&this.doEmit(e)},(e,t)=>(this.on(e,t),()=>this._tree.removeListener(e,t)),e)}applyChanges(){this.doEmit([s.ChangesApplied])}on(e,t){return this._tree.on(e,t),this}removeListener(e,t){return this._tree.removeListener(e,t),this}removeAllListeners(e){this._tree.removeAllListeners(e)}node(e){return t.toNode(this._tree.node(e))}nodes(e){return t.toNodes(this._tree.nodes(e))}flatten(){return t.toNodes(this._tree.flatten(()=>!0))}deepest(){return t.toNodes(this._tree.deepest())}expanded(){return t.toNodes(this._tree.expanded())}collapsed(){return t.toNodes(this._tree.collapsed())}selected(){return t.toNodes(this._tree.selected())}visible(){return t.toNodes(this._tree.visible())}async reload(){await o.using(this.pauseRendering(),async()=>{(await this._tree.reload()).forEach(e=>t.toNode(e).setDirty(!0))})}deselectAll(e=!0){o.using(this.mute(e?[s.NodeDeselected]:[]),()=>{this._tree.deselectDeep()})}selectBetween(e,r,n=!0){return o.using(this.mute(n?[s.NodeSelected]:[]),()=>{let n,i;e.indexPath()<=r.indexPath()?(n=e,i=r):(n=r,i=e);const o=new Array;let s=n;for(;s&&(o.push(t.toNode(s)),s.select(),s.id!==i.id);)s=t.toNode(s.nextVisibleNode());return o})}createSelectedNodePredicate(e){if(!e)return;let r;return r="function"===typeof e?r=>e(t.toNode(r).payload):r=>-1!==e.indexOf(t.toNode(r).id)}updateSelection(e,t,r){const n=this.createSelectedNodePredicate(t);n&&o.using(this.mute(r?[s.NodeSelected,s.NodeDeselected]:[]),()=>{this._tree.disableDeselection(),e(n),this._tree.enableDeselection()})}updateTreeSelection(e,t=!0){return this.updateSelection(e=>{this._tree.deselectDeep(),this._tree.flatten(e).select()},e,t)}updateNodesSelection(e,t,r=!0){return this.updateSelection(t=>{let r;(r=e.filterBy?e.filterBy(t).map(e=>e):e.filter(t)).forEach(e=>e.select())},t,r)}};const a=e=>e.hasOrWillHaveChildren()&&!e.hasLoadedChildren();async function c(e,r){const n=e.filter(e=>r.includes(t.toNode(e).id)),i=(await Promise.all(n.map(async e=>a(e)?await async function(e,t){const r=await e.loadChildren();return await c(r,t),r}(t.toNode(e),r):e.getChildren()))).reduce((e,t)=>(e.push(...t),e),[]);return await l(i),i}async function l(e){const r=e.filter(e=>e.expanded()).map(e=>t.toNode(e).id);r.length>0&&await c(e,r)}var u;t.toNode=(e=>{const t=e;if(!e)return t;if(!t._loadChildrenOverriden){const r=e.loadChildren;e.loadChildren=(()=>{const t=e;if(!t._loadingPromise){const n=r.call(e);t._loadingPromise=n.then(e=>(delete t._loadingPromise,e))}return t._loadingPromise}),t._loadChildrenOverriden=!0}if(!t._expandOverriden){const r=e.expand;e.expand=(async()=>{const n=t.beInspireTree,s=a(e)?1:0;return await o.using(n.pauseRendering(s),async()=>{const t=await r.call(e),n=(u=t,i.default.isTreeNodes(u)?t:t.getChildren());return await l(n),t})}),t._expandOverriden=!0}return t.isDirty=(()=>t.itree.dirty),t.setDirty=(e=>{e?t.markDirty():t.itree.dirty=e}),t}),t.toNodes=(e=>Object.assign(e.map(e=>t.toNode(e)),{node:r=>t.toNode(e.node(r)),nodes:r=>t.toNodes(e.nodes(r)),deepest:()=>t.toNodes(e.deepest()),flatten:()=>t.toNodes(e.flatten(()=>!0)),expanded:()=>t.toNodes(e.expanded()),collapsed:()=>t.toNodes(e.collapsed()),selected:()=>t.toNodes(e.selected()),visible:()=>t.toNodes(e.visible())}));const d=(e,t,r)=>{const n=t=>{return Object.assign({},r(t,n),{beInspireTree:e,payload:t})},i=e=>e.map(n),o=e=>e?e.payload:void 0;return Array.isArray(t)?i(t):"object"===typeof t?(e=>"object"===typeof e&&e.getNodesCount&&"function"===typeof e.getNodesCount&&e.getNodes&&"function"===typeof e.getNodes)(t)?e=>t.getNodes(o(e)).then(i):t.then(i):e=>t(o(e)).then(i)}},function(e,t,r){(function(e,n){var i;(function(){var o,s=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",c="Expected a function",l="__lodash_hash_undefined__",u=500,d="__lodash_placeholder__",h=1,p=2,f=4,g=1,m=2,y=1,v=2,_=4,w=8,S=16,b=32,x=64,P=128,C=256,T=512,M=30,E="...",I=800,A=16,R=1,O=2,D=1/0,k=9007199254740991,F=1.7976931348623157e308,N=NaN,L=4294967295,B=L-1,V=L>>>1,U=[["ary",P],["bind",y],["bindKey",v],["curry",w],["curryRight",S],["flip",T],["partial",b],["partialRight",x],["rearg",C]],z="[object Arguments]",j="[object Array]",G="[object AsyncFunction]",H="[object Boolean]",q="[object Date]",W="[object DOMException]",J="[object Error]",X="[object Function]",Y="[object GeneratorFunction]",K="[object Map]",Z="[object Number]",Q="[object Null]",$="[object Object]",ee="[object Proxy]",te="[object RegExp]",re="[object Set]",ne="[object String]",ie="[object Symbol]",oe="[object Undefined]",se="[object WeakMap]",ae="[object WeakSet]",ce="[object ArrayBuffer]",le="[object DataView]",ue="[object Float32Array]",de="[object Float64Array]",he="[object Int8Array]",pe="[object Int16Array]",fe="[object Int32Array]",ge="[object Uint8Array]",me="[object Uint8ClampedArray]",ye="[object Uint16Array]",ve="[object Uint32Array]",_e=/\b__p \+= '';/g,we=/\b(__p \+=) '' \+/g,Se=/(__e\(.*?\)|\b__t\)) \+\n'';/g,be=/&(?:amp|lt|gt|quot|#39);/g,xe=/[&<>"']/g,Pe=RegExp(be.source),Ce=RegExp(xe.source),Te=/<%-([\s\S]+?)%>/g,Me=/<%([\s\S]+?)%>/g,Ee=/<%=([\s\S]+?)%>/g,Ie=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ae=/^\w*$/,Re=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Oe=/[\\^$.*+?()[\]{}|]/g,De=RegExp(Oe.source),ke=/^\s+|\s+$/g,Fe=/^\s+/,Ne=/\s+$/,Le=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Be=/\{\n\/\* \[wrapped with (.+)\] \*/,Ve=/,? & /,Ue=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ze=/\\(\\)?/g,je=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ge=/\w*$/,He=/^[-+]0x[0-9a-f]+$/i,qe=/^0b[01]+$/i,We=/^\[object .+?Constructor\]$/,Je=/^0o[0-7]+$/i,Xe=/^(?:0|[1-9]\d*)$/,Ye=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ke=/($^)/,Ze=/['\n\r\u2028\u2029\\]/g,Qe="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",$e="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",et="[\\ud800-\\udfff]",tt="["+$e+"]",rt="["+Qe+"]",nt="\\d+",it="[\\u2700-\\u27bf]",ot="[a-z\\xdf-\\xf6\\xf8-\\xff]",st="[^\\ud800-\\udfff"+$e+nt+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",at="\\ud83c[\\udffb-\\udfff]",ct="[^\\ud800-\\udfff]",lt="(?:\\ud83c[\\udde6-\\uddff]){2}",ut="[\\ud800-\\udbff][\\udc00-\\udfff]",dt="[A-Z\\xc0-\\xd6\\xd8-\\xde]",ht="(?:"+ot+"|"+st+")",pt="(?:"+dt+"|"+st+")",ft="(?:"+rt+"|"+at+")"+"?",gt="[\\ufe0e\\ufe0f]?"+ft+("(?:\\u200d(?:"+[ct,lt,ut].join("|")+")[\\ufe0e\\ufe0f]?"+ft+")*"),mt="(?:"+[it,lt,ut].join("|")+")"+gt,yt="(?:"+[ct+rt+"?",rt,lt,ut,et].join("|")+")",vt=RegExp("['\u2019]","g"),_t=RegExp(rt,"g"),wt=RegExp(at+"(?="+at+")|"+yt+gt,"g"),St=RegExp([dt+"?"+ot+"+(?:['\u2019](?:d|ll|m|re|s|t|ve))?(?="+[tt,dt,"$"].join("|")+")",pt+"+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?(?="+[tt,dt+ht,"$"].join("|")+")",dt+"?"+ht+"+(?:['\u2019](?:d|ll|m|re|s|t|ve))?",dt+"+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",nt,mt].join("|"),"g"),bt=RegExp("[\\u200d\\ud800-\\udfff"+Qe+"\\ufe0e\\ufe0f]"),xt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Pt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ct=-1,Tt={};Tt[ue]=Tt[de]=Tt[he]=Tt[pe]=Tt[fe]=Tt[ge]=Tt[me]=Tt[ye]=Tt[ve]=!0,Tt[z]=Tt[j]=Tt[ce]=Tt[H]=Tt[le]=Tt[q]=Tt[J]=Tt[X]=Tt[K]=Tt[Z]=Tt[$]=Tt[te]=Tt[re]=Tt[ne]=Tt[se]=!1;var Mt={};Mt[z]=Mt[j]=Mt[ce]=Mt[le]=Mt[H]=Mt[q]=Mt[ue]=Mt[de]=Mt[he]=Mt[pe]=Mt[fe]=Mt[K]=Mt[Z]=Mt[$]=Mt[te]=Mt[re]=Mt[ne]=Mt[ie]=Mt[ge]=Mt[me]=Mt[ye]=Mt[ve]=!0,Mt[J]=Mt[X]=Mt[se]=!1;var Et={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},It=parseFloat,At=parseInt,Rt="object"==typeof e&&e&&e.Object===Object&&e,Ot="object"==typeof self&&self&&self.Object===Object&&self,Dt=Rt||Ot||Function("return this")(),kt=t&&!t.nodeType&&t,Ft=kt&&"object"==typeof n&&n&&!n.nodeType&&n,Nt=Ft&&Ft.exports===kt,Lt=Nt&&Rt.process,Bt=function(){try{var e=Ft&&Ft.require&&Ft.require("util").types;return e||Lt&&Lt.binding&&Lt.binding("util")}catch(e){}}(),Vt=Bt&&Bt.isArrayBuffer,Ut=Bt&&Bt.isDate,zt=Bt&&Bt.isMap,jt=Bt&&Bt.isRegExp,Gt=Bt&&Bt.isSet,Ht=Bt&&Bt.isTypedArray;function qt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Wt(e,t,r,n){for(var i=-1,o=null==e?0:e.length;++i<o;){var s=e[i];t(n,s,r(s),e)}return n}function Jt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function Xt(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function Yt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function Kt(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var s=e[r];t(s,r,e)&&(o[i++]=s)}return o}function Zt(e,t){return!!(null==e?0:e.length)&&ar(e,t,0)>-1}function Qt(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function $t(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function er(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function tr(e,t,r,n){var i=-1,o=null==e?0:e.length;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function rr(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function nr(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var ir=dr("length");function or(e,t,r){var n;return r(e,function(e,r,i){if(t(e,r,i))return n=r,!1}),n}function sr(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function ar(e,t,r){return t===t?function(e,t,r){var n=r-1,i=e.length;for(;++n<i;)if(e[n]===t)return n;return-1}(e,t,r):sr(e,lr,r)}function cr(e,t,r,n){for(var i=r-1,o=e.length;++i<o;)if(n(e[i],t))return i;return-1}function lr(e){return e!==e}function ur(e,t){var r=null==e?0:e.length;return r?fr(e,t)/r:N}function dr(e){return function(t){return null==t?o:t[e]}}function hr(e){return function(t){return null==e?o:e[t]}}function pr(e,t,r,n,i){return i(e,function(e,i,o){r=n?(n=!1,e):t(r,e,i,o)}),r}function fr(e,t){for(var r,n=-1,i=e.length;++n<i;){var s=t(e[n]);s!==o&&(r=r===o?s:r+s)}return r}function gr(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function mr(e){return function(t){return e(t)}}function yr(e,t){return $t(t,function(t){return e[t]})}function vr(e,t){return e.has(t)}function _r(e,t){for(var r=-1,n=e.length;++r<n&&ar(t,e[r],0)>-1;);return r}function wr(e,t){for(var r=e.length;r--&&ar(t,e[r],0)>-1;);return r}var Sr=hr({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),br=hr({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function xr(e){return"\\"+Et[e]}function Pr(e){return bt.test(e)}function Cr(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function Tr(e,t){return function(r){return e(t(r))}}function Mr(e,t){for(var r=-1,n=e.length,i=0,o=[];++r<n;){var s=e[r];s!==t&&s!==d||(e[r]=d,o[i++]=r)}return o}function Er(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}function Ir(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=[e,e]}),r}function Ar(e){return Pr(e)?function(e){var t=wt.lastIndex=0;for(;wt.test(e);)++t;return t}(e):ir(e)}function Rr(e){return Pr(e)?function(e){return e.match(wt)||[]}(e):function(e){return e.split("")}(e)}var Or=hr({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Dr=function e(t){var r,n=(t=null==t?Dt:Dr.defaults(Dt.Object(),t,Dr.pick(Dt,Pt))).Array,i=t.Date,Qe=t.Error,$e=t.Function,et=t.Math,tt=t.Object,rt=t.RegExp,nt=t.String,it=t.TypeError,ot=n.prototype,st=$e.prototype,at=tt.prototype,ct=t["__core-js_shared__"],lt=st.toString,ut=at.hasOwnProperty,dt=0,ht=(r=/[^.]+$/.exec(ct&&ct.keys&&ct.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",pt=at.toString,ft=lt.call(tt),gt=Dt._,mt=rt("^"+lt.call(ut).replace(Oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yt=Nt?t.Buffer:o,wt=t.Symbol,bt=t.Uint8Array,Et=yt?yt.allocUnsafe:o,Rt=Tr(tt.getPrototypeOf,tt),Ot=tt.create,kt=at.propertyIsEnumerable,Ft=ot.splice,Lt=wt?wt.isConcatSpreadable:o,Bt=wt?wt.iterator:o,ir=wt?wt.toStringTag:o,hr=function(){try{var e=Vo(tt,"defineProperty");return e({},"",{}),e}catch(e){}}(),kr=t.clearTimeout!==Dt.clearTimeout&&t.clearTimeout,Fr=i&&i.now!==Dt.Date.now&&i.now,Nr=t.setTimeout!==Dt.setTimeout&&t.setTimeout,Lr=et.ceil,Br=et.floor,Vr=tt.getOwnPropertySymbols,Ur=yt?yt.isBuffer:o,zr=t.isFinite,jr=ot.join,Gr=Tr(tt.keys,tt),Hr=et.max,qr=et.min,Wr=i.now,Jr=t.parseInt,Xr=et.random,Yr=ot.reverse,Kr=Vo(t,"DataView"),Zr=Vo(t,"Map"),Qr=Vo(t,"Promise"),$r=Vo(t,"Set"),en=Vo(t,"WeakMap"),tn=Vo(tt,"create"),rn=en&&new en,nn={},on=ds(Kr),sn=ds(Zr),an=ds(Qr),cn=ds($r),ln=ds(en),un=wt?wt.prototype:o,dn=un?un.valueOf:o,hn=un?un.toString:o;function pn(e){if(Ea(e)&&!ya(e)&&!(e instanceof yn)){if(e instanceof mn)return e;if(ut.call(e,"__wrapped__"))return hs(e)}return new mn(e)}var fn=function(){function e(){}return function(t){if(!Ma(t))return{};if(Ot)return Ot(t);e.prototype=t;var r=new e;return e.prototype=o,r}}();function gn(){}function mn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=o}function yn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=L,this.__views__=[]}function vn(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function _n(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function wn(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Sn(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new wn;++t<r;)this.add(e[t])}function bn(e){var t=this.__data__=new _n(e);this.size=t.size}function xn(e,t){var r=ya(e),n=!r&&ma(e),i=!r&&!n&&Sa(e),o=!r&&!n&&!i&&Na(e),s=r||n||i||o,a=s?gr(e.length,nt):[],c=a.length;for(var l in e)!t&&!ut.call(e,l)||s&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Wo(l,c))||a.push(l);return a}function Pn(e){var t=e.length;return t?e[Si(0,t-1)]:o}function Cn(e,t){return cs(ro(e),kn(t,0,e.length))}function Tn(e){return cs(ro(e))}function Mn(e,t,r){(r===o||pa(e[t],r))&&(r!==o||t in e)||On(e,t,r)}function En(e,t,r){var n=e[t];ut.call(e,t)&&pa(n,r)&&(r!==o||t in e)||On(e,t,r)}function In(e,t){for(var r=e.length;r--;)if(pa(e[r][0],t))return r;return-1}function An(e,t,r,n){return Vn(e,function(e,i,o){t(n,e,r(e),o)}),n}function Rn(e,t){return e&&no(t,ic(t),e)}function On(e,t,r){"__proto__"==t&&hr?hr(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Dn(e,t){for(var r=-1,i=t.length,s=n(i),a=null==e;++r<i;)s[r]=a?o:$a(e,t[r]);return s}function kn(e,t,r){return e===e&&(r!==o&&(e=e<=r?e:r),t!==o&&(e=e>=t?e:t)),e}function Fn(e,t,r,n,i,s){var a,c=t&h,l=t&p,u=t&f;if(r&&(a=i?r(e,n,i,s):r(e)),a!==o)return a;if(!Ma(e))return e;var d=ya(e);if(d){if(a=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&ut.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!c)return ro(e,a)}else{var g=jo(e),m=g==X||g==Y;if(Sa(e))return Ki(e,c);if(g==$||g==z||m&&!i){if(a=l||m?{}:Ho(e),!c)return l?function(e,t){return no(e,zo(e),t)}(e,function(e,t){return e&&no(t,oc(t),e)}(a,e)):function(e,t){return no(e,Uo(e),t)}(e,Rn(a,e))}else{if(!Mt[g])return i?e:{};a=function(e,t,r){var n,i,o,s=e.constructor;switch(t){case ce:return Zi(e);case H:case q:return new s(+e);case le:return function(e,t){var r=t?Zi(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case ue:case de:case he:case pe:case fe:case ge:case me:case ye:case ve:return Qi(e,r);case K:return new s;case Z:case ne:return new s(e);case te:return(o=new(i=e).constructor(i.source,Ge.exec(i))).lastIndex=i.lastIndex,o;case re:return new s;case ie:return n=e,dn?tt(dn.call(n)):{}}}(e,g,c)}}s||(s=new bn);var y=s.get(e);if(y)return y;if(s.set(e,a),Da(e))return e.forEach(function(n){a.add(Fn(n,t,r,n,e,s))}),a;if(Ia(e))return e.forEach(function(n,i){a.set(i,Fn(n,t,r,i,e,s))}),a;var v=d?o:(u?l?Oo:Ro:l?oc:ic)(e);return Jt(v||e,function(n,i){v&&(n=e[i=n]),En(a,i,Fn(n,t,r,i,e,s))}),a}function Nn(e,t,r){var n=r.length;if(null==e)return!n;for(e=tt(e);n--;){var i=r[n],s=t[i],a=e[i];if(a===o&&!(i in e)||!s(a))return!1}return!0}function Ln(e,t,r){if("function"!=typeof e)throw new it(c);return is(function(){e.apply(o,r)},t)}function Bn(e,t,r,n){var i=-1,o=Zt,a=!0,c=e.length,l=[],u=t.length;if(!c)return l;r&&(t=$t(t,mr(r))),n?(o=Qt,a=!1):t.length>=s&&(o=vr,a=!1,t=new Sn(t));e:for(;++i<c;){var d=e[i],h=null==r?d:r(d);if(d=n||0!==d?d:0,a&&h===h){for(var p=u;p--;)if(t[p]===h)continue e;l.push(d)}else o(t,h,n)||l.push(d)}return l}pn.templateSettings={escape:Te,evaluate:Me,interpolate:Ee,variable:"",imports:{_:pn}},pn.prototype=gn.prototype,pn.prototype.constructor=pn,mn.prototype=fn(gn.prototype),mn.prototype.constructor=mn,yn.prototype=fn(gn.prototype),yn.prototype.constructor=yn,vn.prototype.clear=function(){this.__data__=tn?tn(null):{},this.size=0},vn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},vn.prototype.get=function(e){var t=this.__data__;if(tn){var r=t[e];return r===l?o:r}return ut.call(t,e)?t[e]:o},vn.prototype.has=function(e){var t=this.__data__;return tn?t[e]!==o:ut.call(t,e)},vn.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=tn&&t===o?l:t,this},_n.prototype.clear=function(){this.__data__=[],this.size=0},_n.prototype.delete=function(e){var t=this.__data__,r=In(t,e);return!(r<0)&&(r==t.length-1?t.pop():Ft.call(t,r,1),--this.size,!0)},_n.prototype.get=function(e){var t=this.__data__,r=In(t,e);return r<0?o:t[r][1]},_n.prototype.has=function(e){return In(this.__data__,e)>-1},_n.prototype.set=function(e,t){var r=this.__data__,n=In(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},wn.prototype.clear=function(){this.size=0,this.__data__={hash:new vn,map:new(Zr||_n),string:new vn}},wn.prototype.delete=function(e){var t=Lo(this,e).delete(e);return this.size-=t?1:0,t},wn.prototype.get=function(e){return Lo(this,e).get(e)},wn.prototype.has=function(e){return Lo(this,e).has(e)},wn.prototype.set=function(e,t){var r=Lo(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},Sn.prototype.add=Sn.prototype.push=function(e){return this.__data__.set(e,l),this},Sn.prototype.has=function(e){return this.__data__.has(e)},bn.prototype.clear=function(){this.__data__=new _n,this.size=0},bn.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},bn.prototype.get=function(e){return this.__data__.get(e)},bn.prototype.has=function(e){return this.__data__.has(e)},bn.prototype.set=function(e,t){var r=this.__data__;if(r instanceof _n){var n=r.__data__;if(!Zr||n.length<s-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new wn(n)}return r.set(e,t),this.size=r.size,this};var Vn=so(Jn),Un=so(Xn,!0);function zn(e,t){var r=!0;return Vn(e,function(e,n,i){return r=!!t(e,n,i)}),r}function jn(e,t,r){for(var n=-1,i=e.length;++n<i;){var s=e[n],a=t(s);if(null!=a&&(c===o?a===a&&!Fa(a):r(a,c)))var c=a,l=s}return l}function Gn(e,t){var r=[];return Vn(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r}function Hn(e,t,r,n,i){var o=-1,s=e.length;for(r||(r=qo),i||(i=[]);++o<s;){var a=e[o];t>0&&r(a)?t>1?Hn(a,t-1,r,n,i):er(i,a):n||(i[i.length]=a)}return i}var qn=ao(),Wn=ao(!0);function Jn(e,t){return e&&qn(e,t,ic)}function Xn(e,t){return e&&Wn(e,t,ic)}function Yn(e,t){return Kt(t,function(t){return Pa(e[t])})}function Kn(e,t){for(var r=0,n=(t=Wi(t,e)).length;null!=e&&r<n;)e=e[us(t[r++])];return r&&r==n?e:o}function Zn(e,t,r){var n=t(e);return ya(e)?n:er(n,r(e))}function Qn(e){return null==e?e===o?oe:Q:ir&&ir in tt(e)?function(e){var t=ut.call(e,ir),r=e[ir];try{e[ir]=o;var n=!0}catch(e){}var i=pt.call(e);return n&&(t?e[ir]=r:delete e[ir]),i}(e):function(e){return pt.call(e)}(e)}function $n(e,t){return e>t}function ei(e,t){return null!=e&&ut.call(e,t)}function ti(e,t){return null!=e&&t in tt(e)}function ri(e,t,r){for(var i=r?Qt:Zt,s=e[0].length,a=e.length,c=a,l=n(a),u=1/0,d=[];c--;){var h=e[c];c&&t&&(h=$t(h,mr(t))),u=qr(h.length,u),l[c]=!r&&(t||s>=120&&h.length>=120)?new Sn(c&&h):o}h=e[0];var p=-1,f=l[0];e:for(;++p<s&&d.length<u;){var g=h[p],m=t?t(g):g;if(g=r||0!==g?g:0,!(f?vr(f,m):i(d,m,r))){for(c=a;--c;){var y=l[c];if(!(y?vr(y,m):i(e[c],m,r)))continue e}f&&f.push(m),d.push(g)}}return d}function ni(e,t,r){var n=null==(e=ts(e,t=Wi(t,e)))?e:e[us(xs(t))];return null==n?o:qt(n,e,r)}function ii(e){return Ea(e)&&Qn(e)==z}function oi(e,t,r,n,i){return e===t||(null==e||null==t||!Ea(e)&&!Ea(t)?e!==e&&t!==t:function(e,t,r,n,i,s){var a=ya(e),c=ya(t),l=a?j:jo(e),u=c?j:jo(t),d=(l=l==z?$:l)==$,h=(u=u==z?$:u)==$,p=l==u;if(p&&Sa(e)){if(!Sa(t))return!1;a=!0,d=!1}if(p&&!d)return s||(s=new bn),a||Na(e)?Io(e,t,r,n,i,s):function(e,t,r,n,i,o,s){switch(r){case le:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ce:return!(e.byteLength!=t.byteLength||!o(new bt(e),new bt(t)));case H:case q:case Z:return pa(+e,+t);case J:return e.name==t.name&&e.message==t.message;case te:case ne:return e==t+"";case K:var a=Cr;case re:var c=n&g;if(a||(a=Er),e.size!=t.size&&!c)return!1;var l=s.get(e);if(l)return l==t;n|=m,s.set(e,t);var u=Io(a(e),a(t),n,i,o,s);return s.delete(e),u;case ie:if(dn)return dn.call(e)==dn.call(t)}return!1}(e,t,l,r,n,i,s);if(!(r&g)){var f=d&&ut.call(e,"__wrapped__"),y=h&&ut.call(t,"__wrapped__");if(f||y){var v=f?e.value():e,_=y?t.value():t;return s||(s=new bn),i(v,_,r,n,s)}}return!!p&&(s||(s=new bn),function(e,t,r,n,i,s){var a=r&g,c=Ro(e),l=c.length,u=Ro(t).length;if(l!=u&&!a)return!1;for(var d=l;d--;){var h=c[d];if(!(a?h in t:ut.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var f=!0;s.set(e,t),s.set(t,e);for(var m=a;++d<l;){h=c[d];var y=e[h],v=t[h];if(n)var _=a?n(v,y,h,t,e,s):n(y,v,h,e,t,s);if(!(_===o?y===v||i(y,v,r,n,s):_)){f=!1;break}m||(m="constructor"==h)}if(f&&!m){var w=e.constructor,S=t.constructor;w!=S&&"constructor"in e&&"constructor"in t&&!("function"==typeof w&&w instanceof w&&"function"==typeof S&&S instanceof S)&&(f=!1)}return s.delete(e),s.delete(t),f}(e,t,r,n,i,s))}(e,t,r,n,oi,i))}function si(e,t,r,n){var i=r.length,s=i,a=!n;if(null==e)return!s;for(e=tt(e);i--;){var c=r[i];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++i<s;){var l=(c=r[i])[0],u=e[l],d=c[1];if(a&&c[2]){if(u===o&&!(l in e))return!1}else{var h=new bn;if(n)var p=n(u,d,l,e,t,h);if(!(p===o?oi(d,u,g|m,n,h):p))return!1}}return!0}function ai(e){return!(!Ma(e)||ht&&ht in e)&&(Pa(e)?mt:We).test(ds(e))}function ci(e){return"function"==typeof e?e:null==e?Ac:"object"==typeof e?ya(e)?fi(e[0],e[1]):pi(e):Vc(e)}function li(e){if(!Zo(e))return Gr(e);var t=[];for(var r in tt(e))ut.call(e,r)&&"constructor"!=r&&t.push(r);return t}function ui(e){if(!Ma(e))return function(e){var t=[];if(null!=e)for(var r in tt(e))t.push(r);return t}(e);var t=Zo(e),r=[];for(var n in e)("constructor"!=n||!t&&ut.call(e,n))&&r.push(n);return r}function di(e,t){return e<t}function hi(e,t){var r=-1,i=_a(e)?n(e.length):[];return Vn(e,function(e,n,o){i[++r]=t(e,n,o)}),i}function pi(e){var t=Bo(e);return 1==t.length&&t[0][2]?$o(t[0][0],t[0][1]):function(r){return r===e||si(r,e,t)}}function fi(e,t){return Xo(e)&&Qo(t)?$o(us(e),t):function(r){var n=$a(r,e);return n===o&&n===t?ec(r,e):oi(t,n,g|m)}}function gi(e,t,r,n,i){e!==t&&qn(t,function(s,a){if(Ma(s))i||(i=new bn),function(e,t,r,n,i,s,a){var c=rs(e,r),l=rs(t,r),u=a.get(l);if(u)Mn(e,r,u);else{var d=s?s(c,l,r+"",e,t,a):o,h=d===o;if(h){var p=ya(l),f=!p&&Sa(l),g=!p&&!f&&Na(l);d=l,p||f||g?ya(c)?d=c:wa(c)?d=ro(c):f?(h=!1,d=Ki(l,!0)):g?(h=!1,d=Qi(l,!0)):d=[]:Ra(l)||ma(l)?(d=c,ma(c)?d=Ha(c):Ma(c)&&!Pa(c)||(d=Ho(l))):h=!1}h&&(a.set(l,d),i(d,l,n,s,a),a.delete(l)),Mn(e,r,d)}}(e,t,a,r,gi,n,i);else{var c=n?n(rs(e,a),s,a+"",e,t,i):o;c===o&&(c=s),Mn(e,a,c)}},oc)}function mi(e,t){var r=e.length;if(r)return Wo(t+=t<0?r:0,r)?e[t]:o}function yi(e,t,r){var n=-1;return t=$t(t.length?t:[Ac],mr(No())),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(hi(e,function(e,r,i){return{criteria:$t(t,function(t){return t(e)}),index:++n,value:e}}),function(e,t){return function(e,t,r){for(var n=-1,i=e.criteria,o=t.criteria,s=i.length,a=r.length;++n<s;){var c=$i(i[n],o[n]);if(c){if(n>=a)return c;var l=r[n];return c*("desc"==l?-1:1)}}return e.index-t.index}(e,t,r)})}function vi(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var s=t[n],a=Kn(e,s);r(a,s)&&Ti(o,Wi(s,e),a)}return o}function _i(e,t,r,n){var i=n?cr:ar,o=-1,s=t.length,a=e;for(e===t&&(t=ro(t)),r&&(a=$t(e,mr(r)));++o<s;)for(var c=0,l=t[o],u=r?r(l):l;(c=i(a,u,c,n))>-1;)a!==e&&Ft.call(a,c,1),Ft.call(e,c,1);return e}function wi(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==o){var o=i;Wo(i)?Ft.call(e,i,1):Bi(e,i)}}return e}function Si(e,t){return e+Br(Xr()*(t-e+1))}function bi(e,t){var r="";if(!e||t<1||t>k)return r;do{t%2&&(r+=e),(t=Br(t/2))&&(e+=e)}while(t);return r}function xi(e,t){return os(es(e,t,Ac),e+"")}function Pi(e){return Pn(pc(e))}function Ci(e,t){var r=pc(e);return cs(r,kn(t,0,r.length))}function Ti(e,t,r,n){if(!Ma(e))return e;for(var i=-1,s=(t=Wi(t,e)).length,a=s-1,c=e;null!=c&&++i<s;){var l=us(t[i]),u=r;if(i!=a){var d=c[l];(u=n?n(d,l,c):o)===o&&(u=Ma(d)?d:Wo(t[i+1])?[]:{})}En(c,l,u),c=c[l]}return e}var Mi=rn?function(e,t){return rn.set(e,t),e}:Ac,Ei=hr?function(e,t){return hr(e,"toString",{configurable:!0,enumerable:!1,value:Mc(t),writable:!0})}:Ac;function Ii(e){return cs(pc(e))}function Ai(e,t,r){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var s=n(o);++i<o;)s[i]=e[i+t];return s}function Ri(e,t){var r;return Vn(e,function(e,n,i){return!(r=t(e,n,i))}),!!r}function Oi(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t===t&&i<=V){for(;n<i;){var o=n+i>>>1,s=e[o];null!==s&&!Fa(s)&&(r?s<=t:s<t)?n=o+1:i=o}return i}return Di(e,t,Ac,r)}function Di(e,t,r,n){t=r(t);for(var i=0,s=null==e?0:e.length,a=t!==t,c=null===t,l=Fa(t),u=t===o;i<s;){var d=Br((i+s)/2),h=r(e[d]),p=h!==o,f=null===h,g=h===h,m=Fa(h);if(a)var y=n||g;else y=u?g&&(n||p):c?g&&p&&(n||!f):l?g&&p&&!f&&(n||!m):!f&&!m&&(n?h<=t:h<t);y?i=d+1:s=d}return qr(s,B)}function ki(e,t){for(var r=-1,n=e.length,i=0,o=[];++r<n;){var s=e[r],a=t?t(s):s;if(!r||!pa(a,c)){var c=a;o[i++]=0===s?0:s}}return o}function Fi(e){return"number"==typeof e?e:Fa(e)?N:+e}function Ni(e){if("string"==typeof e)return e;if(ya(e))return $t(e,Ni)+"";if(Fa(e))return hn?hn.call(e):"";var t=e+"";return"0"==t&&1/e==-D?"-0":t}function Li(e,t,r){var n=-1,i=Zt,o=e.length,a=!0,c=[],l=c;if(r)a=!1,i=Qt;else if(o>=s){var u=t?null:xo(e);if(u)return Er(u);a=!1,i=vr,l=new Sn}else l=t?[]:c;e:for(;++n<o;){var d=e[n],h=t?t(d):d;if(d=r||0!==d?d:0,a&&h===h){for(var p=l.length;p--;)if(l[p]===h)continue e;t&&l.push(h),c.push(d)}else i(l,h,r)||(l!==c&&l.push(h),c.push(d))}return c}function Bi(e,t){return null==(e=ts(e,t=Wi(t,e)))||delete e[us(xs(t))]}function Vi(e,t,r,n){return Ti(e,t,r(Kn(e,t)),n)}function Ui(e,t,r,n){for(var i=e.length,o=n?i:-1;(n?o--:++o<i)&&t(e[o],o,e););return r?Ai(e,n?0:o,n?o+1:i):Ai(e,n?o+1:0,n?i:o)}function zi(e,t){var r=e;return r instanceof yn&&(r=r.value()),tr(t,function(e,t){return t.func.apply(t.thisArg,er([e],t.args))},r)}function ji(e,t,r){var i=e.length;if(i<2)return i?Li(e[0]):[];for(var o=-1,s=n(i);++o<i;)for(var a=e[o],c=-1;++c<i;)c!=o&&(s[o]=Bn(s[o]||a,e[c],t,r));return Li(Hn(s,1),t,r)}function Gi(e,t,r){for(var n=-1,i=e.length,s=t.length,a={};++n<i;){var c=n<s?t[n]:o;r(a,e[n],c)}return a}function Hi(e){return wa(e)?e:[]}function qi(e){return"function"==typeof e?e:Ac}function Wi(e,t){return ya(e)?e:Xo(e,t)?[e]:ls(qa(e))}var Ji=xi;function Xi(e,t,r){var n=e.length;return r=r===o?n:r,!t&&r>=n?e:Ai(e,t,r)}var Yi=kr||function(e){return Dt.clearTimeout(e)};function Ki(e,t){if(t)return e.slice();var r=e.length,n=Et?Et(r):new e.constructor(r);return e.copy(n),n}function Zi(e){var t=new e.constructor(e.byteLength);return new bt(t).set(new bt(e)),t}function Qi(e,t){var r=t?Zi(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function $i(e,t){if(e!==t){var r=e!==o,n=null===e,i=e===e,s=Fa(e),a=t!==o,c=null===t,l=t===t,u=Fa(t);if(!c&&!u&&!s&&e>t||s&&a&&l&&!c&&!u||n&&a&&l||!r&&l||!i)return 1;if(!n&&!s&&!u&&e<t||u&&r&&i&&!n&&!s||c&&r&&i||!a&&i||!l)return-1}return 0}function eo(e,t,r,i){for(var o=-1,s=e.length,a=r.length,c=-1,l=t.length,u=Hr(s-a,0),d=n(l+u),h=!i;++c<l;)d[c]=t[c];for(;++o<a;)(h||o<s)&&(d[r[o]]=e[o]);for(;u--;)d[c++]=e[o++];return d}function to(e,t,r,i){for(var o=-1,s=e.length,a=-1,c=r.length,l=-1,u=t.length,d=Hr(s-c,0),h=n(d+u),p=!i;++o<d;)h[o]=e[o];for(var f=o;++l<u;)h[f+l]=t[l];for(;++a<c;)(p||o<s)&&(h[f+r[a]]=e[o++]);return h}function ro(e,t){var r=-1,i=e.length;for(t||(t=n(i));++r<i;)t[r]=e[r];return t}function no(e,t,r,n){var i=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var c=t[s],l=n?n(r[c],e[c],c,r,e):o;l===o&&(l=e[c]),i?On(r,c,l):En(r,c,l)}return r}function io(e,t){return function(r,n){var i=ya(r)?Wt:An,o=t?t():{};return i(r,e,No(n,2),o)}}function oo(e){return xi(function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:o,a=i>2?r[2]:o;for(s=e.length>3&&"function"==typeof s?(i--,s):o,a&&Jo(r[0],r[1],a)&&(s=i<3?o:s,i=1),t=tt(t);++n<i;){var c=r[n];c&&e(t,c,n,s)}return t})}function so(e,t){return function(r,n){if(null==r)return r;if(!_a(r))return e(r,n);for(var i=r.length,o=t?i:-1,s=tt(r);(t?o--:++o<i)&&!1!==n(s[o],o,s););return r}}function ao(e){return function(t,r,n){for(var i=-1,o=tt(t),s=n(t),a=s.length;a--;){var c=s[e?a:++i];if(!1===r(o[c],c,o))break}return t}}function co(e){return function(t){var r=Pr(t=qa(t))?Rr(t):o,n=r?r[0]:t.charAt(0),i=r?Xi(r,1).join(""):t.slice(1);return n[e]()+i}}function lo(e){return function(t){return tr(Pc(mc(t).replace(vt,"")),e,"")}}function uo(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=fn(e.prototype),n=e.apply(r,t);return Ma(n)?n:r}}function ho(e){return function(t,r,n){var i=tt(t);if(!_a(t)){var s=No(r,3);t=ic(t),r=function(e){return s(i[e],e,i)}}var a=e(t,r,n);return a>-1?i[s?t[a]:a]:o}}function po(e){return Ao(function(t){var r=t.length,n=r,i=mn.prototype.thru;for(e&&t.reverse();n--;){var s=t[n];if("function"!=typeof s)throw new it(c);if(i&&!a&&"wrapper"==ko(s))var a=new mn([],!0)}for(n=a?n:r;++n<r;){var l=ko(s=t[n]),u="wrapper"==l?Do(s):o;a=u&&Yo(u[0])&&u[1]==(P|w|b|C)&&!u[4].length&&1==u[9]?a[ko(u[0])].apply(a,u[3]):1==s.length&&Yo(s)?a[l]():a.thru(s)}return function(){var e=arguments,n=e[0];if(a&&1==e.length&&ya(n))return a.plant(n).value();for(var i=0,o=r?t[i].apply(this,e):n;++i<r;)o=t[i].call(this,o);return o}})}function fo(e,t,r,i,s,a,c,l,u,d){var h=t&P,p=t&y,f=t&v,g=t&(w|S),m=t&T,_=f?o:uo(e);return function y(){for(var v=arguments.length,w=n(v),S=v;S--;)w[S]=arguments[S];if(g)var b=Fo(y),x=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(w,b);if(i&&(w=eo(w,i,s,g)),a&&(w=to(w,a,c,g)),v-=x,g&&v<d){var P=Mr(w,b);return So(e,t,fo,y.placeholder,r,w,P,l,u,d-v)}var C=p?r:this,T=f?C[e]:e;return v=w.length,l?w=function(e,t){for(var r=e.length,n=qr(t.length,r),i=ro(e);n--;){var s=t[n];e[n]=Wo(s,r)?i[s]:o}return e}(w,l):m&&v>1&&w.reverse(),h&&u<v&&(w.length=u),this&&this!==Dt&&this instanceof y&&(T=_||uo(T)),T.apply(C,w)}}function go(e,t){return function(r,n){return function(e,t,r,n){return Jn(e,function(e,i,o){t(n,r(e),i,o)}),n}(r,e,t(n),{})}}function mo(e,t){return function(r,n){var i;if(r===o&&n===o)return t;if(r!==o&&(i=r),n!==o){if(i===o)return n;"string"==typeof r||"string"==typeof n?(r=Ni(r),n=Ni(n)):(r=Fi(r),n=Fi(n)),i=e(r,n)}return i}}function yo(e){return Ao(function(t){return t=$t(t,mr(No())),xi(function(r){var n=this;return e(t,function(e){return qt(e,n,r)})})})}function vo(e,t){var r=(t=t===o?" ":Ni(t)).length;if(r<2)return r?bi(t,e):t;var n=bi(t,Lr(e/Ar(t)));return Pr(t)?Xi(Rr(n),0,e).join(""):n.slice(0,e)}function _o(e){return function(t,r,i){return i&&"number"!=typeof i&&Jo(t,r,i)&&(r=i=o),t=Ua(t),r===o?(r=t,t=0):r=Ua(r),function(e,t,r,i){for(var o=-1,s=Hr(Lr((t-e)/(r||1)),0),a=n(s);s--;)a[i?s:++o]=e,e+=r;return a}(t,r,i=i===o?t<r?1:-1:Ua(i),e)}}function wo(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=Ga(t),r=Ga(r)),e(t,r)}}function So(e,t,r,n,i,s,a,c,l,u){var d=t&w;t|=d?b:x,(t&=~(d?x:b))&_||(t&=~(y|v));var h=[e,t,i,d?s:o,d?a:o,d?o:s,d?o:a,c,l,u],p=r.apply(o,h);return Yo(e)&&ns(p,h),p.placeholder=n,ss(p,e,t)}function bo(e){var t=et[e];return function(e,r){if(e=Ga(e),r=null==r?0:qr(za(r),292)){var n=(qa(e)+"e").split("e");return+((n=(qa(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var xo=$r&&1/Er(new $r([,-0]))[1]==D?function(e){return new $r(e)}:Fc;function Po(e){return function(t){var r=jo(t);return r==K?Cr(t):r==re?Ir(t):function(e,t){return $t(t,function(t){return[t,e[t]]})}(t,e(t))}}function Co(e,t,r,i,s,a,l,u){var h=t&v;if(!h&&"function"!=typeof e)throw new it(c);var p=i?i.length:0;if(p||(t&=~(b|x),i=s=o),l=l===o?l:Hr(za(l),0),u=u===o?u:za(u),p-=s?s.length:0,t&x){var f=i,g=s;i=s=o}var m=h?o:Do(e),T=[e,t,r,i,s,f,g,a,l,u];if(m&&function(e,t){var r=e[1],n=t[1],i=r|n,o=i<(y|v|P),s=n==P&&r==w||n==P&&r==C&&e[7].length<=t[8]||n==(P|C)&&t[7].length<=t[8]&&r==w;if(!o&&!s)return e;n&y&&(e[2]=t[2],i|=r&y?0:_);var a=t[3];if(a){var c=e[3];e[3]=c?eo(c,a,t[4]):a,e[4]=c?Mr(e[3],d):t[4]}(a=t[5])&&(c=e[5],e[5]=c?to(c,a,t[6]):a,e[6]=c?Mr(e[5],d):t[6]),(a=t[7])&&(e[7]=a),n&P&&(e[8]=null==e[8]?t[8]:qr(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(T,m),e=T[0],t=T[1],r=T[2],i=T[3],s=T[4],!(u=T[9]=T[9]===o?h?0:e.length:Hr(T[9]-p,0))&&t&(w|S)&&(t&=~(w|S)),t&&t!=y)M=t==w||t==S?function(e,t,r){var i=uo(e);return function s(){for(var a=arguments.length,c=n(a),l=a,u=Fo(s);l--;)c[l]=arguments[l];var d=a<3&&c[0]!==u&&c[a-1]!==u?[]:Mr(c,u);return(a-=d.length)<r?So(e,t,fo,s.placeholder,o,c,d,o,o,r-a):qt(this&&this!==Dt&&this instanceof s?i:e,this,c)}}(e,t,u):t!=b&&t!=(y|b)||s.length?fo.apply(o,T):function(e,t,r,i){var o=t&y,s=uo(e);return function t(){for(var a=-1,c=arguments.length,l=-1,u=i.length,d=n(u+c),h=this&&this!==Dt&&this instanceof t?s:e;++l<u;)d[l]=i[l];for(;c--;)d[l++]=arguments[++a];return qt(h,o?r:this,d)}}(e,t,r,i);else var M=function(e,t,r){var n=t&y,i=uo(e);return function t(){return(this&&this!==Dt&&this instanceof t?i:e).apply(n?r:this,arguments)}}(e,t,r);return ss((m?Mi:ns)(M,T),e,t)}function To(e,t,r,n){return e===o||pa(e,at[r])&&!ut.call(n,r)?t:e}function Mo(e,t,r,n,i,s){return Ma(e)&&Ma(t)&&(s.set(t,e),gi(e,t,o,Mo,s),s.delete(t)),e}function Eo(e){return Ra(e)?o:e}function Io(e,t,r,n,i,s){var a=r&g,c=e.length,l=t.length;if(c!=l&&!(a&&l>c))return!1;var u=s.get(e);if(u&&s.get(t))return u==t;var d=-1,h=!0,p=r&m?new Sn:o;for(s.set(e,t),s.set(t,e);++d<c;){var f=e[d],y=t[d];if(n)var v=a?n(y,f,d,t,e,s):n(f,y,d,e,t,s);if(v!==o){if(v)continue;h=!1;break}if(p){if(!nr(t,function(e,t){if(!vr(p,t)&&(f===e||i(f,e,r,n,s)))return p.push(t)})){h=!1;break}}else if(f!==y&&!i(f,y,r,n,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function Ao(e){return os(es(e,o,vs),e+"")}function Ro(e){return Zn(e,ic,Uo)}function Oo(e){return Zn(e,oc,zo)}var Do=rn?function(e){return rn.get(e)}:Fc;function ko(e){for(var t=e.name+"",r=nn[t],n=ut.call(nn,t)?r.length:0;n--;){var i=r[n],o=i.func;if(null==o||o==e)return i.name}return t}function Fo(e){return(ut.call(pn,"placeholder")?pn:e).placeholder}function No(){var e=pn.iteratee||Rc;return e=e===Rc?ci:e,arguments.length?e(arguments[0],arguments[1]):e}function Lo(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function Bo(e){for(var t=ic(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Qo(i)]}return t}function Vo(e,t){var r=function(e,t){return null==e?o:e[t]}(e,t);return ai(r)?r:o}var Uo=Vr?function(e){return null==e?[]:(e=tt(e),Kt(Vr(e),function(t){return kt.call(e,t)}))}:jc,zo=Vr?function(e){for(var t=[];e;)er(t,Uo(e)),e=Rt(e);return t}:jc,jo=Qn;function Go(e,t,r){for(var n=-1,i=(t=Wi(t,e)).length,o=!1;++n<i;){var s=us(t[n]);if(!(o=null!=e&&r(e,s)))break;e=e[s]}return o||++n!=i?o:!!(i=null==e?0:e.length)&&Ta(i)&&Wo(s,i)&&(ya(e)||ma(e))}function Ho(e){return"function"!=typeof e.constructor||Zo(e)?{}:fn(Rt(e))}function qo(e){return ya(e)||ma(e)||!!(Lt&&e&&e[Lt])}function Wo(e,t){var r=typeof e;return!!(t=null==t?k:t)&&("number"==r||"symbol"!=r&&Xe.test(e))&&e>-1&&e%1==0&&e<t}function Jo(e,t,r){if(!Ma(r))return!1;var n=typeof t;return!!("number"==n?_a(r)&&Wo(t,r.length):"string"==n&&t in r)&&pa(r[t],e)}function Xo(e,t){if(ya(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Fa(e))||Ae.test(e)||!Ie.test(e)||null!=t&&e in tt(t)}function Yo(e){var t=ko(e),r=pn[t];if("function"!=typeof r||!(t in yn.prototype))return!1;if(e===r)return!0;var n=Do(r);return!!n&&e===n[0]}(Kr&&jo(new Kr(new ArrayBuffer(1)))!=le||Zr&&jo(new Zr)!=K||Qr&&"[object Promise]"!=jo(Qr.resolve())||$r&&jo(new $r)!=re||en&&jo(new en)!=se)&&(jo=function(e){var t=Qn(e),r=t==$?e.constructor:o,n=r?ds(r):"";if(n)switch(n){case on:return le;case sn:return K;case an:return"[object Promise]";case cn:return re;case ln:return se}return t});var Ko=ct?Pa:Gc;function Zo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||at)}function Qo(e){return e===e&&!Ma(e)}function $o(e,t){return function(r){return null!=r&&r[e]===t&&(t!==o||e in tt(r))}}function es(e,t,r){return t=Hr(t===o?e.length-1:t,0),function(){for(var i=arguments,o=-1,s=Hr(i.length-t,0),a=n(s);++o<s;)a[o]=i[t+o];o=-1;for(var c=n(t+1);++o<t;)c[o]=i[o];return c[t]=r(a),qt(e,this,c)}}function ts(e,t){return t.length<2?e:Kn(e,Ai(t,0,-1))}function rs(e,t){if("__proto__"!=t)return e[t]}var ns=as(Mi),is=Nr||function(e,t){return Dt.setTimeout(e,t)},os=as(Ei);function ss(e,t,r){var n=t+"";return os(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(Le,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return Jt(U,function(r){var n="_."+r[0];t&r[1]&&!Zt(e,n)&&e.push(n)}),e.sort()}(function(e){var t=e.match(Be);return t?t[1].split(Ve):[]}(n),r)))}function as(e){var t=0,r=0;return function(){var n=Wr(),i=A-(n-r);if(r=n,i>0){if(++t>=I)return arguments[0]}else t=0;return e.apply(o,arguments)}}function cs(e,t){var r=-1,n=e.length,i=n-1;for(t=t===o?n:t;++r<t;){var s=Si(r,i),a=e[s];e[s]=e[r],e[r]=a}return e.length=t,e}var ls=function(e){var t=aa(e,function(e){return r.size===u&&r.clear(),e}),r=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Re,function(e,r,n,i){t.push(n?i.replace(ze,"$1"):r||e)}),t});function us(e){if("string"==typeof e||Fa(e))return e;var t=e+"";return"0"==t&&1/e==-D?"-0":t}function ds(e){if(null!=e){try{return lt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function hs(e){if(e instanceof yn)return e.clone();var t=new mn(e.__wrapped__,e.__chain__);return t.__actions__=ro(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var ps=xi(function(e,t){return wa(e)?Bn(e,Hn(t,1,wa,!0)):[]}),fs=xi(function(e,t){var r=xs(t);return wa(r)&&(r=o),wa(e)?Bn(e,Hn(t,1,wa,!0),No(r,2)):[]}),gs=xi(function(e,t){var r=xs(t);return wa(r)&&(r=o),wa(e)?Bn(e,Hn(t,1,wa,!0),o,r):[]});function ms(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:za(r);return i<0&&(i=Hr(n+i,0)),sr(e,No(t,3),i)}function ys(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=n-1;return r!==o&&(i=za(r),i=r<0?Hr(n+i,0):qr(i,n-1)),sr(e,No(t,3),i,!0)}function vs(e){return null!=e&&e.length?Hn(e,1):[]}function _s(e){return e&&e.length?e[0]:o}var ws=xi(function(e){var t=$t(e,Hi);return t.length&&t[0]===e[0]?ri(t):[]}),Ss=xi(function(e){var t=xs(e),r=$t(e,Hi);return t===xs(r)?t=o:r.pop(),r.length&&r[0]===e[0]?ri(r,No(t,2)):[]}),bs=xi(function(e){var t=xs(e),r=$t(e,Hi);return(t="function"==typeof t?t:o)&&r.pop(),r.length&&r[0]===e[0]?ri(r,o,t):[]});function xs(e){var t=null==e?0:e.length;return t?e[t-1]:o}var Ps=xi(Cs);function Cs(e,t){return e&&e.length&&t&&t.length?_i(e,t):e}var Ts=Ao(function(e,t){var r=null==e?0:e.length,n=Dn(e,t);return wi(e,$t(t,function(e){return Wo(e,r)?+e:e}).sort($i)),n});function Ms(e){return null==e?e:Yr.call(e)}var Es=xi(function(e){return Li(Hn(e,1,wa,!0))}),Is=xi(function(e){var t=xs(e);return wa(t)&&(t=o),Li(Hn(e,1,wa,!0),No(t,2))}),As=xi(function(e){var t=xs(e);return t="function"==typeof t?t:o,Li(Hn(e,1,wa,!0),o,t)});function Rs(e){if(!e||!e.length)return[];var t=0;return e=Kt(e,function(e){if(wa(e))return t=Hr(e.length,t),!0}),gr(t,function(t){return $t(e,dr(t))})}function Os(e,t){if(!e||!e.length)return[];var r=Rs(e);return null==t?r:$t(r,function(e){return qt(t,o,e)})}var Ds=xi(function(e,t){return wa(e)?Bn(e,t):[]}),ks=xi(function(e){return ji(Kt(e,wa))}),Fs=xi(function(e){var t=xs(e);return wa(t)&&(t=o),ji(Kt(e,wa),No(t,2))}),Ns=xi(function(e){var t=xs(e);return t="function"==typeof t?t:o,ji(Kt(e,wa),o,t)}),Ls=xi(Rs);var Bs=xi(function(e){var t=e.length,r=t>1?e[t-1]:o;return Os(e,r="function"==typeof r?(e.pop(),r):o)});function Vs(e){var t=pn(e);return t.__chain__=!0,t}function Us(e,t){return t(e)}var zs=Ao(function(e){var t=e.length,r=t?e[0]:0,n=this.__wrapped__,i=function(t){return Dn(t,e)};return!(t>1||this.__actions__.length)&&n instanceof yn&&Wo(r)?((n=n.slice(r,+r+(t?1:0))).__actions__.push({func:Us,args:[i],thisArg:o}),new mn(n,this.__chain__).thru(function(e){return t&&!e.length&&e.push(o),e})):this.thru(i)});var js=io(function(e,t,r){ut.call(e,r)?++e[r]:On(e,r,1)});var Gs=ho(ms),Hs=ho(ys);function qs(e,t){return(ya(e)?Jt:Vn)(e,No(t,3))}function Ws(e,t){return(ya(e)?Xt:Un)(e,No(t,3))}var Js=io(function(e,t,r){ut.call(e,r)?e[r].push(t):On(e,r,[t])});var Xs=xi(function(e,t,r){var i=-1,o="function"==typeof t,s=_a(e)?n(e.length):[];return Vn(e,function(e){s[++i]=o?qt(t,e,r):ni(e,t,r)}),s}),Ys=io(function(e,t,r){On(e,r,t)});function Ks(e,t){return(ya(e)?$t:hi)(e,No(t,3))}var Zs=io(function(e,t,r){e[r?0:1].push(t)},function(){return[[],[]]});var Qs=xi(function(e,t){if(null==e)return[];var r=t.length;return r>1&&Jo(e,t[0],t[1])?t=[]:r>2&&Jo(t[0],t[1],t[2])&&(t=[t[0]]),yi(e,Hn(t,1),[])}),$s=Fr||function(){return Dt.Date.now()};function ea(e,t,r){return t=r?o:t,t=e&&null==t?e.length:t,Co(e,P,o,o,o,o,t)}function ta(e,t){var r;if("function"!=typeof t)throw new it(c);return e=za(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=o),r}}var ra=xi(function(e,t,r){var n=y;if(r.length){var i=Mr(r,Fo(ra));n|=b}return Co(e,n,t,r,i)}),na=xi(function(e,t,r){var n=y|v;if(r.length){var i=Mr(r,Fo(na));n|=b}return Co(t,n,e,r,i)});function ia(e,t,r){var n,i,s,a,l,u,d=0,h=!1,p=!1,f=!0;if("function"!=typeof e)throw new it(c);function g(t){var r=n,s=i;return n=i=o,d=t,a=e.apply(s,r)}function m(e){var r=e-u;return u===o||r>=t||r<0||p&&e-d>=s}function y(){var e=$s();if(m(e))return v(e);l=is(y,function(e){var r=t-(e-u);return p?qr(r,s-(e-d)):r}(e))}function v(e){return l=o,f&&n?g(e):(n=i=o,a)}function _(){var e=$s(),r=m(e);if(n=arguments,i=this,u=e,r){if(l===o)return function(e){return d=e,l=is(y,t),h?g(e):a}(u);if(p)return l=is(y,t),g(u)}return l===o&&(l=is(y,t)),a}return t=Ga(t)||0,Ma(r)&&(h=!!r.leading,s=(p="maxWait"in r)?Hr(Ga(r.maxWait)||0,t):s,f="trailing"in r?!!r.trailing:f),_.cancel=function(){l!==o&&Yi(l),d=0,n=u=i=l=o},_.flush=function(){return l===o?a:v($s())},_}var oa=xi(function(e,t){return Ln(e,1,t)}),sa=xi(function(e,t,r){return Ln(e,Ga(t)||0,r)});function aa(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new it(c);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=e.apply(this,n);return r.cache=o.set(i,s)||o,s};return r.cache=new(aa.Cache||wn),r}function ca(e){if("function"!=typeof e)throw new it(c);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}aa.Cache=wn;var la=Ji(function(e,t){var r=(t=1==t.length&&ya(t[0])?$t(t[0],mr(No())):$t(Hn(t,1),mr(No()))).length;return xi(function(n){for(var i=-1,o=qr(n.length,r);++i<o;)n[i]=t[i].call(this,n[i]);return qt(e,this,n)})}),ua=xi(function(e,t){var r=Mr(t,Fo(ua));return Co(e,b,o,t,r)}),da=xi(function(e,t){var r=Mr(t,Fo(da));return Co(e,x,o,t,r)}),ha=Ao(function(e,t){return Co(e,C,o,o,o,t)});function pa(e,t){return e===t||e!==e&&t!==t}var fa=wo($n),ga=wo(function(e,t){return e>=t}),ma=ii(function(){return arguments}())?ii:function(e){return Ea(e)&&ut.call(e,"callee")&&!kt.call(e,"callee")},ya=n.isArray,va=Vt?mr(Vt):function(e){return Ea(e)&&Qn(e)==ce};function _a(e){return null!=e&&Ta(e.length)&&!Pa(e)}function wa(e){return Ea(e)&&_a(e)}var Sa=Ur||Gc,ba=Ut?mr(Ut):function(e){return Ea(e)&&Qn(e)==q};function xa(e){if(!Ea(e))return!1;var t=Qn(e);return t==J||t==W||"string"==typeof e.message&&"string"==typeof e.name&&!Ra(e)}function Pa(e){if(!Ma(e))return!1;var t=Qn(e);return t==X||t==Y||t==G||t==ee}function Ca(e){return"number"==typeof e&&e==za(e)}function Ta(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=k}function Ma(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ea(e){return null!=e&&"object"==typeof e}var Ia=zt?mr(zt):function(e){return Ea(e)&&jo(e)==K};function Aa(e){return"number"==typeof e||Ea(e)&&Qn(e)==Z}function Ra(e){if(!Ea(e)||Qn(e)!=$)return!1;var t=Rt(e);if(null===t)return!0;var r=ut.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&lt.call(r)==ft}var Oa=jt?mr(jt):function(e){return Ea(e)&&Qn(e)==te};var Da=Gt?mr(Gt):function(e){return Ea(e)&&jo(e)==re};function ka(e){return"string"==typeof e||!ya(e)&&Ea(e)&&Qn(e)==ne}function Fa(e){return"symbol"==typeof e||Ea(e)&&Qn(e)==ie}var Na=Ht?mr(Ht):function(e){return Ea(e)&&Ta(e.length)&&!!Tt[Qn(e)]};var La=wo(di),Ba=wo(function(e,t){return e<=t});function Va(e){if(!e)return[];if(_a(e))return ka(e)?Rr(e):ro(e);if(Bt&&e[Bt])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Bt]());var t=jo(e);return(t==K?Cr:t==re?Er:pc)(e)}function Ua(e){return e?(e=Ga(e))===D||e===-D?(e<0?-1:1)*F:e===e?e:0:0===e?e:0}function za(e){var t=Ua(e),r=t%1;return t===t?r?t-r:t:0}function ja(e){return e?kn(za(e),0,L):0}function Ga(e){if("number"==typeof e)return e;if(Fa(e))return N;if(Ma(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Ma(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ke,"");var r=qe.test(e);return r||Je.test(e)?At(e.slice(2),r?2:8):He.test(e)?N:+e}function Ha(e){return no(e,oc(e))}function qa(e){return null==e?"":Ni(e)}var Wa=oo(function(e,t){if(Zo(t)||_a(t))no(t,ic(t),e);else for(var r in t)ut.call(t,r)&&En(e,r,t[r])}),Ja=oo(function(e,t){no(t,oc(t),e)}),Xa=oo(function(e,t,r,n){no(t,oc(t),e,n)}),Ya=oo(function(e,t,r,n){no(t,ic(t),e,n)}),Ka=Ao(Dn);var Za=xi(function(e,t){e=tt(e);var r=-1,n=t.length,i=n>2?t[2]:o;for(i&&Jo(t[0],t[1],i)&&(n=1);++r<n;)for(var s=t[r],a=oc(s),c=-1,l=a.length;++c<l;){var u=a[c],d=e[u];(d===o||pa(d,at[u])&&!ut.call(e,u))&&(e[u]=s[u])}return e}),Qa=xi(function(e){return e.push(o,Mo),qt(ac,o,e)});function $a(e,t,r){var n=null==e?o:Kn(e,t);return n===o?r:n}function ec(e,t){return null!=e&&Go(e,t,ti)}var tc=go(function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=pt.call(t)),e[t]=r},Mc(Ac)),rc=go(function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=pt.call(t)),ut.call(e,t)?e[t].push(r):e[t]=[r]},No),nc=xi(ni);function ic(e){return _a(e)?xn(e):li(e)}function oc(e){return _a(e)?xn(e,!0):ui(e)}var sc=oo(function(e,t,r){gi(e,t,r)}),ac=oo(function(e,t,r,n){gi(e,t,r,n)}),cc=Ao(function(e,t){var r={};if(null==e)return r;var n=!1;t=$t(t,function(t){return t=Wi(t,e),n||(n=t.length>1),t}),no(e,Oo(e),r),n&&(r=Fn(r,h|p|f,Eo));for(var i=t.length;i--;)Bi(r,t[i]);return r});var lc=Ao(function(e,t){return null==e?{}:function(e,t){return vi(e,t,function(t,r){return ec(e,r)})}(e,t)});function uc(e,t){if(null==e)return{};var r=$t(Oo(e),function(e){return[e]});return t=No(t),vi(e,r,function(e,r){return t(e,r[0])})}var dc=Po(ic),hc=Po(oc);function pc(e){return null==e?[]:yr(e,ic(e))}var fc=lo(function(e,t,r){return t=t.toLowerCase(),e+(r?gc(t):t)});function gc(e){return xc(qa(e).toLowerCase())}function mc(e){return(e=qa(e))&&e.replace(Ye,Sr).replace(_t,"")}var yc=lo(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),vc=lo(function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}),_c=co("toLowerCase");var wc=lo(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()});var Sc=lo(function(e,t,r){return e+(r?" ":"")+xc(t)});var bc=lo(function(e,t,r){return e+(r?" ":"")+t.toUpperCase()}),xc=co("toUpperCase");function Pc(e,t,r){return e=qa(e),(t=r?o:t)===o?function(e){return xt.test(e)}(e)?function(e){return e.match(St)||[]}(e):function(e){return e.match(Ue)||[]}(e):e.match(t)||[]}var Cc=xi(function(e,t){try{return qt(e,o,t)}catch(e){return xa(e)?e:new Qe(e)}}),Tc=Ao(function(e,t){return Jt(t,function(t){t=us(t),On(e,t,ra(e[t],e))}),e});function Mc(e){return function(){return e}}var Ec=po(),Ic=po(!0);function Ac(e){return e}function Rc(e){return ci("function"==typeof e?e:Fn(e,h))}var Oc=xi(function(e,t){return function(r){return ni(r,e,t)}}),Dc=xi(function(e,t){return function(r){return ni(e,r,t)}});function kc(e,t,r){var n=ic(t),i=Yn(t,n);null!=r||Ma(t)&&(i.length||!n.length)||(r=t,t=e,e=this,i=Yn(t,ic(t)));var o=!(Ma(r)&&"chain"in r)||!!r.chain,s=Pa(e);return Jt(i,function(r){var n=t[r];e[r]=n,s&&(e.prototype[r]=function(){var t=this.__chain__;if(o||t){var r=e(this.__wrapped__);return(r.__actions__=ro(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,er([this.value()],arguments))})}),e}function Fc(){}var Nc=yo($t),Lc=yo(Yt),Bc=yo(nr);function Vc(e){return Xo(e)?dr(us(e)):function(e){return function(t){return Kn(t,e)}}(e)}var Uc=_o(),zc=_o(!0);function jc(){return[]}function Gc(){return!1}var Hc=mo(function(e,t){return e+t},0),qc=bo("ceil"),Wc=mo(function(e,t){return e/t},1),Jc=bo("floor");var Xc,Yc=mo(function(e,t){return e*t},1),Kc=bo("round"),Zc=mo(function(e,t){return e-t},0);return pn.after=function(e,t){if("function"!=typeof t)throw new it(c);return e=za(e),function(){if(--e<1)return t.apply(this,arguments)}},pn.ary=ea,pn.assign=Wa,pn.assignIn=Ja,pn.assignInWith=Xa,pn.assignWith=Ya,pn.at=Ka,pn.before=ta,pn.bind=ra,pn.bindAll=Tc,pn.bindKey=na,pn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return ya(e)?e:[e]},pn.chain=Vs,pn.chunk=function(e,t,r){t=(r?Jo(e,t,r):t===o)?1:Hr(za(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var s=0,a=0,c=n(Lr(i/t));s<i;)c[a++]=Ai(e,s,s+=t);return c},pn.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var o=e[t];o&&(i[n++]=o)}return i},pn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=n(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return er(ya(r)?ro(r):[r],Hn(t,1))},pn.cond=function(e){var t=null==e?0:e.length,r=No();return e=t?$t(e,function(e){if("function"!=typeof e[1])throw new it(c);return[r(e[0]),e[1]]}):[],xi(function(r){for(var n=-1;++n<t;){var i=e[n];if(qt(i[0],this,r))return qt(i[1],this,r)}})},pn.conforms=function(e){return function(e){var t=ic(e);return function(r){return Nn(r,e,t)}}(Fn(e,h))},pn.constant=Mc,pn.countBy=js,pn.create=function(e,t){var r=fn(e);return null==t?r:Rn(r,t)},pn.curry=function e(t,r,n){var i=Co(t,w,o,o,o,o,o,r=n?o:r);return i.placeholder=e.placeholder,i},pn.curryRight=function e(t,r,n){var i=Co(t,S,o,o,o,o,o,r=n?o:r);return i.placeholder=e.placeholder,i},pn.debounce=ia,pn.defaults=Za,pn.defaultsDeep=Qa,pn.defer=oa,pn.delay=sa,pn.difference=ps,pn.differenceBy=fs,pn.differenceWith=gs,pn.drop=function(e,t,r){var n=null==e?0:e.length;return n?Ai(e,(t=r||t===o?1:za(t))<0?0:t,n):[]},pn.dropRight=function(e,t,r){var n=null==e?0:e.length;return n?Ai(e,0,(t=n-(t=r||t===o?1:za(t)))<0?0:t):[]},pn.dropRightWhile=function(e,t){return e&&e.length?Ui(e,No(t,3),!0,!0):[]},pn.dropWhile=function(e,t){return e&&e.length?Ui(e,No(t,3),!0):[]},pn.fill=function(e,t,r,n){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&Jo(e,t,r)&&(r=0,n=i),function(e,t,r,n){var i=e.length;for((r=za(r))<0&&(r=-r>i?0:i+r),(n=n===o||n>i?i:za(n))<0&&(n+=i),n=r>n?0:ja(n);r<n;)e[r++]=t;return e}(e,t,r,n)):[]},pn.filter=function(e,t){return(ya(e)?Kt:Gn)(e,No(t,3))},pn.flatMap=function(e,t){return Hn(Ks(e,t),1)},pn.flatMapDeep=function(e,t){return Hn(Ks(e,t),D)},pn.flatMapDepth=function(e,t,r){return r=r===o?1:za(r),Hn(Ks(e,t),r)},pn.flatten=vs,pn.flattenDeep=function(e){return null!=e&&e.length?Hn(e,D):[]},pn.flattenDepth=function(e,t){return null!=e&&e.length?Hn(e,t=t===o?1:za(t)):[]},pn.flip=function(e){return Co(e,T)},pn.flow=Ec,pn.flowRight=Ic,pn.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},pn.functions=function(e){return null==e?[]:Yn(e,ic(e))},pn.functionsIn=function(e){return null==e?[]:Yn(e,oc(e))},pn.groupBy=Js,pn.initial=function(e){return null!=e&&e.length?Ai(e,0,-1):[]},pn.intersection=ws,pn.intersectionBy=Ss,pn.intersectionWith=bs,pn.invert=tc,pn.invertBy=rc,pn.invokeMap=Xs,pn.iteratee=Rc,pn.keyBy=Ys,pn.keys=ic,pn.keysIn=oc,pn.map=Ks,pn.mapKeys=function(e,t){var r={};return t=No(t,3),Jn(e,function(e,n,i){On(r,t(e,n,i),e)}),r},pn.mapValues=function(e,t){var r={};return t=No(t,3),Jn(e,function(e,n,i){On(r,n,t(e,n,i))}),r},pn.matches=function(e){return pi(Fn(e,h))},pn.matchesProperty=function(e,t){return fi(e,Fn(t,h))},pn.memoize=aa,pn.merge=sc,pn.mergeWith=ac,pn.method=Oc,pn.methodOf=Dc,pn.mixin=kc,pn.negate=ca,pn.nthArg=function(e){return e=za(e),xi(function(t){return mi(t,e)})},pn.omit=cc,pn.omitBy=function(e,t){return uc(e,ca(No(t)))},pn.once=function(e){return ta(2,e)},pn.orderBy=function(e,t,r,n){return null==e?[]:(ya(t)||(t=null==t?[]:[t]),ya(r=n?o:r)||(r=null==r?[]:[r]),yi(e,t,r))},pn.over=Nc,pn.overArgs=la,pn.overEvery=Lc,pn.overSome=Bc,pn.partial=ua,pn.partialRight=da,pn.partition=Zs,pn.pick=lc,pn.pickBy=uc,pn.property=Vc,pn.propertyOf=function(e){return function(t){return null==e?o:Kn(e,t)}},pn.pull=Ps,pn.pullAll=Cs,pn.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?_i(e,t,No(r,2)):e},pn.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?_i(e,t,o,r):e},pn.pullAt=Ts,pn.range=Uc,pn.rangeRight=zc,pn.rearg=ha,pn.reject=function(e,t){return(ya(e)?Kt:Gn)(e,ca(No(t,3)))},pn.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],o=e.length;for(t=No(t,3);++n<o;){var s=e[n];t(s,n,e)&&(r.push(s),i.push(n))}return wi(e,i),r},pn.rest=function(e,t){if("function"!=typeof e)throw new it(c);return xi(e,t=t===o?t:za(t))},pn.reverse=Ms,pn.sampleSize=function(e,t,r){return t=(r?Jo(e,t,r):t===o)?1:za(t),(ya(e)?Cn:Ci)(e,t)},pn.set=function(e,t,r){return null==e?e:Ti(e,t,r)},pn.setWith=function(e,t,r,n){return n="function"==typeof n?n:o,null==e?e:Ti(e,t,r,n)},pn.shuffle=function(e){return(ya(e)?Tn:Ii)(e)},pn.slice=function(e,t,r){var n=null==e?0:e.length;return n?(r&&"number"!=typeof r&&Jo(e,t,r)?(t=0,r=n):(t=null==t?0:za(t),r=r===o?n:za(r)),Ai(e,t,r)):[]},pn.sortBy=Qs,pn.sortedUniq=function(e){return e&&e.length?ki(e):[]},pn.sortedUniqBy=function(e,t){return e&&e.length?ki(e,No(t,2)):[]},pn.split=function(e,t,r){return r&&"number"!=typeof r&&Jo(e,t,r)&&(t=r=o),(r=r===o?L:r>>>0)?(e=qa(e))&&("string"==typeof t||null!=t&&!Oa(t))&&!(t=Ni(t))&&Pr(e)?Xi(Rr(e),0,r):e.split(t,r):[]},pn.spread=function(e,t){if("function"!=typeof e)throw new it(c);return t=null==t?0:Hr(za(t),0),xi(function(r){var n=r[t],i=Xi(r,0,t);return n&&er(i,n),qt(e,this,i)})},pn.tail=function(e){var t=null==e?0:e.length;return t?Ai(e,1,t):[]},pn.take=function(e,t,r){return e&&e.length?Ai(e,0,(t=r||t===o?1:za(t))<0?0:t):[]},pn.takeRight=function(e,t,r){var n=null==e?0:e.length;return n?Ai(e,(t=n-(t=r||t===o?1:za(t)))<0?0:t,n):[]},pn.takeRightWhile=function(e,t){return e&&e.length?Ui(e,No(t,3),!1,!0):[]},pn.takeWhile=function(e,t){return e&&e.length?Ui(e,No(t,3)):[]},pn.tap=function(e,t){return t(e),e},pn.throttle=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new it(c);return Ma(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),ia(e,t,{leading:n,maxWait:t,trailing:i})},pn.thru=Us,pn.toArray=Va,pn.toPairs=dc,pn.toPairsIn=hc,pn.toPath=function(e){return ya(e)?$t(e,us):Fa(e)?[e]:ro(ls(qa(e)))},pn.toPlainObject=Ha,pn.transform=function(e,t,r){var n=ya(e),i=n||Sa(e)||Na(e);if(t=No(t,4),null==r){var o=e&&e.constructor;r=i?n?new o:[]:Ma(e)&&Pa(o)?fn(Rt(e)):{}}return(i?Jt:Jn)(e,function(e,n,i){return t(r,e,n,i)}),r},pn.unary=function(e){return ea(e,1)},pn.union=Es,pn.unionBy=Is,pn.unionWith=As,pn.uniq=function(e){return e&&e.length?Li(e):[]},pn.uniqBy=function(e,t){return e&&e.length?Li(e,No(t,2)):[]},pn.uniqWith=function(e,t){return t="function"==typeof t?t:o,e&&e.length?Li(e,o,t):[]},pn.unset=function(e,t){return null==e||Bi(e,t)},pn.unzip=Rs,pn.unzipWith=Os,pn.update=function(e,t,r){return null==e?e:Vi(e,t,qi(r))},pn.updateWith=function(e,t,r,n){return n="function"==typeof n?n:o,null==e?e:Vi(e,t,qi(r),n)},pn.values=pc,pn.valuesIn=function(e){return null==e?[]:yr(e,oc(e))},pn.without=Ds,pn.words=Pc,pn.wrap=function(e,t){return ua(qi(t),e)},pn.xor=ks,pn.xorBy=Fs,pn.xorWith=Ns,pn.zip=Ls,pn.zipObject=function(e,t){return Gi(e||[],t||[],En)},pn.zipObjectDeep=function(e,t){return Gi(e||[],t||[],Ti)},pn.zipWith=Bs,pn.entries=dc,pn.entriesIn=hc,pn.extend=Ja,pn.extendWith=Xa,kc(pn,pn),pn.add=Hc,pn.attempt=Cc,pn.camelCase=fc,pn.capitalize=gc,pn.ceil=qc,pn.clamp=function(e,t,r){return r===o&&(r=t,t=o),r!==o&&(r=(r=Ga(r))===r?r:0),t!==o&&(t=(t=Ga(t))===t?t:0),kn(Ga(e),t,r)},pn.clone=function(e){return Fn(e,f)},pn.cloneDeep=function(e){return Fn(e,h|f)},pn.cloneDeepWith=function(e,t){return Fn(e,h|f,t="function"==typeof t?t:o)},pn.cloneWith=function(e,t){return Fn(e,f,t="function"==typeof t?t:o)},pn.conformsTo=function(e,t){return null==t||Nn(e,t,ic(t))},pn.deburr=mc,pn.defaultTo=function(e,t){return null==e||e!==e?t:e},pn.divide=Wc,pn.endsWith=function(e,t,r){e=qa(e),t=Ni(t);var n=e.length,i=r=r===o?n:kn(za(r),0,n);return(r-=t.length)>=0&&e.slice(r,i)==t},pn.eq=pa,pn.escape=function(e){return(e=qa(e))&&Ce.test(e)?e.replace(xe,br):e},pn.escapeRegExp=function(e){return(e=qa(e))&&De.test(e)?e.replace(Oe,"\\$&"):e},pn.every=function(e,t,r){var n=ya(e)?Yt:zn;return r&&Jo(e,t,r)&&(t=o),n(e,No(t,3))},pn.find=Gs,pn.findIndex=ms,pn.findKey=function(e,t){return or(e,No(t,3),Jn)},pn.findLast=Hs,pn.findLastIndex=ys,pn.findLastKey=function(e,t){return or(e,No(t,3),Xn)},pn.floor=Jc,pn.forEach=qs,pn.forEachRight=Ws,pn.forIn=function(e,t){return null==e?e:qn(e,No(t,3),oc)},pn.forInRight=function(e,t){return null==e?e:Wn(e,No(t,3),oc)},pn.forOwn=function(e,t){return e&&Jn(e,No(t,3))},pn.forOwnRight=function(e,t){return e&&Xn(e,No(t,3))},pn.get=$a,pn.gt=fa,pn.gte=ga,pn.has=function(e,t){return null!=e&&Go(e,t,ei)},pn.hasIn=ec,pn.head=_s,pn.identity=Ac,pn.includes=function(e,t,r,n){e=_a(e)?e:pc(e),r=r&&!n?za(r):0;var i=e.length;return r<0&&(r=Hr(i+r,0)),ka(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&ar(e,t,r)>-1},pn.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:za(r);return i<0&&(i=Hr(n+i,0)),ar(e,t,i)},pn.inRange=function(e,t,r){return t=Ua(t),r===o?(r=t,t=0):r=Ua(r),function(e,t,r){return e>=qr(t,r)&&e<Hr(t,r)}(e=Ga(e),t,r)},pn.invoke=nc,pn.isArguments=ma,pn.isArray=ya,pn.isArrayBuffer=va,pn.isArrayLike=_a,pn.isArrayLikeObject=wa,pn.isBoolean=function(e){return!0===e||!1===e||Ea(e)&&Qn(e)==H},pn.isBuffer=Sa,pn.isDate=ba,pn.isElement=function(e){return Ea(e)&&1===e.nodeType&&!Ra(e)},pn.isEmpty=function(e){if(null==e)return!0;if(_a(e)&&(ya(e)||"string"==typeof e||"function"==typeof e.splice||Sa(e)||Na(e)||ma(e)))return!e.length;var t=jo(e);if(t==K||t==re)return!e.size;if(Zo(e))return!li(e).length;for(var r in e)if(ut.call(e,r))return!1;return!0},pn.isEqual=function(e,t){return oi(e,t)},pn.isEqualWith=function(e,t,r){var n=(r="function"==typeof r?r:o)?r(e,t):o;return n===o?oi(e,t,o,r):!!n},pn.isError=xa,pn.isFinite=function(e){return"number"==typeof e&&zr(e)},pn.isFunction=Pa,pn.isInteger=Ca,pn.isLength=Ta,pn.isMap=Ia,pn.isMatch=function(e,t){return e===t||si(e,t,Bo(t))},pn.isMatchWith=function(e,t,r){return r="function"==typeof r?r:o,si(e,t,Bo(t),r)},pn.isNaN=function(e){return Aa(e)&&e!=+e},pn.isNative=function(e){if(Ko(e))throw new Qe(a);return ai(e)},pn.isNil=function(e){return null==e},pn.isNull=function(e){return null===e},pn.isNumber=Aa,pn.isObject=Ma,pn.isObjectLike=Ea,pn.isPlainObject=Ra,pn.isRegExp=Oa,pn.isSafeInteger=function(e){return Ca(e)&&e>=-k&&e<=k},pn.isSet=Da,pn.isString=ka,pn.isSymbol=Fa,pn.isTypedArray=Na,pn.isUndefined=function(e){return e===o},pn.isWeakMap=function(e){return Ea(e)&&jo(e)==se},pn.isWeakSet=function(e){return Ea(e)&&Qn(e)==ae},pn.join=function(e,t){return null==e?"":jr.call(e,t)},pn.kebabCase=yc,pn.last=xs,pn.lastIndexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=n;return r!==o&&(i=(i=za(r))<0?Hr(n+i,0):qr(i,n-1)),t===t?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(e,t,i):sr(e,lr,i,!0)},pn.lowerCase=vc,pn.lowerFirst=_c,pn.lt=La,pn.lte=Ba,pn.max=function(e){return e&&e.length?jn(e,Ac,$n):o},pn.maxBy=function(e,t){return e&&e.length?jn(e,No(t,2),$n):o},pn.mean=function(e){return ur(e,Ac)},pn.meanBy=function(e,t){return ur(e,No(t,2))},pn.min=function(e){return e&&e.length?jn(e,Ac,di):o},pn.minBy=function(e,t){return e&&e.length?jn(e,No(t,2),di):o},pn.stubArray=jc,pn.stubFalse=Gc,pn.stubObject=function(){return{}},pn.stubString=function(){return""},pn.stubTrue=function(){return!0},pn.multiply=Yc,pn.nth=function(e,t){return e&&e.length?mi(e,za(t)):o},pn.noConflict=function(){return Dt._===this&&(Dt._=gt),this},pn.noop=Fc,pn.now=$s,pn.pad=function(e,t,r){e=qa(e);var n=(t=za(t))?Ar(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return vo(Br(i),r)+e+vo(Lr(i),r)},pn.padEnd=function(e,t,r){e=qa(e);var n=(t=za(t))?Ar(e):0;return t&&n<t?e+vo(t-n,r):e},pn.padStart=function(e,t,r){e=qa(e);var n=(t=za(t))?Ar(e):0;return t&&n<t?vo(t-n,r)+e:e},pn.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),Jr(qa(e).replace(Fe,""),t||0)},pn.random=function(e,t,r){if(r&&"boolean"!=typeof r&&Jo(e,t,r)&&(t=r=o),r===o&&("boolean"==typeof t?(r=t,t=o):"boolean"==typeof e&&(r=e,e=o)),e===o&&t===o?(e=0,t=1):(e=Ua(e),t===o?(t=e,e=0):t=Ua(t)),e>t){var n=e;e=t,t=n}if(r||e%1||t%1){var i=Xr();return qr(e+i*(t-e+It("1e-"+((i+"").length-1))),t)}return Si(e,t)},pn.reduce=function(e,t,r){var n=ya(e)?tr:pr,i=arguments.length<3;return n(e,No(t,4),r,i,Vn)},pn.reduceRight=function(e,t,r){var n=ya(e)?rr:pr,i=arguments.length<3;return n(e,No(t,4),r,i,Un)},pn.repeat=function(e,t,r){return t=(r?Jo(e,t,r):t===o)?1:za(t),bi(qa(e),t)},pn.replace=function(){var e=arguments,t=qa(e[0]);return e.length<3?t:t.replace(e[1],e[2])},pn.result=function(e,t,r){var n=-1,i=(t=Wi(t,e)).length;for(i||(i=1,e=o);++n<i;){var s=null==e?o:e[us(t[n])];s===o&&(n=i,s=r),e=Pa(s)?s.call(e):s}return e},pn.round=Kc,pn.runInContext=e,pn.sample=function(e){return(ya(e)?Pn:Pi)(e)},pn.size=function(e){if(null==e)return 0;if(_a(e))return ka(e)?Ar(e):e.length;var t=jo(e);return t==K||t==re?e.size:li(e).length},pn.snakeCase=wc,pn.some=function(e,t,r){var n=ya(e)?nr:Ri;return r&&Jo(e,t,r)&&(t=o),n(e,No(t,3))},pn.sortedIndex=function(e,t){return Oi(e,t)},pn.sortedIndexBy=function(e,t,r){return Di(e,t,No(r,2))},pn.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=Oi(e,t);if(n<r&&pa(e[n],t))return n}return-1},pn.sortedLastIndex=function(e,t){return Oi(e,t,!0)},pn.sortedLastIndexBy=function(e,t,r){return Di(e,t,No(r,2),!0)},pn.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var r=Oi(e,t,!0)-1;if(pa(e[r],t))return r}return-1},pn.startCase=Sc,pn.startsWith=function(e,t,r){return e=qa(e),r=null==r?0:kn(za(r),0,e.length),t=Ni(t),e.slice(r,r+t.length)==t},pn.subtract=Zc,pn.sum=function(e){return e&&e.length?fr(e,Ac):0},pn.sumBy=function(e,t){return e&&e.length?fr(e,No(t,2)):0},pn.template=function(e,t,r){var n=pn.templateSettings;r&&Jo(e,t,r)&&(t=o),e=qa(e),t=Xa({},t,n,To);var i,s,a=Xa({},t.imports,n.imports,To),c=ic(a),l=yr(a,c),u=0,d=t.interpolate||Ke,h="__p += '",p=rt((t.escape||Ke).source+"|"+d.source+"|"+(d===Ee?je:Ke).source+"|"+(t.evaluate||Ke).source+"|$","g"),f="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++Ct+"]")+"\n";e.replace(p,function(t,r,n,o,a,c){return n||(n=o),h+=e.slice(u,c).replace(Ze,xr),r&&(i=!0,h+="' +\n__e("+r+") +\n'"),a&&(s=!0,h+="';\n"+a+";\n__p += '"),n&&(h+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=c+t.length,t}),h+="';\n";var g=t.variable;g||(h="with (obj) {\n"+h+"\n}\n"),h=(s?h.replace(_e,""):h).replace(we,"$1").replace(Se,"$1;"),h="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m=Cc(function(){return $e(c,f+"return "+h).apply(o,l)});if(m.source=h,xa(m))throw m;return m},pn.times=function(e,t){if((e=za(e))<1||e>k)return[];var r=L,n=qr(e,L);t=No(t),e-=L;for(var i=gr(n,t);++r<e;)t(r);return i},pn.toFinite=Ua,pn.toInteger=za,pn.toLength=ja,pn.toLower=function(e){return qa(e).toLowerCase()},pn.toNumber=Ga,pn.toSafeInteger=function(e){return e?kn(za(e),-k,k):0===e?e:0},pn.toString=qa,pn.toUpper=function(e){return qa(e).toUpperCase()},pn.trim=function(e,t,r){if((e=qa(e))&&(r||t===o))return e.replace(ke,"");if(!e||!(t=Ni(t)))return e;var n=Rr(e),i=Rr(t);return Xi(n,_r(n,i),wr(n,i)+1).join("")},pn.trimEnd=function(e,t,r){if((e=qa(e))&&(r||t===o))return e.replace(Ne,"");if(!e||!(t=Ni(t)))return e;var n=Rr(e);return Xi(n,0,wr(n,Rr(t))+1).join("")},pn.trimStart=function(e,t,r){if((e=qa(e))&&(r||t===o))return e.replace(Fe,"");if(!e||!(t=Ni(t)))return e;var n=Rr(e);return Xi(n,_r(n,Rr(t))).join("")},pn.truncate=function(e,t){var r=M,n=E;if(Ma(t)){var i="separator"in t?t.separator:i;r="length"in t?za(t.length):r,n="omission"in t?Ni(t.omission):n}var s=(e=qa(e)).length;if(Pr(e)){var a=Rr(e);s=a.length}if(r>=s)return e;var c=r-Ar(n);if(c<1)return n;var l=a?Xi(a,0,c).join(""):e.slice(0,c);if(i===o)return l+n;if(a&&(c+=l.length-c),Oa(i)){if(e.slice(c).search(i)){var u,d=l;for(i.global||(i=rt(i.source,qa(Ge.exec(i))+"g")),i.lastIndex=0;u=i.exec(d);)var h=u.index;l=l.slice(0,h===o?c:h)}}else if(e.indexOf(Ni(i),c)!=c){var p=l.lastIndexOf(i);p>-1&&(l=l.slice(0,p))}return l+n},pn.unescape=function(e){return(e=qa(e))&&Pe.test(e)?e.replace(be,Or):e},pn.uniqueId=function(e){var t=++dt;return qa(e)+t},pn.upperCase=bc,pn.upperFirst=xc,pn.each=qs,pn.eachRight=Ws,pn.first=_s,kc(pn,(Xc={},Jn(pn,function(e,t){ut.call(pn.prototype,t)||(Xc[t]=e)}),Xc),{chain:!1}),pn.VERSION="4.17.11",Jt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){pn[e].placeholder=pn}),Jt(["drop","take"],function(e,t){yn.prototype[e]=function(r){r=r===o?1:Hr(za(r),0);var n=this.__filtered__&&!t?new yn(this):this.clone();return n.__filtered__?n.__takeCount__=qr(r,n.__takeCount__):n.__views__.push({size:qr(r,L),type:e+(n.__dir__<0?"Right":"")}),n},yn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),Jt(["filter","map","takeWhile"],function(e,t){var r=t+1,n=r==R||3==r;yn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:No(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}}),Jt(["head","last"],function(e,t){var r="take"+(t?"Right":"");yn.prototype[e]=function(){return this[r](1).value()[0]}}),Jt(["initial","tail"],function(e,t){var r="drop"+(t?"":"Right");yn.prototype[e]=function(){return this.__filtered__?new yn(this):this[r](1)}}),yn.prototype.compact=function(){return this.filter(Ac)},yn.prototype.find=function(e){return this.filter(e).head()},yn.prototype.findLast=function(e){return this.reverse().find(e)},yn.prototype.invokeMap=xi(function(e,t){return"function"==typeof e?new yn(this):this.map(function(r){return ni(r,e,t)})}),yn.prototype.reject=function(e){return this.filter(ca(No(e)))},yn.prototype.slice=function(e,t){e=za(e);var r=this;return r.__filtered__&&(e>0||t<0)?new yn(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==o&&(r=(t=za(t))<0?r.dropRight(-t):r.take(t-e)),r)},yn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},yn.prototype.toArray=function(){return this.take(L)},Jn(yn.prototype,function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),i=pn[n?"take"+("last"==t?"Right":""):t],s=n||/^find/.test(t);i&&(pn.prototype[t]=function(){var t=this.__wrapped__,a=n?[1]:arguments,c=t instanceof yn,l=a[0],u=c||ya(t),d=function(e){var t=i.apply(pn,er([e],a));return n&&h?t[0]:t};u&&r&&"function"==typeof l&&1!=l.length&&(c=u=!1);var h=this.__chain__,p=!!this.__actions__.length,f=s&&!h,g=c&&!p;if(!s&&u){t=g?t:new yn(this);var m=e.apply(t,a);return m.__actions__.push({func:Us,args:[d],thisArg:o}),new mn(m,h)}return f&&g?e.apply(this,a):(m=this.thru(d),f?n?m.value()[0]:m.value():m)})}),Jt(["pop","push","shift","sort","splice","unshift"],function(e){var t=ot[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);pn.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var i=this.value();return t.apply(ya(i)?i:[],e)}return this[r](function(r){return t.apply(ya(r)?r:[],e)})}}),Jn(yn.prototype,function(e,t){var r=pn[t];if(r){var n=r.name+"";(nn[n]||(nn[n]=[])).push({name:t,func:r})}}),nn[fo(o,v).name]=[{name:"wrapper",func:o}],yn.prototype.clone=function(){var e=new yn(this.__wrapped__);return e.__actions__=ro(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ro(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ro(this.__views__),e},yn.prototype.reverse=function(){if(this.__filtered__){var e=new yn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},yn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=ya(e),n=t<0,i=r?e.length:0,o=function(e,t,r){for(var n=-1,i=r.length;++n<i;){var o=r[n],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=qr(t,e+s);break;case"takeRight":e=Hr(e,t-s)}}return{start:e,end:t}}(0,i,this.__views__),s=o.start,a=o.end,c=a-s,l=n?a:s-1,u=this.__iteratees__,d=u.length,h=0,p=qr(c,this.__takeCount__);if(!r||!n&&i==c&&p==c)return zi(e,this.__actions__);var f=[];e:for(;c--&&h<p;){for(var g=-1,m=e[l+=t];++g<d;){var y=u[g],v=y.iteratee,_=y.type,w=v(m);if(_==O)m=w;else if(!w){if(_==R)continue e;break e}}f[h++]=m}return f},pn.prototype.at=zs,pn.prototype.chain=function(){return Vs(this)},pn.prototype.commit=function(){return new mn(this.value(),this.__chain__)},pn.prototype.next=function(){this.__values__===o&&(this.__values__=Va(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?o:this.__values__[this.__index__++]}},pn.prototype.plant=function(e){for(var t,r=this;r instanceof gn;){var n=hs(r);n.__index__=0,n.__values__=o,t?i.__wrapped__=n:t=n;var i=n;r=r.__wrapped__}return i.__wrapped__=e,t},pn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof yn){var t=e;return this.__actions__.length&&(t=new yn(this)),(t=t.reverse()).__actions__.push({func:Us,args:[Ms],thisArg:o}),new mn(t,this.__chain__)}return this.thru(Ms)},pn.prototype.toJSON=pn.prototype.valueOf=pn.prototype.value=function(){return zi(this.__wrapped__,this.__actions__)},pn.prototype.first=pn.prototype.head,Bt&&(pn.prototype[Bt]=function(){return this}),pn}();Dt._=Dr,(i=function(){return Dr}.call(t,r,t,n))===o||(n.exports=i)}).call(this)}).call(this,r(12),r(123)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(149),i=r(3);class BatchSelectionOperation{constructor(e,t){this.selections=new Array,this.deselections=new Array,this.shouldReplace=t,this._componentSelectionHandler=e}select(e){this.addNodes(e,this.selections,this.shouldReplace?void 0:this.deselections)}deselect(e){this.addNodes(e,this.deselections,this.shouldReplace?void 0:this.selections)}addNodes(e,t,r){if(Array.isArray(e))for(const n of e){if(r){const e=r.findIndex(e=>this._componentSelectionHandler.areEqual(e,n));if(e>-1){r.splice(e,1);continue}}t.push(n)}else this.addNodes([e],t,r)}}class DragAction{constructor(e,t,r){this._itemSelectionHandlers=t,this._componentSelectionHandler=e;const n=this.findItem(this._itemSelectionHandlers,r);this._previousRow=n.y,this._previousColumn=n.x,this._firstItemRow=n.y,this._firstItemColumn=n.x,this._firstItemSelected=!1}updateDragAction(e){const t=this.findItem(this._itemSelectionHandlers,e);if(t.y===this._previousRow&&t.x===this._previousColumn||t.x<0||t.y<0)return{selections:[],deselections:[]};const r=i.Range2d.createXYXY(this._firstItemColumn,this._firstItemRow,t.x,t.y),n=i.Range2d.createXYXY(this._firstItemColumn,this._firstItemRow,this._previousColumn,this._previousRow),o=i.Range2d.createXYXY(r.high.x>n.high.x?r.high.x:n.high.x,r.high.y>n.high.y?r.high.y:n.high.y,r.low.x<n.low.x?r.low.x:n.low.x,r.low.y<n.low.y?r.low.y:n.low.y),s=[],a=[];if(!this._firstItemSelected){const e=this._itemSelectionHandlers[this._firstItemRow][this._firstItemColumn];e.isSelected()?a.push(e.item()):s.push(e.item()),this._firstItemSelected=!0}for(let i=o.low.y;i<=o.high.y;i++)for(let e=o.low.x;e<=o.high.x;e++){const t=n.containsXY(e,i),o=r.containsXY(e,i);if((t||o)&&o!==t){const t=this._itemSelectionHandlers[i][e];t.isSelected()?a.push(t.item()):s.push(t.item())}}return this._previousRow=t.y,this._previousColumn=t.x,{selections:s,deselections:a}}findItem(e,t){if(void 0!==this._previousRow&&void 0!==this._previousColumn&&this._componentSelectionHandler.areEqual(e[this._previousRow][this._previousColumn].item(),t))return{y:this._previousRow,x:this._previousColumn};for(let r=0;r<e.length;r++)for(let n=0;n<e[r].length;n++)if(this._componentSelectionHandler.areEqual(e[r][n].item(),t))return{x:n,y:r};return{x:-1,y:-1}}}t.DragAction=DragAction;t.SelectionHandler=class SelectionHandler{constructor(e,t,r){this.selectionMode=e,this.onItemsSelectedCallback=t,this.onItemsDeselectedCallback=r}createSelectionFunction(e,t){return((r,i)=>{let o=!1,s=!1;if(!this._currentOperation){const t=n.hasFlag(this.selectionMode,n.SelectionModeFlags.KeysEnabled)&&!i||n.hasFlag(this.selectionMode,n.SelectionModeFlags.SelectionLimitOne);this._currentOperation=new BatchSelectionOperation(e,t),o=!0}if(n.hasFlag(this.selectionMode,n.SelectionModeFlags.KeysEnabled)&&(i||e.deselectAll(),r&&void 0!==this._lastItem)){const r=e.selectBetween(this._lastItem,t.item());this._currentOperation.select(r),s=!0}s||(t.preselect(),!n.hasFlag(this.selectionMode,n.SelectionModeFlags.SelectionLimitOne)||n.hasFlag(this.selectionMode,n.SelectionModeFlags.ToggleEnabled)&&t.isSelected()||e.deselectAll(),t.isSelected()?(t.deselect(),this._currentOperation.deselect(t.item())):(t.select(),this._currentOperation.select(t.item())),this._lastItem=t.item()),o&&this.completeOperation()}).bind(this)}completeOperation(){this._currentOperation&&(0!==this._currentOperation.selections.length&&this.onItemsSelectedCallback&&(this.onItemsSelectedCallback(this._currentOperation.selections,this._currentOperation.shouldReplace),this._currentOperation.shouldReplace)?this._currentOperation=void 0:(0!==this._currentOperation.deselections.length&&this.onItemsDeselectedCallback&&this.onItemsDeselectedCallback(this._currentOperation.deselections),this._currentOperation=void 0))}createDragAction(e,t,r){n.hasFlag(this.selectionMode,n.SelectionModeFlags.DragEnabled)&&(this._dragAction=new DragAction(e,t,r),this._componentSelectionHandler=e)}updateDragAction(e){if(!n.hasFlag(this.selectionMode,n.SelectionModeFlags.DragEnabled))return;if(!this._dragAction||!this._componentSelectionHandler)return;this._lastItem=e;const t=this._dragAction.updateDragAction(e);0===t.deselections.length&&0===t.selections.length||(this._currentOperation||(this._currentOperation=new BatchSelectionOperation(this._componentSelectionHandler,!1)),this._currentOperation.select(t.selections),this._currentOperation.deselect(t.deselections),this._componentSelectionHandler.updateSelection(t.selections,t.deselections))}completeDragAction(){this._dragAction=void 0,this._componentSelectionHandler=void 0,this.completeOperation()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(200);t.DragDropContext=n.DragDropContext,t.DragDropContextProvider=n.DragDropContextProvider;var i=r(804);t.DragLayer=i.default;var o=r(807);t.DragSource=o.default;var s=r(817);t.DropTarget=s.default},function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),c=r(728),l=r(159),u=r(28),d=r(210),h=r(211).default;function p(e,t){return{dragDropManager:c.createDragDropManager(e,t)}}t.Consumer=(i=a.createContext({dragDropManager:void 0})).Consumer,t.Provider=i.Provider,t.createChildContext=p,t.DragDropContextProvider=function(e){var r=e.backend,n=e.context,i=e.children,o=p(r,n);return a.createElement(t.Provider,{value:o},i)},t.DragDropContext=function(e,r){l.default("DragDropContext","backend",e);var n=p(e,r);return function(e){var r=e,i=r.displayName||r.name||"Component",c=function(c){function l(){var e=null!==c&&c.apply(this,arguments)||this;return e.ref=a.createRef(),e}return o(l,c),l.prototype.getDecoratedComponentInstance=function(){return u(this.ref.current,"In order to access an instance of the decorated component it can not be a stateless component."),this.ref.current},l.prototype.getManager=function(){return n.dragDropManager},l.prototype.render=function(){return a.createElement(t.Provider,{value:n},a.createElement(r,s({},this.props,{ref:h(r)?this.ref:void 0})))},l.DecoratedComponent=e,l.displayName="DragDropContext("+i+")",l}(a.Component);return d(c,e)}}},function(e,t,r){var n=r(349),i=r(762),o=r(763);function s(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}s.prototype.add=s.prototype.push=i,s.prototype.has=o,e.exports=s},function(e,t,r){var n=r(112),i=r(111),o="[object AsyncFunction]",s="[object Function]",a="[object GeneratorFunction]",c="[object Proxy]";e.exports=function(e){if(!i(e))return!1;var t=n(e);return t==s||t==a||t==o||t==c}},function(e,t){e.exports=function(e,t){return e===t||e!==e&&t!==t}},function(e,t,r){var n=r(764);e.exports=function(e,t){return!(null==e||!e.length)&&n(e,t,0)>-1}},function(e,t){e.exports=function(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,r){var n=r(202),i=r(352);e.exports=function(e){return null!=e&&i(e.length)&&!n(e)}},function(e,t,r){var n=r(112),i=r(94),o="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||i(e)&&n(e)==o}},function(e,t,r){"use strict";var n={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o=Object.defineProperty,s=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,c=Object.getOwnPropertyDescriptor,l=Object.getPrototypeOf,u=l&&l(Object);e.exports=function e(t,r,d){if("string"!==typeof r){if(u){var h=l(r);h&&h!==u&&e(t,h,d)}var p=s(r);a&&(p=p.concat(a(r)));for(var f=0;f<p.length;++f){var g=p[f];if(!n[g]&&!i[g]&&(!d||!d[g])){var m=c(r,g);try{o(t,g,m)}catch(e){}}}return t}return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){return Boolean(e&&e.prototype&&"function"===typeof e.prototype.render)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FILE="__NATIVE_FILE__",t.URL="__NATIVE_URL__",t.TEXT="__NATIVE_TEXT__"},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(366)),n(r(850));var i=r(851);t.Grid=i.Grid;var o=r(853);t.withTableDragDrop=o.withDragDrop;var s=r(369);t.Table=s.Table,t.TableSelectionTarget=s.TableSelectionTarget},function(e,t,r){e.exports=r(852)},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(370);r(855);t.EditorContainer=class EditorContainer extends i.Component{constructor(){super(...arguments),this._propertyEditor=null,this._handleBlur=(e=>{e.stopPropagation()}),this._handleClick=(e=>{e.stopPropagation()}),this._handleKeyDown=(e=>{switch(e.key){case"Escape":this.onPressEscape(e);break;case"Enter":this.onPressEnter(e);break;case"Tab":this.onPressTab(e)}e.keyCode>=37&&e.keyCode<=40&&e.stopPropagation()}),this._handleRightClick=(e=>{e.stopPropagation()}),this._commit=(e=>{const t=this.getEditor().getValue();this.isNewValueValid(t)&&this.props.onCommit({propertyRecord:this.props.propertyRecord,newValue:t})}),this._commitCancel=(()=>{this.props.onCommitCancel()})}getEditor(){return this._editorRef}createEditor(){const e={ref:e=>this._editorRef=e,onBlur:this._commit,value:this.props.propertyRecord};if(this.props.propertyRecord){let t;const r=this.props.propertyRecord.property;if(r.typename){const e=void 0!==r.editor?r.editor.name:void 0;this._propertyEditor=o.PropertyEditorManager.createEditor(r.typename,e,r.dataController),this._propertyEditor&&(t=this._propertyEditor.reactElement)}if(i.isValidElement(t))return i.cloneElement(t,e)}return null}onPressEscape(e){this.editorIsSelectOpen()?e.stopPropagation():this._commitCancel()}onPressEnter(e){this._commit({key:e.key})}onPressTab(e){this._commit({key:e.key})}editorIsSelectOpen(){return!!s(this.getEditor().isSelectOpen)&&this.getEditor().isSelectOpen()}async isNewValueValid(e){if(s(this.getEditor().validate)){const t=this.getEditor().validate(e);if(!t)return this.setState({isInvalid:!t}),t}if(this._propertyEditor&&this.props.propertyRecord){const t=await this._propertyEditor.validateValue(e,this.props.propertyRecord);if(t.encounteredError)return this.setState({isInvalid:t.encounteredError}),!t.encounteredError}return!0}componentDidMount(){const e=this.getInputNode();e&&e.focus()}getInputNode(){return this.getEditor()&&s(this.getEditor().getInputNode)?this.getEditor().getInputNode():null}render(){return i.createElement("div",{className:"components-editor-container",onBlur:this._handleBlur,onKeyDown:this._handleKeyDown,onClick:this._handleClick,onContextMenu:this._handleRightClick,title:this.props.title},this.createEditor())}};const s=e=>{return e&&"[object Function]"==={}.toString.call(e)}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(856);function s(e,t){return e.name+t.property.name}t.getPropertyKey=s;t.PropertyList=class PropertyList extends i.Component{constructor(){super(...arguments),this._onEditCommit=(e=>{this.props.onEditCommit&&this.props.category&&this.props.onEditCommit(e,this.props.category)})}render(){const e=0===this.props.orientation?"components-property-list--horizontal":"components-property-list--vertical";return i.createElement("div",{className:e},this.props.properties.map(e=>{const t=this.props.category?s(this.props.category,e):e.property.name;return i.createElement(o.PropertyRenderer,{key:t,uniqueKey:t,isSelected:t===this.props.selectedPropertyKey,propertyRecord:e,orientation:this.props.orientation,onClick:this.props.onPropertyClicked,columnRatio:this.props.columnRatio,onColumnRatioChanged:this.props.onColumnChanged,propertyValueRendererManager:this.props.propertyValueRendererManager,isEditing:t===this.props.editingPropertyKey,onEditCommit:this._onEditCommit,onEditCancel:this.props.onEditCancel})}))}}},function(e,t,r){"use strict";(function(e,n){var i,o=r(380);i="undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof e?e:n;var s=Object(o.a)(i);t.a=s}).call(this,r(12),r(732)(e))},function(e,t,r){"use strict";var n=r(219);function i(){}var o=null,s={};function a(e){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof e)throw new TypeError("Promise constructor's argument is not a function");this._h=0,this._i=0,this._j=null,this._k=null,e!==i&&p(e,this)}function c(e,t){for(;3===e._i;)e=e._j;if(a._l&&a._l(e),0===e._i)return 0===e._h?(e._h=1,void(e._k=t)):1===e._h?(e._h=2,void(e._k=[e._k,t])):void e._k.push(t);!function(e,t){n(function(){var r=1===e._i?t.onFulfilled:t.onRejected;if(null!==r){var n=function(e,t){try{return e(t)}catch(e){return o=e,s}}(r,e._j);n===s?u(t.promise,o):l(t.promise,n)}else 1===e._i?l(t.promise,e._j):u(t.promise,e._j)})}(e,t)}function l(e,t){if(t===e)return u(e,new TypeError("A promise cannot be resolved with itself."));if(t&&("object"===typeof t||"function"===typeof t)){var r=function(e){try{return e.then}catch(e){return o=e,s}}(t);if(r===s)return u(e,o);if(r===e.then&&t instanceof a)return e._i=3,e._j=t,void d(e);if("function"===typeof r)return void p(r.bind(t),e)}e._i=1,e._j=t,d(e)}function u(e,t){e._i=2,e._j=t,a._m&&a._m(e,t),d(e)}function d(e){if(1===e._h&&(c(e,e._k),e._k=null),2===e._h){for(var t=0;t<e._k.length;t++)c(e,e._k[t]);e._k=null}}function h(e,t,r){this.onFulfilled="function"===typeof e?e:null,this.onRejected="function"===typeof t?t:null,this.promise=r}function p(e,t){var r=!1,n=function(e,t,r){try{e(t,r)}catch(e){return o=e,s}}(e,function(e){r||(r=!0,l(t,e))},function(e){r||(r=!0,u(t,e))});r||n!==s||(r=!0,u(t,o))}e.exports=a,a._l=null,a._m=null,a._n=i,a.prototype.then=function(e,t){if(this.constructor!==a)return function(e,t,r){return new e.constructor(function(n,o){var s=new a(i);s.then(n,o),c(e,new h(t,r,s))})}(this,e,t);var r=new a(i);return c(this,new h(e,t,r)),r}},function(e,t,r){"use strict";(function(t){function r(e){i.length||(n(),!0),i[i.length]=e}e.exports=r;var n,i=[],o=0,s=1024;function a(){for(;o<i.length;){var e=o;if(o+=1,i[e].call(),o>s){for(var t=0,r=i.length-o;t<r;t++)i[t]=i[t+o];i.length-=o,o=0}}i.length=0,o=0,!1}var c,l,u,d="undefined"!==typeof t?t:self,h=d.MutationObserver||d.WebKitMutationObserver;function p(e){return function(){var t=setTimeout(n,0),r=setInterval(n,50);function n(){clearTimeout(t),clearInterval(r),e()}}}"function"===typeof h?(c=1,l=new h(a),u=document.createTextNode(""),l.observe(u,{characterData:!0}),n=function(){c=-c,u.data=c}):n=p(a),r.requestFlush=n,r.makeRequestCallFromTimer=p}).call(this,r(12))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(161),i=r(76),o=r(30),s=r(3),a=r(8);function c(e,t,r){return t.vectorTo(e).normalizeWithLength(r).mag}function l(e,t,r){return e.crossProduct(t,r).normalizeWithLength(r).mag}class AccuDrawShortcuts{static rotateAxesByPoint(e,t){const r=a.IModelApp.accuDraw;if(!r.isEnabled)return!1;const n=r.currentView;if(!n)return!1;const i=r.point;n.view.is3d()||(i.z=0),t?r.hardConstructionPlane(i,i,r.planePt,r.axes.z,n,e):r.softConstructionPlane(i,i,r.planePt,r.axes.z,n,e);const o=new s.Vector3d;return!(c(i,r.planePt,o)<s.Geometry.smallAngleRadians)&&(r.axes.x.setFrom(o),6!==r.rotationMode&&r.setRotationMode(6),r.flags.contextRotMode=1,r.flags.lockedRotation=!1,r.updateRotation(),r.indexed|=1,!0)}static updateACSByPoints(e,t,r,n){const i=a.IModelApp.accuDraw;if(!i.isEnabled)return!1;let o=!1;const u=[new s.Vector3d,new s.Vector3d,new s.Vector3d];switch(e.setOrigin(r[0]),r.length){case 1:e.setRotation(t.rotation),n||(i.published.origin.setFrom(r[0]),i.published.flags=4,i.flags.fixedOrg=!0);break;case 2:if(c(r[1],r[0],u[0])<1e-5){o=!0;break}if(t.view.is3d()){l(i.axes.y,u[0],u[1])<1e-5&&(u[2].set(0,0,1),l(u[2],u[0],u[1])<1e-5&&(u[2].set(0,1,0),l(u[2],u[0],u[1]))),l(u[0],u[1],u[2]),e.setRotation(s.Matrix3d.createRows(u[0],u[1],u[2])),n||(i.published.origin.setFrom(r[0]),i.published.flags=68,i.published.vector.setFrom(u[0]));break}u[2].set(0,0,1),l(u[2],u[0],u[1]),e.setRotation(s.Matrix3d.createRows(u[0],u[1],u[2])),o=!0;break;case 3:if(c(r[1],r[0],u[0])<1e-5||c(r[2],r[0],u[1])<1e-5||l(u[0],u[1],u[2])<1e-5){o=!0;break}l(u[2],u[0],u[1]),e.setRotation(s.Matrix3d.createRows(u[0],u[1],u[2])),o=!0}return o}static processPendingHints(){a.IModelApp.accuDraw.processHints()}static requestInputFocus(){const e=a.IModelApp.accuDraw;e.isEnabled&&(e.grabInputFocus(),e.refreshDecorationsAndDynamics())}static itemFieldNavigate(e,t,r){const i=a.IModelApp.accuDraw;if(!i.isEnabled)return;i.getFieldLock(e)&&i.saveCoordinate(e,i.getValueByIndex(e)),i.isActive||n.KeyinStatus.Partial!==i.getKeyinStatus(e)?(i.setKeyinStatus(e,n.KeyinStatus.Dynamic),i.onFieldValueChange(e)):i.processFieldInput(e,t,!0);const o=i.currentView,s=!!o&&o.view.is3d(),c=0===i.compassMode;switch(e){case 0:e=s&&!r?4:1;break;case 1:e=s&&r?4:0;break;case 2:e=s&&!r?4:3;break;case 3:e=s&&r?4:2;break;case 4:e=r?c?0:2:c?1:3}i.setKeyinStatus(e,n.KeyinStatus.Partial),i.setFocusItem(e),i.dontMoveFocus=!0}static itemFieldNewInput(e){a.IModelApp.accuDraw.setKeyinStatus(e,n.KeyinStatus.Partial)}static itemFieldAcceptInput(e,t){const r=a.IModelApp.accuDraw;r.processFieldInput(e,t,!0),r.setKeyinStatus(e,n.KeyinStatus.Dynamic),r.getFieldLock(e)&&r.saveCoordinate(e,r.getValueByIndex(e));const i=r.currentView;if(r.isActive){if(!i)return;return 0===r.compassMode?r.fixPointPolar(i):r.fixPointRectangular(i),void(r.flags.dialogNeedsUpdate=!0)}const o=!!i&&i.view.is3d(),s=0===r.compassMode;switch(e){case 0:e=1;break;case 1:e=o?4:0;break;case 2:e=3;break;case 3:e=o?4:2;break;case 4:e=s?0:2}r.setFocusItem(e)}static itemFieldLockToggle(e){const t=a.IModelApp.accuDraw;if(t.isEnabled)if(t.getFieldLock(e))switch(e){case 0:t.distanceLock(!0,!1);break;case 1:t.angleLock();break;case 2:t.clearTentative(),t.locked|=1;break;case 3:t.clearTentative(),t.locked|=2;break;case 4:t.clearTentative()}else{switch(e){case 0:t.locked&=-9;break;case 1:t.locked&=-8;break;case 2:t.locked&=-2;break;case 3:t.locked&=-3}t.dontMoveFocus=!1,t.clearTentative()}}static itemRotationModeChange(e){const t=a.IModelApp.accuDraw,r=t.currentView;!r||r.view.is3d()||2!==e&&3!==e||t.setRotationMode(1),t.flags.baseRotation=e,t.updateRotation(!0)}static setOrigin(e){const t=a.IModelApp.accuDraw;if(!t.isEnabled)return;if(e)t.published.origin.setFrom(e),t.flags.haveValidOrigin=!0;else if(t.isInactive||t.isDeactivated){const e=i.TentativeOrAccuSnap.getCurrentSnap(!1);if(void 0!==e)t.published.origin.setFrom(e.isPointAdjusted?e.adjustedPoint:e.getPoint()),t.flags.haveValidOrigin=!0;else{const e=new o.BeButtonEvent;a.IModelApp.toolAdmin.fillEventFromLastDataButton(e),e.viewport?(t.published.origin.setFrom(e.point),t.flags.haveValidOrigin=!0):t.published.origin.setFrom(t.point)}}else t.published.origin.setFrom(t.point),t.flags.haveValidOrigin=!0,t.setLastPoint(t.published.origin);t.clearTentative();const r=t.currentView;r&&!r.view.is3d()&&(t.published.origin.z=0),t.origin.setFrom(t.published.origin),t.point.setFrom(t.published.origin),t.planePt.setFrom(t.published.origin),t.published.flags|=4,t.activate(),t.refreshDecorationsAndDynamics()}static changeCompassMode(){const e=a.IModelApp.accuDraw;if(!e.isEnabled)return;let t=3&e.locked;t&&1===e.compassMode&&(1&t&&0!==e.delta.x&&(t&=-2),2&t&&0!==e.delta.y&&(t&=-3)),e.changeCompassMode(!0),t&&(1===e.compassMode?(e.delta.x=e.delta.y=0,1&t?e.setFieldLock(2,!0):2&t&&e.setFieldLock(3,!0)):e.setFieldLock(1,!0),e.locked=t),e.flags.baseMode=e.compassMode,e.refreshDecorationsAndDynamics()}static lockSmart(){const e=a.IModelApp.accuDraw;if(!e.isEnabled)return;const t=a.IModelApp.accuSnap;if(t.isHot){t.clear();const r=e.currentView;r&&(0===e.compassMode?e.fixPointPolar(r):e.fixPointRectangular(r))}if(0===e.compassMode){const t=e.clearTentative();return 7&e.locked?(e.setFieldLock(1,!1),e.locked&=-8):e.getFieldLock(0)?(e.setFieldLock(0,!1),e.locked&=-9):t?e.doLockAngle(t):7&e.indexed?e.angleLock():(Math.abs(e.vector.dotProduct(e.axes.x))>Math.abs(e.vector.dotProduct(e.axes.y))?e.indexed|=2:e.indexed|=1,e.angleLock()),void e.refreshDecorationsAndDynamics()}if(e.locked)e.clearTentative(),e.locked&=-4,e.setFieldLock(2,!1),e.setFieldLock(3,!1),e.getFieldLock(4)&&0===e.delta.z&&!e.stickyZLock&&e.setFieldLock(4,!1);else if(e.indexed||!e.getFieldLock(4)||e.stickyZLock){if(e.clearTentative()&&Math.abs(e.delta.x)>=s.Geometry.smallAngleRadians&&Math.abs(e.delta.y)>=s.Geometry.smallAngleRadians)return void e.doLockAngle(!1);const t=e.currentView;Math.abs(e.delta.x)>Math.abs(e.delta.y)?(e.delta.y=0,e.onFieldValueChange(3),e.locked|=2,e.locked&=-2,e.setFieldLock(2,!1),e.setFieldLock(3,!0),e.setFieldLock(4,!!t&&t.view.is3d())):(e.delta.x=0,e.onFieldValueChange(2),e.locked|=1,e.locked&=-3,e.setFieldLock(3,!1),e.setFieldLock(2,!0),e.setFieldLock(4,!!t&&t.view.is3d())),e.flags.lockedRotation||(e.flags.lockedRotation=!0,e.flags.contextRotMode=0,e.setRotationMode(6))}else e.clearTentative(),e.setFieldLock(4,!1);e.refreshDecorationsAndDynamics()}static lockX(){const e=a.IModelApp.accuDraw;if(e.isEnabled){if(e.clearTentative(),1!==e.compassMode){const t=e.currentView;if(!t)return;e.fixPointRectangular(t),e.changeCompassMode(!0)}e.getFieldLock(2)?(e.setFieldLock(2,!1),e.locked=-2&e.locked):(e.saveCoordinate(2,e.delta.x),e.setFieldLock(2,!0),e.locked=1|e.locked),e.refreshDecorationsAndDynamics()}}static lockY(){const e=a.IModelApp.accuDraw;if(e.isEnabled){if(e.clearTentative(),1!==e.compassMode){const t=e.currentView;if(!t)return;e.fixPointRectangular(t),e.changeCompassMode(!0)}e.getFieldLock(3)?(e.setFieldLock(3,!1),e.locked=-3&e.locked):(e.saveCoordinate(3,e.delta.y),e.setFieldLock(3,!0),e.locked=2|e.locked),e.refreshDecorationsAndDynamics()}}static lockZ(){const e=a.IModelApp.accuDraw;if(!e.isEnabled)return;const t=e.currentView;if(!t||!t.view.is3d())return;const r=e.clearTentative();e.getFieldLock(4)?e.setFieldLock(4,!1):(!r&&e.autoFocusFields&&(e.setFocusItem(4),e.dontMoveFocus=!0),e.setFieldLock(4,!0)),e.refreshDecorationsAndDynamics()}static lockDistance(){const e=a.IModelApp.accuDraw;if(!e.isEnabled)return;const t=e.clearTentative();if(0!==e.compassMode){const t=e.currentView;if(!t)return;e.locked=0,e.fixPointPolar(t),e.changeCompassMode(!0)}e.getFieldLock(0)?(e.setFieldLock(0,!1),e.locked&=-9,e.setKeyinStatus(0,n.KeyinStatus.Dynamic)):(!t&&e.autoFocusFields&&e.setFocusItem(0),e.distanceLock(!0,!0)),e.refreshDecorationsAndDynamics()}static lockAngle(){const e=a.IModelApp.accuDraw;e.isEnabled&&(e.doLockAngle(e.clearTentative()),e.refreshDecorationsAndDynamics())}lockIndex(){const e=a.IModelApp.accuDraw;e.isEnabled&&(e.flags.indexLocked?(e.locked&&AccuDrawShortcuts.lockSmart(),e.flags.indexLocked=!1):(0===e.compassMode?(3&e.indexed&&(e.setFieldLock(1,!0),e.angleLock()),8&e.indexed&&AccuDrawShortcuts.lockDistance()):(1&e.indexed&&(AccuDrawShortcuts.lockX(),8&e.indexed&&AccuDrawShortcuts.lockY()),2&e.indexed&&(AccuDrawShortcuts.lockY(),8&e.indexed&&AccuDrawShortcuts.lockX()),8&e.indexed&&!(3&e.indexed)&&(1&e.locked?AccuDrawShortcuts.lockY():AccuDrawShortcuts.lockX())),e.flags.indexLocked=!0),e.refreshDecorationsAndDynamics())}static setStandardRotation(e){const t=a.IModelApp.accuDraw;if(t.isEnabled){if(6===e){const e=t.baseAxes.clone();return t.accountForAuxRotationPlane(e,t.flags.auxRotationPlane),t.setContextRotation(e.toMatrix3d(),!1,!0),void t.refreshDecorationsAndDynamics()}t.flags.baseRotation=e,t.setRotationMode(e),t.updateRotation(!0),t.refreshDecorationsAndDynamics()}}static alignView(){const e=a.IModelApp.accuDraw;if(!e.isEnabled)return;const t=e.currentView;if(!t)return;const r=e.getRotation();if(r.isExactEqual(t.rotation))return;const n=r.multiplyMatrixMatrix(t.rotation),i=s.Transform.createFixedPointAndMatrix(t.view.getTargetPoint(),n),o=t.getFrustum(),c=o.clone();c.multiply(i),t.animateFrustumChange(o,c),t.view.setupFromFrustum(c),t.synchWithView(!0),e.refreshDecorationsAndDynamics()}static rotateToBase(){this.setStandardRotation(a.IModelApp.accuDraw.flags.baseRotation)}static rotateToACS(){const e=a.IModelApp.accuDraw;e.isEnabled&&(e.flags.auxRotationPlane=1,this.setStandardRotation(5))}static rotateCycle(e){const t=a.IModelApp.accuDraw;if(!t.isEnabled)return;const r=t.currentView;if(!r||!r.view.is3d())return;let i;switch(t.rotationMode){case 4:case 3:i=1;break;case 1:i=2;break;case 2:i=3;break;case 6:if(!e){if((i=6)!==t.flags.baseRotation)t.baseAxes.setFrom(t.axes),t.flags.auxRotationPlane=1,t.flags.baseRotation=i;else{const e=t.baseAxes.clone();t.accountForAuxRotationPlane(e,t.flags.auxRotationPlane),t.axes.equals(e)||t.changeBaseRotationMode(i)}switch(t.flags.auxRotationPlane){case 2:t.flags.auxRotationPlane=3;break;case 3:t.flags.auxRotationPlane=1;break;case 1:t.flags.auxRotationPlane=2}break}t.updateRotation(),t.flags.auxRotationPlane=1;const o=r.view.auxiliaryCoordinateSystem.clone();o.setRotation(t.getRotation()),n.AccuDraw.updateAuxCoordinateSystem(o,r);case 5:switch(i=5,t.flags.auxRotationPlane){case 2:t.flags.auxRotationPlane=3;break;case 3:t.flags.auxRotationPlane=1;break;case 1:t.flags.auxRotationPlane=2}break;default:return}this.setStandardRotation(i)}static rotate90(e){const t=a.IModelApp.accuDraw;if(!t.isEnabled)return;const r=new n.ThreeAxes;switch(t.locked=t.indexed=0,t.unlockAllFields(),e){case 0:r.x.setFrom(t.axes.x),r.z.setFrom(t.axes.y),r.z.crossProduct(r.x,r.y);break;case 1:r.x.setFrom(t.axes.z),r.y.setFrom(t.axes.y),r.x.crossProduct(r.y,r.z);break;case 2:r.x.setFrom(t.axes.y),r.z.setFrom(t.axes.z),r.z.crossProduct(r.x,r.y)}t.setContextRotation(r.toMatrix3d(),!0,!0),t.refreshDecorationsAndDynamics()}static rotateAxes(e){const t=a.IModelApp.accuDraw;if(t.isActive)return(t.clearTentative()||a.IModelApp.accuSnap.isHot||0===t.compassMode&&t.getFieldLock(1)||0!==t.compassMode&&t.getFieldLock(2)&&t.getFieldLock(3))&&AccuDrawShortcuts.rotateAxesByPoint(!0,e)?(AccuDrawShortcuts.itemFieldUnlockAll(),void t.refreshDecorationsAndDynamics()):void AccuDrawTool.installTool(new RotateAxesTool(e))}static rotateToElement(e){const t=a.IModelApp.accuDraw;if(!t.isEnabled)return;const r=!t.isActive;AccuDrawTool.installTool(new RotateElementTool(r,e,!1))}static defineACSByElement(){AccuDrawTool.installTool(new RotateElementTool(!0,!0,!0))}static defineACSByPoints(){a.IModelApp.accuDraw.isEnabled&&AccuDrawTool.installTool(new DefineACSByPointsTool)}static getACS(e,t,r){const i=a.IModelApp.accuDraw;if(!i.isEnabled)return 32768;const o=i.currentView;if(!o)return 32768;let s=0,c=0;const l=new n.ThreeAxes;r||(s=i.rotationMode,c=i.flags.baseRotation,l.setFrom(i.axes));const u=o.view.auxiliaryCoordinateSystem;if(t&&(i.origin.setFrom(u.getOrigin()),i.point.setFrom(i.origin),i.planePt.setFrom(i.origin)),r)i.flags.auxRotationPlane=1,this.setStandardRotation(5);else{if(this.itemFieldUnlockAll(),i.setRotationMode(s),i.flags.baseRotation=c,i.axes.setFrom(l),5===i.flags.baseRotation){const e=u.clone(),t=i.getRotation();e.setRotation(t),n.AccuDraw.updateAuxCoordinateSystem(e,o)}i.published.flags&=-131073}return 0}static writeACS(e){const t=a.IModelApp.accuDraw;return t.isEnabled&&t.currentView?0:32768}static itemFieldUnlockAll(){const e=a.IModelApp.accuDraw;e.isEnabled&&e.unlockAllFields()}}t.AccuDrawShortcuts=AccuDrawShortcuts;class AccuDrawShortcutsTool extends o.InputCollector{constructor(e){super(),this._shortcut=e,this._cancel=!0}onPostInstall(){super.onPostInstall(),this.initLocateElements(!1,!0,void 0,0),this._shortcut.doManipulationStart()}onCleanup(){this._shortcut.doManipulationStop(this._cancel)}async onDataButtonDown(e){return await this._shortcut.doManipulation(e,!1)&&(this._cancel=!1,this.exitTool()),o.EventHandled.No}async onMouseMotion(e){this._shortcut.doManipulation(e,!0)}decorate(e){this._shortcut.onDecorate(e)}exitTool(){super.exitTool(),AccuDrawShortcuts.requestInputFocus()}}AccuDrawShortcutsTool.toolId="View.AccuDraw";class AccuDrawTool{doManipulationStart(){this.activateAccuDrawOnStart()&&a.IModelApp.accuDraw.activate(),this.doManipulation(void 0,!0)}doManipulationStop(e){e||(a.IModelApp.accuDraw.savedStateInputCollector.ignoreFlags=this.onManipulationComplete())}activateAccuDrawOnStart(){return!0}onManipulationComplete(){return 0}onDecorate(e){}static installTool(e){return new AccuDrawShortcutsTool(e).run()}static outputPrompt(e){a.IModelApp.notifications.outputPromptByKey("AccuDraw.Prompt."+e)}}t.AccuDrawTool=AccuDrawTool;class RotateAxesTool extends AccuDrawTool{constructor(e){super(),this._aboutCurrentZ=e}onManipulationComplete(){return 16}doManipulationStart(){super.doManipulationStart(),AccuDrawTool.outputPrompt("DefineXAxis")}async doManipulation(e,t){const r=e?e.viewport:a.IModelApp.accuDraw.currentView;return!r||(AccuDrawShortcuts.rotateAxesByPoint(i.TentativeOrAccuSnap.isHot,this._aboutCurrentZ),r.invalidateDecorations(),t||AccuDrawShortcuts.itemFieldUnlockAll(),!0)}}class RotateElementTool extends AccuDrawTool{constructor(e,t,r){super(),this._moveOrigin=e,this._updateCurrentACS=t,this._updateDynamicACS=r}activateAccuDrawOnStart(){return!this._updateDynamicACS}onManipulationComplete(){let e=16;return this._moveOrigin&&(e|=4),this._updateDynamicACS||(e|=4096),e}doManipulationStart(){super.doManipulationStart(),AccuDrawTool.outputPrompt("DefineElem");const e=a.IModelApp.accuSnap;e.isSnapEnabledByUser||e.enableLocate(!0)}updateOrientation(e,t){const r=a.IModelApp.accuDraw,i=n.AccuDraw.getSnapRotation(e,t);if(void 0===i)return!1;const o=this._moveOrigin?e.snapPoint:r.origin;return r.setContext(2097172,o,i),!0}async doManipulation(e,t){const r=e?e.viewport:a.IModelApp.accuDraw.currentView;if(!r)return!0;let o=i.TentativeOrAccuSnap.getCurrentSnap(!1);if(void 0===o){const e=a.IModelApp.accuSnap.currHit;void 0!==e&&(o=await i.AccuSnap.requestSnap(e,[1],a.IModelApp.locateManager.apertureInches,1))}if(void 0!==o&&!this.updateOrientation(o,r))return!0;if(this._updateDynamicACS?a.IModelApp.viewManager.invalidateDecorationsAllViews():void 0===e&&AccuDrawShortcuts.processPendingHints(),t)return!0;const s=a.IModelApp.accuDraw;if(this._updateCurrentACS){AccuDrawShortcuts.processPendingHints();const e=r.view.auxiliaryCoordinateSystem.clone();e.setOrigin(s.origin),e.setRotation(s.getRotation()),n.AccuDraw.updateAuxCoordinateSystem(e,r)}else s.changeBaseRotationMode(6);return!0}onDecorate(e){if(!this._updateDynamicACS)return;const t=a.IModelApp.accuDraw,r=t.origin,n=t.getRotation(),i=e.viewport.view.auxiliaryCoordinateSystem.clone();i.setOrigin(r),i.setRotation(n),i.display(e,17)}}class DefineACSByPointsTool extends AccuDrawTool{constructor(){super(...arguments),this._points=[]}activateAccuDrawOnStart(){return!1}onManipulationComplete(){return 16}doManipulationStart(){super.doManipulationStart();const e=a.IModelApp.tentativePoint;if(!e.isActive)return void AccuDrawTool.outputPrompt("DefineOrigin");const t=e.getPoint().clone();AccuDrawTool.outputPrompt("DefineXAxis"),a.IModelApp.accuDraw.setContext(12,t),this._points.push(t),e.clear(!0)}async doManipulation(e,t){if(!e||!e.viewport)return!0;if(a.IModelApp.viewManager.invalidateDecorationsAllViews(),t)return!1;a.IModelApp.accuDraw.activate(),this._points.push(e.point.clone());const r=e.viewport;return this._acs||(this._acs=r.view.auxiliaryCoordinateSystem.clone()),AccuDrawShortcuts.updateACSByPoints(this._acs,r,this._points,!1)?(n.AccuDraw.updateAuxCoordinateSystem(this._acs,r),AccuDrawShortcuts.rotateToACS(),!0):(AccuDrawTool.outputPrompt(1===this._points.length?"DefineXAxis":"DefineYDir"),!1)}onDecorate(e){const t=[];this._points.forEach(e=>t.push(e));const r=new o.BeButtonEvent;a.IModelApp.toolAdmin.fillEventFromCursorLocation(r),t.push(r.point);const n=e.viewport;this._acs||(this._acs=n.view.auxiliaryCoordinateSystem.clone()),AccuDrawShortcuts.updateACSByPoints(this._acs,n,t,!0),this._acs.display(e,17)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(118),i=r(222);var o;!function(e){e[e.Trace=0]="Trace",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.None=4]="None"}(o=t.LogLevel||(t.LogLevel={}));class Logger{static initialize(e,t,r,n){Logger._logError=e,Logger._logWarning=t,Logger._logInfo=r,Logger._logTrace=n,Logger.turnOffLevelDefault(),Logger.turnOffCategories()}static initializeToConsole(){Logger.initialize((e,t,r)=>console.log("Error   |"+e+"| "+t+Logger.formatMetaData(r)),(e,t,r)=>console.log("Warning |"+e+"| "+t+Logger.formatMetaData(r)),(e,t,r)=>console.log("Info    |"+e+"| "+t+Logger.formatMetaData(r)),(e,t,r)=>console.log("Trace   |"+e+"| "+t+Logger.formatMetaData(r)))}static addActivityId(e){if(""===i.ActivityLoggingContext.current.activityId||e.hasOwnProperty("ActivityId"))return;const t=i.ActivityLoggingContext.current.activityId;""!==t&&(e.ActivityId=t)}static set logExceptionCallstacks(e){Logger._logExceptionCallstacks=e}static get logExceptionCallstacks(){return Logger._logExceptionCallstacks}static makeMetaData(e){if(!e&&""===i.ActivityLoggingContext.current.activityId)return;const t=e?e():{};return Logger.addActivityId(t),t}static formatMetaData(e){return e||""!==i.ActivityLoggingContext.current.activityId?" "+JSON.stringify(Logger.makeMetaData(e)):""}static setLevelDefault(e){Logger._minLevel=e}static setLevel(e,t){Logger._categoryFilter.set(e,t)}static ParseLogLevel(e){switch(e.toUpperCase()){case"EXCEPTION":case"FATAL":case"ERROR":return o.Error;case"WARNING":return o.Warning;case"INFO":return o.Info;case"TRACE":case"DEBUG":return o.Trace}return o.None}static configureLevels(e){if(Logger.validateProps(e),void 0!==e.defaultLevel&&this.setLevelDefault(Logger.ParseLogLevel(e.defaultLevel)),void 0!==e.categoryLevels)for(const t of e.categoryLevels)this.setLevel(t.category,Logger.ParseLogLevel(t.logLevel))}static isLogLevel(e){return o.hasOwnProperty(e)}static validateProps(e){const t=["defaultLevel","categoryLevels"];for(const r of Object.keys(e)){if(!t.includes(r))throw new n.BentleyError(65539,"LoggerLevelsConfig - unrecognized property: "+r);if("defaultLevel"===r){if(!Logger.isLogLevel(e.defaultLevel))throw new n.BentleyError(65539,"LoggerLevelsConfig.defaultLevel must be a LogLevel. Invalid value: "+JSON.stringify(e.defaultLevel))}else if("categoryLevels"===r){const t=e[r];if(!Array.isArray(t))throw new n.BentleyError(65539,"LoggerLevelsConfig.categoryLevels must be an array. Invalid value: "+JSON.stringify(t));for(const i of e[r]){if(!i.hasOwnProperty("category")||!i.hasOwnProperty("logLevel"))throw new n.BentleyError(65539,"LoggerLevelsConfig.categoryLevels - each item must be a LoggerCategoryAndLevel {category: logLevel:}. Invalid value: "+JSON.stringify(i));if(!Logger.isLogLevel(i.logLevel))throw new n.BentleyError(65539,"LoggerLevelsConfig.categoryLevels - each item's logLevel property must be a LogLevel. Invalid value: "+JSON.stringify(i.logLevel))}}}}static getLevel(e){const t=Logger._categoryFilter.get(e);if(void 0!==t)return t;const r=e.lastIndexOf(".");return void 0!==r&&-1!==r?Logger.getLevel(e.slice(0,r)):Logger._minLevel}static turnOffLevelDefault(){Logger._minLevel=void 0}static turnOffCategories(){Logger._categoryFilter.clear()}static isEnabled(e,t){const r=Logger.getLevel(e);return void 0!==r&&t>=r}static logError(e,t,r){Logger._logError&&Logger.isEnabled(e,o.Error)&&Logger._logError(e,t,r)}static getExceptionMessage(e){let t=e.toString();return Logger.logExceptionCallstacks&&e.stack&&(t+="\n"+e.stack),t}static logException(e,t,r=Logger.logError,n){r(e,Logger.getExceptionMessage(t),()=>{const e=n?n():{};return e.hasOwnProperty("ExceptionType")||(e.ExceptionType=t.constructor.name),e})}static logWarning(e,t,r){Logger._logWarning&&Logger.isEnabled(e,o.Warning)&&Logger._logWarning(e,t,r)}static logInfo(e,t,r){Logger._logInfo&&Logger.isEnabled(e,o.Info)&&Logger._logInfo(e,t,r)}static logTrace(e,t,r){Logger._logTrace&&Logger.isEnabled(e,o.Trace)&&Logger._logTrace(e,t,r)}}Logger._categoryFilter=new Map,Logger._minLevel=void 0,Logger._logExceptionCallstacks=!1,t.Logger=Logger;class PerfLogger{constructor(e){this._routine=e,Logger.isEnabled(PerfLogger._loggerName,PerfLogger._severity)?(Logger.logInfo(PerfLogger._loggerName,`${this._routine},START`),this._startTimeStamp=(new Date).getTime()):this._startTimeStamp=0}dispose(){const e=(new Date).getTime();Logger.isEnabled(PerfLogger._loggerName,PerfLogger._severity)&&Logger.logInfo(PerfLogger._loggerName,`${this._routine},END,${e-this._startTimeStamp} ms`)}}PerfLogger._loggerName="Performance",PerfLogger._severity=o.Info,t.PerfLogger=PerfLogger;class EnvMacroSubst{static replace(e,t){let r,n=0;for(;-1!==(r=e.indexOf("${",n));){const i=e.indexOf("}",r+2);if(-1===i){n=r+2;continue}const o=e.slice(r+2,i);let s=Object({NODE_ENV:"production",CORS_PROXY_PORT:void 0,PUBLIC_URL:"."})[o];if(void 0===s){if(void 0===t||!t.hasOwnProperty(o)){n=i+1;continue}s=t[o]}e=e.slice(0,r)+s+e.slice(i+1),n+=r+s.length}return e}static containsEnvvars(e){return e.includes("${")&&e.includes("}")}static replaceInProperties(e,t,r){for(const n of Object.keys(e))"string"===typeof e[n]?EnvMacroSubst.containsEnvvars(e[n])&&(e[n]=EnvMacroSubst.replace(e[n],r)):t&&"object"===typeof e[n]&&EnvMacroSubst.replaceInProperties(e[n],!0,r)}static anyPropertyContainsEnvvars(e,t){for(const r of Object.keys(e))if("string"===typeof e[r]){if(EnvMacroSubst.containsEnvvars(e[r]))return!0}else if(t&&"object"===typeof e[r]&&EnvMacroSubst.anyPropertyContainsEnvvars(e[r],!0))return!0;return!1}}t.EnvMacroSubst=EnvMacroSubst},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class ActivityLoggingContext{constructor(e){this.activityId=e}static get current(){return ActivityLoggingContext._current}enter(){return ActivityLoggingContext._current=this,this}}ActivityLoggingContext._current=new ActivityLoggingContext(""),t.ActivityLoggingContext=ActivityLoggingContext},function(e,t,r){"use strict";e.exports=function(e){return null!==e&&"object"===typeof e}},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),o=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)"undefined"!==typeof e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:o,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var i=t[n],o=i.obj[i.prop],s=Object.keys(o),a=0;a<s.length;++a){var c=s[a],l=o[c];"object"===typeof l&&null!==l&&-1===r.indexOf(l)&&(t.push({obj:o,prop:c}),r.push(l))}return function(e){for(var t;e.length;){var r=e.pop();if(t=r.obj[r.prop],Array.isArray(t)){for(var n=[],i=0;i<t.length;++i)"undefined"!==typeof t[i]&&n.push(t[i]);r.obj[r.prop]=n}}return t}(t)},decode:function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},encode:function(e){if(0===e.length)return e;for(var t="string"===typeof e?e:String(e),r="",n=0;n<t.length;++n){var o=t.charCodeAt(n);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?r+=t.charAt(n):o<128?r+=i[o]:o<2048?r+=i[192|o>>6]+i[128|63&o]:o<55296||o>=57344?r+=i[224|o>>12]+i[128|o>>6&63]+i[128|63&o]:(n+=1,o=65536+((1023&o)<<10|1023&t.charCodeAt(n)),r+=i[240|o>>18]+i[128|o>>12&63]+i[128|o>>6&63]+i[128|63&o])}return r},isBuffer:function(e){return null!==e&&"undefined"!==typeof e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,r,i){if(!r)return t;if("object"!==typeof r){if(Array.isArray(t))t.push(r);else{if("object"!==typeof t)return[t,r];(i.plainObjects||i.allowPrototypes||!n.call(Object.prototype,r))&&(t[r]=!0)}return t}if("object"!==typeof t)return[t].concat(r);var s=t;return Array.isArray(t)&&!Array.isArray(r)&&(s=o(t,i)),Array.isArray(t)&&Array.isArray(r)?(r.forEach(function(r,o){n.call(t,o)?t[o]&&"object"===typeof t[o]?t[o]=e(t[o],r,i):t.push(r):t[o]=r}),t):Object.keys(r).reduce(function(t,o){var s=r[o];return n.call(t,o)?t[o]=e(t[o],s,i):t[o]=s,t},s)}}},function(e,t,r){"use strict";var n=String.prototype.replace,i=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return n.call(e,i,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(228),i=r(229),o=r(231),s=r(418),a=r(0);var c;!function(e){e[e.Yes=0]="Yes",e[e.No=1]="No"}(c=t.IncludePrefix||(t.IncludePrefix={}));class Token{constructor(e){this._samlAssertion=e}getSamlAssertion(){return this._samlAssertion}getUserInfo(){return this._userInfo}getExpiresAt(){return this._expiresAt}getStartsAt(){return this._startsAt}parseSamlAssertion(){if(!this._samlAssertion)return!1;const e=n.useNamespaces({ds:"http://www.w3.org/2000/09/xmldsig#",saml:"urn:oasis:names:tc:SAML:1.0:assertion"}),t=(new i.DOMParser).parseFromString(this._samlAssertion);this._x509Certificate=e("/saml:Assertion/ds:Signature/ds:KeyInfo/ds:X509Data/ds:X509Certificate/text()",t).toString();const r=e("string(/saml:Assertion/saml:Conditions/@NotBefore)",t).toString();this._startsAt=new Date(r);const s=e("string(/saml:Assertion/saml:Conditions/@NotOnOrAfter)",t).toString(),a=r=>e("/saml:Assertion/saml:AttributeStatement/saml:Attribute[@AttributeName='"+r+"']/saml:AttributeValue/text()",t).toString(),c=a("userid"),l={id:a("emailaddress")},u={name:a("name"),firstName:a("givenname"),lastName:a("surname")},d={id:a("organizationid"),name:a("organization")},h={ultimateSite:a("ultimatesite"),usageCountryIso:a("usagecountryiso")};return this._userInfo=new o.UserInfo(c,l,u,d,h),this._startsAt=new Date(r),this._expiresAt=new Date(s),!!this._x509Certificate&&!!this._startsAt&&!!this._expiresAt}}t.Token=Token;class AuthorizationToken extends Token{static fromSamlAssertion(e){const t=new AuthorizationToken(e);if(!t.parseSamlAssertion())throw new a.BentleyError(32768,"Cannot parse Saml assertion");return t}toTokenString(t=c.Yes){if(!this._x509Certificate)throw new a.BentleyError(32768,"Invalid access token");return(t===c.Yes?"X509 access_token=":"")+e.from(this._x509Certificate,"utf8").toString("base64")}static clone(e){const t=new AuthorizationToken(e._samlAssertion);return Object.assign(t,e),t}}t.AuthorizationToken=AuthorizationToken;class AccessToken extends Token{static fromSamlAssertion(e){const t=new AccessToken(e);if(!t.parseSamlAssertion())throw new a.BentleyError(32768,"Cannot parse Saml assertion");return t}static fromForeignProjectAccessTokenJson(e){if(!e.startsWith(`{"${this.foreignProjectAccessTokenJsonProperty}":`))return;const t=JSON.parse(e);if(void 0===t[this.foreignProjectAccessTokenJsonProperty])return;const r=new AccessToken(e);return r._userInfo=t[this.foreignProjectAccessTokenJsonProperty].userInfo,r}static fromSamlTokenString(e,t=c.Yes){let r=e;if(t===c.Yes){if(e.toLowerCase().indexOf(AccessToken._samlTokenPrefix.toLowerCase())<0)throw new a.BentleyError(32768,"Invalid saml token");if(!(r=e.slice(6)))throw new a.BentleyError(32768,"Invalid saml token")}const n=s.Base64.atob(r).replace(/\0$/,"");if(!n)throw new a.BentleyError(32768,"Invalid saml token");return AccessToken.fromSamlAssertion(n)}static fromJsonWebTokenString(e,t,r,n){const i=new AccessToken("");return i._jwt=e,i._startsAt=t,i._expiresAt=r,i._userInfo=n,i}toTokenString(e=c.Yes){if(this._jwt)return e===c.Yes?AccessToken._jwtTokenPrefix+" "+this._jwt:this._jwt;if(!this._samlAssertion)throw new a.BentleyError(32768,"Cannot convert invalid access token to string");const t=s.Base64.btoa(this._samlAssertion);return e===c.Yes?AccessToken._samlTokenPrefix+" "+t:t}static fromJson(e){if(e._jwt)return AccessToken.fromJsonWebTokenString(e._jwt,e._startsAt,e._expiresAt,e._userInfo);const t=AccessToken.fromForeignProjectAccessTokenJson(e._samlAssertion);return void 0!==t?t:AccessToken.fromSamlAssertion(e._samlAssertion)}}AccessToken._samlTokenPrefix="Token",AccessToken._jwtTokenPrefix="Bearer",AccessToken.foreignProjectAccessTokenJsonProperty="ForeignProjectAccessToken",t.AccessToken=AccessToken}).call(this,r(36).Buffer)},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){!function(e){"use strict";function t(e){var t=Array.prototype.slice,r=e.length,n=function(){var i=t.call(arguments);return i.length<r?function(e,r){return function(){return r.apply(this,e.concat(t.call(arguments)))}}(i,n):e.apply(this,t.apply(arguments,[0,r]))};return n}var r=t(function(e,t){for(var r=0;r<t.length;r+=1)e(t[r],r,t)}),n=t(function(e,t,n){var i=t;return r(function(t,r){i=e(i,t,r)},n),i}),i=t(function(e,t){var n=new Array(t.length);return r(function(t,r){n[r]=e(t)},t),n}),o=t(function(e,t){var n=[];return r(function(t,r){e(t,r)&&n.push(t)},t),n});function s(){if(0===arguments.length)throw new Error("compose requires at least one argument");var e=Array.prototype.slice.call(arguments).reverse(),t=e[0],r=e.slice(1);return function(){return n(function(e,t){return t(e)},t.apply(null,arguments),r)}}var a=t(function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return!0;return!1});var c=t(function(e,t){return t[e]});function l(e){return e.toString()}var u=t(function(e,t){return t.join(e)}),d=t(function(e,t,r){return e+r+t});function h(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}function p(){this.init()}function f(e){this.expression=e}function g(e,t,r){t in e||(e[t]=r)}function m(){}function y(e){arguments.length>0&&this.init(e)}function v(e){arguments.length>0&&this.init(e)}function _(e,t){arguments.length>0&&this.init(e,t)}function w(e,t){arguments.length>0&&this.init(e,t)}function S(e,t){arguments.length>0&&this.init(e,t)}function b(e,t){arguments.length>0&&this.init(e,t)}function x(e,t){arguments.length>0&&this.init(e,t)}function P(e,t){arguments.length>0&&this.init(e,t)}function C(e,t){arguments.length>0&&this.init(e,t)}function T(e,t){arguments.length>0&&this.init(e,t)}function M(e,t){arguments.length>0&&this.init(e,t)}function E(e,t){arguments.length>0&&this.init(e,t)}function I(e,t){arguments.length>0&&this.init(e,t)}function A(e,t){arguments.length>0&&this.init(e,t)}function R(e,t){arguments.length>0&&this.init(e,t)}function O(e,t){arguments.length>0&&this.init(e,t)}function D(e,t){arguments.length>0&&this.init(e,t)}function k(e,t,r){arguments.length>0&&this.init(e,t,r)}function F(e,t){arguments.length>0&&this.init(e,t)}function N(e,t,r){arguments.length>0&&this.init(e,t,r)}function L(e,t){arguments.length>0&&this.init(e,t)}function B(e){arguments.length>0&&this.init(e)}function V(e,t){arguments.length>0&&this.init(e,t)}p.prototype=new Object,p.prototype.constructor=p,p.superclass=Object.prototype,p.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(e){return new w(e[0],e[2])},this.reduceActions[5]=function(e){return new S(e[0],e[2])},this.reduceActions[7]=function(e){return new b(e[0],e[2])},this.reduceActions[8]=function(e){return new x(e[0],e[2])},this.reduceActions[10]=function(e){return new P(e[0],e[2])},this.reduceActions[11]=function(e){return new C(e[0],e[2])},this.reduceActions[12]=function(e){return new T(e[0],e[2])},this.reduceActions[13]=function(e){return new M(e[0],e[2])},this.reduceActions[15]=function(e){return new E(e[0],e[2])},this.reduceActions[16]=function(e){return new I(e[0],e[2])},this.reduceActions[18]=function(e){return new A(e[0],e[2])},this.reduceActions[19]=function(e){return new R(e[0],e[2])},this.reduceActions[20]=function(e){return new O(e[0],e[2])},this.reduceActions[22]=function(e){return new v(e[1])},this.reduceActions[24]=function(e){return new D(e[0],e[2])},this.reduceActions[25]=function(e){return new k(void 0,void 0,e[0])},this.reduceActions[27]=function(e){return e[0].locationPath=e[2],e[0]},this.reduceActions[28]=function(e){return e[0].locationPath=e[2],e[0].locationPath.steps.unshift(new N(N.DESCENDANTORSELF,L.nodeTest,[])),e[0]},this.reduceActions[29]=function(e){return new k(e[0],[],void 0)},this.reduceActions[30]=function(e){return Q.instance_of(e[0],k)?(void 0==e[0].filterPredicates&&(e[0].filterPredicates=[]),e[0].filterPredicates.push(e[1]),e[0]):new k(e[0],[e[1]],void 0)},this.reduceActions[32]=function(e){return e[1]},this.reduceActions[33]=function(e){return new z(e[0])},this.reduceActions[34]=function(e){return new j(e[0])},this.reduceActions[36]=function(e){return new V(e[0],[])},this.reduceActions[37]=function(e){return new V(e[0],e[2])},this.reduceActions[38]=function(e){return[e[0]]},this.reduceActions[39]=function(e){return e[2].unshift(e[0]),e[2]},this.reduceActions[43]=function(e){return new F(!0,[])},this.reduceActions[44]=function(e){return e[1].absolute=!0,e[1]},this.reduceActions[46]=function(e){return new F(!1,[e[0]])},this.reduceActions[47]=function(e){return e[0].steps.push(e[2]),e[0]},this.reduceActions[49]=function(e){return new N(e[0],e[1],[])},this.reduceActions[50]=function(e){return new N(N.CHILD,e[0],[])},this.reduceActions[51]=function(e){return new N(e[0],e[1],e[2])},this.reduceActions[52]=function(e){return new N(N.CHILD,e[0],e[1])},this.reduceActions[54]=function(e){return[e[0]]},this.reduceActions[55]=function(e){return e[1].unshift(e[0]),e[1]},this.reduceActions[56]=function(e){return"ancestor"==e[0]?N.ANCESTOR:"ancestor-or-self"==e[0]?N.ANCESTORORSELF:"attribute"==e[0]?N.ATTRIBUTE:"child"==e[0]?N.CHILD:"descendant"==e[0]?N.DESCENDANT:"descendant-or-self"==e[0]?N.DESCENDANTORSELF:"following"==e[0]?N.FOLLOWING:"following-sibling"==e[0]?N.FOLLOWINGSIBLING:"namespace"==e[0]?N.NAMESPACE:"parent"==e[0]?N.PARENT:"preceding"==e[0]?N.PRECEDING:"preceding-sibling"==e[0]?N.PRECEDINGSIBLING:"self"==e[0]?N.SELF:-1},this.reduceActions[57]=function(e){return N.ATTRIBUTE},this.reduceActions[59]=function(e){return"comment"==e[0]?L.commentTest:"text"==e[0]?L.textTest:"processing-instruction"==e[0]?L.anyPiTest:"node"==e[0]?L.nodeTest:new L(-1,void 0)},this.reduceActions[60]=function(e){return new L.PITest(e[2])},this.reduceActions[61]=function(e){return e[1]},this.reduceActions[63]=function(e){return e[1].absolute=!0,e[1].steps.unshift(new N(N.DESCENDANTORSELF,L.nodeTest,[])),e[1]},this.reduceActions[64]=function(e){return e[0].steps.push(new N(N.DESCENDANTORSELF,L.nodeTest,[])),e[0].steps.push(e[2]),e[0]},this.reduceActions[65]=function(e){return new N(N.SELF,L.nodeTest,[])},this.reduceActions[66]=function(e){return new N(N.PARENT,L.nodeTest,[])},this.reduceActions[67]=function(e){return new B(e[1])},this.reduceActions[68]=function(e){return L.nameTestAny},this.reduceActions[69]=function(e){return new L.NameTestPrefixAny(e[0].split(":")[0])},this.reduceActions[70]=function(e){return new L.NameTestQName(e[0])}},p.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],p.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                             \x87      ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                             \x88      ","                             F\x89     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                 \x8a  ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],p.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         \x7f=>?@ AB  CDEFGH IJ ","\x80456789:;<=>?@ AB  CDEFGH IJ\x81","            \x82        EFGH IJ ","            \x83        EFGH IJ ","                             ","                     \x84 GH IJ ","                     \x85 GH IJ ","              i          \x86   ","              i          \x87   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ AB\x8cqCDEFGH IJ ","                             ","                             "],p.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],p.DOUBLEDOT=2,p.DOUBLECOLON=3,p.DOUBLESLASH=4,p.NOTEQUAL=5,p.LESSTHANOREQUAL=6,p.GREATERTHANOREQUAL=7,p.AND=8,p.OR=9,p.MOD=10,p.DIV=11,p.MULTIPLYOPERATOR=12,p.FUNCTIONNAME=13,p.AXISNAME=14,p.LITERAL=15,p.NUMBER=16,p.ASTERISKNAMETEST=17,p.QNAME=18,p.NCNAMECOLONASTERISK=19,p.NODETYPE=20,p.PROCESSINGINSTRUCTIONWITHLITERAL=21,p.EQUALS=22,p.LESSTHAN=23,p.GREATERTHAN=24,p.PLUS=25,p.MINUS=26,p.BAR=27,p.SLASH=28,p.LEFTPARENTHESIS=29,p.RIGHTPARENTHESIS=30,p.COMMA=31,p.AT=32,p.LEFTBRACKET=33,p.RIGHTBRACKET=34,p.DOT=35,p.DOLLAR=36,p.prototype.tokenize=function(e){for(var t=[],r=[],n=e+"\0",i=0,o=n.charAt(i++);;){for(;" "==o||"\t"==o||"\r"==o||"\n"==o;)o=n.charAt(i++);if("\0"==o||i>=n.length)break;if("("!=o)if(")"!=o)if("["!=o)if("]"!=o)if("@"!=o)if(","!=o)if("|"!=o)if("+"!=o)if("-"!=o)if("="!=o)if("$"!=o)if("."!=o)if("'"!=o&&'"'!=o)if(o>="0"&&o<="9"){u=o;for(o=n.charAt(i++);o>="0"&&o<="9";)u+=o,o=n.charAt(i++);if("."==o&&n.charAt(i)>="0"&&n.charAt(i)<="9")for(u+=o,u+=n.charAt(i++),o=n.charAt(i++);o>="0"&&o<="9";)u+=o,o=n.charAt(i++);t.push(p.NUMBER),r.push(u)}else if("*"!=o)if(":"!=o||":"!=n.charAt(i))if("/"!=o)if("!"!=o||"="!=n.charAt(i))if("<"!=o)if(">"!=o){if("_"!=o&&!Q.isLetter(o.charCodeAt(0)))throw new Error("Unexpected character "+o);var s=o;for(o=n.charAt(i++);Q.isNCNameChar(o.charCodeAt(0));)s+=o,o=n.charAt(i++);if(t.length>0&&(a=t[t.length-1])!=p.AT&&a!=p.DOUBLECOLON&&a!=p.LEFTPARENTHESIS&&a!=p.LEFTBRACKET&&a!=p.AND&&a!=p.OR&&a!=p.MOD&&a!=p.DIV&&a!=p.MULTIPLYOPERATOR&&a!=p.SLASH&&a!=p.DOUBLESLASH&&a!=p.BAR&&a!=p.PLUS&&a!=p.MINUS&&a!=p.EQUALS&&a!=p.NOTEQUAL&&a!=p.LESSTHAN&&a!=p.LESSTHANOREQUAL&&a!=p.GREATERTHAN&&a!=p.GREATERTHANOREQUAL){if("and"==s){t.push(p.AND),r.push(s);continue}if("or"==s){t.push(p.OR),r.push(s);continue}if("mod"==s){t.push(p.MOD),r.push(s);continue}if("div"==s){t.push(p.DIV),r.push(s);continue}}if(":"==o){if("*"==n.charAt(i)){t.push(p.NCNAMECOLONASTERISK),r.push(s+":*"),i++,o=n.charAt(i++);continue}if("_"==n.charAt(i)||Q.isLetter(n.charCodeAt(i))){for(s+=":",o=n.charAt(i++);Q.isNCNameChar(o.charCodeAt(0));)s+=o,o=n.charAt(i++);if("("==o){t.push(p.FUNCTIONNAME),r.push(s);continue}t.push(p.QNAME),r.push(s);continue}if(":"==n.charAt(i)){t.push(p.AXISNAME),r.push(s);continue}}if("("==o){if("comment"==s||"text"==s||"node"==s){t.push(p.NODETYPE),r.push(s);continue}if("processing-instruction"==s){")"==n.charAt(i)?t.push(p.NODETYPE):t.push(p.PROCESSINGINSTRUCTIONWITHLITERAL),r.push(s);continue}t.push(p.FUNCTIONNAME),r.push(s);continue}t.push(p.QNAME),r.push(s)}else{if("="==n.charAt(i)){t.push(p.GREATERTHANOREQUAL),r.push(">="),i++,o=n.charAt(i++);continue}t.push(p.GREATERTHAN),r.push(">"),o=n.charAt(i++)}else{if("="==n.charAt(i)){t.push(p.LESSTHANOREQUAL),r.push("<="),i++,o=n.charAt(i++);continue}t.push(p.LESSTHAN),r.push("<"),o=n.charAt(i++)}else t.push(p.NOTEQUAL),r.push("!="),i++,o=n.charAt(i++);else{if("/"==(o=n.charAt(i++))){t.push(p.DOUBLESLASH),r.push("//"),o=n.charAt(i++);continue}t.push(p.SLASH),r.push("/")}else t.push(p.DOUBLECOLON),r.push("::"),i++,o=n.charAt(i++);else{var a;if(t.length>0&&(a=t[t.length-1])!=p.AT&&a!=p.DOUBLECOLON&&a!=p.LEFTPARENTHESIS&&a!=p.LEFTBRACKET&&a!=p.AND&&a!=p.OR&&a!=p.MOD&&a!=p.DIV&&a!=p.MULTIPLYOPERATOR&&a!=p.SLASH&&a!=p.DOUBLESLASH&&a!=p.BAR&&a!=p.PLUS&&a!=p.MINUS&&a!=p.EQUALS&&a!=p.NOTEQUAL&&a!=p.LESSTHAN&&a!=p.LESSTHANOREQUAL&&a!=p.GREATERTHAN&&a!=p.GREATERTHANOREQUAL){t.push(p.MULTIPLYOPERATOR),r.push(o),o=n.charAt(i++);continue}t.push(p.ASTERISKNAMETEST),r.push(o),o=n.charAt(i++)}else{for(var c=o,l="";i<n.length&&(o=n.charAt(i))!==c;)l+=o,i+=1;if(o!==c)throw $.fromMessage("Unterminated string literal: "+c+l);i+=1,t.push(p.LITERAL),r.push(l),o=n.charAt(i++)}else{if("."==(o=n.charAt(i++))){t.push(p.DOUBLEDOT),r.push(".."),o=n.charAt(i++);continue}if(o>="0"&&o<="9"){var u="."+o;for(o=n.charAt(i++);o>="0"&&o<="9";)u+=o,o=n.charAt(i++);t.push(p.NUMBER),r.push(u);continue}t.push(p.DOT),r.push(".")}else t.push(p.DOLLAR),r.push(o),o=n.charAt(i++);else t.push(p.EQUALS),r.push(o),o=n.charAt(i++);else t.push(p.MINUS),r.push(o),o=n.charAt(i++);else t.push(p.PLUS),r.push(o),o=n.charAt(i++);else t.push(p.BAR),r.push(o),o=n.charAt(i++);else t.push(p.COMMA),r.push(o),o=n.charAt(i++);else t.push(p.AT),r.push(o),o=n.charAt(i++);else t.push(p.RIGHTBRACKET),r.push(o),o=n.charAt(i++);else t.push(p.LEFTBRACKET),r.push(o),o=n.charAt(i++);else t.push(p.RIGHTPARENTHESIS),r.push(o),o=n.charAt(i++);else t.push(p.LEFTPARENTHESIS),r.push(o),o=n.charAt(i++)}return t.push(1),r.push("[EOF]"),[t,r]},p.SHIFT="s",p.REDUCE="r",p.ACCEPT="a",p.prototype.parse=function(e){var t,r,n=this.tokenize(e);if(void 0!=n){t=n[0],r=n[1];var i,o,s=0,a=[],c=[],l=[];for(a.push(0),c.push(1),l.push("_S"),i=t[s],o=r[s++];;)switch(e=a[a.length-1],p.actionTable[e].charAt(i-1)){case p.SHIFT:c.push(-i),l.push(o),a.push(p.actionTableNumber[e].charCodeAt(i-1)-32),i=t[s],o=r[s++];break;case p.REDUCE:for(var u=p.productions[p.actionTableNumber[e].charCodeAt(i-1)-32][1],d=[],h=0;h<u;h++)c.pop(),d.unshift(l.pop()),a.pop();var g=a[a.length-1];c.push(p.productions[p.actionTableNumber[e].charCodeAt(i-1)-32][0]),void 0==this.reduceActions[p.actionTableNumber[e].charCodeAt(i-1)-32]?l.push(d[0]):l.push(this.reduceActions[p.actionTableNumber[e].charCodeAt(i-1)-32](d)),a.push(p.gotoTable[g].charCodeAt(p.productions[p.actionTableNumber[e].charCodeAt(i-1)-32][0]-2)-33);break;case p.ACCEPT:return new f(l.pop());default:throw new Error("XPath parse error")}}},f.prototype=new Object,f.prototype.constructor=f,f.superclass=Object.prototype,f.prototype.toString=function(){return this.expression.toString()},f.prototype.evaluate=function(e){return e.contextNode=e.expressionContextNode,e.contextSize=1,e.contextPosition=1,e.isHtml&&(g(e,"caseInsensitive",!0),g(e,"allowAnyNamespaceForNoPrefix",!0)),g(e,"caseInsensitive",!1),this.expression.evaluate(e)},f.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",f.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",m.prototype=new Object,m.prototype.constructor=m,m.superclass=Object.prototype,m.prototype.init=function(){},m.prototype.toString=function(){return"<Expression>"},m.prototype.evaluate=function(e){throw new Error("Could not evaluate expression.")},y.prototype=new m,y.prototype.constructor=y,y.superclass=m.prototype,y.prototype.init=function(e){this.rhs=e},v.prototype=new y,v.prototype.constructor=v,v.superclass=y.prototype,v.prototype.init=function(e){v.superclass.init.call(this,e)},v.prototype.evaluate=function(e){return this.rhs.evaluate(e).number().negate()},v.prototype.toString=function(){return"-"+this.rhs.toString()},_.prototype=new m,_.prototype.constructor=_,_.superclass=m.prototype,_.prototype.init=function(e,t){this.lhs=e,this.rhs=t},w.prototype=new _,w.prototype.constructor=w,w.superclass=_.prototype,w.prototype.init=function(e,t){w.superclass.init.call(this,e,t)},w.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},w.prototype.evaluate=function(e){var t=this.lhs.evaluate(e).bool();return t.booleanValue()?t:this.rhs.evaluate(e).bool()},S.prototype=new _,S.prototype.constructor=S,S.superclass=_.prototype,S.prototype.init=function(e,t){S.superclass.init.call(this,e,t)},S.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},S.prototype.evaluate=function(e){var t=this.lhs.evaluate(e).bool();return t.booleanValue()?this.rhs.evaluate(e).bool():t},b.prototype=new _,b.prototype.constructor=b,b.superclass=_.prototype,b.prototype.init=function(e,t){b.superclass.init.call(this,e,t)},b.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},b.prototype.evaluate=function(e){return this.lhs.evaluate(e).equals(this.rhs.evaluate(e))},x.prototype=new _,x.prototype.constructor=x,x.superclass=_.prototype,x.prototype.init=function(e,t){x.superclass.init.call(this,e,t)},x.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},x.prototype.evaluate=function(e){return this.lhs.evaluate(e).notequal(this.rhs.evaluate(e))},P.prototype=new _,P.prototype.constructor=P,P.superclass=_.prototype,P.prototype.init=function(e,t){P.superclass.init.call(this,e,t)},P.prototype.evaluate=function(e){return this.lhs.evaluate(e).lessthan(this.rhs.evaluate(e))},P.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},C.prototype=new _,C.prototype.constructor=C,C.superclass=_.prototype,C.prototype.init=function(e,t){C.superclass.init.call(this,e,t)},C.prototype.evaluate=function(e){return this.lhs.evaluate(e).greaterthan(this.rhs.evaluate(e))},C.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},T.prototype=new _,T.prototype.constructor=T,T.superclass=_.prototype,T.prototype.init=function(e,t){T.superclass.init.call(this,e,t)},T.prototype.evaluate=function(e){return this.lhs.evaluate(e).lessthanorequal(this.rhs.evaluate(e))},T.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},M.prototype=new _,M.prototype.constructor=M,M.superclass=_.prototype,M.prototype.init=function(e,t){M.superclass.init.call(this,e,t)},M.prototype.evaluate=function(e){return this.lhs.evaluate(e).greaterthanorequal(this.rhs.evaluate(e))},M.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},E.prototype=new _,E.prototype.constructor=E,E.superclass=_.prototype,E.prototype.init=function(e,t){E.superclass.init.call(this,e,t)},E.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().plus(this.rhs.evaluate(e).number())},E.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},I.prototype=new _,I.prototype.constructor=I,I.superclass=_.prototype,I.prototype.init=function(e,t){I.superclass.init.call(this,e,t)},I.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().minus(this.rhs.evaluate(e).number())},I.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},A.prototype=new _,A.prototype.constructor=A,A.superclass=_.prototype,A.prototype.init=function(e,t){A.superclass.init.call(this,e,t)},A.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().multiply(this.rhs.evaluate(e).number())},A.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},R.prototype=new _,R.prototype.constructor=R,R.superclass=_.prototype,R.prototype.init=function(e,t){R.superclass.init.call(this,e,t)},R.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().div(this.rhs.evaluate(e).number())},R.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},O.prototype=new _,O.prototype.constructor=O,O.superclass=_.prototype,O.prototype.init=function(e,t){O.superclass.init.call(this,e,t)},O.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().mod(this.rhs.evaluate(e).number())},O.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},D.prototype=new _,D.prototype.constructor=D,D.superclass=_.prototype,D.prototype.init=function(e,t){D.superclass.init.call(this,e,t)},D.prototype.evaluate=function(e){return this.lhs.evaluate(e).nodeset().union(this.rhs.evaluate(e).nodeset())},D.prototype.toString=function(){return i(l,[this.lhs,this.rhs]).join(" | ")},k.prototype=new m,k.prototype.constructor=k,k.superclass=m.prototype,k.prototype.init=function(e,t,r){k.superclass.init.call(this),this.filter=e,this.filterPredicates=t,this.locationPath=r},k.applyPredicates=function(e,t,r){return n(function(e,r){var n=t.extend({contextSize:e.length});return o(function(e,t){return k.predicateMatches(r,n.extend({contextNode:e,contextPosition:t+1}))},e)},r,e)},k.getRoot=function(e,t){var r=t[0];if(9===r.nodeType)return r;if(e.virtualRoot)return e.virtualRoot;var n=r.ownerDocument;if(n)return n;for(var i=r;null!=i.parentNode;)i=i.parentNode;return i},k.applyStep=function(e,t,r){var n=[];switch(t.contextNode=r,e.axis){case N.ANCESTOR:if(t.contextNode===t.virtualRoot)break;for(i=2==t.contextNode.nodeType?k.getOwnerElement(t.contextNode):t.contextNode.parentNode;null!=i&&(e.nodeTest.matches(i,t)&&n.push(i),i!==t.virtualRoot);)i=i.parentNode;break;case N.ANCESTORORSELF:for(var i=t.contextNode;null!=i&&(e.nodeTest.matches(i,t)&&n.push(i),i!==t.virtualRoot);i=2==i.nodeType?k.getOwnerElement(i):i.parentNode);break;case N.ATTRIBUTE:var o=t.contextNode.attributes;if(null!=o)for(var s=0;s<o.length;s++){i=o.item(s);e.nodeTest.matches(i,t)&&n.push(i)}break;case N.CHILD:for(i=t.contextNode.firstChild;null!=i;i=i.nextSibling)e.nodeTest.matches(i,t)&&n.push(i);break;case N.DESCENDANT:for(var a=[t.contextNode.firstChild];a.length>0;)for(i=a.pop();null!=i;)e.nodeTest.matches(i,t)&&n.push(i),null!=i.firstChild?(a.push(i.nextSibling),i=i.firstChild):i=i.nextSibling;break;case N.DESCENDANTORSELF:e.nodeTest.matches(t.contextNode,t)&&n.push(t.contextNode);for(a=[t.contextNode.firstChild];a.length>0;)for(i=a.pop();null!=i;)e.nodeTest.matches(i,t)&&n.push(i),null!=i.firstChild?(a.push(i.nextSibling),i=i.firstChild):i=i.nextSibling;break;case N.FOLLOWING:if(t.contextNode===t.virtualRoot)break;a=[];null!=t.contextNode.firstChild?a.unshift(t.contextNode.firstChild):a.unshift(t.contextNode.nextSibling);for(i=t.contextNode.parentNode;null!=i&&9!=i.nodeType&&i!==t.virtualRoot;i=i.parentNode)a.unshift(i.nextSibling);do{for(i=a.pop();null!=i;)e.nodeTest.matches(i,t)&&n.push(i),null!=i.firstChild?(a.push(i.nextSibling),i=i.firstChild):i=i.nextSibling}while(a.length>0);break;case N.FOLLOWINGSIBLING:if(t.contextNode===t.virtualRoot)break;for(i=t.contextNode.nextSibling;null!=i;i=i.nextSibling)e.nodeTest.matches(i,t)&&n.push(i);break;case N.NAMESPACE:var c={};if(1==t.contextNode.nodeType){c.xml=f.XML_NAMESPACE_URI,c.xmlns=f.XMLNS_NAMESPACE_URI;for(i=t.contextNode;null!=i&&1==i.nodeType;i=i.parentNode)for(s=0;s<i.attributes.length;s++){var l=i.attributes.item(s),u=String(l.name);if("xmlns"==u)void 0==c[""]&&(c[""]=l.value);else if(u.length>6&&"xmlns:"==u.substring(0,6)){void 0==c[d=u.substring(6,u.length)]&&(c[d]=l.value)}}for(var d in c){var h=new W(d,c[d],t.contextNode);e.nodeTest.matches(h,t)&&n.push(h)}}break;case N.PARENT:i=null,t.contextNode!==t.virtualRoot&&(i=2==t.contextNode.nodeType?k.getOwnerElement(t.contextNode):t.contextNode.parentNode),null!=i&&e.nodeTest.matches(i,t)&&n.push(i);break;case N.PRECEDING:a=null!=t.virtualRoot?[t.virtualRoot]:[function(e){for(;e&&e.parentNode;)e=e.parentNode;return e}(t.contextNode)];e:for(;a.length>0;)for(i=a.pop();null!=i;){if(i==t.contextNode)break e;e.nodeTest.matches(i,t)&&n.unshift(i),null!=i.firstChild?(a.push(i.nextSibling),i=i.firstChild):i=i.nextSibling}break;case N.PRECEDINGSIBLING:if(t.contextNode===t.virtualRoot)break;for(i=t.contextNode.previousSibling;null!=i;i=i.previousSibling)e.nodeTest.matches(i,t)&&n.push(i);break;case N.SELF:e.nodeTest.matches(t.contextNode,t)&&n.push(t.contextNode)}return n},k.applySteps=function(e,t,r){return n(function(e,r){return[].concat.apply([],i(function(e){return k.applyPredicates(r.predicates,t,k.applyStep(r,t,e))},e))},r,e)},k.prototype.applyFilter=function(e,t){if(!this.filter)return{nodes:[e.contextNode]};var r=this.filter.evaluate(e);if(!Q.instance_of(r,q)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:r}}return{nodes:k.applyPredicates(this.filterPredicates||[],t,r.toUnsortedArray())}},k.applyLocationPath=function(e,t,r){if(!e)return r;var n=e.absolute?[k.getRoot(t,r)]:r;return k.applySteps(e.steps,t,n)},k.prototype.evaluate=function(e){var t=h(new J,e),r=this.applyFilter(e,t);if("nonNodes"in r)return r.nonNodes;var n=new q;return n.addArray(k.applyLocationPath(this.locationPath,t,r.nodes)),n},k.predicateMatches=function(e,t){var r=e.evaluate(t);return Q.instance_of(r,j)?t.contextPosition==r.numberValue():r.booleanValue()},k.predicateString=s(d("[","]"),l),k.predicatesString=s(u(""),i(k.predicateString)),k.prototype.toString=function(){if(void 0!=this.filter){var e=l(this.filter);return Q.instance_of(this.filter,z)?d("'","'",e):void 0!=this.filterPredicates&&this.filterPredicates.length?d("(",")",e)+k.predicatesString(this.filterPredicates):void 0!=this.locationPath?e+(this.locationPath.absolute?"":"/")+l(this.locationPath):e}return l(this.locationPath)},k.getOwnerElement=function(e){if(e.ownerElement)return e.ownerElement;try{if(e.selectSingleNode)return e.selectSingleNode("..")}catch(e){}for(var t=(9==e.nodeType?e:e.ownerDocument).getElementsByTagName("*"),r=0;r<t.length;r++)for(var n=t.item(r),i=n.attributes,o=0;o<i.length;o++){if(i.item(o)===e)return n}return null},F.prototype=new Object,F.prototype.constructor=F,F.superclass=Object.prototype,F.prototype.init=function(e,t){this.absolute=e,this.steps=t},F.prototype.toString=function(){return(this.absolute?"/":"")+i(l,this.steps).join("/")},N.prototype=new Object,N.prototype.constructor=N,N.superclass=Object.prototype,N.prototype.init=function(e,t,r){this.axis=e,this.nodeTest=t,this.predicates=r},N.prototype.toString=function(){return N.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+k.predicatesString(this.predicates)},N.ANCESTOR=0,N.ANCESTORORSELF=1,N.ATTRIBUTE=2,N.CHILD=3,N.DESCENDANT=4,N.DESCENDANTORSELF=5,N.FOLLOWING=6,N.FOLLOWINGSIBLING=7,N.NAMESPACE=8,N.PARENT=9,N.PRECEDING=10,N.PRECEDINGSIBLING=11,N.SELF=12,N.STEPNAMES=n(function(e,t){return e[t[0]]=t[1],e},{},[[N.ANCESTOR,"ancestor"],[N.ANCESTORORSELF,"ancestor-or-self"],[N.ATTRIBUTE,"attribute"],[N.CHILD,"child"],[N.DESCENDANT,"descendant"],[N.DESCENDANTORSELF,"descendant-or-self"],[N.FOLLOWING,"following"],[N.FOLLOWINGSIBLING,"following-sibling"],[N.NAMESPACE,"namespace"],[N.PARENT,"parent"],[N.PRECEDING,"preceding"],[N.PRECEDINGSIBLING,"preceding-sibling"],[N.SELF,"self"]]),L.prototype=new Object,L.prototype.constructor=L,L.superclass=Object.prototype,L.prototype.init=function(e,t){this.type=e,this.value=t},L.prototype.toString=function(){return"<unknown nodetest type>"},L.prototype.matches=function(e,t){console.warn("unknown node test type")},L.NAMETESTANY=0,L.NAMETESTPREFIXANY=1,L.NAMETESTQNAME=2,L.COMMENT=3,L.TEXT=4,L.PI=5,L.NODE=6,L.isNodeType=function(e){return s(a(e),c("nodeType"))},L.makeNodeTestType=function(e,t,r){var n=r||function(){};for(var i in n.prototype=new L(t.type),n.prototype.constructor=e,t)n.prototype[i]=t[i];return n},L.makeNodeTypeTest=function(e,t,r){return new(L.makeNodeTestType(e,{matches:L.isNodeType(t),toString:(n=r,function(){return n})}));var n},L.hasPrefix=function(e){return e.prefix||-1!==(e.nodeName||e.tagName).indexOf(":")},L.isElementOrAttribute=L.isNodeType([1,2]),L.nameSpaceMatches=function(e,t,r){var n=r.namespaceURI||"";if(!e)return!n||t.allowAnyNamespaceForNoPrefix&&!L.hasPrefix(r);var i=t.namespaceResolver.getNamespace(e,t.expressionContextNode);if(null==i)throw new Error("Cannot resolve QName "+e);return i===n},L.localNameMatches=function(e,t,r){var n=r.localName||r.nodeName;return t.caseInsensitive?e.toLowerCase()===n.toLowerCase():e===n},L.NameTestPrefixAny=L.makeNodeTestType(L.NAMETESTPREFIXANY,{matches:function(e,t){return L.isElementOrAttribute(e)&&L.nameSpaceMatches(this.prefix,t,e)},toString:function(){return this.prefix+":*"}},function(e){this.prefix=e}),L.NameTestQName=L.makeNodeTestType(L.NAMETESTQNAME,{matches:function(e,t){return L.isNodeType([1,2,W.XPATH_NAMESPACE_NODE])(e)&&L.nameSpaceMatches(this.prefix,t,e)&&L.localNameMatches(this.localName,t,e)},toString:function(){return this.name}},function(e){var t=e.split(":");this.name=e,this.prefix=t.length>1?t[0]:null,this.localName=t[t.length>1?1:0]}),L.PITest=L.makeNodeTestType(L.PI,{matches:function(e,t){return L.isNodeType([7])(e)&&(e.target||e.nodeName)===this.name},toString:function(){return d('processing-instruction("','")',this.name)}},function(e){this.name=e}),L.nameTestAny=L.makeNodeTypeTest(L.NAMETESTANY,[1,2,W.XPATH_NAMESPACE_NODE],"*"),L.textTest=L.makeNodeTypeTest(L.TEXT,[3,4],"text()"),L.commentTest=L.makeNodeTypeTest(L.COMMENT,[8],"comment()"),L.nodeTest=L.makeNodeTypeTest(L.NODE,[1,2,3,4,7,8,9],"node()"),L.anyPiTest=L.makeNodeTypeTest(L.PI,[7],"processing-instruction()"),B.prototype=new m,B.prototype.constructor=B,B.superclass=m.prototype,B.prototype.init=function(e){this.variable=e},B.prototype.toString=function(){return"$"+this.variable},B.prototype.evaluate=function(e){var t=Q.resolveQName(this.variable,e.namespaceResolver,e.contextNode,!1);if(null==t[0])throw new Error("Cannot resolve QName "+fn);var r=e.variableResolver.getVariable(t[1],t[0]);if(!r)throw $.fromMessage("Undeclared variable: "+this.toString());return r},V.prototype=new m,V.prototype.constructor=V,V.superclass=m.prototype,V.prototype.init=function(e,t){this.functionName=e,this.arguments=t},V.prototype.toString=function(){for(var e=this.functionName+"(",t=0;t<this.arguments.length;t++)t>0&&(e+=", "),e+=this.arguments[t].toString();return e+")"},V.prototype.evaluate=function(e){var t=Y.getFunctionFromContext(this.functionName,e);if(!t)throw new Error("Unknown function "+this.functionName);var r=[e].concat(this.arguments);return t.apply(e.functionResolver.thisArg,r)};var U=new Object;function z(e){arguments.length>0&&this.init(e)}function j(e){arguments.length>0&&this.init(e)}function G(e){arguments.length>0&&this.init(e)}function H(e){this.init(e)}function q(){this.init()}function W(e,t,r){this.isXPathNamespace=!0,this.ownerDocument=r.ownerDocument,this.nodeName="#namespace",this.prefix=e,this.localName=e,this.namespaceURI=t,this.nodeValue=t,this.ownerElement=r,this.nodeType=W.XPATH_NAMESPACE_NODE}function J(e,t,r){this.variableResolver=null!=e?e:new X,this.namespaceResolver=null!=t?t:new K,this.functionResolver=null!=r?r:new Y}function X(){}function Y(e){this.thisArg=null!=e?e:Z,this.functions=new Object,this.addStandardFunctions()}function K(){}U.equals=function(e,t){return e.equals(t)},U.notequal=function(e,t){return e.notequal(t)},U.lessthan=function(e,t){return e.lessthan(t)},U.greaterthan=function(e,t){return e.greaterthan(t)},U.lessthanorequal=function(e,t){return e.lessthanorequal(t)},U.greaterthanorequal=function(e,t){return e.greaterthanorequal(t)},z.prototype=new m,z.prototype.constructor=z,z.superclass=m.prototype,z.prototype.init=function(e){this.str=String(e)},z.prototype.toString=function(){return this.str},z.prototype.evaluate=function(e){return this},z.prototype.string=function(){return this},z.prototype.number=function(){return new j(this.str)},z.prototype.bool=function(){return new G(this.str)},z.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},z.prototype.stringValue=function(){return this.str},z.prototype.numberValue=function(){return this.number().numberValue()},z.prototype.booleanValue=function(){return this.bool().booleanValue()},z.prototype.equals=function(e){return Q.instance_of(e,G)?this.bool().equals(e):Q.instance_of(e,j)?this.number().equals(e):Q.instance_of(e,q)?e.compareWithString(this,U.equals):new G(this.str==e.str)},z.prototype.notequal=function(e){return Q.instance_of(e,G)?this.bool().notequal(e):Q.instance_of(e,j)?this.number().notequal(e):Q.instance_of(e,q)?e.compareWithString(this,U.notequal):new G(this.str!=e.str)},z.prototype.lessthan=function(e){return this.number().lessthan(e)},z.prototype.greaterthan=function(e){return this.number().greaterthan(e)},z.prototype.lessthanorequal=function(e){return this.number().lessthanorequal(e)},z.prototype.greaterthanorequal=function(e){return this.number().greaterthanorequal(e)},j.prototype=new m,j.prototype.constructor=j,j.superclass=m.prototype,j.prototype.init=function(e){this.num="string"===typeof e?this.parse(e):Number(e)},j.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,j.prototype.parse=function(e){return this.numberFormat.test(e)?parseFloat(e):Number.NaN},j.prototype.toString=function(){var e=this.num.toString();return-1!==e.indexOf("e-")?function(e){for(var t=e.split("e-"),r=t[0].replace(".",""),n=Number(t[1]),i=0;i<n-1;i+=1)r="0"+r;return"0."+r}(e):-1!==e.indexOf("e")?function(e){for(var t=e.split("e"),r=t[0].replace(".",""),n=Number(t[1])+1-r.length,i=0;i<n;i+=1)r+="0";return r}(e):e},j.prototype.evaluate=function(e){return this},j.prototype.string=function(){return new z(this.toString())},j.prototype.number=function(){return this},j.prototype.bool=function(){return new G(this.num)},j.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},j.prototype.stringValue=function(){return this.string().stringValue()},j.prototype.numberValue=function(){return this.num},j.prototype.booleanValue=function(){return this.bool().booleanValue()},j.prototype.negate=function(){return new j(-this.num)},j.prototype.equals=function(e){return Q.instance_of(e,G)?this.bool().equals(e):Q.instance_of(e,z)?this.equals(e.number()):Q.instance_of(e,q)?e.compareWithNumber(this,U.equals):new G(this.num==e.num)},j.prototype.notequal=function(e){return Q.instance_of(e,G)?this.bool().notequal(e):Q.instance_of(e,z)?this.notequal(e.number()):Q.instance_of(e,q)?e.compareWithNumber(this,U.notequal):new G(this.num!=e.num)},j.prototype.lessthan=function(e){return Q.instance_of(e,q)?e.compareWithNumber(this,U.greaterthan):Q.instance_of(e,G)||Q.instance_of(e,z)?this.lessthan(e.number()):new G(this.num<e.num)},j.prototype.greaterthan=function(e){return Q.instance_of(e,q)?e.compareWithNumber(this,U.lessthan):Q.instance_of(e,G)||Q.instance_of(e,z)?this.greaterthan(e.number()):new G(this.num>e.num)},j.prototype.lessthanorequal=function(e){return Q.instance_of(e,q)?e.compareWithNumber(this,U.greaterthanorequal):Q.instance_of(e,G)||Q.instance_of(e,z)?this.lessthanorequal(e.number()):new G(this.num<=e.num)},j.prototype.greaterthanorequal=function(e){return Q.instance_of(e,q)?e.compareWithNumber(this,U.lessthanorequal):Q.instance_of(e,G)||Q.instance_of(e,z)?this.greaterthanorequal(e.number()):new G(this.num>=e.num)},j.prototype.plus=function(e){return new j(this.num+e.num)},j.prototype.minus=function(e){return new j(this.num-e.num)},j.prototype.multiply=function(e){return new j(this.num*e.num)},j.prototype.div=function(e){return new j(this.num/e.num)},j.prototype.mod=function(e){return new j(this.num%e.num)},G.prototype=new m,G.prototype.constructor=G,G.superclass=m.prototype,G.prototype.init=function(e){this.b=Boolean(e)},G.prototype.toString=function(){return this.b.toString()},G.prototype.evaluate=function(e){return this},G.prototype.string=function(){return new z(this.b)},G.prototype.number=function(){return new j(this.b)},G.prototype.bool=function(){return this},G.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},G.prototype.stringValue=function(){return this.string().stringValue()},G.prototype.numberValue=function(){return this.number().numberValue()},G.prototype.booleanValue=function(){return this.b},G.prototype.not=function(){return new G(!this.b)},G.prototype.equals=function(e){return Q.instance_of(e,z)||Q.instance_of(e,j)?this.equals(e.bool()):Q.instance_of(e,q)?e.compareWithBoolean(this,U.equals):new G(this.b==e.b)},G.prototype.notequal=function(e){return Q.instance_of(e,z)||Q.instance_of(e,j)?this.notequal(e.bool()):Q.instance_of(e,q)?e.compareWithBoolean(this,U.notequal):new G(this.b!=e.b)},G.prototype.lessthan=function(e){return this.number().lessthan(e)},G.prototype.greaterthan=function(e){return this.number().greaterthan(e)},G.prototype.lessthanorequal=function(e){return this.number().lessthanorequal(e)},G.prototype.greaterthanorequal=function(e){return this.number().greaterthanorequal(e)},G.true_=new G(!0),G.false_=new G(!1),H.prototype=new Object,H.prototype.constructor=H,H.superclass=Object.prototype,H.prototype.init=function(e){this.left=null,this.right=null,this.node=e,this.depth=1},H.prototype.balance=function(){var e=null==this.left?0:this.left.depth,t=null==this.right?0:this.right.depth;if(e>t+1)(null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL();else if(e+1<t){var r=null==this.right.right?0:this.right.right.depth;(null==this.right.left?0:this.right.left.depth)>r&&this.right.rotateLL(),this.rotateRR()}},H.prototype.rotateLL=function(){var e=this.node,t=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=t,this.right.node=e,this.right.updateInNewLocation(),this.updateInNewLocation()},H.prototype.rotateRR=function(){var e=this.node,t=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=t,this.left.node=e,this.left.updateInNewLocation(),this.updateInNewLocation()},H.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},H.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},H.prototype.add=function(e){if(e===this.node)return!1;var t=function(e,t){if(e===t)return 0;if(e.compareDocumentPosition){var r=e.compareDocumentPosition(t);return 1&r?1:10&r?1:20&r?-1:0}for(var n=0,i=0,o=e;null!=o;o=o.parentNode||o.ownerElement)n++;for(var s=t;null!=s;s=s.parentNode||s.ownerElement)i++;if(n>i){for(;n>i;)e=e.parentNode||e.ownerElement,n--;if(e===t)return 1}else if(i>n){for(;i>n;)t=t.parentNode||t.ownerElement,i--;if(e===t)return-1}for(var a=e.parentNode||e.ownerElement,c=t.parentNode||t.ownerElement;a!==c;)t=c,a=(e=a).parentNode||e.ownerElement,c=t.parentNode||t.ownerElement;var l=Q.isAttribute(e),u=Q.isAttribute(t);if(l&&!u)return-1;if(!l&&u)return 1;if(a)for(var d=l?a.attributes:a.childNodes,h=d.length,p=0;p<h;p+=1){var f=d[p];if(f===e)return-1;if(f===t)return 1}throw new Error("Unexpected: could not determine node order")}(e,this.node),r=!1;return-1==t?null==this.left?(this.left=new H(e),r=!0):(r=this.left.add(e))&&this.balance():1==t&&(null==this.right?(this.right=new H(e),r=!0):(r=this.right.add(e))&&this.balance()),r&&this.getDepthFromChildren(),r},q.prototype=new m,q.prototype.constructor=q,q.superclass=m.prototype,q.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},q.prototype.toString=function(){var e=this.first();return null==e?"":this.stringForNode(e)},q.prototype.evaluate=function(e){return this},q.prototype.string=function(){return new z(this.toString())},q.prototype.stringValue=function(){return this.toString()},q.prototype.number=function(){return new j(this.string())},q.prototype.numberValue=function(){return Number(this.string())},q.prototype.bool=function(){return new G(this.booleanValue())},q.prototype.booleanValue=function(){return!!this.size},q.prototype.nodeset=function(){return this},q.prototype.stringForNode=function(e){return 9==e.nodeType||1==e.nodeType||11===e.nodeType?this.stringForContainerNode(e):2===e.nodeType?e.value||e.nodeValue:e.isNamespaceNode?e.namespace:e.nodeValue},q.prototype.stringForContainerNode=function(e){for(var t="",r=e.firstChild;null!=r;r=r.nextSibling){var n=r.nodeType;1!==n&&3!==n&&4!==n&&9!==n&&11!==n||(t+=this.stringForNode(r))}return t},q.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new H(this.nodes[0]);for(var e=1;e<this.nodes.length;e+=1)this.tree.add(this.nodes[e])}return this.tree},q.prototype.first=function(){var e=this.buildTree();if(null==e)return null;for(;null!=e.left;)e=e.left;return e.node},q.prototype.add=function(e){for(var t=0;t<this.nodes.length;t+=1)if(e===this.nodes[t])return;this.tree=null,this.nodes.push(e),this.size+=1},q.prototype.addArray=function(e){var t=this;r(function(e){t.add(e)},e)},q.prototype.toArray=function(){var e=[];return this.toArrayRec(this.buildTree(),e),e},q.prototype.toArrayRec=function(e,t){null!=e&&(this.toArrayRec(e.left,t),t.push(e.node),this.toArrayRec(e.right,t))},q.prototype.toUnsortedArray=function(){return this.nodes.slice()},q.prototype.compareWithString=function(e,t){for(var r=this.toUnsortedArray(),n=0;n<r.length;n++){var i=r[n],o=t(new z(this.stringForNode(i)),e);if(o.booleanValue())return o}return new G(!1)},q.prototype.compareWithNumber=function(e,t){for(var r=this.toUnsortedArray(),n=0;n<r.length;n++){var i=r[n],o=t(new j(this.stringForNode(i)),e);if(o.booleanValue())return o}return new G(!1)},q.prototype.compareWithBoolean=function(e,t){return t(this.bool(),e)},q.prototype.compareWithNodeSet=function(e,t){for(var r=this.toUnsortedArray(),n=function(e,r){return t(r,e)},i=0;i<r.length;i++){var o=new z(this.stringForNode(r[i])),s=e.compareWithString(o,n);if(s.booleanValue())return s}return new G(!1)},q.compareWith=t(function(e,t){return Q.instance_of(t,z)?this.compareWithString(t,e):Q.instance_of(t,j)?this.compareWithNumber(t,e):Q.instance_of(t,G)?this.compareWithBoolean(t,e):this.compareWithNodeSet(t,e)}),q.prototype.equals=q.compareWith(U.equals),q.prototype.notequal=q.compareWith(U.notequal),q.prototype.lessthan=q.compareWith(U.lessthan),q.prototype.greaterthan=q.compareWith(U.greaterthan),q.prototype.lessthanorequal=q.compareWith(U.lessthanorequal),q.prototype.greaterthanorequal=q.compareWith(U.greaterthanorequal),q.prototype.union=function(e){var t=new q;return t.addArray(this.toUnsortedArray()),t.addArray(e.toUnsortedArray()),t},W.prototype=new Object,W.prototype.constructor=W,W.superclass=Object.prototype,W.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},J.prototype=new Object,J.prototype.constructor=J,J.superclass=Object.prototype,J.prototype.extend=function(e){return h(new J,this,e)},X.prototype=new Object,X.prototype.constructor=X,X.superclass=Object.prototype,X.prototype.getVariable=function(e,t){return null},Y.prototype=new Object,Y.prototype.constructor=Y,Y.superclass=Object.prototype,Y.prototype.addStandardFunctions=function(){this.functions["{}last"]=Z.last,this.functions["{}position"]=Z.position,this.functions["{}count"]=Z.count,this.functions["{}id"]=Z.id,this.functions["{}local-name"]=Z.localName,this.functions["{}namespace-uri"]=Z.namespaceURI,this.functions["{}name"]=Z.name,this.functions["{}string"]=Z.string,this.functions["{}concat"]=Z.concat,this.functions["{}starts-with"]=Z.startsWith,this.functions["{}contains"]=Z.contains,this.functions["{}substring-before"]=Z.substringBefore,this.functions["{}substring-after"]=Z.substringAfter,this.functions["{}substring"]=Z.substring,this.functions["{}string-length"]=Z.stringLength,this.functions["{}normalize-space"]=Z.normalizeSpace,this.functions["{}translate"]=Z.translate,this.functions["{}boolean"]=Z.boolean_,this.functions["{}not"]=Z.not,this.functions["{}true"]=Z.true_,this.functions["{}false"]=Z.false_,this.functions["{}lang"]=Z.lang,this.functions["{}number"]=Z.number,this.functions["{}sum"]=Z.sum,this.functions["{}floor"]=Z.floor,this.functions["{}ceiling"]=Z.ceiling,this.functions["{}round"]=Z.round},Y.prototype.addFunction=function(e,t,r){this.functions["{"+e+"}"+t]=r},Y.getFunctionFromContext=function(e,t){var r=Q.resolveQName(e,t.namespaceResolver,t.contextNode,!1);if(null===r[0])throw new Error("Cannot resolve QName "+name);return t.functionResolver.getFunction(r[1],r[0])},Y.prototype.getFunction=function(e,t){return this.functions["{"+t+"}"+e]},K.prototype=new Object,K.prototype.constructor=K,K.superclass=Object.prototype,K.prototype.getNamespace=function(e,t){if("xml"==e)return f.XML_NAMESPACE_URI;if("xmlns"==e)return f.XMLNS_NAMESPACE_URI;for(9==t.nodeType?t=t.documentElement:2==t.nodeType?t=k.getOwnerElement(t):1!=t.nodeType&&(t=t.parentNode);null!=t&&1==t.nodeType;){for(var r=t.attributes,n=0;n<r.length;n++){var i=r.item(n),o=i.name||i.nodeName;if("xmlns"===o&&""===e||o==="xmlns:"+e)return String(i.value||i.nodeValue)}t=t.parentNode}return null};var Z=new Object;Z.last=function(e){if(1!=arguments.length)throw new Error("Function last expects ()");return new j(e.contextSize)},Z.position=function(e){if(1!=arguments.length)throw new Error("Function position expects ()");return new j(e.contextPosition)},Z.count=function(){var e,t=arguments[0];if(2!=arguments.length||!Q.instance_of(e=arguments[1].evaluate(t),q))throw new Error("Function count expects (node-set)");return new j(e.size)},Z.id=function(){var e,t=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");e=arguments[1].evaluate(t);for(var r=(e=Q.instance_of(e,q)?e.toArray().join(" "):e.stringValue()).split(/[\x0d\x0a\x09\x20]+/),n=new q,i=9==t.contextNode.nodeType?t.contextNode:t.contextNode.ownerDocument,o=0;o<r.length;o++){var s;null!=(s=i.getElementById?i.getElementById(r[o]):Q.getElementById(i,r[o]))&&(n.add(s),0)}return n},Z.localName=function(e,t){var r;if(1==arguments.length)r=e.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");r=t.evaluate(e).first()}return new z(null==r?"":r.localName||r.baseName||r.target||r.nodeName||"")},Z.namespaceURI=function(){var e,t=arguments[0];if(1==arguments.length)e=t.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");e=arguments[1].evaluate(t).first()}return new z(null==e?"":e.namespaceURI)},Z.name=function(){var e,t=arguments[0];if(1==arguments.length)e=t.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");e=arguments[1].evaluate(t).first()}return null==e?new z(""):1==e.nodeType?new z(e.nodeName):2==e.nodeType?new z(e.name||e.nodeName):7===e.nodeType?new z(e.target||e.nodeName):null==e.localName?new z(""):new z(e.localName)},Z.string=function(){var e=arguments[0];if(1==arguments.length)return new z(q.prototype.stringForNode(e.contextNode));if(2==arguments.length)return arguments[1].evaluate(e).string();throw new Error("Function string expects (object?)")},Z.concat=function(e){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var t="",r=1;r<arguments.length;r++)t+=arguments[r].evaluate(e).stringValue();return new z(t)},Z.startsWith=function(){var e=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var t=arguments[1].evaluate(e).stringValue(),r=arguments[2].evaluate(e).stringValue();return new G(t.substring(0,r.length)==r)},Z.contains=function(){var e=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var t=arguments[1].evaluate(e).stringValue(),r=arguments[2].evaluate(e).stringValue();return new G(-1!==t.indexOf(r))},Z.substringBefore=function(){var e=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var t=arguments[1].evaluate(e).stringValue(),r=arguments[2].evaluate(e).stringValue();return new z(t.substring(0,t.indexOf(r)))},Z.substringAfter=function(){var e=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var t=arguments[1].evaluate(e).stringValue(),r=arguments[2].evaluate(e).stringValue();if(0==r.length)return new z(t);var n=t.indexOf(r);return new z(-1==n?"":t.substring(n+r.length))},Z.substring=function(){var e=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var t=arguments[1].evaluate(e).stringValue(),r=Math.round(arguments[2].evaluate(e).numberValue())-1,n=4==arguments.length?r+Math.round(arguments[3].evaluate(e).numberValue()):void 0;return new z(t.substring(r,n))},Z.stringLength=function(){var e,t=arguments[0];if(1==arguments.length)e=q.prototype.stringForNode(t.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");e=arguments[1].evaluate(t).stringValue()}return new j(e.length)},Z.normalizeSpace=function(){var e,t=arguments[0];if(1==arguments.length)e=q.prototype.stringForNode(t.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");e=arguments[1].evaluate(t).stringValue()}for(var r=0,n=e.length-1;Q.isSpace(e.charCodeAt(n));)n--;for(var i="";r<=n&&Q.isSpace(e.charCodeAt(r));)r++;for(;r<=n;)if(Q.isSpace(e.charCodeAt(r)))for(i+=" ";r<=n&&Q.isSpace(e.charCodeAt(r));)r++;else i+=e.charAt(r),r++;return new z(i)},Z.translate=function(e,t,r,o){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var s=t.evaluate(e).stringValue(),a=r.evaluate(e).stringValue(),c=o.evaluate(e).stringValue(),l=n(function(e,t,r){return t in e||(e[t]=r>c.length?"":c[r]),e},{},a);return new z(u("",i(function(e){return e in l?l[e]:e},s)))},Z.boolean_=function(){var e=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(e).bool()},Z.not=function(e,t){if(2!=arguments.length)throw new Error("Function not expects (object)");return t.evaluate(e).bool().not()},Z.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return G.true_},Z.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return G.false_},Z.lang=function(){var e,t=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var r=t.contextNode;null!=r&&9!=r.nodeType;r=r.parentNode){var n=r.getAttributeNS(f.XML_NAMESPACE_URI,"lang");if(null!=n){e=String(n);break}}if(null==e)return G.false_;var i=arguments[1].evaluate(t).stringValue();return new G(e.substring(0,i.length)==i&&(e.length==i.length||"-"==e.charAt(i.length)))},Z.number=function(){var e=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new j(q.prototype.stringForNode(e.contextNode)):arguments[1].evaluate(e).number()},Z.sum=function(){var e,t=arguments[0];if(2!=arguments.length||!Q.instance_of(e=arguments[1].evaluate(t),q))throw new Error("Function sum expects (node-set)");e=e.toUnsortedArray();for(var r=0,n=0;n<e.length;n++)r+=new j(q.prototype.stringForNode(e[n])).numberValue();return new j(r)},Z.floor=function(){var e=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new j(Math.floor(arguments[1].evaluate(e).numberValue()))},Z.ceiling=function(){var e=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new j(Math.ceil(arguments[1].evaluate(e).numberValue()))},Z.round=function(){var e=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new j(Math.round(arguments[1].evaluate(e).numberValue()))};var Q=new Object;Q.isAttribute=function(e){return e&&(2===e.nodeType||e.ownerElement)},Q.splitQName=function(e){var t=e.indexOf(":");return-1==t?[null,e]:[e.substring(0,t),e.substring(t+1)]},Q.resolveQName=function(e,t,r,n){var i=Q.splitQName(e);return null!=i[0]?i[0]=t.getNamespace(i[0],r):n?(i[0]=t.getNamespace("",r),null==i[0]&&(i[0]="")):i[0]="",i},Q.isSpace=function(e){return 9==e||13==e||10==e||32==e},Q.isLetter=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=255||e>=256&&e<=305||e>=308&&e<=318||e>=321&&e<=328||e>=330&&e<=382||e>=384&&e<=451||e>=461&&e<=496||e>=500&&e<=501||e>=506&&e<=535||e>=592&&e<=680||e>=699&&e<=705||902==e||e>=904&&e<=906||908==e||e>=910&&e<=929||e>=931&&e<=974||e>=976&&e<=982||986==e||988==e||990==e||992==e||e>=994&&e<=1011||e>=1025&&e<=1036||e>=1038&&e<=1103||e>=1105&&e<=1116||e>=1118&&e<=1153||e>=1168&&e<=1220||e>=1223&&e<=1224||e>=1227&&e<=1228||e>=1232&&e<=1259||e>=1262&&e<=1269||e>=1272&&e<=1273||e>=1329&&e<=1366||1369==e||e>=1377&&e<=1414||e>=1488&&e<=1514||e>=1520&&e<=1522||e>=1569&&e<=1594||e>=1601&&e<=1610||e>=1649&&e<=1719||e>=1722&&e<=1726||e>=1728&&e<=1742||e>=1744&&e<=1747||1749==e||e>=1765&&e<=1766||e>=2309&&e<=2361||2365==e||e>=2392&&e<=2401||e>=2437&&e<=2444||e>=2447&&e<=2448||e>=2451&&e<=2472||e>=2474&&e<=2480||2482==e||e>=2486&&e<=2489||e>=2524&&e<=2525||e>=2527&&e<=2529||e>=2544&&e<=2545||e>=2565&&e<=2570||e>=2575&&e<=2576||e>=2579&&e<=2600||e>=2602&&e<=2608||e>=2610&&e<=2611||e>=2613&&e<=2614||e>=2616&&e<=2617||e>=2649&&e<=2652||2654==e||e>=2674&&e<=2676||e>=2693&&e<=2699||2701==e||e>=2703&&e<=2705||e>=2707&&e<=2728||e>=2730&&e<=2736||e>=2738&&e<=2739||e>=2741&&e<=2745||2749==e||2784==e||e>=2821&&e<=2828||e>=2831&&e<=2832||e>=2835&&e<=2856||e>=2858&&e<=2864||e>=2866&&e<=2867||e>=2870&&e<=2873||2877==e||e>=2908&&e<=2909||e>=2911&&e<=2913||e>=2949&&e<=2954||e>=2958&&e<=2960||e>=2962&&e<=2965||e>=2969&&e<=2970||2972==e||e>=2974&&e<=2975||e>=2979&&e<=2980||e>=2984&&e<=2986||e>=2990&&e<=2997||e>=2999&&e<=3001||e>=3077&&e<=3084||e>=3086&&e<=3088||e>=3090&&e<=3112||e>=3114&&e<=3123||e>=3125&&e<=3129||e>=3168&&e<=3169||e>=3205&&e<=3212||e>=3214&&e<=3216||e>=3218&&e<=3240||e>=3242&&e<=3251||e>=3253&&e<=3257||3294==e||e>=3296&&e<=3297||e>=3333&&e<=3340||e>=3342&&e<=3344||e>=3346&&e<=3368||e>=3370&&e<=3385||e>=3424&&e<=3425||e>=3585&&e<=3630||3632==e||e>=3634&&e<=3635||e>=3648&&e<=3653||e>=3713&&e<=3714||3716==e||e>=3719&&e<=3720||3722==e||3725==e||e>=3732&&e<=3735||e>=3737&&e<=3743||e>=3745&&e<=3747||3749==e||3751==e||e>=3754&&e<=3755||e>=3757&&e<=3758||3760==e||e>=3762&&e<=3763||3773==e||e>=3776&&e<=3780||e>=3904&&e<=3911||e>=3913&&e<=3945||e>=4256&&e<=4293||e>=4304&&e<=4342||4352==e||e>=4354&&e<=4355||e>=4357&&e<=4359||4361==e||e>=4363&&e<=4364||e>=4366&&e<=4370||4412==e||4414==e||4416==e||4428==e||4430==e||4432==e||e>=4436&&e<=4437||4441==e||e>=4447&&e<=4449||4451==e||4453==e||4455==e||4457==e||e>=4461&&e<=4462||e>=4466&&e<=4467||4469==e||4510==e||4520==e||4523==e||e>=4526&&e<=4527||e>=4535&&e<=4536||4538==e||e>=4540&&e<=4546||4587==e||4592==e||4601==e||e>=7680&&e<=7835||e>=7840&&e<=7929||e>=7936&&e<=7957||e>=7960&&e<=7965||e>=7968&&e<=8005||e>=8008&&e<=8013||e>=8016&&e<=8023||8025==e||8027==e||8029==e||e>=8031&&e<=8061||e>=8064&&e<=8116||e>=8118&&e<=8124||8126==e||e>=8130&&e<=8132||e>=8134&&e<=8140||e>=8144&&e<=8147||e>=8150&&e<=8155||e>=8160&&e<=8172||e>=8178&&e<=8180||e>=8182&&e<=8188||8486==e||e>=8490&&e<=8491||8494==e||e>=8576&&e<=8578||e>=12353&&e<=12436||e>=12449&&e<=12538||e>=12549&&e<=12588||e>=44032&&e<=55203||e>=19968&&e<=40869||12295==e||e>=12321&&e<=12329},Q.isNCNameChar=function(e){return e>=48&&e<=57||e>=1632&&e<=1641||e>=1776&&e<=1785||e>=2406&&e<=2415||e>=2534&&e<=2543||e>=2662&&e<=2671||e>=2790&&e<=2799||e>=2918&&e<=2927||e>=3047&&e<=3055||e>=3174&&e<=3183||e>=3302&&e<=3311||e>=3430&&e<=3439||e>=3664&&e<=3673||e>=3792&&e<=3801||e>=3872&&e<=3881||46==e||45==e||95==e||Q.isLetter(e)||e>=768&&e<=837||e>=864&&e<=865||e>=1155&&e<=1158||e>=1425&&e<=1441||e>=1443&&e<=1465||e>=1467&&e<=1469||1471==e||e>=1473&&e<=1474||1476==e||e>=1611&&e<=1618||1648==e||e>=1750&&e<=1756||e>=1757&&e<=1759||e>=1760&&e<=1764||e>=1767&&e<=1768||e>=1770&&e<=1773||e>=2305&&e<=2307||2364==e||e>=2366&&e<=2380||2381==e||e>=2385&&e<=2388||e>=2402&&e<=2403||e>=2433&&e<=2435||2492==e||2494==e||2495==e||e>=2496&&e<=2500||e>=2503&&e<=2504||e>=2507&&e<=2509||2519==e||e>=2530&&e<=2531||2562==e||2620==e||2622==e||2623==e||e>=2624&&e<=2626||e>=2631&&e<=2632||e>=2635&&e<=2637||e>=2672&&e<=2673||e>=2689&&e<=2691||2748==e||e>=2750&&e<=2757||e>=2759&&e<=2761||e>=2763&&e<=2765||e>=2817&&e<=2819||2876==e||e>=2878&&e<=2883||e>=2887&&e<=2888||e>=2891&&e<=2893||e>=2902&&e<=2903||e>=2946&&e<=2947||e>=3006&&e<=3010||e>=3014&&e<=3016||e>=3018&&e<=3021||3031==e||e>=3073&&e<=3075||e>=3134&&e<=3140||e>=3142&&e<=3144||e>=3146&&e<=3149||e>=3157&&e<=3158||e>=3202&&e<=3203||e>=3262&&e<=3268||e>=3270&&e<=3272||e>=3274&&e<=3277||e>=3285&&e<=3286||e>=3330&&e<=3331||e>=3390&&e<=3395||e>=3398&&e<=3400||e>=3402&&e<=3405||3415==e||3633==e||e>=3636&&e<=3642||e>=3655&&e<=3662||3761==e||e>=3764&&e<=3769||e>=3771&&e<=3772||e>=3784&&e<=3789||e>=3864&&e<=3865||3893==e||3895==e||3897==e||3902==e||3903==e||e>=3953&&e<=3972||e>=3974&&e<=3979||e>=3984&&e<=3989||3991==e||e>=3993&&e<=4013||e>=4017&&e<=4023||4025==e||e>=8400&&e<=8412||8417==e||e>=12330&&e<=12335||12441==e||12442==e||183==e||720==e||721==e||903==e||1600==e||3654==e||3782==e||12293==e||e>=12337&&e<=12341||e>=12445&&e<=12446||e>=12540&&e<=12542},Q.coalesceText=function(e){for(var t=e.firstChild;null!=t;t=t.nextSibling)if(3==t.nodeType||4==t.nodeType){var r=t.nodeValue,n=t;for(t=t.nextSibling;null!=t&&(3==t.nodeType||4==t.nodeType);){r+=t.nodeValue;var i=t;t=t.nextSibling,i.parentNode.removeChild(i)}if(4==n.nodeType){var o=n.parentNode;if(null==n.nextSibling)o.removeChild(n),o.appendChild(o.ownerDocument.createTextNode(r));else{var s=n.nextSibling;o.removeChild(n),o.insertBefore(o.ownerDocument.createTextNode(r),s)}}else n.nodeValue=r;if(null==t)break}else 1==t.nodeType&&Q.coalesceText(t)},Q.instance_of=function(e,t){for(;null!=e;){if(e.constructor===t)return!0;if(e===Object)return!1;e=e.constructor.superclass}return!1},Q.getElementById=function(e,t){if(1==e.nodeType&&(e.getAttribute("id")==t||e.getAttributeNS(null,"id")==t))return e;for(var r=e.firstChild;null!=r;r=r.nextSibling){var n=Q.getElementById(r,t);if(null!=n)return n}return null};var $=function(){function e(t,r,n){var i=Error.call(this,function(t,r){var n=r?": "+r.toString():"";switch(t){case e.INVALID_EXPRESSION_ERR:return"Invalid expression"+n;case e.TYPE_ERR:return"Type error"+n}return null}(t,r)||n);return i.code=t,i.exception=r,i}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e.superclass=Error,e.prototype.toString=function(){return this.message},e.fromMessage=function(t,r){return new e(null,r,t)},e.INVALID_EXPRESSION_ERR=51,e.TYPE_ERR=52,e}();function ee(e,t,r){this.xpath=r.parse(e),this.context=new J,this.context.namespaceResolver=new te(t)}function te(e){this.xpathNSResolver=e}function re(e){this.node=e,this.namespaceResolver=new K}function ne(e,t){switch(t==ne.ANY_TYPE&&(e.constructor===z?t=ne.STRING_TYPE:e.constructor===j?t=ne.NUMBER_TYPE:e.constructor===G?t=ne.BOOLEAN_TYPE:e.constructor===q&&(t=ne.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=t,t){case ne.NUMBER_TYPE:return void(this.numberValue=e.numberValue());case ne.STRING_TYPE:return void(this.stringValue=e.stringValue());case ne.BOOLEAN_TYPE:return void(this.booleanValue=e.booleanValue());case ne.ANY_UNORDERED_NODE_TYPE:case ne.FIRST_ORDERED_NODE_TYPE:if(e.constructor===q)return void(this.singleNodeValue=e.first());break;case ne.UNORDERED_NODE_ITERATOR_TYPE:case ne.ORDERED_NODE_ITERATOR_TYPE:if(e.constructor===q)return this.invalidIteratorState=!1,this.nodes=e.toArray(),void(this.iteratorIndex=0);break;case ne.UNORDERED_NODE_SNAPSHOT_TYPE:case ne.ORDERED_NODE_SNAPSHOT_TYPE:if(e.constructor===q)return this.nodes=e.toArray(),void(this.snapshotLength=this.nodes.length)}throw new $($.TYPE_ERR)}function ie(e,t){e.createExpression=function(e,r){try{return new ee(e,r,t)}catch(e){throw new $($.INVALID_EXPRESSION_ERR,e)}},e.createNSResolver=function(e){return new re(e)},e.evaluate=function(r,n,i,o,s){if(o<0||o>9)throw{code:0,toString:function(){return"Request type not supported"}};return e.createExpression(r,i,t).evaluate(n,o,s)}}ee.prototype={},ee.prototype.constructor=ee,ee.superclass=Object.prototype,ee.getOwnerDocument=function(e){return 9===e.nodeType?e:e.ownerDocument},ee.detectHtmlDom=function(e){if(!e)return!1;var t=ee.getOwnerDocument(e);try{return t.implementation.hasFeature("HTML","2.0")}catch(e){return!0}},ee.prototype.evaluate=function(e,t,r){return this.context.expressionContextNode=e,this.context.caseInsensitive=ee.detectHtmlDom(e),new ne(this.xpath.evaluate(this.context),t)},te.prototype={},te.prototype.constructor=te,te.superclass=Object.prototype,te.prototype.getNamespace=function(e,t){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(e)},re.prototype={},re.prototype.constructor=re,re.superclass=Object.prototype,re.prototype.lookupNamespaceURI=function(e){return this.namespaceResolver.getNamespace(e,this.node)},ne.prototype={},ne.prototype.constructor=ne,ne.superclass=Object.prototype,ne.prototype.iterateNext=function(){if(this.resultType!=ne.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=ne.ORDERED_NODE_ITERATOR_TYPE)throw new $($.TYPE_ERR);return this.nodes[this.iteratorIndex++]},ne.prototype.snapshotItem=function(e){if(this.resultType!=ne.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=ne.ORDERED_NODE_SNAPSHOT_TYPE)throw new $($.TYPE_ERR);return this.nodes[e]},ne.ANY_TYPE=0,ne.NUMBER_TYPE=1,ne.STRING_TYPE=2,ne.BOOLEAN_TYPE=3,ne.UNORDERED_NODE_ITERATOR_TYPE=4,ne.ORDERED_NODE_ITERATOR_TYPE=5,ne.UNORDERED_NODE_SNAPSHOT_TYPE=6,ne.ORDERED_NODE_SNAPSHOT_TYPE=7,ne.ANY_UNORDERED_NODE_TYPE=8,ne.FIRST_ORDERED_NODE_TYPE=9;try{var oe=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(oe=!1)}catch(e){}oe&&ie(document,new p)}catch(e){}ie(e,new p),function(){var t=new p,r=new K,n=new Y,i=new X;function o(e){return{getNamespace:function(t,n){return e(t,n)||r.getNamespace(t,n)}}}function s(e){return e&&"function"===typeof e.getNamespace?o((t=e).getNamespace.bind(t)):"function"===typeof e?o(e):"object"===typeof e?(n=e,o(function(e){return n[e]})):r;var t,n}function a(e){if(null===e||"undefined"===typeof e||e instanceof z||e instanceof G||e instanceof j||e instanceof q)return e;switch(typeof e){case"string":return new z(e);case"boolean":return new G(e);case"number":return new j(e)}var t=new q;return t.addArray([].concat(e)),t}function c(e){return{getFunction:function(t,r){var i=e(t,r);return i?function(e){return function(t){var r=Array.prototype.slice.call(arguments,1).map(function(e){return e.evaluate(t)});return a(e.apply(this,[].concat(t,r)))}}(i):n.getFunction(t,r)}}}function l(e){return e&&"function"===typeof e.getFunction?c((t=e).getFunction.bind(t)):"function"===typeof e?c(e):"object"===typeof e?(r=e,c(function(e){return r[e]})):n;var t,r}function u(e){return{getVariable:function(t,r){return a(e(t,r))}}}function d(e,t,r){e in r&&(t[e]=r[e])}function h(e){var t=new J;return e?(t.namespaceResolver=s(e.namespaces),t.functionResolver=l(e.functions),t.variableResolver=function(e){if(e){if("function"===typeof e.getVariable)return u(e.getVariable.bind(e));if("function"===typeof e)return u(e);if("object"===typeof e)return u(function(t){return e[t]})}return i}(e.variables),t.expressionContextNode=e.node,d("allowAnyNamespaceForNoPrefix",t,e),d("isHtml",t,e)):t.namespaceResolver=r,t}var f={evaluate:function(e){return function(e,t){var r=h(t);return e.evaluate(r)}(this.expression,e)},evaluateNumber:function(e){return this.evaluate(e).numberValue()},evaluateString:function(e){return this.evaluate(e).stringValue()},evaluateBoolean:function(e){return this.evaluate(e).booleanValue()},evaluateNodeSet:function(e){return this.evaluate(e).nodeset()},select:function(e){return this.evaluateNodeSet(e).toArray()},select1:function(e){return this.select(e)[0]}};e.parse=function(e){var r=t.parse(e);return Object.create(f,{expression:{value:r}})}}(),e.XPath=f,e.XPathParser=p,e.XPathResult=ne,e.Step=N,e.NodeTest=L,e.BarOperation=D,e.NamespaceResolver=K,e.FunctionResolver=Y,e.VariableResolver=X,e.Utilities=Q,e.XPathContext=J,e.XNodeSet=q,e.XBoolean=G,e.XString=z,e.XNumber=j,e.select=function(t,r,n){return e.selectWithResolver(t,r,null,n)},e.useNamespaces=function(t){var r={mappings:t||{},lookupNamespaceURI:function(e){return this.mappings[e]}};return function(t,n,i){return e.selectWithResolver(t,n,r,i)}},e.selectWithResolver=function(e,t,r,n){var i=new ee(e,r,new p),o=ne.ANY_TYPE,s=i.evaluate(t,o,null);return s.resultType==ne.STRING_TYPE?s=s.stringValue:s.resultType==ne.NUMBER_TYPE?s=s.numberValue:s.resultType==ne.BOOLEAN_TYPE?s=s.booleanValue:(s=s.nodes,n&&(s=s[0])),s},e.select1=function(t,r){return e.select(t,r,!0)}}(t)},function(e,t,r){function n(e){this.options=e||{locator:{}}}function i(){this.cdata=!1}function o(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function s(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function a(e,t,r){return"string"==typeof e?e.substr(t,r):e.length>=t+r||t?new java.lang.String(e,t,r)+"":e}function c(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}n.prototype.parseFromString=function(e,t){var r=this.options,n=new l,o=r.domBuilder||new i,a=r.errorHandler,c=r.locator,u=r.xmlns||{},d={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return c&&o.setDocumentLocator(c),n.errorHandler=function(e,t,r){if(!e){if(t instanceof i)return t;e=t}var n={},o=e instanceof Function;function a(t){var i=e[t];!i&&o&&(i=2==e.length?function(r){e(t,r)}:e),n[t]=i&&function(e){i("[xmldom "+t+"]\t"+e+s(r))}||function(){}}return r=r||{},a("warning"),a("error"),a("fatalError"),n}(a,o,c),n.domBuilder=r.domBuilder||o,/\/x?html?$/.test(t)&&(d.nbsp="\xa0",d.copy="\xa9",u[""]="http://www.w3.org/1999/xhtml"),u.xml=u.xml||"http://www.w3.org/XML/1998/namespace",e?n.parse(e,u,d):n.errorHandler.error("invalid doc source"),o.doc},i.prototype={startDocument:function(){this.doc=(new u).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,r,n){var i=this.doc,s=i.createElementNS(e,r||t),a=n.length;c(this,s),this.currentElement=s,this.locator&&o(this.locator,s);for(var l=0;l<a;l++){e=n.getURI(l);var u=n.getValue(l),d=(r=n.getQName(l),i.createAttributeNS(e,r));this.locator&&o(n.getLocator(l),d),d.value=d.nodeValue=u,s.setAttributeNode(d)}},endElement:function(e,t,r){var n=this.currentElement;n.tagName;this.currentElement=n.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var r=this.doc.createProcessingInstruction(e,t);this.locator&&o(this.locator,r),c(this,r)},ignorableWhitespace:function(e,t,r){},characters:function(e,t,r){if(e=a.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(e);else n=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(e)&&this.doc.appendChild(n),this.locator&&o(this.locator,n)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,r){e=a.apply(this,arguments);var n=this.doc.createComment(e);this.locator&&o(this.locator,n),c(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var i=n.createDocumentType(e,t,r);this.locator&&o(this.locator,i),c(this,i)}},warning:function(e){console.warn("[xmldom warning]\t"+e,s(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,s(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,s(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){i.prototype[e]=function(){return null}});var l=r(417).XMLReader,u=t.DOMImplementation=r(230).DOMImplementation;t.XMLSerializer=r(230).XMLSerializer,t.DOMParser=n},function(e,t){function r(e,t){for(var r in e)t[r]=e[r]}function n(e,t){var n=e.prototype;if(Object.create){var i=Object.create(t.prototype);n.__proto__=i}if(!(n instanceof t)){function o(){}o.prototype=t.prototype,r(n,o=new o),e.prototype=n=o}n.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),n.constructor=e)}var i="http://www.w3.org/1999/xhtml",o={},s=o.ELEMENT_NODE=1,a=o.ATTRIBUTE_NODE=2,c=o.TEXT_NODE=3,l=o.CDATA_SECTION_NODE=4,u=o.ENTITY_REFERENCE_NODE=5,d=o.ENTITY_NODE=6,h=o.PROCESSING_INSTRUCTION_NODE=7,p=o.COMMENT_NODE=8,f=o.DOCUMENT_NODE=9,g=o.DOCUMENT_TYPE_NODE=10,m=o.DOCUMENT_FRAGMENT_NODE=11,y=o.NOTATION_NODE=12,v={},_={},w=(v.INDEX_SIZE_ERR=(_[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(_[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(_[3]="Hierarchy request error",3)),S=(v.WRONG_DOCUMENT_ERR=(_[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(_[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(_[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(_[7]="No modification allowed",7),v.NOT_FOUND_ERR=(_[8]="Not found",8)),b=(v.NOT_SUPPORTED_ERR=(_[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(_[10]="Attribute in use",10));v.INVALID_STATE_ERR=(_[11]="Invalid state",11),v.SYNTAX_ERR=(_[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(_[13]="Invalid modification",13),v.NAMESPACE_ERR=(_[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(_[15]="Invalid access",15);function x(e,t){if(t instanceof Error)var r=t;else r=this,Error.call(this,_[e]),this.message=_[e],Error.captureStackTrace&&Error.captureStackTrace(this,x);return r.code=e,t&&(this.message=this.message+": "+t),r}function P(){}function C(e,t){this._node=e,this._refresh=t,T(this)}function T(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);re(e,"length",n.length),r(n,e),e._inc=t}}function M(){}function E(e,t){for(var r=e.length;r--;)if(e[r]===t)return r}function I(e,t,r,n){if(n?t[E(t,n)]=r:t[t.length++]=r,e){r.ownerElement=e;var i=e.ownerDocument;i&&(n&&N(i,e,n),function(e,t,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(t._nsMap[r.prefix?r.localName:""]=r.value)}(i,e,r))}}function A(e,t,r){var n=E(t,r);if(!(n>=0))throw x(S,new Error(e.tagName+"@"+r));for(var i=t.length-1;n<i;)t[n]=t[++n];if(t.length=i,e){var o=e.ownerDocument;o&&(N(o,e,r),r.ownerElement=null)}}function R(e){if(this._features={},e)for(var t in e)this._features=e[t]}function O(){}function D(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function k(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(k(e,t))return!0}while(e=e.nextSibling)}function F(){}function N(e,t,r,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete t._nsMap[r.prefix?r.localName:""]}function L(e,t,r){if(e&&e._inc){e._inc++;var n=t.childNodes;if(r)n[n.length++]=r;else{for(var i=t.firstChild,o=0;i;)n[o++]=i,i=i.nextSibling;n.length=o}}}function B(e,t){var r=t.previousSibling,n=t.nextSibling;return r?r.nextSibling=n:e.firstChild=n,n?n.previousSibling=r:e.lastChild=r,L(e.ownerDocument,e),t}function V(e,t,r){var n=t.parentNode;if(n&&n.removeChild(t),t.nodeType===m){var i=t.firstChild;if(null==i)return t;var o=t.lastChild}else i=o=t;var s=r?r.previousSibling:e.lastChild;i.previousSibling=s,o.nextSibling=r,s?s.nextSibling=i:e.firstChild=i,null==r?e.lastChild=o:r.previousSibling=o;do{i.parentNode=e}while(i!==o&&(i=i.nextSibling));return L(e.ownerDocument||e,e),t.nodeType==m&&(t.firstChild=t.lastChild=null),t}function U(){this._nsMap={}}function z(){}function j(){}function G(){}function H(){}function q(){}function W(){}function J(){}function X(){}function Y(){}function K(){}function Z(){}function Q(){}function $(e,t){var r=[],n=9==this.nodeType?this.documentElement:this,i=n.prefix,o=n.namespaceURI;if(o&&null==i&&null==(i=n.lookupPrefix(o)))var s=[{namespace:o,prefix:null}];return te(this,r,e,t,s),r.join("")}function ee(e,t,r){var n=e.prefix||"",i=e.namespaceURI;if(!n&&!i)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var o=r.length;o--;){var s=r[o];if(s.prefix==n)return s.namespace!=i}return!0}function te(e,t,r,n,o){if(n){if(!(e=n(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case s:o||(o=[]);o.length;var d=e.attributes,y=d.length,v=e.firstChild,_=e.tagName;r=i===e.namespaceURI||r,t.push("<",_);for(var w=0;w<y;w++){"xmlns"==(S=d.item(w)).prefix?o.push({prefix:S.localName,namespace:S.value}):"xmlns"==S.nodeName&&o.push({prefix:"",namespace:S.value})}for(w=0;w<y;w++){var S;if(ee(S=d.item(w),0,o)){var b=S.prefix||"",x=S.namespaceURI,P=b?" xmlns:"+b:" xmlns";t.push(P,'="',x,'"'),o.push({prefix:b,namespace:x})}te(S,t,r,n,o)}if(ee(e,0,o)){b=e.prefix||"",x=e.namespaceURI,P=b?" xmlns:"+b:" xmlns";t.push(P,'="',x,'"'),o.push({prefix:b,namespace:x})}if(v||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(_)){if(t.push(">"),r&&/^script$/i.test(_))for(;v;)v.data?t.push(v.data):te(v,t,r,n,o),v=v.nextSibling;else for(;v;)te(v,t,r,n,o),v=v.nextSibling;t.push("</",_,">")}else t.push("/>");return;case f:case m:for(v=e.firstChild;v;)te(v,t,r,n,o),v=v.nextSibling;return;case a:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,D),'"');case c:return t.push(e.data.replace(/[<&]/g,D));case l:return t.push("<![CDATA[",e.data,"]]>");case p:return t.push("\x3c!--",e.data,"--\x3e");case g:var C=e.publicId,T=e.systemId;if(t.push("<!DOCTYPE ",e.name),C)t.push(' PUBLIC "',C),T&&"."!=T&&t.push('" "',T),t.push('">');else if(T&&"."!=T)t.push(' SYSTEM "',T,'">');else{var M=e.internalSubset;M&&t.push(" [",M,"]"),t.push(">")}return;case h:return t.push("<?",e.target," ",e.data,"?>");case u:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function re(e,t,r){e[t]=r}x.prototype=Error.prototype,r(v,x),P.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var r=[],n=0;n<this.length;n++)te(this[n],r,e,t);return r.join("")}},C.prototype.item=function(e){return T(this),this[e]},n(C,P),M.prototype={length:0,item:P.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var r=this[t];if(r.nodeName==e)return r}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new x(b);var r=this.getNamedItem(e.nodeName);return I(this._ownerElement,this,e,r),r},setNamedItemNS:function(e){var t,r=e.ownerElement;if(r&&r!=this._ownerElement)throw new x(b);return t=this.getNamedItemNS(e.namespaceURI,e.localName),I(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return A(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var r=this.getNamedItemNS(e,t);return A(this._ownerElement,this,r),r},getNamedItemNS:function(e,t){for(var r=this.length;r--;){var n=this[r];if(n.localName==t&&n.namespaceURI==e)return n}return null}},R.prototype={hasFeature:function(e,t){var r=this._features[e.toLowerCase()];return!(!r||t&&!(t in r))},createDocument:function(e,t,r){var n=new F;if(n.implementation=this,n.childNodes=new P,n.doctype=r,r&&n.appendChild(r),t){var i=n.createElementNS(e,t);n.appendChild(i)}return n},createDocumentType:function(e,t,r){var n=new W;return n.name=e,n.nodeName=e,n.publicId=t,n.systemId=r,n}},O.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return V(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return B(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return function e(t,r,n){var i=new r.constructor;for(var o in r){var c=r[o];"object"!=typeof c&&c!=i[o]&&(i[o]=c)}r.childNodes&&(i.childNodes=new P);i.ownerDocument=t;switch(i.nodeType){case s:var l=r.attributes,u=i.attributes=new M,d=l.length;u._ownerElement=i;for(var h=0;h<d;h++)i.setAttributeNode(e(t,l.item(h),!0));break;case a:n=!0}if(n)for(var p=r.firstChild;p;)i.appendChild(e(t,p,n)),p=p.nextSibling;return i}(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==c&&e.nodeType==c?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var r=t._nsMap;if(r)for(var n in r)if(r[n]==e)return n;t=t.nodeType==a?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var r=t._nsMap;if(r&&e in r)return r[e];t=t.nodeType==a?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},r(o,O),r(o,O.prototype),F.prototype={nodeName:"#document",nodeType:f,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==m){for(var r=e.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,t),r=n}return e}return null==this.documentElement&&e.nodeType==s&&(this.documentElement=e),V(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),B(this,e)},importNode:function(e,t){return function e(t,r,n){var i;switch(r.nodeType){case s:(i=r.cloneNode(!1)).ownerDocument=t;case m:break;case a:n=!0}i||(i=r.cloneNode(!1));i.ownerDocument=t;i.parentNode=null;if(n)for(var o=r.firstChild;o;)i.appendChild(e(t,o,n)),o=o.nextSibling;return i}(this,e,t)},getElementById:function(e){var t=null;return k(this.documentElement,function(r){if(r.nodeType==s&&r.getAttribute("id")==e)return t=r,!0}),t},createElement:function(e){var t=new U;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new P,(t.attributes=new M)._ownerElement=t,t},createDocumentFragment:function(){var e=new K;return e.ownerDocument=this,e.childNodes=new P,e},createTextNode:function(e){var t=new G;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new H;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new q;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var r=new Z;return r.ownerDocument=this,r.tagName=r.target=e,r.nodeValue=r.data=t,r},createAttribute:function(e){var t=new z;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new Y;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var r=new U,n=t.split(":"),i=r.attributes=new M;return r.childNodes=new P,r.ownerDocument=this,r.nodeName=t,r.tagName=t,r.namespaceURI=e,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,i._ownerElement=r,r},createAttributeNS:function(e,t){var r=new z,n=t.split(":");return r.ownerDocument=this,r.nodeName=t,r.name=t,r.namespaceURI=e,r.specified=!0,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,r}},n(F,O),U.prototype={nodeType:s,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var r=this.ownerDocument.createAttribute(e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===m?this.insertBefore(e,null):function(e,t){var r=t.parentNode;if(r){var n=e.lastChild;r.removeChild(t),n=e.lastChild}return n=e.lastChild,t.parentNode=e,t.previousSibling=n,t.nextSibling=null,n?n.nextSibling=t:e.firstChild=t,e.lastChild=t,L(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);r&&this.removeAttributeNode(r)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);return r&&r.value||""},setAttributeNS:function(e,t,r){var n=this.ownerDocument.createAttributeNS(e,t);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new C(this,function(t){var r=[];return k(t,function(n){n===t||n.nodeType!=s||"*"!==e&&n.tagName!=e||r.push(n)}),r})},getElementsByTagNameNS:function(e,t){return new C(this,function(r){var n=[];return k(r,function(i){i===r||i.nodeType!==s||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||n.push(i)}),n})}},F.prototype.getElementsByTagName=U.prototype.getElementsByTagName,F.prototype.getElementsByTagNameNS=U.prototype.getElementsByTagNameNS,n(U,O),z.prototype.nodeType=a,n(z,O),j.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(_[w])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,r){r=this.data.substring(0,e)+r+this.data.substring(e+t),this.nodeValue=this.data=r,this.length=r.length}},n(j,O),G.prototype={nodeName:"#text",nodeType:c,splitText:function(e){var t=this.data,r=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},n(G,j),H.prototype={nodeName:"#comment",nodeType:p},n(H,j),q.prototype={nodeName:"#cdata-section",nodeType:l},n(q,j),W.prototype.nodeType=g,n(W,O),J.prototype.nodeType=y,n(J,O),X.prototype.nodeType=d,n(X,O),Y.prototype.nodeType=u,n(Y,O),K.prototype.nodeName="#document-fragment",K.prototype.nodeType=m,n(K,O),Z.prototype.nodeType=h,n(Z,O),Q.prototype.serializeToString=function(e,t,r){return $.call(e,t,r)},O.prototype.toString=$;try{if(Object.defineProperty){Object.defineProperty(C.prototype,"length",{get:function(){return T(this),this.$$length}}),Object.defineProperty(O.prototype,"textContent",{get:function(){return function e(t){switch(t.nodeType){case s:case m:var r=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&r.push(e(t)),t=t.nextSibling;return r.join("");default:return t.nodeValue}}(this)},set:function(e){switch(this.nodeType){case s:case m:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),re=function(e,t,r){e["$$"+t]=r}}}catch(e){}t.DOMImplementation=R,t.XMLSerializer=Q},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class UserInfo{constructor(e,t,r,n,i){this.id=e,this.email=t,this.profile=r,this.organization=n,this.featureTracking=i}static fromJson(e){const t=e.sub,r=e.email?{id:e.email,isVerified:e.email_verified}:void 0,n=e.name?{name:e.name,preferredUserName:e.preferred_username,firstName:e.given_name,lastName:e.family_name}:void 0,i=e.org?{id:e.org,name:e.org_name}:void 0,o=e.feature_tracking?{ultimateSite:e.ultimate_site,usageCountryIso:e.usage_country_iso}:void 0;return new UserInfo(t,r,n,i,o)}}t.UserInfo=UserInfo},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(97),i=r(18),o=r(119),s=r(420),a=r(437),c=r(56);class DefaultIModelHubRequestOptionsProvider extends n.DefaultWsgRequestOptionsProvider{constructor(e){super(),this._defaultOptions.errorCallback=i.IModelHubError.parse,this._defaultOptions.retryCallback=i.IModelHubError.shouldRetry,this._defaultOptions.agent=e}}class IModelBaseHandler extends n.WsgClient{constructor(e=3e4,t){super("sv1.1"),this._customRequestOptions=new a.CustomRequestOptions,this._fileHandler=t,"undefined"!==typeof window&&(this._agent=new s.Agent({keepAlive:e>0,keepAliveMsecs:e,secureProtocol:"TLSv1_2_method"}))}formatProjectIdForUrl(e){return e}getFileHandler(){return this._fileHandler}async setupOptionDefaults(e){return this._defaultIModelHubOptionsProvider||(this._defaultIModelHubOptionsProvider=new DefaultIModelHubRequestOptionsProvider(this._agent)),this._defaultIModelHubOptionsProvider.assignOptions(e)}getUrlSearchKey(){return IModelBaseHandler.searchKey}getRelyingPartyUrl(){if(c.Config.App.has(IModelBaseHandler.configRelyingPartyUri))return c.Config.App.get(IModelBaseHandler.configRelyingPartyUri)+"/";if(c.Config.App.getBoolean(n.WsgClient.configUseHostRelyingPartyUriAsFallback,!0)&&c.Config.App.has(n.WsgClient.configHostRelyingPartyUri))return c.Config.App.get(n.WsgClient.configHostRelyingPartyUri)+"/";throw new Error(`RelyingPartyUrl not set. Set it in Config.App using key ${IModelBaseHandler.configRelyingPartyUri}`)}getAgent(){return this._agent}getUrl(e){return super.getUrl(e)}async getAccessToken(e,t){return(new o.ImsDelegationSecureTokenClient).getToken(e,t,this.getRelyingPartyUrl())}delete(e,t,r){return super.delete(e,t,r)}deleteInstance(e,t,r,n,i){return this._customRequestOptions.isSet&&(i||(i={}),i.CustomOptions=this._customRequestOptions.insertCustomOptions(i.CustomOptions)),super.deleteInstance(e,t,r,n,i)}postInstance(e,t,r,n,i,o){return this._customRequestOptions.isSet&&(o||(o={}),o.CustomOptions=this._customRequestOptions.insertCustomOptions(o.CustomOptions)),super.postInstance(e,t,r,n,i,o)}postInstances(e,t,r,n,i,o){return super.postInstances(e,t,r,n,i,o)}getInstances(e,t,r,n,i){return super.getInstances(e,t,r,n,i)}postQuery(e,t,r,n,i){return super.postQuery(e,t,r,n,i)}getCustomRequestOptions(){return this._customRequestOptions}}IModelBaseHandler.searchKey="iModelHubApi",IModelBaseHandler.configRelyingPartyUri="imjs_imodelhub_relying_party_uri",t.IModelBaseHandler=IModelBaseHandler},function(e,t,r){(function(e){t.fetch=a(e.fetch)&&a(e.ReadableStream),t.writableStream=a(e.WritableStream),t.abortController=a(e.AbortController),t.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),t.blobConstructor=!0}catch(e){}var r;function n(){if(void 0!==r)return r;if(e.XMLHttpRequest){r=new e.XMLHttpRequest;try{r.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(e){r=null}}else r=null;return r}function i(e){var t=n();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(e){}return!1}var o="undefined"!==typeof e.ArrayBuffer,s=o&&a(e.ArrayBuffer.prototype.slice);function a(e){return"function"===typeof e}t.arraybuffer=t.fetch||o&&i("arraybuffer"),t.msstream=!t.fetch&&s&&i("ms-stream"),t.mozchunkedarraybuffer=!t.fetch&&o&&i("moz-chunked-arraybuffer"),t.overrideMimeType=t.fetch||!!n()&&a(n().overrideMimeType),t.vbArray=a(e.VBArray),r=null}).call(this,r(12))},function(e,t,r){(function(e,n,i){var o=r(233),s=r(71),a=r(235),c=t.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},l=t.IncomingMessage=function(t,r,s,c){var l=this;if(a.Readable.call(l),l._mode=s,l.headers={},l.rawHeaders=[],l.trailers={},l.rawTrailers=[],l.on("end",function(){e.nextTick(function(){l.emit("close")})}),"fetch"===s){if(l._fetchResponse=r,l.url=r.url,l.statusCode=r.status,l.statusMessage=r.statusText,r.headers.forEach(function(e,t){l.headers[t.toLowerCase()]=e,l.rawHeaders.push(t,e)}),o.writableStream){var u=new WritableStream({write:function(e){return new Promise(function(t,r){l._destroyed?r():l.push(new n(e))?t():l._resumeFetch=t})},close:function(){i.clearTimeout(c),l._destroyed||l.push(null)},abort:function(e){l._destroyed||l.emit("error",e)}});try{return void r.body.pipeTo(u).catch(function(e){i.clearTimeout(c),l._destroyed||l.emit("error",e)})}catch(e){}}var d=r.body.getReader();!function e(){d.read().then(function(t){if(!l._destroyed){if(t.done)return i.clearTimeout(c),void l.push(null);l.push(new n(t.value)),e()}}).catch(function(e){i.clearTimeout(c),l._destroyed||l.emit("error",e)})}()}else{if(l._xhr=t,l._pos=0,l.url=t.responseURL,l.statusCode=t.status,l.statusMessage=t.statusText,t.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var r=t[1].toLowerCase();"set-cookie"===r?(void 0===l.headers[r]&&(l.headers[r]=[]),l.headers[r].push(t[2])):void 0!==l.headers[r]?l.headers[r]+=", "+t[2]:l.headers[r]=t[2],l.rawHeaders.push(t[1],t[2])}}),l._charset="x-user-defined",!o.overrideMimeType){var h=l.rawHeaders["mime-type"];if(h){var p=h.match(/;\s*charset=([^;])(;|$)/);p&&(l._charset=p[1].toLowerCase())}l._charset||(l._charset="utf-8")}}};s(l,a.Readable),l.prototype._read=function(){var e=this._resumeFetch;e&&(this._resumeFetch=null,e())},l.prototype._onXHRProgress=function(){var e=this,t=e._xhr,r=null;switch(e._mode){case"text:vbarray":if(t.readyState!==c.DONE)break;try{r=new i.VBArray(t.responseBody).toArray()}catch(e){}if(null!==r){e.push(new n(r));break}case"text":try{r=t.responseText}catch(t){e._mode="text:vbarray";break}if(r.length>e._pos){var o=r.substr(e._pos);if("x-user-defined"===e._charset){for(var s=new n(o.length),a=0;a<o.length;a++)s[a]=255&o.charCodeAt(a);e.push(s)}else e.push(o,e._charset);e._pos=r.length}break;case"arraybuffer":if(t.readyState!==c.DONE||!t.response)break;r=t.response,e.push(new n(new Uint8Array(r)));break;case"moz-chunked-arraybuffer":if(r=t.response,t.readyState!==c.LOADING||!r)break;e.push(new n(new Uint8Array(r)));break;case"ms-stream":if(r=t.response,t.readyState!==c.LOADING)break;var l=new i.MSStreamReader;l.onprogress=function(){l.result.byteLength>e._pos&&(e.push(new n(new Uint8Array(l.result.slice(e._pos)))),e._pos=l.result.byteLength)},l.onload=function(){e.push(null)},l.readAsArrayBuffer(r)}e._xhr.readyState===c.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(this,r(48),r(36).Buffer,r(12))},function(e,t,r){(t=e.exports=r(236)).Stream=t,t.Readable=t,t.Writable=r(240),t.Duplex=r(82),t.Transform=r(242),t.PassThrough=r(428)},function(e,t,r){"use strict";(function(t,n){var i=r(121);e.exports=_;var o,s=r(227);_.ReadableState=v;r(237).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=r(238),l=r(122).Buffer,u=t.Uint8Array||function(){};var d=r(98);d.inherits=r(71);var h=r(423),p=void 0;p=h&&h.debuglog?h.debuglog("stream"):function(){};var f,g=r(424),m=r(239);d.inherits(_,c);var y=["error","close","destroy","pause","resume"];function v(e,t){o=o||r(82),e=e||{};var n=t instanceof o;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(f||(f=r(163).StringDecoder),this.decoder=new f(e.encoding),this.encoding=e.encoding)}function _(e){if(o=o||r(82),!(this instanceof _))return new _(e);this._readableState=new v(e,this),this.readable=!0,e&&("function"===typeof e.read&&(this._read=e.read),"function"===typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function w(e,t,r,n,i){var o,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,P(e)}(e,s)):(i||(o=function(e,t){var r;n=t,l.isBuffer(n)||n instanceof u||"string"===typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"===typeof t||s.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),n?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):S(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?S(e,s,t,!1):T(e,s)):S(e,s,t,!1))):n||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function S(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&P(e)),T(e,t)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=m.destroy,_.prototype._undestroy=m.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"===typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=l.from(e,t),t=""),r=!0),w(this,e,t,!1,r)},_.prototype.unshift=function(e){return w(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return f||(f=r(163).StringDecoder),this._readableState.decoder=new f(e),this._readableState.encoding=e,this};var b=8388608;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=b?e=b:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(p("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(C,e):C(e))}function C(e){p("emit readable"),e.emit("readable"),A(e)}function T(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(M,e,t))}function M(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(p("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function E(e){p("readable nexttick read 0"),e.read(0)}function I(e,t){t.reading||(p("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(p("flow",t.flowing);t.flowing&&null!==e.read(););}function R(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=l.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,s),0===(e-=s)){s===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function O(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(D,t,e))}function D(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function k(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}_.prototype.read=function(e){p("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return p("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?O(this):P(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&O(this),null;var n,i=t.needReadable;return p("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&p("length less than watermark",i=!0),t.ended||t.reading?p("reading or ended",i=!1):i&&(p("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(r,t))),null===(n=e>0?R(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&O(this)),null!==n&&this.emit("data",n),n},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,p("pipe count=%d opts=%j",o.pipesCount,t);var c=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?u:_;function l(t,n){p("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,p("cleanup"),e.removeListener("close",y),e.removeListener("finish",v),e.removeListener("drain",d),e.removeListener("error",m),e.removeListener("unpipe",l),r.removeListener("end",u),r.removeListener("end",_),r.removeListener("data",g),h=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||d())}function u(){p("onend"),e.end()}o.endEmitted?i.nextTick(c):r.once("end",c),e.on("unpipe",l);var d=function(e){return function(){var t=e._readableState;p("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,A(e))}}(r);e.on("drain",d);var h=!1;var f=!1;function g(t){p("ondata"),f=!1,!1!==e.write(t)||f||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==k(o.pipes,e))&&!h&&(p("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,f=!0),r.pause())}function m(t){p("onerror",t),_(),e.removeListener("error",m),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",v),_()}function v(){p("onfinish"),e.removeListener("close",y),_()}function _(){p("unpipe"),r.unpipe(e)}return r.on("data",g),function(e,t,r){if("function"===typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",m),e.once("close",y),e.once("finish",v),e.emit("pipe",r),o.flowing||(p("pipe resume"),r.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var s=k(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},_.prototype.on=function(e,t){var r=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&P(this):i.nextTick(E,this))}return r},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(p("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(I,e,t))}(this,e)),this},_.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(p("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){(p("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&void 0!==i)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())))}),e)void 0===this[i]&&"function"===typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<y.length;o++)e.on(y[o],this.emit.bind(this,y[o]));return this._read=function(t){p("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=R}).call(this,r(12),r(48))},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"===typeof e}function i(e){return"object"===typeof e&&null!==e}function o(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,s,a,c,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(o(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(i(r))for(a=Array.prototype.slice.call(arguments,1),s=(l=r.slice()).length,c=0;c<s;c++)l[c].apply(this,a);return!0},r.prototype.addListener=function(e,t){var s;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(s=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var r,o,s,a;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,o=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(a=s;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){o=a;break}if(o<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){e.exports=r(237).EventEmitter},function(e,t,r){"use strict";var n=r(121);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,r){"use strict";(function(t,n,i){var o=r(121);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=v;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?n:o.nextTick;v.WritableState=y;var l=r(98);l.inherits=r(71);var u={deprecate:r(427)},d=r(238),h=r(122).Buffer,p=i.Uint8Array||function(){};var f,g=r(239);function m(){}function y(e,t){a=a||r(82),e=e||{};var n=t instanceof a;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,l=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(l||0===l)?l:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===e.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(o.nextTick(i,n),o.nextTick(P,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),P(e,t))}(e,r,n,t,i);else{var s=b(r);s||r.corked||r.bufferProcessing||!r.bufferedRequest||S(e,r),n?c(w,e,r,s,i):w(e,r,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function v(e){if(a=a||r(82),!f.call(v,this)&&!(this instanceof a))return new v(e);this._writableState=new y(e,this),this.writable=!0,e&&("function"===typeof e.write&&(this._write=e.write),"function"===typeof e.writev&&(this._writev=e.writev),"function"===typeof e.destroy&&(this._destroy=e.destroy),"function"===typeof e.final&&(this._final=e.final)),d.call(this)}function _(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function w(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),P(e,t)}function S(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0,c=!0;r;)i[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;i.allBuffers=c,_(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,d=r.callback;if(_(e,t,!1,t.objectMode?1:l.length,l,u,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function b(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function x(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),P(e,t)})}function P(e,t){var r=b(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"===typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(x,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}l.inherits(v,d),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(y.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"===typeof Symbol&&Symbol.hasInstance&&"function"===typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===v&&(e&&e._writableState instanceof y)}})):f=function(e){return e instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(e,t,r){var n,i=this._writableState,s=!1,a=!i.objectMode&&(n=e,h.isBuffer(n)||n instanceof p);return a&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"===typeof t&&(r=t,t=null),a?t="buffer":t||(t=i.defaultEncoding),"function"!==typeof r&&(r=m),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),o.nextTick(t,r)}(this,r):(a||function(e,t,r,n){var i=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"===typeof r||void 0===r||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(n,s),i=!1),i}(this,i,e,r))&&(i.pendingcb++,s=function(e,t,r,n,i,o){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!==typeof t||(t=h.from(t,r));return t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,a,n,i,o);return c}(this,i,a,e,t,r)),s},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||S(this,e))},v.prototype.setDefaultEncoding=function(e){if("string"===typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(e,t,r){var n=this._writableState;"function"===typeof e?(r=e,e=null,t=null):"function"===typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,P(e,t),r&&(t.finished?o.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,r(48),r(241).setImmediate,r(12))},function(e,t,r){(function(e){var n="undefined"!==typeof e&&e||"undefined"!==typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(426),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(12))},function(e,t,r){"use strict";e.exports=o;var n=r(82),i=r(98);function o(e){if(!(this instanceof o))return new o(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"===typeof e.transform&&(this._transform=e.transform),"function"===typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"===typeof this._flush?this._flush(function(t,r){a(e,t,r)}):a(this,null,null)}function a(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=r(71),i.inherits(o,n),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(70),o=r(17),s=r(29),a=r(0),c=r(18),l=r(57),u=r(120),d="imodeljs-clients.imodelhub";!function(e){e[e.Available=0]="Available",e[e.Reserved=1]="Reserved",e[e.Used=2]="Used",e[e.Retired=3]="Retired"}(t.CodeState||(t.CodeState={}));class CodeBase extends o.WsgInstance{}n([o.ECJsonTypeMap.propertyToJson("wsg","properties.CodeSpecId")],CodeBase.prototype,"codeSpecId",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.CodeScope")],CodeBase.prototype,"codeScope",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.State")],CodeBase.prototype,"state",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.CreatedDate")],CodeBase.prototype,"createdDate",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.BriefcaseId")],CodeBase.prototype,"briefcaseId",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.QueryOnly")],CodeBase.prototype,"queryOnly",void 0),t.CodeBase=CodeBase;let h=class HubCode extends CodeBase{};n([o.ECJsonTypeMap.propertyToJson("wsg","properties.Value")],h.prototype,"value",void 0),h=n([o.ECJsonTypeMap.classToJson("wsg","iModelScope.Code",{schemaPropertyName:"schemaName",classPropertyName:"className"})],h),t.HubCode=h;let p=class MultiCode extends CodeBase{};function f(e){return encodeURIComponent(e.replace("-","_0x2D_")).replace("~","~7E").replace("*","~2A").replace("%","~")}function g(e){if(e&&e.codeSpecId&&e.codeScope&&e.value)return`'${e.codeSpecId}-${f(e.codeScope)}-${f(e.value)}'`}n([o.ECJsonTypeMap.propertyToJson("wsg","properties.Values")],p.prototype,"values",void 0),p=n([o.ECJsonTypeMap.classToJson("wsg","iModelScope.MultiCode",{schemaPropertyName:"schemaName",classPropertyName:"className"})],p),t.MultiCode=p;class DefaultCodeUpdateOptionsProvider{constructor(){this._defaultOptions={codesPerRequest:2e3}}async assignOptions(e){const t=Object.assign({},e);return i(e,this._defaultOptions),i(e,t),Promise.resolve()}}t.DefaultCodeUpdateOptionsProvider=DefaultCodeUpdateOptionsProvider;class ConflictingCodesError extends u.IModelHubError{static fromError(e){if(e.errorNumber!==a.IModelHubStatus.CodeReservedByAnotherBriefcase&&e.errorNumber!==a.IModelHubStatus.ConflictsAggregate)return;const t=new ConflictingCodesError(e.errorNumber);return i(t,e),t.addCodes(e),t}addCodes(e){if(e.data&&e.data.ConflictingCodes){this.conflictingCodes||(this.conflictingCodes=[]);for(const t of e.data.ConflictingCodes){const e={className:"Code",schemaName:"iModelScope",properties:t},r=o.ECJsonTypeMap.fromJson(h,"wsg",e);r&&this.conflictingCodes.push(r)}}}}t.ConflictingCodesError=ConflictingCodesError;class CodeQuery extends l.Query{constructor(){super(...arguments),this._isMultiCodeQuery=!0}get isMultiCodeQuery(){return this._isMultiCodeQuery}byBriefcaseId(e){return c.ArgumentCheck.validBriefcaseId("briefcaseId",e),this.addFilter(`BriefcaseId+eq+${e}`),this}byCodeSpecId(e){return c.ArgumentCheck.defined("codeSpecId",e),this.addFilter(`CodeSpecId+eq+'${e}'`),this}byCodeScope(e){return c.ArgumentCheck.defined("codeScope",e),this.addFilter(`CodeScope+eq+'${e}'`),this}byCodes(e){if(c.ArgumentCheck.nonEmptyArray("codes",e),this._isMultiCodeQuery=!1,e.length<1)throw u.IModelHubClientError.invalidArgument("codes");let t="$id+in+[",r=0;for(const n of e){const e=g(n);c.ArgumentCheck.valid(`codes[${r}]`,e),0!==r++&&(t+=","),t+=e}return t+="]",this.addFilter(t),this}top(e){return this._isMultiCodeQuery=!1,super.top(e)}unavailableCodes(e){c.ArgumentCheck.validBriefcaseId("briefcaseId",e);const t=`BriefcaseId+ne+${e}`;return this.addFilter(t),this}}t.CodeQuery=CodeQuery,function(e){e[e.LargestUsed=0]="LargestUsed",e[e.NextAvailable=1]="NextAvailable"}(t.CodeSequenceType||(t.CodeSequenceType={}));let m=class CodeSequence extends o.WsgInstance{};n([o.ECJsonTypeMap.propertyToJson("wsg","properties.CodeSpecId")],m.prototype,"codeSpecId",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.CodeScope")],m.prototype,"codeScope",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.ValuePattern")],m.prototype,"valuePattern",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.Value")],m.prototype,"value",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.StartIndex")],m.prototype,"startIndex",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.IncrementBy")],m.prototype,"incrementBy",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.Type")],m.prototype,"type",void 0),m=n([o.ECJsonTypeMap.classToJson("wsg","iModelScope.CodeSequence",{schemaPropertyName:"schemaName",classPropertyName:"className"})],m),t.CodeSequence=m;class CodeSequenceHandler{constructor(e){this._handler=e}getRelativeUrl(e){return`/Repositories/iModel--${e}/iModelScope/CodeSequence/`}async get(e,t,r,n){e.enter(),a.Logger.logInfo(d,`Querying code sequence for iModel ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("imodelId",r);const i=await this._handler.postInstance(e,m,t,this.getRelativeUrl(r),n);return e.enter(),a.Logger.logTrace(d,`Queried code sequence for iModel ${r}`),i.value}}t.CodeSequenceHandler=CodeSequenceHandler;class CodeHandler{constructor(e){this._handler=e}Sequences(){return new CodeSequenceHandler(this._handler)}getRelativeUrl(e,t=!0,r){return`/Repositories/iModel--${e}/iModelScope/${t?"MultiCode":"Code"}/${r||""}`}static convertCodesToMultiCodes(e){const t=new Map;for(const r of e){const e=`${r.codeScope}-${r.codeSpecId}-${r.state}`;if(t.has(e))t.get(e).values.push(r.value);else{const n=new p;n.changeState="new",n.briefcaseId=r.briefcaseId,n.codeScope=r.codeScope,n.codeSpecId=r.codeSpecId,n.state=r.state,n.values=[r.value],t.set(e,n)}}return Array.from(t.values())}static convertMultiCodesToCodes(e){const t=[];for(const r of e)for(const e of r.values){const n=new h;n.briefcaseId=r.briefcaseId,n.codeScope=r.codeScope,n.codeSpecId=r.codeSpecId,n.state=r.state,n.value=e,t.push(n)}return t}async setupOptionDefaults(e){return CodeHandler._defaultUpdateOptionsProvider||(CodeHandler._defaultUpdateOptionsProvider=new DefaultCodeUpdateOptionsProvider),CodeHandler._defaultUpdateOptionsProvider.assignOptions(e)}async updateInternal(e,t,r,n,i){let o;e.enter(),i&&((o={}).CustomOptions={},!1===i.deniedCodes&&(o.CustomOptions.DetailedError_Codes="false"),i.unlimitedReporting&&(o.CustomOptions.DetailedError_MaximumInstances="-1"),i.continueOnConflict&&(o.CustomOptions.ConflictStrategy="Continue"),0===Object.getOwnPropertyNames(o.CustomOptions).length&&(o=void 0));const s=await this._handler.postInstances(e,p,t,`/Repositories/iModel--${r}/$changeset`,CodeHandler.convertCodesToMultiCodes(n),o);return CodeHandler.convertMultiCodesToCodes(s)}async update(e,t,r,n,i){e.enter(),a.Logger.logInfo(d,`Requesting codes for iModel ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("imodelId",r),c.ArgumentCheck.nonEmptyArray("codes",n),i=i||{},this.setupOptionDefaults(i);const o=[];let l;const h=new u.AggregateResponseError;for(let c=0;c<n.length;c+=i.codesPerRequest){const d=n.slice(c,c+i.codesPerRequest);try{o.push(...await this.updateInternal(e,t,r,d,i)),e.enter()}catch(t){if(e.enter(),t instanceof s.ResponseError)if(i&&i.deniedCodes&&t instanceof u.IModelHubError&&(t.errorNumber===a.IModelHubStatus.CodeReservedByAnotherBriefcase||t.errorNumber===a.IModelHubStatus.ConflictsAggregate)){if(l?l.addCodes(t):l=ConflictingCodesError.fromError(t),!i.continueOnConflict)return Promise.reject(l)}else h.errors.push(t)}}return l?Promise.reject(l):h.errors.length>0?Promise.reject(h.errors.length>1?h:h.errors[0]):(a.Logger.logTrace(d,`Requested ${n.length} codes for iModel ${r}`),o)}async get(e,t,r,n=new CodeQuery){let i;if(e.enter(),a.Logger.logInfo(d,`Querying codes for iModel ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("imodelId",r),n.isMultiCodeQuery){const o=await this._handler.getInstances(e,p,t,this.getRelativeUrl(r),n.getQueryOptions());e.enter(),i=CodeHandler.convertMultiCodesToCodes(o)}else i=await this._handler.postQuery(e,h,t,this.getRelativeUrl(r,!1),n.getQueryOptions()),e.enter();return a.Logger.logTrace(d,`Queried ${i.length} codes for iModel ${r}`),i}async deleteAll(e,t,r,n){e.enter(),a.Logger.logInfo(d,`Deleting all codes from briefcase ${n} in iModel ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("imodelId",r),c.ArgumentCheck.validBriefcaseId("briefcaseId",n),await this._handler.delete(e,t,this.getRelativeUrl(r,!1,`DiscardReservedCodes-${n}`)),a.Logger.logTrace(d,`Deleted all codes from briefcase ${n} in iModel ${r}`)}}t.CodeHandler=CodeHandler},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(29),o=r(81),s=r(17),a=r(0);class BaseEventSAS extends s.WsgInstance{}n([s.ECJsonTypeMap.propertyToJson("wsg","properties.BaseAddress")],BaseEventSAS.prototype,"baseAddress",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.EventServiceSASToken")],BaseEventSAS.prototype,"sasToken",void 0),t.BaseEventSAS=BaseEventSAS;var c;function l(e,t,r,n){const i={method:t,headers:{authorization:r},agent:e.getAgent(),retries:0};return n&&(i.timeout=1500*n),(new o.DefaultRequestOptionsProvider).assignOptions(i),i}t.IModelHubBaseEvent=class IModelHubBaseEvent{constructor(e,t){this._handler=e,this._sasToken=t}fromJson(e){this.eventTopic=e.EventTopic,this.fromEventSubscriptionId=e.FromEventSubscriptionId,this.toEventSubscriptionId=e.ToEventSubscriptionId,this._lockUrl=e.location}async delete(e){if(this._handler&&this._lockUrl&&this._sasToken){const t=l(this._handler,c.Delete,this._sasToken);if(200===(await i.request(e,this._lockUrl,t)).status)return Promise.resolve(!0)}return Promise.resolve(!1)}},function(e){e.Delete="DELETE"}(c=t.ModifyEventOperationToRequestType||(t.ModifyEventOperationToRequestType={})),function(e){e.GetDestructive="DELETE",e.GetPeek="POST"}(t.GetEventOperationToRequestType||(t.GetEventOperationToRequestType={})),t.getEventBaseOperationRequestOptions=l;t.EventBaseHandler=class EventBaseHandler{setServiceBusOptions(e){const t=e=>{if(e)return JSON.parse(e.substring(e.indexOf("{"),e.lastIndexOf("}")+1))};"undefined"!==typeof window?e.parser=((e,r)=>t(r)):(e.buffer=!0,e.parser=((e,r)=>{e.on("data",t=>{e.text+=t}),e.on("end",()=>{try{200===e.statusCode||201===e.statusCode?r(null,t(e.text)):204===e.statusCode?r(null,""):r(e,null)}catch(e){r(e,null)}})}))}getEventRequestOptions(e,t,r){const n=l(this._handler,e,t,r);return this.setServiceBusOptions(n),n}};t.ListenerSubscription=class ListenerSubscription{};t.EventListener=class EventListener{static create(e,t){this._subscriptions||(this._subscriptions=new Map);let r,n=this._subscriptions.get(e.id);n?r=e.listeners.addListener(t):((n=e).listeners=new a.BeEvent,r=e.listeners.addListener(t),this.getEvents(e)),this._subscriptions.set(e.id,n);const i=e.id;return()=>{r();const t=this._subscriptions.get(i);t&&t.listeners&&0===t.listeners.numberOfListeners&&this._subscriptions.delete(e.id)}}static async getEvents(e){let t,r=await e.authenticationCallback();e:for(;e.listeners.numberOfListeners>0;){try{t=await e.getSASToken(r)}catch(t){if(401!==t.status)break;try{r=await e.authenticationCallback()}catch(e){break}}for(;e.listeners.numberOfListeners>0;)try{const r=await e.getEvent(t.sasToken,t.baseAddress,e.id,60);r&&e.listeners.raiseEvent(r)}catch(e){if(401===e.status)break;break e}}this._subscriptions.delete(e.id)}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(29),s=r(0),a=r(244),c=r(18),l="imodeljs-clients.imodelhub";class IModelHubGlobalEvent extends a.IModelHubBaseEvent{fromJson(e){super.fromJson(e),this.iModelId=e.iModelId,this.projectId=e.ProjectId}}t.IModelHubGlobalEvent=IModelHubGlobalEvent;class SoftiModelDeleteEvent extends IModelHubGlobalEvent{}t.SoftiModelDeleteEvent=SoftiModelDeleteEvent;class HardiModelDeleteEvent extends IModelHubGlobalEvent{}t.HardiModelDeleteEvent=HardiModelDeleteEvent;class IModelCreatedEvent extends IModelHubGlobalEvent{}t.IModelCreatedEvent=IModelCreatedEvent;class ChangeSetCreatedEvent extends IModelHubGlobalEvent{fromJson(e){super.fromJson(e),this.changeSetId=e.ChangeSetId,this.changeSetIndex=e.ChangeSetIndex,this.briefcaseId=e.BriefcaseId}}t.ChangeSetCreatedEvent=ChangeSetCreatedEvent;class NamedVersionCreatedEvent extends IModelHubGlobalEvent{fromJson(e){super.fromJson(e),this.versionId=e.VersionId,this.versionName=e.VersionName,this.changeSetId=e.ChangeSetId}}function u(e,t,r){const n=new(function(e){switch(e){case"SoftiModelDeleteEvent":return SoftiModelDeleteEvent;case"HardiModelDeleteEvent":return HardiModelDeleteEvent;case"iModelCreatedEvent":return IModelCreatedEvent;case"ChangeSetCreatedEvent":return ChangeSetCreatedEvent;case"NamedVersionCreatedEvent":return NamedVersionCreatedEvent}}(e.header["content-type"]))(t,r);return n.fromJson(Object.assign({},e.header,e.body)),n}t.NamedVersionCreatedEvent=NamedVersionCreatedEvent,t.ParseGlobalEvent=u;let d=class GlobalEventSubscription extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","properties.EventTypes")],d.prototype,"eventTypes",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.SubscriptionId")],d.prototype,"subscriptionId",void 0),d=n([i.ECJsonTypeMap.classToJson("wsg","GlobalScope.GlobalEventSubscription",{schemaPropertyName:"schemaName",classPropertyName:"className"})],d),t.GlobalEventSubscription=d;let h=class GlobalEventSAS extends a.BaseEventSAS{};h=n([i.ECJsonTypeMap.classToJson("wsg","GlobalScope.GlobalEventSAS",{schemaPropertyName:"schemaName",classPropertyName:"className"})],h),t.GlobalEventSAS=h;class GlobalEventSubscriptionHandler{constructor(e){this._handler=e}getRelativeUrl(e){return`/Repositories/Global--Global/GlobalScope/GlobalEventSubscription/${e||""}`}async create(e,t,r,n){e.enter(),s.Logger.logInfo(l,`Creating global event subscription with instance id: ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("subscriptionId",r);let i=new d;return i.eventTypes=n,i.subscriptionId=r,i=await this._handler.postInstance(e,d,t,this.getRelativeUrl(),i),e.enter(),s.Logger.logTrace(l,`Created global event subscription with instance id: ${r}`),i}async update(e,t,r){e.enter(),s.Logger.logInfo(l,`Updating global event subscription with instance id: ${r.wsgId} and subscription id: ${r.subscriptionId}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.defined("subscription",r),c.ArgumentCheck.validGuid("subscription.wsgId",r.wsgId);const n=await this._handler.postInstance(e,d,t,this.getRelativeUrl(r.wsgId),r);return e.enter(),s.Logger.logTrace(l,`Updated global event subscription with instance id: ${r.wsgId} and subscription id: ${r.subscriptionId}`),n}async delete(e,t,r){e.enter(),s.Logger.logInfo(l,`Deleting global event subscription with instance id: ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("subscriptionInstanceId",r),await this._handler.delete(e,t,this.getRelativeUrl(r)),e.enter(),s.Logger.logTrace(l,`Deleted global event subscription with instance id: ${r}`)}}var p;t.GlobalEventSubscriptionHandler=GlobalEventSubscriptionHandler,function(e){e[e.Destructive=0]="Destructive",e[e.Peek=1]="Peek"}(p=t.GetEventOperationType||(t.GetEventOperationType={}));t.GlobalEventHandler=class GlobalEventHandler extends a.EventBaseHandler{constructor(e){super(),this._handler=e}Subscriptions(){return this._subscriptionHandler||(this._subscriptionHandler=new GlobalEventSubscriptionHandler(this._handler)),this._subscriptionHandler}getGlobalEventSASRelativeUrl(){return"/Repositories/Global--Global/GlobalScope/GlobalEventSAS/"}async getSASToken(e,t){e.enter(),s.Logger.logInfo(l,"Getting global event SAS token"),c.ArgumentCheck.defined("token",t);const r=await this._handler.postInstance(e,h,t,this.getGlobalEventSASRelativeUrl(),new h);return e.enter(),s.Logger.logTrace(l,"Got global event SAS token"),r}getGlobalEventUrl(e,t,r){let n=`${e}/Subscriptions/${t}/messages/head`;return r&&(n+=`?timeout=${r}`),n}async getEvent(e,t,r,n,i,d=p.Destructive){let h;if(e.enter(),s.Logger.logInfo(l,`Getting global event from subscription with instance id: ${n}`),c.ArgumentCheck.defined("sasToken",t),c.ArgumentCheck.defined("baseAddress",r),c.ArgumentCheck.defined("subscriptionInstanceId",n),d===p.Destructive)h=this.getEventRequestOptions(a.GetEventOperationToRequestType.GetDestructive,t,i);else{if(d!==p.Peek)return;h=this.getEventRequestOptions(a.GetEventOperationToRequestType.GetPeek,t,i)}const f=await o.request(e,this.getGlobalEventUrl(r,n,i),h);if(e.enter(),204===f.status)return void s.Logger.logTrace(l,`No events found on subscription ${n}`);const g=u(f,this._handler,t);return s.Logger.logTrace(l,`Got Global Event from subscription with instance id: ${n}`),Promise.resolve(g)}createListener(e,t,r,n){e.enter(),c.ArgumentCheck.defined("subscriptionInstanceId",r);const i=new a.ListenerSubscription;return i.authenticationCallback=t,i.getEvent=((t,r,n,i)=>this.getEvent(e,t,r,n,i)),i.getSASToken=(t=>this.getSASToken(e,t)),i.id=r,a.EventListener.create(i,n)}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(29),s=r(0),a=r(18),c=r(57),l="imodeljs-clients.imodelhub";class Thumbnail extends i.WsgInstance{}n([i.ECJsonTypeMap.propertyToJson("wsg","instanceId")],Thumbnail.prototype,"id",void 0),t.Thumbnail=Thumbnail;let u=class SmallThumbnail extends Thumbnail{};u=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.SmallThumbnail",{schemaPropertyName:"schemaName",classPropertyName:"className"})],u),t.SmallThumbnail=u;let d=class LargeThumbnail extends Thumbnail{};d=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.LargeThumbnail",{schemaPropertyName:"schemaName",classPropertyName:"className"})],d),t.LargeThumbnail=d;class ThumbnailQuery extends c.InstanceIdQuery{byVersionId(e){return a.ArgumentCheck.validGuid("versionId",e),this.addFilter(`HasThumbnail-backward-Version.Id+eq+'${e}'`),this}}t.ThumbnailQuery=ThumbnailQuery;t.ThumbnailHandler=class ThumbnailHandler{constructor(e){this._handler=e}getRelativeProjectUrl(e,t,r){return`/Repositories/Project--${this._handler.formatProjectIdForUrl(e)}/ProjectScope/${r}Thumbnail/${t.toString()}/$file`}getRelativeUrl(e,t,r){return`/Repositories/iModel--${e}/iModelScope/${t}Thumbnail/${r||""}`}isTipThumbnail(e){return void 0!==e.projectId}async downloadThumbnail(e,t,r){e.enter();const n={method:"GET",headers:{authorization:t.toTokenString()},responseType:"arraybuffer",agent:this._handler.getAgent()},i=await o.request(e,r,n);e.enter();const s=new Uint8Array(i.body);return s&&0!==s.length?"data:image/png;base64,"+Base64.btoa(String.fromCharCode.apply(null,s)):Promise.reject(new Error("Expected an image to be returned from the query"))}async downloadTipThumbnail(e,t,r,n,i){e.enter(),s.Logger.logInfo(l,`Downloading tip ${i}Thumbnail for iModel ${n}`),a.ArgumentCheck.defined("token",t),a.ArgumentCheck.validGuid("projectId",r),a.ArgumentCheck.validGuid("imodelId",n);const o=await this._handler.getUrl(e)+this.getRelativeProjectUrl(r,n,i),c=await this.downloadThumbnail(e,t,o);return e.enter(),s.Logger.logTrace(l,`Downloaded tip ${i}Thumbnail for iModel ${n}`),c}async get(e,t,r,n,i=new ThumbnailQuery){e.enter(),s.Logger.logInfo(l,`Querying iModel ${r} thumbnails`),a.ArgumentCheck.defined("token",t),a.ArgumentCheck.validGuid("imodelId",r);let o=[];return o="Small"===n?await this._handler.getInstances(e,u,t,this.getRelativeUrl(r,n,i.getId()),i.getQueryOptions()):await this._handler.getInstances(e,d,t,this.getRelativeUrl(r,n,i.getId()),i.getQueryOptions()),s.Logger.logTrace(l,`Queried iModel ${r} thumbnails`),o}async download(e,t,r,n){if(e.enter(),a.ArgumentCheck.defined("token",t),a.ArgumentCheck.validGuid("imodelId",r),this.isTipThumbnail(n))return await this.downloadTipThumbnail(e,t,n.projectId,r,n.size);const i=n instanceof u?"Small":"Large",o=n.id;s.Logger.logInfo(l,`Downloading ${i}Thumbnail ${o} for iModel ${r}`);const c=await this._handler.getUrl(e)+this.getRelativeUrl(r,i,o)+"/$file",d=await this.downloadThumbnail(e,t,c);return e.enter(),s.Logger.logTrace(l,`Downloaded ${i}Thumbnail ${o} for iModel ${r}`),d}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(120),i=r(246),o=r(245);t.IModelClient=class IModelClient{constructor(e,t){this._handler=e,this._fileHandler=t||this._handler.getFileHandler(),this._fileHandler&&(this._fileHandler.agent=this._handler.getAgent())}setFileHandler(e){this._fileHandler=e,this._fileHandler.agent=this._handler.getAgent()}IModels(){return new n.IModelHandler(this._handler,this._fileHandler)}Briefcases(){return new n.BriefcaseHandler(this._handler,this._fileHandler)}ChangeSets(){return new n.ChangeSetHandler(this._handler,this._fileHandler)}Locks(){return new n.LockHandler(this._handler)}Codes(){return new n.CodeHandler(this._handler)}Users(){return new n.UserInfoHandler(this._handler)}Versions(){return new n.VersionHandler(this._handler)}Thumbnails(){return new i.ThumbnailHandler(this._handler)}Events(){return new n.EventHandler(this._handler)}GlobalEvents(){return new o.GlobalEventHandler(this._handler)}RequestOptions(){return this._handler.getCustomRequestOptions()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SETTINGS_ERROR_BASE=110592]="SETTINGS_ERROR_BASE",e[e.Success=0]="Success",e[e.AuthorizationError=110593]="AuthorizationError",e[e.UrlError=110594]="UrlError",e[e.ProjectInvalid=110595]="ProjectInvalid",e[e.IModelInvalid=110596]="IModelInvalid",e[e.SettingNotFound=110597]="SettingNotFound",e[e.ServerError=110598]="ServerError",e[e.UnknownError=110600]="UnknownError"}(t.SettingsStatus||(t.SettingsStatus={}));t.SettingsResult=class SettingsResult{constructor(e,t,r){this.status=e,this.errorMessage=t,this.setting=r}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);class Code{constructor(e){this.spec=n.Id64.fromJSON(e.spec),this.scope=n.JsonUtils.asString(e.scope,""),this.value=n.JsonUtils.asString(e.value)}static createEmpty(){const e=n.Id64.fromLocalAndBriefcaseIds(1,0);return new Code({spec:e,scope:e})}static fromJSON(e){return e?new Code(e):Code.createEmpty()}getValue(){return this.value?this.value:""}equals(e){return this.spec===e.spec&&this.scope===e.scope&&this.value===e.value}}t.Code=Code,function(e){e.nullCodeSpec="bis:NullCodeSpec",e.annotationFrameStyle="bis:AnnotationFrameStyle",e.annotationLeaderStyle="bis:AnnotationLeaderStyle",e.annotationTextStyle="bis:AnnotationTextStyle",e.auxCoordSystem2d="bis:AuxCoordSystem2d",e.auxCoordSystem3d="bis:AuxCoordSystem3d",e.auxCoordSystemSpatial="bis:AuxCoordSystemSpatial",e.categorySelector="bis:CategorySelector",e.colorBook="bis:ColorBook",e.displayStyle="bis:DisplayStyle",e.drawing="bis:Drawing",e.drawingCategory="bis:DrawingCategory",e.geometryPart="bis:GeometryPart",e.graphicalType2d="bis:GraphicalType2d",e.lineStyle="bis:LineStyle",e.linkElement="bis:LinkElement",e.modelSelector="bis:ModelSelector",e.physicalMaterial="bis:PhysicalMaterial",e.physicalType="bis:PhysicalType",e.informationPartitionElement="bis:InformationPartitionElement",e.renderMaterial="bis:RenderMaterial",e.sheet="bis:Sheet",e.spatialCategory="bis:SpatialCategory",e.spatialLocationType="bis:SpatialLocationType",e.subCategory="bis:SubCategory",e.subject="bis:Subject",e.templateRecipe2d="bis:TemplateRecipe2d",e.templateRecipe3d="bis:TemplateRecipe3d",e.textAnnotationSeed="bis:TextAnnotationSeed",e.texture="bis:Texture",e.viewDefinition="bis:ViewDefinition"}(t.BisCodeSpec||(t.BisCodeSpec={})),function(e){let t,r;!function(e){e[e.Repository=1]="Repository",e[e.Model=2]="Model",e[e.ParentElement=3]="ParentElement",e[e.RelatedElement=4]="RelatedElement"}(t=e.Type||(e.Type={})),function(e){e[e.ElementId=1]="ElementId",e[e.FederationGuid=2]="FederationGuid"}(r=e.ScopeRequirement||(e.ScopeRequirement={}))}(t.CodeScopeSpec||(t.CodeScopeSpec={}));t.CodeSpec=class CodeSpec{constructor(e,t,r,n,i,o){this.iModel=e,this.id=t,this.name=r,this.specScopeType=n,this.scopeReq=void 0!==i?i:1,this.properties=o}get isValid(){return n.Id64.isValid(this.id)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(15);class RelatedElement{constructor(e){this.id=n.Id64.fromJSON(e.id),this.relClassName=e.relClassName}static fromJSON(e){return e?new RelatedElement(e):void 0}static idFromJson(e){if("object"===typeof e&&"id"in e){const t=RelatedElement.fromJSON(e);if(void 0===t)throw new i.IModelError(65539,"Problem parsing Id64 from json",n.Logger.logWarning);return t.id}return n.Id64.fromJSON(e)}}t.RelatedElement=RelatedElement;t.TypeDefinition=class TypeDefinition extends RelatedElement{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(6),o=r(9),s=r(10),a=r(38),c=r(33),l=r(100),u=r(60),d=r(51),h=r(14),p=r(24);class FrameBuilder{clear(){this._origin=void 0,this._vector0=void 0,this._vector1=void 0,this._vector2=void 0}constructor(){this.clear()}getValidatedFrame(e=!1){if(this._origin&&this._vector0&&this._vector1)if(e){if(this._vector2){const e=s.Matrix3d.createRigidFromColumns(this._vector0,this._vector1,0);if(e)return this._vector0.tripleProduct(this._vector1,this._vector2)<0&&e.scaleColumns(1,1,-1),o.Transform.createOriginAndMatrix(this._origin,e);const t=this._vector2;this._vector1=this._vector2=void 0,this.announceVector(t)}}else{const e=s.Matrix3d.createRigidFromColumns(this._vector0,this._vector1,0);if(e)return o.Transform.createOriginAndMatrix(this._origin,e);this._vector1=this._vector2=void 0}}applyDefaultUpVector(e){e&&this._vector0&&!this._vector1&&!e.isParallelTo(this._vector0)&&(this._vector1=e.crossProduct(this._vector0))}get hasOrigin(){return void 0!==this._origin}savedVectorCount(){return this._vector0?this._vector1?this._vector2?3:2:1:0}announcePoint(e){return this._origin?this._origin.isAlmostEqual(e)?this.savedVectorCount():this.announceVector(this._origin.vectorTo(e)):(this._origin=e.clone(),this.savedVectorCount())}announceVector(e){if(e.isAlmostZero)return this.savedVectorCount();if(!this._vector0)return this._vector0=e,1;if(!this._vector1)return e.isParallelTo(this._vector0)?1:(this._vector1=e,2);if(!this._vector2){const t=this._vector0.unitCrossProduct(this._vector1);return t&&!n.Geometry.isSameCoordinate(0,t.dotProduct(e))?(this._vector2=e,3):2}return 3}announce(e){if(!(this.savedVectorCount()>1))if(e instanceof i.Point3d)this.announcePoint(e);else if(e instanceof i.Vector3d)this.announceVector(e);else if(Array.isArray(e))for(const t of e){if(this.savedVectorCount()>1)break;this.announce(t)}else if(e instanceof a.CurvePrimitive){if(e instanceof d.LineSegment3d)this.announcePoint(e.startPoint()),this.announcePoint(e.endPoint());else if(e instanceof u.Arc3d){const t=e.fractionToPointAndDerivative(0);this.announcePoint(t.origin),this.announceVector(t.direction),this.announceVector(e.matrix.columnZCrossVector(t.direction))}else if(e instanceof h.LineString3d){for(const t of e.points)if(this.announcePoint(t),this.savedVectorCount()>1)break}else if(e instanceof l.BSplineCurve3d){const t=i.Point3d.create();for(let r=0;this.savedVectorCount()<2&&e.getPolePoint3d(r,t)instanceof i.Point3d;r++)this.announcePoint(t)}}else if(e instanceof c.CurveCollection&&e.children)for(const t of e.children)if(this.announce(t),this.savedVectorCount()>1)break}static createRightHandedFrame(e,...t){const r=new FrameBuilder;for(const n of t){r.announce(n),r.applyDefaultUpVector(e);const t=r.getValidatedFrame(!1);if(void 0!==t)return t}for(const n of t)if(n instanceof c.CurveCollection){const e=n.children;if(e)for(const t of e)if(t instanceof a.CurvePrimitive){const e=t.fractionToFrenetFrame(0);if(e)return e}}}static createRightHandedLocalToWorld(...e){const t=new FrameBuilder;for(const r of e){t.announce(r);const e=t.getValidatedFrame(!1);if(void 0!==e)return e}}static createFrameToDistantPoints(e){if(e.length>2){const t=e[0].clone(),r=i.Vector3d.create();p.Point3dArray.vectorToMostDistantPoint(e,e[0],r);const n=i.Vector3d.create();p.Point3dArray.vectorToPointWithMaxCrossProductMangitude(e,t,r,n);const a=s.Matrix3d.createRigidFromColumns(r,n,0);if(a)return o.Transform.createRefs(t,a)}}static createLocalToWorldTransformInRange(e,t=2,r=0,i=0,a=0,c=1){if(e.isNull)return o.Transform.createIdentity();let l=1,u=1,d=1;return 1===t?l=u=d=n.Geometry.correctSmallMetricDistance(e.maxLength(),c):2===t&&(l=n.Geometry.correctSmallMetricDistance(e.xLength(),c)*n.Geometry.maxAbsDiff(r,0,1),u=n.Geometry.correctSmallMetricDistance(e.yLength(),c)*n.Geometry.maxAbsDiff(i,0,1),d=n.Geometry.correctSmallMetricDistance(e.zLength(),c)*n.Geometry.maxAbsDiff(a,0,1)),o.Transform.createRefs(e.fractionToPoint(r,i,a),s.Matrix3d.createScale(l,u,d))}}t.FrameBuilder=FrameBuilder},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(38);class RecursiveCurveProcessor{constructor(){}announceUnexpected(e,t){}announceCurvePrimitive(e,t=-1){}announcePath(e,t=-1){let r=0;for(const n of e.children)this.announceCurvePrimitive(n,r++)}announceLoop(e,t=-1){let r=0;for(const n of e.children)this.announceCurvePrimitive(n,r++)}announceParityRegion(e,t=-1){let r=0;for(const n of e.children)this.announceLoop(n,r++)}announceUnionRegion(e,t=-1){let r=0;for(const n of e.children)n.announceToCurveProcessor(this,r++)}announceBagOfCurves(e,t=-1){for(const r of e.children)r instanceof n.CurvePrimitive?this.announceCurvePrimitive(r):r.announceToCurveProcessor(this)}}t.RecursiveCurveProcessor=RecursiveCurveProcessor;t.RecursiveCurveProcessorWithStack=class RecursiveCurveProcessorWithStack extends RecursiveCurveProcessor{constructor(){super(),this._stack=[]}enter(e){this._stack.push(e)}leave(){return this._stack.pop()}announceUnexpected(e,t){}announceCurvePrimitive(e,t=-1){}announcePath(e,t=-1){this.enter(e),super.announcePath(e,t),this.leave()}announceLoop(e,t=-1){this.enter(e),super.announceLoop(e,t),this.leave()}announceParityRegion(e,t=-1){this.enter(e);let r=0;for(const n of e.children)this.announceLoop(n,r++);this.leave()}announceUnionRegion(e,t=-1){this.enter(e),super.announceUnionRegion(e,t),this.leave()}announceBagOfCurves(e,t=-1){this.enter(e);let r=0;for(const i of e.children)i instanceof n.CurvePrimitive?this.announceCurvePrimitive(i,r++):i.announceToCurveProcessor(this);this.leave()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(6),o=r(19),s=r(21),a=r(22),c=r(72),l=r(5),u=r(16),d=r(59),h=r(254);class BezierCurve3dH extends h.BezierCurveBase{isSameGeometryClass(e){return e instanceof BezierCurve3dH}tryTransformInPlace(e){const t=this._workData0;for(let r=0;r<this._polygon.order;r++)this._polygon.getPolygonPoint(r,t),e.multiplyXYZWToFloat64Array(t[0],t[1],t[2],t[3],t),this._polygon.setPolygonPoint(r,t);return!0}tryMultiplyMatrix4dInPlace(e){e.multiplyBlockedFloat64ArrayInPlace(this._polygon.packedData)}getPolePoint4d(e,t){const r=this._polygon.getPolygonPoint(e,this._workData0);if(r)return o.Point4d.create(r[0],r[1],r[2],r[3],t)}getPolePoint3d(e,t){const r=this._polygon.getPolygonPoint(e,this._workData0);if(r)return i.Point3d.createFromPackedXYZW(r,0,t)}isUnitWeight(e){void 0===e&&(e=l.Geometry.smallAngleRadians);const t=1-e,r=1+e,n=this._polygon.packedData,i=n.length;let o;for(let s=3;s<i;s+=4)if((o=n[s])<t||o>r)return!1;return!0}constructor(e){super(4,e),this._workRay0=s.Ray3d.createXAxis(),this._workRay1=s.Ray3d.createXAxis()}static create(e){if(e.length<1)return;const t=new Float64Array(4*e.length);if(e[0]instanceof i.Point3d){let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=n.z,t[r++]=1;return new BezierCurve3dH(t)}if(e[0]instanceof o.Point4d){let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=n.z,t[r++]=n.w;return new BezierCurve3dH(t)}if(e[0]instanceof n.Point2d){let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=0,t[r++]=1;return new BezierCurve3dH(t)}}static createOrder(e){const t=new Float64Array(4*e);return new BezierCurve3dH(t)}loadSpan3dPolesWithWeight(e,t,r){this._polygon.loadSpanPolesWithWeight(e,3,t,r)}loadSpan4dPoles(e,t){this._polygon.loadSpanPoles(e,t)}clone(){return new BezierCurve3dH(this._polygon.clonePolygon())}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}fractionToPoint(e,t){return this._polygon.evaluate(e,this._workData0),(t=i.Point3d.createFromPackedXYZW(this._workData0,0,t))||i.Point3d.createZero()}fractionToPoint4d(e,t){return this._polygon.evaluate(e,this._workData0),o.Point4d.createFromPackedXYZW(this._workData0,0,t)}fractionToPointAndDerivative(e,t){return this._polygon.evaluate(e,this._workData0),this._polygon.evaluateDerivative(e,this._workData1),(t=s.Ray3d.createWeightedDerivative(this._workData0,this._workData1,t))||s.Ray3d.createXAxis()}fractionToPointAnd2Derivatives(e,t){t||(t=a.Plane3dByOriginAndVectors.createXYPlane());const r=this.fractionToPointAndDerivative(e,this._workRay0);t.origin.setFrom(r.origin),t.vectorU.setFrom(r.direction);const n=this.fractionToPointAndDerivative(e-1e-8,this._workRay0),o=this.fractionToPointAndDerivative(e+1e-8,this._workRay1);return i.Vector3d.createAdd2Scaled(n.direction,-5e7,o.direction,5e7,t.vectorV),t}isAlmostEqual(e){return e instanceof BezierCurve3dH&&this._polygon.isAlmostEqual(e._polygon)}strokeCount(e){this.getPolePoint3d(0,this._workPoint0),this.getPolePoint3d(1,this._workPoint1);let t=1;if(this._workPoint0&&this._workPoint1){let r,n,i,o=this._workPoint1.x-this._workPoint0.x,s=this._workPoint1.y-this._workPoint0.y,a=this._workPoint1.z-this._workPoint0.z,d=0,h=l.Geometry.hypotenuseXYZ(o,s,a);this._workPoint1.setFromPoint3d(this._workPoint0);let p,f=h,g=h,m=0;for(let e=2;this.getPolePoint3d(e,this._workPoint1);e++)r=this._workPoint1.x-this._workPoint0.x,n=this._workPoint1.y-this._workPoint0.y,i=this._workPoint1.z-this._workPoint0.z,d+=p=u.Angle.radiansBetweenVectorsXYZ(o,s,a,r,n,i),m=l.Geometry.maxAbsXY(p,m),f+=h=l.Geometry.hypotenuseXYZ(r,n,i),g=l.Geometry.maxXY(g,h),o=r,s=n,a=i,this._workPoint0.setFrom(this._workPoint1);const y=g*this.degree,v=Math.sqrt(y*f);let _=m*(this.degree-1);this.degree<3&&(_*=3);const w=Math.sqrt(_*d);t=c.StrokeOptions.applyAngleTol(e,c.StrokeOptions.applyMaxEdgeLength(e,this.degree,v),w,.1)}return t}dispatchToGeometryHandler(e){return e.handleBezierCurve3dH(this)}poleProductsXYZW(e,t,r,n,i){const o=this.numPoles,s=this._polygon.packedData;for(let a=0,c=0;a<o;a++,c+=4)e[a]=t*s[c]+r*s[c+1]+n*s[c+2]+i*s[c+3]}updateClosestPointByTruePerpendicular(e,t){let r,n=0;if(this.isUnitWeight()){const t=2*this.order-2;this.allocateAndZeroBezierWorkData(t,0,0);const n=this._workBezier;d.BezierPolynomialAlgebra.accumulateScaledShiftedComponentTimesComponentDelta(n.coffs,this._polygon.packedData,4,this.order,1,0,-e.x,0),d.BezierPolynomialAlgebra.accumulateScaledShiftedComponentTimesComponentDelta(n.coffs,this._polygon.packedData,4,this.order,1,1,-e.y,1),d.BezierPolynomialAlgebra.accumulateScaledShiftedComponentTimesComponentDelta(n.coffs,this._polygon.packedData,4,this.order,1,2,-e.z,2),r=n.roots(0,!0)}else{const t=this.order,n=2*this.order-2,i=t+n-1;this.allocateAndZeroBezierWorkData(i,t,n);const o=this._workBezier,s=this._workCoffsA,a=this._workCoffsB,c=this._polygon.packedData;for(let r=0;r<3;r++)d.BezierPolynomialAlgebra.scaledComponentSum(s,c,4,t,3,e.at(r),r,-1),d.BezierPolynomialAlgebra.accumulateScaledShiftedComponentTimesComponentDelta(a,c,4,t,1,3,1,r),d.BezierPolynomialAlgebra.accumulateScaledShiftedComponentTimesComponentDelta(a,c,4,t,-1,r,1,3),d.BezierPolynomialAlgebra.accumulateProduct(o.coffs,s,a);r=o.roots(0,!0)}if(r)for(const i of r){const r=this.fractionToPoint(i),o=r.distance(e);n+=t.updateIfCloserCurveFractionPointDistance(this,i,r,o)?1:0}return n>0}extendRange(e,t){const r=this.order;if(t){this.allocateAndZeroBezierWorkData(2*r-2,r,r);const n=this._workCoffsA,i=this._workCoffsB,o=this._workBezier;this.getPolePoint3d(0,this._workPoint0),e.extendTransformedPoint(t,this._workPoint0),this.getPolePoint3d(r-1,this._workPoint0),e.extendTransformedPoint(t,this._workPoint0);const s=this._polygon.packedData;let a;for(let c=0;c<3;c++){o.zero();for(let e=0,o=0;e<r;e++,o+=4)a=s[o+3],n[e]=t.multiplyComponentXYZW(c,s[o],s[o+1],s[o+2],a),i[e]=a;d.BezierPolynomialAlgebra.accumulateProductWithDifferences(o.coffs,n,i,1),d.BezierPolynomialAlgebra.accumulateProductWithDifferences(o.coffs,i,n,-1);const l=o.roots(0,!0);if(l&&l.length>0)for(const r of l)this.fractionToPoint(r,this._workPoint0),e.extendTransformedPoint(t,this._workPoint0)}}else{this.allocateAndZeroBezierWorkData(2*r-2,0,0);const t=this._workBezier,n=this._polygon.packedData;this.getPolePoint3d(0,this._workPoint0),e.extend(this._workPoint0),this.getPolePoint3d(r-1,this._workPoint0),e.extend(this._workPoint0);for(let i=0;i<3;i++){t.zero(),d.BezierPolynomialAlgebra.accumulateScaledShiftedComponentTimesComponentDelta(t.coffs,n,4,r,1,i,0,3),d.BezierPolynomialAlgebra.accumulateScaledShiftedComponentTimesComponentDelta(t.coffs,n,4,r,-1,3,0,i);const o=t.roots(0,!0);if(o)for(const t of o)this.fractionToPoint(t,this._workPoint0),e.extend(this._workPoint0)}}}}t.BezierCurve3dH=BezierCurve3dH},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(38),o=r(255),s=r(59);t.BezierCurveBase=class BezierCurveBase extends i.CurvePrimitive{constructor(e,t){super(),this._polygon=new o.Bezier1dNd(e,t),this._workPoint0=n.Point3d.create(),this._workPoint1=n.Point3d.create(),this._workData0=new Float64Array(e),this._workData1=new Float64Array(e)}reverseInPlace(){this._polygon.reverseInPlace()}saturateInPlace(e,t){return this._polygon.saturateInPlace(e,t)}get degree(){return this._polygon.order-1}get order(){return this._polygon.order}get numPoles(){return this._polygon.order}setInterval(e,t){this._polygon.setInterval(e,t)}fractionToParentFraction(e){return this._polygon.fractionToParentFraction(e)}emitStrokes(e,t){const r=this.strokeCount(t),n=1/r;for(let i=0;i<=r;i++){const t=i*n;this.fractionToPoint(t,this._workPoint0),e.appendStrokePoint(this._workPoint0)}}emitStrokableParts(e,t){const r=this.strokeCount(t);e.announceIntervalForUniformStepStrokes(this,r,0,1)}copyPolesAsJsonArray(){return this._polygon.unpackToJsonArrays()}isInPlane(e){let t=this._workPoint0;for(let r=0;;r++){if(!(t=this.getPolePoint3d(r,t)))return!0;if(!e.isPointInPlane(t))return!1}return!1}polygonLength(){if(!this.getPolePoint3d(0,this._workPoint0))return 0;let e=0,t=0;for(;this.getPolePoint3d(++e,this._workPoint1);)t+=this._workPoint0.distance(this._workPoint1),this._workPoint0.setFrom(this._workPoint1);return t}startPoint(){const e=this.getPolePoint3d(0);return e||n.Point3d.createZero()}endPoint(){const e=this.getPolePoint3d(this.order-1);return e||n.Point3d.createZero()}quickLength(){return this.polygonLength()}extendRange(e,t){let r=0;if(t)for(;this.getPolePoint3d(r++,this._workPoint0);)e.extendTransformedPoint(t,this._workPoint0);else for(;this.getPolePoint3d(r++,this._workPoint0);)e.extend(this._workPoint0)}allocateAndZeroBezierWorkData(e,t,r){e>0&&(void 0!==this._workBezier&&this._workBezier.order===e?this._workBezier.zero():this._workBezier=new s.UnivariateBezier(e)),t>0&&(void 0!==this._workCoffsA&&this._workCoffsA.length===t?this._workCoffsA.fill(0):this._workCoffsA=new Float64Array(t)),r>0&&(void 0!==this._workCoffsB&&this._workCoffsB.length===r?this._workCoffsB.fill(0):this._workCoffsB=new Float64Array(r))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(6),o=r(125),s=r(19),a=r(5),c=r(24),l=r(59);class Bezier1dNd{constructor(e,t){this._blockSize=e,this._order=Math.floor(t.length/e),this._packedData=t,this._basis=new l.UnivariateBezier(this._order)}clonePolygon(e){const t=this._packedData.length;if(!e||e.length!==t)return this._packedData.slice();for(let r=0;r<t;r++)e[r]=this._packedData[r];return e}get order(){return this._order}get packedData(){return this._packedData}static create(e){if(!(e.length<1)){if(e[0]instanceof i.Point3d){const t=new Float64Array(3*e.length);let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=n.z;return new Bezier1dNd(3,t)}if(e[0]instanceof s.Point4d){const t=new Float64Array(4*e.length);let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=n.z,t[r++]=n.w;return new Bezier1dNd(4,t)}if(e[0]instanceof n.Point2d){const t=new Float64Array(2*e.length);let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y;return new Bezier1dNd(2,t)}}}evaluate(e,t){return this._basis.sumBasisFunctions(e,this._packedData,this._blockSize,t)}evaluateDerivative(e,t){return this._basis.sumBasisFunctionDerivatives(e,this._packedData,this._blockSize,t)}getPolygonPoint(e,t){if(t||(t=new Float64Array(this._blockSize)),e>=0&&e<this._order){const r=this._blockSize*e;for(let e=0;e<this._blockSize;e++)t[e]=this._packedData[r+e];return t}}setPolygonPoint(e,t){if(e>=0&&e<this._order){const r=this._blockSize*e;for(let e=0;e<this._blockSize;e++)this._packedData[r+e]=t[e]}}loadSpanPoles(e,t){let r=t*this._blockSize;for(let n=0;n<this._packedData.length;n++)this._packedData[n]=e[r++]}loadSpanPolesWithWeight(e,t,r,n){let i=0;const o=this._order;let s=r*t;for(let a=0;a<o;a++){for(let r=0;r<t;r++)this._packedData[i++]=e[s++];this._packedData[i++]=n}}unpackToJsonArrays(){return c.Point3dArray.unpackNumbersToNestedArrays(this._packedData,this._blockSize)}isAlmostEqual(e){if(e instanceof Bezier1dNd){if(this._blockSize!==e._blockSize)return!1;if(this._order!==e._order)return!1;if(this._packedData.length!==e._packedData.length)return!1;for(let t=0;t<this._packedData.length;t++)if(!a.Geometry.isSameCoordinate(this._packedData[t],e._packedData[t]))return!1;return!0}return!1}reverseInPlace(){const e=this._blockSize;let t,r,n;for(t=0,r=(this._order-1)*e;t<r;t+=e,r-=e)for(let i=0;i<e;i++)n=this._packedData[t+i],this._packedData[t+i]=this._packedData[r+i],this._packedData[r+i]=n}interpolatePoleInPlace(e,t,r){let n=e*this._blockSize,i=r*this._blockSize;const o=this._packedData;for(let s=0;s<this._blockSize;s++,n++,i++)o[n]+=t*(o[i]-o[n])}saturateInPlace(e,t){const r=e.degree,n=t+r-1,i=n+1;if(t<0||t>=e.numSpans)return!1;const o=e.knots,s=o[n],a=o[i];this.setInterval(s,a);for(let c=r-1;c>0;c--){let e=n-c;if(o[e]<s){let t=i;for(let r=0;r<c;r++,e++,t++){const n=o[e],i=(s-n)/(o[t]-n);this.interpolatePoleInPlace(r,i,r+1)}}}for(let c=r-1;c>0;c--){let e=i+c;if(o[e]>a)for(let t=0;t<c;t++,e--){const n=o[e],i=(a-n)/(s-n);this.interpolatePoleInPlace(r-t,i,r-t-1)}}return!0}static saturate1dInPlace(e,t,r){const n=t.degree,i=r+n-1,o=i+1;if(r<0||r>=t.numSpans)return!1;const s=t.knots,a=s[i],c=s[o];for(let l=n-1;l>0;l--){let t=i-l;if(s[t]<a){let r=o;for(let n=0;n<l;n++,t++,r++){const i=s[t],o=(a-i)/(s[r]-i);e[n]=e[n]+o*(e[n+1]-e[n])}}}for(let l=n-1;l>0;l--){let t,r=o+l;if(s[r]>c)for(let i=0;i<l;i++,r--){const o=s[r],l=(c-o)/(a-o);e[t=n-i]+=l*(e[t-1]-e[t])}}return!0}subdivideInPlaceKeepLeft(e){if(a.Geometry.isAlmostEqualNumber(e,1))return!0;if(a.Geometry.isAlmostEqualNumber(e,0))return!1;const t=1-e,r=this.order;for(let n=1;n<r;n++)for(let e=r-1;e>=n;e--)this.interpolatePoleInPlace(e,t,e-1);return!0}subdivideInPlaceKeepRight(e){if(a.Geometry.isAlmostEqualNumber(e,0))return!0;if(a.Geometry.isAlmostEqualNumber(e,1))return!1;const t=this.order;for(let r=1;r<t;r++)for(let n=0;n+r<t;n++)this.interpolatePoleInPlace(n,e,n+1);return!0}subdivideToIntervalInPlace(e,t){return!a.Geometry.isAlmostEqualNumber(e,t)&&(t<e?(this.subdivideToIntervalInPlace(e,t),this.reverseInPlace(),!0):(this.subdivideInPlaceKeepLeft(t),this.subdivideInPlaceKeepRight(e/t),!0))}setInterval(e,t){this.interval=o.Segment1d.create(e,t,this.interval)}fractionToParentFraction(e){return this.interval?this.interval.fractionToPoint(e):e}}t.Bezier1dNd=Bezier1dNd},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6);class BSpline1dNd{get degree(){return this.knots.degree}get order(){return this.knots.degree+1}get numSpan(){return this.numPoles-this.knots.degree}get numPoles(){return this.packedData.length/this.poleLength}getPoint3dPole(e,t){return n.Point3d.createFromPacked(this.packedData,e,t)}constructor(e,t,r,n){this.knots=n,this.packedData=new Float64Array(e*t),this.poleLength=t,this.basisBuffer=new Float64Array(r),this.poleBuffer=new Float64Array(t),this.basisBuffer1=new Float64Array(r),this.basisBuffer2=new Float64Array(r),this.poleBuffer1=new Float64Array(t),this.poleBuffer2=new Float64Array(t)}static create(e,t,r,n){return new BSpline1dNd(e,t,r,n)}spanFractionToKnot(e,t){return this.knots.spanFractionToKnot(e,t)}evaluateBasisFunctionsInSpan(e,t,r,n,i){e<0&&(e=0),e>=this.numSpan&&(e=this.numSpan-1);const o=e+this.degree-1,s=this.knots.baseKnotFractionToKnot(o,t);return n?this.knots.evaluateBasisFunctions1(o,s,r,n,i):this.knots.evaluateBasisFunctions(o,s,r)}evaluateBuffersInSpan(e,t){this.evaluateBasisFunctionsInSpan(e,t,this.basisBuffer),this.sumPoleBufferForSpan(e)}evaluateBuffersInSpan1(e,t){this.evaluateBasisFunctionsInSpan(e,t,this.basisBuffer,this.basisBuffer1),this.sumPoleBufferForSpan(e),this.sumPoleBuffer1ForSpan(e)}sumPoleBufferForSpan(e){this.poleBuffer.fill(0);let t=e*this.poleLength;for(const r of this.basisBuffer)for(let e=0;e<this.poleLength;e++)this.poleBuffer[e]+=r*this.packedData[t++]}sumPoleBuffer1ForSpan(e){this.poleBuffer1.fill(0);let t=e*this.poleLength;for(const r of this.basisBuffer1)for(let e=0;e<this.poleLength;e++)this.poleBuffer1[e]+=r*this.packedData[t++]}sumPoleBuffer2ForSpan(e){this.poleBuffer2.fill(0);let t=e*this.poleLength;for(const r of this.basisBuffer2)for(let e=0;e<this.poleLength;e++)this.poleBuffer2[e]+=r*this.packedData[t++]}evaluateBuffersAtKnot(e,t=0){const r=this.knots.knotToLeftKnotIndex(e);t<1?(this.knots.evaluateBasisFunctions(r,e,this.basisBuffer),this.sumPoleBufferForSpan(r-this.degree+1)):1===t?(this.knots.evaluateBasisFunctions1(r,e,this.basisBuffer,this.basisBuffer1),this.sumPoleBufferForSpan(r-this.degree+1),this.sumPoleBuffer1ForSpan(r-this.degree+1)):(this.knots.evaluateBasisFunctions1(r,e,this.basisBuffer,this.basisBuffer1,this.basisBuffer2),this.sumPoleBufferForSpan(r-this.degree+1),this.sumPoleBuffer1ForSpan(r-this.degree+1),this.sumPoleBuffer2ForSpan(r-this.degree+1))}reverseInPlace(){const e=this.poleLength,t=this.packedData;for(let r=0,n=e*(this.numPoles-1);r<n;r+=e,n-=e){let i=0;for(let o=0;o<e;o++)i=t[r+o],t[r+o]=t[n+o],t[n+o]=i}this.knots.reflectKnots()}}t.BSpline1dNd=BSpline1dNd},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(5);class Plane3dByOriginAndUnitNormal{constructor(e,t){this._origin=e,this._normal=t}static _create(e,t,r,i,o,s){return new Plane3dByOriginAndUnitNormal(n.Point3d.create(e,t,r),n.Vector3d.create(i,o,s))}static createXYPlane(e){return e?Plane3dByOriginAndUnitNormal._create(e.x,e.y,e.z,0,0,1):Plane3dByOriginAndUnitNormal._create(0,0,0,0,0,1)}static createYZPlane(e){return e?Plane3dByOriginAndUnitNormal._create(e.x,e.y,e.z,1,0,0):Plane3dByOriginAndUnitNormal._create(0,0,0,1,0,0)}static createZXPlane(e){return e?Plane3dByOriginAndUnitNormal._create(e.x,e.y,e.z,0,1,0):Plane3dByOriginAndUnitNormal._create(0,0,0,0,1,0)}static create(e,t,r){const n=t.normalize();if(n)return r?(r.set(e,n),r):new Plane3dByOriginAndUnitNormal(e.clone(),n)}static createPointPointVectorInPlane(e,t,r){const n=r.crossProductStartEnd(e,t);if(n.tryNormalizeInPlace())return new Plane3dByOriginAndUnitNormal(e,n)}isAlmostEqual(e){return this._origin.isAlmostEqual(e._origin)&&this._normal.isAlmostEqual(e._normal)}setFromJSON(e){e?(this._origin.setFromJSON(e.origin),this._normal.setFromJSON(e.normal)):(this._origin.set(0,0,0),this._normal.set(0,0,1))}toJSON(){return{origin:this._origin.toJSON(),normal:this._normal.toJSON()}}static fromJSON(e){const t=Plane3dByOriginAndUnitNormal.createXYPlane();return t.setFromJSON(e),t}getOriginRef(){return this._origin}getNormalRef(){return this._normal}set(e,t){this._origin.setFrom(e),this._normal.setFrom(t)}clone(e){return e?(e.set(this._origin,this._normal),e):new Plane3dByOriginAndUnitNormal(this._origin.clone(),this._normal.clone())}cloneTransformed(e){const t=this.clone();if(e.multiplyPoint3d(t._origin,t._origin),e.matrix.multiplyInverseTranspose(t._normal,t._normal),t._normal.normalizeInPlace())return t}setFrom(e){this.set(e._origin,e._normal)}altitude(e){return this._normal.dotProductStartEnd(this._origin,e)}weightedAltitude(e){return this._normal.dotProductStart3dEnd4d(this._origin,e)}altitudeToPoint(e,t){return this._origin.plusScaled(this._normal,e,t)}velocityXYZ(e,t,r){return this._normal.dotProductXYZ(e,t,r)}velocity(e){return this._normal.dotProduct(e)}altitudeXYZ(e,t,r){return this._normal.dotProductStartEndXYZ(this._origin,e,t,r)}altitudeXYZW(e,t,r,n){return this._normal.dotProductStartEndXYZW(this._origin,e,t,r,n)}projectPointToPlane(e,t){return e.plusScaled(this._normal,-this._normal.dotProductStartEnd(this._origin,e),t)}isPointInPlane(e){return i.Geometry.isSmallMetricDistance(this.altitude(e))}}t.Plane3dByOriginAndUnitNormal=Plane3dByOriginAndUnitNormal},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(16),o=r(10),s=r(6);class YawPitchRollAngles{constructor(e=i.Angle.zero(),t=i.Angle.zero(),r=i.Angle.zero()){this.yaw=e,this.pitch=t,this.roll=r}freeze(){Object.freeze(this.yaw),Object.freeze(this.pitch),Object.freeze(this.roll)}static createDegrees(e,t,r){return new YawPitchRollAngles(i.Angle.createDegrees(e),i.Angle.createDegrees(t),i.Angle.createDegrees(r))}static createRadians(e,t,r){return new YawPitchRollAngles(i.Angle.createRadians(e),i.Angle.createRadians(t),i.Angle.createRadians(r))}static fromJSON(e){return e=e||{},new YawPitchRollAngles(i.Angle.fromJSON(e.yaw),i.Angle.fromJSON(e.pitch),i.Angle.fromJSON(e.roll))}setFromJSON(e){e=e||{},this.yaw=i.Angle.fromJSON(e.yaw),this.pitch=i.Angle.fromJSON(e.pitch),this.roll=i.Angle.fromJSON(e.roll)}toJSON(){const e={};return this.pitch.isAlmostZero||(e.pitch=this.pitch.toJSON()),this.roll.isAlmostZero||(e.roll=this.roll.toJSON()),this.yaw.isAlmostZero||(e.yaw=this.yaw.toJSON()),e}setFrom(e){this.yaw.setFrom(e.yaw),this.pitch.setFrom(e.pitch),this.roll.setFrom(e.roll)}isAlmostEqual(e){return this.yaw.isAlmostEqualAllowPeriodShift(e.yaw)&&this.pitch.isAlmostEqualAllowPeriodShift(e.pitch)&&this.roll.isAlmostEqualAllowPeriodShift(e.roll)}clone(){return new YawPitchRollAngles(this.yaw.clone(),this.pitch.clone(),this.roll.clone())}toMatrix3d(e){const t=Math.cos(this.yaw.radians),r=Math.sin(this.yaw.radians),n=Math.cos(this.pitch.radians),i=Math.sin(this.pitch.radians),s=Math.cos(this.roll.radians),a=Math.sin(this.roll.radians);return o.Matrix3d.createRowValues(t*n,-(r*s+t*i*a),r*a-t*i*s,r*n,t*s-r*i*a,-(t*a+r*i*s),i,n*a,n*s,e)}maxAbsRadians(){return n.Geometry.maxAbsXYZ(this.yaw.radians,this.pitch.radians,this.roll.radians)}sumSquaredRadians(){return n.Geometry.hypotenuseSquaredXYZ(this.yaw.radians,this.pitch.radians,this.roll.radians)}isIdentity(e=!0){return e?i.Angle.isAlmostEqualRadiansAllowPeriodShift(0,this.yaw.radians)&&i.Angle.isAlmostEqualRadiansAllowPeriodShift(0,this.pitch.radians)&&i.Angle.isAlmostEqualRadiansAllowPeriodShift(0,this.roll.radians):i.Angle.isAlmostEqualRadiansNoPeriodShift(0,this.yaw.radians)&&i.Angle.isAlmostEqualRadiansNoPeriodShift(0,this.pitch.radians)&&i.Angle.isAlmostEqualRadiansNoPeriodShift(0,this.roll.radians)}maxDiffRadians(e){return Math.max(this.yaw.radians-e.yaw.radians,this.pitch.radians-e.pitch.radians,this.roll.radians-e.roll.radians)}maxAbsDegrees(){return n.Geometry.maxAbsXYZ(this.yaw.degrees,this.pitch.degrees,this.roll.degrees)}sumSquaredDegrees(){return n.Geometry.hypotenuseSquaredXYZ(this.yaw.degrees,this.pitch.degrees,this.roll.degrees)}static tryFromTransform(e){return{angles:YawPitchRollAngles.createFromMatrix3d(e.matrix),origin:s.Point3d.createFrom(e.origin)}}static createFromMatrix3d(e,t){const r=e.at(2,0),o=Math.sqrt(e.at(2,1)*e.at(2,1)+e.at(2,2)*e.at(2,2)),s=i.Angle.createAtan2(r,o),a=i.Angle.createAtan2(r,-o),c=t||new YawPitchRollAngles;if(o<n.Geometry.smallAngleRadians)c.yaw=i.Angle.createAtan2(-e.at(0,1),e.at(1,1)),c.pitch=s,c.roll=i.Angle.createRadians(0);else{const t=i.Angle.createAtan2(e.at(1,0),e.at(0,0)),r=i.Angle.createAtan2(e.at(2,1),e.at(2,2)),n=i.Angle.createAtan2(-e.at(1,0),-e.at(0,0)),o=i.Angle.createAtan2(-e.at(2,1),-e.at(2,2)),l=new YawPitchRollAngles(t,s,r),u=new YawPitchRollAngles(n,a,o),d=.95,h=l.maxAbsRadians(),p=u.maxAbsRadians();if(h<d*p)c.setFrom(l);else if(p<d*h)c.setFrom(u);else{l.sumSquaredRadians()<=u.sumSquaredRadians()?c.setFrom(l):c.setFrom(u)}}const l=c.toMatrix3d();return e.maxDiff(l)<n.Geometry.smallAngleRadians?c:void 0}}t.YawPitchRollAngles=YawPitchRollAngles},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(125),i=r(23),o=r(37),s=r(126),a=r(169);class UnionOfConvexClipPlaneSets{constructor(){this._convexSets=[]}get convexSets(){return this._convexSets}toJSON(){const e=[];for(const t of this._convexSets)e.push(t.toJSON());return e}static fromJSON(e,t){if((t=t||new UnionOfConvexClipPlaneSets)._convexSets.length=0,!Array.isArray(e))return t;for(const r of e)t._convexSets.push(a.ConvexClipPlaneSet.fromJSON(r));return t}static createEmpty(e){return e?(e._convexSets.length=0,e):new UnionOfConvexClipPlaneSets}isAlmostEqual(e){if(this._convexSets.length!==e._convexSets.length)return!1;for(let t=0;t<this._convexSets.length;t++)if(!this._convexSets[t].isAlmostEqual(e._convexSets[t]))return!1;return!0}static createConvexSets(e,t){t=t||new UnionOfConvexClipPlaneSets;for(const r of e)t._convexSets.push(r);return t}clone(e){(e=e||new UnionOfConvexClipPlaneSets)._convexSets.length=0;for(const t of this._convexSets)e._convexSets.push(t.clone());return e}addConvexSet(e){this._convexSets.push(e)}testRayIntersect(e,t){const r=new Float64Array(1);for(const n of this._convexSets)if(a.ConvexClipPlaneSet.testRayIntersections(r,e,t,n))return!0;return!1}getRayIntersection(e,t){let r=-a.ConvexClipPlaneSet.hugeVal;for(const n of this._convexSets){if(n.isPointInside(e))return 0;{const i=new Float64Array(1);a.ConvexClipPlaneSet.testRayIntersections(i,e,t,n)&&i[0]>r&&(r=i[0])}}return r>-a.ConvexClipPlaneSet.hugeVal?r:void 0}isPointInside(e){for(const t of this._convexSets)if(t.isPointInside(e))return!0;return!1}isPointOnOrInside(e,t){for(const r of this._convexSets)if(r.isPointOnOrInside(e,t))return!0;return!1}isSphereInside(e,t){for(const r of this._convexSets)if(r.isSphereInside(e,t))return!0;return!1}isAnyPointInOrOnFromSegment(e){for(const t of this._convexSets)if(t.announceClippedSegmentIntervals(0,1,e.point0Ref,e.point1Ref))return!0;return!1}appendIntervalsFromSegment(e,t){for(const r of this._convexSets)r.announceClippedSegmentIntervals(0,1,e.point0Ref,e.point1Ref,(e,r)=>t.push(n.Segment1d.create(e,r)))}transformInPlace(e){for(const t of this._convexSets)t.transformInPlace(e)}classifyPointContainment(e,t){for(const r of this._convexSets){const n=r.classifyPointContainment(e,t);if(3!==n)return n}return 3}polygonClip(e,t){t.length=0;for(const r of this._convexSets){const n=[];r.polygonClip(e,n,[]),0!==n.length&&t.push(n)}}announceClippedSegmentIntervals(e,t,r,n,i){let o=0;for(const s of this._convexSets)s.announceClippedSegmentIntervals(e,t,r,n,i)&&o++;return o>0}announceClippedArcIntervals(e,t){const r=UnionOfConvexClipPlaneSets._clipArcFractionArray;r.clear();for(const n of this._convexSets)for(const t of n.planes)t.appendIntersectionRadians(e,r);return e.sweep.radiansArraytoPositivePeriodicFractions(r),s.ClipUtilities.selectIntervals01(e,r,this,t)}getRangeOfAlignedPlanes(e,t){const r=i.Range3d.createNull(t);for(const n of this._convexSets){const t=i.Range3d.createNull();n.getRangeOfAlignedPlanes(e,t)&&r.extendRange(t)}return r.isNull?void 0:r}multiplyPlanesByMatrix(e){for(const t of this._convexSets)t.multiplyPlanesByMatrix(e)}setInvisible(e){for(const t of this._convexSets)t.setInvisible(e)}addOutsideZClipSets(e,t,r){if(t){const r=a.ConvexClipPlaneSet.createEmpty();r.addZClipPlanes(e,t),this._convexSets.push(r)}if(r){const t=a.ConvexClipPlaneSet.createEmpty();t.addZClipPlanes(e,void 0,r),this._convexSets.push(t)}}}UnionOfConvexClipPlaneSets._clipArcFractionArray=new o.GrowableFloat64Array,t.UnionOfConvexClipPlaneSets=UnionOfConvexClipPlaneSets},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(168),i=r(169),o=r(13),s=r(6),a=r(23),c=r(9),l=r(5),u=r(24),d=r(259),h=r(170);!function(e){e[e.None=0]="None",e[e.XLow=1]="XLow",e[e.XHigh=2]="XHigh",e[e.YLow=4]="YLow",e[e.YHigh=8]="YHigh",e[e.ZLow=16]="ZLow",e[e.ZHigh=32]="ZHigh",e[e.XAndY=15]="XAndY",e[e.All=63]="All"}(t.ClipMask||(t.ClipMask={}));class PolyEdge{constructor(e,t,r,n){this.origin=s.Point3d.create(e.x,e.y,n),this.next=s.Point3d.create(t.x,t.y,n),this.normal=r}}t.PlaneSetParamsCache=class PlaneSetParamsCache{constructor(e,t,r,n=!1,i=!1,o=0){this.clipPlaneSet=d.UnionOfConvexClipPlaneSets.createEmpty(),this.zLow=e,this.zHigh=t,this.isMask=n,this.invisible=i,this.focalLength=o,this.limitValue=0,this.localOrigin=r||s.Point3d.create()}};class ClipPrimitive{constructor(e,t=!1){this._clipPlanes=e,this._invisible=t}transformInPlace(e){return this._clipPlanes&&this._clipPlanes.transformInPlace(e),this._maskPlanes&&this._maskPlanes.transformInPlace(e),!0}setInvisible(e){this._invisible=e,this._clipPlanes&&this._clipPlanes.setInvisible(e),this._maskPlanes&&this._maskPlanes.setInvisible(e)}containsZClip(){if(void 0!==this.fetchClipPlanesRef())for(const e of this._clipPlanes.convexSets)for(const t of e.planes)if(Math.abs(t.inwardNormalRef.z)>1e-6&&Math.abs(t.distance)!==Number.MAX_VALUE)return!0;return!1}classifyPointContainment(e,t){if(void 0!==this.fetchMaskPlanesRef()){if(t)return 1;switch(this._maskPlanes.classifyPointContainment(e,!0)){case 1:return 3;case 3:return 1;case 2:return 2}}return void 0===this.fetchClipPlanesRef()?1:this._clipPlanes.classifyPointContainment(e,!1)}static isLimitEdge(e,t,r){const n=1e-5*e;return Math.abs(t.x-e)<n&&Math.abs(r.x-e)<n||(Math.abs(t.x+e)<n&&Math.abs(r.x+e)<n||(Math.abs(t.y-e)<n&&Math.abs(r.y-e)<n||Math.abs(t.y+e)<n&&Math.abs(r.y+e)<n))}static addOutsideEdgeSetToParams(e,t,r,o,a,c=!1){const l=s.Vector3d.create(),u=s.Vector3d.create(r-e,o-t,0),d=s.Point3d.create(e+a.localOrigin.x,t+a.localOrigin.y,0);u.normalize(l);const h=s.Vector3d.create(l.y,-l.x,0),p=i.ConvexClipPlaneSet.createEmpty();p.planes.push(n.ClipPlane.createNormalAndPoint(h,d,c)),p.planes.push(n.ClipPlane.createNormalAndPoint(l,d,c)),p.addZClipPlanes(c,a.zLow,a.zHigh),a.clipPlaneSet.convexSets.push(p)}static addShapeToParams(e,t,r){const o=e.slice(0);o[0].isExactEqual(o[o.length-1])||o.push(o[0].clone());const a=u.PolygonOps.areaXY(o),c=o.length,l=s.Point3d.create(),d=s.Point3d.create(),h=s.Vector3d.create(),p=s.Vector3d.create(),f=s.Point3d.create();let g=s.Point3d.create();const m=s.Vector3d.create(0,0,1);let y,v;const _=i.ConvexClipPlaneSet.createEmpty(),w=a<0;for(let i=0;i<c;i++,l.setFrom(d),f.setFrom(g))if((g=o[i%c]).plus(r.localOrigin,d),i&&!d.isAlmostEqual(l,1e-8)){const e=ClipPrimitive.isLimitEdge(r.limitValue,f,g),o=0===(1&t[i-1])||e;r.focalLength?(p.setFrom(d),h.setFrom(l),y=p.crossProduct(h).normalize(),w&&y.negate(),_.planes.push(n.ClipPlane.createNormalAndDistance(y,0,r.invisible,o))):(v=s.Vector3d.createFrom(d.minus(l)),y=m.crossProduct(v).normalize(),w&&y.negate(y),_.planes.push(n.ClipPlane.createNormalAndPoint(y,l,r.invisible,o)))}_.addZClipPlanes(r.invisible,r.zLow,r.zHigh),0!==_.planes.length&&r.clipPlaneSet.convexSets.push(_)}}t.ClipPrimitive=ClipPrimitive;class ClipShape extends ClipPrimitive{constructor(e=[],t,r,n,i=!1,o=!1){super(void 0,o),this._isMask=!1,this._zLowValid=!1,this._zHighValid=!1,this._transformValid=!1,this._polygon=e,this.initSecondaryProps(i,t,r,n)}get invisible(){return this._invisible}get transformFromClip(){return this._transformFromClip}get transformToClip(){return this._transformToClip}get transformValid(){return this._transformValid}get zLowValid(){return this._zLowValid}get zHighValid(){return this._zHighValid}get zLow(){return this._zLow}get zHigh(){return this._zHigh}get polygon(){return this._polygon}get bCurve(){return this._bCurve}get isMask(){return this._isMask}arePlanesDefined(){return this._isMask?void 0!==this._maskPlanes:void 0!==this._clipPlanes}setPolygon(e){e[0].isAlmostEqual(e[e.length-1])||e.push(e[0].clone()),this._polygon=e}fetchClipPlanesRef(){return void 0!==this._clipPlanes?this._clipPlanes:(this._clipPlanes=d.UnionOfConvexClipPlaneSets.createEmpty(),this.parseClipPlanes(this._clipPlanes),this._transformValid&&this._clipPlanes.transformInPlace(this._transformFromClip),this._clipPlanes)}fetchMaskPlanesRef(){if(this._isMask)return void 0!==this._maskPlanes?this._maskPlanes:(this._maskPlanes=d.UnionOfConvexClipPlaneSets.createEmpty(),this.parseClipPlanes(this._maskPlanes),this._transformValid&&this._maskPlanes.transformInPlace(this._transformFromClip),this._maskPlanes)}initSecondaryProps(e,t,r,n){this._isMask=e,this._zLowValid=void 0!==t,this._zLow=t,this._zHighValid=void 0!==r,this._zHigh=r,this._transformValid=void 0!==n,!1!==this._transformValid?(this._transformFromClip=n,this._transformToClip=n.inverse()):(this._transformFromClip=c.Transform.createIdentity(),this._transformToClip=c.Transform.createIdentity())}toJSON(){const e={shape:{}};e.shape.points=[];for(const t of this._polygon)e.shape.points.push(t.toJSON());return this.invisible&&(e.shape.invisible=!0),this._transformFromClip&&!this._transformFromClip.isIdentity&&(e.shape.trans=this._transformFromClip.toJSON()),this.isMask&&(e.shape.mask=!0),"undefined"!==typeof this.zLow&&this.zLow!==-Number.MAX_VALUE&&(e.shape.zlow=this.zLow),"undefined"!==typeof this.zHigh&&this.zHigh!==Number.MAX_VALUE&&(e.shape.zhigh=this.zHigh),e}static fromJSON(e,t){if(!e.shape)return;const r=[];if(e.shape.points)for(const c of e.shape.points)r.push(s.Point3d.fromJSON(c));let n,i,o;e.shape.trans&&(n=c.Transform.fromJSON(e.shape.trans)),e.shape.zlow&&(i=e.shape.zlow),e.shape.zhigh&&(o=e.shape.zhigh);let a=!1;e.shape.mask&&(a=e.shape.mask);let l=!1;return e.shape.invisible&&(l=!0),ClipShape.createShape(r,i,o,n,a,l,t)}static createFrom(e,t){const r=ClipShape.createEmpty(!1,!1,void 0,t);r._invisible=e._invisible;for(const n of e._polygon)r._polygon.push(n.clone());return r._isMask=e._isMask,r._zLow=e._zLow,r._zHigh=e._zHigh,r._zLowValid=e._zLowValid,r._zHighValid=e._zHighValid,r._transformValid=e._transformValid,r._transformToClip=e._transformToClip?e._transformToClip.clone():void 0,r._transformFromClip=e._transformFromClip?e._transformFromClip.clone():void 0,r._bCurve=e._bCurve?e._bCurve.clone():void 0,r}static createShape(e=[],t,r,n,i=!1,o=!1,s){if(e.length<3)return;const a=e.slice(0);return a[0].isExactEqual(a[a.length-1])||a.push(a[0]),s?(s._clipPlanes=void 0,s._maskPlanes=void 0,s._invisible=o,s._polygon=a,s.initSecondaryProps(i,t,r,n),s):new ClipShape(a,t,r,n,i,o)}static createBlock(e,t,r=!1,n=!1,i,o){const a=e.low,c=e.high,l=[];for(let u=0;u<5;u++)l.push(s.Point3d.create());return l[0].x=l[3].x=l[4].x=a.x,l[1].x=l[2].x=c.x,l[0].y=l[1].y=l[4].y=a.y,l[2].y=l[3].y=c.y,ClipShape.createShape(l,0!==(16&t)?a.z:void 0,0!==(32&t)?c.z:void 0,i,r,n,o)}static createEmpty(e=!1,t=!1,r,n){return n?(n._clipPlanes=void 0,n._maskPlanes=void 0,n._invisible=t,n._bCurve=void 0,n._polygon.length=0,n.initSecondaryProps(e,void 0,void 0,r),n):new ClipShape([],void 0,void 0,r,e,t)}get isValidPolygon(){return!(this._polygon.length<3)&&!!this._polygon[0].isExactEqual(this._polygon[this._polygon.length-1])}clone(e){return ClipShape.createFrom(this,e)}parseClipPlanes(e){const t=this._polygon;if(3===t.length&&!this._isMask&&t[0].isExactEqual(t[t.length-1]))return this.parseLinearPlanes(e,this._polygon[0],this._polygon[1]),!0;const r=u.PolygonOps.testXYPolygonTurningDirections(t);return 0!==r?(this.parseConvexPolygonPlanes(e,this._polygon,r),!0):(this.parseConcavePolygonPlanes(e,this._polygon),!1)}parseLinearPlanes(e,t,r,a){const c=t.vectorTo(r);if(0===c.magnitude())return!1;c.normalize(c);const l=i.ConvexClipPlaneSet.createEmpty();if(void 0===a){const e=o.Vector2d.create(-c.y,c.x);l.planes.push(n.ClipPlane.createNormalAndPoint(s.Vector3d.create(c.x,c.y),s.Point3d.createFrom(t),this._invisible)),l.planes.push(n.ClipPlane.createNormalAndPoint(s.Vector3d.create(-c.x,-c.y),s.Point3d.createFrom(r),this._invisible)),l.planes.push(n.ClipPlane.createNormalAndPoint(s.Vector3d.create(e.x,e.y),s.Point3d.createFrom(t),this._invisible)),l.planes.push(n.ClipPlane.createNormalAndPoint(s.Vector3d.create(-e.x,-e.y),s.Point3d.createFrom(t),this._invisible))}else{const e=s.Point3d.create(t.x,t.y,-a),i=s.Point3d.create(r.x,r.y,-a),o=s.Vector3d.createFrom(i),c=o.crossProduct(s.Vector3d.createFrom(e)).normalize();let u=s.Vector3d.createFrom(e).crossProduct(c).normalize();l.planes.push(n.ClipPlane.createNormalAndDistance(c,0,this._invisible)),l.planes.push(n.ClipPlane.createNormalAndDistance(u,0,this._invisible)),c.negate(),u=o.crossProduct(c).normalize(),l.planes.push(n.ClipPlane.createNormalAndDistance(c,0,this._invisible)),l.planes.push(n.ClipPlane.createNormalAndDistance(u,0,this._invisible))}return l.addZClipPlanes(this._invisible,this._zLow,this._zHigh),e.addConvexSet(l),!0}parseConvexPolygonPlanes(e,t,r,a){const c=[],l=r<0!==this._isMask;for(let n=0;n<t.length-1;n++){const e=void 0===a?0:-a,r=o.Vector2d.createFrom(t[n+1].minus(t[n])),i=r.magnitude();if(r.normalize(r),i>1e-8){const i=o.Vector2d.create(l?r.y:-r.y,l?-r.x:r.x);c.push(new PolyEdge(t[n],t[n+1],i,e))}}if(c.length<3)return!1;if(this._isMask){const t=c.length-1;for(let r=0;r<=t;r++){const o=c[r],a=c[r?r-1:t],l=c[r===t?0:r+1],u=i.ConvexClipPlaneSet.createEmpty(),d=o.normal.minus(a.normal),h=o.normal.minus(l.normal);d.normalize(d),h.normalize(h),u.planes.push(n.ClipPlane.createNormalAndPoint(s.Vector3d.create(d.x,d.y),o.origin,this._invisible,!0)),u.planes.push(n.ClipPlane.createNormalAndPoint(s.Vector3d.create(o.normal.x,o.normal.y),o.origin,this._invisible,!1)),u.planes.push(n.ClipPlane.createNormalAndPoint(s.Vector3d.create(h.x,h.y),l.origin,this._invisible,!0)),u.addZClipPlanes(this._invisible,this._zLow,this._zHigh),e.addConvexSet(u)}e.addOutsideZClipSets(this._invisible,this._zLow,this._zHigh)}else{const t=i.ConvexClipPlaneSet.createEmpty();if(void 0===a)for(const e of c)t.planes.push(n.ClipPlane.createNormalAndPoint(s.Vector3d.create(e.normal.x,e.normal.y),e.origin));else if(l)for(const e of c)t.planes.push(n.ClipPlane.createNormalAndDistance(s.Vector3d.createFrom(e.origin).crossProduct(s.Vector3d.createFrom(e.next)).normalize(),0));else for(const e of c)t.planes.push(n.ClipPlane.createNormalAndDistance(s.Vector3d.createFrom(e.next).crossProduct(s.Vector3d.createFrom(e.origin)).normalize(),0));t.addZClipPlanes(this._invisible,this._zLow,this._zHigh),e.addConvexSet(t)}return!0}parseConcavePolygonPlanes(e,t,r){const n=h.Triangulator.earcutSingleLoop(t);return h.Triangulator.cleanupTriangulation(n),n.announceFaceLoops((t,n)=>{if(!n.isMaskSet(1)){const t=n.collectAroundFace(e=>{if(!e.isMaskSet(1))return s.Point3d.create(e.x,e.y,0)});t.push(t[0]);const i=u.PolygonOps.testXYPolygonTurningDirections(t);this.parseConvexPolygonPlanes(e,t,i,r)}return!0}),!0}getRange(e=!1,t,r){let n=Number.MAX_VALUE,i=-Number.MAX_VALUE;if(t=void 0===t?c.Transform.createIdentity():t,void 0!==this._transformToClip&&t.setMultiplyTransformTransform(t,this._transformFromClip),!e&&this._isMask||void 0===this._polygon)return;this._zLowValid&&(i=this._zLow),this._zHighValid&&(n=this._zHigh);const o=a.Range3d.createNull(r);for(const a of this._polygon){const e=[s.Point3d.create(a.x,a.y,i),s.Point3d.create(a.x,a.y,n)];t.multiplyPoint3dArray(e,e),o.extend(e[0],e[1])}return o.isNull?void 0:o}pointInside(e,t=l.Geometry.smallMetricDistanceSquared){return void 0!==this.fetchMaskPlanesRef()?!this._maskPlanes.isPointOnOrInside(e,t):this.fetchClipPlanesRef().isPointOnOrInside(e,t)}transformInPlace(e){return!!e.isIdentity||(super.transformInPlace(e),this._transformValid?e.multiplyTransformTransform(this._transformFromClip,this._transformFromClip):this._transformFromClip=e,this._transformToClip=this._transformFromClip.inverse(),this._transformValid=!0,!0)}multiplyPlanesTimesMatrix(e){return!this._isMask&&(this._clipPlanes=d.UnionOfConvexClipPlaneSets.createEmpty(),this._maskPlanes=void 0,this.parseClipPlanes(this._clipPlanes),this._clipPlanes.multiplyPlanesByMatrix(e),!0)}get isXYPolygon(){if(0===this._polygon.length)return!1;if(void 0===this._transformFromClip)return!0;const e=s.Vector3d.create(0,0,1);return this._transformFromClip.multiplyVectorXYZ(e.x,e.y,e.z,e),e.magnitudeXY()<1e-8}performTransformToClip(e){void 0!==this._transformToClip&&this._transformToClip.multiplyPoint3d(e)}performTransformFromClip(e){void 0!==this._transformFromClip&&this._transformFromClip.multiplyPoint3d(e)}}t.ClipShape=ClipShape},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(6),o=r(51),s=r(5);class HalfEdge{constructor(e=0,t=0,r=0,n=0){this._id=HalfEdge._totalNodesCreated++,this.i=n,this.maskBits=0,this.x=e,this.y=t,this.z=r,this.steiner=!1}get id(){return this._id}get facePredecessor(){return this._facePredecessor}get faceSuccessor(){return this._faceSuccessor}get edgeMate(){return this._edgeMate}static createHalfEdgePair(e){const t=new HalfEdge,r=new HalfEdge;return e&&(e.push(t),e.push(r)),HalfEdge.setFaceLinks(t,r),HalfEdge.setFaceLinks(r,t),HalfEdge.setEdgeMates(t,r),t}static createHalfEdgePairWithCoordinates(e=0,t=0,r=0,n=0,i=0,o=0,s=0,a=0,c){const l=HalfEdge.createHalfEdgePair(c),u=l._edgeMate;return l.x=e,l.y=t,l.z=r,l.i=n,u.x=i,u.y=o,u.z=s,u.i=a,l}static setFaceLinks(e,t){e._faceSuccessor=t,t._facePredecessor=e}static setEdgeMates(e,t){e._edgeMate=t,t._edgeMate=e}static splitEdge(e,t=0,r=0,n=0,i=0,o){const s=new HalfEdge(t,r,n,i),a=new HalfEdge(t,r,n,i);if(o&&(o.push(s),o.push(a)),void 0===e)s._faceSuccessor=s._facePredecessor=s,a._faceSuccessor=a._facePredecessor=a,HalfEdge.setEdgeMates(s,a);else{const t=e._faceSuccessor,r=e._edgeMate,n=r._faceSuccessor;HalfEdge.setFaceLinks(s,t),HalfEdge.setFaceLinks(e,s),HalfEdge.setFaceLinks(r,a),HalfEdge.setFaceLinks(a,n),HalfEdge.setEdgeMates(s,r),HalfEdge.setEdgeMates(a,e)}return s}get vertexSuccessor(){return this.facePredecessor.edgeMate}get vertexPredecessor(){return this.edgeMate.faceSuccessor}setMask(e){this.maskBits|=e}getMask(e){return this.maskBits&e}clearMask(e){this.maskBits&=~e}setMaskAroundVertex(e){let t=this;do{t.setMask(e),t=t.vertexSuccessor}while(t!==this)}setMaskAroundFace(e){let t=this;do{t.setMask(e),t=t.faceSuccessor}while(t!==this)}countEdgesAroundFace(){let e=0,t=this;do{e++,t=t.faceSuccessor}while(t!==this);return e}countEdgesAroundVertex(){let e=0,t=this;do{e++,t=t.vertexSuccessor}while(t!==this);return e}countMaskAroundFace(e,t=!0){let r=0,n=this;if(t)do{n.isMaskSet(e)&&r++,n=n.faceSuccessor}while(n!==this);else do{n.isMaskSet(e)||r++,n=n.faceSuccessor}while(n!==this);return r}countMaskAroundVertex(e,t=!0){let r=0,n=this;if(t)do{n.isMaskSet(e)&&r++,n=n.vertexSuccessor}while(n!==this);else do{n.isMaskSet(e)||r++,n=n.vertexSuccessor}while(n!==this);return r}testAndSetMask(e){const t=this.maskBits&e;return this.maskBits|=e,t}isMaskSet(e){return 0!==(this.maskBits&e)}static filterIsMaskOn(e,t){return e.isMaskSet(t)}static filterIsMaskOff(e,t){return!e.isMaskSet(t)}static createEdgeXYXY(e,t,r,n,i,o){const s=new HalfEdge(t,r),a=new HalfEdge(i,o);return s._faceSuccessor=s._facePredecessor=s._edgeMate=a,a._faceSuccessor=a._facePredecessor=a._edgeMate=s,s._id=e,a._id=n,s}static pinch(e,t){const r=e._facePredecessor,n=t._facePredecessor;r&&n&&(t._facePredecessor=r,e._facePredecessor=n,n._faceSuccessor=e,r._faceSuccessor=t)}decomission(){this._facePredecessor=void 0,this._faceSuccessor=void 0,this._edgeMate=void 0,this.nextZ=void 0,this.prevZ=void 0}static nodeToSelf(e){return e}static nodeToId(e){return e.id}static nodeToIdString(e){return e.id.toString()}static nodeToIdMaskXY(e){return{id:e.id,mask:HalfEdge.nodeToMaskString(e),xy:[e.x,e.y]}}static nodeToIdXYString(e){return e.id.toString()+" "+HalfEdge.nodeToMaskString(e)+" ["+e.x+","+e.y+"]"}static nodeToMaskString(e){let t="";return e.isMaskSet(2)&&(t+="B"),e.isMaskSet(512)&&(t+="P"),e.isMaskSet(1)&&(t+="X"),t}static nodeToXY(e){return[e.x,e.y]}vectorToFaceSuccessorXY(e){return n.Vector2d.create(this.faceSuccessor.x-this.x,this.faceSuccessor.y-this.y,e)}vectorToFaceSuccessor(e){return i.Vector3d.create(this.faceSuccessor.x-this.x,this.faceSuccessor.y-this.y,this.faceSuccessor.z-this.z,e)}static testNodeMaskNotExterior(e){return!e.isMaskSet(1)}isEqualXY(e){return this.x===e.x&&this.y===e.y}distanceXY(e){return s.Geometry.distanceXYXY(this.x,this.y,e.x,e.y)}collectAroundFace(e){const t=[];let r=this;do{t.push(e?e(r):r),r=r.faceSuccessor}while(r!==this);return t}collectAroundVertex(e){const t=[];let r=this;do{t.push(e?e(r):r),r=r.vertexSuccessor}while(r!==this);return t}sumAroundFace(e){let t=this,r=0;do{r+=e(t),t=t.faceSuccessor}while(t!==this);return r}sumAroundVertex(e){let t=this,r=0;do{r+=e(t),t=t.vertexSuccessor}while(t!==this);return r}clearMaskAroundFace(e){let t=this;do{t.clearMask(e),t=t.faceSuccessor}while(t!==this)}clearMaskAroundVertex(e){let t=this;do{t.clearMask(e),t=t.vertexSuccessor}while(t!==this)}signedFaceArea(){let e=0;const t=this.y;let r=0,n=0,i=this.x,o=i,s=this,a=this;do{e+=(i-(o=(s=a.faceSuccessor).x))*(r+(n=s.y-t)),i=o,r=n,a=s,a=s}while(a!==this);return.5*e}}HalfEdge._totalNodesCreated=0,t.HalfEdge=HalfEdge;t.HalfEdgeGraph=class HalfEdgeGraph{constructor(){this._numNodesCreated=0,this.allHalfEdges=[]}createEdgeXYZXYZ(e=0,t=0,r=0,n=0,i=0,o=0,s=0,a=0){return HalfEdge.createHalfEdgePairWithCoordinates(e,t,r,n,i,o,s,a,this.allHalfEdges)}splitEdge(e,t=0,r=0,n=0,i=0){return HalfEdge.splitEdge(e,t,r,n,i,this.allHalfEdges)}decommission(){for(const e of this.allHalfEdges)e.decomission();this.allHalfEdges.length=0,this.allHalfEdges=void 0}addEdgeXY(e,t,r,n){const i=HalfEdge.createEdgeXYXY(this._numNodesCreated,e,t,this._numNodesCreated+1,r,n);return this._numNodesCreated+=2,this.allHalfEdges.push(i),this.allHalfEdges.push(i.faceSuccessor),i}clearMask(e){for(const t of this.allHalfEdges)t.maskBits&=~e}setMask(e){for(const t of this.allHalfEdges)t.maskBits|=e}reverseMask(e){for(const t of this.allHalfEdges)t.maskBits^=e}countMask(e){let t=0;for(const r of this.allHalfEdges)r.isMaskSet(e)&&t++;return t}collectSegments(){const e=[];for(const t of this.allHalfEdges)t.id<t.edgeMate.id&&e.push(o.LineSegment3d.create(i.Point3d.create(t.x,t.y),i.Point3d.create(t.faceSuccessor.x,t.faceSuccessor.y)));return e}countVertexLoops(){this.clearMask(8192);let e=0;return this.announceVertexLoops((t,r)=>(e++,!0)),e}countFaceLoops(){this.clearMask(8192);let e=0;return this.announceFaceLoops((t,r)=>(e++,!0)),e}countFaceLoopsWithMaskFilter(e,t){this.clearMask(8192);let r=0;return this.announceFaceLoops((n,i)=>(e(i,t)&&r++,!0)),r}collectFaceLoops(){const e=[];return this.announceFaceLoops((t,r)=>(e.push(r),!0)),e}collectVertexLoops(){this.clearMask(8192);const e=[];for(const t of this.allHalfEdges)t.getMask(8192)||(e.push(t),t.setMaskAroundVertex(8192));return e}announceFaceLoops(e){this.clearMask(8192);for(const t of this.allHalfEdges)if(!t.getMask(8192)&&(t.setMaskAroundFace(8192),!e(this,t)))break}announceVertexLoops(e){this.clearMask(8192);for(const t of this.allHalfEdges)if(!t.getMask(8192)&&(t.setMaskAroundVertex(8192),!e(this,t)))break}countNodes(){return this.allHalfEdges.length}},function(e){e[e.EXTERIOR=1]="EXTERIOR",e[e.BOUNDARY=2]="BOUNDARY",e[e.CONSTU_MASK=4]="CONSTU_MASK",e[e.CONSTV_MASK=8]="CONSTV_MASK",e[e.USEAM_MASK=16]="USEAM_MASK",e[e.VSEAM_MASK=32]="VSEAM_MASK",e[e.BOUNDARY_VERTEX_MASK=64]="BOUNDARY_VERTEX_MASK",e[e.PRIMARY_VERTEX_MASK=128]="PRIMARY_VERTEX_MASK",e[e.DIRECTED_EDGE_MASK=256]="DIRECTED_EDGE_MASK",e[e.PRIMARY_EDGE=512]="PRIMARY_EDGE",e[e.HULL_MASK=1024]="HULL_MASK",e[e.SECTION_EDGE_MASK=2048]="SECTION_EDGE_MASK",e[e.POLAR_LOOP_MASK=4096]="POLAR_LOOP_MASK",e[e.VISITED=8192]="VISITED",e[e.TRIANGULATED_NODE_MASK=16384]="TRIANGULATED_NODE_MASK",e[e.NULL_MASK=0]="NULL_MASK",e[e.ALL_MASK=4294967295]="ALL_MASK"}(t.HalfEdgeMask||(t.HalfEdgeMask={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(9),o=r(10),s=r(99);class MomentData{constructor(){this.origin=n.Point3d.createZero(),this.sums=s.Matrix4d.createZero(),this.localToWorldMap=i.Transform.createIdentity(),this.radiusOfGyration=n.Vector3d.create()}static momentTensorFromInertiaProducts(e){const t=e.sumDiagonal(),r=o.Matrix3d.createScale(t,t,t);return r.addScaledInPlace(e,-1),r}static sortColumnsForIncreasingMoments(e,t){const r=[e.indexedColumnWithWeight(0,t.x),e.indexedColumnWithWeight(1,t.y),e.indexedColumnWithWeight(2,t.z)].sort((e,t)=>e.w<t.w?-1:e.w>t.w?1:0);e.setColumnsPoint4dXYZ(r[0],r[1],r[2]),t.set(r[0].w,r[1].w,r[2].w)}static pointsToPrincipalAxes(e){const t=new MomentData;if(0===e.length)return t;if(t.clearSums(e[0]),t.accumulatePointMomentsFromOrigin(e),t.shiftSumsToCentroid()){const e=t.sums.matrixPart(),r=MomentData.momentTensorFromInertiaProducts(e),s=n.Vector3d.create(),a=o.Matrix3d.createZero();r.fastSymmetricEigenvalues(a,s),MomentData.sortColumnsForIncreasingMoments(a,s),t.localToWorldMap=i.Transform.createOriginAndMatrix(t.origin,a),t.radiusOfGyration.set(Math.sqrt(s.x),Math.sqrt(s.y),Math.sqrt(s.z)),t.radiusOfGyration.scaleInPlace(1/Math.sqrt(t.sums.weight()))}return t}static inertiaProductsToPrincipalAxes(e,t){const r=new MomentData;if(r.sums.setFrom(t),r.origin.setFrom(e),!r.shiftSumsToCentroid())return;const s=r.sums.matrixPart(),a=MomentData.momentTensorFromInertiaProducts(s),c=n.Vector3d.create(),l=o.Matrix3d.createZero();return a.fastSymmetricEigenvalues(l,c),MomentData.sortColumnsForIncreasingMoments(l,c),r.localToWorldMap=i.Transform.createOriginAndMatrix(r.origin,l),r.radiusOfGyration.set(Math.sqrt(c.x),Math.sqrt(c.y),Math.sqrt(c.z)),r.radiusOfGyration.scaleInPlace(1/Math.sqrt(r.sums.weight())),r}clearSums(e){this.sums.setZero(),e?this.origin.setFrom(e):this.origin.setZero()}accumulatePointMomentsFromOrigin(e){for(const t of e)this.sums.addMomentsInPlace(t.x-this.origin.x,t.y-this.origin.y,t.z-this.origin.z,1)}shiftSumsToCentroid(){const e=this.sums.columnW().realPoint();if(e){this.origin.addInPlace(e);const t=s.Matrix4d.createTranslationXYZ(-e.x,-e.y,-e.z);return t.multiplyMatrixMatrix(this.sums).multiplyMatrixMatrixTranspose(t,this.sums),!0}return!1}}t.MomentData=MomentData},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(101),i=r(51),o=r(60),s=r(6),a=r(14);class ConstructCurveBetweenCurves extends n.NullGeometryHandler{constructor(e,t,r){super(),this._geometry1=r,this._fraction=t}handleLineSegment3d(e){if(this._geometry1 instanceof i.LineSegment3d){const t=this._geometry1;return i.LineSegment3d.create(e.startPoint().interpolate(this._fraction,t.startPoint()),e.endPoint().interpolate(this._fraction,t.endPoint()))}}handleLineString3d(e){if(this._geometry1 instanceof a.LineString3d){const t=this._geometry1;if(e.numPoints()===t.numPoints()){const r=a.LineString3d.create(),n=s.Point3d.create(),i=s.Point3d.create(),o=s.Point3d.create();for(let s=0;s<e.numPoints();s++)e.pointAt(s,i),t.pointAt(s,o),i.interpolate(this._fraction,o,n),r.addPoint(n);return r}}}handleArc3d(e){if(this._geometry1 instanceof o.Arc3d){const t=this._geometry1;return o.Arc3d.create(e.center.interpolate(this._fraction,t.center),e.vector0.interpolate(this._fraction,t.vector0),e.vector90.interpolate(this._fraction,t.vector90),e.sweep.interpolate(this._fraction,t.sweep))}}static InterpolateBetween(e,t,r){const n=new ConstructCurveBetweenCurves(e,t,r);return e.dispatchToGeometryHandler(n)}}t.ConstructCurveBetweenCurves=ConstructCurveBetweenCurves},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(33),i=r(39),o=r(127);class UnionRegion extends n.CurveCollection{isSameGeometryClass(e){return e instanceof UnionRegion}get children(){return this._children}constructor(){super(),this._children=[]}static create(...e){const t=new UnionRegion;for(const r of e)t.tryAddChild(r);return t}dgnBoundaryType(){return 5}announceToCurveProcessor(e,t=-1){return e.announceUnionRegion(this,t)}cloneStroked(e){const t=new UnionRegion;let r;for(r of this._children){const n=r.cloneStroked(e);n&&t.children.push(n)}return t}cloneEmptyPeer(){return new UnionRegion}tryAddChild(e){return(e instanceof o.ParityRegion||e instanceof i.Loop)&&(this._children.push(e),!0)}getChild(e){if(e<this._children.length)return this._children[e]}dispatchToGeometryHandler(e){return e.handleUnionRegion(this)}}t.UnionRegion=UnionRegion},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(23),i=r(50);class CoordinateXYZ extends i.GeometryQuery{get point(){return this._xyz}constructor(e){super(),this._xyz=e}static create(e){return new CoordinateXYZ(e.clone())}range(){return n.Range3d.create(this._xyz)}extendRange(e,t){t?e.extendTransformedXYZ(t,this._xyz.x,this._xyz.y,this._xyz.z):e.extend(this._xyz)}tryTransformInPlace(e){return e.multiplyPoint3d(this._xyz,this._xyz),!0}cloneTransformed(e){const t=new CoordinateXYZ(this._xyz.clone());return t.tryTransformInPlace(e),t}clone(){return new CoordinateXYZ(this._xyz.clone())}isSameGeometryClass(e){return e instanceof CoordinateXYZ}isAlmostEqual(e){return e instanceof CoordinateXYZ&&this._xyz.isAlmostEqual(e._xyz)}dispatchToGeometryHandler(e){return e.handleCoordinateXYZ(this)}}t.CoordinateXYZ=CoordinateXYZ},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(6),o=r(24),s=r(50);class PointString3d extends s.GeometryQuery{isSameGeometryClass(e){return e instanceof PointString3d}get points(){return this._points}constructor(){super(),this._points=[]}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}static flattenArray(e){return e.reduce((e,t)=>e.concat(Array.isArray(t)?PointString3d.flattenArray(t):t),[])}static create(...e){const t=new PointString3d;return t.addPoints(e),t}addPoints(...e){const t=PointString3d.flattenArray(e);for(const r of t)r instanceof i.Point3d&&this._points.push(r)}addPoint(e){this._points.push(e)}popPoint(){this._points.pop()}setFrom(e){this._points=o.Point3dArray.clonePoint3dArray(e._points)}static createPoints(e){const t=new PointString3d;return t._points=o.Point3dArray.clonePoint3dArray(e),t}static createFloat64Array(e){const t=new PointString3d;for(let r=0;r+3<=e.length;r+=3)t._points.push(i.Point3d.create(e[r],e[r+1],e[r+2]));return t}clone(){const e=new PointString3d;return e.setFrom(this),e}setFromJSON(e){if(this._points.length=0,Array.isArray(e)){let t;for(t of e)this._points.push(i.Point3d.fromJSON(t))}}toJSON(){const e=[];for(const t of this._points)e.push(t.toJSON());return e}static fromJSON(e){const t=new PointString3d;return t.setFromJSON(e),t}pointAt(e,t){if(e>=0&&e<this._points.length)return t?(t.setFrom(this._points[e]),t):this._points[e].clone()}numPoints(){return this._points.length}reverseInPlace(){if(this._points.length>=2){let e=0,t=this._points.length-1;for(;e<t;){const r=this._points[e];this._points[t]=this._points[e],this._points[e]=r,e++,t--}}}tryTransformInPlace(e){return e.multiplyPoint3dArrayInPlace(this._points),!0}closestPoint(e){const t={index:-1,xyz:i.Point3d.create()},r=o.Point3dArray.closestPointIndex(this._points,e);return r>=0&&(t.index=r,t.xyz.setFrom(this._points[r])),t}isInPlane(e){return o.Point3dArray.isCloseToPlane(this._points,e,n.Geometry.smallMetricDistance)}extendRange(e,t){e.extendArray(this._points,t)}isAlmostEqual(e){return e instanceof PointString3d&&o.Point3dArray.isAlmostEqual(this._points,e._points)}clear(){this._points.length=0}dispatchToGeometryHandler(e){return e.handlePointString3d(this)}}t.PointString3d=PointString3d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(84),o=r(16),s=r(6),a=r(125),c=r(9),l=r(10),u=r(167),d=r(38),h=r(21),p=r(22),f=r(14);class TransitionConditionalProperties{constructor(e,t,r,n,i){this.radius0=e,this.radius1=t,this.bearing0=r,this.bearing1=n,this.curveLength=i}numDefinedProperties(){return n.Geometry.defined01(this.radius0)+n.Geometry.defined01(this.radius1)+n.Geometry.defined01(this.bearing0)+n.Geometry.defined01(this.bearing1)+n.Geometry.defined01(this.curveLength)}clone(){return new TransitionConditionalProperties(this.radius0,this.radius1,void 0===this.bearing0?void 0:this.bearing0.clone(),void 0===this.bearing1?void 0:this.bearing1.clone(),this.curveLength)}tryResolveAnySingleUnknown(){if(this.bearing0&&this.bearing1){const e=this.bearing1.radians-this.bearing0.radians;return void 0===this.curveLength&&void 0!==this.radius0&&void 0!==this.radius1?(this.curveLength=TransitionSpiral3d.radiusRadiusSweepRadiansToArcLength(this.radius0,this.radius1,e),!0):void 0!==this.curveLength&&void 0===this.radius0&&void 0!==this.radius1?(this.radius0=TransitionSpiral3d.radius1LengthSweepRadiansToRadius0(this.radius1,this.curveLength,e),!0):void 0!==this.curveLength&&void 0!==this.radius0&&void 0===this.radius1&&(this.radius1=TransitionSpiral3d.radius0LengthSweepRadiansToRadius1(this.radius0,this.curveLength,e),!0)}return void 0!==this.curveLength&&void 0!==this.radius0&&void 0!==this.radius1&&(this.bearing0?(this.bearing1=o.Angle.createRadians(this.bearing0.radians+TransitionSpiral3d.radiusRadiusLengthToSweepRadians(this.radius0,this.radius1,this.curveLength)),!0):!!this.bearing1&&(this.bearing0=o.Angle.createRadians(this.bearing1.radians-TransitionSpiral3d.radiusRadiusLengthToSweepRadians(this.radius0,this.radius1,this.curveLength)),!0))}almostEqualCoordinate(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&n.Geometry.isSameCoordinate(e,t)}almostEqualBearing(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&e.isAlmostEqualNoPeriodShift(t)}isAlmostEqual(e){return!!this.almostEqualCoordinate(this.radius0,e.radius0)&&(!!this.almostEqualCoordinate(this.radius1,e.radius1)&&(!!this.almostEqualBearing(this.bearing0,e.bearing0)&&(!!this.almostEqualBearing(this.bearing1,e.bearing1)&&!!this.almostEqualCoordinate(this.curveLength,e.curveLength))))}}t.TransitionConditionalProperties=TransitionConditionalProperties;class TransitionSpiral3d extends d.CurvePrimitive{constructor(e,t,r,n,i,o,s){super(),this._spiralType=e,this.localToWorld=i,this.radius01=t,this.bearing01=r,this.localToWorld=i,this.activeFractionInterval=n,this._arcLength01=o,this._strokes=f.LineString3d.create(),this._curvature01=a.Segment1d.create(0,1),this.refreshComputedProperties(),this._properties=s}static radiusToCurvature(e){return 0===e?0:1/e}static curvatureToRadius(e){return Math.abs(e)<n.Geometry.smallAngleRadians?0:1/e}static averageCurvature(e){return.5*(TransitionSpiral3d.radiusToCurvature(e.x0)+TransitionSpiral3d.radiusToCurvature(e.x1))}static averageCurvatureR0R1(e,t){return.5*(TransitionSpiral3d.radiusToCurvature(e)+TransitionSpiral3d.radiusToCurvature(t))}static radiusRadiusSweepRadiansToArcLength(e,t,r){return Math.abs(r/TransitionSpiral3d.averageCurvatureR0R1(e,t))}static radiusRadiusLengthToSweepRadians(e,t,r){return TransitionSpiral3d.averageCurvatureR0R1(e,t)*r}static radius0LengthSweepRadiansToRadius1(e,t,r){return TransitionSpiral3d.curvatureToRadius(2*r/t-TransitionSpiral3d.radiusToCurvature(e))}static radius1LengthSweepRadiansToRadius0(e,t,r){return TransitionSpiral3d.curvatureToRadius(2*r/t-TransitionSpiral3d.radiusToCurvature(e))}get originalProperties(){return this._properties}getSpiralType(){return void 0===this._spiralType?TransitionSpiral3d.defaultSpiralType:this._spiralType}fractionToBearingRadians(e){return this.bearing01.startRadians+e*(this._curvature01.x0+.5*e*(this._curvature01.x1-this._curvature01.x0))}fractionToCurvature(e){return this._curvature01.fractionToPoint(e)}static initWorkSpace(){TransitionSpiral3d._gaussFraction=new Float64Array(5),TransitionSpiral3d._gaussWeight=new Float64Array(5),TransitionSpiral3d._gaussMapper=u.Quadrature.setupGauss5}fullSpiralIncrementalIntegral(e,t,r){const n=TransitionSpiral3d._gaussFraction,i=TransitionSpiral3d._gaussWeight,o=TransitionSpiral3d._gaussMapper(t,r,n,i),s=this._arcLength01;let a=0;for(let c=0;c<o;c++){const t=this.fractionToBearingRadians(n[c]);a=i[c]*s,e.x+=a*Math.cos(t),e.y+=a*Math.sin(t)}}refreshComputedProperties(){this._curvature01=a.Segment1d.create(TransitionSpiral3d.radiusToCurvature(this.radius01.x0),TransitionSpiral3d.radiusToCurvature(this.radius01.x1)),this._strokes.clear();const e=s.Point3d.create();this._strokes.appendStrokePoint(e);for(let t=1;t<=8;t++){const r=1/8*(t-1),n=t*(1/8);this.fullSpiralIncrementalIntegral(e,r,n),this._strokes.appendStrokePoint(e)}this._strokes.tryTransformInPlace(this.localToWorld)}static createRadiusRadiusBearingBearing(e,t,r,n){const i=TransitionSpiral3d.radiusRadiusSweepRadiansToArcLength(e.x0,e.x1,t.sweepRadians);return new TransitionSpiral3d("clothoid",e.clone(),t.clone(),r.clone(),n.clone(),i,new TransitionConditionalProperties(e.x0,e.x1,t.startAngle.clone(),t.endAngle.clone(),void 0))}static create(e,t,r,n,o,s,c,l){const u=new TransitionConditionalProperties(t,r,n,o,s),d=u.clone();if(u.tryResolveAnySingleUnknown())return void 0===c&&(c=a.Segment1d.create(0,1)),new TransitionSpiral3d(e,a.Segment1d.create(u.radius0,u.radius1),i.AngleSweep.createStartEnd(u.bearing0,u.bearing1),c?c.clone():a.Segment1d.create(0,1),l,u.curveLength,d)}setFrom(e){return this.localToWorld.setFrom(e.localToWorld),this.radius01.setFrom(e.radius01),this._curvature01.setFrom(e._curvature01),this.bearing01.setFrom(e.bearing01),this.localToWorld.setFrom(e.localToWorld),this.activeFractionInterval.setFrom(e.activeFractionInterval),this._arcLength01=e._arcLength01,this}clone(){return TransitionSpiral3d.createRadiusRadiusBearingBearing(this.radius01,this.bearing01,this.activeFractionInterval,this.localToWorld)}tryTransformInPlace(e){return e.multiplyTransformTransform(this.localToWorld,this.localToWorld),!0}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}startPoint(){return this._strokes.startPoint()}endPoint(){return this._strokes.endPoint()}isInPlane(e){return e.isPointInPlane(this.localToWorld.origin)&&n.Geometry.isSameCoordinate(0,this.localToWorld.matrix.dotColumnX(e.getNormalRef()))&&n.Geometry.isSameCoordinate(0,this.localToWorld.matrix.dotColumnY(e.getNormalRef()))}quickLength(){return this._arcLength01}curveLength(){return this._arcLength01}isSameGeometryClass(e){return e instanceof TransitionSpiral3d}emitStrokes(e,t){this._strokes.emitStrokes(e,t)}emitStrokableParts(e,t){e.startParentCurvePrimitive(this),this._strokes.emitStrokableParts(e,t),e.endParentCurvePrimitive(this)}reverseInPlace(){this.activeFractionInterval.reverseInPlace(),this._strokes.reverseInPlace()}fractionToPoint(e,t){e=n.Geometry.clampToStartEnd(e,0,1);const r=this._strokes.points.length-1,i=Math.trunc(e*r),o=i/r;(t=t||new s.Point3d).setFrom(this._strokes.points[i]);const a=this.activeFractionInterval.fractionToPoint(o),c=this.activeFractionInterval.fractionToPoint(e);return this.fullSpiralIncrementalIntegral(t,a,c),this.localToWorld.multiplyPoint3d(t,t),t}fractionToPointAndDerivative(e,t){t=t||h.Ray3d.createZero(),this.fractionToPoint(e,t.origin);const r=this.fractionToBearingRadians(e),n=this._arcLength01;return this.localToWorld.matrix.multiplyXY(n*Math.cos(r),n*Math.sin(r),t.direction),t}fractionToFrenetFrame(e,t){(t=t||c.Transform.createIdentity()).origin.setFrom(this.fractionToPoint(e)),l.Matrix3d.createRigidFromMatrix3d(this.localToWorld.matrix,0,t.matrix);const r=this.fractionToBearingRadians(e),n=Math.cos(r),i=Math.sin(r);return t.matrix.applyGivensColumnOp(0,1,n,-i),t}fractionToPointAnd2Derivatives(e,t){const r=this.fractionToPoint(e),n=this.fractionToBearingRadians(e),i=Math.cos(n),o=Math.sin(n),s=this.localToWorld.matrix.multiplyXY(i,o),a=this.localToWorld.matrix.multiplyXY(-o,i);return a.scaleInPlace(this.fractionToCurvature(e)),p.Plane3dByOriginAndVectors.createCapture(r,s,a,t)}dispatchToGeometryHandler(e){return e.handleTransitionSpiral(this)}extendRange(e,t){this._strokes.extendRange(e,t)}isAlmostEqual(e){return e instanceof TransitionSpiral3d&&(this.radius01.isAlmostEqual(e.radius01)&&this.bearing01.isAlmostEqualAllowPeriodShift(e.bearing01)&&this.localToWorld.isAlmostEqual(e.localToWorld)&&n.Geometry.isSameCoordinate(this._arcLength01,e._arcLength01)&&this.activeFractionInterval.isAlmostEqual(e.activeFractionInterval)&&this._curvature01.isAlmostEqual(e._curvature01))}}TransitionSpiral3d.defaultSpiralType="clothoid",t.TransitionSpiral3d=TransitionSpiral3d,TransitionSpiral3d.initWorkSpace()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(9),o=r(61),s=r(5),a=r(39),c=r(14);class Box extends o.SolidPrimitive{constructor(e,t,r,n,i,o){super(o),this._localToWorld=e,this._baseX=t,this._baseY=r,this._topX=n,this._topY=i}clone(){return new Box(this._localToWorld.clone(),this._baseX,this._baseY,this._topX,this._topY,this.capped)}getConstructiveFrame(){return this._localToWorld.cloneRigid()}tryTransformInPlace(e){return e.multiplyTransformTransform(this._localToWorld,this._localToWorld),!0}cloneTransformed(e){const t=this.clone();return e.multiplyTransformTransform(t._localToWorld,t._localToWorld),t}static createDgnBox(e,t,r,n,o,s,a,c,l){const u=e.vectorTo(n),d=i.Transform.createOriginAndMatrixColumns(e,t,r,u);return new Box(d,o,s,a,c,l)}static createDgnBoxWithAxes(e,t,r,n,i,o,s,a){return Box.createDgnBox(e,t.columnX(),t.columnY(),r,n,i,o,s,a)}static createRange(e,t){if(!e.isNull){const r=e.low,i=e.xLength(),o=e.yLength(),s=e.low.clone();return s.z=s.z+e.zLength(),Box.createDgnBox(r,n.Vector3d.unitX(),n.Vector3d.unitY(),s,i,o,i,o,t)}}getBaseX(){return this._baseX}getBaseY(){return this._baseY}getTopX(){return this._topX}getTopY(){return this._topY}getBaseOrigin(){return this._localToWorld.multiplyXYZ(0,0,0)}getTopOrigin(){return this._localToWorld.multiplyXYZ(0,0,1)}getVectorX(){return this._localToWorld.matrix.columnX()}getVectorY(){return this._localToWorld.matrix.columnY()}getVectorZ(){return this._localToWorld.matrix.columnZ()}isSameGeometryClass(e){return e instanceof Box}isAlmostEqual(e){return e instanceof Box&&(this.capped===e.capped&&(!!this._localToWorld.isAlmostEqual(e._localToWorld)&&(s.Geometry.isSameCoordinate(this._baseX,e._baseX)&&s.Geometry.isSameCoordinate(this._baseY,e._baseY)&&s.Geometry.isSameCoordinate(this._topX,e._topX)&&s.Geometry.isSameCoordinate(this._topY,e._topY))))}dispatchToGeometryHandler(e){return e.handleBox(this)}strokeConstantVSection(e){const t=s.Geometry.interpolate(this._baseX,e,this._topX),r=s.Geometry.interpolate(this._baseY,e,this._topY),i=c.LineString3d.create(),o=this._localToWorld,a=n.Point3d.create();return o.multiplyXYZ(0,0,e,a),i.addPoint(a),o.multiplyXYZ(t,0,e,a),i.addPoint(a),o.multiplyXYZ(t,r,e,a),i.addPoint(a),o.multiplyXYZ(0,r,e,a),i.addPoint(a),o.multiplyXYZ(0,0,e,a),i.addPoint(a),i}constantVSection(e){const t=this.strokeConstantVSection(e);return a.Loop.create(t)}extendRange(e,t){const r=this._localToWorld,n=this._baseX,i=this._baseY,o=this._topX,s=this._topY;t?(e.extendTransformTransformedXYZ(t,r,0,0,0),e.extendTransformTransformedXYZ(t,r,n,0,0),e.extendTransformTransformedXYZ(t,r,0,i,0),e.extendTransformTransformedXYZ(t,r,n,i,0),e.extendTransformTransformedXYZ(t,r,0,0,1),e.extendTransformTransformedXYZ(t,r,o,0,1),e.extendTransformTransformedXYZ(t,r,0,s,1),e.extendTransformTransformedXYZ(t,r,o,s,1)):(e.extendTransformedXYZ(r,0,0,0),e.extendTransformedXYZ(r,n,0,0),e.extendTransformedXYZ(r,0,i,0),e.extendTransformedXYZ(r,n,i,0),e.extendTransformedXYZ(r,0,0,1),e.extendTransformedXYZ(r,o,0,1),e.extendTransformedXYZ(r,0,s,1),e.extendTransformedXYZ(r,o,s,1))}}t.Box=Box},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9),i=r(10),o=r(5),s=r(61),a=r(72),c=r(39),l=r(22),u=r(60),d=r(14);class Cone extends s.SolidPrimitive{constructor(e,t,r,n){super(n),this._localToWorld=e,this._radiusA=t,this._radiusB=r,this._maxRadius=Math.max(this._radiusA,this._radiusB)}clone(){return new Cone(this._localToWorld.clone(),this._radiusA,this._radiusB,this.capped)}getConstructiveFrame(){return this._localToWorld.cloneRigid()}tryTransformInPlace(e){return e.multiplyTransformTransform(this._localToWorld,this._localToWorld),!0}cloneTransformed(e){const t=this.clone();return e.multiplyTransformTransform(t._localToWorld,t._localToWorld),t}static createAxisPoints(e,t,r,s,a){const c=e.vectorTo(t),l=c.magnitude();if(o.Geometry.isSmallMetricDistance(l))return;if((r=Math.abs(o.Geometry.correctSmallMetricDistance(r)))*(s=Math.abs(o.Geometry.correctSmallMetricDistance(s)))<0)return;if(r+s===0)return;const u=i.Matrix3d.createRigidHeadsUp(c);u.scaleColumns(1,1,l,u);const d=n.Transform.createOriginAndMatrix(e,u);return new Cone(d,r,s,a)}static createBaseAndTarget(e,t,r,i,s,a,c){s=Math.abs(o.Geometry.correctSmallMetricDistance(s)),a=Math.abs(o.Geometry.correctSmallMetricDistance(a));const l=e.vectorTo(t),u=n.Transform.createOriginAndMatrixColumns(e,r,i,l);return new Cone(u,s,a,c)}getCenterA(){return this._localToWorld.multiplyXYZ(0,0,0)}getCenterB(){return this._localToWorld.multiplyXYZ(0,0,1)}getVectorX(){return this._localToWorld.matrix.columnX()}getVectorY(){return this._localToWorld.matrix.columnY()}getRadiusA(){return this._radiusA}getRadiusB(){return this._radiusB}getMaxRadius(){return this._maxRadius}vFractionToRadius(e){return o.Geometry.interpolate(this._radiusA,e,this._radiusB)}isSameGeometryClass(e){return e instanceof Cone}isAlmostEqual(e){return e instanceof Cone&&(this.capped===e.capped&&(!!this._localToWorld.isAlmostEqual(e._localToWorld)&&(o.Geometry.isSameCoordinate(this._radiusA,e._radiusA)&&o.Geometry.isSameCoordinate(this._radiusB,e._radiusB))))}dispatchToGeometryHandler(e){return e.handleCone(this)}strokeConstantVSection(e,t){let r=16;void 0===t||(t instanceof Number?r=t:t instanceof a.StrokeOptions&&(r=t.defaultCircleStrokes)),r=o.Geometry.clampToStartEnd(r,4,64);const n=this.vFractionToRadius(e),i=d.LineString3d.create(),s=2*Math.PI/r;let c=0;const l=this._localToWorld;for(let o=0;o<=r;o++){c=2*o<=r?o*s:(o-r)*s;const t=l.multiplyXYZ(n*Math.cos(c),n*Math.sin(c),e);i.addPoint(t)}return i}constantVSection(e){const t=this.vFractionToRadius(e),r=this._localToWorld,n=r.multiplyXYZ(0,0,e),i=r.matrix.multiplyXYZ(t,0,0),o=r.matrix.multiplyXYZ(0,t,0);return c.Loop.create(u.Arc3d.create(n,i,o))}extendRange(e,t){const r=this.constantVSection(0),n=this.constantVSection(1);r.extendRange(e,t),n.extendRange(e,t)}UVFractionToPoint(e,t,r){const n=e*Math.PI*2,i=o.Geometry.interpolate(this._radiusA,t,this._radiusB),s=Math.cos(n),a=Math.sin(n);return this._localToWorld.multiplyXYZ(i*s,i*a,t,r)}UVFractionToPointAndTangents(e,t,r){const n=e*Math.PI*2,i=o.Geometry.interpolate(this._radiusA,t,this._radiusB),s=this._radiusB-this._radiusA,a=Math.cos(n),c=Math.sin(n),u=2*Math.PI;return l.Plane3dByOriginAndVectors.createOriginAndVectors(this._localToWorld.multiplyXYZ(i*a,i*c,t),this._localToWorld.multiplyVectorXYZ(-i*c*u,i*a*u,0),this._localToWorld.multiplyVectorXYZ(s*a,s*c,1),r)}}t.Cone=Cone},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(9),o=r(39),s=r(128),a=r(14),c=r(24),l=r(129),u=r(61);class LinearSweep extends u.SolidPrimitive{constructor(e,t,r){super(r),this._contour=e,this._direction=t}static create(e,t,r){const n=l.SweepContour.createForLinearSweep(e,t);if(n)return new LinearSweep(n,t,r)}static createZSweep(e,t,r,i){const l=a.LineString3d.createXY(e,t,i);if(i){c.PolygonOps.areaXY(l.points)*r<0&&l.points.reverse()}const u=i?o.Loop.create(l):s.Path.create(l);return LinearSweep.create(u,n.Vector3d.create(0,0,r),i)}getCurvesRef(){return this._contour.curves}getSweepContourRef(){return this._contour}cloneSweepVector(){return this._direction.clone()}isSameGeometryClass(e){return e instanceof LinearSweep}clone(){return new LinearSweep(this._contour.clone(),this._direction.clone(),this.capped)}tryTransformInPlace(e){return this._contour.tryTransformInPlace(e)&&e.multiplyVector(this._direction,this._direction),!1}getConstructiveFrame(){return this._contour.localToWorld.cloneRigid()}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}isAlmostEqual(e){return e instanceof LinearSweep&&(this._contour.isAlmostEqual(e._contour)&&this._direction.isAlmostEqual(e._direction)&&this.capped===e.capped)}dispatchToGeometryHandler(e){return e.handleLinearSweep(this)}constantVSection(e){const t=this._contour.curves.clone();return t&&0!==e&&t.tryTransformInPlace(i.Transform.createTranslation(this._direction.scale(e))),t}extendRange(e,t){const r=this._contour.curves.range(t);if(e.extendRange(r),t){const e=t.multiplyVector(this._direction);r.low.addInPlace(e),r.high.addInPlace(e)}else r.low.addInPlace(this._direction),r.high.addInPlace(this._direction);e.extendRange(r)}}t.LinearSweep=LinearSweep},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(130),i=r(37),o=r(13),s=r(6),a=r(9),c=r(10),l=r(272),u=r(72),d=r(33),h=r(5),p=r(14),f=r(261),g=r(101);class PolyfaceBuilder extends g.NullGeometryHandler{constructor(e){super(),this._options=e||u.StrokeOptions.createForFacets(),this._polyface=n.IndexedPolyface.create(this._options.needNormals,this._options.needParams,this._options.needColors),this._reversed=!1}get options(){return this._options}claimPolyface(e=!0){return e&&this._polyface.data.compress(),this._polyface}toggleReversedFacetFlag(){this._reversed=!this._reversed}static create(e){return new PolyfaceBuilder(e)}addTransformedUnitBox(e){const t=this._polyface.data.pointCount;for(const r of l.BoxTopology.points)this._polyface.addPoint(e.multiplyPoint3d(r));for(const r of l.BoxTopology.cornerIndexCCW){for(const e of r)this._polyface.addPointIndex(t+e);this._polyface.terminateFacet()}}addTriangleFan(e,t,r){const n=t.numPoints();if(n>2){r&&this.toggleReversedFacetFlag();const i=this.findOrAddPoint(e);let o=this.findOrAddPointInLineString(t,0),s=0;for(let e=1;e<n;e++)s=this.findOrAddPointInLineString(t,e),this.addIndexedTrianglePointIndexes(i,o,s),o=s;r&&this.toggleReversedFacetFlag()}}addTrianglesInUncheckedPolygon(e,t){const r=e.numPoints();if(r>2){t&&this.toggleReversedFacetFlag();const n=this.findOrAddPointInLineString(e,0);let i=this.findOrAddPointInLineString(e,1),o=0;for(let t=2;t<r;t++)o=this.findOrAddPointInLineString(e,t),this.addIndexedTrianglePointIndexes(n,i,o),i=o;t&&this.toggleReversedFacetFlag()}}addTriangleFanFromIndex0(e,t,r=!1,n=!1){const i=e.length;if(i>2){t&&this.toggleReversedFacetFlag();const o=e.at(0);let s=e.at(1),a=0;for(let t=2;t<i;t++)a=e.at(t),this.addIndexedTrianglePointIndexes(o,s,a),r&&this.addIndexedTriangleNormalIndexes(o,s,a),n&&this.addIndexedTriangleParamIndexes(o,s,a),s=a;t&&this.toggleReversedFacetFlag()}}findOrAddPoint(e){return this._polyface.addPoint(e)}findOrAddParamXY(e,t){return this._polyface.addParamXY(e,t)}findOrAddPointInLineString(e,t,r){const n=e.pointAt(t,PolyfaceBuilder._workPointFindOrAdd);if(n)return r&&r.multiplyPoint3d(n,n),this._polyface.addPoint(n)}findOrAddPointXYZ(e,t,r){return this._polyface.addPointXYZ(e,t,r)}getUVTransformForTriangleFacet(e,t,r){const n=e.vectorTo(t),i=e.vectorTo(r),o=c.Matrix3d.createRigidFromColumns(n,i,0);return a.Transform.createOriginAndMatrix(e,o).inverse()}getNormalForTriangularFacet(e,t,r){const n=e.vectorTo(t),i=e.vectorTo(r);let o=n.crossProduct(i).normalize();return o=o||s.Vector3d.create()}addQuadFacet(e,t,r){const n=this.options.needParams,i=this.options.needNormals;let s,a,c,l,u,d,h,p,f,g,m,y;if(n)if(void 0!==t&&t.length>3)s=t[0],a=t[1],c=t[2],l=t[3];else{const t=this.getUVTransformForTriangleFacet(e[0],e[1],e[2]);void 0===t?s=a=c=l=o.Point2d.createZero():(s=o.Point2d.createFrom(t.multiplyPoint3d(e[0])),a=o.Point2d.createFrom(t.multiplyPoint3d(e[1])),c=o.Point2d.createFrom(t.multiplyPoint3d(e[2])),l=o.Point2d.createFrom(t.multiplyPoint3d(e[3])))}if(i&&(void 0!==r&&r.length>3?(u=r[0],d=r[1],h=r[2],p=r[3]):(u=this.getNormalForTriangularFacet(e[0],e[1],e[2]),d=this.getNormalForTriangularFacet(e[0],e[1],e[2]),h=this.getNormalForTriangularFacet(e[0],e[1],e[2]),p=this.getNormalForTriangularFacet(e[0],e[1],e[2]))),this._options.shouldTriangulate){const t=e[0].vectorTo(e[2]),r=e[1].vectorTo(e[3]);t.magnitude()>=r.magnitude()?(this.addTriangleFacet([e[0],e[1],e[2]],n?[s,a,c]:void 0,i?[u,d,h]:void 0),this.addTriangleFacet([e[0],e[2],e[3]],n?[s,c,l]:void 0,i?[u,h,p]:void 0)):(this.addTriangleFacet([e[0],e[1],e[3]],n?[s,a,l]:void 0,i?[u,d,p]:void 0),this.addTriangleFacet([e[1],e[2],e[3]],n?[a,c,l]:void 0,i?[d,h,p]:void 0))}else n&&(f=this._polyface.addParam(s),g=this._polyface.addParam(a),m=this._polyface.addParam(c),y=this._polyface.addParam(l),this.addIndexedQuadParamIndexes(f,g,y,m)),i&&(f=this._polyface.addNormal(u),g=this._polyface.addNormal(d),m=this._polyface.addNormal(h),y=this._polyface.addNormal(p),this.addIndexedQuadNormalIndexes(f,g,y,m)),f=this.findOrAddPoint(e[0]),g=this.findOrAddPoint(e[1]),m=this.findOrAddPoint(e[2]),y=this.findOrAddPoint(e[3]),this.addIndexedQuadPointIndexes(f,g,y,m)}addIndexedQuadPointIndexes(e,t,r,n){this._reversed?(this._polyface.addPointIndex(e),this._polyface.addPointIndex(r),this._polyface.addPointIndex(n),this._polyface.addPointIndex(t),this._polyface.terminateFacet()):(this._polyface.addPointIndex(e),this._polyface.addPointIndex(t),this._polyface.addPointIndex(n),this._polyface.addPointIndex(r),this._polyface.terminateFacet())}addIndexedQuadParamIndexes(e,t,r,n){this._reversed?(this._polyface.addParamIndex(e),this._polyface.addParamIndex(r),this._polyface.addParamIndex(n),this._polyface.addParamIndex(t)):(this._polyface.addParamIndex(e),this._polyface.addParamIndex(t),this._polyface.addParamIndex(n),this._polyface.addParamIndex(r))}addIndexedQuadNormalIndexes(e,t,r,n){this._reversed?(this._polyface.addNormalIndex(e),this._polyface.addNormalIndex(r),this._polyface.addNormalIndex(n),this._polyface.addNormalIndex(t)):(this._polyface.addNormalIndex(e),this._polyface.addNormalIndex(t),this._polyface.addNormalIndex(n),this._polyface.addNormalIndex(r))}addTriangleFacet(e,t,r){let n,i,s;if(this._options.needParams){if(t&&t.length>=3)n=this._polyface.addParam(t[0]),i=this._polyface.addParam(t[1]),s=this._polyface.addParam(t[2]);else{const t=this.getUVTransformForTriangleFacet(e[0],e[1],e[2]);n=this._polyface.addParam(o.Point2d.createFrom(t?t.multiplyPoint3d(e[0]):void 0)),i=this._polyface.addParam(o.Point2d.createFrom(t?t.multiplyPoint3d(e[1]):void 0)),s=this._polyface.addParam(o.Point2d.createFrom(t?t.multiplyPoint3d(e[2]):void 0))}this.addIndexedTriangleParamIndexes(n,i,s)}if(this._options.needNormals){if(void 0!==r&&r.length>2)n=this._polyface.addNormal(r[0]),i=this._polyface.addNormal(r[1]),s=this._polyface.addNormal(r[2]);else{const t=this.getNormalForTriangularFacet(e[0],e[1],e[2]);n=this._polyface.addNormal(t),i=this._polyface.addNormal(t),s=this._polyface.addNormal(t)}this.addIndexedTriangleNormalIndexes(n,i,s)}n=this.findOrAddPoint(e[0]),i=this.findOrAddPoint(e[1]),s=this.findOrAddPoint(e[2]),this.addIndexedTrianglePointIndexes(n,i,s)}addIndexedTrianglePointIndexes(e,t,r){e!==t&&t!==r&&r!==e&&(this._reversed?(this._polyface.addPointIndex(e),this._polyface.addPointIndex(r),this._polyface.addPointIndex(t),this._polyface.terminateFacet()):(this._polyface.addPointIndex(e),this._polyface.addPointIndex(t),this._polyface.addPointIndex(r),this._polyface.terminateFacet()))}addIndexedTriangleParamIndexes(e,t,r){e!==t&&t!==r&&r!==e&&(this._reversed?(this._polyface.addParamIndex(e),this._polyface.addParamIndex(r),this._polyface.addParamIndex(t)):(this._polyface.addParamIndex(e),this._polyface.addParamIndex(t),this._polyface.addParamIndex(r)))}addIndexedTriangleNormalIndexes(e,t,r){e!==t&&t!==r&&r!==e&&(this._reversed?(this._polyface.addNormalIndex(e),this._polyface.addNormalIndex(r),this._polyface.addNormalIndex(t)):(this._polyface.addNormalIndex(e),this._polyface.addNormalIndex(t),this._polyface.addNormalIndex(r)))}addBetweenLineStrings(e,t,r=!1){const n=e.points,i=t.points,o=n.length;if(o<2||o!==i.length)return;let s=this.findOrAddPoint(n[0]),a=this.findOrAddPoint(i[0]);const c=s,l=a;let u=0,d=0;for(let h=1;h<o;h++)u=this.findOrAddPoint(n[h]),d=this.findOrAddPoint(i[h]),this.addIndexedQuadPointIndexes(s,u,a,d),s=u,a=d;r&&this.addIndexedQuadPointIndexes(s,c,a,l)}addBetweenTransformedLineStrings(e,t,r,n=!1){if(e instanceof p.LineString3d){const i=e.points.length;let o=this.findOrAddPointInLineString(e,0,t),s=this.findOrAddPointInLineString(e,0,r);const a=o,c=s;let l=0,u=0;for(let n=1;n<i;n++)l=this.findOrAddPointInLineString(e,n,t),u=this.findOrAddPointInLineString(e,n,r),this.addIndexedQuadPointIndexes(o,l,s,u),o=l,s=u;n&&this.addIndexedQuadPointIndexes(o,a,s,c)}else{const n=e.children;if(n)for(const e of n)this.addBetweenTransformedLineStrings(e,t,r)}}addBetweenStroked(e,t){if(e instanceof p.LineString3d&&t instanceof p.LineString3d)this.addBetweenLineStrings(e,t,!1);else if(e instanceof d.CurveChain&&t instanceof d.CurveChain){const r=e.children,n=t.children;if(r.length===n.length)for(let e=0;e<r.length;e++){const t=r[e],i=n[e];t instanceof p.LineString3d&&i instanceof p.LineString3d&&this.addBetweenLineStrings(t,i)}}}addCone(e,t){const r=e.strokeConstantVSection(0,t||this._options),n=e.strokeConstantVSection(1,t||this._options);this.addBetweenLineStrings(r,n,!1),e.capped&&(this.addTrianglesInUncheckedPolygon(r,!0),this.addTrianglesInUncheckedPolygon(n,!1))}addTorusPipe(e,t,r){this.toggleReversedFacetFlag(),this.addUVGrid(e,t||8,r||Math.ceil(16*e.getThetaFraction()),e.capped),this.toggleReversedFacetFlag()}addLinearSweepLineStrings(e,t){if(e instanceof p.LineString3d){const r=e;let n=s.Point3d.create(),i=s.Point3d.create(),o=0,a=0,c=0,l=0;const u=r.numPoints();for(let e=0;e<u;e++)i=(n=r.pointAt(e,n)).plus(t,i),a=this.findOrAddPoint(n),l=this.findOrAddPoint(i),e>0&&this.addIndexedQuadPointIndexes(o,a,c,l),o=a,c=l}else if(e instanceof d.CurveChain)for(const r of e.children)this.addLinearSweepLineStrings(r,t)}addRotationalSweep(e){const t=e.getCurves().cloneStroked(),r=u.StrokeOptions.applyAngleTol(this._options,1,e.getSweep().radians,void 0),n=a.Transform.createIdentity(),i=a.Transform.createIdentity();for(let o=1;o<=r;o++)e.getFractionalRotationTransform(o/r,i),this.addBetweenTransformedLineStrings(t,n,i),n.setFrom(i);if(e.capped){const t=e.getSweepContourRef();t.emitFacets(this,!0,void 0),t.emitFacets(this,!1,i)}}addLinearSweep(e){const t=e.getCurvesRef().cloneStroked();if(this.addLinearSweepLineStrings(t,e.cloneSweepVector()),e.capped){const t=e.getSweepContourRef();t.emitFacets(this,!0,void 0),t.emitFacets(this,!1,a.Transform.createTranslation(e.cloneSweepVector()))}}addRuledSweep(e){const t=e.sweepContoursRef();let r,n;for(let i=0;i<t.length;i++)n=t[i].curves.cloneStroked(),i>0&&r&&n&&this.addBetweenStroked(r,n),r=n;t[0].emitFacets(this,!0,void 0),t[t.length-1].emitFacets(this,!1,void 0)}addSphere(e,t){const r=t||this._options.defaultCircleStrokes,n=h.Geometry.clampToStartEnd(.5*r,4,32);let i=e.strokeConstantVSection(0,r);e.capped&&!h.Geometry.isSmallMetricDistance(i.quickLength())&&this.addTrianglesInUncheckedPolygon(i,!0);for(let o=1;o<=n;o++){const t=e.strokeConstantVSection(o/n,r);this.addBetweenLineStrings(i,t),i=t}e.capped&&!h.Geometry.isSmallMetricDistance(i.quickLength())&&this.addTrianglesInUncheckedPolygon(i,!0)}addBox(e){const t=e.strokeConstantVSection(0),r=e.strokeConstantVSection(1);this.addBetweenLineStrings(t,r),e.capped&&(this.addTrianglesInUncheckedPolygon(t,!0),this.addTrianglesInUncheckedPolygon(r,!1))}addPolygon(e,t){for(void 0===t&&(t=e.length);t>1&&e[t-1].isAlmostEqual(e[0]);)t--;let r=0;if(this._reversed)for(let n=t;--n>=0;)r=this.findOrAddPoint(e[n]),this._polyface.addPointIndex(r);else for(let n=0;n<t;n++)r=this.findOrAddPoint(e[n]),this._polyface.addPointIndex(r);this._polyface.terminateFacet()}addIndexedPolyface(e,t,r){this._polyface.addIndexedPolyface(e,t,r)}endFace(){return this._polyface.setNewFaceData()}handleCone(e){return this.addCone(e)}handleTorusPipe(e){return this.addTorusPipe(e)}handleSphere(e){return this.addSphere(e)}handleBox(e){return this.addBox(e)}handleLinearSweep(e){return this.addLinearSweep(e)}handleRotationalSweep(e){return this.addRotationalSweep(e)}handleRuledSweep(e){return this.addRuledSweep(e)}addGeometryQuery(e){e.dispatchToGeometryHandler(this)}addGraph(e,t,r=f.HalfEdge.testNodeMaskNotExterior){let n=0;e.announceFaceLoops((e,i)=>{if(r(i)){let e=i;do{n=this.findOrAddPointXYZ(e.x,e.y,e.z),this._polyface.addPointIndex(n),t&&(n=this.findOrAddParamXY(e.x,e.y),this._polyface.addParamIndex(n)),e=e.faceSuccessor}while(e!==i);this._polyface.terminateFacet()}return!0})}static graphToPolyface(e,t,r=f.HalfEdge.testNodeMaskNotExterior){const n=PolyfaceBuilder.create(t);return n.addGraph(e,n.options.needParams,r),n.endFace(),n.claimPolyface()}addGrid(e,t,r,n=!1){for(let i=0;i<e.length;i++){const n=t?t[i]:void 0,o=r?r[i]:void 0;3===e[i].length?this.addTriangleFacet(e[i],n,o):4===e[i].length&&this.addQuadFacet(e[i],n,o)}n&&this.endFace()}addUVGrid(e,t,r,n){let i,a=PolyfaceBuilder._index0,c=PolyfaceBuilder._index1;a.ensureCapacity(t),c.ensureCapacity(t);const l=s.Point3d.create(),u=1/t,d=1/r;for(let s=0;s<=r;s++){c.clear();for(let r=0;r<=t;r++){const t=r*u,n=s*d;if(this._options.needParams){const r=e.UVFractionToPointAndTangents(t,n);this._polyface.addNormal(r.vectorU.crossProduct(r.vectorV)),c.push(this.findOrAddPoint(r.origin.clone()))}else e.UVFractionToPoint(t,n,l),c.push(this.findOrAddPoint(l));this._options.needParams&&this._polyface.addParam(new o.Point2d(t,n))}if(!n||0!==s&&s!==r||this.addTriangleFanFromIndex0(c,0===s,!0,!0),s>0)for(let e=0;e<t;e++)this.addIndexedQuadPointIndexes(a.at(e),a.at(e+1),c.at(e),c.at(e+1)),this._options.needParams&&this.addIndexedQuadNormalIndexes(a.at(e),a.at(e+1),c.at(e),c.at(e+1)),this._options.needParams&&this.addIndexedQuadParamIndexes(a.at(e),a.at(e+1),c.at(e),c.at(e+1));i=c,c=a,a=i}a.clear(),c.clear()}}PolyfaceBuilder._workPointFindOrAdd=s.Point3d.create(),PolyfaceBuilder._index0=new i.GrowableFloat64Array,PolyfaceBuilder._index1=new i.GrowableFloat64Array,t.PolyfaceBuilder=PolyfaceBuilder},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6);class BoxTopology{}BoxTopology.points=[n.Point3d.create(0,0,0),n.Point3d.create(1,0,0),n.Point3d.create(0,1,0),n.Point3d.create(1,1,0),n.Point3d.create(0,0,1),n.Point3d.create(1,0,1),n.Point3d.create(0,1,1),n.Point3d.create(1,1,1)],BoxTopology.primaryCapId=-1,BoxTopology.cornerIndexCCW=[[1,0,2,3],[4,5,7,6],[0,1,5,4],[1,3,7,5],[3,2,6,7],[2,0,4,6]],BoxTopology.partnerFace=[[5,4,3,2],[2,3,4,5],[0,3,1,5],[0,4,1,2],[0,5,1,3],[0,2,1,4]],BoxTopology.faceId=[[BoxTopology.primaryCapId,0],[BoxTopology.primaryCapId,1],[0,0],[0,1],[0,2],[0,3]],BoxTopology.faceDirections=[[[0,1,2],[-1,1,-1]],[[0,1,2],[1,1,1]],[[0,2,1],[1,-1,1]],[[1,2,0],[1,1,1]],[[0,2,1],[-1,1,1]],[[1,2,0],[-1,1,-1]]],BoxTopology.axisEdgeVertex=[[[0,1],[2,3],[4,5],[6,7]],[[0,2],[1,3],[4,6],[5,7]],[[0,4],[1,5],[2,6],[3,7]]],t.BoxTopology=BoxTopology},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9),i=r(10),o=r(5),s=r(16),a=r(129),c=r(61);class RotationalSweep extends c.SolidPrimitive{constructor(e,t,r,n){super(n),this._contour=e,this._normalizedAxis=t,this.capped=n,this._sweepAngle=r}static create(e,t,r,n){if(!t.direction.normalizeInPlace())return;const i=a.SweepContour.createForRotation(e,t);return i?new RotationalSweep(i,t,r.clone(),n):void 0}getConstructiveFrame(){const e=this._contour.localToWorld.matrix.columnZ(),t=i.Matrix3d.createRigidFromColumns(e,this._normalizedAxis.direction,1);if(t)return n.Transform.createOriginAndMatrix(this._normalizedAxis.origin,t)}cloneAxisRay(){return this._normalizedAxis.clone()}getCurves(){return this._contour.curves}getSweepContourRef(){return this._contour}getSweep(){return this._sweepAngle.clone()}isSameGeometryClass(e){return e instanceof RotationalSweep}isAlmostEqual(e){return e instanceof RotationalSweep&&(this._contour.isAlmostEqual(e._contour)&&this._normalizedAxis.isAlmostEqual(e._normalizedAxis)&&this.capped===e.capped)}clone(){return new RotationalSweep(this._contour.clone(),this._normalizedAxis.clone(),this._sweepAngle.clone(),this.capped)}tryTransformInPlace(e){return!!this._contour.tryTransformInPlace(e)&&(this._normalizedAxis.transformInPlace(e),this._normalizedAxis.direction.normalizeInPlace())}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}dispatchToGeometryHandler(e){return e.handleRotationalSweep(this)}getFractionalRotationTransform(e,t){const r=this._sweepAngle.radians*e;return n.Transform.createOriginAndMatrix(this._normalizedAxis.origin,i.Matrix3d.createRotationAroundVector(this._normalizedAxis.direction,s.Angle.createRadians(r),t?t.matrix:void 0))}constantVSection(e){const t=this._contour.curves.clone();return t&&t.tryTransformInPlace(this.getFractionalRotationTransform(e)),t}extendRange(e){const t=this._contour.curves.cloneStroked(),r=o.Geometry.stepCount(22.5,this._sweepAngle.degrees,4,16);for(let n=0;n<=r;n++)t.extendRange(e,this.getFractionalRotationTransform(n/r))}}t.RotationalSweep=RotationalSweep},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(33),i=r(38),o=r(5),s=r(61),a=r(129),c=r(263),l=r(33);class RuledSweep extends s.SolidPrimitive{constructor(e,t){super(t),this._contours=e}static create(e,t){const r=[];for(const n of e){const e=a.SweepContour.createForLinearSweep(n);if(void 0===e)return;r.push(e)}return new RuledSweep(r,t)}sweepContoursRef(){return this._contours}cloneSweepContours(){const e=[];for(const t of this._contours)e.push(t.clone());return e}cloneContours(){const e=[];for(const t of this._contours)e.push(t.curves.clone());return e}clone(){return new RuledSweep(this.cloneSweepContours(),this.capped)}tryTransformInPlace(e){for(const t of this._contours)t.tryTransformInPlace(e);return!0}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}getConstructiveFrame(){if(0!==this._contours.length)return this._contours[0].localToWorld.cloneRigid()}isSameGeometryClass(e){return e instanceof RuledSweep}isAlmostEqual(e){if(e instanceof RuledSweep){if(this.capped!==e.capped)return!1;if(this._contours.length!==e._contours.length)return!1;for(let t=0;t<this._contours.length;t++)if(!this._contours[t].isAlmostEqual(e._contours[t]))return!1;return!0}return!1}dispatchToGeometryHandler(e){return e.handleRuledSweep(this)}constantVSection(e){const t=this._contours.length;if(t<2)return;const r=e*t;let n=0;(n=e>=1?t-1:Math.floor(r))+1>=t&&(n=t-2);const s=n+1,a=o.Geometry.clampToStartEnd(r-n,0,1);return RuledSweep.mutatePartners(this._contours[n].curves,this._contours[s].curves,(e,t)=>{const r=c.ConstructCurveBetweenCurves.InterpolateBetween(e,a,t);if(r instanceof i.CurvePrimitive)return r})}extendRange(e,t){for(const r of this._contours)r.curves.extendRange(e,t)}static mutatePartners(e,t,r){if(e.isSameGeometryClass(t)){if(e instanceof l.CurveChain&&t instanceof l.CurveChain){const n=e,i=t,o=n.cloneEmptyPeer(),s=n.children,a=i.children;if(s.length!==s.length)return;for(let e=0;e<s.length;e++){const t=r(s[e],a[e]);if(!t)return;o.children.push(t)}return o}if(e instanceof n.CurveCollection&&t instanceof n.CurveCollection){const o=e.cloneEmptyPeer(),s=e.children,a=t.children,c=o.children;if(!s||!a||!c)return;for(let e=0;e<s.length;e++){const t=s[e],o=a[e];if(t instanceof i.CurvePrimitive&&o instanceof i.CurvePrimitive){const e=r(t,o);if(!e)return;c.push(e)}else if(t instanceof n.CurveCollection&&o instanceof n.CurveCollection){const e=this.mutatePartners(t,o,r);if(!e)return;e instanceof n.CurveCollection&&c.push(e)}}return o}}}}t.RuledSweep=RuledSweep},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9),i=r(10),o=r(72),s=r(5),a=r(84),c=r(61),l=r(39),u=r(60),d=r(14),h=r(22);class Sphere extends c.SolidPrimitive{vFractionToRadians(e){return this._latitudeSweep.fractionToRadians(e)}uFractionToRadians(e){return e*Math.PI*2}constructor(e,t,r){super(r),this._localToWorld=e,this._latitudeSweep=t||a.AngleSweep.createFullLatitude()}clone(){return new Sphere(this._localToWorld.clone(),this._latitudeSweep.clone(),this.capped)}tryTransformInPlace(e){return e.multiplyTransformTransform(this._localToWorld,this._localToWorld),!0}cloneTransformed(e){const t=this.clone();return e.multiplyTransformTransform(t._localToWorld,t._localToWorld),t}getConstructiveFrame(){return this._localToWorld.cloneRigid()}static createCenterRadius(e,t,r){const o=n.Transform.createOriginAndMatrix(e,i.Matrix3d.createUniformScale(t));return new Sphere(o,r||a.AngleSweep.createFullLatitude(),!1)}static createEllipsoid(e,t,r){return new Sphere(e,t,r)}static createDgnSphere(e,t,r,o,s,a,c){const l=t.rotate90Around(r);if(l){const u=i.Matrix3d.createColumns(t,l,r);u.scaleColumns(o,o,s,u);const d=n.Transform.createOriginAndMatrix(e,u);return new Sphere(d,a.clone(),c)}}static createFromAxesAndScales(e,t,r,i,o,s,c){const l=n.Transform.createOriginAndMatrix(e,t);return l.matrix.scaleColumnsInPlace(r,i,o),new Sphere(l,s?s.clone():a.AngleSweep.createFullLatitude(),c)}cloneCenter(){return this._localToWorld.getOrigin()}cloneVectorX(){return this._localToWorld.matrix.columnX()}cloneVectorY(){return this._localToWorld.matrix.columnY()}cloneVectorZ(){return this._localToWorld.matrix.columnZ()}cloneLatitudeSweep(){return this._latitudeSweep.clone()}trueSphereRadius(){const e=this._localToWorld.matrix.factorRigidWithSignedScale();if(e)return e&&e.scale>0?e.scale:void 0}cloneLocalToWorld(){return this._localToWorld.clone()}isSameGeometryClass(e){return e instanceof Sphere}isAlmostEqual(e){return e instanceof Sphere&&(this.capped===e.capped&&!!this._localToWorld.isAlmostEqual(e._localToWorld))}strokeConstantVSection(e,t){let r=16;void 0===t||(t instanceof Number?r=t:t instanceof o.StrokeOptions&&(r=t.defaultCircleStrokes)),r=s.Geometry.clampToStartEnd(r,4,64);const n=this.vFractionToRadians(e),i=Math.cos(n),a=Math.sin(n),c=d.LineString3d.create(),l=2*Math.PI/r;let u=0;const h=this._localToWorld;for(let o=0;o<=r;o++){u=2*o<=r?o*l:(o-r)*l;const e=h.multiplyXYZ(i*Math.cos(u),i*Math.sin(u),a);c.addPoint(e)}return c}dispatchToGeometryHandler(e){return e.handleSphere(this)}constantVSection(e){const t=this._latitudeSweep.fractionToRadians(e),r=Math.sin(t),n=Math.cos(t),i=this._localToWorld,o=i.multiplyXYZ(0,0,r),s=i.matrix.multiplyXYZ(n,0,0),a=i.matrix.multiplyXYZ(0,n,0);return l.Loop.create(u.Arc3d.create(o,s,a))}extendRange(e,t){let r=this._localToWorld;t&&(r=t.multiplyTransformTransform(r)),e.extendTransformedXYZ(r,-1,-1,-1),e.extendTransformedXYZ(r,1,-1,-1),e.extendTransformedXYZ(r,-1,1,-1),e.extendTransformedXYZ(r,1,1,-1),e.extendTransformedXYZ(r,-1,-1,1),e.extendTransformedXYZ(r,1,-1,1),e.extendTransformedXYZ(r,-1,1,1),e.extendTransformedXYZ(r,1,1,1)}UVFractionToPoint(e,t,r){const n=this.uFractionToRadians(e),i=this.vFractionToRadians(t),o=Math.cos(n),s=Math.sin(n),a=Math.sin(i),c=Math.cos(i);return this._localToWorld.multiplyXYZ(o*c,s*c,a,r)}UVFractionToPointAndTangents(e,t,r){const n=this.uFractionToRadians(e),i=this.vFractionToRadians(t),o=2*Math.PI,s=this._latitudeSweep.sweepRadians,a=Math.cos(n),c=Math.sin(n),l=Math.sin(i),u=Math.cos(i);return h.Plane3dByOriginAndVectors.createOriginAndVectors(this._localToWorld.multiplyXYZ(a*u,c*u,l),this._localToWorld.multiplyVectorXYZ(-o*c*u,o*a*u,0),this._localToWorld.multiplyVectorXYZ(-s*a*l,-s*c,s*u),r)}}t.Sphere=Sphere},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9),i=r(5),o=r(84),s=r(61),a=r(39),c=r(128),l=r(60),u=r(22);class TorusPipe extends s.SolidPrimitive{constructor(e,t,r,n,i){super(i),this._localToWorld=e,this._radiusA=t,this._radiusB=r,this._sweep=n,this._isReversed=!1}clone(){const e=new TorusPipe(this._localToWorld.clone(),this._radiusA,this._radiusB,this._sweep.clone(),this.capped);return e._isReversed=this._isReversed,e}tryTransformInPlace(e){return e.multiplyTransformTransform(this._localToWorld,this._localToWorld),!0}cloneTransformed(e){const t=this.clone();return e.multiplyTransformTransform(t._localToWorld,t._localToWorld),t}static createInFrame(e,t,r,n,o){if((t=Math.abs(i.Geometry.correctSmallMetricDistance(t)))<(r=Math.abs(i.Geometry.correctSmallMetricDistance(r))))return;if(0===t)return;if(0===r)return;if(n.isAlmostZero)return;let s=1,a=1;e.matrix.determinant()<0&&(a*=-1);let c=!1;const l=n.clone();n.radians<0&&(l.setRadians(-n.radians),a*=-1,s*=-1,c=!0);const u=e.clone();u.matrix.scaleColumns(1,s,a,u.matrix);const d=new TorusPipe(u,t,r,l,o);return d._isReversed=c,d}static createDgnTorusPipe(e,t,r,i,o,s,a){const c=t.crossProduct(r);c.scaleToLength(t.magnitude(),c);const l=n.Transform.createOriginAndMatrixColumns(e,t,r,c);return TorusPipe.createInFrame(l,i,o,s,a)}getConstructiveFrame(){return this._localToWorld.cloneRigid()}cloneCenter(){return this._localToWorld.getOrigin()}cloneVectorX(){return this._localToWorld.matrix.columnX()}cloneVectorY(){return this._localToWorld.matrix.columnY()}getMinorRadius(){return this._radiusB}getMajorRadius(){return this._radiusA}getSweepAngle(){return this._sweep.clone()}getIsReversed(){return this._isReversed}getThetaFraction(){return this._sweep.radians/(2*Math.PI)}isSameGeometryClass(e){return e instanceof TorusPipe}isAlmostEqual(e){return e instanceof TorusPipe&&(this.capped===e.capped&&(!!this._localToWorld.isAlmostEqual(e._localToWorld)&&(i.Geometry.isSameCoordinate(this._radiusA,e._radiusA)&&i.Geometry.isSameCoordinate(this._radiusB,e._radiusB)&&this._sweep.isAlmostEqualNoPeriodShift(e._sweep))))}dispatchToGeometryHandler(e){return e.handleTorusPipe(this)}constantVSection(e){const t=this._sweep.radians*e,r=Math.cos(t),n=Math.sin(t),i=this.getMajorRadius(),o=this.getMinorRadius(),s=this._localToWorld.multiplyXYZ(i*r,i*n,0),c=this._localToWorld.multiplyVectorXYZ(o*r,o*n,0),u=this._localToWorld.multiplyVectorXYZ(0,0,o);return a.Loop.create(l.Arc3d.create(s,c,u))}constantUSection(e){const t=this._sweep.radians,r=e*Math.PI,n=this.getMajorRadius(),i=this.getMinorRadius(),s=this._localToWorld.matrix,a=this._localToWorld.multiplyXYZ(0,0,i*Math.sin(r)),u=n+i*Math.cos(r),d=s.multiplyXYZ(u,0,0),h=s.multiplyXYZ(0,u,0);return c.Path.create(l.Arc3d.create(a,d,h,o.AngleSweep.createStartEndRadians(0,t)))}extendRange(e,t){const r=this._sweep.radians,n=this.getMajorRadius(),i=this.getMinorRadius(),o=this._localToWorld,s=Math.ceil(r/(.125*Math.PI));let a=0,c=0,l=0,u=0,d=0,h=0,p=0,f=0,g=0;const m=r/s;for(let y=0;y<=s;y++)if(u=y*m,d=Math.cos(u),h=Math.sin(u),0===y||y===s?(a=-Math.PI,c=2*Math.PI/8,l=8):(a=-.5*Math.PI,c=Math.PI/8,l=15),t)for(g=0;g<=l;g++)f=a+g*c,p=n+i*Math.cos(f),e.extendTransformTransformedXYZ(t,o,d*p,h*p,Math.sin(f)*i);else for(g=0;g<=l;g++)f=a+g*c,p=n+i*Math.sin(f),e.extendTransformedXYZ(o,d*p,h*p,Math.sin(f)*i)}UVFractionToPoint(e,t,r){const n=t*this._sweep.radians,i=e*Math.PI*2,o=Math.cos(n),s=Math.sin(n),a=this.getMinorRadius(),c=this.getMajorRadius()+Math.cos(i)*a;return this._localToWorld.multiplyXYZ(c*o,c*s,a*Math.sin(i),r)}UVFractionToPointAndTangents(e,t,r){const n=t*this._sweep.radians,i=e*Math.PI*2,o=this._sweep.radians,s=2*Math.PI,a=Math.cos(n),c=Math.sin(n),l=Math.sin(i),d=Math.cos(i),h=this.getMinorRadius(),p=this.getMajorRadius()+Math.cos(i)*h,f=h*l,g=h*d;return u.Plane3dByOriginAndVectors.createOriginAndVectors(this._localToWorld.multiplyXYZ(a*p,c*p,f),this._localToWorld.multiplyVectorXYZ(-p*c*o,p*a*o,0),this._localToWorld.multiplyVectorXYZ(-a*f*s,-c*f*s,g*s),r)}}t.TorusPipe=TorusPipe},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(19),o=r(5),s=r(124),a=r(24),c=r(253),l=r(100);class BSplineCurve3dH extends l.BSplineCurve3dBase{initializeWorkBezier(){return void 0===this._workBezier&&(this._workBezier=c.BezierCurve3dH.createOrder(this.order)),this._workBezier}isSameGeometryClass(e){return e instanceof BSplineCurve3dH}tryTransformInPlace(e){return a.Point4dArray.multiplyInPlace(e,this._bcurve.packedData),!0}getPolePoint3d(e,t){const r=this.poleIndexToDataIndex(e);if(void 0!==r){const e=this._bcurve.packedData,i=o.Geometry.conditionalDivideFraction(1,e[r+3]);if(void 0!==i)return n.Point3d.create(e[r]*i,e[r+1]*i,e[r+2]*i,t)}}getPolePoint4d(e,t){const r=this.poleIndexToDataIndex(e);if(void 0!==r){const e=this._bcurve.packedData;return i.Point4d.create(e[r],e[r+1],e[r+2],e[r+3],t)}}spanFractionToKnot(e,t){return this._bcurve.spanFractionToKnot(e,t)}constructor(e,t,r){super(4,e,t,r)}copyPoints(){return a.Point3dArray.unpackNumbersToNestedArrays(this._bcurve.packedData,4)}copyPointsFloat64Array(){return this._bcurve.packedData.slice()}static createUniformKnots(e,t){const r=e.length;if(t<1||r<t)return;const o=s.KnotVector.createUniformClamped(e.length,t-1,0,1),a=new BSplineCurve3dH(e.length,t,o);let c=0;if(e[0]instanceof n.Point3d)for(const n of e)a._bcurve.packedData[c++]=n.x,a._bcurve.packedData[c++]=n.y,a._bcurve.packedData[c++]=n.z,a._bcurve.packedData[c++]=1;else{if(!(e[0]instanceof i.Point4d))return;for(const t of e)a._bcurve.packedData[c++]=t.x,a._bcurve.packedData[c++]=t.y,a._bcurve.packedData[c++]=t.z,a._bcurve.packedData[c++]=t.w}return a}static create(e,t,r){let o=e.length;e instanceof Float64Array&&(o/=4);const a=o+r===t.length;if(r<1||o<r)return;const c=s.KnotVector.create(t,r-1,a),l=new BSplineCurve3dH(o,r,c);if(e instanceof Float64Array){let t=0;for(const r of e)l._bcurve.packedData[t++]=r}else if(e[0]instanceof i.Point4d){let t=0;for(const r of e)l._bcurve.packedData[t++]=r.x,l._bcurve.packedData[t++]=r.y,l._bcurve.packedData[t++]=r.z,l._bcurve.packedData[t++]=r.w}else if(e[0]instanceof n.Point3d){let t=0;for(const r of e)l._bcurve.packedData[t++]=r.x,l._bcurve.packedData[t++]=r.y,l._bcurve.packedData[t++]=r.z,l._bcurve.packedData[t++]=1}return l}clone(){const e=this._bcurve.knots.clone(),t=new BSplineCurve3dH(this.numPoles,this.order,e);return t._bcurve.packedData=this._bcurve.packedData.slice(),t}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}evaluatePointInSpan(e,t,r){this._bcurve.evaluateBuffersInSpan(e,t);const n=this._bcurve.poleBuffer;return i.Point4d.createRealPoint3dDefault000(n[0],n[1],n[2],n[3],r)}evaluatePointAndTangentInSpan(e,t,r){this._bcurve.evaluateBuffersInSpan1(e,t);const n=this._bcurve.poleBuffer,o=this._bcurve.poleBuffer1;return i.Point4d.createRealDerivativeRay3dDefault000(n[0],n[1],n[2],n[3],o[0],o[1],o[2],o[3],r)}knotToPoint(e,t){this._bcurve.evaluateBuffersAtKnot(e);const r=this._bcurve.poleBuffer;return i.Point4d.createRealPoint3dDefault000(r[0],r[1],r[2],r[3],t)}knotToPointAndDerivative(e,t){this._bcurve.evaluateBuffersAtKnot(e,1);const r=this._bcurve.poleBuffer,n=this._bcurve.poleBuffer1;return i.Point4d.createRealDerivativeRay3dDefault000(r[0],r[1],r[2],r[3],n[0],n[1],n[2],n[3],t)}knotToPointAnd2Derivatives(e,t){this._bcurve.evaluateBuffersAtKnot(e,2);const r=this._bcurve.poleBuffer,n=this._bcurve.poleBuffer1,o=this._bcurve.poleBuffer2;return i.Point4d.createRealDerivativePlane3dByOriginAndVectorsDefault000(r[0],r[1],r[2],r[3],n[0],n[1],n[2],n[3],o[0],o[1],o[2],o[3],t)}isAlmostEqual(e){return e instanceof BSplineCurve3dH&&(this._bcurve.knots.isAlmostEqual(e._bcurve.knots)&&a.Point4dArray.isAlmostEqual(this._bcurve.packedData,e._bcurve.packedData))}isInPlane(e){return a.Point4dArray.isCloseToPlane(this._bcurve.packedData,e)}quickLength(){return a.Point3dArray.sumLengths(this._bcurve.packedData)}emitStrokableParts(e,t){const r=e.announceBezierCurve,n=this.initializeWorkBezier(),i=this.numSpan;let o;for(let s=0;s<i;s++){const i=this.getSaturatedBezierSpan3dOr3dH(s,!1,n);i&&(o=i.strokeCount(t),r?e.announceBezierCurve(i,o,this,s,this._bcurve.knots.spanFractionToFraction(s,0),this._bcurve.knots.spanFractionToFraction(s,1)):e.announceIntervalForUniformStepStrokes(this,o,this._bcurve.knots.spanFractionToFraction(s,0),this._bcurve.knots.spanFractionToFraction(s,1)))}}emitStrokes(e,t){const r=this.initializeWorkBezier(),n=this.numSpan;for(let i=0;i<n;i++){const n=this.getSaturatedBezierSpan3dH(i,r);n&&n.emitStrokes(e,t)}}get isClosable(){if(!this._bcurve.knots.wrappable)return!1;const e=this.degree,t=this._bcurve.knots.leftKnotIndex,r=this._bcurve.knots.rightKnotIndex,n=this._bcurve.knots.rightKnot-this._bcurve.knots.leftKnot,i=r-t;for(let a=t-e+1;a<t+e-1;a++){const e=a+i;if(!o.Geometry.isSameCoordinate(this._bcurve.knots.knots[a]+n,this._bcurve.knots.knots[e]))return!1}const s=this.numPoles-this.degree;for(let a=0;a+1<e;a++){const e=a+s;if(!o.Geometry.isSamePoint3d(this.getPolePoint3d(a),this.getPolePoint3d(e)))return!1}return!0}getSaturatedBezierSpan3dH(e,t){if(e<0||e>=this.numSpan)return;const r=this.order;void 0!==t&&t instanceof c.BezierCurve3dH&&t.order===r||(t=c.BezierCurve3dH.createOrder(r));const n=t;return n.loadSpan4dPoles(this._bcurve.packedData,e),n.saturateInPlace(this._bcurve.knots,e),t}getSaturatedBezierSpan3dOr3dH(e,t,r){return this.getSaturatedBezierSpan3dH(e,r)}dispatchToGeometryHandler(e){return e.handleBSplineCurve3dH(this)}extendRange(e,t){const r=this._bcurve.packedData,n=r.length-3;if(t)for(let i=0;i<n;i+=4)e.extendTransformedXYZW(t,r[i],r[i+1],r[i+2],r[i+3]);else for(let i=0;i<n;i+=4)e.extendXYZW(r[i],r[i+1],r[i+2],r[i+3])}}t.BSplineCurve3dH=BSplineCurve3dH},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(9),o=r(10),s=r(24),a=r(22),c=r(124),l=r(5),u=r(19),d=r(50);var h;!function(e){e[e.uDirection=0]="uDirection",e[e.VDirection=1]="VDirection"}(t.UVSelect||(t.UVSelect={})),function(e){e[e.UnWeighted=0]="UnWeighted",e[e.WeightsAlreadyAppliedToCoordinates=1]="WeightsAlreadyAppliedToCoordinates",e[e.WeightsSeparateFromCoordinates=2]="WeightsSeparateFromCoordinates"}(h=t.WeightStyle||(t.WeightStyle={}));class BSpline2dNd extends d.GeometryQuery{degreeUV(e){return this.knots[e].degree}orderUV(e){return this.knots[e].degree+1}numSpanUV(e){return this._numPoles[e]-this.knots[e].degree}numPolesTotal(){return this.coffs.length/this.poleDimension}numPolesUV(e){return this._numPoles[e]}poleStepUV(e){return 0===e?1:this._numPoles[0]}getPoint3dPole(e,t,r){return n.Point3d.createFromPacked(this.coffs,e+t*this._numPoles[0],r)}getPoint3dPoleXYZW(e,t,r){return n.Point3d.createFromPackedXYZW(this.coffs,e+t*this._numPoles[0],r)}numberToUVSelect(e){return 0===e?0:1}extendRangeXYZ(e,t){const r=this.coffs,n=this.poleDimension,i=r.length+1-n;if(t)for(let o=0;o<i;o+=n)e.extendTransformedXYZ(t,r[o],r[o+1],r[o+2]);else for(let o=0;o<i;o+=n)e.extendXYZ(r[o],r[o+1],r[o+2])}extendRangeXYZH(e,t){const r=this.coffs,n=this.poleDimension,i=r.length+1-n;let o=0,s=0;if(t)for(let a=0;a<i;a+=n)0!==(o=r[a+3])&&(s=1/o,e.extendTransformedXYZ(t,r[a]*s,r[a+1]*s,r[a+2]*s));else for(let a=0;a<i;a+=n)0!==(o=r[a+3])&&(s=1/o,e.extendXYZ(r[a]*s,r[a+1]*s,r[a+2]*s))}fractionToRigidFrame(e,t,r){const n=this.fractionToPointAndDerivatives(e,t);if(!n)return;const s=o.Matrix3d.createColumnsInAxisOrder(0,n.vectorU,n.vectorV,void 0),a=o.Matrix3d.createRigidFromMatrix3d(s,0,s);return a&&(r=i.Transform.createOriginAndMatrix(n.origin,a,r)),r}constructor(e,t,r,n,i){super();const o=n.degree+1,s=i.degree+1;this.knots=[n,i],this.coffs=new Float64Array(e*t*r),this.poleDimension=r,this._basisBufferUV=[new Float64Array(o),new Float64Array(s)],this._basisBuffer1UV=[new Float64Array(o),new Float64Array(s)],this._numPoles=[e,t],this._poleBuffer=new Float64Array(r),this._poleBuffer1UV=[new Float64Array(r),new Float64Array(r)]}spanFractionToKnot(e,t,r){return this.knots[e].spanFractionToKnot(t,r)}spanFractionsToBasisFunctions(e,t,r,n,i){const o=(t=l.Geometry.clampToStartEnd(t,0,this.numSpanUV(e)))+this.degreeUV(e)-1,s=this.knots[e].baseKnotFractionToKnot(o,r);return i?this.knots[e].evaluateBasisFunctions1(o,s,n,i):this.knots[e].evaluateBasisFunctions(o,s,n)}sumPoleBufferForSpan(e,t){const r=this._poleBuffer,n=this.coffs;r.fill(0);const i=this.poleDimension,o=this.poleDimension*this._numPoles[0];let s=i*e+t*o,a=0;for(const c of this._basisBufferUV[1]){let e=s;for(const t of this._basisBufferUV[0]){a=t*c;for(let t=0;t<i;t++)r[t]+=a*n[e++]}s+=o}}sumpoleBufferDerivativesForSpan(e,t){const r=this._poleBuffer1UV[0],n=this._poleBuffer1UV[1];r.fill(0),n.fill(0);const i=this.poleDimension,o=this.poleDimension*this._numPoles[0];let s=i*e+t*o,a=0;for(const c of this._basisBufferUV[1]){let e=s;for(const t of this._basisBuffer1UV[0]){a=t*c;for(let t=0;t<i;t++)r[t]+=a*this.coffs[e++]}s+=o}s=i*e+t*o;for(const c of this._basisBuffer1UV[1]){let e=s;for(const t of this._basisBufferUV[0]){a=t*c;for(let t=0;t<i;t++)n[t]+=a*this.coffs[e++]}s+=o}}evaluateBuffersAtKnot(e,t,r=0){const n=this.knots[0].knotToLeftKnotIndex(e),i=this.knots[1].knotToLeftKnotIndex(t),o=n-this.degreeUV(0)+1,s=i-this.degreeUV(1)+1;r<1?(this.knots[0].evaluateBasisFunctions(n,e,this._basisBufferUV[0]),this.knots[1].evaluateBasisFunctions(i,t,this._basisBufferUV[1]),this.sumPoleBufferForSpan(o,s)):(this.knots[0].evaluateBasisFunctions1(n,e,this._basisBufferUV[0],this._basisBuffer1UV[0]),this.knots[1].evaluateBasisFunctions1(i,t,this._basisBufferUV[1],this._basisBuffer1UV[1]),this.sumPoleBufferForSpan(o,s),this.sumpoleBufferDerivativesForSpan(o,s))}swapBlocks(e,t,r){let n;for(let i=0;i<r;i++)n=this.coffs[e+i],this.coffs[e+i]=this.coffs[t+i],this.coffs[t+i]=n}reverseInPlace(e){const t=this.poleDimension,r=this.numPolesUV(0),n=this.numPolesUV(1);if(0===e)for(let i=0;i<n;i++){const e=i*r*t;for(let n=0,i=r-1;n<i;n++,i--)this.swapBlocks(e+n*t,e+i*t,t)}else{const e=t*r;for(let t=0,r=(n-1)*e;t<r;t+=e,r-=e)this.swapBlocks(t,r,e)}this.knots[e].reflectKnots()}setWrappable(e,t){this.knots[e].wrappable=t}}t.BSpline2dNd=BSpline2dNd;class BSplineSurface3d extends BSpline2dNd{isSameGeometryClass(e){return e instanceof BSplineSurface3d}tryTransformInPlace(e){return s.Point3dArray.multiplyInPlace(e,this.coffs),!0}getPole(e,t,r){return this.getPoint3dPole(e,t,r)}constructor(e,t,r,n){super(e,t,3,r,n)}getPointArray(e=!0){return e?s.Point3dArray.unpackNumbersToNestedArrays(this.coffs,3):s.Point3dArray.unpackNumbersToNestedArraysIJK(this.coffs,3,this.numPolesUV(0))}getPointGridJSON(){return{points:s.Point3dArray.unpackNumbersToNestedArraysIJK(this.coffs,3,this.numPolesUV(0)),weighStyle:h.UnWeighted,numCartesianDimensions:3}}copyPointsFloat64Array(){return this.coffs.slice()}copyKnots(e,t){return this.knots[e].copyKnots(t)}static create(e,t,r,n,i,o,s){let a=e.length;if(e instanceof Float64Array&&(a/=3),t*i!==a)return;const l=t+r===(n?n.length:t+r-2),u=i+o===(s?s.length:i+o-2);if(r<1||t<r)return;if(o<1||i<o)return;const d=n?c.KnotVector.create(n,r-1,l):c.KnotVector.createUniformClamped(t,r-1,0,1),h=s?c.KnotVector.create(s,o-1,u):c.KnotVector.createUniformClamped(i,o-1,0,1),p=new BSplineSurface3d(t,i,d,h);if(e instanceof Float64Array){let t=0;for(const r of e)p.coffs[t++]=r}else{let t=0;for(const r of e)p.coffs[t++]=r.x,p.coffs[t++]=r.y,p.coffs[t++]=r.z}return p}static createGrid(e,t,r,n,i){const o=e.length,s=e[0].length,a=s+t===(r?r.length:s+t-2),l=o+n===(i?i.length:o+n-2);if(t<1||s<t)return;if(n<1||o<n)return;const u=r?c.KnotVector.create(r,t-1,a):c.KnotVector.createUniformClamped(s,t-1,0,1),d=i?c.KnotVector.create(i,n-1,l):c.KnotVector.createUniformClamped(s,t-1,0,1);if(t<1||s<t)return;if(n<1||o<n)return;const h=new BSplineSurface3d(s,o,u,d);let p=0;for(const c of e)for(const e of c)h.coffs[p++]=e[0],h.coffs[p++]=e[1],h.coffs[p++]=e[2];return h}clone(){const e=this.knots[0].clone(),t=this.knots[1].clone(),r=new BSplineSurface3d(this.numPolesUV(0),this.numPolesUV(1),e,t);return r.coffs=this.coffs.slice(),r}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}knotToPoint(e,t){return this.evaluateBuffersAtKnot(e,t),n.Point3d.createFrom(this._poleBuffer)}knotToPointAndDerivatives(e,t,r){return this.evaluateBuffersAtKnot(e,t,1),a.Plane3dByOriginAndVectors.createOriginAndVectorsArrays(this._poleBuffer,this._poleBuffer1UV[0],this._poleBuffer1UV[1],r)}fractionToPoint(e,t){return this.knotToPoint(this.knots[0].fractionToKnot(e),this.knots[1].fractionToKnot(t))}fractionToPointAndDerivatives(e,t,r){const n=this.knots[0].fractionToKnot(e),i=this.knots[1].fractionToKnot(t);return this.knotToPointAndDerivatives(n,i,r)}isAlmostEqual(e){return e instanceof BSplineSurface3d&&(this.knots[0].isAlmostEqual(e.knots[0])&&this.knots[1].isAlmostEqual(e.knots[1])&&s.Point3dArray.isAlmostEqual(this.coffs,e.coffs))}isInPlane(e){return s.Point3dArray.isCloseToPlane(this.coffs,e)}isClosable(e){if(!this.knots[e].wrappable)return!1;const t=this.degreeUV(e),r=this.knots[e],n=r.leftKnotIndex,i=r.rightKnotIndex,o=r.rightKnot-r.leftKnot,s=i-n;for(let f=n-t+1;f<n+t-1;f++){const e=f+s;if(!l.Geometry.isSameCoordinate(r.knots[f]+o,r.knots[e]))return!1}const a=this.numPolesUV(e)-this.degreeUV(e),c=0===e?this.numPolesUV(1):this.numPolesUV(0),u=0===e?0:1,d=0===e?1:0,h=1-u,p=1-d;for(let f=0,g=0,m=0;f<c;f++,g+=u,m+=d)for(let e=0;e<t;e++){const t=e+a;if(!l.Geometry.isSamePoint3d(this.getPole(g+e*h,m+e*p),this.getPole(g+t*h,m+t*p)))return!1}return!0}dispatchToGeometryHandler(e){return e.handleBSplineSurface3d(this)}extendRange(e,t){this.extendRangeXYZ(e,t)}}t.BSplineSurface3d=BSplineSurface3d;class BSplineSurface3dH extends BSpline2dNd{isSameGeometryClass(e){return e instanceof BSplineSurface3dH}tryTransformInPlace(e){return s.Point4dArray.multiplyInPlace(e,this.coffs),!0}getPole(e,t,r){return this.getPoint3dPoleXYZW(e,t,r)}constructor(e,t,r,n){super(e,t,4,r,n)}copyPoints4d(){return s.Point4dArray.unpackToPoint4dArray(this.coffs)}copyPointsAndWeights(e,t,r=n.Point3d.create){s.Point4dArray.unpackFloat64ArrayToPointsAndWeights(this.coffs,e,t,r)}copyKnots(e,t){return this.knots[e].copyKnots(t)}static create(e,t,r,n,i,o,a,l){if(r*o!==e.length)return;const u=r+n===(i?i.length:r+n-2),d=o+a===(l?l.length:o+a-2);if(n<1||r<n)return;if(a<1||o<a)return;const h=i?c.KnotVector.create(i,n-1,u):c.KnotVector.createUniformClamped(r,n-1,0,1),p=l?c.KnotVector.create(l,a-1,d):c.KnotVector.createUniformClamped(o,a-1,0,1);if(n<1||r<n)return;if(a<1||o<a)return;const f=new BSplineSurface3dH(r,o,h,p);return s.Point4dArray.packPointsAndWeightsToFloat64Array(e,t,f.coffs),f}static createGrid(e,t,r,n,i,o){const s=e.length,a=e[0].length,l=a+r===n.length,u=s+i===o.length;if(r<1||a<r)return;if(i<1||s<i)return;const d=c.KnotVector.create(n,r-1,l),p=c.KnotVector.create(o,i-1,u),f=new BSplineSurface3dH(a,s,d,p);if(t===h.WeightsSeparateFromCoordinates){let t=0;for(const r of e)for(const e of r){const r=e[3];f.coffs[t++]=e[0]*r,f.coffs[t++]=e[1]*r,f.coffs[t++]=e[2]*r,f.coffs[t++]=e[3]}}else{let t=0;for(const r of e)for(const e of r)f.coffs[t++]=e[0],f.coffs[t++]=e[1],f.coffs[t++]=e[2],f.coffs[t++]=e[3]}return f}clone(){const e=this.knots[0].clone(),t=this.knots[1].clone(),r=new BSplineSurface3dH(this.numPolesUV(0),this.numPolesUV(1),e,t);return r.coffs=this.coffs.slice(),r}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}getPointGridJSON(){return{points:s.Point3dArray.unpackNumbersToNestedArraysIJK(this.coffs,4,this.numPolesUV(0)),numCartesianDimensions:3,weightStyle:h.WeightsAlreadyAppliedToCoordinates}}knotToPoint4d(e,t){return this.evaluateBuffersAtKnot(e,t),u.Point4d.createFromPackedXYZW(this._poleBuffer,0)}knotToPointAndDerivatives(e,t,r){return this.evaluateBuffersAtKnot(e,t,1),a.Plane3dByOriginAndVectors.createOriginAndVectorsWeightedArrays(this._poleBuffer,this._poleBuffer1UV[0],this._poleBuffer1UV[1],r)}fractionToPoint4d(e,t){return this.knotToPoint4d(this.knots[0].fractionToKnot(e),this.knots[1].fractionToKnot(t))}fractionToPoint(e,t,r){return this.knotToPoint4d(this.knots[0].fractionToKnot(e),this.knots[1].fractionToKnot(t)).realPointDefault000(r)}knotToPoint(e,t,r){return this.knotToPoint4d(e,t).realPointDefault000(r)}fractionToPointAndDerivatives(e,t,r){const n=this.knots[0].fractionToKnot(e),i=this.knots[1].fractionToKnot(t);return this.knotToPointAndDerivatives(n,i,r)}isAlmostEqual(e){return e instanceof BSplineSurface3dH&&(this.knots[0].isAlmostEqual(e.knots[0])&&this.knots[1].isAlmostEqual(e.knots[1])&&s.Point4dArray.isAlmostEqual(this.coffs,e.coffs))}isInPlane(e){return s.Point4dArray.isCloseToPlane(this.coffs,e)}isClosable(e){if(!this.knots[e].wrappable)return!1;const t=this.degreeUV(e),r=this.knots[e],n=r.leftKnotIndex,i=r.rightKnotIndex,o=r.rightKnot-r.leftKnot,s=i-n;for(let f=n-t+1;f<n+t-1;f++){const e=f+s;if(!l.Geometry.isSameCoordinate(r.knots[f]+o,r.knots[e]))return!1}const a=this.numPolesUV(e)-this.degreeUV(e),c=0===e?this.numPolesUV(1):this.numPolesUV(0),u=0===e?0:1,d=0===e?0:1,h=1-u,p=1-d;for(let f=0,g=0,m=0;f<c;f++,g+=u,m+=d)for(let e=0;e+1<t;e++){const t=e+a;if(!l.Geometry.isSamePoint3d(this.getPole(g+e*h,m+e*p),this.getPole(g+t*h,m+t*p)))return!1}return!0}dispatchToGeometryHandler(e){return e.handleBSplineSurface3dH(this)}extendRange(e,t){this.extendRangeXYZH(e,t)}}t.BSplineSurface3dH=BSplineSurface3dH},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);!function(e){e[e._000=0]="_000",e[e._100=1]="_100",e[e._010=2]="_010",e[e._110=3]="_110",e[e._001=4]="_001",e[e._101=5]="_101",e[e._011=6]="_011",e[e._111=7]="_111",e[e.LeftBottomRear=0]="LeftBottomRear",e[e.RightBottomRear=1]="RightBottomRear",e[e.LeftTopRear=2]="LeftTopRear",e[e.RightTopRear=3]="RightTopRear",e[e.LeftBottomFront=4]="LeftBottomFront",e[e.RightBottomFront=5]="RightBottomFront",e[e.LeftTopFront=6]="LeftTopFront",e[e.RightTopFront=7]="RightTopFront",e[e.CORNER_COUNT=8]="CORNER_COUNT"}(t.Npc||(t.Npc={})),t.NpcCorners=[new n.Point3d(0,0,0),new n.Point3d(1,0,0),new n.Point3d(0,1,0),new n.Point3d(1,1,0),new n.Point3d(0,0,1),new n.Point3d(1,0,1),new n.Point3d(0,1,1),new n.Point3d(1,1,1)],t.NpcCorners.forEach(e=>Object.freeze(e)),Object.freeze(t.NpcCorners),t.NpcCenter=new n.Point3d(.5,.5,.5),Object.freeze(t.NpcCenter);class Frustum{constructor(){this.points=[];for(let e=0;e<8;++e)this.points[e]=t.NpcCorners[e].clone()}initNpc(){for(let e=0;e<8;++e)n.Point3d.createFrom(t.NpcCorners[e],this.points[e]);return this}getCorner(e){return this.points[e]}getCenter(){return this.getCorner(7).interpolate(.5,this.getCorner(0))}distance(e,t){return this.getCorner(e).distance(this.getCorner(t))}getFraction(){return n.Geometry.safeDivideFraction(this.distance(6,5),this.distance(2,1),0)}multiply(e){e.multiplyPoint3dArrayInPlace(this.points)}translate(e){for(const t of this.points)t.plus(e)}transformBy(e,t){return t=t||new Frustum,e.multiplyPoint3dArray(this.points,t.points),t}toRange(e){return e=e||new n.Range3d,n.Range3d.createArray(this.points,e),e}clone(e){return(e=e||new Frustum).setFrom(this),e}setFrom(e){for(let t=0;t<8;++t)this.points[t].setFrom(e.points[t])}scaleAboutCenter(e){const t=this.clone(),r=.5*(1+e);t.points[7].interpolate(r,t.points[0],this.points[0]),t.points[6].interpolate(r,t.points[1],this.points[1]),t.points[5].interpolate(r,t.points[2],this.points[2]),t.points[4].interpolate(r,t.points[3],this.points[3]),t.points[3].interpolate(r,t.points[4],this.points[4]),t.points[2].interpolate(r,t.points[5],this.points[5]),t.points[1].interpolate(r,t.points[6],this.points[6]),t.points[0].interpolate(r,t.points[7],this.points[7])}toMap4d(){const e=this.getCorner(0),t=e.vectorTo(this.getCorner(1)),r=e.vectorTo(this.getCorner(2)),i=e.vectorTo(this.getCorner(4));return n.Map4d.createVectorFrustum(e,t,r,i,this.getFraction())}invalidate(){for(let e=0;e<8;++e)this.points[e].set(0,0,0)}equals(e){for(let t=0;t<8;++t)if(!this.points[t].isExactEqual(e.points[t]))return!1;return!0}isSame(e){for(let t=0;t<8;++t)if(!this.points[t].isAlmostEqual(e.points[t]))return!1;return!0}initFromRange(e){const t=e=>void 0!==e.z?e.z:0,r=this.points;r[0].x=r[2].x=r[4].x=r[6].x=e.low.x,r[1].x=r[3].x=r[5].x=r[7].x=e.high.x,r[0].y=r[1].y=r[4].y=r[5].y=e.low.y,r[2].y=r[3].y=r[6].y=r[7].y=e.high.y,r[0].z=r[1].z=r[2].z=r[3].z=t(e.low),r[4].z=r[5].z=r[6].z=r[7].z=t(e.high)}static fromRange(e,t){const r=void 0!==t?t:new Frustum;return r.initFromRange(e),r}get hasMirror(){const e=this.points,t=e[0].vectorTo(e[4]),r=e[0].vectorTo(e[2]),n=e[0].vectorTo(e[1]);return t.tripleProduct(r,n)>0}fixPointOrder(){if(!this.hasMirror)return;const e=this.points;for(let t=0;t<8;t+=2){const r=e[t];e[t]=e[t+1],e[t+1]=r}}getRangePlanes(e,t,r){const i=n.ConvexClipPlaneSet.createEmpty(),o=n.Vector3d.create();return n.Vector3d.createCrossProductToPoints(this.points[5],this.points[3],this.points[1],o),o.normalizeInPlace()&&i.addPlaneToConvexSet(n.ClipPlane.createNormalAndDistance(o,o.dotProduct(this.points[1])-r)),n.Vector3d.createCrossProductToPoints(this.points[2],this.points[4],this.points[0],o),o.normalizeInPlace()&&i.addPlaneToConvexSet(n.ClipPlane.createNormalAndDistance(o,o.dotProduct(this.points[0])-r)),n.Vector3d.createCrossProductToPoints(this.points[3],this.points[6],this.points[2],o),o.normalizeInPlace()&&i.addPlaneToConvexSet(n.ClipPlane.createNormalAndDistance(o,o.dotProduct(this.points[2])-r)),n.Vector3d.createCrossProductToPoints(this.points[4],this.points[1],this.points[0],o),o.normalizeInPlace()&&i.addPlaneToConvexSet(n.ClipPlane.createNormalAndDistance(o,o.dotProduct(this.points[0])-r)),t&&(n.Vector3d.createCrossProductToPoints(this.points[1],this.points[2],this.points[0],o),o.normalizeInPlace()&&i.addPlaneToConvexSet(n.ClipPlane.createNormalAndDistance(o,o.dotProduct(this.points[0])-r))),e&&(n.Vector3d.createCrossProductToPoints(this.points[6],this.points[5],this.points[4],o),o.normalizeInPlace()&&i.addPlaneToConvexSet(n.ClipPlane.createNormalAndDistance(o,o.dotProduct(this.points[4])-r))),i}}t.Frustum=Frustum},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);class Cartographic{constructor(e=0,t=0,r=0){this.longitude=e,this.latitude=t,this.height=r}static fromRadians(e,t,r=0,n){return n?(n.longitude=e,n.latitude=t,n.height=r,n):new Cartographic(e,t,r)}static fromDegrees(e,t,r,i){return Cartographic.fromRadians(n.Angle.degreesToRadians(e),n.Angle.degreesToRadians(t),r,i)}static fromAngles(e,t,r,n){return Cartographic.fromRadians(e.radians,t.radians,r,n)}static fromEcef(e,t){const r=Cartographic._wgs84OneOverRadii,n=Cartographic._wgs84OneOverRadiiSquared,i=Cartographic._wgs84CenterToleranceSquared,o=Cartographic.scaleToGeodeticSurface(e,r,n,i,Cartographic._cartesianToCartographicP);if(!o)return;const s=Cartographic._cartesianToCartographicN;Cartographic.multiplyComponents(o,n,s),Cartographic.normalize(s,s);const a=o.vectorTo(e,Cartographic._cartesianToCartographicH),c=Math.atan2(s.y,s.x),l=Math.asin(s.z),u=Math.sign(a.dotProduct(e))*a.magnitude();return t?(t.longitude=c,t.latitude=l,t.height=u,t):new Cartographic(c,l,u)}clone(e){return e?(e.longitude=this.longitude,e.latitude=this.latitude,e.height=this.height,e):new Cartographic(this.longitude,this.latitude,this.height)}equals(e){return this===e||this.longitude===e.longitude&&this.latitude===e.latitude&&this.height===e.height}equalsEpsilon(e,t){return this===e||Math.abs(this.longitude-e.longitude)<=t&&Math.abs(this.latitude-e.latitude)<=t&&Math.abs(this.height-e.height)<=t}static normalize(e,t){const r=e.magnitude();t.x=e.x/r,t.y=e.y/r,t.z=e.z/r}static multiplyComponents(e,t,r){r.x=e.x*t.x,r.y=e.y*t.y,r.z=e.z*t.z}static scalePoint(e,t,r){r.x=e.x*t,r.y=e.y*t,r.z=e.z*t}static addPoints(e,t,r){r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z}toString(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"}static scaleToGeodeticSurface(e,t,r,i,o){const s=e.x,a=e.y,c=e.z,l=t.x,u=t.y,d=t.z,h=s*s*l*l,p=a*a*u*u,f=c*c*d*d,g=h+p+f,m=Math.sqrt(1/g),y=Cartographic._scaleToGeodeticSurfaceIntersection;if(Cartographic.scalePoint(e,m,y),g<i)return isFinite(m)?n.Point3d.createFrom(y,o):void 0;const v=r.x,_=r.y,w=r.z,S=Cartographic._scaleToGeodeticSurfaceGradient;S.x=y.x*v*2,S.y=y.y*_*2,S.z=y.z*w*2;let b,x,P,C,T,M,E,I,A,R,O,D=(1-m)*e.magnitude()/(.5*S.magnitude()),k=0;do{k=(b=h*(M=(P=1/(1+(D-=k)*v))*P)+p*(E=(C=1/(1+D*_))*C)+f*(I=(T=1/(1+D*w))*T)-1)/(-2*(x=h*(A=M*P)*v+p*(R=E*C)*_+f*(O=I*T)*w))}while(Math.abs(b)>.01);return o?(o.x=s*P,o.y=a*C,o.z=c*T,o):new n.Point3d(s*P,a*C,c*T)}toEcef(e){const t=Math.cos(this.latitude),r=Cartographic._scratchN,i=Cartographic._scratchK;r.x=t*Math.cos(this.longitude),r.y=t*Math.sin(this.longitude),r.z=Math.sin(this.latitude),Cartographic.normalize(r,r),Cartographic.multiplyComponents(Cartographic._wgs84RadiiSquared,r,i);const o=Math.sqrt(r.dotProduct(i));return Cartographic.scalePoint(i,1/o,i),Cartographic.scalePoint(r,this.height,r),e=e||new n.Point3d,Cartographic.addPoints(i,r,e),e}}Cartographic._cartesianToCartographicN=new n.Point3d,Cartographic._cartesianToCartographicP=new n.Point3d,Cartographic._cartesianToCartographicH=new n.Vector3d,Cartographic._wgs84OneOverRadii=new n.Point3d(1/6378137,1/6378137,1/6356752.314245179),Cartographic._wgs84OneOverRadiiSquared=new n.Point3d(1/40680631590769,1/40680631590769,1/40408299984661.445),Cartographic._wgs84RadiiSquared=new n.Point3d(40680631590769,40680631590769,40408299984661.445),Cartographic._wgs84CenterToleranceSquared=.1,Cartographic._scratchN=new n.Vector3d,Cartographic._scratchK=new n.Vector3d,Cartographic._scaleToGeodeticSurfaceIntersection=new n.Point3d,Cartographic._scaleToGeodeticSurfaceGradient=new n.Point3d,t.Cartographic=Cartographic},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Rgba=0]="Rgba",e[e.Rgb=2]="Rgb",e[e.Alpha=5]="Alpha"}(t.ImageBufferFormat||(t.ImageBufferFormat={}));class ImageBuffer{get numBytesPerPixel(){return ImageBuffer.getNumBytesPerPixel(this.format)}static getNumBytesPerPixel(e){switch(e){case 5:return 1;case 2:return 3;default:return 4}}get height(){return ImageBuffer.computeHeight(this.data,this.format,this.width)}static create(e,t,r){return this.isValidData(e,t,r)?new ImageBuffer(e,t,r):void 0}static isValidData(e,t,r){const n=this.computeHeight(e,t,r);return r>0&&n>0&&Math.floor(r)===r&&Math.floor(n)===n}static computeHeight(e,t,r){return e.length/(r*this.getNumBytesPerPixel(t))}constructor(e,t,r){this.data=e,this.format=t,this.width=r}}t.ImageBuffer=ImageBuffer,t.isPowerOfTwo=function(e){return 0===(e&e-1)},t.nextHighestPowerOfTwo=function(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1},function(e){e[e.Jpeg=0]="Jpeg",e[e.Png=2]="Png"}(t.ImageSourceFormat||(t.ImageSourceFormat={})),t.isValidImageSourceFormat=function(e){switch(e){case 0:case 2:return!0;default:return!1}};t.ImageSource=class ImageSource{constructor(e,t){this.data=e,this.format=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(69),i=r(15);class IModelVersion{constructor(){}static first(){const e=new IModelVersion;return e._first=!0,e}static latest(){const e=new IModelVersion;return e._latest=!0,e}static asOfChangeSet(e){const t=new IModelVersion;return""===e?(t._first=!0,t):(t._afterChangeSetId=e,t)}static named(e){const t=new IModelVersion;return t._versionName=e,t}static fromJson(e){const t=new IModelVersion;return Object.assign(t,e),t}get isFirst(){return!!this._first}get isLatest(){return!!this._latest}getAsOfChangeSet(){return this._afterChangeSetId}getName(){return this._versionName}evaluateChangeSet(e,t,r,n){return this._first?Promise.resolve(""):this._afterChangeSetId?Promise.resolve(this._afterChangeSetId):this._latest?IModelVersion.getLatestChangeSetId(e,n,t,r):this._versionName?IModelVersion.getChangeSetFromNamedVersion(e,n,t,r,this._versionName):Promise.reject(new i.IModelError(32768,"Invalid version"))}static async getLatestChangeSetId(e,t,r,i){const o=await t.ChangeSets().get(e,r,i,(new n.ChangeSetQuery).top(1).latest());return 0===o.length?"":o[o.length-1].wsgId}static async getChangeSetFromNamedVersion(e,t,r,o,s){const a=await t.Versions().get(e,r,o,(new n.VersionQuery).select("ChangeSetId").byName(s));return a[0]&&a[0].changeSetId?a[0].changeSetId:Promise.reject(new i.IModelError(32768,"Problem getting versions"))}}t.IModelVersion=IModelVersion},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(58);class SubCategoryAppearance{constructor(e){if(!e)return this.color=i.ColorDef.black,this.weight=0,this.priority=0,this.transparency=0,this.invisible=this.dontPlot=this.dontSnap=this.dontLocate=!1,this.styleId=n.Id64.invalid,void(this.materialId=n.Id64.invalid);this.invisible=n.JsonUtils.asBool(e.invisible),this.dontSnap=n.JsonUtils.asBool(e.dontSnap),this.dontLocate=n.JsonUtils.asBool(e.dontLocate),this.dontPlot=n.JsonUtils.asBool(e.dontPlot),this.color=i.ColorDef.fromJSON(e.color),this.weight=n.JsonUtils.asInt(e.weight),this.styleId=n.Id64.fromJSON(e.style),this.priority=n.JsonUtils.asInt(e.priority),this.materialId=n.Id64.fromJSON(e.material),this.transparency=n.JsonUtils.asInt(e.transp)}equals(e){return this.invisible===e.invisible&&this.dontPlot===e.dontPlot&&this.dontSnap===e.dontSnap&&this.dontLocate===e.dontLocate&&this.color.equals(e.color)&&this.weight===e.weight&&this.priority===e.priority&&this.styleId===e.styleId&&this.materialId===e.materialId&&this.transparency===e.transparency}toJSON(){const e={color:this.color.toJSON()};return this.invisible&&(e.invisible=!0),this.dontPlot&&(e.dontPlot=!0),this.dontSnap&&(e.dontSnap=!0),this.dontLocate&&(e.dontLocate=!0),0!==this.weight&&(e.weight=this.weight),0!==this.priority&&(e.priority=this.priority),n.Id64.isValid(this.styleId)&&(e.style=this.styleId),n.Id64.isValid(this.materialId)&&(e.material=this.materialId),0!==this.transparency&&(e.transp=this.transparency),e}clone(){return new SubCategoryAppearance(this.toJSON())}}SubCategoryAppearance.defaults=new SubCategoryAppearance,t.SubCategoryAppearance=SubCategoryAppearance;class SubCategoryOverride{constructor(e){void 0!==e.invisible&&(this.invisible=n.JsonUtils.asBool(e.invisible)),void 0!==e.color&&(this.color=i.ColorDef.fromJSON(e.color)),void 0!==e.weight&&(this.weight=n.JsonUtils.asInt(e.weight)),void 0!==e.style&&(this.style=n.Id64.fromJSON(e.style)),void 0!==e.material&&(this.material=n.Id64.fromJSON(e.material)),void 0!==e.priority&&(this.priority=n.JsonUtils.asInt(e.priority)),void 0!==e.transp&&(this.transparency=n.JsonUtils.asDouble(e.transp))}get anyOverridden(){return void 0!==this.invisible||void 0!==this.color||void 0!==this.weight||void 0!==this.style||void 0!==this.priority||void 0!==this.material||void 0!==this.transparency}override(e){if(!this.anyOverridden)return e;const t=e.toJSON(),r=this.toJSON();return void 0!==r.invisible&&(t.invisible=r.invisible),void 0!==r.weight&&(t.weight=r.weight),void 0!==r.style&&(t.style=r.style),void 0!==r.material&&(t.material=r.material),void 0!==r.priority&&(t.priority=r.priority),void 0!==r.transp&&(t.transp=r.transp),void 0!==r.color&&(t.color=r.color),new SubCategoryAppearance(t)}toJSON(){const e={invisible:this.invisible,weight:this.weight,style:this.style,material:this.material,priority:this.priority,transp:this.transparency};return void 0!==this.color&&(e.color=this.color.toJSON()),e}static fromJSON(e){return void 0!==e?new SubCategoryOverride(e):this.defaults}}SubCategoryOverride.defaults=new SubCategoryOverride({}),t.SubCategoryOverride=SubCategoryOverride,function(e){e[e.System=0]="System",e[e.Domain=1]="Domain",e[e.Application=2]="Application",e[e.User=3]="User"}(t.Rank||(t.Rank={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(58),o=r(0);!function(e){class HatchDefLine{constructor(e){if(this.angle=e.angle?n.Angle.fromJSON(e.angle):void 0,this.through=e.through?n.Point2d.fromJSON(e.through):void 0,this.offset=e.offset?n.Point2d.fromJSON(e.offset):void 0,e.dashes){const t=[];e.dashes.forEach(e=>t.push(e)),this.dashes=t}}}e.HatchDefLine=HatchDefLine;class Params{static fromJSON(e){const t=new Params;if(!e)return t;if(t.origin=e.origin?n.Point3d.fromJSON(e.origin):void 0,t.rotation=e.rotation?n.YawPitchRollAngles.fromJSON(e.rotation):void 0,t.space1=e.space1,t.space2=e.space2,t.angle1=e.angle1?n.Angle.fromJSON(e.angle1):void 0,t.angle2=e.angle2?n.Angle.fromJSON(e.angle2):void 0,t.scale=e.scale,t.color=e.color?i.ColorDef.fromJSON(e.color):void 0,t.weight=e.weight,t.invisibleBoundary=e.invisibleBoundary,t.snappable=e.snappable,t.symbolId=e.symbolId?o.Id64.fromJSON(e.symbolId):void 0,!e.defLines)return t;const r=[];return e.defLines.forEach(e=>r.push(new HatchDefLine(e))),t.defLines=r,t}clone(){return Params.fromJSON(this)}equals(e){if(this===e)return!0;if(this.scale!==e.scale||this.space1!==e.space1||this.space2!==e.space2||this.weight!==e.weight||this.invisibleBoundary!==e.invisibleBoundary||this.snappable!==e.snappable)return!1;if(void 0===this.color!==(void 0===e.color))return!1;if(this.color&&!this.color.equals(e.color))return!1;if(void 0===this.angle1!==(void 0===e.angle1))return!1;if(this.angle1&&!this.angle1.isAlmostEqualNoPeriodShift(e.angle1))return!1;if(void 0===this.angle2!==(void 0===e.angle2))return!1;if(this.angle2&&!this.angle2.isAlmostEqualNoPeriodShift(e.angle2))return!1;if(void 0===this.origin!==(void 0===e.origin))return!1;if(this.origin&&!this.origin.isAlmostEqual(e.origin))return!1;if(void 0===this.rotation!==(void 0===e.rotation))return!1;if(this.rotation&&!this.rotation.isAlmostEqual(e.rotation))return!1;if(void 0===this.symbolId!==(void 0===e.symbolId))return!1;if(this.symbolId&&this.symbolId!==e.symbolId)return!1;if(void 0===this.defLines!==(void 0===e.defLines))return!1;if(this.defLines){if(this.defLines.length!==e.defLines.length)return!1;for(let t=0;t<this.defLines.length;++t){const r=e.defLines[t],i=this.defLines[t];if(void 0===i.angle!==(void 0===r.angle))return!1;if(i.angle&&!i.angle.isAlmostEqualNoPeriodShift(r.angle))return!1;if(void 0===i.through!==(void 0===r.through))return!1;if(i.through&&!i.through.isAlmostEqual(r.through))return!1;if(void 0===i.offset!==(void 0===r.offset))return!1;if(i.offset&&!i.offset.isAlmostEqual(r.offset))return!1;if(void 0===i.dashes!==(void 0===r.dashes))return!1;if(i.dashes&&i.dashes.length!==r.dashes.length)return!1;if(i.dashes)for(let e=0;e<i.dashes.length;++e)if(!n.Geometry.isSameCoordinate(i.dashes[e],r.dashes[e]))return!1}}return!0}static transformPatternSpace(e,t,r,i){let o;if(i&&!i.isAlmostZero){const e=new n.YawPitchRollAngles(i).toMatrix3d();o=r.multiplyMatrixMatrix(e)}else o=r;const s=o.getColumn(1);return s.scale(t,s),e.multiplyVector(s,s),s.magnitude()}static getTransformPatternScale(e){const t=e.matrix.getColumn(0).magnitude();return t>1e-10?t:1}applyTransform(e){if(e.isIdentity)return!0;const t=this.origin?this.origin:n.Point3d.createZero(),r=this.rotation?this.rotation.toMatrix3d():n.Matrix3d.createIdentity();if(void 0!==this.symbolId){this.space1=Params.transformPatternSpace(e,this.space1?this.space1:0,r,this.angle1),this.space2=Params.transformPatternSpace(e,this.space2?this.space2:0,r,this.angle2);const t=Params.getTransformPatternScale(e);this.scale=this.scale?this.scale*=t:t}else if(this.defLines){const t=Params.getTransformPatternScale(e);if(!n.Geometry.isSameCoordinate(t,1)){this.scale=this.scale?this.scale*=t:t;for(const e of this.defLines)if(e.through&&(e.through.x*=t,e.through.y*=t),e.offset&&(e.offset.x*=t,e.offset.y*=t),e.dashes)for(let r=0;r<e.dashes.length;r++)e.dashes[r]*=t}}else this.space1=Params.transformPatternSpace(e,this.space1?this.space1:0,r,this.angle1),this.space2&&0!==this.space2&&(this.space2=Params.transformPatternSpace(e,this.space2,r,this.angle2));e.multiplyPoint3d(t),r.multiplyMatrixMatrix(e.matrix,r);const i=n.Matrix3d.createRigidFromMatrix3d(r);if(!i)return!1;const o=n.YawPitchRollAngles.createFromMatrix3d(i);return void 0!==o&&(this.origin=t,this.rotation=o,!0)}}e.Params=Params}(t.AreaPattern||(t.AreaPattern={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);t.TextString=class TextString{get width(){return this.height*(this.widthFactor?this.widthFactor:1)}constructor(e){this.text=e.text,this.font=e.font,this.height=e.height,this.widthFactor=e.widthFactor,this.bold=e.bold,this.italic=e.italic,this.underline=e.underline,this.origin=n.Point3d.fromJSON(e.origin),this.rotation=n.YawPitchRollAngles.fromJSON(e.rotation)}toJSON(){const e={};return e.text=this.text,e.font=this.font,e.height=this.height,e.widthFactor=this.widthFactor,e.bold=this.bold,e.italic=this.italic,e.underline=this.underline,this.origin.isAlmostZero||(e.origin=this.origin),this.rotation.isIdentity()||(e.rotation=this.rotation),e}transformInPlace(e){const t=e.multiplyPoint3d(this.origin,this.origin),r=this.rotation.toMatrix3d().multiplyMatrixTransform(e),i=new n.Vector3d;if(!r.matrix.normalizeColumnsInPlace(i))return!1;const o=n.YawPitchRollAngles.createFromMatrix3d(r.matrix);if(void 0===o)return!1;const s=this.height*i.y,a=this.width*i.x;return!(s<1e-10||a<1e-10)&&(this.origin.setFrom(t),this.rotation.setFrom(o),this.height=s,this.widthFactor=s===a?void 0:a/s,!0)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);!function(e){class Modifier{constructor(e){this.scale=e.scale,this.dashScale=e.dashScale,this.gapScale=e.gapScale,this.startWidth=e.startWidth,this.endWidth=e.endWidth,this.distPhase=e.distPhase,this.fractPhase=e.fractPhase,this.centerPhase=e.centerPhase,this.segmentMode=e.segmentMode,this.physicalWidth=e.physicalWidth,this.normal=e.normal?n.Vector3d.fromJSON(e.normal):void 0,this.rotation=e.rotation?n.YawPitchRollAngles.fromJSON(e.rotation):void 0}clone(){return new Modifier(this)}equals(e){return this===e||e.scale===this.scale&&e.dashScale===this.dashScale&&e.gapScale===this.gapScale&&e.startWidth===this.startWidth&&e.endWidth===this.endWidth&&e.distPhase===this.distPhase&&e.fractPhase===this.fractPhase&&e.centerPhase===this.centerPhase&&e.segmentMode===this.segmentMode&&e.physicalWidth===this.physicalWidth&&(void 0===this.normal===(void 0===e.normal)&&(!(this.normal&&!this.normal.isAlmostEqual(e.normal))&&(void 0===this.rotation===(void 0===e.rotation)&&!(this.rotation&&!this.rotation.isAlmostEqual(e.rotation)))))}applyTransform(e){if(e.isIdentity)return!0;if(this.normal){e.matrix.multiplyVector(this.normal,this.normal);const t=this.normal.normalize();if(!t)return!1;this.normal.setFrom(t)}if(this.rotation){const t=this.rotation.toMatrix3d().multiplyMatrixTransform(e),r=new n.Vector3d;if(!t.matrix.normalizeColumnsInPlace(r))return!1;const i=n.YawPitchRollAngles.createFromMatrix3d(t.matrix);if(void 0===i)return!1;this.rotation.setFrom(i)}let t=1;const r=n.Vector3d.create();return e.matrix.normalizeRowsInPlace(r),1===(t=0!==r.x&&0!==r.y&&0!==r.z?(r.x+r.y+r.z)/3:(r.x+r.y+r.z)/2)||(this.scale&&(this.scale*=t),!!this.physicalWidth||(this.startWidth&&(this.startWidth*=t),this.endWidth&&(this.endWidth*=t),!0))}}e.Modifier=Modifier;class Info{constructor(e,t){this.styleId=e,this.styleMod=t}clone(){return new Info(this.styleId,this.styleMod?this.styleMod.clone():void 0)}equals(e){return this===e||this.styleId===e.styleId&&(void 0===this.styleMod===(void 0===e.styleMod)&&!(this.styleMod&&!this.styleMod.equals(e.styleMod)))}}e.Info=Info}(t.LineStyle||(t.LineStyle={}))},function(module,exports,__webpack_require__){"use strict";(function(global){Object.defineProperty(exports,"__esModule",{value:!0});const IModelError_1=__webpack_require__(15),RpcProtocol_1=__webpack_require__(85),RpcRegistry_1=__webpack_require__(52),ElectronRpcRequest_1=__webpack_require__(478),instances=new Map,lookupInstance=e=>{const t=e.operation.interfaceDefinition;let r=instances.get(t);return r||(RpcRegistry_1.RpcRegistry.instance.lookupImpl(t),r=instances.get(t)),r};exports.CHANNEL="@bentley/imodeljs-common/ElectronRpcProtocol",exports.interop=(()=>{let electron=null;return"undefined"!==typeof global&&global&&global.process&&global.process.type&&(electron=eval("require")("electron")),electron})(),exports.interop&&(exports.interop.ipcMain?exports.interop.ipcMain.on(exports.CHANNEL,async(e,t)=>{let r;try{const e=lookupInstance(t);r=await e.fulfill(t)}catch(e){r=RpcProtocol_1.RpcRequestFulfillment.forUnknownError(t,e)}e.sender.send(exports.CHANNEL,r)}):exports.interop.ipcRenderer&&exports.interop.ipcRenderer.on(exports.CHANNEL,(e,t)=>{const r=instances.get(t.interfaceName),n=r.requests.get(t.id);r.requests.delete(t.id),n.notifyResponse(t)}));class ElectronRpcProtocol extends RpcProtocol_1.RpcProtocol{constructor(e){super(e),this.requestType=ElectronRpcRequest_1.ElectronRpcRequest,this.requests=new Map}onRpcClientInitialized(e,t){this.registerInterface(e)}onRpcImplInitialized(e,t){this.registerInterface(e)}onRpcClientTerminated(e,t){this.purgeInterface(e)}onRpcImplTerminated(e,t){this.purgeInterface(e)}registerInterface(e){if(instances.has(e.name))throw new IModelError_1.IModelError(32768,`RPC interface "${e.name}"" is already associated with a protocol.`);instances.set(e.name,this)}purgeInterface(e){instances.delete(e.name)}}exports.ElectronRpcProtocol=ElectronRpcProtocol}).call(this,__webpack_require__(12))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(15),i=r(75),o=r(174),s=r(74),a=r(175),c=r(481),l=r(25);class WebAppRpcRequest extends i.RpcRequest{constructor(e,t,r){super(e,t,r),this._loading=!1,this._request={},this._response=void 0,this._pathSuffix="",this.protocol=this.client.configuration.protocol,this.metadata={status:0,message:""},this.path=this.protocol.supplyPathForOperation(this.operation,this),this.method="head",this._request.headers={}}get _headers(){return this._request.headers}static async parseRequest(e,t){const r=e.getOperationFromPath(t.path),i={id:t.header(e.requestIdHeaderName)||"",authorization:t.header(e.authorizationHeaderName)||"",operation:{interfaceDefinition:r.interfaceDefinition,operationName:r.operationName,interfaceVersion:r.interfaceVersion},method:t.method,path:t.path,parameters:r.encodedRequest?WebAppRpcRequest.parseFromPath(r):await WebAppRpcRequest.parseFromBody(t),caching:r.encodedRequest?l.RpcResponseCacheControl.Immutable:l.RpcResponseCacheControl.None};if(!i.id)throw new n.IModelError(32768,"Invalid request.");return i}static sendResponse(e,t,r,i){const o=WebAppRpcRequest.computeTransportType(r.result,r.rawResult);if(o===l.RpcContentType.Text)WebAppRpcRequest.sendText(t,r,i);else if(o===l.RpcContentType.Binary)WebAppRpcRequest.sendBinary(t,r,i);else{if(o!==l.RpcContentType.Multipart)throw new n.IModelError(32768,"Unknown response type.");WebAppRpcRequest.sendMultipart(t,r,i)}}static computeTransportType(e,t){return t instanceof Uint8Array||Array.isArray(t)&&t[0]instanceof Uint8Array?l.RpcContentType.Binary:e.data.length>0?l.RpcContentType.Multipart:l.RpcContentType.Text}setHeader(e,t){this._headers[e]=t}send(){return this._loading=!0,this.setupTransport(),new Promise(async(e,t)=>{try{e(await this.performFetch())}catch(e){t(new n.ServerError(-1,e||"Server connection error."))}})}load(){return new Promise(async(e,t)=>{try{if(!this._loading)return;const r=this._response;if(!r)return void t(new n.IModelError(32768,"Invalid state."));const i=r.headers.get(l.WEB_RPC_CONSTANTS.CONTENT),s=o.WebAppRpcProtocol.computeContentType(i);s===l.RpcContentType.Text?e(await this.loadText(r)):s===l.RpcContentType.Binary?e(await this.loadBinary(r)):s===l.RpcContentType.Multipart?e(await this.loadMultipart(r,i)):t(new n.IModelError(32768,"Unknown response type")),this._loading=!1,this.setLastUpdatedTime(),this.protocol.events.raiseEvent(l.RpcProtocolEvent.ResponseLoaded,this)}catch(e){if(!this._loading)return;this._loading=!1,t(new n.ServerError(this.metadata.status,e||"Unknown server response error."))}})}static configureResponse(e,t,r){e.caching===l.RpcResponseCacheControl.Immutable&&r.set("Cache-Control","private, max-age=31536000, immutable")}static sendText(e,t,r){const n=t.result.objects;r.set(l.WEB_RPC_CONSTANTS.CONTENT,l.WEB_RPC_CONSTANTS.TEXT),WebAppRpcRequest.configureResponse(e,t,r),r.status(t.status).send(n)}static sendBinary(t,r,n){const i=r.result.data[0],o=e.isBuffer(i)?i:e.from(i);n.set(l.WEB_RPC_CONSTANTS.CONTENT,l.WEB_RPC_CONSTANTS.BINARY),WebAppRpcRequest.configureResponse(t,r,n),n.status(r.status).send(o)}static sendMultipart(e,t,r){const n=a.RpcMultipart.createStream(t.result),i=n.getHeaders();for(const o in i)i.hasOwnProperty(o)&&r.set(o,i[o]);WebAppRpcRequest.configureResponse(e,t,r),r.status(t.status),n.pipe(r)}static parseFromPath(t){const r=t.encodedRequest?e.from(t.encodedRequest,"base64").toString("binary"):"";return s.RpcSerializedValue.create(r)}static async parseFromBody(e){const t=o.WebAppRpcProtocol.computeContentType(e.header(l.WEB_RPC_CONSTANTS.CONTENT));if(t===l.RpcContentType.Text)return s.RpcSerializedValue.create(e.body);if(t===l.RpcContentType.Binary){const t=JSON.stringify([s.MarshalingBinaryMarker.createDefault()]),r=[e.body];return s.RpcSerializedValue.create(t,r)}if(t===l.RpcContentType.Multipart)return await a.RpcMultipart.parseRequest(e);throw new n.IModelError(32768,"Unknown content type.")}async performFetch(){let e=this.path,t=!1;this._pathSuffix&&(e+=`/${this._pathSuffix}`);const r=new Request(e,this._request);t=!0;const n=await fetch(r);return this._response=n,this.metadata.status=n.status,n.status}async loadText(e){const t=await e.text();return this.metadata.message=t,s.RpcSerializedValue.create(t)}async loadBinary(e){const t=new Uint8Array(await e.arrayBuffer()),r=JSON.stringify(s.MarshalingBinaryMarker.createDefault());return s.RpcSerializedValue.create(r,[t])}async loadMultipart(t,r){const n=await t.arrayBuffer();return new c.RpcMultipartParser(r,e.from(n)).parse()}setupTransport(){const e=this.protocol.serialize(this).parameters,t=WebAppRpcRequest.computeTransportType(e,this.parameters);if(t===l.RpcContentType.Binary)this.setupBinaryTransport(e);else if(t===l.RpcContentType.Multipart)this.setupMultipartTransport(e);else{if(t!==l.RpcContentType.Text)throw new n.IModelError(32768,"Unknown request type.");this.setupTextTransport(e)}}setupBinaryTransport(e){this._headers[l.WEB_RPC_CONSTANTS.CONTENT]=l.WEB_RPC_CONSTANTS.BINARY,this._request.method="post",this._request.body=e.data[0]}setupMultipartTransport(e){delete this._headers[l.WEB_RPC_CONSTANTS.CONTENT],this._request.method="post",this._request.body=a.RpcMultipart.createForm(e)}setupTextTransport(e){if(this.operation.policy.allowResponseCaching(this)){const t=btoa(e.objects);if(t.length<=WebAppRpcRequest.maxUrlComponentSize)return this._request.method="get",this._request.body=void 0,delete this._headers[l.WEB_RPC_CONSTANTS.CONTENT],void(this._pathSuffix=t)}this._pathSuffix="",this._headers[l.WEB_RPC_CONSTANTS.CONTENT]=l.WEB_RPC_CONSTANTS.TEXT,this._request.method="post",this._request.body=e.objects}}WebAppRpcRequest.maxUrlComponentSize=1024,t.WebAppRpcRequest=WebAppRpcRequest}).call(this,r(36).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(85),i=r(486),o=r(15),s=r(175),a=r(25);t.CHANNEL="@bentley/imodeljs-mobilegateway",t.interop=(()=>{let e=null;return"undefined"===typeof window&&"undefined"!==typeof bentley&&(e=bentley.imodeljs.servicesTier.require(t.CHANNEL)),e})();class MobileRpcProtocol extends n.RpcProtocol{constructor(e,r){if(super(e),this.socket=void 0,this.requests=new Map,this.pending=[],this.requestType=i.MobileRpcRequest,r===a.RpcEndpoint.Frontend){if("undefined"===typeof WebSocket)throw new o.IModelError(32768,"MobileRpcProtocol on frontend require websocket to work");this.socket=new WebSocket(`ws://localhost:${window.location.hash.substr(1)}`),this.socket.addEventListener("message",async e=>{const t=await s.RpcMultipart.readFormBlob(e.data),r=MobileRpcProtocol.decodeResponse(t),n=this.requests.get(r.id);this.requests.delete(r.id),n.notifyResponse(r)}),this.socket.addEventListener("open",e=>{for(const t of this.pending)this.socket.send(t);this.pending=[]})}if(r===a.RpcEndpoint.Backend){const e=t.interop;if(void 0===e||null==e)throw new o.IModelError(32768,"MobileRpcProtocol on backend require native bridge to be setup");e.handler=(async t=>{const r=MobileRpcProtocol.decodeRequest(t),n=await this.fulfill(r),i=MobileRpcProtocol.encodeResponse(n);e.send(i)}),self.__imodeljs_mobilegateway_handler__=e.handler}}static encodeRequest(e){const t=e.protocol.serialize(e),r=t.parameters.data;return MobileRpcProtocol._deflateData(t.parameters),MobileRpcProtocol._encode(JSON.stringify(t),r)}static encodeResponse(e){const t=e.result.data;return MobileRpcProtocol._deflateData(e.result),MobileRpcProtocol._encode(JSON.stringify(e),t)}static decodeRequest(e){const t=MobileRpcProtocol._decodeHeader(e),r=MobileRpcProtocol._decodeObject(t,e),n=JSON.parse(r);return MobileRpcProtocol._inflateData(n.parameters,e,t),n}static decodeResponse(e){const t=MobileRpcProtocol._decodeHeader(e),r=MobileRpcProtocol._decodeObject(t,e),n=JSON.parse(r);return MobileRpcProtocol._inflateData(n.result,e,t),n}static _deflateData(e){e.data=e.data.map(e=>e.byteLength)}static _inflateData(e,t,r){let n=r+4;for(let i=0;i!==e.data.length;++i){const r=e.data[i];e.data[i]=new Uint8Array(t,n,r),n+=r}}static _decodeHeader(e){return new DataView(e,0,4).getUint32(0)}static _decodeObject(e,t){return MobileRpcProtocol._decodeString(new Uint16Array(t,4,e/2))}static _toBytes(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}static _encode(e,t){const r=MobileRpcProtocol._encodeString(e),n=new DataView(new ArrayBuffer(4));return n.setUint32(0,r.byteLength),[MobileRpcProtocol._toBytes(n),MobileRpcProtocol._toBytes(r),...t]}static _decodeString(e){return String.fromCharCode.apply(null,e)}static _encodeString(e){const t=new Uint16Array(new ArrayBuffer(2*e.length));for(let r=0;r!==e.length;++r)t[r]=e.charCodeAt(r);return t}}t.MobileRpcProtocol=MobileRpcProtocol},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(69),i=r(3),o=r(249),s=r(42),a=r(40),c=r(102),l=r(43),u=r(282);class IModelNotFoundResponse extends c.RpcNotFoundResponse{}t.IModelNotFoundResponse=IModelNotFoundResponse;class IModelReadRpcInterface extends s.RpcInterface{static getClient(){return a.RpcManager.getClientForInterface(IModelReadRpcInterface)}openForRead(e,t){return this.forward.apply(this,arguments)}close(e,t){return this.forward.apply(this,arguments)}executeQuery(e,t,r){return this.forward.apply(this,arguments)}getModelProps(e,t){return this.forward.apply(this,arguments)}queryModelProps(e,t){return this.forward.apply(this,arguments)}getElementProps(e,t){return this.forward.apply(this,arguments)}queryElementProps(e,t){return this.forward.apply(this,arguments)}queryEntityIds(e,t){return this.forward.apply(this,arguments)}formatElements(e,t){return this.forward.apply(this,arguments)}getClassHierarchy(e,t){return this.forward.apply(this,arguments)}getAllCodeSpecs(e){return this.forward.apply(this,arguments)}getViewStateData(e,t){return this.forward.apply(this,arguments)}readFontJson(e){return this.forward.apply(this,arguments)}requestSnap(e,t,r){return this.forward.apply(this,arguments)}cancelSnap(e,t){return this.forward.apply(this,arguments)}loadNativeAsset(e,t){return this.forward.apply(this,arguments)}getToolTipMessage(e,t){return this.forward.apply(this,arguments)}getViewThumbnail(e,t){return this.forward.apply(this,arguments)}getDefaultViewId(e){return this.forward.apply(this,arguments)}}IModelReadRpcInterface.types=(()=>[n.AccessToken,u.IModelVersion,l.IModelToken,i.Point2d,i.Point3d,i.Vector2d,i.Vector3d,Date,o.Code,IModelNotFoundResponse]),IModelReadRpcInterface.version="0.1.0",t.IModelReadRpcInterface=IModelReadRpcInterface},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(506);function i(){return this.item}function o(){return this.matches.length>0?this.matches[0].key:this.matchedKey}function s(){return this.matches.length>0?this.matches[0].value:this.matchedValue}function a(){if(this.boldMask)return this.boldMask;if(0===this.matches.length){const e=new Array(this.matchedValue.length);return e.fill(!1),this.boldMask=e}const e=this.matches[0].value.length,t=new Array(e);return t.fill(!1),this.matches[0].indices.forEach(e=>{for(let r=e[0],n=e[1];r<=n;r++)t[r]=!0}),this.boldMask=t}t.FuzzySearch=class FuzzySearch{onGetSingleWordSearchOptions(){return{shouldSort:!0,threshold:.4,location:0,distance:100,maxPatternLength:32,minMatchCharLength:2,includeMatches:!0,includeScore:!0}}onGetMultiWordSearchOptions(){return{shouldSort:!0,threshold:.4,tokenize:!0,matchAllTokens:!0,maxPatternLength:32,minMatchCharLength:2,includeMatches:!0,includeScore:!0}}search(e,t,r){if(!r||r.length<2)return new FuzzySearchResults(void 0);const c=r.indexOf(" "),l=-1!==c&&c!==r.length-1?this.onGetMultiWordSearchOptions():this.onGetSingleWordSearchOptions();l.keys=t;let u=new n(e,l).search(r),d=!1,h=1;u.length>30&&(h=(u[u.length-1].score-u[0].score)/u.length*10)>.01&&(d=!0);for(let n=0;n<u.length;n++){const e=u[n];if(0===e.matches.length){if(n>2){u=u.slice(0,n);break}e.matchedValue=e.item[t[0]],e.matchedKey=t[0]}if(d&&n>0){const e=u[n].score;if(e<.101)continue;if(e-u[n-1].score>h){u=u.slice(0,n);break}}}for(const n of u)n.getResult=i.bind(n),n.getBoldMask=a.bind(n),n.getMatchedKey=o.bind(n),n.getMatchedValue=s.bind(n);return new FuzzySearchResults(u)}};class FuzzySearchResults{constructor(e){this.results=[],e&&(this.results=e)}[Symbol.iterator](){return new FuzzySearchResultsIterator(this)}get length(){return this.results.length}getResult(e){if(!(e<0||e>this.results.length))return this.results[e]}}t.FuzzySearchResults=FuzzySearchResults;class FuzzySearchResultsIterator{constructor(e){this.next=(()=>({done:this.counter===this.fsr.results.length,value:this.fsr.results[this.counter++]})),this.fsr=e,this.counter=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4);class ColorMap extends n.IndexMap{constructor(){super(n.compareNumbers,65535),this._hasTransparency=!1}hasColor(e){return-1!==this.indexOf(e)}insert(e){return this.isEmpty?this._hasTransparency=ColorMap.isTranslucent(e):(ColorMap.isTranslucent(e),this.hasTransparency),super.insert(e)}get hasTransparency(){return this._hasTransparency}get isUniform(){return 1===this.length}toColorIndex(e,t){if(e.reset(),0!==this.length)if(1===this.length)e.initUniform(this._array[0].value);else{const r=new Uint32Array(this.length);for(const e of this._array)r[e.index]=e.value;e.initNonUniform(r,t,this.hasTransparency)}}static isTranslucent(e){return this._scratchColorDef.tbgr=e,255!==this._scratchColorDef.getAlpha()}}ColorMap._scratchColorDef=new i.ColorDef,t.ColorMap=ColorMap},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(512),i=r(0);class ConversionData{constructor(){this.factor=1,this.offset=0}}t.ConversionData=ConversionData;class Unit{constructor(e,t,r){this.name="",this.label="",this.unitFamily="",this.isValid=!1,e&&e.length>0&&t&&t.length>0&&r&&r.length>0&&(this.name=e,this.label=t,this.unitFamily=r,this.isValid=!0)}}t.Unit=Unit;const o=[{name:"Units.RAD",unitFamily:"Units.ANGLE",conversion:{numerator:1,denominator:1,offset:0},displayLabel:"rad",altDisplayLabels:["radian"]},{name:"Units.ARC_DEG",unitFamily:"Units.ANGLE",conversion:{numerator:180,denominator:3.141592653589793,offset:0},displayLabel:"\xb0",altDisplayLabels:["deg"]},{name:"Units.ARC_MINUTE",unitFamily:"Units.ANGLE",conversion:{numerator:10800,denominator:3.141592653589793,offset:0},displayLabel:"'",altDisplayLabels:["min"]},{name:"Units.ARC_SECOND",unitFamily:"Units.ANGLE",conversion:{numerator:648e3,denominator:3.141592653589793,offset:0},displayLabel:'"',altDisplayLabels:["sec"]},{name:"Units.GRAD",unitFamily:"Units.ANGLE",conversion:{numerator:200,denominator:3.141592653589793,offset:0},displayLabel:"grad",altDisplayLabels:["gd"]},{name:"Units.S",unitFamily:"Units.TIME",conversion:{numerator:1,denominator:1,offset:0},displayLabel:"s",altDisplayLabels:["sec"]},{name:"Units.MIN",unitFamily:"Units.TIME",conversion:{numerator:1,denominator:60,offset:0},displayLabel:"min",altDisplayLabels:[]},{name:"Units.HR",unitFamily:"Units.TIME",conversion:{numerator:1,denominator:3600,offset:0},displayLabel:"h",altDisplayLabels:["hr"]},{name:"Units.DAY",unitFamily:"Units.TIME",conversion:{numerator:1,denominator:86400,offset:0},displayLabel:"days",altDisplayLabels:["day"]},{name:"Units.WEEK",unitFamily:"Units.TIME",conversion:{numerator:1,denominator:604800,offset:0},displayLabel:"weeks",altDisplayLabels:["week"]},{name:"Units.YR",unitFamily:"Units.TIME",conversion:{numerator:1,denominator:31536e3,offset:0},displayLabel:"years",altDisplayLabels:["year"]},{name:"Units.M",unitFamily:"Units.LENGTH",conversion:{numerator:1,denominator:1,offset:0},displayLabel:"m",altDisplayLabels:["meter"]},{name:"Units.MM",unitFamily:"Units.LENGTH",conversion:{numerator:1e3,denominator:1,offset:0},displayLabel:"mm",altDisplayLabels:["MM"]},{name:"Units.CM",unitFamily:"Units.LENGTH",conversion:{numerator:100,denominator:1,offset:0},displayLabel:"cm",altDisplayLabels:["CM"]},{name:"Units.DM",unitFamily:"Units.LENGTH",conversion:{numerator:10,denominator:1,offset:0},displayLabel:"dm",altDisplayLabels:["DM"]},{name:"Units.KM",unitFamily:"Units.LENGTH",conversion:{numerator:1,denominator:1e3,offset:0},displayLabel:"km",altDisplayLabels:["KM"]},{name:"Units.UM",unitFamily:"Units.LENGTH",conversion:{numerator:1e6,denominator:1,offset:0},displayLabel:"\xb5m",altDisplayLabels:[]},{name:"Units.MILLIINCH",unitFamily:"Units.LENGTH",conversion:{numerator:1e3,denominator:.0254,offset:0},displayLabel:"mil",altDisplayLabels:[]},{name:"Units.MICROINCH",unitFamily:"Units.LENGTH",conversion:{numerator:1e6,denominator:.0254,offset:0},displayLabel:"\xb5in",altDisplayLabels:[]},{name:"Units.MILLIFOOT",unitFamily:"Units.LENGTH",conversion:{numerator:1e3,denominator:.3048,offset:0},displayLabel:"mft",altDisplayLabels:[]},{name:"Units.IN",unitFamily:"Units.LENGTH",conversion:{numerator:1,denominator:.0254,offset:0},displayLabel:"in",altDisplayLabels:["IN",'"']},{name:"Units.FT",unitFamily:"Units.LENGTH",conversion:{numerator:1,denominator:.3048,offset:0},displayLabel:"ft",altDisplayLabels:["F","FT","'"]},{name:"Units.YRD",unitFamily:"Units.LENGTH",conversion:{numerator:1,denominator:.9144,offset:0},displayLabel:"yd",altDisplayLabels:["YRD","yrd"]},{name:"Units.MILE",unitFamily:"Units.LENGTH",conversion:{numerator:1,denominator:1609.344,offset:0},displayLabel:"mi",altDisplayLabels:["mile","Miles","Mile"]},{name:"Units.SQ_FT",unitFamily:"Units.AREA",conversion:{numerator:1,denominator:.09290304,offset:0},displayLabel:"ft\xb2",altDisplayLabels:["sf"]},{name:"Units.SQ_M",unitFamily:"Units.AREA",conversion:{numerator:1,denominator:1,offset:0},displayLabel:"m\xb2",altDisplayLabels:[]},{name:"Units.CUB_FT",unitFamily:"Units.AREA",conversion:{numerator:1,denominator:.028316847,offset:0},displayLabel:"ft\xb3",altDisplayLabels:["cf"]},{name:"Units.CUB_M",unitFamily:"Units.AREA",conversion:{numerator:1,denominator:1,offset:0},displayLabel:"m\xb3",altDisplayLabels:[]}];var s;!function(e){e[e.Length=1]="Length",e[e.Angle=2]="Angle",e[e.Area=3]="Area",e[e.Volume=4]="Volume"}(s=t.QuantityType||(t.QuantityType={}));const a={metric:[{type:1,format:{composite:{includeZero:!0,spacer:" ",units:[{label:"m",name:"Units.M"}]},formatTraits:["keepSingleZero","keepDecimalPoint","showUnitLabel"],precision:4,type:"Decimal"}},{type:2,format:{composite:{includeZero:!0,spacer:"",units:[{label:"\xb0",name:"Units.ARC_DEG"}]},formatTraits:["keepSingleZero","keepDecimalPoint","showUnitLabel"],precision:2,type:"Decimal",uomSeparator:""}},{type:3,format:{composite:{includeZero:!0,spacer:" ",units:[{label:"m\xb2",name:"Units.SQ_M"}]},formatTraits:["keepSingleZero","keepDecimalPoint","showUnitLabel"],precision:4,type:"Decimal"}},{type:4,format:{composite:{includeZero:!0,spacer:" ",units:[{label:"m\xb3",name:"Units.CUB_M"}]},formatTraits:["keepSingleZero","keepDecimalPoint","showUnitLabel"],precision:4,type:"Decimal"}}],imperial:[{type:1,format:{composite:{includeZero:!0,spacer:"-",units:[{label:"'",name:"Units.FT"},{label:'"',name:"Units.IN"}]},formatTraits:["keepSingleZero","showUnitLabel"],precision:8,type:"Fractional",uomSeparator:""}},{type:2,format:{composite:{includeZero:!0,spacer:"",units:[{label:"\xb0",name:"Units.ARC_DEG"},{label:"'",name:"Units.ARC_MINUTE"},{label:'"',name:"Units.ARC_SECOND"}]},formatTraits:["keepSingleZero","keepDecimalPoint","showUnitLabel"],precision:2,type:"Decimal",uomSeparator:""}},{type:3,format:{composite:{includeZero:!0,spacer:" ",units:[{label:"ft\xb2",name:"Units.SQ_FT"}]},formatTraits:["keepSingleZero","keepDecimalPoint","showUnitLabel"],precision:4,type:"Decimal"}},{type:4,format:{composite:{includeZero:!0,spacer:" ",units:[{label:"ft\xb3",name:"Units.CUB_FT"}]},formatTraits:["keepSingleZero","keepDecimalPoint","showUnitLabel"],precision:4,type:"Decimal"}}]};t.QuantityFormatter=class QuantityFormatter{constructor(){this._activeSystemIsImperial=!0,this._formatSpecsByKoq=new Map,this._imperialFormatsByType=new Map,this._metricFormatsByType=new Map,this._imperialFormatSpecsByType=new Map,this._metricFormatSpecsByType=new Map}async findUnit(e,t){for(const r of o)if(!t||r.unitFamily===t){if(r.displayLabel===e||r.name===e){const e=new Unit(r.name,r.displayLabel,r.unitFamily);return Promise.resolve(e)}if(r.altDisplayLabels&&r.altDisplayLabels.length>0&&-1!==r.altDisplayLabels.findIndex(t=>t===e)){const e=new Unit(r.name,r.displayLabel,r.unitFamily);return Promise.resolve(e)}}return Promise.resolve(new n.BadUnit)}findUnitDefinition(e){for(const t of o)if(t.name===e)return t}async findUnitByName(e){const t=this.findUnitDefinition(e);return t?Promise.resolve(new Unit(t.name,t.displayLabel,t.unitFamily)):Promise.resolve(new n.BadUnit)}async getConversion(e,t){const r=this.findUnitDefinition(e.name),n=this.findUnitDefinition(t.name);if(r&&n){const e=n.conversion.offset-r.conversion.offset,t=n.conversion.numerator*r.conversion.denominator,i=n.conversion.denominator*r.conversion.numerator,o=new ConversionData;return o.factor=t/i,o.offset=e,Promise.resolve(o)}return Promise.resolve(new ConversionData)}async loadKoqFormatSpecs(e){return 0===e.length?Promise.reject(new Error("bad koq specification")):(this._formatSpecsByKoq.has(e),Promise.reject(new Error("not yet implemented")))}async getKoqFormatterSpecsAsync(e,t){return 0===e.length&&t?Promise.reject(new Error("bad koq specification")):Promise.resolve(this._formatSpecsByKoq.get(e))}async getKoqFormatterSpecAsync(e,t){if(0===e.length&&t)return Promise.reject(new Error("bad koq specification"));const r=await Promise.resolve(this._formatSpecsByKoq.get(e));if(r&&r.length>0){const e=0;return Promise.resolve(r[e])}return Promise.reject(new Error("not yet implemented"))}getKoqFormatterSpec(e,t){if(0!==e.length||!t)throw new Error("not yet implemented")}async formatKindOfQuantityAsync(e,t){const r=await this.getKoqFormatterSpecAsync(t,this._activeSystemIsImperial);return void 0===r?Promise.resolve(""):Promise.resolve(n.Formatter.formatQuantity(e,r))}async loadStdFormat(e,t){let r;const o=t?a.imperial:a.metric;for(const i of o)if(i.type===e){r=i.format;const e=new n.Format("stdFormat");return await e.fromJson(this,r),Promise.resolve(e)}throw new i.BentleyError(32768,"IModelApp must define a formatsProvider class to provide formats for tools")}async getFormatByQuantityType(e,t){const r=t?this._imperialFormatsByType:this._metricFormatsByType;let n=r.get(e);if(n)return Promise.resolve(n);if(n=await this.loadStdFormat(e,t))return r.set(e,n),Promise.resolve(n);throw new i.BentleyError(32768,"IModelApp must define a formatsProvider class to provide formats for tools")}async getUnitByQuantityType(e){switch(e){case s.Angle:return this.findUnitByName("Units.RAD");case s.Area:return this.findUnitByName("Units.SQ_M");case s.Volume:return this.findUnitByName("Units.M");case s.Length:default:return this.findUnitByName("Units.M")}}getFormatterSpecByQuantityType(e,t){const r=t?this._imperialFormatSpecsByType:this._metricFormatSpecsByType;if(0!==r.size)return r.get(e);this.loadFormatSpecsForQuantityTypes(t)}async loadFormatSpecsForQuantityTypes(e){const t=[s.Length,s.Angle,s.Area,s.Volume],r=e?this._imperialFormatSpecsByType:this._metricFormatSpecsByType;r.clear();for(const i of t){const t=this.getFormatByQuantityType(i,e),o=this.getUnitByQuantityType(i),[s,a]=await Promise.all([t,o]),c=await n.FormatterSpec.create(s.name,s,this,a);r.set(i,c)}return Promise.resolve()}formatKindOfQuantity(e,t){const r=this.getKoqFormatterSpec(t,this._activeSystemIsImperial);if(void 0!==r)return n.Formatter.formatQuantity(e,r)}formatQuantity(e,t){const r=this.getFormatterSpecByQuantityType(t,this._activeSystemIsImperial);if(void 0!==r)return n.Formatter.formatQuantity(e,r)}set useImperialFormats(e){this._activeSystemIsImperial=e,this.loadFormatSpecsForQuantityTypes(e)}get useImperialFormats(){return this._activeSystemIsImperial}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class Quantity{constructor(e,t){this._magnitude=0,this._isValid=!1,void 0!==e?(this._unit=e,this._isValid=!0):this._unit={name:"unknown",label:"unknown",unitFamily:"unknown",isValid:!1},void 0!==t&&(this._magnitude=t)}get unit(){return this._unit}get magnitude(){return this._magnitude}get isValid(){return this._isValid}convertTo(e,t){const r=this.magnitude*t.factor+t.offset;return new Quantity(e,r)}}t.Quantity=Quantity},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(0),o=r(26),s=r(4),a=r(7),c=r(519),l=r(105),u=r(89),d=r(20),h=r(90),p=r(182),f=r(140),g=r(11),m=r(520),y=r(141),v=r(41),_=r(44),w=r(142),S=r(65);var b,x;!function(e){e[e.TwoDee=0]="TwoDee",e[e.Orthographic=1]="Orthographic",e[e.Perspective=2]="Perspective"}(t.FrustumUniformType||(t.FrustumUniformType={})),function(e){e[e.kTop=0]="kTop",e[e.kBottom=1]="kBottom",e[e.kLeft=2]="kLeft",e[e.kRight=3]="kRight"}(b||(b={})),function(e){e[e.kNear=0]="kNear",e[e.kFar=1]="kFar",e[e.kType=2]="kType"}(x||(x={}));class FrustumUniforms{constructor(){const e=[];e[0]=0,e[1]=0,e[2]=0,e[3]=0;const t=[];t[0]=0,t[1]=0,t[2]=0,this._planeData=new Float32Array(e),this._frustumData=new Float32Array(t)}get frustumPlanes(){return this._planeData}get frustum(){return this._frustumData}get nearPlane(){return this._frustumData[0]}get farPlane(){return this._frustumData[1]}get type(){return this.frustum[2]}get is2d(){return 0===this.type}setPlanes(e,t,r,n){this._planeData[0]=e,this._planeData[1]=t,this._planeData[2]=r,this._planeData[3]=n}setFrustum(e,t,r){this._frustumData[0]=e,this._frustumData[1]=t,this._frustumData[2]=r}}t.FrustumUniforms=FrustumUniforms;class Clips{constructor(){this._clipActive=0,this._clipCount=0}get texture(){return this._texture}get count(){return this._clipCount}get isValid(){return this._clipCount>0}set(e,t){this._clipActive++,1===this._clipActive&&(this._clipCount=e,this._texture=t)}clear(){1===this._clipActive&&(this._clipCount=0,this._texture=void 0),this._clipActive>0&&this._clipActive--}}t.Clips=Clips;function P(e,t,r){const n=e.data[t];e.data[t]=e.data[r],e.data[r]=n}t.PerformanceMetrics=class PerformanceMetrics{constructor(e=!1,t=!1){this._lastTimePoint=i.BeTimePoint.now(),this.frameTimings=new Map,this.gatherGlFinish=!1,this.gatherCurPerformanceMetrics=!1,this.curSpfTimeIndex=0,this.spfTimes=[],this.spfSum=0,this.renderSpfTimes=[],this.renderSpfSum=0,this.loadTileTimes=[],this.loadTileSum=0,this.fpsTimer=new i.StopWatch(void 0,!0),this.fpsTimerStart=0,this.gatherGlFinish=e,this.gatherCurPerformanceMetrics=t}startNewFrame(e=0){this.frameTimings=new Map,this.frameTimings.set("Scene Time",e),this._lastTimePoint=i.BeTimePoint.now()}recordTime(e){const t=i.BeTimePoint.now();this.frameTimings.set(e,t.milliseconds-this._lastTimePoint.milliseconds),this._lastTimePoint=i.BeTimePoint.now()}endFrame(e){const t=i.BeTimePoint.now();let r=0;this.frameTimings.forEach(e=>{r+=e}),this.frameTimings.set("Total RenderFrame Time",r);const n=t.milliseconds-this._lastTimePoint.milliseconds;this.frameTimings.set(e||"Finish GPU Queue",n),this.frameTimings.set("Total Time w/ GPU",r+n),this._lastTimePoint=i.BeTimePoint.now()}};class Target extends o.RenderTarget{constructor(e){super(),this._stack=new c.BranchStack,this._scene=[],this._terrain=[],this._overridesUpdateTime=i.BeTimePoint.now(),this._hiliteUpdateTime=i.BeTimePoint.now(),this._flashedElemId=i.Id64.invalid,this._flashedUpdateTime=i.BeTimePoint.now(),this._flashIntensity=0,this._transparencyThreshold=0,this.clips=new Clips,this._fStop=0,this._ambientLight=new Float32Array(3),this._dcAssigned=!1,this.decorationState=c.BranchState.createForDecorations(),this.frustumUniforms=new FrustumUniforms,this.bgColor=s.ColorDef.red.clone(),this.monoColor=s.ColorDef.white.clone(),this.hiliteSettings=new s.Hilite.Settings,this.planFrustum=new s.Frustum,this.renderRect=new d.ViewRect,this._planFraction=0,this.nearPlaneCenter=new n.Point3d,this.viewMatrix=n.Transform.createIdentity(),this.projectionMatrix=n.Matrix4d.createIdentity(),this._visibleEdgeOverrides=new u.EdgeOverrides,this._hiddenEdgeOverrides=new u.EdgeOverrides,this._batches=[],this._doDebugPaint=!1,this._scratchTmpFrustum=new s.Frustum,this._scratchRectFrustum=new s.Frustum,this._scratchViewFlags=new s.ViewFlags,this._renderCommands=new h.RenderCommands(this,this._stack),this._overlayRenderState=new f.RenderState,this._overlayRenderState.flags.depthMask=!1,this._overlayRenderState.flags.blend=!0,this._overlayRenderState.blend.setBlendFunc(g.GL.BlendFactor.One,g.GL.BlendFactor.OneMinusSrcAlpha),this.compositor=m.SceneCompositor.create(this),this.renderRect=e||new d.ViewRect}get currentOverrides(){return this._currentOverrides}set currentOverrides(e){this._currentOverrides=void 0!==e&&e.anyOverridden?e:void 0}get transparencyThreshold(){return this._transparencyThreshold}get techniques(){return a.System.instance.techniques}get hilite(){return this._hilite}get hiliteUpdateTime(){return this._hiliteUpdateTime}get flashedElemId(){return this._flashedElemId}get flashedUpdateTime(){return this._flashedUpdateTime}get flashIntensity(){return this._flashIntensity}get overridesUpdateTime(){return this._overridesUpdateTime}get areDecorationOverridesActive(){return!1}get fStop(){return this._fStop}get ambientLight(){return this._ambientLight}get shaderLights(){return this._shaderLights}get scene(){return this._scene}get dynamics(){return this._dynamics}getWorldDecorations(e){if(void 0===this._worldDecorations){const e=new s.ViewFlags;e.renderMode=6,e.clipVolume=!1;const t=!this.is2d;e.sourceLights=t,e.cameraLights=t,e.solarLight=t,this._worldDecorations=new l.WorldDecorations(e)}return this._worldDecorations.init(e),this._worldDecorations}get currentViewFlags(){return this._stack.top.viewFlags}get currentTransform(){return this._stack.top.transform}get currentShaderFlags(){return this.currentViewFlags.monochrome?1:0}get currentFeatureSymbologyOverrides(){return this._stack.top.symbologyOverrides}get clipDef(){return this.hasClipVolume?new w.ClipDef(2,this.clips.count):this.hasClipMask?new w.ClipDef(1):new w.ClipDef}get hasClipVolume(){return this.clips.isValid&&this._stack.top.showClipVolume}get hasClipMask(){return void 0!==this.clipMask}get clipMask(){return this._clipMask}set clipMask(e){this.hasClipMask,this.is2d,this._clipMask=e}get environmentMap(){return this._environmentMap}get diffuseMap(){return this._diffuseMap}get is2d(){return this.frustumUniforms.is2d}get is3d(){return!this.is2d}dispose(){this.reset(),i.dispose(this.compositor),this._environmentMap=i.dispose(this._environmentMap),this._diffuseMap=i.dispose(this._diffuseMap),this._dcAssigned=!1}pushBranch(e,t){this._stack.pushBranch(t);const r=this._stack.top.clipVolume;void 0!==r&&r.pushToShaderExecutor(e)}pushState(e){e.clipVolume,this._stack.pushState(e)}popBranch(){const e=this._stack.top.clipVolume;void 0!==e&&e.pop(this),this._stack.pop()}pushActiveVolume(){void 0!==this._activeClipVolume&&this._activeClipVolume.pushToTarget(this)}popActiveVolume(){void 0!==this._activeClipVolume&&this._activeClipVolume.pop(this)}addBatch(e){this._batches.indexOf(e),this._batches.push(e)}onBatchDisposed(e){const t=this._batches.indexOf(e);this._batches.splice(t,1)}get renderSystem(){return a.System.instance}get cameraFrustumNearScaleLimit(){return 0}get planFraction(){return this._planFraction}changeDecorations(e){this._decorations=i.dispose(this._decorations),this._decorations=e,S.AttributeHandle.disableAll()}changeScene(e,t){this._scene=e,this._activeClipVolume=t}changeTerrain(e){this._terrain=e}changeDynamics(e){i.disposeArray(this._dynamics),this._dynamics=e}overrideFeatureSymbology(e){this._stack.setSymbologyOverrides(e),this._overridesUpdateTime=i.BeTimePoint.now()}setHiliteSet(e){this._hilite=e,this._hiliteUpdateTime=i.BeTimePoint.now()}setFlashed(e,t){e!==this._flashedElemId&&(this._flashedElemId=e,this._flashedUpdateTime=i.BeTimePoint.now()),this._flashIntensity=t}changeFrustum(e){e.frustum.clone(this.planFrustum);const t=e.frustum.getCorner(0),r=e.frustum.getCorner(1),i=e.frustum.getCorner(2),s=e.frustum.getCorner(3),a=e.frustum.getCorner(4),c=e.frustum.getCorner(5),l=e.frustum.getCorner(6),u=e.frustum.getCorner(7),d=Target._scratch,h=a.interpolate(.5,u,d.nearCenter),p=C(c,a,d.viewX),f=C(l,a,d.viewY),g=p.crossProduct(f,d.viewZ).normalize();if(this._planFraction=e.fraction,e.is3d)if(e.fraction>.999){const e=.5*n.Vector3d.createStartEnd(r,t,d.vec3).magnitude(),i=.5*n.Vector3d.createStartEnd(r,s).magnitude(),o=n.Vector3d.createStartEnd(t,a,d.vec3).magnitude();E(h,p,f,g,this.viewMatrix),I(-e,e,-i,i,0,o,this.projectionMatrix),this.nearPlaneCenter.setFrom(a),this.nearPlaneCenter.interpolate(.5,u,this.nearPlaneCenter),this.frustumUniforms.setPlanes(i,-i,-e,e),this.frustumUniforms.setFrustum(0,o,1)}else{const o=1/(1-e.fraction),s=T(t,n.Vector3d.createStartEnd(t,a,d.vec3),o,d.point3),c=M(t,s,p)*e.fraction,l=M(r,s,p)*e.fraction,h=M(t,s,f)*e.fraction,x=M(i,s,f)*e.fraction,P=-M(a,s,g),C=-M(t,s,g);E(s,p,f,g,this.viewMatrix),m=c,y=l,v=h,_=x,w=P,S=C,b=this.projectionMatrix,n.Matrix4d.createRowValues(2*w/(y-m),0,(y+m)/(y-m),0,0,2*w/(_-v),(_+v)/(_-v),0,0,0,-(S+w)/(S-w),-2*S*w/(S-w),0,0,-1,0,b),this.nearPlaneCenter.setFrom(a),this.nearPlaneCenter.interpolate(.5,u,this.nearPlaneCenter),this.frustumUniforms.setPlanes(x,h,c,l),this.frustumUniforms.setFrustum(P,C,2)}else{const e=.5*n.Vector3d.createStartEnd(r,t,d.vec3).magnitude(),i=.5*n.Vector3d.createStartEnd(r,s).magnitude(),a=2*o.RenderTarget.frustumDepth2d;this.nearPlaneCenter.set(h.x,h.y,o.RenderTarget.frustumDepth2d),E(this.nearPlaneCenter,p,f,g,this.viewMatrix),I(-e,e,-i,i,0,a,this.projectionMatrix),this.frustumUniforms.setPlanes(i,-i,-e,e),this.frustumUniforms.setFrustum(0,a,0)}var m,y,v,_,w,S,b}changeRenderPlan(e){if(this.plan=e,this._dcAssigned&&e.is3d!==this.is3d&&(i.dispose(this._worldDecorations),this._worldDecorations=void 0),!this.assignDC())return;let t;this.bgColor.setFrom(e.bgColor),this.monoColor.setFrom(e.monoColor),this.hiliteSettings=e.hiliteSettings,this._transparencyThreshold=0,this.analysisStyle=void 0===e.analysisStyle?void 0:e.analysisStyle.clone(),this.analysisTexture=e.analysisTexture,void 0!==e.activeVolume&&(2===e.activeVolume.type?t=e.activeVolume:1===e.activeVolume.type&&(t=e.activeVolume)),this._activeClipVolume=t;const r=Target._scratch;let n=void 0!==e.hline?e.hline.visible:void 0,o=void 0!==e.hline?e.hline.hidden:void 0;const a=s.ViewFlags.createFrom(e.viewFlags,r.viewFlags);let c=!0;switch(a.renderMode){case 0:a.visibleEdges=!1,a.hiddenEdges=!1,c=!1;break;case 6:a.visibleEdges||(a.hiddenEdges=!1);break;case 4:void 0===n||n.ovrColor||(n=n.overrideColor(s.ColorDef.white),o=o.overrideColor(s.ColorDef.white));case 3:if(a.visibleEdges=!0,e.hline,void 0!==e.hline){let t=e.hline.transparencyThreshold;t=Math.min(1,Math.max(0,t)),this._transparencyThreshold=1-t}}this._visibleEdgeOverrides.init(c,n),this._hiddenEdgeOverrides.init(c,o),this._stack.setViewFlags(a),this.changeFrustum(e),this._fStop=0,this._ambientLight[0]=.2,this._ambientLight[1]=.2,this._ambientLight[2]=.2,e.is3d&&void 0!==e.lights&&(this._fStop=e.lights.fstop)}drawFrame(e){a.System.instance.frameBufferStack.isEmpty,void 0!==this._scene&&(this.paintScene(e),this.drawOverlayDecorations(),a.System.instance.frameBufferStack.isEmpty)}drawOverlayDecorations(){}reset(){this._scene.length=0,i.dispose(this._decorations),this._dynamics=i.disposeArray(this._dynamics),this._worldDecorations=i.dispose(this._worldDecorations),this._renderCommands.clear();for(const e of this._batches)e.onTargetDisposed(this);this._batches=[]}get wantInvertBlackBackground(){return!1}get visibleEdgeOverrides(){return this.getEdgeOverrides(1)}get hiddenEdgeOverrides(){return this.getEdgeOverrides(6)}get isEdgeColorOverridden(){const e=this.visibleEdgeOverrides;return void 0!==e&&e.overridesColor}get isEdgeWeightOverridden(){const e=this.visibleEdgeOverrides;return void 0!==e&&e.overridesWeight}getEdgeOverrides(e){let t,r=!1;return 6===e?(t=this._hiddenEdgeOverrides,r=this.currentViewFlags.hiddenEdges):(t=this._visibleEdgeOverrides,r=this.currentViewFlags.visibleEdges),r?t:void 0}getEdgeWeight(e,t){const r=this.getEdgeOverrides(e.renderPass);return void 0!==r&&void 0!==r.weight?r.weight:t}getEdgeLineCode(e,t){const r=this.getEdgeOverrides(e.renderPass);return void 0!==r&&void 0!==r.lineCode?r.lineCode:t}get edgeColor(){return this.isEdgeColorOverridden,p.ColorInfo.createUniform(this._visibleEdgeOverrides.color)}debugPaint(){}paintScene(e){if(this._doDebugPaint)return void this.debugPaint();if(!this._dcAssigned)return;this.performanceMetrics&&this.performanceMetrics.startNewFrame(e),this._beginPaint();const t=a.System.instance.context,r=this.viewRect;t.viewport(0,0,r.width,r.height);if(this.performanceMetrics&&this.performanceMetrics.recordTime("Begin Paint"),this._renderCommands.init(this._scene,this._terrain,this._decorations,this._dynamics),this.performanceMetrics&&this.performanceMetrics.recordTime("Init Commands"),this.compositor.draw(this._renderCommands),this._stack.pushState(this.decorationState),this.drawPass(8),this.drawPass(9),this._stack.pop(),this.performanceMetrics&&this.performanceMetrics.recordTime("Overlay Draws"),this._endPaint(),this.performanceMetrics&&this.performanceMetrics.recordTime("End Paint"),this.performanceMetrics){if(this.performanceMetrics.gatherCurPerformanceMetrics){const t=this.performanceMetrics,r=t.fpsTimer.currentSeconds-t.fpsTimerStart;t.spfTimes[t.curSpfTimeIndex]&&(t.spfSum-=t.spfTimes[t.curSpfTimeIndex]),t.spfSum+=r,t.spfTimes[t.curSpfTimeIndex]=r;let n=0;t.frameTimings.forEach(e=>{n+=e}),t.renderSpfTimes[t.curSpfTimeIndex]&&(t.renderSpfSum-=t.renderSpfTimes[t.curSpfTimeIndex]),t.renderSpfSum+=n,t.renderSpfTimes[t.curSpfTimeIndex]=n,void 0!==e&&(t.loadTileTimes[t.curSpfTimeIndex]&&(t.loadTileSum-=t.loadTileTimes[t.curSpfTimeIndex]),t.loadTileSum+=e,t.loadTileTimes[t.curSpfTimeIndex]=e),t.curSpfTimeIndex++,t.curSpfTimeIndex>=50&&(t.curSpfTimeIndex=0),t.fpsTimerStart=t.fpsTimer.currentSeconds}if(this.performanceMetrics.gatherGlFinish){const e=new Uint8Array(4);a.System.instance.frameBufferStack.execute(this._fbo,!0,()=>{t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,e)}),this.performanceMetrics&&this.performanceMetrics.endFrame("Finish GPU Queue")}}}drawPass(e){a.System.instance.applyRenderState(this.getRenderState(e)),this.techniques.execute(this,this._renderCommands.getCommands(e),e)}getRenderState(e){return this._overlayRenderState}assignDC(){return this._dcAssigned||(this._dcAssigned=this._assignDC()),this._dcAssigned,this._dcAssigned}readPixels(e,t){const r=v.TextureHandle.createForAttachment(e.width,e.height,g.GL.Texture.Format.Rgba,g.GL.Texture.DataType.UnsignedByte);if(void 0===r)return;let n;const o=y.FrameBuffer.create([r]);return void 0!==o&&(a.System.instance.frameBufferStack.execute(o,!0,()=>{n=this.readPixelsFromFbo(e,t)}),i.dispose(o)),i.dispose(r),n}readPixelsFromFbo(e,t){const r=this.currentViewFlags.clone(this._scratchViewFlags);r.transparency=!1,r.textures=!0,r.sourceLights=!1,r.cameraLights=!1,r.solarLight=!1,r.shadows=!1,r.noGeometryMap=!0,r.acsTriad=!1,r.grid=!1,r.monochrome=!1,r.materials=!1;const n=c.BranchState.create(this._stack.top.symbologyOverrides,r);this.pushState(n);const i=this.viewRect,o=(e.left-i.left)/(i.right-i.left),s=(i.right-e.right)/(i.right-i.left),a=(e.top-i.top)/(i.bottom-i.top),l=(i.bottom-e.bottom)/(i.bottom-i.top),u=this._scratchTmpFrustum,d=this.planFrustum;A(u,d,0,o,1),A(u,d,1,s,0),A(u,d,2,o,3),A(u,d,3,s,2),A(u,d,4,o,5),A(u,d,5,s,4),A(u,d,6,o,7),A(u,d,7,s,6);const h=this._scratchRectFrustum;return A(h,u,0,l,2),A(h,u,1,l,3),A(h,u,2,a,0),A(h,u,3,a,1),A(h,u,4,l,6),A(h,u,5,l,7),A(h,u,6,a,4),A(h,u,7,a,5),this._renderCommands.clear(),this._renderCommands.setCheckRange(h),this._renderCommands.init(this._scene,this._terrain,this._decorations,this._dynamics,!0),this._renderCommands.clearCheckRange(),this.compositor.drawForReadPixels(this._renderCommands,void 0!==this._decorations?this._decorations.worldOverlay:void 0),this._stack.pop(),this.compositor.readPixels(e,t)}adjustRectForAspectRatio(e,t){const r=e.clone();if(t>=1){const e=r.width,n=r.height*t-e;r.inset(-n/2,0)}else{const e=r.height,n=r.width/t-e;r.inset(0,-n/2)}return r}readImagePixels(e,t,r,n,i){if(this._fbo,void 0===this._fbo)return!1;const o=a.System.instance.context;let s=!0;return a.System.instance.frameBufferStack.execute(this._fbo,!0,()=>{try{o.readPixels(t,r,n,i,o.RGBA,o.UNSIGNED_BYTE,e)}catch(e){s=!1}}),!!s}readImage(e,t,r){const i=this.renderRect,o=e.clone();-1!==o.right&&-1!==o.bottom||(o.right=i.right,o.bottom=i.bottom);const a=t.clone();0!==a.x&&0!==a.y||(a.x=o.width,a.y=o.height);const c=n.Point2d.create(o.right-1,o.bottom-1);if(!i.containsPoint(n.Point2d.create(o.left,o.top))||!i.containsPoint(c))return;let l=this.adjustRectForAspectRatio(o,a.x/a.y);if(l=o.clone(),a.x=l.width,a.y=l.height,!i.containsPoint(n.Point2d.create(o.left,o.top))||!i.containsPoint(c))return;this.assignDC();const u=new Uint8Array(4*l.width*l.height);if(!this.readImagePixels(u,l.left,i.height-l.bottom,l.width,l.height))return;const d=s.ImageBuffer.create(u,0,a.x);if(!d)return;const h=0===this.bgColor.getAlpha();let p=!0;for(let n=3;n<d.data.length;n+=4){const e=d.data[n];(!h||0<e)&&(d.data[n]=255,p=!1)}if(!p){if(r){const e=Math.floor(d.height/2),t=4*d.width;for(let r=0;r<e;r++)for(let e=0;e<d.width;e++){const n=r*t+4*e,i=(d.height-1-r)*t+4*e;P(d,n,i),P(d,n+1,i+1),P(d,n+2,i+2),P(d,n+3,i+3)}}return d}}}Target._scratch={viewFlags:new s.ViewFlags,nearCenter:new n.Point3d,viewX:new n.Vector3d,viewY:new n.Vector3d,viewZ:new n.Vector3d,vec3:new n.Vector3d,point3:new n.Point3d,animationDisplay:void 0},t.Target=Target;class OnScreenTarget extends Target{constructor(e){super(),this._prevViewRect=new d.ViewRect,this._animationFraction=0,this._canvas=e}dispose(){this._fbo=i.dispose(this._fbo),this._blitGeom=i.dispose(this._blitGeom),super.dispose()}get animationFraction(){return this._animationFraction}set animationFraction(e){this._animationFraction=e}get viewRect(){return 0<this.renderRect.width&&this.renderRect.height,Math.floor(this.renderRect.width)===this.renderRect.width&&(Math.floor(this.renderRect.height),this.renderRect.height),this.renderRect}setViewRect(e,t){}_assignDC(){this._fbo;const e=this.viewRect,t=v.TextureHandle.createForAttachment(e.width,e.height,g.GL.Texture.Format.Rgba,g.GL.Texture.DataType.UnsignedByte);if(void 0===t)return!1;if(this._fbo=y.FrameBuffer.create([t]),void 0===this._fbo)return!1;const r=this._fbo.getColor(0);return r.getHandle(),this._blitGeom=_.SingleTexturedViewportQuadGeometry.createGeometry(r.getHandle(),12),void 0!==this._blitGeom}debugPaint(){const e=this.viewRect,t=a.System.instance.canvas;t.width=e.width,t.height=e.height;const r=a.System.instance.context;r.viewport(0,0,e.width,e.height),r.clearColor(1,0,1,1),r.clear(r.COLOR_BUFFER_BIT);const n=this._canvas.getContext("2d");n.drawImage(t,0,0)}updateViewRect(){this.renderRect.init(0,0,this._canvas.clientWidth,this._canvas.clientHeight);const e=this.renderRect;return(this._prevViewRect.width!==e.width||this._prevViewRect.height!==e.height)&&(this._canvas.width=e.width,this._canvas.height=e.height,this._prevViewRect.setFrom(e),!0)}_beginPaint(){this._fbo;const e=a.System.instance;e.frameBufferStack.push(this._fbo,!0);const t=this.viewRect;e.canvas.width!==t.width&&(e.canvas.width=t.width),e.canvas.height!==t.height&&(e.canvas.height=t.height),e.context.drawingBufferWidth,t.width,e.context.drawingBufferHeight,t.height}static getDrawParams(e,t){return void 0===this._progParams&&(this._progParams=new h.ShaderProgramParams,this._drawParams=new h.DrawParams),this._progParams.init(e),this._drawParams.init(this._progParams,t),this._drawParams}_endPaint(){const e=this._canvas.getContext("2d");if(this._blitGeom,void 0===this._blitGeom||null===e)return;const t=a.System.instance;t.frameBufferStack.pop(),t.applyRenderState(f.RenderState.defaults);const r=OnScreenTarget.getDrawParams(this,this._blitGeom);t.techniques.draw(r),e.clearRect(0,0,this._canvas.clientWidth,this._canvas.clientHeight),e.drawImage(t.canvas,0,0)}drawOverlayDecorations(){if(void 0!==this._decorations&&void 0!==this._decorations.canvasDecorations){const e=this._canvas.getContext("2d");for(const t of this._decorations.canvasDecorations)e.save(),t.position&&e.translate(t.position.x,t.position.y),t.drawDecoration(e),e.restore()}}pickOverlayDecoration(e){let t;if(void 0!==this._decorations&&void 0!==(t=this._decorations.canvasDecorations))for(let r=t.length-1;r>=0;--r){const n=t[r];if(void 0!==n.pick&&n.pick(e))return n}}onResized(){this._dcAssigned=!1,i.dispose(this._fbo),this._fbo=void 0}}t.OnScreenTarget=OnScreenTarget;function C(e,t,r){const i=void 0!==r?r:new n.Vector3d;return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i.normalizeInPlace(),i}function T(e,t,r,i){const o=void 0!==i?i:new n.Point3d;return o.x=e.x+t.x*r,o.y=e.y+t.y*r,o.z=e.z+t.z*r,o}function M(e,t,r){return(e.x-t.x)*r.x+(e.y-t.y)*r.y+(e.z-t.z)*r.z}function E(e,t,r,n,i){const o=i.matrix.coffs;o[0]=t.x,o[1]=t.y,o[2]=t.z,o[3]=r.x,o[4]=r.y,o[5]=r.z,o[6]=n.x,o[7]=n.y,o[8]=n.z,i.origin.x=-t.dotProduct(e),i.origin.y=-r.dotProduct(e),i.origin.z=-n.dotProduct(e)}function I(e,t,r,i,o,s,a){n.Matrix4d.createRowValues(2/(t-e),0,0,-(t+e)/(t-e),0,2/(i-r),0,-(i+r)/(i-r),0,0,-2/(s-o),-(s+o)/(s-o),0,0,0,1,a)}function A(e,t,r,i,o){!function(e,t,r,i){let o,s,a;if(t<=.5)o=e.x+t*(r.x-e.x),s=e.y+t*(r.y-e.y),a=e.z+t*(r.z-e.z);else{const n=t-1;o=r.x+n*(r.x-e.x),s=r.y+n*(r.y-e.y),a=r.z+n*(r.z-e.z)}n.Point3d.create(o,s,a,i)}(t.getCorner(r),i,t.getCorner(o),e.points[r])}t.OffScreenTarget=class OffScreenTarget extends Target{constructor(e){super(e),this._animationFraction=0}get animationFraction(){return this._animationFraction}set animationFraction(e){this._animationFraction=e}get viewRect(){return this.renderRect}onResized(){}updateViewRect(){return!1}setViewRect(e,t){this.renderRect.equals(e)||(this.renderRect.setFrom(e),t||(this._dcAssigned=!1,this._fbo=i.dispose(this._fbo),i.dispose(this.compositor)))}_assignDC(){if(!this.updateViewRect()&&void 0!==this._fbo)return!0;const e=this.viewRect,t=v.TextureHandle.createForAttachment(e.width,e.height,g.GL.Texture.Format.Rgba,g.GL.Texture.DataType.UnsignedByte);return void 0!==t&&(this._fbo=y.FrameBuffer.create([t]),this._fbo,void 0!==this._fbo)}_beginPaint(){this._fbo,a.System.instance.frameBufferStack.push(this._fbo,!0)}_endPaint(){a.System.instance.frameBufferStack.pop()}},t.fromSumOf=T},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugPrint=function(e){console.log(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(7);!function(e){e[e.Uniform=0]="Uniform",e[e.NonUniform=1]="NonUniform"}(t.LUTDimension||(t.LUTDimension={}));t.LUTParams=class LUTParams{constructor(e,t){this.width=e,this.height=t}};class LUTDimensions{constructor(e,t,r=0,n=1){const i=LUTDimensions.computeWidthAndHeight(e,t,r,n);this.width=i.width,this.height=i.height}static computeWidthAndHeight(e,t,r=0,i=1){const o=n.System.instance.capabilities.maxTextureSize,s=e*t*i+r;if(s<o)return{width:s,height:1};let a=Math.ceil(Math.sqrt(s));const c=a%t;0!==c&&(a+=t-c);const l=Math.ceil(s/a);return Math.floor(l),Math.floor(a),{width:a,height:l}}}t.LUTDimensions=LUTDimensions,function(e){e[e.Empty=0]="Empty",e[e.SingleUniform=1]="SingleUniform",e[e.SingleNonUniform=2]="SingleNonUniform",e[e.Multiple=3]="Multiple",e[e.COUNT=4]="COUNT"}(t.FeatureDimension||(t.FeatureDimension={})),t.getFeatureName=function(e){switch(e){case 0:return"Empty";case 1:return"Single/Uniform";case 2:return"Single/Non-uniform";case 3:return"Multiple";default:return"Invalid"}},t.computeFeatureDimension=function(e,t){switch(t){case 0:return 0;case 2:return 3;default:return 0===e?1:2}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(11),i=r(7);class RenderBuffer{getHandle(){return this._glBuffer}static create(e,t,r=n.GL.RenderBuffer.Format.DepthComponent16){const o=i.System.instance.context,s=o.createRenderbuffer();if(null!==s)return RenderBuffer.bindBuffer(s),o.renderbufferStorage(n.GL.RenderBuffer.TARGET,r,e,t),RenderBuffer.unbind(),new RenderBuffer(s)}get isDisposed(){return void 0===this._glBuffer||null===this._glBuffer}dispose(){this.isDisposed||(i.System.instance.context.deleteRenderbuffer(this._glBuffer),this._glBuffer=void 0)}bind(){this._glBuffer,void 0!==this._glBuffer&&RenderBuffer.bindBuffer(this._glBuffer)}constructor(e){this._glBuffer=e}static bindBuffer(e){i.System.instance.context.bindRenderbuffer(n.GL.RenderBuffer.TARGET,e)}static unbind(){this.bindBuffer(null)}}t.RenderBuffer=RenderBuffer},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(4),o=r(300),s=r(87),a=r(26),c=r(77),l=r(301);function u(e,t){const r=[];for(const i of e)r.push(n.Point3d.create(i.x,i.y,t));return r}class GeometryListBuilder extends o.GraphicBuilder{constructor(e,t,r,o=n.Transform.identity,s,a=n.Transform.identity){super(o,t,r,s),this.graphicParams=new i.GraphicParams,this.accum=new l.GeometryAccumulator(this.iModel,e,void 0,a)}finish(){const e=this.finishGraphic(this.accum);return this.accum.clear(),e}activateGraphicParams(e){this.graphicParams=e}addArc2d(e,t,r,n){if(0===n)this.addArc(e,t,r);else{const i=e;i.center.z=n,this.addArc(i,t,r)}}addArc(e,t,r){let i,o=!1;if(t||r?(i=n.Loop.create(e),o=!0):i=n.Path.create(e),r&&!t&&!e.sweep.isFullCircle){const t=n.LineSegment3d.create(e.startPoint(),e.endPoint());t.markerBits=65536,i.children.push(t)}const s=i.isAnyRegionType?this.getMeshDisplayParams():this.getLinearDisplayParams();o?this.accum.addLoop(i,s,this.placement,!1):this.accum.addPath(i,s,this.placement,!1)}addLineString(e){2===e.length&&e[0].isAlmostEqual(e[1])?this.accum.addPointString(e,this.getLinearDisplayParams(),this.placement):this.accum.addLineString(e,this.getLinearDisplayParams(),this.placement)}addLineString2d(e,t){const r=u(e,t);this.addLineString(r)}addPointString(e){this.accum.addPointString(e,this.getLinearDisplayParams(),this.placement)}addPointString2d(e,t){const r=u(e,t);this.addPointString(r)}addShape(e){const t=n.Loop.create(n.LineString3d.create(e));this.accum.addLoop(t,this.getMeshDisplayParams(),this.placement,!1)}addShape2d(e,t){const r=u(e,t);this.addShape(r)}addPath(e){this.accum.addPath(e,this.getLinearDisplayParams(),this.placement,!1)}addLoop(e){this.accum.addLoop(e,this.getMeshDisplayParams(),this.placement,!1)}addPolyface(e){this.accum.addPolyface(e,this.getMeshDisplayParams(),this.placement)}getGraphicParams(){return this.graphicParams}getDisplayParams(e){return c.DisplayParams.createForType(e,this.graphicParams)}getMeshDisplayParams(){return c.DisplayParams.createForMesh(this.graphicParams,e=>this.resolveGradient(e))}getLinearDisplayParams(){return c.DisplayParams.createForLinear(this.graphicParams)}get textDisplayParams(){return c.DisplayParams.createForText(this.graphicParams)}get system(){return this.accum.system}add(e){this.accum.addGeometry(e)}reInitialize(e,t=n.Transform.createIdentity()){this.accum.reset(t),this.activateGraphicParams(this.graphicParams),this.placement=e,this.reset()}resolveGradient(e){return this.system.getGradientTexture(e,this.iModel)}}t.GeometryListBuilder=GeometryListBuilder;t.PrimitiveBuilder=class PrimitiveBuilder extends GeometryListBuilder{constructor(){super(...arguments),this.primitives=[]}finishGraphic(e){let t;if(!e.isEmpty){const r=s.GeometryOptions.createForGraphicBuilder(this),n=this.computeTolerance(e);t=e.saveToGraphicList(this.primitives,r,n,this.pickId)}let r=1!==this.primitives.length?this.accum.system.createGraphicList(this.primitives):this.primitives.pop();if(void 0!==t){const e=new i.ElementAlignedBox3d;r=this.accum.system.createBatch(r,a.PackedFeatureTable.pack(t),e)}return r}computeTolerance(e){if(this.isViewCoordinates)return.25;if(!this.viewport)return 20;const t=e.geometries.computeRange(),r=t.low.interpolate(.5,t.high);return.25*this.viewport.getPixelSizeAtPoint(r)}reset(){this.primitives=[]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(4);!function(e){e[e.ViewBackground=0]="ViewBackground",e[e.Scene=1]="Scene",e[e.WorldDecoration=2]="WorldDecoration",e[e.WorldOverlay=3]="WorldOverlay",e[e.ViewOverlay=4]="ViewOverlay"}(t.GraphicType||(t.GraphicType={}));t.GraphicBuilder=class GraphicBuilder{get placement(){return this._placement}set placement(e){this._placement.setFrom(e)}get isViewCoordinates(){return 0===this.type||4===this.type}get isWorldCoordinates(){return!this.isViewCoordinates}get isSceneGraphic(){return 1===this.type}get isViewBackground(){return 0===this.type}get isOverlay(){return 4===this.type||3===this.type}get iModel(){return this.viewport.iModel}constructor(e=n.Transform.identity,t,r,i){this._placement=e,this.type=t,this.viewport=r,void 0!==i&&(this.pickId=i.toString())}addLineStrings(...e){this.convertToLineStringParams(...e).forEach(e=>this.addLineString(e.points))}convertToLineStringParams(...e){return e.map(e=>({numPoints:e[0],points:e[1]}))}addRangeBox(e){const t=[];for(let i=0;i<8;++i)t[i]=new n.Point3d;t[0].x=t[3].x=t[4].x=t[5].x=e.low.x,t[1].x=t[2].x=t[6].x=t[7].x=e.high.x,t[0].y=t[1].y=t[4].y=t[7].y=e.low.y,t[2].y=t[3].y=t[5].y=t[6].y=e.high.y,t[0].z=t[1].z=t[2].z=t[3].z=e.low.z,t[4].z=t[5].z=t[6].z=t[7].z=e.high.z;const r=[];r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[5],r[5]=t[6],r[6]=t[7],r[7]=t[4],r[8]=t[0],this.addLineStrings([9,r],[2,[t[0],t[3]]],[2,[t[4],t[5]]],[2,[t[1],t[7]]],[2,[t[2],t[6]]])}setSymbology(e,t,r,n=0){this.activateGraphicParams(i.GraphicParams.fromSymbology(e,t,r,n))}setBlankingFill(e){this.activateGraphicParams(i.GraphicParams.fromBlankingFill(e))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(26),o=r(53),s=r(302),a=r(305),c=r(308);r(0);t.GeometryAccumulator=class GeometryAccumulator{constructor(e,t,r=!1,i=n.Transform.createIdentity(),o=n.Range3d.createNull()){this.geometries=new c.GeometryList,this.checkGlyphBoxes=!1,this._surfacesOnly=r,this._transform=i,this.iModel=e,this.system=t,this.tileRange=o}get surfacesOnly(){return this._surfacesOnly}get transform(){return this._transform}get isEmpty(){return this.geometries.isEmpty}get haveTransform(){return!this._transform.isIdentity}getPrimitiveRange(e){const t=new n.Range3d;if(e.range(void 0,t),!t.isNull)return t}calculateTransform(e,t){this.haveTransform&&this._transform.multiplyTransformTransform(e,e),e.multiplyRange(t,t)}addLoop(e,t,r,n){const i=this.getPrimitiveRange(e);return!!i&&(this.calculateTransform(r,i),this.addGeometry(a.Geometry.createFromLoop(e,r,i,t,n)))}addLineString(e,t,r){const i=n.Range3d.createNull();return i.extendArray(e,void 0),!i.isNull&&(this.calculateTransform(r,i),this.addGeometry(a.Geometry.createFromLineString(e,r,i,t)))}addPointString(e,t,r){const i=n.Range3d.createNull();return i.extendArray(e,void 0),!i.isNull&&(this.calculateTransform(r,i),this.addGeometry(a.Geometry.createFromPointString(e,r,i,t)))}addPath(e,t,r,n){const i=this.getPrimitiveRange(e);return!!i&&(this.calculateTransform(r,i),this.addGeometry(a.Geometry.createFromPath(e,r,i,t,n)))}addPolyface(e,t,r){const n=this.getPrimitiveRange(e);return void 0!==n&&(this.calculateTransform(r,n),this.addGeometry(a.Geometry.createFromPolyface(e,r,n,t)))}addGeometry(e){return this.geometries.push(e),!0}clear(){this.geometries.clear()}reset(e=n.Transform.createIdentity(),t=!1){this.clear(),this._transform=e,this._surfacesOnly=t}toMeshBuilderMap(e,t,r){const{geometries:n}=this,{wantSurfacesOnly:i,wantPreserveOrder:o}=e,a=n.computeRange(),c=!a.isNull&&a.isAlmostZeroZ;return s.MeshBuilderMap.createFromGeometries(n,t,a,c,i,o,r)}toMeshes(e,t,r){return this.geometries.isEmpty?new o.MeshList:this.toMeshBuilderMap(e,t,r).toMeshes()}saveToGraphicList(e,t,r,s){const a=this.toMeshes(t,r,s);if(0===a.length)return;const c=new o.MeshGraphicArgs,l=new i.GraphicBranch(!0),u=new n.Point3d;for(const n of a){const e=n.points;l.isEmpty?u.setFrom(e.params.origin):e.params.origin.isAlmostEqual(u),e.params.origin.setZero();const t=n.getGraphics(c,this.system);void 0!==t&&l.add(t)}if(!l.isEmpty){const t=n.Transform.createTranslationXYZ(u.x,u.y,u.z);e.push(this.system.createBranch(l,t))}return a.features}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(87),o=r(303),s=r(53),a=r(4);class MeshBuilderMap extends n.Dictionary{constructor(e,t,r,n=!1,o){if(super((e,t)=>e.compare(t)),this._keyOrder=0,this.tolerance=e,this.vertexTolerance=e*i.ToleranceRatio.vertex,this.facetAreaTolerance=e*i.ToleranceRatio.facetArea,this.range=t,this.is2d=r,this._preserveKeyOrder=n,void 0!==o){const e=new a.FeatureTable(1);this.features=new s.Mesh.Features(e),this.features.add(new a.Feature(o),0)}}static createFromGeometries(e,t,r,n,i,o,s){const a=new MeshBuilderMap(t,r,n,o,s);for(const c of e)a.loadGeometry(c,i);return a}toMeshes(){const e=new s.MeshList(void 0!==this.features?this.features.table:void 0);for(const t of this._values)e.push(t.mesh);return e}loadGeometry(e,t){this.loadPolyfacePrimitiveList(e),t||this.loadStrokePrimitiveList(e)}loadPolyfacePrimitiveList(e){const t=e.getPolyfaces(this.tolerance);if(void 0!==t)for(const r of t)this.loadIndexedPolyface(r)}loadIndexedPolyface(e){const{indexedPolyface:t,displayParams:r,isPlanar:n}=e,{pointCount:i,normalCount:o}=t,{fillColor:s,isTextured:a}=r,c=r.textureMapping;0!==i&&this.getBuilder(r,0,o>0,n).addFromPolyface(t,{includeParams:a,fillColor:s.tbgr,mappedTexture:c})}loadStrokePrimitiveList(e){const t=e.getStrokes(this.tolerance);if(void 0!==t)for(const r of t)this.loadStrokesPrimitive(r)}loadStrokesPrimitive(e){const{displayParams:t,isDisjoint:r,isPlanar:n,strokes:i}=e,o=r?2:1;this.getBuilder(t,o,!1,n).addStrokePointLists(i,r,t.fillColor.tbgr)}getBuilder(e,t,r,n){const{facetAreaTolerance:i,tolerance:o,is2d:s,range:a}=this,c=this.getKey(e,t,r,n);return this.getBuilderFromKey(c,{displayParams:e,type:t,range:a,is2d:s,isPlanar:n,tolerance:o,areaTolerance:i,features:this.features})}getKey(e,t,r,n){const i=new MeshBuilderMap.Key(e,t,r,n);return this._preserveKeyOrder&&(i.order=++this._keyOrder),i}getBuilderFromKey(e,t){let r=this.get(e);return void 0===r&&(r=o.MeshBuilder.create(t),this.set(e,r)),r}}t.MeshBuilderMap=MeshBuilderMap,function(e){class Key{constructor(e,t,r,n){this.order=0,this.params=e,this.type=t,this.hasNormals=r,this.isPlanar=n}static createFromMesh(e){return new Key(e.displayParams,e.type,0!==e.normals.length,e.isPlanar)}compare(e){let t=n.compareNumbers(this.order,e.order);return 0===t&&0===(t=n.compareNumbers(this.type,e.type))&&0===(t=n.compareBooleans(this.isPlanar,e.isPlanar))&&0===(t=n.compareBooleans(this.hasNormals,e.hasNormals))&&(t=this.params.compareForMerge(e.params)),t}equals(e){return 0===this.compare(e)}}e.Key=Key}(MeshBuilderMap=t.MeshBuilderMap||(t.MeshBuilderMap={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(3),i=r(304),o=r(4),s=r(87),a=r(53);class MeshBuilder{get currentPolyface(){return this._currentPolyface}set displayParams(e){this.mesh.displayParams=e}get vertexMap(){return void 0===this._vertexMap&&(this._vertexMap=new i.VertexMap),this._vertexMap}get triangleSet(){return void 0===this._triangleSet&&(this._triangleSet=new s.TriangleSet),this._triangleSet}constructor(e,t,r,n){this.mesh=e,this.tolerance=t,this.areaTolerance=r,this.tileRange=n}static create(e){const t=a.Mesh.create(e),{tolerance:r,areaTolerance:n,range:i}=e;return new MeshBuilder(t,r,n,i)}addStrokePointLists(e,t,r){for(const n of e){const{startDistance:e,points:i}=n;t?this.addPointString(i,r,e):this.addPolyline(i,r,e)}}addFromPolyface(e,t){const r=e.createVisitor();for(;r.moveToNextFacet();)this.addFromPolyfaceVisitor(r,t);this.endPolyface()}addFromPolyfaceVisitor(e,t){const{pointCount:r,normalCount:n,paramCount:i,requireNormals:o}=e,{includeParams:s,mappedTexture:a}=t;if(r<3||o&&n<r)return;const c=s&&i>0,l=r-2,u=Object.assign({},t,{triangleCount:l,haveParam:c});for(let d=0;d<l;d++){const t=this.createTriangle(d,e,u);void 0!==t&&this.addTriangle(t)}}createTriangleVertices(e,t,r){const{point:n,requireNormals:i}=t,{fillColor:s,haveParam:a}=r,c=this.mesh.points.params;let l;if(a&&r.mappedTexture){0===this.mesh.points.length||this.mesh.uvParams.length;const e=r.mappedTexture,n=e.params.textureMatrix.transform;n&&(l=e.computeUVParams(t,n))}const u=[];for(let d=0;d<3;++d){const r=0===d?0:e+d,a=o.QPoint3d.create(n.getPoint3dAt(r),c),h=i?o.OctEncodedNormal.fromVector(t.getNormal(r)):void 0,p=l?l[r]:void 0;u[d]={position:a,fillColor:s,normal:h,uvParam:p}}if(!(u[0].position.equals(u[1].position)||u[0].position.equals(u[2].position)||u[1].position.equals(u[2].position)))return u}createTriangle(e,t,r){const n=this.createTriangleVertices(e,t,r);if(void 0===n)return;const{edgeVisible:i}=t,o=new s.Triangle;return o.setEdgeVisibility(0===e&&i[0],i[e+1],e===r.triangleCount-1&&i[e+2]),n.forEach((e,r)=>{const n=this.addVertex(e);o.indices[r]=n,void 0!==this.currentPolyface&&this.currentPolyface.vertexIndexMap.set(n,t.clientPointIndex(r))}),o}addPolyline(e,t,r){const{mesh:n}=this,i=new o.MeshPolyline(r),s=e instanceof o.QPoint3dList?e:o.QPoint3dList.createFrom(e,n.points.params);for(const o of s)i.addIndex(this.addVertex({position:o,fillColor:t}));n.addPolyline(i)}addPointString(e,t,r){const{mesh:n}=this,i=new o.MeshPolyline(r),s=o.QPoint3dList.createFrom(e,n.points.params);for(const o of s)n.addVertex({position:o,fillColor:t}),i.addIndex(this.addVertex({position:o,fillColor:t},!1));n.addPolyline(i)}beginPolyface(e,t){const r=this.mesh.triangles;this._currentPolyface=new MeshBuilderPolyface(e,t,void 0===r?0:r.length)}endPolyface(){const{currentPolyface:e,mesh:t}=this;void 0!==e&&void 0===t.edges&&(t.edges=new o.MeshEdges)}addVertex(e,t=!0){return this.vertexMap.insertKey(e,t?e=>this.mesh.addVertex(e):void 0)}addTriangle(e){e.isDegenerate;this.triangleSet.insertKey(e,t=>this.mesh.addTriangle(e))}}t.MeshBuilder=MeshBuilder;class MeshEdgeCreationOptions{constructor(e=0){this.minCreaseAngle=20*n.Angle.radiansPerDegree,this.type=e}get generateAllEdges(){return 7===this.type}get generateNoEdges(){return 0===this.type}get generateSheetEdges(){return 0!==(1&this.type)}get generateCreaseEdges(){return 0!==(2&this.type)}get createEdgeChains(){return 0!==(8&this.type)}}t.MeshEdgeCreationOptions=MeshEdgeCreationOptions,function(e){let t;!function(e){e[e.NoEdges=0]="NoEdges",e[e.SheetEdges=1]="SheetEdges",e[e.CreaseEdges=2]="CreaseEdges",e[e.SmoothEdges=4]="SmoothEdges",e[e.CreateChains=8]="CreateChains",e[e.DefaultEdges=3]="DefaultEdges",e[e.AllEdges=7]="AllEdges"}(t=e.Type||(e.Type={}))}(MeshEdgeCreationOptions=t.MeshEdgeCreationOptions||(t.MeshEdgeCreationOptions={}));class MeshBuilderPolyface{constructor(e,t,r){this.vertexIndexMap=new Map,this.polyface=e,this.edgeOptions=t,this.baseTriangleIndex=r}}t.MeshBuilderPolyface=MeshBuilderPolyface},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);class VertexKey{constructor(e,t,r,n){this.octEncodedNormal=0,this.normalValid=!1,this.position=e.clone(),this.fillColor=t,void 0!==r&&(this.normalValid=!0,this.octEncodedNormal=r.value),void 0!==n&&(this.uvParam=n.clone())}static create(e){return new VertexKey(e.position,e.fillColor,e.normal,e.uvParam)}equals(e){return this.normalValid,e.normalValid,!(!this.position.equals(e.position)||this.octEncodedNormal!==e.octEncodedNormal||this.fillColor!==e.fillColor)&&(void 0===this.uvParam?(e.uvParam,!0):(e.uvParam,this.uvParam.isAlmostEqual(e.uvParam,.1)))}compare(e){if(this===e)return 0;let t=this.position.compare(e.position);return 0===t&&0===(t=this.octEncodedNormal-e.octEncodedNormal)&&0===(t=this.fillColor-e.fillColor)&&void 0!==this.uvParam&&(e.uvParam,0===(t=n.compareWithTolerance(this.uvParam.x,e.uvParam.x))&&(t=n.compareWithTolerance(this.uvParam.x,e.uvParam.y))),t}}t.VertexKey=VertexKey;t.VertexMap=class VertexMap extends n.IndexMap{constructor(){super(n.compare)}insertKey(e,t){return this.insert(VertexKey.create(e),t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(3),i=r(77),o=r(306),s=r(307);class Geometry{constructor(e,t,r){this.transform=e,this.tileRange=t,this.displayParams=r}static createFromPointString(e,t,r,n){return new PrimitivePointStringGeometry(e,t,r,n)}static createFromLineString(e,t,r,n){return new PrimitiveLineStringGeometry(e,t,r,n)}static createFromLoop(e,t,r,n,i){return new PrimitiveLoopGeometry(e,t,r,n,i)}static createFromPath(e,t,r,n,i){return new PrimitivePathGeometry(e,t,r,n,i)}static createFromPolyface(e,t,r,n){return new PrimitivePolyfaceGeometry(e,t,r,n)}getPolyfaces(e){const t=n.StrokeOptions.createForFacets();return t.chordTol=e,this.displayParams.isTextured&&(t.needParams=!0),this._getPolyfaces(t)}getStrokes(e){const t=n.StrokeOptions.createForCurves();return t.chordTol=e,this._getStrokes(t)}get hasTexture(){return this.displayParams.isTextured}doDecimate(){return!1}doVertexCluster(){return!0}part(){}}t.Geometry=Geometry;class PrimitivePathGeometry extends Geometry{constructor(e,t,r,n,i){super(t,r,n),this.path=e,this.isDisjoint=i}_getPolyfaces(e){}_getStrokes(e){return PrimitivePathGeometry.getStrokesForLoopOrPath(this.path,e,this.displayParams,this.isDisjoint,this.transform)}static getStrokesForLoopOrPath(e,t,r,n,i){const s=new o.StrokesPrimitiveList;if(!e.isAnyRegionType||r.wantRegionOutline){const a=new o.StrokesPrimitivePointLists;if(PrimitivePathGeometry.collectCurveStrokes(a,e,t,i),a.length>0){const t=e.isAnyRegionType;r.wantRegionOutline;const i=o.StrokesPrimitive.create(r,n,t);i.strokes=a,s.push(i)}}return s}static collectCurveStrokes(e,t,r,n){const i=t.getPackedStrokes(r);if(void 0!==i){const t=i.getPoint3dArray();n.multiplyPoint3dArrayInPlace(t),e.push(new o.StrokesPrimitivePointList(0,t))}}}t.PrimitivePathGeometry=PrimitivePathGeometry;class PrimitivePointStringGeometry extends Geometry{constructor(e,t,r,n){super(t,r,n),this.pts=e}_getPolyfaces(e){}_getStrokes(e){const t=new o.StrokesPrimitiveList,r=new o.StrokesPrimitivePointLists(new o.StrokesPrimitivePointList(0,this.pts)),n=o.StrokesPrimitive.create(this.displayParams,!0,!1);return n.strokes=r,n.transform(this.transform),t.push(n),t}}t.PrimitivePointStringGeometry=PrimitivePointStringGeometry;class PrimitiveLineStringGeometry extends Geometry{constructor(e,t,r,n){super(t,r,n),this.pts=e}_getPolyfaces(e){}_getStrokes(e){const t=new o.StrokesPrimitiveList,r=new o.StrokesPrimitivePointLists(new o.StrokesPrimitivePointList(0,this.pts)),n=o.StrokesPrimitive.create(this.displayParams,!1,!1);return n.strokes=r,n.transform(this.transform),t.push(n),t}}t.PrimitiveLineStringGeometry=PrimitiveLineStringGeometry;class PrimitiveLoopGeometry extends Geometry{constructor(e,t,r,n,i){super(t,r,n),this.loop=e,this.isDisjoint=i}_getPolyfaces(e){if(!this.loop.isAnyRegionType)return;const t=n.SweepContour.createForLinearSweep(this.loop);if(void 0!==t){const r=n.PolyfaceBuilder.create(e);t.emitFacets(r,!1,this.transform);const o=r.claimPolyface(),a=i.DisplayParams.RegionEdgeType.Default===this.displayParams.regionEdgeType,c=!0;return new s.PolyfacePrimitiveList(s.PolyfacePrimitive.create(this.displayParams,o,a,c))}}_getStrokes(e){return PrimitivePathGeometry.getStrokesForLoopOrPath(this.loop,e,this.displayParams,this.isDisjoint,this.transform)}}t.PrimitiveLoopGeometry=PrimitiveLoopGeometry;class PrimitivePolyfaceGeometry extends Geometry{constructor(e,t,r,n){super(t,r,n),this.polyface=e}_getPolyfaces(e){return this.hasTexture||(this.polyface.data.param&&(this.polyface.data.param=[]),this.polyface.data.paramIndex&&(this.polyface.data.paramIndex=[])),this.transform.isIdentity,new s.PolyfacePrimitiveList(s.PolyfacePrimitive.create(this.displayParams,this.polyface))}_getStrokes(e){}}t.PrimitivePolyfaceGeometry=PrimitivePolyfaceGeometry},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StrokesPrimitivePointList=class StrokesPrimitivePointList{constructor(e,t=[]){this.startDistance=e,this.points=[...t]}};class StrokesPrimitivePointLists extends Array{constructor(...e){super(...e)}}t.StrokesPrimitivePointLists=StrokesPrimitivePointLists;class StrokesPrimitive{static create(e,t,r){return new StrokesPrimitive(e,t,r)}constructor(e,t,r){this.displayParams=e,this.strokes=new StrokesPrimitivePointLists,this.isDisjoint=t,this.isPlanar=r}transform(e){for(const t of this.strokes)e.multiplyPoint3dArrayInPlace(t.points)}}t.StrokesPrimitive=StrokesPrimitive;t.StrokesPrimitiveList=class StrokesPrimitiveList extends Array{constructor(...e){super(...e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class PolyfacePrimitive{get indexedPolyface(){return this._polyface}static create(e,t,r=!0,n=!1){return new PolyfacePrimitive(e,t,r,n)}constructor(e,t,r,n){this.displayParams=e,this._polyface=t,this.displayEdges=r,this.isPlanar=n}clone(){return new PolyfacePrimitive(this.displayParams,this._polyface.clone(),this.displayEdges,this.isPlanar)}transform(e){return this._polyface.tryTransformInPlace(e)}}t.PolyfacePrimitive=PolyfacePrimitive;t.PolyfacePrimitiveList=class PolyfacePrimitiveList extends Array{constructor(...e){super(...e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(3);t.GeometryList=class GeometryList{constructor(){this._list=[]}get first(){return this._list[0]}get isEmpty(){return 0===this._list.length}get length(){return this._list.length}push(e){return this._list.push(e)}append(e){return this._list.push(...e._list),this}clear(){this._list.length=0}computeRange(){const e=i.Range3d.createNull();return this._list.forEach(t=>e.extendRange(t.tileRange)),e}computeQuantizationParams(){return n.QParams3d.fromRange(this.computeRange())}[Symbol.iterator](){let e=0;return{next:()=>{const t=e<this._list.length?{value:this._list[e],done:!1}:{value:this._list[e-1],done:!0};return e++,t}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(0),o=r(8);!function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.Replace=2]="Replace",e[e.Clear=3]="Clear"}(t.SelectEventType||(t.SelectEventType={}));t.HilitedSet=class HilitedSet{constructor(e){this.iModel=e,this.elements=new Set}setHilite(e,t){n.Id64.toIdSet(e).forEach(e=>t?this.elements.add(e):this.elements.delete(e)),o.IModelApp.viewManager.onSelectionSetChanged(this.iModel)}clearAll(){this.elements.clear(),o.IModelApp.viewManager.onSelectionSetChanged(this.iModel)}has(e){return this.elements.has(e)}isHilited(e){return this.elements.has(e)}get size(){return this.elements.size}};class SelectionSet{constructor(e){this.iModel=e,this.elements=new Set,this.onChanged=new i.BeEvent}sendChangedEvent(e,t){o.IModelApp.viewManager.onSelectionSetChanged(this.iModel),this.onChanged.raiseEvent(this.iModel,e,t)}get size(){return this.elements.size}get isActive(){return 0!==this.size}has(e){return!!e&&this.elements.has(e)}isSelected(e){return!!e&&this.elements.has(e)}emptyAll(){this.isActive&&(this.elements.clear(),this.sendChangedEvent(3))}add(e,t=!0){const r=this.elements.size;(e=n.Id64.toIdSet(e)).forEach(e=>this.elements.add(e));const i=r!==this.elements.size;return t&&i&&this.sendChangedEvent(0,e),i}remove(e,t=!0){const r=this.elements.size;(e=n.Id64.toIdSet(e)).forEach(e=>this.elements.delete(e));const i=r!==this.elements.size;return t&&i&&this.sendChangedEvent(1,e),i}addAndRemove(e,t){const r=this.add(e,!1),i=this.remove(t,!1);return!(!r&&!i)&&(this.sendChangedEvent(2,n.Id64.toIdSet(e)),!0)}invert(e){const t=new Set,r=new Set;return n.Id64.toIdSet(e).forEach(e=>{this.elements.has(e)?r.add(e):t.add(e)}),this.addAndRemove(t,r)}static areEqual(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}replace(e){e=n.Id64.toIdSet(e),SelectionSet.areEqual(e,this.elements)||(this.elements.clear(),this.add(e,!1),this.sendChangedEvent(2,this.elements))}}t.SelectionSet=SelectionSet},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(3),o=r(0),s=r(78);var a;!function(e){e[e.None=0]="None",e[e.Rectangular=1]="Rectangular",e[e.Cylindrical=2]="Cylindrical",e[e.Spherical=3]="Spherical"}(t.ACSType||(t.ACSType={})),function(e){e[e.None=0]="None",e[e.Active=1]="Active",e[e.Deemphasized=2]="Deemphasized",e[e.Hilite=4]="Hilite",e[e.CheckVisible=8]="CheckVisible",e[e.Dynamics=16]="Dynamics"}(t.ACSDisplayOptions||(t.ACSDisplayOptions={})),function(e){e[e.TriadSizeInches=.6]="TriadSizeInches",e[e.ArrowBaseStart=.3]="ArrowBaseStart",e[e.ArrowBaseWidth=.2]="ArrowBaseWidth",e[e.ArrowTipEnd=1.25]="ArrowTipEnd",e[e.ArrowTipStart=.85]="ArrowTipStart",e[e.ArrowTipFlange=.75]="ArrowTipFlange",e[e.ArrowTipWidth=.4]="ArrowTipWidth",e[e.ZAxisLength=.65]="ZAxisLength",e[e.LabelStart=.4]="LabelStart",e[e.LabelEnd=.8]="LabelEnd",e[e.LabelWidth=.15]="LabelWidth"}(a||(a={}));class AuxCoordSystemState extends s.ElementState{static fromProps(e,t){const r=e.classFullName.toLowerCase();return r.endsWith("system2d")?new AuxCoordSystem2dState(e,t):r.endsWith("system3d")?new AuxCoordSystem3dState(e,t):new AuxCoordSystemSpatialState(e,t)}static createNew(e,t){const r=new n.Code({spec:"bis:AuxCoordSystemSpatial",scope:n.IModel.dictionaryId.toString(),value:e});return new AuxCoordSystemSpatialState({model:n.IModel.dictionaryId,code:r,classFullName:this.getClassFullName()},t)}constructor(e,t){super(e,t),this.type=o.JsonUtils.asInt(e.type,0),this.description=e.description}toJSON(){const e=super.toJSON();return e.type=this.type,e.description=this.description,e}isValidForView(e){return e.isSpatialView()?this instanceof AuxCoordSystemSpatialState:e.is3d()===this.is3d}get is3d(){return this instanceof AuxCoordSystem3dState}drawGrid(e){const t=e.viewport.view,r=i.Point2d.create();e.drawStandardGrid(this.getOrigin(),this.getRotation(),t.getGridSpacing(),t.getGridsPerRef(),!1,r)}static limitRange(e,t,r){return Math.max(e,Math.min(t,r))}static isOriginInView(e,t,r){const n=t.worldToView(e),o=t.getFrustum(0),s=i.Point3d.create();s.x=o.points[0].distance(o.points[1]),s.y=o.points[0].distance(o.points[2]),s.z=o.points[0].distance(o.points[4]);const a=!(n.x<0||n.x>s.x||n.y<0||n.y>s.y);if(!r)return a;if(!a){const e=t.pixelsFromInches(.6);n.x=AuxCoordSystemState.limitRange(e,s.x-e,n.x),n.y=AuxCoordSystemState.limitRange(e,s.y-e,n.y)}const c=t.viewToNpc(n);return c.x=AuxCoordSystemState.limitRange(0,1,c.x),c.y=AuxCoordSystemState.limitRange(0,1,c.y),c.z=AuxCoordSystemState.limitRange(0,1,c.z),t.npcToView(c,n),t.viewToWorld(n,e),a}getAdjustedColor(e,t,r,i){const o=new n.ColorDef;return 0!==(4&i)?o.setFrom(r.hilite.color):0!==(1&i)?o.setFrom(e.equals(n.ColorDef.white)?r.getContrastToBackgroundColor():e):(o.colors.r=150,o.colors.g=150,o.colors.b=150,o.colors.t=0),o.adjustForContrast(r.view.backgroundColor),t?o.setTransparency(0!==(18&i)?225:200):o.setTransparency(0!==(2&i)?150:75),o}addAxisLabel(e,t,r,o){const s=n.ColorDef.white,a=this.getAdjustedColor(s,!1,o,r);e.setSymbology(a,a,2);const c=[];0===t?(c[0]=i.Point3d.create(.4,-.15),c[1]=i.Point3d.create(.8,.15)):(c[0]=i.Point3d.create(0,.4),c[1]=i.Point3d.create(0,.5*(.4+.8))),e.addLineString(c);const l=[];0===t?(l[0]=i.Point3d.create(.4,.15),l[1]=i.Point3d.create(.8,-.15)):(l[0]=i.Point3d.create(.15,.8),l[1]=i.Point3d.create(0,.5*(.4+.8)),l[2]=i.Point3d.create(-.15,.8)),e.addLineString(l)}addAxis(e,t,r,o){const s=0===t?n.ColorDef.red:1===t?n.ColorDef.green:n.ColorDef.blue,a=this.getAdjustedColor(s,!1,o,r),c=this.getAdjustedColor(s,!0,o,r);if(2===t){e.setSymbology(a,a,6),e.addPointString([i.Point3d.create(0,0,.65)]);const t=[i.Point3d.create(),i.Point3d.create()];t[1].z=.65,e.setSymbology(a,a,1,0===(16&r)?0:4177066232),e.addLineString(t);const n=.2,s=i.Point3d.create(),l=o.rotation,u=l.getRow(0),d=l.getRow(1);e.placement.matrix.multiplyTransposeVectorInPlace(u),e.placement.matrix.multiplyTransposeVectorInPlace(d),u.normalize(u),d.normalize(d);const h=i.Arc3d.createScaledXYColumns(s,i.Matrix3d.createColumns(u,d,i.Vector3d.create()),n,n,i.AngleSweep.createStartEnd(i.Angle.createRadians(0),i.Angle.createRadians(2*Math.PI)));return e.addArc(h,!1,!1),e.setBlankingFill(c),void e.addArc(h,!0,!0)}const l=[];l[0]=i.Point3d.create(1.25,0),l[1]=i.Point3d.create(.75,.4),l[2]=i.Point3d.create(.85,.2),l[3]=i.Point3d.create(.3,.2),l[4]=i.Point3d.create(.3,-.2),l[5]=i.Point3d.create(.85,-.2),l[6]=i.Point3d.create(.75,-.4),l[7]=l[0].clone(),1===t&&l.forEach(e=>{e.set(e.y,e.x)}),e.setSymbology(a,a,1,0===(16&r)?0:4177066232),e.addLineString(l),this.addAxisLabel(e,t,r,o),e.setBlankingFill(c),e.addShape(l)}createGraphicBuilder(e,t){const r=0!==(8&t),n=this.getOrigin();r&&!AuxCoordSystemState.isOriginInView(n,e.viewport,!0)&&(t|=2);let o=e.viewport.pixelsFromInches(.6);0!==(2&t)?o*=.8:0!==(1&t)&&(o*=.9);const s=e.viewport.view.getAspectRatioSkew(),a=e.getPixelSizeAtPoint(n)*o,c=this.getRotation();c.inverse(c),c.scaleRows(a,a/s,a,c);const l=i.Transform.createOriginAndMatrix(n,c),u=e.createGraphicBuilder(3,l),d=e.viewport;return this.addAxis(u,0,t,d),this.addAxis(u,1,t,d),this.addAxis(u,2,t,d),u}display(e,t){const r=this.createGraphicBuilder(e,t);void 0!==r&&e.addDecorationFromBuilder(r)}}t.AuxCoordSystemState=AuxCoordSystemState;class AuxCoordSystem2dState extends AuxCoordSystemState{constructor(e,t){super(e,t),this.origin=i.Point2d.fromJSON(e.origin),this.angle=o.JsonUtils.asDouble(e.angle),this._rMatrix=i.Matrix3d.createRotationAroundVector(i.Vector3d.unitZ(),i.Angle.createDegrees(this.angle))}toJSON(){const e=super.toJSON();return e.origin=this.origin,e.angle=this.angle,e}getOrigin(e){return i.Point3d.createFrom(this.origin,e)}setOrigin(e){this.origin.setFrom(e)}getRotation(e){return this._rMatrix.clone(e)}setRotation(e){this._rMatrix.setFrom(e),this.angle=i.YawPitchRollAngles.createFromMatrix3d(e).yaw.degrees}}t.AuxCoordSystem2dState=AuxCoordSystem2dState;class AuxCoordSystem3dState extends AuxCoordSystemState{constructor(e,t){super(e,t),this.origin=i.Point3d.fromJSON(e.origin),this.yaw=o.JsonUtils.asDouble(e.yaw),this.pitch=o.JsonUtils.asDouble(e.pitch),this.roll=o.JsonUtils.asDouble(e.roll);const r=new i.YawPitchRollAngles(i.Angle.createRadians(this.yaw),i.Angle.createRadians(this.pitch),i.Angle.createRadians(this.roll));this._rMatrix=r.toMatrix3d()}toJSON(){const e=super.toJSON();return e.origin=this.origin,e.yaw=this.yaw,e.pitch=this.pitch,e.roll=this.roll,e}getOrigin(e){return i.Point3d.createFrom(this.origin,e)}setOrigin(e){this.origin.setFrom(e)}getRotation(e){return this._rMatrix.clone(e)}setRotation(e){this._rMatrix.setFrom(e);const t=i.YawPitchRollAngles.createFromMatrix3d(e);this.yaw=t.yaw.radians,this.pitch=t.pitch.radians,this.roll=t.roll.radians}}t.AuxCoordSystem3dState=AuxCoordSystem3dState;class AuxCoordSystemSpatialState extends AuxCoordSystem3dState{}t.AuxCoordSystemSpatialState=AuxCoordSystemSpatialState},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(78);t.ModelSelectorState=class ModelSelectorState extends i.ElementState{constructor(e,t){super(e,t),this.models=new Set,e.models&&e.models.forEach(e=>this.models.add(e))}get name(){return this.code.getValue()}toJSON(){const e=super.toJSON();return e.models=[],this.models.forEach(t=>e.models.push(t)),e}equalState(e){if(this.models.size!==e.models.size)return!1;if(this.name!==e.name)return!1;const t=e.models.keys();let r=t.next();for(let n=this.models.keys(),i=n.next();!i.done;i=n.next(),r=t.next())if(i.value!==r.value)return!1;return!0}addModels(e){n.Id64.toIdSet(e).forEach(e=>this.models.add(e))}dropModels(e){n.Id64.toIdSet(e).forEach(e=>this.models.delete(e))}has(e){return this.models.has(e)}containsModel(e){return this.has(e.toString())}load(){return this.iModel.models.load(this.models)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(78);t.CategorySelectorState=class CategorySelectorState extends i.ElementState{constructor(e,t){super(e,t),this.categories=new Set,e.categories&&e.categories.forEach(e=>this.categories.add(e))}toJSON(){const e=super.toJSON();return e.categories=[],this.categories.forEach(t=>e.categories.push(t)),e}equalState(e){if(this.categories.size!==e.categories.size)return!1;if(this.name!==e.name)return!1;const t=e.categories.keys();let r=t.next();for(let n=this.categories.keys(),i=n.next();!i.done;i=n.next(),r=t.next())if(i.value!==r.value)return!1;return!0}get name(){return this.code.getValue()}has(e){return this.categories.has(e.toString())}isCategoryViewed(e){return this.has(e)}addCategories(e){n.Id64.toIdSet(e).forEach(e=>this.categories.add(e))}dropCategories(e){n.Id64.toIdSet(e).forEach(e=>this.categories.delete(e))}changeCategoryDisplay(e,t){t?this.addCategories(e):this.dropCategories(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(65),i=r(90),o=r(11),s=r(142),a=r(7);!function(e){e[e.None=0]="None",e[e.Monochrome=1]="Monochrome",e[e.NonUniformColor=2]="NonUniformColor",e[e.OITFlatAlphaWeight=4]="OITFlatAlphaWeight",e[e.OITScaleOutput=8]="OITScaleOutput"}(t.ShaderFlags||(t.ShaderFlags={}));class Uniform{constructor(e){this._name=e}compile(e){return this.isValid,void 0!==e.glProgram&&(this._handle=n.UniformHandle.create(e.glProgram,this._name,!0)),this.isValid}get isValid(){return void 0!==this._handle}}t.Uniform=Uniform;class ProgramUniform extends Uniform{constructor(e,t){super(e),this._bind=t}bind(e){void 0!==this._handle&&this._bind(this._handle,e)}}t.ProgramUniform=ProgramUniform;class GraphicUniform extends Uniform{constructor(e,t){super(e),this._bind=t}bind(e){void 0!==this._handle&&this._bind(this._handle,e)}}t.GraphicUniform=GraphicUniform;class Attribute{constructor(e,t){this._name=e,this._bind=t}compile(e){return this.isValid,void 0!==e.glProgram&&(this._handle=n.AttributeHandle.create(e.glProgram,this._name,!0)),this.isValid}get isValid(){return void 0!==this._handle}bind(e){void 0!==this._handle&&this._bind(this._handle,e)}}t.Attribute=Attribute,function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure",e[e.Uncompiled=2]="Uncompiled"}(t.CompileStatus||(t.CompileStatus={}));t.ShaderProgram=class ShaderProgram{constructor(e,t,r,n,i){this._inUse=!1,this._status=2,this._programUniforms=new Array,this._graphicUniforms=new Array,this._attributes=new Array,this._description=n,this.vertSource=t,this.fragSource=r,this.maxClippingPlanes=i;const o=e.createProgram();this._glProgram=null===o?void 0:o,this._description}get isDisposed(){return void 0===this._glProgram}dispose(){this.isDisposed||(this._inUse,a.System.instance.context.deleteProgram(this._glProgram),this._glProgram=void 0,this._status=2)}get glProgram(){return this._glProgram}get isUncompiled(){return 2===this._status}compileShader(e){const t=a.System.instance.context,r=t.createShader(e);if(null===r)return;const n=o.GL.ShaderType.Vertex===e?this.vertSource:this.fragSource;t.shaderSource(r,n),t.compileShader(r);const i=t.getShaderParameter(r,o.GL.ShaderParameter.CompileStatus);return i||(o.GL.ShaderType.Vertex,t.getShaderInfoLog(r)),i?r:void 0}linkProgram(e,t){if(this.glProgram,void 0===this._glProgram||null===this._glProgram)return!1;const r=a.System.instance.context;r.attachShader(this._glProgram,e),r.attachShader(this._glProgram,t),r.linkProgram(this._glProgram),r.getProgramInfoLog(this._glProgram),r.validateProgram(this._glProgram),r.getProgramInfoLog(this._glProgram);const n=r.getProgramParameter(this._glProgram,o.GL.ProgramParameter.LinkStatus);return n}compile(){switch(this._status){case 1:return!1;case 0:return!0;default:if(this.isDisposed)return this._status=1,!1}const e=this.compileShader(o.GL.ShaderType.Vertex),t=this.compileShader(o.GL.ShaderType.Fragment);return void 0!==e&&void 0!==t&&this.linkProgram(e,t)&&this.compileUniforms(this._programUniforms)&&this.compileUniforms(this._graphicUniforms)&&this.compileAttributes()?(this._status=0,!0):(this._status=1,!1)}use(e){if(!this.compile())return!1;if(this._glProgram,null===this._glProgram||void 0===this._glProgram)return!1;this._inUse,this._inUse=!0,e.context.useProgram(this._glProgram);for(const t of this._programUniforms)t.bind(e);return!0}endUse(){this._inUse,this._inUse=!1,a.System.instance.context.useProgram(null)}draw(e){this._inUse;for(const t of this._graphicUniforms)t.bind(e);for(const t of this._attributes)t.bind(e);e.geometry.draw()}addProgramUniform(e,t){this.isUncompiled,this._programUniforms.push(new ProgramUniform(e,t))}addGraphicUniform(e,t){this.isUncompiled,this._graphicUniforms.push(new GraphicUniform(e,t))}addAttribute(e,t){this.isUncompiled,this._attributes.push(new Attribute(e,t))}compileUniforms(e){for(const t of e)if(!t.compile(this))return!1;return!0}compileAttributes(){for(const e of this._attributes)if(!e.compile(this))return!1;return!0}};class ShaderProgramExecutor{constructor(e,t,r){this.params.init(e,t),this.changeProgram(r)}dispose(){this.changeProgram(void 0)}setProgram(e){return this.changeProgram(e)}get isValid(){return void 0!==this._program}get target(){return this.params.target}get renderPass(){return this.params.renderPass}get params(){return void 0===ShaderProgramExecutor._params&&(ShaderProgramExecutor._params=new i.ShaderProgramParams),ShaderProgramExecutor._params}draw(e){this.isValid,void 0!==this._program&&this._program.draw(e)}drawInterrupt(e){e.target,this.params.target;const t=e.target.techniques.getTechnique(e.geometry.getTechniqueId(e.target)).getShader(s.TechniqueFlags.defaults);this.setProgram(t)&&this.draw(e)}pushBranch(e){this.target.pushBranch(this,e)}popBranch(){this.target.popBranch()}changeProgram(e){return this._program===e||(void 0!==this._program&&this._program.endUse(),this._program=e,!(void 0!==e&&!e.use(this.params))||(this._program=void 0,!1))}}t.ShaderProgramExecutor=ShaderProgramExecutor},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(45),i="\nvec2 computeLUTCoords(float index, vec2 dimensions, vec2 center, float mult) {\n  float baseIndex = index*mult;\n\n  // Fix precision issues wherein mod(x,y) => y instead of 0 when x is multiple of y...\n  float epsilon = 0.5 / dimensions.x;\n  float yId = floor(baseIndex / dimensions.x + epsilon);\n  float xId = baseIndex - dimensions.x * yId; // replaces mod()...\n\n  return center + vec2(xId/dimensions.x, yId/dimensions.y);\n}\n",o="\nvec2 compute_{LUTNAME}_coords(float index) {\n  return computeLUTCoords(index, u_{LUTNAME}Params.xy, g_{LUTNAME}_center, {MULT});\n}\n",s="\n  {LUTSTEPX} = 1.0 / {LUTPARAMS}.x;\n  {LUTSTEPY} = 1.0 / {LUTPARAMS}.y;\n  {LUTCENTER} = vec2(0.5*{LUTSTEPX}, 0.5*{LUTSTEPY});\n";t.addLookupTable=function(e,t,r="1.0"){if(e.addFunction(i),e instanceof n.VertexShaderBuilder){const n="g_"+t+"_stepX",i="g_"+t+"_stepY",a="g_"+t+"_center",c="u_"+t+"Params";e.addGlobal(n,2),e.addGlobal(i,2),e.addGlobal(a,3);let l=s;l=(l=(l=(l=l.replace(/{LUTSTEPX}/g,n)).replace(/{LUTSTEPY}/g,i)).replace(/{LUTCENTER}/g,a)).replace(/{LUTPARAMS}/g,c),e.addInitializer(l);let u=o;u=(u=u.replace(/{LUTNAME}/g,t)).replace(/{MULT}/g,r),e.addFunction(u)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(45),i=r(31),o=r(46),s=r(316),a=r(11),c=r(109),l=r(145),u=r(27),d=r(46),h=r(7),p=r(34),f=r(91),g="return discardByLineCode;",m="\n  if (v_texc.x >= 0.0) { // v_texc = (-1,-1) for solid lines - don't bother with any of this\n    vec4 texColor = TEXTURE(u_lineCodeTexture, v_texc);\n    discardByLineCode = (0.0 == texColor.r);\n  }\n\n  if (v_lnInfo.w > 0.5) { // line needs pixel trimming\n    // calculate pixel distance from pixel center to expected line center, opposite dir from major\n    vec2 dxy = gl_FragCoord.xy - v_lnInfo.xy;\n    if (v_lnInfo.w < 1.5)  // not x-major\n      dxy = dxy.yx;\n\n    float dist = v_lnInfo.z * dxy.x - dxy.y;\n    float distA = abs(dist);\n    if (distA > 0.5 || (distA == 0.5 && dist < 0.0))\n      discardByLineCode = true;  // borrow this flag to force discard\n  }\n\n  return baseColor;\n",y="\nvec2 computeLineCodeTextureCoords(vec2 windowDir, vec4 projPos, float adjust) {\n  vec2 texc;\n  float lineCode = ComputeLineCode();\n  if (0.0 == lineCode) {\n    // Solid line - tell frag shader not to bother.\n    texc = vec2(-1.0, -1.0);\n  } else {\n    const float imagesPerPixel = 1.0/32.0;\n    const float textureCoordinateBase = 8192.0; // Temp workardound for clipping problem in perspective views (negative values don't seem to interpolate correctly).\n\n    if (abs(windowDir.x) > abs(windowDir.y))\n      texc.x = textureCoordinateBase + imagesPerPixel * (projPos.x + adjust * windowDir.x);\n    else\n      texc.x = textureCoordinateBase + imagesPerPixel * (projPos.y + adjust * windowDir.y);\n\n    const float numLineCodes = 16.0; // NB: Actually only 10, but texture is 16px tall because it needs to be a power of 2.\n    const float rowsPerCode = 1.0;\n    const float numRows = numLineCodes*rowsPerCode;\n    const float centerY = 0.5/numRows;\n    const float stepY = rowsPerCode/numRows;\n    texc.y = stepY * lineCode + centerY;\n  }\n\n  return texc;\n}\n";function v(e){e.addUniform("u_lineCodeTexture",8,e=>{e.addProgramUniform("u_lineCodeTexture",e=>{const t=h.System.instance.lineCodeTexture;void 0!==t&&t.bindSampler(e,p.TextureUnit.LineCode)})})}function _(e,t){const r=e.vert,n=e.frag;r.addUniform("u_lineCode",2,e=>{e.addGraphicUniform("u_lineCode",(e,t)=>{e.setUniform1f(t.geometry.getLineCode(t.programParams))})}),r.addFunction(i.GLSLVertex.computeLineCode);const s="computeLineCodeTextureCoords("+t+")";e.addFunctionComputedVaryingWithArgs("v_texc",3,s,y),o.addFrustum(e),v(e.frag),n.set(4,m),n.set(5,g),n.addGlobal("discardByLineCode",0,"false")}function w(e){const r=e.vert;s.addModelToWindowCoordinates(r),i.addProjectionMatrix(r),i.addModelViewMatrix(r),r.addFunction(i.GLSLVertex.computeLineWeight),s.addViewport(r),r.addGlobal("g_windowPos",5),r.addGlobal("g_prevPos",5),r.addGlobal("g_nextPos",5),r.addGlobal("g_windowDir",3),r.addInitializer(S),r.addAttribute("a_prevIndex",4,e=>{e.addAttribute("a_prevIndex",(e,t)=>{const r=t.geometry.polylineBuffers;void 0!==r&&e.enableArray(r.prevIndices,3,a.GL.DataType.UnsignedByte,!1,0,0)})}),r.addAttribute("a_nextIndex",4,e=>{e.addAttribute("a_nextIndex",(e,t)=>{const r=t.geometry.polylineBuffers;void 0!==r&&e.enableArray(r.nextIndicesAndParams,3,a.GL.DataType.UnsignedByte,!1,4,0)})}),r.addFunction(c.GLSLDecode.unquantize2d),r.addAttribute("a_param",2,e=>{e.addAttribute("a_param",(e,t)=>{const r=t.geometry.polylineBuffers;void 0!==r&&e.enableArray(r.nextIndicesAndParams,1,a.GL.DataType.UnsignedByte,!1,4,3)})}),r.addUniform("u_lineWeight",2,e=>{e.addGraphicUniform("u_lineWeight",(e,t)=>{e.setUniform1f(t.geometry.getLineWeight(t.programParams))})}),r.addGlobal("miterAdjust",2,"0.0"),r.set(3,b),e.addVarying("v_lnInfo",5),r.addFunction(t.adjustWidth)}t.adjustWidth="\nvoid adjustWidth(inout float width, vec2 d2, vec2 org) {\n  // calculate slope based width adjustment for non-AA lines, widths 1 to 4\n  vec2 d2A = abs(d2);\n  const float s_myFltEpsilon = 0.0001;  // limit test resolution to 4 digits in case 24 bit (s16e7) is used in hardware\n  if (d2A.y > s_myFltEpsilon && width < 4.5) {\n    float len = length(d2A);\n    float tan = d2A.x / d2A.y;\n\n    if (width < 1.5) { // width 1\n      if (tan <= 1.0)\n        width = d2A.y / len;\n      else\n        width = d2A.x / len;\n      // width 1 requires additional adjustment plus trimming in frag shader using v_lnInfo\n      width *= 1.01;\n      v_lnInfo.xy = org;\n      v_lnInfo.w = 1.0; // set flag to do trimming\n      // set slope in v_lnInfo.z\n      if (d2A.x - d2A.y > s_myFltEpsilon) {\n        v_lnInfo.z = d2.y / d2.x;\n        v_lnInfo.w += 2.0; // add in x-major flag\n      } else\n        v_lnInfo.z = d2.x / d2.y;\n\n    } else if (width < 2.5) { // width 2\n      if (tan <= 0.5)\n        width = 2.0 * d2A.y / len;\n      else\n        width = (d2A.y + 2.0 * d2A.x) / len;\n\n    } else if (width < 3.5) { // width 3\n        if (tan <= 1.0)\n            width = (3.0 * d2A.y + d2A.x) / len;\n        else\n            width = (d2A.y + 3.0 * d2A.x) / len;\n\n    } else { // if (width < 4.5) // width 4\n      if (tan <= 0.5)\n        width = (4.0 * d2A.y + d2A.x) / len;\n      else if (tan <= 2.0)\n        width = (3.0 * d2A.y + 3.0 * d2A.x) / len;\n      else\n        width = (d2A.y + 4.0 * d2A.x) / len;\n    }\n  }\n}\n",t.addLineCodeTexture=v,t.addLineCode=_;const S="\n  float index;\n  vec2 tc;\n  vec4 e0, e1;\n  vec3 qpos;\n\n  index = decodeUInt32(a_prevIndex);\n  tc = computeLUTCoords(index, u_vertParams.xy, g_vert_center, u_vertParams.z);\n  e0 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  tc += g_vert_stepX;\n  e1 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  qpos = vec3(decodeUInt16(e0.xy), decodeUInt16(e0.zw), decodeUInt16(e1.xy));\n  g_prevPos = unquantizePosition(qpos, u_qOrigin, u_qScale);\n\n  index = decodeUInt32(a_nextIndex);\n  tc = computeLUTCoords(index, u_vertParams.xy, g_vert_center, u_vertParams.z);\n  e0 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  tc += g_vert_stepX;\n  e1 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  qpos = vec3(decodeUInt16(e0.xy), decodeUInt16(e0.zw), decodeUInt16(e1.xy));\n  g_nextPos = unquantizePosition(qpos, u_qOrigin, u_qScale);\n",b="\n  const float kNone = 0.0,\n              kSquare = 1.0*3.0,\n              kMiter = 2.0*3.0,\n              kMiterInsideOnly = 3.0*3.0,\n              kJointBase = 4.0*3.0,\n              kNegatePerp = 8.0*3.0,\n              kNegateAlong = 16.0*3.0,\n              kNoneAdjWt = 32.0*3.0;\n\n  v_lnInfo = vec4(0.0, 0.0, 0.0, 0.0);  // init and set flag to false\n\n  vec4 pos = u_mvp * rawPos;\n\n  vec4 next = g_nextPos;\n  g_windowPos = modelToWindowCoordinates(rawPos, next);\n\n  if (g_windowPos.w == 0.0)\n    return g_windowPos;\n\n  float param = a_param;\n  float weight = ComputeLineWeight();\n  float scale = 1.0, directionScale = 1.0;\n\n  if (param >= kNoneAdjWt)\n    param -= kNoneAdjWt;\n\n  if (param >= kNegateAlong) {\n    directionScale = -directionScale;\n    param -= kNegateAlong;\n  }\n\n  if (param >= kNegatePerp) {\n    scale = -1.0;\n    param -= kNegatePerp;\n  }\n\n  vec4 projNext = modelToWindowCoordinates(next, rawPos);\n  g_windowDir = projNext.xy - g_windowPos.xy;\n\n  if (param < kJointBase) {\n    vec2 dir = (directionScale > 0.0) ? g_windowDir : -g_windowDir;\n    vec2 pos = (directionScale > 0.0) ? g_windowPos.xy : projNext.xy;\n    adjustWidth(weight, dir, pos);\n  }\n\n  if (kNone != param) {\n    vec2 delta = vec2(0.0);\n    vec4 prev   = g_prevPos;\n    vec4 projPrev = modelToWindowCoordinates(prev, rawPos);\n    vec2 prevDir   = g_windowPos.xy - projPrev.xy;\n    float thisLength = sqrt(g_windowDir.x * g_windowDir.x + g_windowDir.y * g_windowDir.y);\n    const float s_minNormalizeLength = 1.0E-5;  // avoid normalizing zero length vectors.\n    float dist = weight / 2.0;\n\n    if (thisLength > s_minNormalizeLength) {\n      g_windowDir /= thisLength;\n\n      float prevLength = sqrt(prevDir.x * prevDir.x + prevDir.y * prevDir.y);\n\n      if (prevLength > s_minNormalizeLength) {\n        prevDir /= prevLength;\n        const float     s_minParallelDot= -.9999, s_maxParallelDot = .9999;\n        float           prevNextDot  = dot(prevDir, g_windowDir);\n\n        if (prevNextDot < s_minParallelDot || prevNextDot > s_maxParallelDot)    // No miter if parallel or antiparallel.\n          param = kSquare;\n      } else\n        param = kSquare;\n    } else {\n      g_windowDir = -normalize(prevDir);\n      param = kSquare;\n    }\n\n    vec2 perp = scale * vec2(-g_windowDir.y, g_windowDir.x);\n\n    if (param == kSquare) {\n      delta = perp;\n    } else {\n      vec2 bisector = normalize(prevDir - g_windowDir);\n      float dotP = dot (bisector, perp);\n\n      if (dotP != 0.0) { // Should never occur - but avoid divide by zero.\n        const float maxMiter = 3.0;\n        float miterDistance = 1.0/dotP;\n\n        if (param == kMiter) { // Straight miter.\n          delta = (abs(miterDistance) > maxMiter) ? perp : bisector * miterDistance;\n\n        } else if (param == kMiterInsideOnly) { // Miter at inside, square at outside (to make room for joint).\n          delta = (dotP  > 0.0 || abs(miterDistance) > maxMiter) ? perp : bisector * miterDistance;\n\n        } else {\n          const float jointTriangleCount = 3.0;\n          float ratio = (param - kJointBase) / jointTriangleCount; // 3 triangles per half-joint as defined in Graphics.cpp\n          delta = normalize((1.0 - ratio) * bisector + (dotP < 0.0 ? -ratio : ratio) * perp); // Miter/Straight combination.\n        }\n      }\n    }\n\n    miterAdjust = dot(g_windowDir, delta) * dist; // Not actually used for hilite shader but meh.\n    pos.x += dist * delta.x * 2.0 * pos.w / u_viewport.z;\n    pos.y += dist * delta.y * 2.0 * pos.w / u_viewport.w;\n  }\n\n  return pos;\n",x="g_windowDir, g_windowPos, miterAdjust";t.createPolylineBuilder=function(){const e=new n.ProgramBuilder(!0);var t;return d.addShaderFlags(e),w(e),_(t=e,x),i.addModelViewMatrix(t.vert),l.addColor(e),u.addWhiteOnWhiteReversal(e.frag),e},t.createPolylineHiliter=function(){const e=new n.ProgramBuilder(!0);return w(e),o.addFrustum(e),f.addHiliter(e),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(137),i=r(20),o=r(31),s=r(186);t.addViewport=function(e){e.addUniform("u_viewport",5,e=>{e.addProgramUniform("u_viewport",(e,t)=>{const r=t.target.viewRect,n=[r.left,r.bottom,r.width,r.height];e.setUniform4fv(n)})})};const a=new n.Matrix4,c=new i.ViewRect,l=0,u=1;function d(e){e.addUniform("u_viewportTransformation",7,e=>{e.addProgramUniform("u_viewportTransformation",(e,t)=>{e.setMatrix4(function(e){if(e.equals(c))return a;c.setFrom(e);const t=e.left,r=e.top,i=.5*e.width,o=.5*e.height,s=.5*(u-l),d=i,h=o,p=s,f=t+i,g=r+o,m=l+s;return n.Matrix4.fromValues(d,0,0,f,0,h,0,g,0,0,p,m,0,0,0,1,a)}(t.target.viewRect))})})}t.addViewportTransformation=d;const h="\nvec4 modelToWindowCoordinates(vec4 position, vec4 next) {\n  if (kRenderPass_ViewOverlay == u_renderPass || kRenderPass_Background == u_renderPass) {\n    vec4 q = u_mvp * position;\n    q.xyz /= q.w;\n    q.xyz = (u_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\n    return q;\n  }\n\n  // Negative values are in front of the camera (visible).\n  float s_maxZ = -u_frustum.x;            // use -near (front) plane for segment drop test since u_frustum's near & far are pos.\n  vec4  q = u_mv * position;              // eye coordinates.\n  vec4  n = u_mv * next;\n\n  if (q.z > s_maxZ) {\n    if (n.z > s_maxZ)\n      return vec4(0.0, 0.0,  1.0, 0.0);   // Entire segment behind eye.\n\n    float t = (s_maxZ - q.z) / (n.z - q.z);\n\n    q.x += t * (n.x - q.x);\n    q.y += t * (n.y - q.y);\n    q.z = s_maxZ;                       // q.z + (s_maxZ - q.z) * (s_maxZ - q.z) / n.z - q.z\n  }\n  q = u_proj * q;\n  q.xyz /= q.w;                           // normalized device coords\n  q.xyz = (u_viewportTransformation * vec4(q.xyz, 1.0)).xyz; // window coords\n  return q;\n  }\n";t.addModelToWindowCoordinates=function(e){o.addModelViewProjectionMatrix(e),d(e),s.addRenderPass(e),e.addFunction(h)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(86),o=r(8),s=r(76);class TentativePoint{constructor(){this.isActive=!1,this._point=new n.Point3d,this._rawPoint=new n.Point3d,this._viewPoint=new n.Point3d}get _hotDistanceInches(){return.21}onInitialized(){}setHitList(e){this.tpHits=e}get isSnapped(){return void 0!==this.currSnap}getCurrSnap(){return this.currSnap}getPoint(){const e=this.currSnap;return e?e.adjustedPoint:this._point}setPoint(e){this.setCurrSnap(void 0),this.tpHits=void 0,this._point.setFrom(e)}clear(e){e&&(this.removeTentative(),o.IModelApp.accuSnap.synchSnapMode()),o.IModelApp.accuSnap.destroy(),this.isActive=!1,this.setCurrSnap(void 0),this.tpHits=void 0}removeTentative(){this.isActive&&(o.IModelApp.accuSnap.erase(),this.getCurrSnap()?o.IModelApp.viewManager.invalidateDecorationsAllViews():this.viewport.invalidateDecorations(),this.isActive=!1)}setCurrSnap(e){e&&e.setSnapPoint(e.snapPoint,2),this.currSnap=e}showTentative(){this.isSnapped?(o.IModelApp.viewManager.invalidateDecorationsAllViews(),o.IModelApp.accuSnap.displayToolTip(this._viewPoint,this.viewport,void 0)):this.viewport.invalidateDecorations(),this.isActive=!0}getHitAndList(e){const t=this.currSnap;return t&&(e.setHitList(this.tpHits),this.tpHits=void 0),t}onButtonEvent(e){switch(e.button){case 0:if(!e.isDown)return;break;case 1:if(e.isDown)return;break;case 2:return}this.removeTentative(),o.IModelApp.accuSnap.synchSnapMode(),this.setCurrSnap(void 0),this.tpHits=void 0}decorate(e){const t=e.viewport;if(!this.isActive||!t)return;const r=Math.floor(.4*t.pixelsPerInch)+.5,n=r+1,i=e.viewport.worldToView(this._point);i.x=Math.floor(i.x)+.5,i.y=Math.floor(i.y)+.5;e.addCanvasDecoration({position:i,drawDecoration:e=>{e.beginPath(),e.strokeStyle="rgba(0,0,0,.5)",e.lineWidth=3,e.moveTo(-n,0),e.lineTo(n,0),e.moveTo(0,-n),e.lineTo(0,n),e.stroke(),e.beginPath(),e.strokeStyle="white",e.lineWidth=1,this.isSnapped||e.setLineDash([4,1]),e.shadowColor="black",e.shadowBlur=5,e.moveTo(-r,0),e.lineTo(r,0),e.moveTo(0,-r),e.lineTo(0,r),e.stroke()}})}async getSnap(e){let t=e||void 0===this.tpHits?void 0:this.tpHits.getNextHit();if(void 0===t&&(this.tpHits=void 0,t=o.IModelApp.accuSnap.getHitAndList(this)),void 0===t){const e=2*this.viewport.pixelsFromInches(o.IModelApp.locateManager.apertureInches)/2+1.5,r=o.IModelApp.locateManager.options.clone(),n=o.IModelApp.locateManager.picker;if(r.hitSource=4,0===n.doPick(this.viewport,this._rawPoint,e,r))return;this.tpHits=n.getHitList(!0),t=void 0!==this.tpHits?this.tpHits.getNextHit():void 0}else if(t instanceof i.SnapDetail)return t;if(void 0===t)return;const r=o.IModelApp.accuSnap.getActiveSnapModes();1===r.length&&64===r[0]&&r.push(1);const n=await s.AccuSnap.requestSnap(t,r,this._hotDistanceInches,o.IModelApp.accuSnap.keypointDivisor,this.tpHits);return void 0!==n&&o.IModelApp.accuDraw.onSnap(n),n}static arePointsCloseEnough(e,t,r){return e.distance(t)<r+1.5}async process(e){const t=this.isActive;this.removeTentative();const r=this._viewPoint.clone();this.viewport=e.viewport,this._point.setFrom(e.point),this._rawPoint.setFrom(e.rawPoint),this._viewPoint.setFrom(e.viewPoint);const n=!this.isSnapped||!TentativePoint.arePointsCloseEnough(r,this._viewPoint,this.viewport.pixelsFromInches(o.IModelApp.locateManager.apertureInches)),i=await this.getSnap(n);this.setCurrSnap(i),o.IModelApp.accuSnap.clear(),this.isSnapped?this._point.setFrom(this.currSnap.snapPoint):t&&n&&this._point.setFrom(e.rawPoint),this.showTentative()}}t.TentativePoint=TentativePoint},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(8),o=r(143),s=r(144),a=r(319),c=r(30),l=r(108),u=r(545);t.ViewManager=class ViewManager{constructor(){this.inDynamicsMode=!1,this.cursor="default",this._viewports=[],this.decorators=[],this._invalidateScenes=!1,this._skipSceneCreation=!1,this.onSelectedViewportChanged=new n.BeUiEvent,this.onViewOpen=new n.BeUiEvent,this.onViewClose=new n.BeUiEvent,this.onViewSuspend=new n.BeUiEvent,this.onViewResume=new n.BeUiEvent}onInitialized(){o.IModelConnection.registerClass(s.SpatialModelState.getClassFullName(),s.SpatialModelState),o.IModelConnection.registerClass("BisCore:PhysicalModel",s.SpatialModelState),o.IModelConnection.registerClass("BisCore:SpatialLocationModel",s.SpatialModelState),o.IModelConnection.registerClass(s.DrawingModelState.getClassFullName(),s.DrawingModelState),o.IModelConnection.registerClass(s.SectionDrawingModelState.getClassFullName(),s.SectionDrawingModelState),o.IModelConnection.registerClass(s.SheetModelState.getClassFullName(),s.SheetModelState),o.IModelConnection.registerClass(l.OrthographicViewState.getClassFullName(),l.OrthographicViewState),o.IModelConnection.registerClass(l.SpatialViewState.getClassFullName(),l.SpatialViewState),o.IModelConnection.registerClass(l.DrawingViewState.getClassFullName(),l.DrawingViewState),o.IModelConnection.registerClass(u.SheetViewState.getClassFullName(),u.SheetViewState),this.addDecorator(i.IModelApp.accuSnap),this.addDecorator(i.IModelApp.tentativePoint),this.addDecorator(i.IModelApp.accuDraw),this.addDecorator(i.IModelApp.toolAdmin),this.cursor="default"}onShutDown(){this._viewports.length=0,this.decorators.length=0,this._selectedView=void 0}endDynamicsMode(){if(!this.inDynamicsMode)return;this.inDynamicsMode=!1;const e=i.IModelApp.toolAdmin.cursorView;e&&e.changeDynamics(void 0);for(const t of this._viewports)t!==e&&t.changeDynamics(void 0)}beginDynamicsMode(){this.inDynamicsMode=!0}get doesHostHaveFocus(){return document.hasFocus()}clearSelectedView(){const e=this.selectedView;this._selectedView=void 0,this.notifySelectedViewportChanged(e,void 0)}setSelectedView(e){if(void 0===e&&(e=this.getFirstOpenView()),e===this.selectedView)return 0;if(void 0===e)return this.clearSelectedView(),32768;const t=this.selectedView;return this._selectedView=e,this.notifySelectedViewportChanged(t,e),i.IModelApp.toolAdmin.startDefaultTool(),0}notifySelectedViewportChanged(e,t){i.IModelApp.toolAdmin.onSelectedViewportChanged(e,t),this.onSelectedViewportChanged.emit({previous:e,current:t})}get selectedView(){return this._selectedView}getFirstOpenView(){return this._viewports.length>0?this._viewports[0]:void 0}addViewport(e){return this._viewports.includes(e)?32768:(e.setEventController(new a.EventController(e)),this._viewports.push(e),this.setSelectedView(e),1===this._viewports.length&&i.IModelApp.toolAdmin.startEventLoop(),this.onViewOpen.emit(e),0)}dropViewport(e,t=!0){const r=this._viewports.indexOf(e);return-1===r?32768:(this.onViewClose.emit(e),i.IModelApp.toolAdmin.onViewportClosed(e),e.setEventController(void 0),this._viewports.splice(r,1),this.selectedView===e&&this.setSelectedView(void 0),t&&e.dispose(),0)}forEachViewport(e){this._viewports.forEach(t=>e(t))}invalidateDecorationsAllViews(){this.forEachViewport(e=>e.invalidateDecorations())}onSelectionSetChanged(e){this.forEachViewport(e=>e.view.setSelectionSetDirty())}invalidateViewportScenes(){this.forEachViewport(e=>e.sync.invalidateScene())}validateViewportScenes(){this.forEachViewport(e=>e.sync.setValidScene())}invalidateScenes(){this._invalidateScenes=!0}get sceneInvalidated(){return this._invalidateScenes}onNewTilesReady(){this.invalidateScenes()}renderLoop(){if(0===this._viewports.length)return;this._skipSceneCreation?this.validateViewportScenes():this._invalidateScenes&&this.invalidateViewportScenes(),this._invalidateScenes=!1;const e=i.IModelApp.toolAdmin.cursorView;if(void 0===e||e.renderFrame())for(const t of this._viewports)if(t!==e&&!t.renderFrame())break}addDecorator(e){if(this.decorators.includes(e))throw new Error("decorator already registered");return this.decorators.push(e),this.invalidateDecorationsAllViews(),()=>{this.dropDecorator(e)}}dropDecorator(e){const t=this.decorators.indexOf(e);t>=0&&this.decorators.splice(t,1),this.invalidateDecorationsAllViews()}async getDecorationToolTip(e){for(const t of this.decorators)if(void 0!==t.testDecorationHit&&void 0!==t.getDecorationToolTip&&t.testDecorationHit(e.sourceId))return t.getDecorationToolTip(e);return""}async onDecorationButtonEvent(e,t){for(const r of i.IModelApp.viewManager.decorators)if(void 0!==r.testDecorationHit&&void 0!==r.onDecorationButtonEvent&&r.testDecorationHit(e.sourceId))return r.onDecorationButtonEvent(e,t);return c.EventHandled.No}getDecorationGeometry(e){for(const t of i.IModelApp.viewManager.decorators)if(void 0!==t.testDecorationHit&&void 0!==t.getDecorationGeometry&&t.testDecorationHit(e.sourceId))return t.getDecorationGeometry(e)}get crossHairCursor(){return"url(crosshair.cur), crosshair"}get dynamicsCursor(){return"url(dynamics.cur), move"}get grabCursor(){return"url(openHand.cur), auto"}get grabbingCursor(){return"url(closedHand.cur), auto"}setViewCursor(e="default"){e!==this.cursor&&(this.cursor=e,void 0!==this.selectedView&&this.selectedView.setCursor(e))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(8);t.EventController=class EventController{constructor(e){this.vp=e,this._removals=[];const t=e.canvas;void 0!==t&&(this.addDomListeners(["mousedown","mouseup","mousemove","mouseenter","mouseleave","wheel","touchstart","touchend","touchcancel","touchmove"],t),t.oncontextmenu=(()=>!1),t.onselectstart=(()=>!1))}destroy(){this._removals.forEach(e=>e()),this._removals.length=0}addDomListeners(e,t){const r=this.vp,{toolAdmin:i}=n.IModelApp,o=e=>{e.preventDefault(),i.addEvent(e,r)};e.forEach(e=>{t.addEventListener(e,o,!1),this._removals.push(()=>{t.removeEventListener(e,o,!1)})})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(30),i=r(146),o=r(86),s=r(8);class IdleTool extends n.InteractiveTool{async performTentative(e){const t=s.IModelApp.toolAdmin.viewTool;if(t&&t.inDynamicUpdate)return;const r=s.IModelApp.tentativePoint;if(await r.process(e),r.isSnapped)s.IModelApp.toolAdmin.adjustSnapPoint();else if(s.IModelApp.accuDraw.isActive){const t=r.getPoint().clone(),n=e.viewport;if(n.isSnapAdjustmentRequired){s.IModelApp.toolAdmin.adjustPointToACS(t,n,!1);const e=new o.HitDetail(t,n,4,t,"",6,0,0),i=new o.SnapDetail(e);r.setCurrSnap(i),s.IModelApp.toolAdmin.adjustSnapPoint(),r.setPoint(r.getPoint())}else{s.IModelApp.accuDraw.adjustPoint(t,n,!1);const e=t.clone();s.IModelApp.toolAdmin.adjustPointToGrid(t,n),t.isExactEqual(e)||s.IModelApp.accuDraw.adjustPoint(t,n,!1),r.setPoint(t)}}else s.IModelApp.toolAdmin.adjustPoint(r.getPoint(),e.viewport);s.IModelApp.accuDraw.onTentative(),t&&t instanceof i.ViewManip&&t.viewHandles.hasHandle(2)?t.updateTargetCenter():s.IModelApp.toolAdmin.updateDynamics()}async onMouseStartDrag(e){if(!e.viewport)return n.EventHandled.No;let t,r;switch(e.button){case 2:e.isControlKey?(t=e.viewport.view.allow3dManipulations()?"View.Look":"View.Scroll",r=e.viewport.view.allow3dManipulations()?128:8):e.isShiftKey?(t="View.Rotate",r=1):(t="View.Pan",r=4);break;case 0:if(void 0!==s.IModelApp.toolAdmin.activeTool)return n.EventHandled.No;t="View.Rotate",r=1;break;default:if(void 0!==s.IModelApp.toolAdmin.activeTool)return n.EventHandled.No;t="View.Pan",r=4}const o=s.IModelApp.toolAdmin.viewTool;if(o)return o instanceof i.ViewManip?o.startHandleDrag(e,r):n.EventHandled.No;const a=s.IModelApp.tools.create(t,e.viewport,!0,!0);return a&&a.run()?a.startHandleDrag(e):n.EventHandled.Yes}async onMiddleButtonUp(e){if(!e.viewport)return n.EventHandled.No;if(e.isDoubleClick){return new i.FitViewTool(e.viewport,!0).run()?n.EventHandled.Yes:n.EventHandled.No}return e.isControlKey||e.isShiftKey?n.EventHandled.No:(await this.performTentative(e),n.EventHandled.Yes)}async onMouseWheel(e){return s.IModelApp.toolAdmin.processWheelEvent(e,!0)}async onTouchMoveStart(e,t){return new i.DefaultViewTouchTool(t,e).run()?n.EventHandled.Yes:n.EventHandled.No}async onTouchTap(e){if(e.isSingleTap)return s.IModelApp.toolAdmin.convertTouchTapToButtonDownAndUp(e,0),n.EventHandled.Yes;if(e.isTwoFingerTap)return s.IModelApp.toolAdmin.convertTouchTapToButtonDownAndUp(e,1),n.EventHandled.Yes;if(e.isDoubleTap){return new i.FitViewTool(e.viewport,!0).run()?n.EventHandled.Yes:n.EventHandled.No}return n.EventHandled.No}exitTool(){}run(){return!0}}IdleTool.toolId="Idle",IdleTool.hidden=!0,t.IdleTool=IdleTool},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(179),o=r(8),s=r(30),a=r(103),c=r(0),l=r(20),u=r(4);!function(e){e[e.Pick=0]="Pick",e[e.Line=1]="Line",e[e.Box=2]="Box"}(t.SelectionMethod||(t.SelectionMethod={})),function(e){e[e.Replace=0]="Replace",e[e.Add=1]="Add",e[e.Remove=2]="Remove"}(t.SelectionMode||(t.SelectionMode={})),function(e){e[e.AddElementToSelection=0]="AddElementToSelection",e[e.RemoveElementFromSelection=1]="RemoveElementFromSelection",e[e.InvertElementInSelection=2]="InvertElementInSelection",e[e.ReplaceSelectionWithElement=3]="ReplaceSelectionWithElement"}(t.SelectionProcessing||(t.SelectionProcessing={}));class SelectionTool extends i.PrimitiveTool{constructor(){super(...arguments),this.isSelectByPoints=!1,this.isSuspended=!1,this.points=[]}requireWriteableTarget(){return!1}autoLockTarget(){}wantSelectionClearOnMiss(e){return 0===this.getSelectionMode()}wantEditManipulators(){return 0===this.getSelectionMethod()}wantPickableDecorations(){return this.wantEditManipulators()}getSelectionMethod(){return 0}getSelectionMode(){return 0}wantToolSettings(){return!0}initSelectTool(){const e=this.getSelectionMethod(),t=this.getSelectionMode(),r=0===e;switch(this.isSelectByPoints=!1,this.points.length=0,this.initLocateElements(r,!1,r?"default":"crosshair",65535),o.IModelApp.locateManager.options.allowDecorations=!0,t){case 0:switch(e){case 0:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyElement");break;case 1:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyLine");break;case 2:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyBox")}break;case 1:switch(e){case 0:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyElementAdd");break;case 1:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyLineAdd");break;case 2:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyBoxAdd")}break;case 2:switch(e){case 0:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyElementRemove");break;case 1:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyLineRemove");break;case 2:o.IModelApp.notifications.outputPromptByKey("CoreTools:tools.ElementSet.Prompt.IdentifyBoxRemove")}}}processSelection(e,t){switch(t){case 0:return this.iModel.selectionSet.add(e);case 1:return this.iModel.selectionSet.remove(e);case 2:return this.iModel.selectionSet.invert(e);case 3:return this.iModel.selectionSet.replace(e),!0;default:return!1}}useOverlapSelection(e){let t=!1;const r=e.viewport,n=r.worldToView(this.points[0]),i=r.worldToView(e.point);return t=n.x>i.x,e.isShiftKey?!t:t}selectByPointsDecorate(e){if(!this.isSelectByPoints)return;const t=new s.BeButtonEvent;o.IModelApp.toolAdmin.fillEventFromCursorLocation(t);const r=e.viewport,n=u.ColorDef.black===r.getContrastToBackgroundColor(),i=1===this.getSelectionMethod()||0===this.getSelectionMethod()&&1===t.button,a=i||this.useOverlapSelection(t),c=r.worldToView(this.points[0]);c.x=Math.floor(c.x)+.5,c.y=Math.floor(c.y)+.5;const l=r.worldToView(t.point);l.x=Math.floor(l.x)+.5,l.y=Math.floor(l.y)+.5;const d=l.minus(c);e.addCanvasDecoration({position:c,drawDecoration:e=>{e.strokeStyle=n?"black":"white",e.lineWidth=1,a&&e.setLineDash([5,5]),i?(e.beginPath(),e.moveTo(0,0),e.lineTo(d.x,d.y),e.stroke()):(e.strokeRect(0,0,d.x,d.y),e.fillStyle=n?"rgba(0,0,0,.06)":"rgba(255,255,255,.06)",e.fillRect(0,0,d.x,d.y))}})}selectByPointsProcess(e,t,r,i,o){const s=r.viewport;if(!s)return;const a=[];a[0]=new n.Point2d(Math.floor(e.x+.5),Math.floor(e.y+.5)),a[1]=new n.Point2d(Math.floor(t.x+.5),Math.floor(t.y+.5));const u=n.Range2d.createArray(a),d=new l.ViewRect;d.initFromRange(u);const h=s.readPixels(d,1);if(void 0===h)return;let p=new Set;const f=n.Point2d.createZero();if(2===i){const e=o?void 0:new Set,t=u.clone();for(t.expandInPlace(-2),f.x=u.low.x;f.x<=u.high.x;++f.x)for(f.y=u.low.y;f.y<=u.high.y;++f.y){const r=h.getPixel(f.x,f.y);void 0===r||void 0===r.elementId||c.Id64.isInvalid(r.elementId)||(void 0===e||t.containsPoint(f)?p.add(r.elementId.toString()):e.add(r.elementId.toString()))}if(void 0!==e&&0!==e.size){const t=new Set;p.forEach(r=>{e.has(r)||t.add(r)}),p=t}}else{const e=n.Point2d.createZero();for(f.x=u.low.x;f.x<=u.high.x;++f.x)for(f.y=u.low.y;f.y<=u.high.y;++f.y){const t=h.getPixel(f.x,f.y);if(void 0===t||void 0===t.elementId||c.Id64.isInvalid(t.elementId))continue;const r=f.fractionOfProjectionToLine(a[0],a[1],0);a[0].interpolate(r,a[1],e),e.distance(f)<1.5&&p.add(t.elementId.toString())}}if(this.wantPickableDecorations()||p.forEach(e=>{c.Id64.isTransient(e)&&p.delete(e)}),0!==p.size)switch(this.getSelectionMode()){case 0:r.isControlKey?this.processSelection(p,2):this.processSelection(p,3);break;case 1:this.processSelection(p,0);break;case 2:this.processSelection(p,1)}else!r.isControlKey&&this.wantSelectionClearOnMiss(r)&&this.iModel.selectionSet.emptyAll()}selectByPointsStart(e){return(0===e.button||1===e.button)&&(this.points.length=0,this.points.push(e.point.clone()),this.isSelectByPoints=!0,o.IModelApp.accuSnap.enableLocate(!1),o.IModelApp.toolAdmin.setLocateCircleOn(!1),!0)}selectByPointsEnd(e){if(!this.isSelectByPoints)return!1;const t=e.viewport;if(void 0===t)return this.initSelectTool(),!1;const r=t.worldToView(this.points[0]),n=t.worldToView(e.point);return 1===this.getSelectionMethod()||0===this.getSelectionMethod()&&1===e.button?this.selectByPointsProcess(r,n,e,1,!0):this.selectByPointsProcess(r,n,e,2,this.useOverlapSelection(e)),this.initSelectTool(),t.invalidateDecorations(),!0}async onMouseMotion(e){void 0!==e.viewport&&this.isSelectByPoints&&e.viewport.invalidateDecorations()}async selectDecoration(e,t){return void 0===t&&(t=await o.IModelApp.locateManager.doLocate(new a.LocateResponse,!0,e.point,e.viewport,e.inputSource)),void 0===t||t.isElementHit?s.EventHandled.No:o.IModelApp.viewManager.onDecorationButtonEvent(t,e)}async onMouseStartDrag(e){return s.EventHandled.Yes===await this.selectDecoration(e,o.IModelApp.accuSnap.currHit)?s.EventHandled.Yes:2===e.inputSource&&0===this.getSelectionMethod()?s.EventHandled.No:this.selectByPointsStart(e)?s.EventHandled.Yes:s.EventHandled.No}async onMouseEndDrag(e){return this.selectByPointsEnd(e)?s.EventHandled.Yes:s.EventHandled.No}async onDataButtonUp(e){if(void 0===e.viewport)return s.EventHandled.No;if(this.selectByPointsEnd(e))return s.EventHandled.Yes;if(0!==this.getSelectionMethod())return!e.isControlKey&&this.wantSelectionClearOnMiss(e)&&this.iModel.selectionSet.emptyAll(),2!==e.inputSource&&this.selectByPointsStart(e),s.EventHandled.Yes;const t=await o.IModelApp.locateManager.doLocate(new a.LocateResponse,!0,e.point,e.viewport,e.inputSource);if(void 0!==t){if(s.EventHandled.Yes===await this.selectDecoration(e,t))return s.EventHandled.Yes;switch(this.getSelectionMode()){case 0:this.processSelection(t.sourceId,e.isControlKey?2:3);break;case 1:this.processSelection(t.sourceId,0);break;case 2:this.processSelection(t.sourceId,1)}return s.EventHandled.Yes}return!e.isControlKey&&0!==this.iModel.selectionSet.size&&this.wantSelectionClearOnMiss(e)&&this.iModel.selectionSet.emptyAll(),s.EventHandled.Yes}async onResetButtonUp(e){if(this.isSelectByPoints)return void 0!==e.viewport&&e.viewport.invalidateDecorations(),this.initSelectTool(),s.EventHandled.Yes;const t=2===this.getSelectionMode()?void 0:o.IModelApp.locateManager.currHit;if(t&&this.iModel.selectionSet.has(t.sourceId)){const r=o.IModelApp.accuSnap.currHit;if(void 0===r||r.isSameHit(t)){const r=new a.LocateResponse,n=await o.IModelApp.locateManager.doLocate(r,!1,e.point,e.viewport,e.inputSource);return 0!==this.getSelectionMode()&&void 0===n||this.processSelection(t.sourceId,1),void 0!==n&&this.processSelection(n.sourceId,0),s.EventHandled.Yes}}return s.EventHandled.Yes===await this.selectDecoration(e,o.IModelApp.accuSnap.currHit)?s.EventHandled.Yes:(o.IModelApp.accuSnap.resetButton(),s.EventHandled.Yes)}onSuspend(){this.isSuspended=!0,this.wantEditManipulators()&&o.IModelApp.toolAdmin.manipulatorToolEvent.raiseEvent(this,3)}onUnsuspend(){this.isSuspended=!1,this.wantEditManipulators()&&o.IModelApp.toolAdmin.manipulatorToolEvent.raiseEvent(this,4)}async onTouchMoveStart(e,t){return t.isSingleTouch&&!this.isSelectByPoints&&await o.IModelApp.toolAdmin.convertTouchMoveStartToButtonDownAndMotion(t,e),this.isSuspended||this.isSelectByPoints?s.EventHandled.Yes:s.EventHandled.No}async onTouchMove(e){this.isSelectByPoints&&o.IModelApp.toolAdmin.convertTouchMoveToMotion(e)}async onTouchComplete(e){this.isSelectByPoints&&o.IModelApp.toolAdmin.convertTouchEndToButtonUp(e)}async onTouchCancel(e){this.isSelectByPoints&&o.IModelApp.toolAdmin.convertTouchEndToButtonUp(e,1)}decorate(e){this.selectByPointsDecorate(e)}async onModifierKeyTransition(e,t,r){return 2===t&&this.isSelectByPoints?s.EventHandled.Yes:s.EventHandled.No}async filterHit(e,t){if(!this.wantPickableDecorations()&&!e.isElementHit)return 1;const r=this.getSelectionMode();if(0===r)return 0;const n=this.iModel.selectionSet.has(e.sourceId);return(1===r?!n:n)?0:1}onRestartTool(){this.exitTool()}onCleanup(){this.wantEditManipulators()&&o.IModelApp.toolAdmin.manipulatorToolEvent.raiseEvent(this,2)}onPostInstall(){super.onPostInstall(),this.targetView&&(this.wantEditManipulators()&&o.IModelApp.toolAdmin.manipulatorToolEvent.raiseEvent(this,1),this.initSelectTool())}static startTool(){return(new SelectionTool).run()}}SelectionTool.hidden=!1,SelectionTool.toolId="Select",t.SelectionTool=SelectionTool},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.default=class SelectionChangeEvent extends n.BeEvent{},function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.Replace=2]="Replace",e[e.Clear=3]="Clear"}(t.SelectionChangeType||(t.SelectionChangeType={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(68),i=r(47),o=r(322);t.default=class SelectionManager{constructor(){this._selectionContainerMap=new Map,this.selectionChange=new o.default,n.IModelConnection.onClose.addListener(e=>{this.onConnectionClose(e)})}onConnectionClose(e){this.clearSelection("Connection Close Event",e),this._selectionContainerMap.delete(e)}getContainer(e){let t=this._selectionContainerMap.get(e);return t||(t=new SelectionContainer,this._selectionContainerMap.set(e,t)),t}getSelectionLevels(e){return this.getContainer(e).getSelectionLevels()}getSelection(e,t=0){return this.getContainer(e).getSelection(t)}handleEvent(e){const t=this.getContainer(e.imodel),r=t.getSelection(e.level),n=r.guid;switch(e.changeType){case o.SelectionChangeType.Add:r.add(e.keys);break;case o.SelectionChangeType.Remove:r.delete(e.keys);break;case o.SelectionChangeType.Replace:r.size===e.keys.size&&r.hasAll(e.keys)||r.clear().add(e.keys);break;case o.SelectionChangeType.Clear:r.clear()}r.guid!==n&&(t.clear(e.level+1),this.selectionChange.raiseEvent(e,this))}addToSelection(e,t,r,n=0,s){const a={source:e,level:n,imodel:t,changeType:o.SelectionChangeType.Add,keys:new i.KeySet(r),timestamp:new Date,rulesetId:s};this.handleEvent(a)}removeFromSelection(e,t,r,n=0,s){const a={source:e,level:n,imodel:t,changeType:o.SelectionChangeType.Remove,keys:new i.KeySet(r),timestamp:new Date,rulesetId:s};this.handleEvent(a)}replaceSelection(e,t,r,n=0,s){const a={source:e,level:n,imodel:t,changeType:o.SelectionChangeType.Replace,keys:new i.KeySet(r),timestamp:new Date,rulesetId:s};this.handleEvent(a)}clearSelection(e,t,r=0,n){const s={source:e,level:r,imodel:t,changeType:o.SelectionChangeType.Clear,keys:new i.KeySet,timestamp:new Date,rulesetId:n};this.handleEvent(s)}};class SelectionContainer{constructor(){this._selectedItemsSetMap=new Map}getSelection(e){let t=this._selectedItemsSetMap.get(e);return t||(t=new i.KeySet,this._selectedItemsSetMap.set(e,t)),t}getSelectionLevels(){const e=new Array;for(const t of this._selectedItemsSetMap.entries())t[1].isEmpty||e.push(t[0]);return e.sort()}clear(e){const t=this._selectedItemsSetMap.keys();for(const r of t)if(r>=e){this._selectedItemsSetMap.get(r).clear()}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80);var i;!function(e){e.ECInstanceNode="ECInstanceNode",e.ECClassGroupingNode="ECClassGroupingNode",e.ECPropertyGroupingNode="ECPropertyGroupingNode",e.DisplayLabelGroupingNode="DisplayLabelGroupingNode"}(i=t.StandardNodeTypes||(t.StandardNodeTypes={})),t.fromJSON=(e=>{switch(e.type){case i.ECInstanceNode:return Object.assign({},e,{instanceKey:n.instanceKeyFromJSON(e.instanceKey)});default:return Object.assign({},e)}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(554);t.Content=n.default;var i=r(326);t.Descriptor=i.default,t.SortDirection=i.SortDirection,t.ContentFlags=i.ContentFlags;var o=r(557);t.DefaultContentDisplayTypes=o.default;var s=r(327);t.Field=s.Field,t.PropertiesField=s.PropertiesField,t.NestedContentField=s.NestedContentField;var a=r(328);t.Item=a.default;var c=r(558);t.PropertyValueFormat=c.PropertyValueFormat},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80),i=r(327),o=e=>Object.assign({},e,{selectClassInfo:n.classInfoFromJSON(e.selectClassInfo),pathToPrimaryClass:e.pathToPrimaryClass.map(e=>n.relatedClassInfoFromJSON(e)),relatedPropertyPaths:e.relatedPropertyPaths.map(e=>e.map(e=>n.relatedClassInfoFromJSON(e)))});!function(e){e[e.KeysOnly=1]="KeysOnly",e[e.ShowImages=2]="ShowImages",e[e.ShowLabels=4]="ShowLabels",e[e.MergeResults=8]="MergeResults",e[e.DistinctValues=16]="DistinctValues",e[e.NoFields=32]="NoFields"}(t.ContentFlags||(t.ContentFlags={})),function(e){e[e.Ascending=0]="Ascending",e[e.Descending=1]="Descending"}(t.SortDirection||(t.SortDirection={}));class Descriptor{constructor(){}static fromJSON(e){if(!e)return;if("string"===typeof e)return JSON.parse(e,Descriptor.reviver);const t=Object.create(Descriptor.prototype);return Object.assign(t,e,{fields:e.fields.map(e=>i.Field.fromJSON(e)),selectClasses:e.selectClasses.map(e=>o(e))})}static reviver(e,t){return""===e?Descriptor.fromJSON(t):t}getFieldByName(e){for(const t of this.fields)if(t.name===e)return t}createDescriptorOverrides(){return{displayType:this.displayType,hiddenFieldNames:[],sortingFieldName:this.sortingField?this.sortingField.name:void 0,sortDirection:this.sortDirection,contentFlags:this.contentFlags,filterExpression:this.filterExpression}}resetParentship(){for(const e of this.fields)e.resetParentship()}rebuildParentship(){for(const e of this.fields)e.rebuildParentship()}createStrippedDescriptor(){const e=Object.create(Descriptor.prototype);return Object.assign(e,this,{fields:[],selectClasses:[]})}}t.default=Descriptor},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80),i=r(555),o=e=>e.properties,s=e=>e.nestedFields;class Field{constructor(e,t,r,n,i,o,s){this.category=e,this.name=t,this.label=r,this.type=n,this.isReadonly=i,this.priority=o,this.editor=s}isPropertiesField(){return o(this)}isNestedContentField(){return s(this)}get parent(){return this._parent}static fromJSON(e){if(!e)return;if("string"===typeof e)return JSON.parse(e,Field.reviver);if(o(e))return PropertiesField.fromJSON(e);if(s(e))return NestedContentField.fromJSON(e);const t=Object.create(Field.prototype);return Object.assign(t,e)}static reviver(e,t){return""===e?Field.fromJSON(t):t}resetParentship(){this._parent=void 0}rebuildParentship(e){this._parent=e}}t.Field=Field;class PropertiesField extends Field{constructor(e,t,r,n,i,o,s,a){super(e,t,r,n,i,o,a),this.properties=s}static fromJSON(e){if(!e)return;if("string"===typeof e)return JSON.parse(e,Field.reviver);const t=Object.create(PropertiesField.prototype);return Object.assign(t,e,{properties:e.properties.map(e=>i.propertyFromJSON(e))})}}t.PropertiesField=PropertiesField;class NestedContentField extends Field{constructor(e,t,r,n,i,o,s,a,c,l){super(e,t,r,n,i,o,l),this.contentClassInfo=s,this.pathToPrimaryClass=a,this.nestedFields=c}static fromJSON(e){if(!e)return;if("string"===typeof e)return JSON.parse(e,Field.reviver);const t=Object.create(NestedContentField.prototype);return Object.assign(t,e,{nestedFields:e.nestedFields.map(e=>Field.fromJSON(e)),contentClassInfo:n.classInfoFromJSON(e.contentClassInfo),pathToPrimaryClass:e.pathToPrimaryClass.map(e=>n.relatedClassInfoFromJSON(e))})}resetParentship(){super.resetParentship();for(const e of this.nestedFields)e.resetParentship()}rebuildParentship(e){super.rebuildParentship(e);for(const t of this.nestedFields)t.rebuildParentship(this)}}t.NestedContentField=NestedContentField},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80),i=r(556);class Item{constructor(e,t,r,n,i,o,s){this.primaryKeys=e,this.label=t,this.imageId=r,this.classInfo=n,this.values=i,this.displayValues=o,this.mergedFieldNames=s}isFieldMerged(e){return-1!==this.mergedFieldNames.indexOf(e)}static fromJSON(e){if(!e)return;if("string"===typeof e)return JSON.parse(e,Item.reviver);const t=Object.create(Item.prototype);return Object.assign(t,e,{primaryKeys:e.primaryKeys.map(e=>n.instanceKeyFromJSON(e)),classInfo:e.classInfo?n.classInfoFromJSON(e.classInfo):void 0,values:i.valuesMapFromJSON(e.values),displayValues:i.displayValuesMapFromJSON(e.displayValues)})}static reviver(e,t){return""===e?Item.fromJSON(t):t}}t.default=Item},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(325);class PresentationRpcInterface extends n.RpcInterface{getRootNodes(e,t){return this.forward.apply(this,arguments)}getRootNodesCount(e,t){return this.forward.apply(this,arguments)}getChildren(e,t,r){return this.forward.apply(this,arguments)}getChildrenCount(e,t,r){return this.forward.apply(this,arguments)}getNodePaths(e,t,r,n){return this.forward.apply(this,arguments)}getFilteredNodePaths(e,t,r){return this.forward.apply(this,arguments)}getContentDescriptor(e,t,r,n,i){return this.forward.apply(this,arguments)}getContentSetSize(e,t,r,n){return this.forward.apply(this,arguments)}getContent(e,t,r,n){return this.forward.apply(this,arguments)}getDistinctValues(e,t,r,n,i,o){return this.forward.apply(this,arguments)}syncClientState(e,t){return this.forward.apply(this,arguments)}}PresentationRpcInterface.types=(()=>[i.Descriptor,i.Content,i.Field,i.PropertiesField,i.NestedContentField,i.Item]),PresentationRpcInterface.version="1.0.0",t.default=PresentationRpcInterface},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("label",{className:a("bwc-inputs-checkbox",{disabled:this.props.disabled},this.props.status,this.props.className)},s.createElement("input",o({},this.props,{disabled:this.props.disabled,type:"checkbox"})),s.createElement("span",{className:"label"}," ",this.props.label," "))},t}(s.Component);t.Checkbox=c,t.default=c},function(e,t,r){},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("input",o({},this.props,{className:a("bwc-inputs-input",this.props.className)}))},t}(s.Component);t.Input=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=!!this.props.placeholder&&!this.props.value&&!this.props.defaultValue,t=this.props.defaultValue||this.props.value+""||e+""&&"",r=e||this.props.required,n=this.props.options;return s.createElement("select",o({},this.props,{defaultValue:t,required:r,className:a("bwc-inputs-select",this.props.className)}),e&&s.createElement("option",{className:"placeholder",disabled:!0,key:"",value:""},this.props.placeholder),n instanceof Array?n.map(function(e,t){return s.createElement("option",{key:t,value:e},e)}):Object.keys(n).map(function(e){return s.createElement("option",{key:e,value:e},n[e])}))},t}(s.Component);t.Select=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("textarea",o({},this.props,{rows:this.props.rows,className:a("bwc-inputs-textarea",this.props.className)}))},t.defaultProps={rows:3},t}(s.Component);t.Textarea=c,t.default=c},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),o=r(96),s=r(2);var a;r(674),function(e){e.None="",e.TopLeft="top left",e.Top="top",e.TopRight="top right",e.Left="left",e.Center="center",e.Right="right",e.BottomLeft="bottom left",e.Bottom="bottom",e.BottomRight="bottom right"}(a=t.ContextMenuDirection||(t.ContextMenuDirection={}));class ContextMenu extends i.Component{constructor(){super(...arguments),this._rootElement=null,this._menuElement=null,this._selectedElement=null,this._length=0,this.state={selected:this.props.selected},this.focus=(()=>{this._menuElement&&this._menuElement.focus()}),this.blur=(()=>{this._menuElement&&this._menuElement.blur()}),this.getRect=(()=>this._menuElement?this._menuElement.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0}),this._handleFocusChange=(e=>{this._rootElement&&this.props.opened&&e.target instanceof Node&&this.props.onBlur&&!this._rootElement.contains(e.target)&&this.props.onBlur(e)}),this._handleClick=(e=>{this.props.onSelect&&this.props.onSelect(e)}),this._handleKeyUp=(e=>{37===e.keyCode&&(e.stopPropagation(),this.props.parent&&this.props.parentSubmenu&&(this.props.parentSubmenu.close(),this.props.parent.focus()),this.props.onEsc&&this.props.onEsc(e)),27===e.keyCode&&this.props.onEsc&&this.props.onEsc(e),13!==e.keyCode&&39!==e.keyCode||!this._selectedElement||(e.stopPropagation(),(13===e.keyCode||this._selectedElement instanceof ContextSubMenu)&&this._selectedElement.select&&this._selectedElement.select());let{selected:t}=this.state;38!==e.keyCode&&40!==e.keyCode||(e.stopPropagation(),-1===t?t=0:(38===e.keyCode&&(0===this.state.selected?t=this._length-1:t--),40===e.keyCode&&(this.state.selected===this._length-1?t=0:t++))),this.setState(e=>({selected:t}))})}render(){const{opened:e,direction:t,parent:r}=this.props;let n=t;if(!r&&this.props.autoflip){const e=this.getRect();n=ContextMenu.autoFlip(n,e,window.innerWidth,window.innerHeight)}let o=0;const a=i.Children.map(this.props.children,e=>{if("string"===typeof e||"number"===typeof e||e.props.disabled)return e;const t=o,r=()=>{this.setState({selected:t}),this.focus()},s=t=>{e.props.ref&&e.props.ref(t),a&&(this._selectedElement=t)},a=this.state.selected===o++;return e.type===ContextSubMenu?i.cloneElement(e,{direction:e.props.direction||n,parent:this,ref:s,onHover:r,selected:a}):e.type===ContextMenuItem?i.cloneElement(e,{parent:this,ref:s,onHover:r,selected:a}):e});return this._length=o,i.createElement("div",{style:this.props.style,className:"context-menu",onKeyUp:this._handleKeyUp,onClick:this._handleClick,"data-testid":"context-menu-root",ref:e=>{this._rootElement=e}},i.createElement("div",{ref:e=>{this._menuElement=e},tabIndex:0,className:s("context-menu-container",{opened:e},n)},a))}componentDidMount(){window.addEventListener("focus",this._handleFocusChange),window.addEventListener("mouseup",this._handleFocusChange)}componentWillUnmount(){window.removeEventListener("focus",this._handleFocusChange),window.removeEventListener("mouseup",this._handleFocusChange)}componentDidUpdate(e){e.selected!==this.props.selected&&this.setState((e,t)=>({selected:t.selected})),!e.opened&&this.props.opened&&this.setState((e,t)=>({selected:t.selected}))}}ContextMenu.defaultProps={direction:a.BottomRight,autoflip:!0,edgeLimit:!0,selected:-1,floating:!0},ContextMenu.autoFlip=((e,t,r,n)=>{if(t.right>r)switch(e){case a.TopRight:e=a.TopLeft;break;case a.Right:e=a.Left;break;case a.BottomRight:e=a.BottomLeft}if(t.left<0)switch(e){case a.TopLeft:e=a.TopRight;break;case a.Left:e=a.Right;break;case a.BottomLeft:e=a.BottomRight}if(t.bottom>n)switch(e){case a.BottomLeft:e=a.TopLeft;break;case a.Bottom:e=a.Top;break;case a.BottomRight:e=a.TopRight}if(t.top<0)switch(e){case a.TopLeft:e=a.BottomLeft;break;case a.Top:e=a.Bottom;break;case a.TopRight:e=a.BottomRight}return e}),t.ContextMenu=ContextMenu,t.default=ContextMenu;t.GlobalContextMenu=class GlobalContextMenu extends i.Component{constructor(e){super(e),this._container=document.createElement("div"),this._container.id=`context-menu-${e.identifier}`;let t=document.getElementById("context-menu-root");t||((t=document.createElement("div")).id="context-menu-root",document.body.appendChild(t)),t.appendChild(this._container)}componentWillUnmount(){this._container.parentElement&&this._container.parentElement.removeChild(this._container)}render(){const e=this.props,{x:t,y:r,identifier:s}=e,a=n(e,["x","y","identifier"]),c={left:t,top:r};return o.createPortal(i.createElement("div",{className:"context-menu-global",style:c},i.createElement(ContextMenu,Object.assign({},a))),this._container)}};class ContextMenuItem extends i.Component{constructor(e){super(e),this._root=null,this._handleFocus=(e=>{e.stopPropagation()}),this._handleMouseOver=(e=>{this._root&&"hidden"!==this._root.style.visibility&&this.props.onHover&&this.props.onHover()}),this.select=(()=>{this._root&&(this._root.click(),this.props.parent&&this.props.parent.props.parentSubmenu&&this.props.parent.props.parentSubmenu.close(!0))}),this._handleClick=(e=>{this.props.onClick&&this.props.onClick(e),this.props.onSelect&&this.props.onSelect(e)}),this._handleKeyUp=(e=>{13===e.keyCode&&void 0!==this.props.onSelect&&this.props.onSelect(e)})}render(){const e=this.props,{onClick:t,className:r,style:o,onSelect:a,icon:c,disabled:l,onHover:u,selected:d,parent:h}=e,p=n(e,["onClick","className","style","onSelect","icon","disabled","onHover","selected","parent"]);return i.createElement("div",Object.assign({},p,{ref:e=>{this._root=e},onClick:this._handleClick,style:o,onFocus:this._handleFocus,onKeyUp:this._handleKeyUp,onMouseOver:this._handleMouseOver,"data-testid":"context-menu-item",className:s(r,"context-menu-item",{disabled:l,selected:d})}),i.createElement("div",{className:s("context-menu-icon","icon",this.props.icon)}),i.createElement("div",{className:"context-menu-content"},this.props.children))}}ContextMenuItem.defaultProps={disabled:!1,selected:!1},t.ContextMenuItem=ContextMenuItem;t.ContextMenuDivider=class ContextMenuDivider extends i.Component{render(){return i.createElement("div",Object.assign({},this.props,{className:"context-menu-divider"}))}};class ContextSubMenu extends i.Component{constructor(){super(...arguments),this._menuElement=null,this._subMenuElement=null,this._menuButtonElement=null,this.state={opened:!1,direction:a.None},this.select=(()=>{this.setState({opened:!0},()=>{this._menuElement&&this._menuElement.focus()})}),this.close=(e=>{this.setState({opened:!1},()=>{this._menuElement&&this._menuElement.blur()}),e&&this.props.parent&&this.props.parent.props.parentSubmenu&&this.props.parent.props.parentSubmenu.close(!0)}),this._handleMouseOver=(e=>{this._menuButtonElement&&"hidden"!==this._menuButtonElement.style.visibility&&this.props.onHover&&this.props.onHover()}),this._handleClick=(e=>{e.stopPropagation(),this.props.disabled||(void 0!==this.props.onClick&&this.props.onClick(e),this.setState(e=>({opened:!e.opened})))}),this._handleClickGlobal=(e=>{this._subMenuElement&&!this._subMenuElement.contains(e.target)&&this.setState(e=>({opened:!1}))})}render(){const{disabled:e,selected:t,label:r,icon:n,autoflip:o,parent:a,children:c}=this.props,l=this.state.direction||this.props.direction;if(o&&this._menuElement){const e=this._menuElement.getRect(),t=ContextMenu.autoFlip(l,e,window.innerWidth,window.innerHeight);t!==l&&this.setState({direction:t})}return i.createElement("div",{className:s("context-submenu",l),onMouseOver:this._handleMouseOver,ref:e=>{this._subMenuElement=e}},i.createElement("div",{onClick:this._handleClick,ref:e=>{this._menuButtonElement=e},style:this.props.style,className:s("context-menu-item context-submenu-container",{disabled:e,selected:t})},i.createElement("div",{className:s("context-menu-icon","icon",n)}),i.createElement("div",{className:"context-menu-content"},r),i.createElement("div",{className:s("context-submenu-arrow","icon","icon-caret-right")})),i.createElement(ContextMenu,{ref:e=>{this._menuElement=e},opened:this.state.opened,selected:0,direction:l,parent:a,parentSubmenu:this,autoflip:o},c))}componentDidMount(){document.addEventListener("click",this._handleClickGlobal)}componentWillUnmount(){document.removeEventListener("click",this._handleClickGlobal)}}ContextSubMenu.defaultProps={disabled:!1,autoflip:!0,selected:!1},t.ContextSubMenu=ContextSubMenu},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),o=r(2),s=r(189);var a,c;r(337),r(679),function(e){e.None="",e.Close="close",e.OK="ok",e.Cancel="cancel",e.Yes="yes",e.No="no",e.Retry="retry"}(a=t.ButtonType||(t.ButtonType={})),function(e){e.None="",e.Primary="bwc-buttons-primary",e.Hollow="bwc-buttons-hollow",e.Blue="bwc-buttons-blue"}(t.ButtonStyle||(t.ButtonStyle={})),function(e){e.TopLeft="top-left",e.Top="top",e.TopRight="top-right",e.Left="left",e.Center="center",e.Right="right",e.BottomLeft="bottom-left",e.Bottom="bottom",e.BottomRight="bottom-right"}(c=t.DialogAlignment||(t.DialogAlignment={}));class Dialog extends i.Component{constructor(){super(...arguments),this._containerElement=null,this.state={rightResizing:!1,downResizing:!1,moving:!1,grabOffsetX:0,grabOffsetY:0,x:0,y:0,width:0,height:0},this._handleKeyUp=(e=>{"Escape"===e.key&&this.props.opened&&this.props.onEscape&&this.props.onEscape()}),this._setInitial=(()=>{if(this._containerElement){const e=this._containerElement.getBoundingClientRect();this.setState(t=>({x:e.left,y:e.top,width:e.width,height:e.height}))}}),this._handleStartResizeRight=(e=>{e.preventDefault(),this.setState(e=>({rightResizing:!0}))}),this._handleStartResizeDown=(e=>{e.preventDefault(),this.setState(e=>({downResizing:!0}))}),this._handleStartResizeDownRight=(e=>{e.preventDefault(),this.setState(e=>({downResizing:!0,rightResizing:!0}))}),this._handleStartMove=(e=>{if(e.preventDefault(),this._containerElement){const t=this._containerElement.getBoundingClientRect(),r=e.clientX-t.left,n=e.clientY-t.top;this.setState&&this.setState(e=>({grabOffsetX:r,grabOffsetY:n,moving:!0}))}}),this._handleMouseMove=(e=>{const{minWidth:t,maxWidth:r,minHeight:n,maxHeight:i,movable:o}=this.props;let{x:s,y:a,width:c,height:l}=this.state;if(this.props.resizable){if(this.state.rightResizing){const n=e.clientX;c=o?n-s:2*(n-window.innerWidth/2),c=Math.max(c,t),void 0!==r&&(c=Math.min(c,r))}if(this.state.downResizing){const t=e.clientY;l=o?t-a:2*(t-window.innerHeight/2),l=Math.max(l,n),void 0!==i&&(l=Math.min(l,i))}}o&&this.state.moving&&(s=e.clientX-this.state.grabOffsetX,a=e.clientY-this.state.grabOffsetY),this.setState({x:s,y:a,width:c,height:l})}),this._handleMouseUp=(e=>{this.setState({rightResizing:!1,downResizing:!1,moving:!1,grabOffsetX:0,grabOffsetY:0})})}render(){const e=this.props,{opened:t,title:r,footer:c,buttonCluster:l,onClose:u,onEscape:d,minWidth:h,minHeight:p,width:f,height:g,backgroundStyle:m,titleStyle:y,footerStyle:v,modal:_,resizable:w,movable:S,className:b,alignment:x}=e,P=n(e,["opened","title","footer","buttonCluster","onClose","onEscape","minWidth","minHeight","width","height","backgroundStyle","titleStyle","footerStyle","modal","resizable","movable","className","alignment"]),C={margin:"",left:"",top:"",width:this.props.width,height:this.props.height};this.props.movable&&(C.margin="0",C.left=this.state.x,C.top=this.state.y),this.props.resizable&&(C.width=this.state.width,C.height=this.state.height);const T=[];this.props.buttonCluster&&this.props.buttonCluster.forEach((e,t)=>{let r="",n=o("dialog-button",e.type?`dialog-button-${e.type}`:"");switch(e.type){case a.OK:r=s.default.i18n.translate("UiCore:dialog.ok"),n=o(n,e.buttonStyle||"bwc-buttons-primary");break;case a.Retry:r=s.default.i18n.translate("UiCore:dialog.retry"),n=o(n,e.buttonStyle||"bwc-buttons-primary");break;case a.Yes:r=s.default.i18n.translate("UiCore:dialog.yes"),n=o(n,e.buttonStyle||"bwc-buttons-primary");break;case a.No:r=s.default.i18n.translate("UiCore:dialog.no"),n=o(n,e.buttonStyle||"bwc-buttons-hollow");break;case a.Cancel:r=s.default.i18n.translate("UiCore:dialog.cancel"),n=o(n,e.buttonStyle||"bwc-buttons-hollow");break;case a.Close:r=s.default.i18n.translate("UiCore:dialog.close"),n=o(n,e.buttonStyle||"bwc-buttons-hollow")}T.push(i.createElement("button",{className:n,key:t.toString(),onClick:e.onClick},r))});const M=c||i.createElement("div",{className:"dialog-buttons"},T);return i.createElement("div",Object.assign({},P,{className:o("dialog",{"dialog-open":this.props.opened,"dialog-hidden":!this.props.modal}),style:this.props.backgroundStyle}),i.createElement("div",{className:o("dialog-container",x),style:C},i.createElement("div",{className:"dialog-area",ref:e=>{this._containerElement=e}},i.createElement("div",{className:o("dialog-head",{"dialog-movable":this.props.movable}),onMouseDown:this._handleStartMove},i.createElement("div",{className:"dialog-title"},this.props.title),i.createElement("span",{className:"dialog-close icon icon-close",onClick:this.props.onClose})),i.createElement("div",{className:"dialog-content",style:this.props.style},this.props.children),i.createElement("div",{className:"dialog-footer",style:this.props.footerStyle},M)),i.createElement("div",{className:o("dialog-drag","dialog-drag-right",{"dialog-drag-enabled":this.props.resizable}),onTouchStart:this._handleStartResizeRight,onMouseDown:this._handleStartResizeRight}),i.createElement("div",{className:o("dialog-drag","dialog-drag-bottom-mid",{"dialog-drag-enabled":this.props.resizable}),onTouchStart:this._handleStartResizeDown,onMouseDown:this._handleStartResizeDown}),i.createElement("div",{className:o("dialog-drag","dialog-drag-bottom-right",{"dialog-drag-enabled":this.props.resizable}),onTouchStart:this._handleStartResizeDownRight,onMouseDown:this._handleStartResizeDownRight})))}componentDidMount(){this._setInitial(),document.addEventListener("mouseup",this._handleMouseUp,!0),document.addEventListener("touchend",this._handleMouseUp,!0),document.addEventListener("mousemove",this._handleMouseMove,!0),document.addEventListener("touchmove",this._handleMouseMove,!0),document.addEventListener("keyup",this._handleKeyUp,!0)}componentWillUnmount(){document.removeEventListener("mouseup",this._handleMouseUp,!0),document.removeEventListener("touchend",this._handleMouseUp,!0),document.removeEventListener("mousemove",this._handleMouseMove,!0),document.removeEventListener("touchmove",this._handleMouseMove,!0),document.removeEventListener("keyup",this._handleKeyUp,!0)}}Dialog.defaultProps={alignment:c.Center,minWidth:400,minHeight:400,width:"50%",height:"",resizable:!1,movable:!1,modal:!0},t.Dialog=Dialog,t.default=Dialog},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class Point{constructor(e,t){this.x=0,this.y=0,this.distTo=(e=>{const t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)}),this.equals=(e=>this.x===e.x&&this.y===e.y),this.x=e||0,this.y=t||0}}t.Point=Point;class Line{constructor(e,t){this.equals=(e=>this.p1.equals(e.p1)&&this.p2.equals(e.p2)),this.p1=e||new Point,this.p2=t||new Point}}t.Line=Line;class Circle{constructor(e,t){this.center=e||new Point,this.radius=t||0}}t.Circle=Circle;t.Annulus=class Annulus{constructor(e,t,r){this.center=e||new Point,this.inner=new Circle(e,t),this.outer=new Circle(e,r)}};t.AnnularSector=class AnnularSector{constructor(e,t,r){this.parent=e,this.startAngle=t,this.endAngle=r;const{x:n,y:i}=e.center,o=e.inner.radius,s=e.outer.radius;this.innerStart=new Point(n+o*Math.cos(t),i+o*Math.sin(t)),this.outerStart=new Point(n+s*Math.cos(t),i+s*Math.sin(t)),this.start=new Line(this.innerStart,this.outerStart),this.outerEnd=new Point(n+s*Math.cos(r),i+s*Math.sin(r)),this.innerEnd=new Point(n+o*Math.cos(r),i+o*Math.sin(r)),this.end=new Line(this.outerEnd,this.innerEnd);const a=(r-t)%(2*Math.PI)>Math.PI?1:0,c=[];c.push(`M${this.innerStart.x},${this.innerStart.y}`),c.push(`L${this.outerStart.x},${this.outerStart.y}`),c.push(`A${s},${s} 0 ${a} 1 ${this.outerEnd.x},${this.outerEnd.y}`),c.push(`L${this.innerEnd.x},${this.innerEnd.y}`),c.push(`A${o},${o} 0 ${a} 0 ${this.innerStart.x},${this.innerStart.y}`),c.push("z"),this.path=c.join(" ")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(1);r(706);t.default=class ExpansionToggle extends i.Component{render(){const e=n("nz-tree-expansionToggle",this.props.isExpanded&&"is-expanded",this.props.className);return i.createElement("div",{onClick:this.props.onClick,className:e,style:this.props.style,"data-testid":this.props["data-testid"]},i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",className:"toggle"},i.createElement("path",{d:"m4.7 0l-1.4 1.4 6.6 6.6-6.6 6.6 1.4 1.4 8-8z"})))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Success=0]="Success",e[e.NotFound=1]="NotFound",e[e.UnknownError=2]="UnknownError"}(t.UiSettingsStatus||(t.UiSettingsStatus={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTreeDataProviderRaw=(e=>Array.isArray(e)),t.isTreeDataProviderPromise=(e=>void 0!==e.then),t.isTreeDataProviderMethod=(e=>"function"===typeof e),t.isTreeDataProviderInterface=(e=>{const t=e;return void 0!==t.getNodes&&void 0!==t.getNodesCount})},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(1)),s=i(r(721)),a=r(0),c=r(32),l=r(196),u=r(341),d=r(149),h=r(198),p=i(r(92));r(725);class Tree extends o.Component{constructor(e,t){super(e,t),this._treeComponent=o.createRef(),this._onNodesSelected=((e,t)=>{this.props.onNodesSelected&&this.props.onNodesSelected(e.map(e=>e.payload),t)}),this._onNodesDeselected=(e=>{this.props.onNodesDeselected&&this.props.onNodesDeselected(e.map(e=>e.payload))}),this._onNodeExpanded=(e=>{this.props.onNodeExpanded&&this.props.onNodeExpanded(e.payload),this._tree.updateNodesSelection(e.getChildren(),this.props.selectedNodes),this._nodesSelectionHandlers=void 0}),this._onNodeCollapsed=(e=>{this.props.onNodeCollapsed&&this.props.onNodeCollapsed(e.payload),this._nodesSelectionHandlers=void 0}),this._onModelLoaded=(e=>{this.props.onRootNodesLoaded&&this.props.onRootNodesLoaded(e.map(e=>e.payload)),this._nodesSelectionHandlers=void 0}),this._onChildrenLoaded=(e=>{const t=e.getChildren();this.props.onChildrenLoaded&&this.props.onChildrenLoaded(e.payload,l.toNodes(t).map(e=>e.payload)),this._tree.updateNodesSelection(t,this.props.selectedNodes),this._nodesSelectionHandlers=void 0}),this._onModelChanged=(e=>{this.setState({model:this._tree})}),this._onModelReady=(()=>{this.setState({modelReady:!0})}),this._onTreeNodeChanged=(e=>{a.using(this._tree.pauseRendering(),async()=>{if(e)for(const t of e)if(t){const e=this._tree.node(t.id);if(e){const r=e.expanded();e.assign(Tree.inspireNodeFromTreeNodeItem(t,Tree.inspireNodeFromTreeNodeItem.bind(this))),r&&await e.loadChildren()}}else{const e=this._tree.expanded().map(e=>e.id);await this._tree.reload(),await Promise.all(this._tree.nodes(e).map(e=>e.loadChildren()))}})}),this._onMouseDown=(()=>{document.addEventListener("mouseup",this._onMouseUp,{capture:!0,once:!0})}),this._onMouseUp=(()=>{this._selectionHandler.completeDragAction()}),this._createItemSelectionHandler=(e=>({preselect:()=>{},select:()=>e.select(),deselect:()=>e.deselect(),isSelected:()=>e.selected(),item:()=>e})),this._multiSelectionHandler={selectBetween:(e,t)=>this._tree.selectBetween(e,t),deselectAll:()=>this._tree.deselectAll(),updateSelection:(e,t)=>{e.forEach(e=>e.select()),t.forEach(e=>e.deselect())},areEqual:(e,t)=>e===t},this.renderNode=((e,t)=>o.createElement(TreeNode,Object.assign({key:e.id},t))),this.recreateTree(),this._selectionHandler=new h.SelectionHandler(e.selectionMode,this._onNodesSelected,this._onNodesDeselected),this._selectionHandler.onItemsSelectedCallback=this._onNodesSelected,this._selectionHandler.onItemsDeselectedCallback=this._onNodesDeselected,this.state={prev:{dataProvider:e.dataProvider,selectedNodes:e.selectedNodes,modelReady:!1},model:this._tree,modelReady:!1}}recreateTree(){this._tree=new l.BeInspireTree({dataProvider:this.props.dataProvider,renderer:this._onModelChanged,mapPayloadToInspireNodeConfig:Tree.inspireNodeFromTreeNodeItem}),this._tree.on(l.BeInspireTreeEvent.NodeExpanded,this._onNodeExpanded),this._tree.on(l.BeInspireTreeEvent.NodeCollapsed,this._onNodeCollapsed),this._tree.on(l.BeInspireTreeEvent.ModelLoaded,this._onModelLoaded),this._tree.on(l.BeInspireTreeEvent.ChildrenLoaded,this._onChildrenLoaded),this._tree.ready.then(this._onModelReady)}static getDerivedStateFromProps(e,t){const r=e.dataProvider!==t.prev.dataProvider,n=e.selectedNodes!==t.prev.selectedNodes,i=t.modelReady!==t.prev.modelReady;(r||n||i&&t.modelReady)&&a.using(t.model.mute([l.BeInspireTreeEvent.ChangesApplied]),()=>{t.model.updateTreeSelection(e.selectedNodes)});const o=Object.assign({},t,{prev:Object.assign({},t.prev,{dataProvider:e.dataProvider,modelReady:t.modelReady,selectedNodes:e.selectedNodes,nodeHighlightingProps:e.nodeHighlightingProps})});return e.nodeHighlightingProps!==t.prev.nodeHighlightingProps&&(o.highlightingEngine=e.nodeHighlightingProps?new s.default(e.nodeHighlightingProps):void 0),r?Object.assign({},o,{modelReady:!1}):o}componentDidMount(){u.isTreeDataProviderInterface(this.props.dataProvider)&&this.props.dataProvider.onTreeNodeChanged&&this.props.dataProvider.onTreeNodeChanged.addListener(this._onTreeNodeChanged),this.props.onRender&&this.props.onRender()}componentWillUnmount(){this._tree.removeAllListeners(),u.isTreeDataProviderInterface(this.props.dataProvider)&&this.props.dataProvider.onTreeNodeChanged&&this.props.dataProvider.onTreeNodeChanged.removeListener(this._onTreeNodeChanged)}shouldComponentUpdate(e,t){return this.state.modelReady!==t.modelReady||!!t.modelReady&&(this.props.selectedNodes!==e.selectedNodes||this.props.renderNode!==e.renderNode||this.props.dataProvider!==e.dataProvider||this.props.nodeHighlightingProps!==e.nodeHighlightingProps||this.state.model.nodes().some(e=>e.isDirty()))}componentDidUpdate(e){this.props.onRender&&this.props.onRender(),this._selectionHandler.selectionMode=this.props.selectionMode,this._treeComponent.current&&this.props.nodeHighlightingProps&&c.shallowDiffers(this.props.nodeHighlightingProps,e.nodeHighlightingProps)&&s.default.scrollToActiveNode(this._treeComponent.current),this.props.dataProvider!==e.dataProvider&&(u.isTreeDataProviderInterface(e.dataProvider)&&e.dataProvider.onTreeNodeChanged&&e.dataProvider.onTreeNodeChanged.removeListener(this._onTreeNodeChanged),u.isTreeDataProviderInterface(this.props.dataProvider)&&this.props.dataProvider.onTreeNodeChanged&&this.props.dataProvider.onTreeNodeChanged.addListener(this._onTreeNodeChanged),this.recreateTree(),this.setState({model:this._tree}),this._tree.ready.then(this._onModelReady))}get nodesSelectionHandlers(){if(!this._nodesSelectionHandlers){this._nodesSelectionHandlers=[];const e=this._tree.visible();for(const t of e)this._nodesSelectionHandlers.push(this._createItemSelectionHandler(t))}return this._nodesSelectionHandlers}static inspireNodeFromTreeNodeItem(e,t){const r={id:e.id,text:e.label,itree:{state:{}}};return e.icon&&(r.itree.icon=e.icon),e.autoExpand&&(r.itree.state.collapsed=!1),e.hasChildren?r.children=!0:e.children&&(r.children=e.children.map(e=>t(e,t))),r}render(){const e=this.state.model.visible();if(0===e.length)return o.createElement("p",{className:"ui-components-tree-errormessage"},this.props.nodeHighlightingProps?p.default.i18n.translate("UiComponents:tree.noResultsForFilter",{searchText:this.props.nodeHighlightingProps.searchText}):p.default.i18n.translate("UiComponents:general.noData"));const t=this.props.renderNode?this.props.renderNode:this.renderNode;return o.createElement(c.Tree,{ref:this._treeComponent,onMouseDown:this._onMouseDown},e.map(e=>{const r=this._selectionHandler.createSelectionFunction(this._multiSelectionHandler,this._createItemSelectionHandler(e)),n={node:e,highlightProps:this.state.highlightingEngine?this.state.highlightingEngine.createRenderProps(e):void 0,renderLabel:Tree.renderLabelComponent,onClick:e=>r(e.shiftKey,e.ctrlKey),onMouseDown:()=>this._selectionHandler.createDragAction(this._multiSelectionHandler,[this.nodesSelectionHandlers],e),onMouseMove:t=>{1===t.buttons&&this._selectionHandler.updateDragAction(e)}};return t(e,n)}))}}Tree.defaultProps={selectionMode:d.SelectionMode.Single},Tree.renderLabelComponent=((e,t)=>t?s.default.renderNodeLabel(e.text,t):e.text),t.Tree=Tree,function(e){let t;!function(e){e.Node="tree-node",e.NodeContents="tree-node-contents",e.NodeExpansionToggle="tree-node-expansion-toggle"}(t=e.TestId||(e.TestId={}))}(Tree=t.Tree||(t.Tree={}));class TreeNode extends o.Component{shouldComponentUpdate(e){return e.node.isDirty()||c.shallowDiffers(this.props.highlightProps,e.highlightProps)}render(){return this.props.node.setDirty(!1),o.createElement(c.TreeNode,{"data-testid":"tree-node",isExpanded:this.props.node.expanded(),isSelected:this.props.node.selected(),isLoading:this.props.node.loading(),isLeaf:!this.props.node.hasOrWillHaveChildren(),label:this.props.renderLabel(this.props.node,this.props.highlightProps),icon:this.props.node.itree&&this.props.node.itree.icon?o.createElement("span",{className:this.props.node.itree.icon}):void 0,level:this.props.node.getParents().length,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseDown:this.props.onMouseDown,onClickExpansionToggle:()=>this.props.node.toggleCollapse()})}}t.TreeNode=TreeNode},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.Copy=1]="Copy",e[e.Move=2]="Move",e[e.Link=4]="Link"}(t.DropEffects||(t.DropEffects={})),function(e){e[e.None=0]="None",e[e.Ok=1]="Ok",e[e.Drop=2]="Drop",e[e.Cancel=3]="Cancel"}(t.DropStatus||(t.DropStatus={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SOURCE="SOURCE",e.TARGET="TARGET"}(t.HandlerRole||(t.HandlerRole={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return null===t?null===e:Array.isArray(e)?e.some(function(e){return e===t}):e===t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.strictEquality=function(e,t){return e===t},t.areCoordsEqual=function(e,t){return!e&&!t||!(!e||!t)&&e.x===t.x&&e.y===t.y},t.areArraysEqual=function(e,r,n){if(void 0===n&&(n=t.strictEquality),e.length!==r.length)return!1;for(var i=0;i<e.length;++i)if(!n(e[i],r[i]))return!1;return!0}},function(e,t,r){var n=r(348),i=r(114),o=r(158),s=i(function(e,t){return o(e)?n(e,t):[]});e.exports=s},function(e,t,r){var n=r(201),i=r(204),o=r(205),s=r(157),a=r(206),c=r(207),l=200;e.exports=function(e,t,r,u){var d=-1,h=i,p=!0,f=e.length,g=[],m=t.length;if(!f)return g;r&&(t=s(t,a(r))),u?(h=o,p=!1):t.length>=l&&(h=c,p=!1,t=new n(t));e:for(;++d<f;){var y=e[d],v=null==r?y:r(y);if(y=u||0!==y?y:0,p&&v===v){for(var _=m;_--;)if(t[_]===v)continue e;g.push(y)}else h(t,v,u)||g.push(y)}return g}},function(e,t,r){var n=r(736),i=r(757),o=r(759),s=r(760),a=r(761);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(12))},function(e,t){e.exports=function(e){return e}},function(e,t){var r=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(777);t.NONE=[],t.ALL=[],t.areDirty=function(e,r){return e!==t.NONE&&(e===t.ALL||"undefined"===typeof r||n(r,e).length>0)}},function(e,t,r){var n=r(783),i=r(784);e.exports=function e(t,r,o,s,a){var c=-1,l=t.length;for(o||(o=i),a||(a=[]);++c<l;){var u=t[c];r>0&&o(u)?r>1?e(u,r-1,o,s,a):n(a,u):s||(a[a.length]=u)}return a}},function(e,t,r){var n=r(785),i=r(94),o=Object.prototype,s=o.hasOwnProperty,a=o.propertyIsEnumerable,c=n(function(){return arguments}())?n:function(e){return i(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},function(e,t,r){var n=r(201),i=r(204),o=r(205),s=r(207),a=r(786),c=r(358),l=200;e.exports=function(e,t,r){var u=-1,d=i,h=e.length,p=!0,f=[],g=f;if(r)p=!1,d=o;else if(h>=l){var m=t?null:a(e);if(m)return c(m);p=!1,d=s,g=new n}else g=t?[]:f;e:for(;++u<h;){var y=e[u],v=t?t(y):y;if(y=r||0!==y?y:0,p&&v===v){for(var _=g.length;_--;)if(g[_]===v)continue e;t&&g.push(v),f.push(y)}else d(g,v,r)||(g!==f&&g.push(v),f.push(y))}return f}},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}},function(e,t,r){var n=r(349),i="Expected a function";function o(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(i);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=e.apply(this,n);return r.cache=o.set(i,s)||o,s};return r.cache=new(o.Cache||n),r}o.Cache=n,e.exports=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(200),c=r(808),l=r(211).default,u=(r(95),r(28)),d=r(210),h=r(116);t.default=function(e){var t=e.DecoratedComponent,r=e.createHandler,n=e.createMonitor,p=e.createConnector,f=e.registerHandler,g=e.containerDisplayName,m=e.getType,y=e.collect,v=e.options.arePropsEqual,_=void 0===v?h:v,w=t,S=t.displayName||t.name||"Component",b=function(e){function d(t){var r=e.call(this,t)||this;return r.isCurrentlyMounted=!1,r.handleChange=r.handleChange.bind(r),r.disposable=new c.SerialDisposable,r.receiveProps(t),r.dispose(),r}return i(d,e),d.prototype.getHandlerId=function(){return this.handlerId},d.prototype.getDecoratedComponentInstance=function(){return this.handler?this.handler.ref.current:null},d.prototype.shouldComponentUpdate=function(e,t){return!_(e,this.props)||!h(t,this.state)},d.prototype.componentDidMount=function(){this.isCurrentlyMounted=!0,this.disposable=new c.SerialDisposable,this.currentType=void 0,this.receiveProps(this.props),this.handleChange()},d.prototype.componentDidUpdate=function(e){_(this.props,e)||(this.receiveProps(this.props),this.handleChange())},d.prototype.componentWillUnmount=function(){this.dispose(),this.isCurrentlyMounted=!1},d.prototype.receiveProps=function(e){this.handler&&(this.handler.receiveProps(e),this.receiveType(m(e)))},d.prototype.receiveType=function(e){if(this.handlerMonitor&&this.manager&&this.handlerConnector&&e!==this.currentType){this.currentType=e;var t=f(e,this.handler,this.manager),r=t.handlerId,n=t.unregister;this.handlerId=r,this.handlerMonitor.receiveHandlerId(r),this.handlerConnector.receiveHandlerId(r);var i=this.manager.getMonitor().subscribeToStateChange(this.handleChange,{handlerIds:[r]});this.disposable.setDisposable(new c.CompositeDisposable(new c.Disposable(i),new c.Disposable(n)))}},d.prototype.handleChange=function(){if(this.isCurrentlyMounted){var e=this.getCurrentState();h(e,this.state)||this.setState(e)}},d.prototype.dispose=function(){this.disposable.dispose(),this.handlerConnector&&this.handlerConnector.receiveHandlerId(null)},d.prototype.getCurrentState=function(){return this.handlerConnector?y(this.handlerConnector.hooks,this.handlerMonitor):{}},d.prototype.render=function(){var e=this;return s.createElement(a.Consumer,null,function(t){var r=t.dragDropManager;return void 0===r?null:(e.receiveDragDropManager(r),e.isCurrentlyMounted?s.createElement(w,o({},e.props,e.state,{ref:e.handler&&l(w)?e.handler.ref:void 0})):null)})},d.prototype.receiveDragDropManager=function(e){void 0===this.manager&&(this.manager=e,u("object"===typeof e,"Could not find the drag and drop manager in the context of %s. Make sure to wrap the top-level component of your app with DragDropContext. Read more: http://react-dnd.github.io/react-dnd/docs-troubleshooting.html#could-not-find-the-drag-and-drop-manager-in-the-context",S,S),this.handlerMonitor=n(e),this.handlerConnector=p(e.getBackend()),this.handler=r(this.handlerMonitor))},d.DecoratedComponent=t,d.displayName=g+"("+S+")",d}(s.Component);return d(b,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(816);function o(e){return function(t,r){if(void 0===t&&(t=null),void 0===r&&(r=null),n.isValidElement(t)){var o=t;!function(e){if("string"!==typeof e.type){var t=e.type.displayName||e.type.name||"the component";throw new Error("Only native element nodes can now be passed to React DnD connectors.You can either wrap "+t+" into a <div>, or turn it into a drag source or a drop target itself.")}}(o);var s=r?function(t){return e(t,r)}:e;return i.default(o,s)}e(t,r)}}t.default=function(e){var t={};return Object.keys(e).forEach(function(r){var n=o(e[r]);t[r]=function(){return n}}),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r){return"string"===typeof t||"symbol"===typeof t||!!r&&Array.isArray(t)&&t.every(function(t){return e(t,!1)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(359);t.isFirefox=n(function(){return/firefox/i.test(navigator.userAgent)}),t.isSafari=n(function(){return Boolean(window.safari)})},function(e,t){var r=9007199254740991,n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i=typeof e;return!!(t=null==t?r:t)&&("number"==i||"symbol"!=i&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(213),i=r(194);class BreadcrumbTreeUtils{}BreadcrumbTreeUtils.hasChildren=(e=>{const t=e;if("children"in t&&t.children&&t.children.length>0)return!0;return!!("hasChildren"in e&&e.hasChildren)}),BreadcrumbTreeUtils.aliasNodeListToTableDataProvider=((e,t)=>({onColumnsChanged:new n.TableDataChangeEvent,onRowsChanged:new n.TableDataChangeEvent,getColumns:async()=>t,getRowsCount:async()=>e.length,getRow:async(t,r)=>{if(t>e.length)return{_node:{},key:"",cells:[]};const n=e[t];if(!n)return{_node:{},key:"",cells:[]};const o={foreColor:n.labelForeColor,backColor:n.labelBackColor},s=[{key:"icon",record:new i.PropertyRecord({value:BreadcrumbTreeUtils.hasChildren(n)?"icon-folder":n.icon,valueFormat:i.PropertyValueFormat.Primitive,displayValue:BreadcrumbTreeUtils.hasChildren(n)?"icon-folder":n.icon},{name:"icon",displayLabel:"icon",typename:"icon"})},{key:"label",record:new i.PropertyRecord({value:n.label,valueFormat:i.PropertyValueFormat.Primitive,displayValue:n.label},{name:"label",displayLabel:"label",typename:"text"})},{key:"description",record:new i.PropertyRecord({value:n.description||"",valueFormat:i.PropertyValueFormat.Primitive,displayValue:n.description||""},{name:"description",displayLabel:"description",typename:"text"})}];for(const e in n.extendedData)n.extendedData.hasOwnProperty(e)&&"string"===typeof n.extendedData[e]&&s.push({key:e,record:n.extendedData[e],isBold:n.labelBold,isItalic:n.labelItalic,colorOverrides:o});return n.extendedData=n.extendedData||{},n.extendedData.label=n.label,n.extendedData.description=n.description,n.extendedData.icon=n.icon,{_node:n,key:n.id,extendedData:n.extendedData,isDisabled:!1,colorOverrides:{foreColor:n.labelForeColor,backColor:n.labelBackColor},cells:s}},sort:async()=>{}})),t.BreadcrumbTreeUtils=BreadcrumbTreeUtils},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.TableDataChangeEvent=class TableDataChangeEvent extends n.BeEvent{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(67),i=r(35);class StringTypeConverter extends n.TypeConverter{async convertToString(e){return e?e.toString():""}async convertFromString(e){return e}sortCompare(e,t,r){return r?e.toLocaleLowerCase().localeCompare(t.toLocaleLowerCase()):e.localeCompare(t)}get isStringType(){return!0}startsWith(e,t,r){return!(!e||!t)&&(r?e.substr(0,t.length)===t:e.toLocaleUpperCase().substr(0,t.length)===t.toLocaleUpperCase())}endsWith(e,t,r){if(!e||!t)return!1;const n=e.length-t.length;if(n<0)return!1;let i;return-1!==(i=r?e.indexOf(t,n):e.toLocaleUpperCase().indexOf(t.toLocaleUpperCase(),n))&&i===n}contains(e,t,r){return!(!e||!t)&&(!(t.length>e.length)&&(r?-1!==e.indexOf(t,0):-1!==e.toLocaleUpperCase().indexOf(t.toLocaleUpperCase(),0)))}doesNotContain(e,t,r){return!this.contains(e,t,r)}isContainedIn(e,t,r){return this.contains(t,e,r)}isNotContainedIn(e,t,r){return this.doesNotContain(t,e,r)}isEmpty(e){return 0===e.length}isNotEmpty(e){return!this.isEmpty(e)}}t.StringTypeConverter=StringTypeConverter,i.TypeConverterManager.registerConverter("text",StringTypeConverter)},function(e,t,r){},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__await||function(e){return this instanceof i?(this.v=e,this):new i(e)},o=this&&this.__asyncGenerator||function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){o[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||c(e,t)})})}function c(e,t){try{(r=o[e](t)).value instanceof i?Promise.resolve(r.value.v).then(l,u):d(s[0][2],r)}catch(e){d(s[0][3],e)}var r}function l(e){c("next",e)}function u(e){c("throw",e)}function d(e,t){e(t),s.shift(),s.length&&c(s[0][0],s[0][1])}},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=s(r(197)),l=s(r(1)),u=a(r(214)),d=a(r(2)),h=r(0),p=r(32),f=r(32),g=r(149),m=r(198);r(368);const y=r(215),v=r(117),_=r(375),w=r(35),S=r(861);var b;!function(e){e[e.Row=0]="Row",e[e.Cell=1]="Cell"}(b=t.TableSelectionTarget||(t.TableSelectionTarget={}));const x={columns:[],rows:[],rowsCount:0,cellEditorState:{active:!1}};class TableRowRenderer extends l.Component{render(){return this.props.rowRendererCreator()(this.props)}}t.Table=class Table extends l.Component{constructor(e,t){super(e,t),this._pageAmount=100,this._disposableListeners=new h.DisposableList,this._isMounted=!1,this._rowLoadGuid=h.Guid.createValue(),this._selectedRowIndices=new Set,this._selectedCellKeys=new Map,this._pressedItemSelected=!1,this.state=x,this._onRowsSelected=((e,t)=>{this.props.onRowsSelected&&this.props.onRowsSelected(this.createRowIterator(e),t)}),this._onRowsDeselected=(e=>{this.props.onRowsDeselected&&this.props.onRowsDeselected(this.createRowIterator(e))}),this._onCellsSelected=((e,t)=>{this.props.onCellsSelected&&this.props.onCellsSelected(this.createCellIterator(e),t)}),this._onCellsDeselected=(e=>{this.props.onCellsDeselected&&this.props.onCellsDeselected(this.createCellIterator(e))}),this._onColumnsChanged=(async()=>{await this.updateColumns(),this._cellItemSelectionHandlers=void 0}),this._onRowsChanged=(async()=>{await this.updateRows()}),this._columnDescriptionToReactDataGridColumn=(e=>{const t=void 0!==e.editable&&e.editable,r={key:e.key,name:e.label,icon:e.icon,resizable:void 0!==e.resizable&&e.resizable,sortable:void 0!==e.sortable&&e.sortable,draggable:this.props.reorderableColumns||!1};return t&&(r.events={onClick:this.cellEditOnClick.bind(this,r)}),r}),this._getCellItem=((e,t)=>e.cells.find(e=>e.key===t)||{key:t}),this._rowComponentSelectionHandler={deselectAll:()=>{this._selectedRowIndices=new Set,this._pressedItemSelected||(this._deactivateCellEditor(),this.forceUpdate())},selectBetween:(e,t)=>{const r=[],n=e>t?e:t;for(let i=e<t?e:t;i<=n;i++)this._selectedRowIndices.has(i)||(r.push(i),this._selectedRowIndices.add(i));return this.forceUpdate(),r},updateSelection:(e,t)=>{for(const r of e)this._selectedRowIndices.has(r)||this._selectedRowIndices.add(r);for(const r of t)this._selectedRowIndices.has(r)&&this._selectedRowIndices.delete(r);this.forceUpdate()},areEqual:(e,t)=>e===t},this._cellComponentSelectionHandler={deselectAll:()=>{this._selectedCellKeys=new Map,this.forceUpdate()},selectBetween:(e,t)=>{const r=[],n=e.rowIndex<t.rowIndex?e.rowIndex:t.rowIndex,i=e.rowIndex>t.rowIndex?e.rowIndex:t.rowIndex;let o,s=!1,a=!1;for(let c=n;c<=i;c++){for(const n of this.state.columns){if(!s)if(c===e.rowIndex&&n.key===e.columnKey)s=!0,o=t;else{if(c!==t.rowIndex||n.key!==t.columnKey)continue;s=!0,o=e}const i={rowIndex:c,columnKey:n.key};if(this.isCellSelected(i)||r.push(i),c===o.rowIndex&&n.key===o.columnKey){a=!0;break}}if(a)break}return this.selectCells(r),this.forceUpdate(),r},updateSelection:(e,t)=>{this.selectCells(e),this.deselectCells(t),this.forceUpdate()},areEqual:(e,t)=>e.rowIndex===t.rowIndex&&e.columnKey===t.columnKey},this._rowGetter=(e=>this.state.rows[e]?this.state.rows[e]:(this._rowGetterAsync(e-e%this._pageAmount,!1),{item:{key:"",cells:[]},index:e,cells:{}})),this._rowGetterAsync=c.memoize(async(e,t)=>{if(e<0)return;const r=Math.min(this.state.rowsCount,e+this._pageAmount),n=await this.loadRows(e,r);if(!this._isMounted)return;const i=this._selectedRowIndices;for(const o of n.selectedRowIndices)i.has(o)||i.add(o);this._selectedRowIndices=i,this.selectCells(n.selectedCellKeys),this.setState(r=>{const i=t?[]:[...r.rows];return n.rows.forEach((t,r)=>{i[e+r]=t}),{rows:i}},()=>{this.props.onRowsLoaded&&this.props.onRowsLoaded(e,e+n.rows.length-1)})}),this._handleGridSort=((e,t)=>{let r;switch(t){case"ASC":r=p.SortDirection.Ascending;break;case"DESC":r=p.SortDirection.Descending;break;case"NONE":default:r=p.SortDirection.NoSort}this.gridSortAsync(e,r)}),this._createRowRenderer=(()=>e=>{const t=this.props.renderRow?this.props.renderRow:this.renderRow,{row:r}=e,i=n(e,["row"]),o=this.createRowCells(r);if(this._tableSelectionTarget===b.Row){const n=this._rowSelectionHandler.createSelectionFunction(this._rowComponentSelectionHandler,this.createRowItemSelectionHandler(e.row.index)),s=e=>{n(e.shiftKey,e.ctrlKey)},a=t=>{this._rowSelectionHandler.createDragAction(this._rowComponentSelectionHandler,[this.rowItemSelectionHandlers],e.row.index)},c=t=>{1===t.buttons&&this._rowSelectionHandler.updateDragAction(e.row.index)},u=this._selectedRowIndices.has(e.row.index),h=t(r.item,Object.assign({},i,{cells:o,isSelected:u}));return l.createElement("div",{className:d.default("row",!u&&"is-hover-enabled"),onClickCapture:s,onMouseMove:c,onMouseDown:a},h)}return t(r.item,Object.assign({},i,{cells:o}))}),this.renderRow=((e,t)=>l.createElement(TableRow,Object.assign({key:e.key},t))),this._onMouseUp=(()=>{this._tableSelectionTarget===b.Row?this._rowSelectionHandler.completeDragAction():this._cellSelectionHandler.completeDragAction()}),this._onMouseDown=(()=>{document.addEventListener("mouseup",this._onMouseUp,{capture:!0,once:!0})}),this._onHeaderDrop=((e,t)=>{const r=[...this.state.columns],n=this.state.columns.findIndex(t=>t.key===e),i=this.state.columns.findIndex(e=>e.key===t);if(r.splice(i,0,r.splice(n,1)[0]),this.props.settingsIdentifier){const e=this.props.uiSettings||new f.LocalUiSettings,t=r.map(e=>e.key);e.saveSetting(this.props.settingsIdentifier,"ColumnReorder",t)}this.setState({columns:r})}),this._deactivateCellEditor=(()=>{this.state.cellEditorState.active&&this.setState({cellEditorState:{active:!1}})}),this._onCellCommit=(async e=>{if(this.props.onPropertyUpdated){const t={rowIndex:this.state.cellEditorState.rowIndex,colIndex:this.state.cellEditorState.colIndex,cellKey:this.state.cellEditorState.cellKey};await this.props.onPropertyUpdated(e,t)&&void 0!==this.state.cellEditorState.rowIndex&&this.state.cellEditorState.rowIndex>=0?(this._deactivateCellEditor(),await this.updateRows()):this._deactivateCellEditor()}}),e.pageAmount&&(this._pageAmount=e.pageAmount),this._disposableListeners.add(e.dataProvider.onColumnsChanged.addListener(this._onColumnsChanged)),this._disposableListeners.add(e.dataProvider.onRowsChanged.addListener(this._onRowsChanged)),this._rowSelectionHandler=new m.SelectionHandler(e.selectionMode?e.selectionMode:g.SelectionMode.Single),this._cellSelectionHandler=new m.SelectionHandler(e.selectionMode?e.selectionMode:g.SelectionMode.Single),this._rowSelectionHandler.onItemsSelectedCallback=this._onRowsSelected,this._rowSelectionHandler.onItemsDeselectedCallback=this._onRowsDeselected,this._cellSelectionHandler.onItemsSelectedCallback=this._onCellsSelected,this._cellSelectionHandler.onItemsDeselectedCallback=this._onCellsDeselected}get rowItemSelectionHandlers(){if(!this._rowItemSelectionHandlers){this._rowItemSelectionHandlers=[];for(let e=0;e<this.state.rowsCount;e++)this._rowItemSelectionHandlers.push(this.createRowItemSelectionHandler(e))}return this._rowItemSelectionHandlers}get cellItemSelectionHandlers(){if(!this._cellItemSelectionHandlers){this._cellItemSelectionHandlers=[];for(let e=0;e<this.state.rowsCount;e++){this._cellItemSelectionHandlers[e]=[];for(const t of this.state.columns)this._cellItemSelectionHandlers[e].push(this.createCellItemSelectionHandler({rowIndex:e,columnKey:t.key}))}}return this._cellItemSelectionHandlers}createRowIterator(e){return o(this,arguments,function*(){for(const t of e)yield yield i(yield i(this.props.dataProvider.getRow(t)))})}createCellIterator(e){return o(this,arguments,function*(){for(const t of e){const e=yield i(this.props.dataProvider.getRow(t.rowIndex));yield yield i([e,this._getCellItem(e,t.columnKey)])}})}get _tableSelectionTarget(){return this.props.tableSelectionTarget?this.props.tableSelectionTarget:b.Row}componentWillReceiveProps(e){this._rowSelectionHandler.selectionMode=e.selectionMode?e.selectionMode:g.SelectionMode.Single,this._cellSelectionHandler.selectionMode=e.selectionMode?e.selectionMode:g.SelectionMode.Single,this.props.dataProvider!==e.dataProvider&&(this._disposableListeners.dispose(),this._disposableListeners.add(e.dataProvider.onColumnsChanged.addListener(this._onColumnsChanged)),this._disposableListeners.add(e.dataProvider.onRowsChanged.addListener(this._onRowsChanged)))}componentDidUpdate(e){this.props.onRender&&this.props.onRender(),this.props.dataProvider!==e.dataProvider?this.update():this.props.isCellSelected===e.isCellSelected&&this.props.isRowSelected===e.isRowSelected||(this.updateSelectedRows(),this.updateSelectedCells())}componentDidMount(){this._isMounted=!0,this.props.onRender&&this.props.onRender(),this.update()}componentWillUnmount(){this._isMounted=!1,this._disposableListeners.dispose()}async updateColumns(){const e=await this.props.dataProvider.getColumns();if(!this._isMounted)return;let t=e.map(this._columnDescriptionToReactDataGridColumn);if(this.props.settingsIdentifier){const r=this.props.uiSettings||new f.LocalUiSettings,n=r.getSetting(this.props.settingsIdentifier,"ColumnReorder");if(n.status===f.UiSettingsStatus.Success){const e=n.setting;t=e.map(e=>t.filter(t=>t.key===e)[0])}else if(n.status===f.UiSettingsStatus.NotFound){const t=e.map(e=>e.key);r.saveSetting(this.props.settingsIdentifier,"ColumnReorder",t)}}this.setState(()=>({columns:t}))}async updateRows(){const e=await this.props.dataProvider.getRowsCount();this._isMounted&&(e!==this.state.rowsCount&&(this._rowItemSelectionHandlers=void 0,this._cellItemSelectionHandlers=void 0),this._rowGetterAsync.cache.clear(),this.setState(t=>Object.assign({},t,{rowsCount:e})),this._rowGetterAsync(0,!0))}async update(){await this.updateColumns(),await this.updateRows()}updateSelectedRows(){const e=new Set;if(this.props.isRowSelected)for(let t=0;t<this.state.rows.length;t++)this.state.rows[t]&&this.props.isRowSelected(this.state.rows[t].item)&&e.add(t);this._selectedRowIndices=e,this.forceUpdate()}updateSelectedCells(){const e=new Map;if(this.props.isCellSelected)for(const t of this.state.columns){const r=new Set;for(let e=0;e<this.state.rows.length;e++){if(!this.state.rows[e])continue;const n=this._getCellItem(this.state.rows[e].item,t.key);this.props.isCellSelected(e,n)&&r.add(e)}0!==r.size&&e.set(t.key,r)}this._selectedCellKeys=e,this.forceUpdate()}isCellSelected(e){const t=this._selectedCellKeys.get(e.columnKey);return!!t&&t.has(e.rowIndex)}selectCells(e){for(const t of e){let e=this._selectedCellKeys.get(t.columnKey);e||(e=new Set,this._selectedCellKeys.set(t.columnKey,e)),e.add(t.rowIndex)}}deselectCells(e){for(const t of e){const e=this._selectedCellKeys.get(t.columnKey);e&&e.delete(t.rowIndex)}}createRowItemSelectionHandler(e){return{preselect:()=>{this._pressedItemSelected=this._selectedRowIndices.has(e)},select:()=>{this._selectedRowIndices.has(e)||(this._selectedRowIndices.add(e),this._pressedItemSelected||this.forceUpdate())},deselect:()=>{this._selectedRowIndices.has(e)&&(this._selectedRowIndices.delete(e),this.forceUpdate())},isSelected:()=>this._selectedRowIndices.has(e),item:()=>e}}createCellItemSelectionHandler(e){return{preselect:()=>{this._pressedItemSelected=this.isCellSelected(e)},select:()=>{this.selectCells([e]),this.forceUpdate()},deselect:()=>{this.deselectCells([e]),this.forceUpdate()},isSelected:()=>this.isCellSelected(e),item:()=>e}}async createCellRenderer(e,t,r){if(!e.record)return()=>void 0;if(t.icon)return()=>l.createElement(IconCell,{value:r});const n={containerType:v.PropertyContainerType.Table};let i;return i=this.props.propertyValueRendererManager?await this.props.propertyValueRendererManager.render(e.record,n):await v.PropertyValueRendererManager.defaultManager.render(e.record,n),()=>i}async getCellDisplayValue(e){if(!e.record||e.record.value.valueFormat!==_.PropertyValueFormat.Primitive)return"";const t=e.record.value.value;if(void 0===t)return"";const r=await w.TypeConverterManager.getConverter(e.record.property.typename).convertPropertyToString(e.record.property,t);return r||""}async createPropsForRowItem(e,t){const r={};for(const n of this.state.columns){const t=this._getCellItem(e,n.key),i=await this.getCellDisplayValue(t);r[n.key]={item:t,displayValue:i,render:await this.createCellRenderer(t,n,i)}}return{item:e,index:t,cells:r,render:void 0}}async loadRows(e,t){const r={rows:[],selectedRowIndices:[],selectedCellKeys:[]};this._rowLoadGuid=h.Guid.createValue();const n=this._rowLoadGuid,i=new Array;for(let o=e;o<t;++o)i.push(this.props.dataProvider.getRow(o).then(e=>this.createPropsForRowItem(e,o).then(e=>e)));try{r.rows=await Promise.all(i)}catch(e){}if(n===this._rowLoadGuid)for(const o of r.rows)if(this.props.isRowSelected&&this.props.isRowSelected(o.item)&&r.selectedRowIndices.push(o.index),this.props.isCellSelected)for(const e of this.state.columns){const t=this._getCellItem(o.item,e.key);this.props.isCellSelected(o.index,t)&&r.selectedCellKeys.push({rowIndex:o.index,columnKey:e.key})}return r}getColumnIndexFromKey(e){let t=-1;for(let r=0;r<this.state.columns.length;r++)if(this.state.columns[r].key===e){t=r;break}return t}async gridSortAsync(e,t){let r=this.getColumnIndexFromKey(e);if(!(r<0)){for(let t=0;t<this.state.columns.length;t++)if(this.state.columns[t].key===e){r=t;break}await this.props.dataProvider.sort(r,t),this._isMounted&&this.updateRows()}}createRowCells(e){const t={};let r=-1;for(const n of this.state.columns){r++;const i=e.cells[n.key];if(!i)continue;const o=i.render(),s=this.state.cellEditorState.active&&this.state.cellEditorState.rowIndex===e.index&&this.state.cellEditorState.colIndex===r;if(this._tableSelectionTarget===b.Cell){const r={rowIndex:e.index,columnKey:n.key},i=this.createCellItemSelectionHandler(r),s=this._cellSelectionHandler.createSelectionFunction(this._cellComponentSelectionHandler,i),a=e=>s(e.shiftKey,e.ctrlKey),c=e=>{1===e.buttons&&this._cellSelectionHandler.updateDragAction(r)},u=()=>{this._cellSelectionHandler.createDragAction(this._cellComponentSelectionHandler,this.cellItemSelectionHandlers,r)},h=d.default("cell",this.isCellSelected(r)?"is-selected":"is-hover-enabled");t[n.key]=l.createElement("div",{className:h,onClick:a,onMouseMove:c,onMouseDown:u},o)}else s&&i.item.record?t[n.key]=l.createElement(y.EditorContainer,{propertyRecord:i.item.record,title:i.displayValue,onCommit:this._onCellCommit,onCommitCancel:this._deactivateCellEditor}):t[n.key]=l.createElement("div",{className:"cell",title:i.displayValue},o)}return t}cellEditOnClick(e,t,r){let n=!1;this._selectedRowIndices.has(r.rowIdx)&&this._pressedItemSelected&&(n=!0),n?this.activateCellEditor(r.rowIdx,r.idx,e.key):this._deactivateCellEditor()}activateCellEditor(e,t,r){const n={active:!0,rowIndex:e,colIndex:t,cellKey:r};n!==this.state.cellEditorState&&this.setState({cellEditorState:n},()=>{this.props.onPropertyEditing&&this.props.onPropertyEditing(n)})}shouldComponentUpdate(e){return!0}render(){const e=l.createElement(TableRowRenderer,{rowRendererCreator:()=>this._createRowRenderer()});return l.createElement("div",{className:"react-data-grid-wrapper",onMouseDown:this._onMouseDown},l.createElement(u.default,Object.assign({columns:this.state.columns,rowGetter:this._rowGetter,rowRenderer:e,rowsCount:this.state.rowsCount},this.props.reorderableColumns?{draggableHeaderCell:S.DragDropHeaderCell,onHeaderDrop:this._onHeaderDrop}:{},{enableCellSelect:!0,minHeight:500,headerRowHeight:25,rowHeight:25,onGridSort:this._handleGridSort})))}};class IconCell extends l.Component{render(){return l.createElement("div",{className:`icon ${this.props.value}`})}}t.IconCell=IconCell;class TableRow extends l.Component{render(){const e=this.props,{cells:t,isSelected:r}=e,i=n(e,["cells","isSelected"]);return l.createElement(u.default.Row,Object.assign({},i,{row:t,isSelected:r}))}}t.TableRow=TableRow},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(371);class PropertyEditorBase{constructor(){this.customDataController=void 0}applyEditorParams(e,t){}commitValue(e,t){return this.customDataController?this.customDataController.commitValue(e,t):Promise.resolve({encounteredError:!1})}validateValue(e,t){return this.customDataController?this.customDataController.validateValue(e,t):Promise.resolve({encounteredError:!1})}}t.PropertyEditorBase=PropertyEditorBase;t.DataControllerBase=class DataControllerBase{commitValue(e,t){return Promise.resolve({encounteredError:!1})}validateValue(e,t){return Promise.resolve({encounteredError:!1})}};class PropertyEditorManager{static registerEditor(e,t,r){let n=e;if(r&&(n+=":"+r),PropertyEditorManager._editors.hasOwnProperty(n)){const e=PropertyEditorManager._editors[n].name;throw Error("PropertyEditorManager.registerEditor error: type '"+n+"' already registered to '"+e+"'")}PropertyEditorManager._editors[n]=t}static registerDataController(e,t){if(PropertyEditorManager._dataControllers.hasOwnProperty(e))throw Error("PropertyEditorManager.RegisterDataController error: type '"+e+"' already registered to '"+(typeof PropertyEditorManager._dataControllers[e]).toString()+"'");PropertyEditorManager._dataControllers[e]=t}static createEditor(e,t,r){let n,i=e;return t&&(i+=":"+t),n=PropertyEditorManager._editors.hasOwnProperty(i)?new PropertyEditorManager._editors[i]:PropertyEditorManager._editors.hasOwnProperty(e)?new PropertyEditorManager._editors[e]:new BasicPropertyEditor,r&&PropertyEditorManager._dataControllers.hasOwnProperty(r)&&(n.customDataController=new PropertyEditorManager._dataControllers[r]),n}static hasCustomEditor(e,t){const r=e+":"+t;return PropertyEditorManager._editors.hasOwnProperty(r)}}PropertyEditorManager._editors={},PropertyEditorManager._dataControllers={},t.PropertyEditorManager=PropertyEditorManager;class BasicPropertyEditor extends PropertyEditorBase{get reactElement(){return i.createElement(o.TextEditor,null)}}t.BasicPropertyEditor=BasicPropertyEditor,PropertyEditorManager.registerEditor("text",BasicPropertyEditor),PropertyEditorManager.registerEditor("string",BasicPropertyEditor)},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(1)),s=i(r(2)),a=r(66),c=r(35);r(854);t.TextEditor=class TextEditor extends o.Component{constructor(){super(...arguments),this._input=null,this._isMounted=!1,this.state={inputValue:""},this._updateInputValue=(e=>{this._isMounted&&this.setState({inputValue:e.target.value})})}getValue(){return this.state.inputValue}getInputNode(){return this._input}componentDidMount(){this._isMounted=!0,this.getInitialValue()}componentWillUnmount(){this._isMounted=!1}async getInitialValue(){const e=this.props.value;let t="";if(e&&e.value.valueFormat===a.PropertyValueFormat.Primitive){const r=e.value.value;t=await c.TypeConverterManager.getConverter(e.property.typename).convertPropertyToString(e.property,r)}this._isMounted&&this.setState(()=>({inputValue:t}),()=>{this._input&&(this._input.focus(),this._input.select())})}render(){const e=s.default("cell","components-cell-editor","components-text-editor");return o.createElement("input",{ref:e=>this._input=e,type:"text",onBlur:this.props.onBlur,className:e,defaultValue:this.state.inputValue,onChange:this._updateInputValue})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(66),i=r(35);t.PrimitivePropertyValueRenderer=class PrimitivePropertyValueRenderer{canRender(e){return e.value.valueFormat===n.PropertyValueFormat.Primitive}async render(e){const t=e.value.value;return void 0!==t?await i.TypeConverterManager.getConverter(e.property.typename).convertPropertyToString(e.property,t):""}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(117),o=r(66),s=n(r(1)),a=r(216);t.ArrayPropertyValueRenderer=class ArrayPropertyValueRenderer{canRender(e){return e.value.valueFormat===o.PropertyValueFormat.Array}async render(e,t){const r=e.value.items;if(t)switch(t.containerType){case i.PropertyContainerType.PropertyPane:return s.default.createElement(a.PropertyList,{orientation:t.orientation?t.orientation:0,properties:r})}return 0!==r.length?`${r[0].property.typename}[${r.length}]`:"[]"}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(117),s=r(66),a=r(216);t.StructPropertyValueRenderer=class StructPropertyValueRenderer{canRender(e){return e.value.valueFormat===s.PropertyValueFormat.Struct}async render(e,t){const r=e.value.members,n=new Array;for(const i in r)r.hasOwnProperty(i)&&n.push(r[i]);if(t)switch(t.containerType){case o.PropertyContainerType.PropertyPane:return i.default.createElement(a.PropertyList,{orientation:t.orientation?t.orientation:0,properties:n})}return`{${e.property.typename}}`}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(858)),n(r(859)),n(r(66)),n(r(117)),n(r(860))},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1));r(882);t.ResultSelector=class ResultSelector extends i.Component{constructor(e){super(e),this._onClickPrevious=(()=>{this.state.selectedResultInEditMode?this._onSelectedResultConfirmed():this.state.selectedResultId>1&&(this.props.onSelectedChanged(this.state.selectedResultId-1),this.setState(e=>({selectedResultId:e.selectedResultId-1})))}),this._onClickNext=(()=>{this.state.selectedResultInEditMode?this._onSelectedResultConfirmed():this.state.selectedResultId<this.props.resultCount&&(this.props.onSelectedChanged(this.state.selectedResultId+1),this.setState(e=>({selectedResultId:e.selectedResultId+1})))}),this._onSelectedResultChanged=(e=>{e.target.value.length<=this._maxSelectedResultInputLength&&this.setState({selectedResultEdit:e.target.value})}),this._onSelectedResultConfirmed=(()=>{let e=+this.state.selectedResultEdit;e>this.props.resultCount?e=this.props.resultCount:e<1&&(e=1),this.setState({selectedResultInEditMode:!1,selectedResultId:e}),this.props.onSelectedChanged(e)}),this._onSelectedResultClick=(()=>{this.setState(e=>({selectedResultInEditMode:!0,selectedResultEdit:e.selectedResultId.toString()}))}),this._onSelectedResultKeyDown=(e=>{13===e.keyCode&&this._onSelectedResultConfirmed()}),this.state={selectedResultId:e.resultCount?1:0,selectedResultEdit:"",selectedResultInEditMode:!1}}get _maxSelectedResultInputLength(){return this.props.resultCount.toString().length}componentDidMount(){this.props.onSelectedChanged(this.props.resultCount?1:0)}componentDidUpdate(e){this.props.resultCount!==e.resultCount&&this.props.onSelectedChanged(this.props.resultCount?1:0)}render(){return i.createElement("span",{className:"result-selector"},i.createElement("button",{className:"result-selector-button icon icon-chevron-left",onClick:this._onClickPrevious,disabled:this.props.resultCount<=0}),i.createElement("span",{style:{pointerEvents:this.props.resultCount?"auto":"none"},className:"result-selector-current-result",onClick:this._onSelectedResultClick},this.state.selectedResultInEditMode?i.createElement("input",{type:"number",style:{width:`${.6*this.state.selectedResultEdit.length+1}em`},value:this.state.selectedResultEdit,onChange:this._onSelectedResultChanged,onBlur:this._onSelectedResultConfirmed,onKeyDown:this._onSelectedResultKeyDown}):this.state.selectedResultId,i.createElement("span",{style:{marginLeft:"5px",marginRight:"5px"}},"of"),i.createElement("span",null,this.props.resultCount)),i.createElement("button",{className:"result-selector-button icon icon-chevron-right",onClick:this._onClickNext,disabled:this.props.resultCount<=0}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.PropertyDataChangeEvent=class PropertyDataChangeEvent extends n.BeEvent{}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(68),i=r(32),o=r(3);class CubeRotationChangeEvent extends i.UiEvent{}t.CubeRotationChangeEvent=CubeRotationChangeEvent;class StandardRotationChangeEvent extends i.UiEvent{}t.StandardRotationChangeEvent=StandardRotationChangeEvent;class ViewRotationChangeEvent extends i.UiEvent{}t.ViewRotationChangeEvent=ViewRotationChangeEvent;class ViewRotationCube{static initialize(){void 0===this._removeListener&&(this._removeListener=n.IModelApp.viewManager.onSelectedViewportChanged.addListener(t=>{e(()=>{t.current&&ViewRotationCube.setViewMatrix(t.current)})}))}static setCubeMatrix(e,t){this.rMatrix.setFrom(e),this.cubeRotationChangeEvent.emit({rotMatrix:e,animationTime:t})}static setStandardRotation(e){this.standardRotationChangeEvent.emit({standardRotation:e})}static setViewMatrix(e,t){this.rMatrix.setFrom(e.rotation),this.viewRotationChangeEvent.emit({viewport:e,animationTime:t})}}ViewRotationCube.rMatrix=o.Matrix3d.createIdentity(),ViewRotationCube.cubeRotationChangeEvent=new CubeRotationChangeEvent,ViewRotationCube.standardRotationChangeEvent=new StandardRotationChangeEvent,ViewRotationCube.viewRotationChangeEvent=new ViewRotationChangeEvent,t.ViewRotationCube=ViewRotationCube}).call(this,r(241).setImmediate)},,function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"===typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.d(t,"a",function(){return n})},,function(e,t,r){"use strict";"undefined"===typeof Promise&&(r(383).enable(),window.Promise=r(384)),r(385),Object.assign=r(160)},function(e,t,r){"use strict";var n=r(218),i=[ReferenceError,TypeError,RangeError],o=!1;function s(){o=!1,n._l=null,n._m=null}function a(e,t){return t.some(function(t){return e instanceof t})}t.disable=s,t.enable=function(e){e=e||{},o&&s();o=!0;var t=0,r=0,c={};function l(t){(e.allRejections||a(c[t].error,e.whitelist||i))&&(c[t].displayId=r++,e.onUnhandled?(c[t].logged=!0,e.onUnhandled(c[t].displayId,c[t].error)):(c[t].logged=!0,function(e,t){console.warn("Possible Unhandled Promise Rejection (id: "+e+"):"),((t&&(t.stack||t))+"").split("\n").forEach(function(e){console.warn("  "+e)})}(c[t].displayId,c[t].error)))}n._l=function(t){var r;2===t._i&&c[t._o]&&(c[t._o].logged?(r=t._o,c[r].logged&&(e.onHandled?e.onHandled(c[r].displayId,c[r].error):c[r].onUnhandled||(console.warn("Promise Rejection Handled (id: "+c[r].displayId+"):"),console.warn('  This means you can ignore any previous messages of the form "Possible Unhandled Promise Rejection" with id '+c[r].displayId+".")))):clearTimeout(c[t._o].timeout),delete c[t._o])},n._m=function(e,r){0===e._h&&(e._o=t++,c[e._o]={displayId:null,error:r,timeout:setTimeout(l.bind(null,e._o),a(r,i)?100:2e3),logged:!1})}}},function(e,t,r){"use strict";var n=r(218);e.exports=n;var i=u(!0),o=u(!1),s=u(null),a=u(void 0),c=u(0),l=u("");function u(e){var t=new n(n._n);return t._i=1,t._j=e,t}n.resolve=function(e){if(e instanceof n)return e;if(null===e)return s;if(void 0===e)return a;if(!0===e)return i;if(!1===e)return o;if(0===e)return c;if(""===e)return l;if("object"===typeof e||"function"===typeof e)try{var t=e.then;if("function"===typeof t)return new n(t.bind(e))}catch(e){return new n(function(t,r){r(e)})}return u(e)},n.all=function(e){var t=Array.prototype.slice.call(e);return new n(function(e,r){if(0===t.length)return e([]);var i=t.length;function o(s,a){if(a&&("object"===typeof a||"function"===typeof a)){if(a instanceof n&&a.then===n.prototype.then){for(;3===a._i;)a=a._j;return 1===a._i?o(s,a._j):(2===a._i&&r(a._j),void a.then(function(e){o(s,e)},r))}var c=a.then;if("function"===typeof c)return void new n(c.bind(a)).then(function(e){o(s,e)},r)}t[s]=a,0===--i&&e(t)}for(var s=0;s<t.length;s++)o(s,t[s])})},n.reject=function(e){return new n(function(t,r){r(e)})},n.race=function(e){return new n(function(t,r){e.forEach(function(e){n.resolve(e).then(t,r)})})},n.prototype.catch=function(e){return this.then(null,e)}},function(e,t){!function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=function(e){return e&&DataView.prototype.isPrototypeOf(e)},i=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};u.prototype.append=function(e,t){e=a(e),t=c(t);var r=this.map[e];this.map[e]=r?r+","+t:t},u.prototype.delete=function(e){delete this.map[a(e)]},u.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},u.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},u.prototype.set=function(e,t){this.map[a(e)]=c(t)},u.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),l(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),l(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),l(e)},t.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},g.call(m.prototype),g.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var s=[301,302,303,307,308];v.redirect=function(e,t){if(-1===s.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=u,e.Request=m,e.Response=v,e.fetch=function(e,r){return new Promise(function(n,i){var o=new m(e,r),s=new XMLHttpRequest;s.onload=function(){var e,t,r={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new u,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}}),t)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;n(new v(i,r))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&t.blob&&(s.responseType="blob"),o.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send("undefined"===typeof o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}function a(e){if("string"!==typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!==typeof e&&(e=String(e)),e}function l(e){var r={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(r[Symbol.iterator]=function(){return r}),r}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function p(e){var t=new FileReader,r=h(t);return t.readAsArrayBuffer(e),r}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"===typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&n(e))this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!i(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=f(e)}else this._bodyText="";this.headers.get("content-type")||("string"===typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var e,t,r,n=d(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=h(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}function m(e,t){var r,n,i=(t=t||{}).body;if(e instanceof m){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new u(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),o.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function y(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function v(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!==typeof self?self:this)},,function(e,t,r){"use strict";var n=r(160),i="function"===typeof Symbol&&Symbol.for,o=i?Symbol.for("react.element"):60103,s=i?Symbol.for("react.portal"):60106,a=i?Symbol.for("react.fragment"):60107,c=i?Symbol.for("react.strict_mode"):60108,l=i?Symbol.for("react.profiler"):60114,u=i?Symbol.for("react.provider"):60109,d=i?Symbol.for("react.context"):60110,h=i?Symbol.for("react.async_mode"):60111,p=i?Symbol.for("react.forward_ref"):60112;i&&Symbol.for("react.placeholder");var f="function"===typeof Symbol&&Symbol.iterator;function g(e){for(var t=arguments.length-1,r="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=0;n<t;n++)r+="&args[]="+encodeURIComponent(arguments[n+1]);!function(e,t,r,n,i,o,s,a){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,i,o,s,a],l=0;(e=Error(t.replace(/%s/g,function(){return c[l++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",r)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y={};function v(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||m}function _(){}function w(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||m}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){"object"!==typeof e&&"function"!==typeof e&&null!=e&&g("85"),this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=v.prototype;var S=w.prototype=new _;S.constructor=w,n(S,v.prototype),S.isPureReactComponent=!0;var b={current:null,currentDispatcher:null},x=Object.prototype.hasOwnProperty,P={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var n=void 0,i={},s=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)x.call(t,n)&&!P.hasOwnProperty(n)&&(i[n]=t[n]);var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}if(e&&e.defaultProps)for(n in c=e.defaultProps)void 0===i[n]&&(i[n]=c[n]);return{$$typeof:o,type:e,key:s,ref:a,props:i,_owner:b.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===o}var M=/\/+/g,E=[];function I(e,t,r,n){if(E.length){var i=E.pop();return i.result=e,i.keyPrefix=t,i.func=r,i.context=n,i.count=0,i}return{result:e,keyPrefix:t,func:r,context:n,count:0}}function A(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>E.length&&E.push(e)}function R(e,t,r){return null==e?0:function e(t,r,n,i){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var c=!1;if(null===t)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(t.$$typeof){case o:case s:c=!0}}if(c)return n(i,t,""===r?"."+O(t,0):r),1;if(c=0,r=""===r?".":r+":",Array.isArray(t))for(var l=0;l<t.length;l++){var u=r+O(a=t[l],l);c+=e(a,u,n,i)}else if(u=null===t||"object"!==typeof t?null:"function"===typeof(u=f&&t[f]||t["@@iterator"])?u:null,"function"===typeof u)for(t=u.call(t),l=0;!(a=t.next()).done;)c+=e(a=a.value,u=r+O(a,l++),n,i);else"object"===a&&g("31","[object Object]"===(n=""+t)?"object with keys {"+Object.keys(t).join(", ")+"}":n,"");return c}(e,"",t,r)}function O(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function D(e,t){e.func.call(e.context,t,e.count++)}function k(e,t,r){var n=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?F(e,n,r,function(e){return e}):null!=e&&(T(e)&&(e=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(M,"$&/")+"/")+r)),n.push(e))}function F(e,t,r,n,i){var o="";null!=r&&(o=(""+r).replace(M,"$&/")+"/"),R(e,k,t=I(t,o,n,i)),A(t)}var N={Children:{map:function(e,t,r){if(null==e)return e;var n=[];return F(e,n,null,t,r),n},forEach:function(e,t,r){if(null==e)return e;R(e,D,t=I(null,null,t,r)),A(t)},count:function(e){return R(e,function(){return null},null)},toArray:function(e){var t=[];return F(e,t,null,function(e){return e}),t},only:function(e){return T(e)||g("143"),e}},createRef:function(){return{current:null}},Component:v,PureComponent:w,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,Provider:null,Consumer:null,unstable_read:null}).Provider={$$typeof:u,_context:e},e.Consumer=e,e.unstable_read=function(e,t){var r=b.currentDispatcher;return null===r&&g("277"),r.readContext(e,t)}.bind(null,e),e},forwardRef:function(e){return{$$typeof:p,render:e}},Fragment:a,StrictMode:c,unstable_AsyncMode:h,unstable_Profiler:l,createElement:C,cloneElement:function(e,t,r){(null===e||void 0===e)&&g("267",e);var i=void 0,s=n({},e.props),a=e.key,c=e.ref,l=e._owner;if(null!=t){void 0!==t.ref&&(c=t.ref,l=b.current),void 0!==t.key&&(a=""+t.key);var u=void 0;for(i in e.type&&e.type.defaultProps&&(u=e.type.defaultProps),t)x.call(t,i)&&!P.hasOwnProperty(i)&&(s[i]=void 0===t[i]&&void 0!==u?u[i]:t[i])}if(1===(i=arguments.length-2))s.children=r;else if(1<i){u=Array(i);for(var d=0;d<i;d++)u[d]=arguments[d+2];s.children=u}return{$$typeof:o,type:e.type,key:a,ref:c,props:s,_owner:l}},createFactory:function(e){var t=C.bind(null,e);return t.type=e,t},isValidElement:T,version:"16.5.2",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:b,assign:n}},L={default:N},B=L&&N||L;e.exports=B.default||B},function(e,t,r){"use strict";var n=r(1),i=r(160),o=r(389);function s(e){for(var t=arguments.length-1,r="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=0;n<t;n++)r+="&args[]="+encodeURIComponent(arguments[n+1]);!function(e,t,r,n,i,o,s,a){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,i,o,s,a],l=0;(e=Error(t.replace(/%s/g,function(){return c[l++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",r)}n||s("227");var a=!1,c=null,l=!1,u=null,d={onError:function(e){a=!0,c=e}};function h(e,t,r,n,i,o,s,l,u){a=!1,c=null,function(e,t,r,n,i,o,s,a,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(e){this.onError(e)}}.apply(d,arguments)}var p=null,f={};function g(){if(p)for(var e in f){var t=f[e],r=p.indexOf(e);if(-1<r||s("96",e),!y[r])for(var n in t.extractEvents||s("97",e),y[r]=t,r=t.eventTypes){var i=void 0,o=r[n],a=t,c=n;v.hasOwnProperty(c)&&s("99",c),v[c]=o;var l=o.phasedRegistrationNames;if(l){for(i in l)l.hasOwnProperty(i)&&m(l[i],a,c);i=!0}else o.registrationName?(m(o.registrationName,a,c),i=!0):i=!1;i||s("98",n,e)}}}function m(e,t,r){_[e]&&s("100",e),_[e]=t,w[e]=t.eventTypes[r].dependencies}var y=[],v={},_={},w={},S=null,b=null,x=null;function P(e,t,r,n){t=e.type||"unknown-event",e.currentTarget=x(n),function(e,t,r,n,i,o,d,p,f){if(h.apply(this,arguments),a){if(a){var g=c;a=!1,c=null}else s("198"),g=void 0;l||(l=!0,u=g)}}(t,r,void 0,e),e.currentTarget=null}function C(e,t){return null==t&&s("30"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function T(e,t,r){Array.isArray(e)?e.forEach(t,r):e&&t.call(r,e)}var M=null;function E(e,t){if(e){var r=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(r))for(var i=0;i<r.length&&!e.isPropagationStopped();i++)P(e,t,r[i],n[i]);else r&&P(e,t,r,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function I(e){return E(e,!0)}function A(e){return E(e,!1)}var R={injectEventPluginOrder:function(e){p&&s("101"),p=Array.prototype.slice.call(e),g()},injectEventPluginsByName:function(e){var t,r=!1;for(t in e)if(e.hasOwnProperty(t)){var n=e[t];f.hasOwnProperty(t)&&f[t]===n||(f[t]&&s("102",t),f[t]=n,r=!0)}r&&g()}};function O(e,t){var r=e.stateNode;if(!r)return null;var n=S(r);if(!n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}return e?null:(r&&"function"!==typeof r&&s("231",t,typeof r),r)}function D(e,t){if(null!==e&&(M=C(M,e)),e=M,M=null,e&&(T(e,t?I:A),M&&s("95"),l))throw t=u,l=!1,u=null,t}var k=Math.random().toString(36).slice(2),F="__reactInternalInstance$"+k,N="__reactEventHandlers$"+k;function L(e){if(e[F])return e[F];for(;!e[F];){if(!e.parentNode)return null;e=e.parentNode}return 7===(e=e[F]).tag||8===e.tag?e:null}function B(e){return!(e=e[F])||7!==e.tag&&8!==e.tag?null:e}function V(e){if(7===e.tag||8===e.tag)return e.stateNode;s("33")}function U(e){return e[N]||null}function z(e){do{e=e.return}while(e&&7!==e.tag);return e||null}function j(e,t,r){(t=O(e,r.dispatchConfig.phasedRegistrationNames[t]))&&(r._dispatchListeners=C(r._dispatchListeners,t),r._dispatchInstances=C(r._dispatchInstances,e))}function G(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,r=[];t;)r.push(t),t=z(t);for(t=r.length;0<t--;)j(r[t],"captured",e);for(t=0;t<r.length;t++)j(r[t],"bubbled",e)}}function H(e,t,r){e&&r&&r.dispatchConfig.registrationName&&(t=O(e,r.dispatchConfig.registrationName))&&(r._dispatchListeners=C(r._dispatchListeners,t),r._dispatchInstances=C(r._dispatchInstances,e))}function q(e){e&&e.dispatchConfig.registrationName&&H(e._targetInst,null,e)}function W(e){T(e,G)}var J=!("undefined"===typeof window||!window.document||!window.document.createElement);function X(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Y={animationend:X("Animation","AnimationEnd"),animationiteration:X("Animation","AnimationIteration"),animationstart:X("Animation","AnimationStart"),transitionend:X("Transition","TransitionEnd")},K={},Z={};function Q(e){if(K[e])return K[e];if(!Y[e])return e;var t,r=Y[e];for(t in r)if(r.hasOwnProperty(t)&&t in Z)return K[e]=r[t];return e}J&&(Z=document.createElement("div").style,"AnimationEvent"in window||(delete Y.animationend.animation,delete Y.animationiteration.animation,delete Y.animationstart.animation),"TransitionEvent"in window||delete Y.transitionend.transition);var $=Q("animationend"),ee=Q("animationiteration"),te=Q("animationstart"),re=Q("transitionend"),ne="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ie=null,oe=null,se=null;function ae(){if(se)return se;var e,t,r=oe,n=r.length,i="value"in ie?ie.value:ie.textContent,o=i.length;for(e=0;e<n&&r[e]===i[e];e++);var s=n-e;for(t=1;t<=s&&r[n-t]===i[o-t];t++);return se=i.slice(e,1<t?1-t:void 0)}function ce(){return!0}function le(){return!1}function ue(e,t,r,n){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=r,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(r):"target"===i?this.target=n:this[i]=r[i]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ce:le,this.isPropagationStopped=le,this}function de(e,t,r,n){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,r,n),i}return new this(e,t,r,n)}function he(e){e instanceof this||s("279"),e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function pe(e){e.eventPool=[],e.getPooled=de,e.release=he}i(ue.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ce)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ce)},persist:function(){this.isPersistent=ce},isPersistent:le,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=le,this._dispatchInstances=this._dispatchListeners=null}}),ue.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},ue.extend=function(e){function t(){}function r(){return n.apply(this,arguments)}var n=this;t.prototype=n.prototype;var o=new t;return i(o,r.prototype),r.prototype=o,r.prototype.constructor=r,r.Interface=i({},n.Interface,e),r.extend=n.extend,pe(r),r},pe(ue);var fe=ue.extend({data:null}),ge=ue.extend({data:null}),me=[9,13,27,32],ye=J&&"CompositionEvent"in window,ve=null;J&&"documentMode"in document&&(ve=document.documentMode);var _e=J&&"TextEvent"in window&&!ve,we=J&&(!ye||ve&&8<ve&&11>=ve),Se=String.fromCharCode(32),be={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},xe=!1;function Pe(e,t){switch(e){case"keyup":return-1!==me.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function Ce(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Te=!1;var Me={eventTypes:be,extractEvents:function(e,t,r,n){var i=void 0,o=void 0;if(ye)e:{switch(e){case"compositionstart":i=be.compositionStart;break e;case"compositionend":i=be.compositionEnd;break e;case"compositionupdate":i=be.compositionUpdate;break e}i=void 0}else Te?Pe(e,r)&&(i=be.compositionEnd):"keydown"===e&&229===r.keyCode&&(i=be.compositionStart);return i?(we&&"ko"!==r.locale&&(Te||i!==be.compositionStart?i===be.compositionEnd&&Te&&(o=ae()):(oe="value"in(ie=n)?ie.value:ie.textContent,Te=!0)),i=fe.getPooled(i,t,r,n),o?i.data=o:null!==(o=Ce(r))&&(i.data=o),W(i),o=i):o=null,(e=_e?function(e,t){switch(e){case"compositionend":return Ce(t);case"keypress":return 32!==t.which?null:(xe=!0,Se);case"textInput":return(e=t.data)===Se&&xe?null:e;default:return null}}(e,r):function(e,t){if(Te)return"compositionend"===e||!ye&&Pe(e,t)?(e=ae(),se=oe=ie=null,Te=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return we&&"ko"!==t.locale?null:t.data;default:return null}}(e,r))?((t=ge.getPooled(be.beforeInput,t,r,n)).data=e,W(t)):t=null,null===o?t:null===t?o:[o,t]}},Ee=null,Ie=null,Ae=null;function Re(e){if(e=b(e)){"function"!==typeof Ee&&s("280");var t=S(e.stateNode);Ee(e.stateNode,e.type,t)}}function Oe(e){Ie?Ae?Ae.push(e):Ae=[e]:Ie=e}function De(){if(Ie){var e=Ie,t=Ae;if(Ae=Ie=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function ke(e,t){return e(t)}function Fe(e,t,r){return e(t,r)}function Ne(){}var Le=!1;function Be(e,t){if(Le)return e(t);Le=!0;try{return ke(e,t)}finally{Le=!1,(null!==Ie||null!==Ae)&&(Ne(),De())}}var Ve={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ue(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ve[e.type]:"textarea"===t}function ze(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function je(e){if(!J)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"===typeof t[e]),t}function Ge(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function He(e){e._valueTracker||(e._valueTracker=function(e){var t=Ge(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var i=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function qe(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=Ge(e)?e.checked?"true":"false":e.value),(e=n)!==r&&(t.setValue(e),!0)}var We=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Je=/^(.*)[\\\/]/,Xe="function"===typeof Symbol&&Symbol.for,Ye=Xe?Symbol.for("react.element"):60103,Ke=Xe?Symbol.for("react.portal"):60106,Ze=Xe?Symbol.for("react.fragment"):60107,Qe=Xe?Symbol.for("react.strict_mode"):60108,$e=Xe?Symbol.for("react.profiler"):60114,et=Xe?Symbol.for("react.provider"):60109,tt=Xe?Symbol.for("react.context"):60110,rt=Xe?Symbol.for("react.async_mode"):60111,nt=Xe?Symbol.for("react.forward_ref"):60112,it=Xe?Symbol.for("react.placeholder"):60113,ot="function"===typeof Symbol&&Symbol.iterator;function st(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=ot&&e[ot]||e["@@iterator"])?e:null}function at(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case rt:return"AsyncMode";case Ze:return"Fragment";case Ke:return"Portal";case $e:return"Profiler";case Qe:return"StrictMode";case it:return"Placeholder"}if("object"===typeof e){switch(e.$$typeof){case tt:return"Context.Consumer";case et:return"Context.Provider";case nt:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef")}if("function"===typeof e.then&&(e=1===e._reactStatus?e._reactResult:null))return at(e)}return null}function ct(e){var t="";do{e:switch(e.tag){case 4:case 0:case 1:case 2:case 3:case 7:case 10:var r=e._debugOwner,n=e._debugSource,i=at(e.type),o=null;r&&(o=at(r.type)),r=i,i="",n?i=" (at "+n.fileName.replace(Je,"")+":"+n.lineNumber+")":o&&(i=" (created by "+o+")"),o="\n    in "+(r||"Unknown")+i;break e;default:o=""}t+=o,e=e.return}while(e);return t}var lt=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ut=Object.prototype.hasOwnProperty,dt={},ht={};function pt(e,t,r,n,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t}var ft={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ft[e]=new pt(e,0,!1,e,null)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ft[t]=new pt(t,1,!1,e[1],null)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){ft[e]=new pt(e,2,!1,e.toLowerCase(),null)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ft[e]=new pt(e,2,!1,e,null)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ft[e]=new pt(e,3,!1,e.toLowerCase(),null)}),["checked","multiple","muted","selected"].forEach(function(e){ft[e]=new pt(e,3,!0,e,null)}),["capture","download"].forEach(function(e){ft[e]=new pt(e,4,!1,e,null)}),["cols","rows","size","span"].forEach(function(e){ft[e]=new pt(e,6,!1,e,null)}),["rowSpan","start"].forEach(function(e){ft[e]=new pt(e,5,!1,e.toLowerCase(),null)});var gt=/[\-:]([a-z])/g;function mt(e){return e[1].toUpperCase()}function yt(e,t,r,n){var i=ft.hasOwnProperty(t)?ft[t]:null;(null!==i?0===i.type:!n&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,r,n){if(null===t||"undefined"===typeof t||function(e,t,r,n){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,r,i,n)&&(r=null),n||null===i?function(e){return!!ut.call(ht,e)||!ut.call(dt,e)&&(lt.test(e)?ht[e]=!0:(dt[e]=!0,!1))}(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=null===r?3!==i.type&&"":r:(t=i.attributeName,n=i.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(i=i.type)||4===i&&!0===r?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}function vt(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function _t(e,t){var r=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function wt(e,t){var r=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;r=vt(null!=t.value?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function St(e,t){null!=(t=t.checked)&&yt(e,"checked",t,!1)}function bt(e,t){St(e,t);var r=vt(t.value),n=t.type;if(null!=r)"number"===n?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?Pt(e,t.type,r):t.hasOwnProperty("defaultValue")&&Pt(e,t.type,vt(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function xt(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function Pt(e,t,r){"number"===t&&e.ownerDocument.activeElement===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(gt,mt);ft[t]=new pt(t,1,!1,e,null)}),"xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(gt,mt);ft[t]=new pt(t,1,!1,e,"http://www.w3.org/1999/xlink")}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(gt,mt);ft[t]=new pt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace")}),ft.tabIndex=new pt("tabIndex",1,!1,"tabindex",null);var Ct={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Tt(e,t,r){return(e=ue.getPooled(Ct.change,e,t,r)).type="change",Oe(r),W(e),e}var Mt=null,Et=null;function It(e){D(e,!1)}function At(e){if(qe(V(e)))return e}function Rt(e,t){if("change"===e)return t}var Ot=!1;function Dt(){Mt&&(Mt.detachEvent("onpropertychange",kt),Et=Mt=null)}function kt(e){"value"===e.propertyName&&At(Et)&&Be(It,e=Tt(Et,e,ze(e)))}function Ft(e,t,r){"focus"===e?(Dt(),Et=r,(Mt=t).attachEvent("onpropertychange",kt)):"blur"===e&&Dt()}function Nt(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return At(Et)}function Lt(e,t){if("click"===e)return At(t)}function Bt(e,t){if("input"===e||"change"===e)return At(t)}J&&(Ot=je("input")&&(!document.documentMode||9<document.documentMode));var Vt={eventTypes:Ct,_isInputEventSupported:Ot,extractEvents:function(e,t,r,n){var i=t?V(t):window,o=void 0,s=void 0,a=i.nodeName&&i.nodeName.toLowerCase();if("select"===a||"input"===a&&"file"===i.type?o=Rt:Ue(i)?Ot?o=Bt:(o=Nt,s=Ft):(a=i.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(o=Lt),o&&(o=o(e,t)))return Tt(o,r,n);s&&s(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&Pt(i,"number",i.value)}},Ut=ue.extend({view:null,detail:null}),zt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=zt[e])&&!!t[e]}function Gt(){return jt}var Ht=0,qt=0,Wt=!1,Jt=!1,Xt=Ut.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Gt,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Ht;return Ht=e.screenX,Wt?"mousemove"===e.type?e.screenX-t:0:(Wt=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=qt;return qt=e.screenY,Jt?"mousemove"===e.type?e.screenY-t:0:(Jt=!0,0)}}),Yt=Xt.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Kt={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Zt={eventTypes:Kt,extractEvents:function(e,t,r,n){var i="mouseover"===e||"pointerover"===e,o="mouseout"===e||"pointerout"===e;if(i&&(r.relatedTarget||r.fromElement)||!o&&!i)return null;if(i=n.window===n?n:(i=n.ownerDocument)?i.defaultView||i.parentWindow:window,o?(o=t,t=(t=r.relatedTarget||r.toElement)?L(t):null):o=null,o===t)return null;var s=void 0,a=void 0,c=void 0,l=void 0;"mouseout"===e||"mouseover"===e?(s=Xt,a=Kt.mouseLeave,c=Kt.mouseEnter,l="mouse"):"pointerout"!==e&&"pointerover"!==e||(s=Yt,a=Kt.pointerLeave,c=Kt.pointerEnter,l="pointer");var u=null==o?i:V(o);if(i=null==t?i:V(t),(e=s.getPooled(a,o,r,n)).type=l+"leave",e.target=u,e.relatedTarget=i,(r=s.getPooled(c,t,r,n)).type=l+"enter",r.target=i,r.relatedTarget=u,n=t,o&&n)e:{for(i=n,l=0,s=t=o;s;s=z(s))l++;for(s=0,c=i;c;c=z(c))s++;for(;0<l-s;)t=z(t),l--;for(;0<s-l;)i=z(i),s--;for(;l--;){if(t===i||t===i.alternate)break e;t=z(t),i=z(i)}t=null}else t=null;for(i=t,t=[];o&&o!==i&&(null===(l=o.alternate)||l!==i);)t.push(o),o=z(o);for(o=[];n&&n!==i&&(null===(l=n.alternate)||l!==i);)o.push(n),n=z(n);for(n=0;n<t.length;n++)H(t[n],"bubbled",e);for(n=o.length;0<n--;)H(o[n],"captured",r);return[e,r]}},Qt=Object.prototype.hasOwnProperty;function $t(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function er(e,t){if($t(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++)if(!Qt.call(t,r[n])||!$t(e[r[n]],t[r[n]]))return!1;return!0}function tr(e){var t=e;if(e.alternate)for(;t.return;)t=t.return;else{if(0!==(2&t.effectTag))return 1;for(;t.return;)if(0!==(2&(t=t.return).effectTag))return 1}return 5===t.tag?2:3}function rr(e){2!==tr(e)&&s("188")}function nr(e){if(!(e=function(e){var t=e.alternate;if(!t)return 3===(t=tr(e))&&s("188"),1===t?null:e;for(var r=e,n=t;;){var i=r.return,o=i?i.alternate:null;if(!i||!o)break;if(i.child===o.child){for(var a=i.child;a;){if(a===r)return rr(i),e;if(a===n)return rr(i),t;a=a.sibling}s("188")}if(r.return!==n.return)r=i,n=o;else{a=!1;for(var c=i.child;c;){if(c===r){a=!0,r=i,n=o;break}if(c===n){a=!0,n=i,r=o;break}c=c.sibling}if(!a){for(c=o.child;c;){if(c===r){a=!0,r=o,n=i;break}if(c===n){a=!0,n=o,r=i;break}c=c.sibling}a||s("189")}}r.alternate!==n&&s("190")}return 5!==r.tag&&s("188"),r.stateNode.current===r?e:t}(e)))return null;for(var t=e;;){if(7===t.tag||8===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var ir=ue.extend({animationName:null,elapsedTime:null,pseudoElement:null}),or=ue.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),sr=Ut.extend({relatedTarget:null});function ar(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var cr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ur=Ut.extend({key:function(e){if(e.key){var t=cr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ar(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?lr[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Gt,charCode:function(e){return"keypress"===e.type?ar(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ar(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),dr=Xt.extend({dataTransfer:null}),hr=Ut.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Gt}),pr=ue.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),fr=Xt.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),gr=[["abort","abort"],[$,"animationEnd"],[ee,"animationIteration"],[te,"animationStart"],["canplay","canPlay"],["canplaythrough","canPlayThrough"],["drag","drag"],["dragenter","dragEnter"],["dragexit","dragExit"],["dragleave","dragLeave"],["dragover","dragOver"],["durationchange","durationChange"],["emptied","emptied"],["encrypted","encrypted"],["ended","ended"],["error","error"],["gotpointercapture","gotPointerCapture"],["load","load"],["loadeddata","loadedData"],["loadedmetadata","loadedMetadata"],["loadstart","loadStart"],["lostpointercapture","lostPointerCapture"],["mousemove","mouseMove"],["mouseout","mouseOut"],["mouseover","mouseOver"],["playing","playing"],["pointermove","pointerMove"],["pointerout","pointerOut"],["pointerover","pointerOver"],["progress","progress"],["scroll","scroll"],["seeking","seeking"],["stalled","stalled"],["suspend","suspend"],["timeupdate","timeUpdate"],["toggle","toggle"],["touchmove","touchMove"],[re,"transitionEnd"],["waiting","waiting"],["wheel","wheel"]],mr={},yr={};function vr(e,t){var r=e[0],n="on"+((e=e[1])[0].toUpperCase()+e.slice(1));t={phasedRegistrationNames:{bubbled:n,captured:n+"Capture"},dependencies:[r],isInteractive:t},mr[e]=t,yr[r]=t}[["blur","blur"],["cancel","cancel"],["click","click"],["close","close"],["contextmenu","contextMenu"],["copy","copy"],["cut","cut"],["auxclick","auxClick"],["dblclick","doubleClick"],["dragend","dragEnd"],["dragstart","dragStart"],["drop","drop"],["focus","focus"],["input","input"],["invalid","invalid"],["keydown","keyDown"],["keypress","keyPress"],["keyup","keyUp"],["mousedown","mouseDown"],["mouseup","mouseUp"],["paste","paste"],["pause","pause"],["play","play"],["pointercancel","pointerCancel"],["pointerdown","pointerDown"],["pointerup","pointerUp"],["ratechange","rateChange"],["reset","reset"],["seeked","seeked"],["submit","submit"],["touchcancel","touchCancel"],["touchend","touchEnd"],["touchstart","touchStart"],["volumechange","volumeChange"]].forEach(function(e){vr(e,!0)}),gr.forEach(function(e){vr(e,!1)});var _r={eventTypes:mr,isInteractiveTopLevelEventType:function(e){return void 0!==(e=yr[e])&&!0===e.isInteractive},extractEvents:function(e,t,r,n){var i=yr[e];if(!i)return null;switch(e){case"keypress":if(0===ar(r))return null;case"keydown":case"keyup":e=ur;break;case"blur":case"focus":e=sr;break;case"click":if(2===r.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Xt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=dr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=hr;break;case $:case ee:case te:e=ir;break;case re:e=pr;break;case"scroll":e=Ut;break;case"wheel":e=fr;break;case"copy":case"cut":case"paste":e=or;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Yt;break;default:e=ue}return W(t=e.getPooled(i,t,r,n)),t}},wr=_r.isInteractiveTopLevelEventType,Sr=[];function br(e){var t=e.targetInst,r=t;do{if(!r){e.ancestors.push(r);break}var n;for(n=r;n.return;)n=n.return;if(!(n=5!==n.tag?null:n.stateNode.containerInfo))break;e.ancestors.push(r),r=L(n)}while(r);for(r=0;r<e.ancestors.length;r++){t=e.ancestors[r];var i=ze(e.nativeEvent);n=e.topLevelType;for(var o=e.nativeEvent,s=null,a=0;a<y.length;a++){var c=y[a];c&&(c=c.extractEvents(n,t,o,i))&&(s=C(s,c))}D(s,!1)}}var xr=!0;function Pr(e,t){if(!t)return null;var r=(wr(e)?Tr:Mr).bind(null,e);t.addEventListener(e,r,!1)}function Cr(e,t){if(!t)return null;var r=(wr(e)?Tr:Mr).bind(null,e);t.addEventListener(e,r,!0)}function Tr(e,t){Fe(Mr,e,t)}function Mr(e,t){if(xr){var r=ze(t);if(null===(r=L(r))||"number"!==typeof r.tag||2===tr(r)||(r=null),Sr.length){var n=Sr.pop();n.topLevelType=e,n.nativeEvent=t,n.targetInst=r,e=n}else e={topLevelType:e,nativeEvent:t,targetInst:r,ancestors:[]};try{Be(br,e)}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>Sr.length&&Sr.push(e)}}}var Er={},Ir=0,Ar="_reactListenersID"+(""+Math.random()).slice(2);function Rr(e){return Object.prototype.hasOwnProperty.call(e,Ar)||(e[Ar]=Ir++,Er[e[Ar]]={}),Er[e[Ar]]}function Or(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Dr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function kr(e,t){var r,n=Dr(e);for(e=0;n;){if(3===n.nodeType){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Dr(n)}}function Fr(){for(var e=window,t=Or();t instanceof e.HTMLIFrameElement;){try{e=t.contentDocument.defaultView}catch(e){break}t=Or(e.document)}return t}function Nr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Lr=J&&"documentMode"in document&&11>=document.documentMode,Br={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Vr=null,Ur=null,zr=null,jr=!1;function Gr(e,t){var r=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return jr||null==Vr||Vr!==Or(r)?null:("selectionStart"in(r=Vr)&&Nr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},zr&&er(zr,r)?null:(zr=r,(e=ue.getPooled(Br.select,Ur,e,t)).type="select",e.target=Vr,W(e),e))}var Hr={eventTypes:Br,extractEvents:function(e,t,r,n){var i,o=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;if(!(i=!o)){e:{o=Rr(o),i=w.onSelect;for(var s=0;s<i.length;s++){var a=i[s];if(!o.hasOwnProperty(a)||!o[a]){o=!1;break e}}o=!0}i=!o}if(i)return null;switch(o=t?V(t):window,e){case"focus":(Ue(o)||"true"===o.contentEditable)&&(Vr=o,Ur=t,zr=null);break;case"blur":zr=Ur=Vr=null;break;case"mousedown":jr=!0;break;case"contextmenu":case"mouseup":case"dragend":return jr=!1,Gr(r,n);case"selectionchange":if(Lr)break;case"keydown":case"keyup":return Gr(r,n)}return null}};function qr(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return n.Children.forEach(e,function(e){null!=e&&(t+=e)}),t}(t.children))&&(e.children=t),e}function Wr(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+vt(r),t=null,i=0;i<e.length;i++){if(e[i].value===r)return e[i].selected=!0,void(n&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Jr(e,t){return null!=t.dangerouslySetInnerHTML&&s("91"),i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Xr(e,t){var r=t.value;null==r&&(r=t.defaultValue,null!=(t=t.children)&&(null!=r&&s("92"),Array.isArray(t)&&(1>=t.length||s("93"),t=t[0]),r=t),null==r&&(r="")),e._wrapperState={initialValue:vt(r)}}function Yr(e,t){var r=vt(t.value),n=vt(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=n&&(e.defaultValue=""+n)}function Kr(e){var t=e.textContent;t===e._wrapperState.initialValue&&(e.value=t)}R.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),S=U,b=B,x=V,R.injectEventPluginsByName({SimpleEventPlugin:_r,EnterLeaveEventPlugin:Zt,ChangeEventPlugin:Vt,SelectEventPlugin:Hr,BeforeInputEventPlugin:Me});var Zr={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Qr(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $r(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Qr(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var en,tn=void 0,rn=(en=function(e,t){if(e.namespaceURI!==Zr.svg||"innerHTML"in e)e.innerHTML=t;else{for((tn=tn||document.createElement("div")).innerHTML="<svg>"+t+"</svg>",t=tn.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,r,n){MSApp.execUnsafeLocalFunction(function(){return en(e,t)})}:en);function nn(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var on={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sn=["Webkit","ms","Moz","O"];function an(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var n=0===r.indexOf("--"),i=r,o=t[r];i=null==o||"boolean"===typeof o||""===o?"":n||"number"!==typeof o||0===o||on.hasOwnProperty(i)&&on[i]?(""+o).trim():o+"px","float"===r&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}Object.keys(on).forEach(function(e){sn.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),on[t]=on[e]})});var cn=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ln(e,t){t&&(cn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&s("137",e,""),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&s("60"),"object"===typeof t.dangerouslySetInnerHTML&&"__html"in t.dangerouslySetInnerHTML||s("61")),null!=t.style&&"object"!==typeof t.style&&s("62",""))}function un(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function dn(e,t){var r=Rr(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=w[t];for(var n=0;n<t.length;n++){var i=t[n];if(!r.hasOwnProperty(i)||!r[i]){switch(i){case"scroll":Cr("scroll",e);break;case"focus":case"blur":Cr("focus",e),Cr("blur",e),r.blur=!0,r.focus=!0;break;case"cancel":case"close":je(i)&&Cr(i,e);break;case"invalid":case"submit":case"reset":break;default:-1===ne.indexOf(i)&&Pr(i,e)}r[i]=!0}}}function hn(){}var pn=null,fn=null;function gn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function mn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}function yn(e){for(e=e.nextSibling;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}function vn(e){for(e=e.firstChild;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}new Set;var _n=[],wn=-1;function Sn(e){0>wn||(e.current=_n[wn],_n[wn]=null,wn--)}function bn(e,t){_n[++wn]=e.current,e.current=t}var xn={},Pn={current:xn},Cn={current:!1},Tn=xn;function Mn(e,t){var r=e.type.contextTypes;if(!r)return xn;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in r)o[i]=t[i];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function En(e){return null!==(e=e.childContextTypes)&&void 0!==e}function In(e){Sn(Cn),Sn(Pn)}function An(e){Sn(Cn),Sn(Pn)}function Rn(e,t,r){Pn.current!==xn&&s("168"),bn(Pn,t),bn(Cn,r)}function On(e,t,r){var n=e.stateNode;if(e=t.childContextTypes,"function"!==typeof n.getChildContext)return r;for(var o in n=n.getChildContext())o in e||s("108",at(t)||"Unknown",o);return i({},r,n)}function Dn(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||xn,Tn=Pn.current,bn(Pn,t),bn(Cn,Cn.current),!0}function kn(e,t,r){var n=e.stateNode;n||s("169"),r?(t=On(e,t,Tn),n.__reactInternalMemoizedMergedChildContext=t,Sn(Cn),Sn(Pn),bn(Pn,t)):Sn(Cn),bn(Cn,r)}var Fn=null,Nn=null;function Ln(e){return function(t){try{return e(t)}catch(e){}}}function Bn(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=null,this.index=0,this.ref=null,this.pendingProps=t,this.firstContextDependency=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Vn(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Un(e,t,r){var n=e.alternate;return null===n?((n=new Bn(e.tag,t,e.key,e.mode)).type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=t!==e.pendingProps?r:e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.firstContextDependency=e.firstContextDependency,n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function zn(e,t,r){var n=e.type,i=e.key;e=e.props;var o=void 0;if("function"===typeof n)o=Vn(n)?2:4;else if("string"===typeof n)o=7;else e:switch(n){case Ze:return jn(e.children,t,r,i);case rt:o=10,t|=3;break;case Qe:o=10,t|=2;break;case $e:return(n=new Bn(15,e,i,4|t)).type=$e,n.expirationTime=r,n;case it:o=16;break;default:if("object"===typeof n&&null!==n)switch(n.$$typeof){case et:o=12;break e;case tt:o=11;break e;case nt:o=13;break e;default:if("function"===typeof n.then){o=4;break e}}s("130",null==n?n:typeof n,"")}return(t=new Bn(o,e,i,t)).type=n,t.expirationTime=r,t}function jn(e,t,r,n){return(e=new Bn(9,e,n,t)).expirationTime=r,e}function Gn(e,t,r){return(e=new Bn(8,e,null,t)).expirationTime=r,e}function Hn(e,t,r){return(t=new Bn(6,null!==e.children?e.children:[],e.key,t)).expirationTime=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qn(e,t){e.didError=!1;var r=e.earliestPendingTime;0===r?e.earliestPendingTime=e.latestPendingTime=t:r>t?e.earliestPendingTime=t:e.latestPendingTime<t&&(e.latestPendingTime=t),Wn(t,e)}function Wn(e,t){var r=t.earliestSuspendedTime,n=t.latestSuspendedTime,i=t.earliestPendingTime,o=t.latestPingedTime;0===(i=0!==i?i:o)&&(0===e||n>e)&&(i=n),0!==(e=i)&&0!==r&&r<e&&(e=r),t.nextExpirationTimeToWorkOn=i,t.expirationTime=e}var Jn=!1;function Xn(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Yn(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Kn(e){return{expirationTime:e,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function Zn(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function Qn(e,t){var r=e.alternate;if(null===r){var n=e.updateQueue,i=null;null===n&&(n=e.updateQueue=Xn(e.memoizedState))}else n=e.updateQueue,i=r.updateQueue,null===n?null===i?(n=e.updateQueue=Xn(e.memoizedState),i=r.updateQueue=Xn(r.memoizedState)):n=e.updateQueue=Yn(i):null===i&&(i=r.updateQueue=Yn(n));null===i||n===i?Zn(n,t):null===n.lastUpdate||null===i.lastUpdate?(Zn(n,t),Zn(i,t)):(Zn(n,t),i.lastUpdate=t)}function $n(e,t){var r=e.updateQueue;null===(r=null===r?e.updateQueue=Xn(e.memoizedState):ei(e,r)).lastCapturedUpdate?r.firstCapturedUpdate=r.lastCapturedUpdate=t:(r.lastCapturedUpdate.next=t,r.lastCapturedUpdate=t)}function ei(e,t){var r=e.alternate;return null!==r&&t===r.updateQueue&&(t=e.updateQueue=Yn(t)),t}function ti(e,t,r,n,o,s){switch(r.tag){case 1:return"function"===typeof(e=r.payload)?e.call(s,n,o):e;case 3:e.effectTag=-1025&e.effectTag|64;case 0:if(null===(o="function"===typeof(e=r.payload)?e.call(s,n,o):e)||void 0===o)break;return i({},n,o);case 2:Jn=!0}return n}function ri(e,t,r,n,i){Jn=!1;for(var o=(t=ei(e,t)).baseState,s=null,a=0,c=t.firstUpdate,l=o;null!==c;){var u=c.expirationTime;u>i?(null===s&&(s=c,o=l),(0===a||a>u)&&(a=u)):(l=ti(e,0,c,l,r,n),null!==c.callback&&(e.effectTag|=32,c.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=c:(t.lastEffect.nextEffect=c,t.lastEffect=c))),c=c.next}for(u=null,c=t.firstCapturedUpdate;null!==c;){var d=c.expirationTime;d>i?(null===u&&(u=c,null===s&&(o=l)),(0===a||a>d)&&(a=d)):(l=ti(e,0,c,l,r,n),null!==c.callback&&(e.effectTag|=32,c.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=c:(t.lastCapturedEffect.nextEffect=c,t.lastCapturedEffect=c))),c=c.next}null===s&&(t.lastUpdate=null),null===u?t.lastCapturedUpdate=null:e.effectTag|=32,null===s&&null===u&&(o=l),t.baseState=o,t.firstUpdate=s,t.firstCapturedUpdate=u,e.expirationTime=a,e.memoizedState=l}function ni(e,t,r){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),ii(t.firstEffect,r),t.firstEffect=t.lastEffect=null,ii(t.firstCapturedEffect,r),t.firstCapturedEffect=t.lastCapturedEffect=null}function ii(e,t){for(;null!==e;){var r=e.callback;if(null!==r){e.callback=null;var n=t;"function"!==typeof r&&s("191",r),r.call(n)}e=e.nextEffect}}function oi(e,t){return{value:e,source:t,stack:ct(t)}}var si={current:null},ai=null,ci=null,li=null;function ui(e,t){var r=e.type._context;bn(si,r._currentValue),r._currentValue=t}function di(e){var t=si.current;Sn(si),e.type._context._currentValue=t}function hi(e){ai=e,li=ci=null,e.firstContextDependency=null}function pi(e,t){return li!==e&&!1!==t&&0!==t&&("number"===typeof t&&1073741823!==t||(li=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ci?(null===ai&&s("277"),ai.firstContextDependency=ci=t):ci=ci.next=t),e._currentValue}var fi={},gi={current:fi},mi={current:fi},yi={current:fi};function vi(e){return e===fi&&s("174"),e}function _i(e,t){bn(yi,t),bn(mi,e),bn(gi,fi);var r=t.nodeType;switch(r){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:$r(null,"");break;default:t=$r(t=(r=8===r?t.parentNode:t).namespaceURI||null,r=r.tagName)}Sn(gi),bn(gi,t)}function wi(e){Sn(gi),Sn(mi),Sn(yi)}function Si(e){vi(yi.current);var t=vi(gi.current),r=$r(t,e.type);t!==r&&(bn(mi,e),bn(gi,r))}function bi(e){mi.current===e&&(Sn(gi),Sn(mi))}var xi=(new n.Component).refs;function Pi(e,t,r,n){r=null===(r=r(n,t=e.memoizedState))||void 0===r?t:i({},t,r),e.memoizedState=r,null!==(n=e.updateQueue)&&0===e.expirationTime&&(n.baseState=r)}var Ci={isMounted:function(e){return!!(e=e._reactInternalFiber)&&2===tr(e)},enqueueSetState:function(e,t,r){e=e._reactInternalFiber;var n=as(),i=Kn(n=Do(n,e));i.payload=t,void 0!==r&&null!==r&&(i.callback=r),Qn(e,i),ko(e,n)},enqueueReplaceState:function(e,t,r){e=e._reactInternalFiber;var n=as(),i=Kn(n=Do(n,e));i.tag=1,i.payload=t,void 0!==r&&null!==r&&(i.callback=r),Qn(e,i),ko(e,n)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var r=as(),n=Kn(r=Do(r,e));n.tag=2,void 0!==t&&null!==t&&(n.callback=t),Qn(e,n),ko(e,r)}};function Ti(e,t,r,n,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!er(r,n)||!er(i,o))}function Mi(e,t,r,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Ci.enqueueReplaceState(t,t.state,null)}function Ei(e,t,r,n){var i=e.stateNode,o=En(t)?Tn:Pn.current;i.props=r,i.state=e.memoizedState,i.refs=xi,i.context=Mn(e,o),null!==(o=e.updateQueue)&&(ri(e,o,r,i,n),i.state=e.memoizedState),"function"===typeof(o=t.getDerivedStateFromProps)&&(Pi(e,t,o,r),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Ci.enqueueReplaceState(i,i.state,null),null!==(o=e.updateQueue)&&(ri(e,o,r,i,n),i.state=e.memoizedState)),"function"===typeof i.componentDidMount&&(e.effectTag|=4)}var Ii=Array.isArray;function Ai(e,t,r){if(null!==(e=r.ref)&&"function"!==typeof e&&"object"!==typeof e){if(r._owner){var n=void 0;(r=r._owner)&&(2!==r.tag&&3!==r.tag&&s("110"),n=r.stateNode),n||s("147",e);var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=n.refs;t===xi&&(t=n.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}"string"!==typeof e&&s("284"),r._owner||s("254",e)}return e}function Ri(e,t){"textarea"!==e.type&&s("31","[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,"")}function Oi(e){function t(t,r){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=r,t.lastEffect=r):t.firstEffect=t.lastEffect=r,r.nextEffect=null,r.effectTag=8}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t,r){return(e=Un(e,t,r)).index=0,e.sibling=null,e}function o(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.effectTag=2,r):n:(t.effectTag=2,r):r}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function c(e,t,r,n){return null===t||8!==t.tag?((t=Gn(r,e.mode,n)).return=e,t):((t=i(t,r,n)).return=e,t)}function l(e,t,r,n){return null!==t&&t.type===r.type?((n=i(t,r.props,n)).ref=Ai(e,t,r),n.return=e,n):((n=zn(r,e.mode,n)).ref=Ai(e,t,r),n.return=e,n)}function u(e,t,r,n){return null===t||6!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Hn(r,e.mode,n)).return=e,t):((t=i(t,r.children||[],n)).return=e,t)}function d(e,t,r,n,o){return null===t||9!==t.tag?((t=jn(r,e.mode,n,o)).return=e,t):((t=i(t,r,n)).return=e,t)}function h(e,t,r){if("string"===typeof t||"number"===typeof t)return(t=Gn(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case Ye:return(r=zn(t,e.mode,r)).ref=Ai(e,null,t),r.return=e,r;case Ke:return(t=Hn(t,e.mode,r)).return=e,t}if(Ii(t)||st(t))return(t=jn(t,e.mode,r,null)).return=e,t;Ri(e,t)}return null}function p(e,t,r,n){var i=null!==t?t.key:null;if("string"===typeof r||"number"===typeof r)return null!==i?null:c(e,t,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case Ye:return r.key===i?r.type===Ze?d(e,t,r.props.children,n,i):l(e,t,r,n):null;case Ke:return r.key===i?u(e,t,r,n):null}if(Ii(r)||st(r))return null!==i?null:d(e,t,r,n,null);Ri(e,r)}return null}function f(e,t,r,n,i){if("string"===typeof n||"number"===typeof n)return c(t,e=e.get(r)||null,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case Ye:return e=e.get(null===n.key?r:n.key)||null,n.type===Ze?d(t,e,n.props.children,i,n.key):l(t,e,n,i);case Ke:return u(t,e=e.get(null===n.key?r:n.key)||null,n,i)}if(Ii(n)||st(n))return d(t,e=e.get(r)||null,n,i,null);Ri(t,n)}return null}function g(i,s,a,c){for(var l=null,u=null,d=s,g=s=0,m=null;null!==d&&g<a.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var y=p(i,d,a[g],c);if(null===y){null===d&&(d=m);break}e&&d&&null===y.alternate&&t(i,d),s=o(y,s,g),null===u?l=y:u.sibling=y,u=y,d=m}if(g===a.length)return r(i,d),l;if(null===d){for(;g<a.length;g++)(d=h(i,a[g],c))&&(s=o(d,s,g),null===u?l=d:u.sibling=d,u=d);return l}for(d=n(i,d);g<a.length;g++)(m=f(d,i,g,a[g],c))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),s=o(m,s,g),null===u?l=m:u.sibling=m,u=m);return e&&d.forEach(function(e){return t(i,e)}),l}function m(i,a,c,l){var u=st(c);"function"!==typeof u&&s("150"),null==(c=u.call(c))&&s("151");for(var d=u=null,g=a,m=a=0,y=null,v=c.next();null!==g&&!v.done;m++,v=c.next()){g.index>m?(y=g,g=null):y=g.sibling;var _=p(i,g,v.value,l);if(null===_){g||(g=y);break}e&&g&&null===_.alternate&&t(i,g),a=o(_,a,m),null===d?u=_:d.sibling=_,d=_,g=y}if(v.done)return r(i,g),u;if(null===g){for(;!v.done;m++,v=c.next())null!==(v=h(i,v.value,l))&&(a=o(v,a,m),null===d?u=v:d.sibling=v,d=v);return u}for(g=n(i,g);!v.done;m++,v=c.next())null!==(v=f(g,i,m,v.value,l))&&(e&&null!==v.alternate&&g.delete(null===v.key?m:v.key),a=o(v,a,m),null===d?u=v:d.sibling=v,d=v);return e&&g.forEach(function(e){return t(i,e)}),u}return function(e,n,o,c){var l="object"===typeof o&&null!==o&&o.type===Ze&&null===o.key;l&&(o=o.props.children);var u="object"===typeof o&&null!==o;if(u)switch(o.$$typeof){case Ye:e:{for(u=o.key,l=n;null!==l;){if(l.key===u){if(9===l.tag?o.type===Ze:l.type===o.type){r(e,l.sibling),(n=i(l,o.type===Ze?o.props.children:o.props,c)).ref=Ai(e,l,o),n.return=e,e=n;break e}r(e,l);break}t(e,l),l=l.sibling}o.type===Ze?((n=jn(o.props.children,e.mode,c,o.key)).return=e,e=n):((c=zn(o,e.mode,c)).ref=Ai(e,n,o),c.return=e,e=c)}return a(e);case Ke:e:{for(l=o.key;null!==n;){if(n.key===l){if(6===n.tag&&n.stateNode.containerInfo===o.containerInfo&&n.stateNode.implementation===o.implementation){r(e,n.sibling),(n=i(n,o.children||[],c)).return=e,e=n;break e}r(e,n);break}t(e,n),n=n.sibling}(n=Hn(o,e.mode,c)).return=e,e=n}return a(e)}if("string"===typeof o||"number"===typeof o)return o=""+o,null!==n&&8===n.tag?(r(e,n.sibling),(n=i(n,o,c)).return=e,e=n):(r(e,n),(n=Gn(o,e.mode,c)).return=e,e=n),a(e);if(Ii(o))return g(e,n,o,c);if(st(o))return m(e,n,o,c);if(u&&Ri(e,o),"undefined"===typeof o&&!l)switch(e.tag){case 2:case 3:case 0:s("152",(c=e.type).displayName||c.name||"Component")}return r(e,n)}}var Di=Oi(!0),ki=Oi(!1),Fi=null,Ni=null,Li=!1;function Bi(e,t){var r=new Bn(7,null,null,0);r.type="DELETED",r.stateNode=t,r.return=e,r.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=r,e.lastEffect=r):e.firstEffect=e.lastEffect=r}function Vi(e,t){switch(e.tag){case 7:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 8:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Ui(e){if(Li){var t=Ni;if(t){var r=t;if(!Vi(e,t)){if(!(t=yn(r))||!Vi(e,t))return e.effectTag|=2,Li=!1,void(Fi=e);Bi(Fi,r)}Fi=e,Ni=vn(t)}else e.effectTag|=2,Li=!1,Fi=e}}function zi(e){for(e=e.return;null!==e&&7!==e.tag&&5!==e.tag;)e=e.return;Fi=e}function ji(e){if(e!==Fi)return!1;if(!Li)return zi(e),Li=!0,!1;var t=e.type;if(7!==e.tag||"head"!==t&&"body"!==t&&!mn(t,e.memoizedProps))for(t=Ni;t;)Bi(e,t),t=yn(t);return zi(e),Ni=Fi?yn(e.stateNode):null,!0}function Gi(){Ni=Fi=null,Li=!1}var Hi=We.ReactCurrentOwner;function qi(e,t,r,n){t.child=null===e?ki(t,null,r,n):Di(t,e.child,r,n)}function Wi(e,t,r,n,i){r=r.render;var o=t.ref;return Cn.current||t.memoizedProps!==n||o!==(null!==e?e.ref:null)?(qi(e,t,r=r(n,o),i),t.memoizedProps=n,t.child):$i(e,t,i)}function Ji(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.effectTag|=128)}function Xi(e,t,r,n,i){var o=En(r)?Tn:Pn.current;return o=Mn(t,o),hi(t),r=r(n,o),t.effectTag|=1,qi(e,t,r,i),t.memoizedProps=n,t.child}function Yi(e,t,r,n,i){if(En(r)){var o=!0;Dn(t)}else o=!1;if(hi(t),null===e)if(null===t.stateNode){var s=En(r)?Tn:Pn.current,a=r.contextTypes,c=null!==a&&void 0!==a,l=new r(n,a=c?Mn(t,s):xn);t.memoizedState=null!==l.state&&void 0!==l.state?l.state:null,l.updater=Ci,t.stateNode=l,l._reactInternalFiber=t,c&&((c=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,c.__reactInternalMemoizedMaskedChildContext=a),Ei(t,r,n,i),n=!0}else{s=t.stateNode,a=t.memoizedProps,s.props=a;var u=s.context;c=Mn(t,c=En(r)?Tn:Pn.current);var d=r.getDerivedStateFromProps;(l="function"===typeof d||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==n||u!==c)&&Mi(t,s,n,c),Jn=!1;var h=t.memoizedState;u=s.state=h;var p=t.updateQueue;null!==p&&(ri(t,p,n,s,i),u=t.memoizedState),a!==n||h!==u||Cn.current||Jn?("function"===typeof d&&(Pi(t,r,d,n),u=t.memoizedState),(a=Jn||Ti(t,r,a,n,h,u,c))?(l||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.effectTag|=4)):("function"===typeof s.componentDidMount&&(t.effectTag|=4),t.memoizedProps=n,t.memoizedState=u),s.props=n,s.state=u,s.context=c,n=a):("function"===typeof s.componentDidMount&&(t.effectTag|=4),n=!1)}else s=t.stateNode,a=t.memoizedProps,s.props=a,u=s.context,c=Mn(t,c=En(r)?Tn:Pn.current),(l="function"===typeof(d=r.getDerivedStateFromProps)||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==n||u!==c)&&Mi(t,s,n,c),Jn=!1,u=t.memoizedState,h=s.state=u,null!==(p=t.updateQueue)&&(ri(t,p,n,s,i),h=t.memoizedState),a!==n||u!==h||Cn.current||Jn?("function"===typeof d&&(Pi(t,r,d,n),h=t.memoizedState),(d=Jn||Ti(t,r,a,n,u,h,c))?(l||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(n,h,c),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(n,h,c)),"function"===typeof s.componentDidUpdate&&(t.effectTag|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=n,t.memoizedState=h),s.props=n,s.state=h,s.context=c,n=d):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),n=!1);return Ki(e,t,r,n,o,i)}function Ki(e,t,r,n,i,o){Ji(e,t);var s=0!==(64&t.effectTag);if(!n&&!s)return i&&kn(t,r,!1),$i(e,t,o);n=t.stateNode,Hi.current=t;var a=s?null:n.render();return t.effectTag|=1,null!==e&&s&&(qi(e,t,null,o),t.child=null),qi(e,t,a,o),t.memoizedState=n.state,t.memoizedProps=n.props,i&&kn(t,r,!0),t.child}function Zi(e){var t=e.stateNode;t.pendingContext?Rn(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Rn(0,t.context,!1),_i(e,t.containerInfo)}function Qi(e,t){if(e&&e.defaultProps)for(var r in t=i({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}function $i(e,t,r){null!==e&&(t.firstContextDependency=e.firstContextDependency);var n=t.childExpirationTime;if(0===n||n>r)return null;if(null!==e&&t.child!==e.child&&s("153"),null!==t.child){for(r=Un(e=t.child,e.pendingProps,e.expirationTime),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Un(e,e.pendingProps,e.expirationTime)).return=t;r.sibling=null}return t.child}function eo(e,t,r){var n=t.expirationTime;if(!Cn.current&&(0===n||n>r)){switch(t.tag){case 5:Zi(t),Gi();break;case 7:Si(t);break;case 2:En(t.type)&&Dn(t);break;case 3:En(t.type._reactResult)&&Dn(t);break;case 6:_i(t,t.stateNode.containerInfo);break;case 12:ui(t,t.memoizedProps.value)}return $i(e,t,r)}switch(t.expirationTime=0,t.tag){case 4:return function(e,t,r,n){null!==e&&s("155");var i=t.pendingProps;if("object"===typeof r&&null!==r&&"function"===typeof r.then){var o=r=function(e){switch(e._reactStatus){case 1:return e._reactResult;case 2:throw e._reactResult;case 0:throw e;default:throw e._reactStatus=0,e.then(function(t){if(0===e._reactStatus){if(e._reactStatus=1,"object"===typeof t&&null!==t){var r=t.default;t=void 0!==r&&null!==r?r:t}e._reactResult=t}},function(t){0===e._reactStatus&&(e._reactStatus=2,e._reactResult=t)}),e}}(r);o="function"===typeof o?Vn(o)?3:1:void 0!==o&&null!==o&&o.$$typeof?14:4,o=t.tag=o;var a=Qi(r,i);switch(o){case 1:return Xi(e,t,r,a,n);case 3:return Yi(e,t,r,a,n);case 14:return Wi(e,t,r,a,n);default:s("283",r)}}if(o=Mn(t,Pn.current),hi(t),o=r(i,o),t.effectTag|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof){t.tag=2,En(r)?(a=!0,Dn(t)):a=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null;var c=r.getDerivedStateFromProps;return"function"===typeof c&&Pi(t,r,c,i),o.updater=Ci,t.stateNode=o,o._reactInternalFiber=t,Ei(t,r,i,n),Ki(e,t,r,!0,a,n)}return t.tag=0,qi(e,t,o,n),t.memoizedProps=i,t.child}(e,t,t.type,r);case 0:return Xi(e,t,t.type,t.pendingProps,r);case 1:var i=t.type._reactResult;return e=Xi(e,t,i,Qi(i,n=t.pendingProps),r),t.memoizedProps=n,e;case 2:return Yi(e,t,t.type,t.pendingProps,r);case 3:return e=Yi(e,t,i=t.type._reactResult,Qi(i,n=t.pendingProps),r),t.memoizedProps=n,e;case 5:return Zi(t),null===(n=t.updateQueue)&&s("282"),i=null!==(i=t.memoizedState)?i.element:null,ri(t,n,t.pendingProps,null,r),(n=t.memoizedState.element)===i?(Gi(),t=$i(e,t,r)):(i=t.stateNode,(i=(null===e||null===e.child)&&i.hydrate)&&(Ni=vn(t.stateNode.containerInfo),Fi=t,i=Li=!0),i?(t.effectTag|=2,t.child=ki(t,null,n,r)):(qi(e,t,n,r),Gi()),t=t.child),t;case 7:Si(t),null===e&&Ui(t),n=t.type,i=t.pendingProps;var o=null!==e?e.memoizedProps:null,a=i.children;return mn(n,i)?a=null:null!==o&&mn(n,o)&&(t.effectTag|=16),Ji(e,t),1073741823!==r&&1&t.mode&&i.hidden?(t.expirationTime=1073741823,t.memoizedProps=i,t=null):(qi(e,t,a,r),t.memoizedProps=i,t=t.child),t;case 8:return null===e&&Ui(t),t.memoizedProps=t.pendingProps,null;case 16:return null;case 6:return _i(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Di(t,null,n,r):qi(e,t,n,r),t.memoizedProps=n,t.child;case 13:return Wi(e,t,t.type,t.pendingProps,r);case 14:return e=Wi(e,t,i=t.type._reactResult,Qi(i,n=t.pendingProps),r),t.memoizedProps=n,e;case 9:return qi(e,t,n=t.pendingProps,r),t.memoizedProps=n,t.child;case 10:return qi(e,t,n=t.pendingProps.children,r),t.memoizedProps=n,t.child;case 15:return qi(e,t,(n=t.pendingProps).children,r),t.memoizedProps=n,t.child;case 12:e:{if(n=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,t.memoizedProps=i,ui(t,o),null!==a){var c=a.value;if(0===(o=c===o&&(0!==c||1/c===1/o)||c!==c&&o!==o?0:0|("function"===typeof n._calculateChangedBits?n._calculateChangedBits(c,o):1073741823))){if(a.children===i.children&&!Cn.current){t=$i(e,t,r);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){if(null!==(c=a.firstContextDependency))do{if(c.context===n&&0!==(c.observedBits&o)){if(2===a.tag||3===a.tag){var l=Kn(r);l.tag=2,Qn(a,l)}(0===a.expirationTime||a.expirationTime>r)&&(a.expirationTime=r),null!==(l=a.alternate)&&(0===l.expirationTime||l.expirationTime>r)&&(l.expirationTime=r);for(var u=a.return;null!==u;){if(l=u.alternate,0===u.childExpirationTime||u.childExpirationTime>r)u.childExpirationTime=r,null!==l&&(0===l.childExpirationTime||l.childExpirationTime>r)&&(l.childExpirationTime=r);else{if(null===l||!(0===l.childExpirationTime||l.childExpirationTime>r))break;l.childExpirationTime=r}u=u.return}}l=a.child,c=c.next}while(null!==c);else l=12===a.tag&&a.type===t.type?null:a.child;if(null!==l)l.return=a;else for(l=a;null!==l;){if(l===t){l=null;break}if(null!==(a=l.sibling)){a.return=l.return,l=a;break}l=l.return}a=l}}qi(e,t,i.children,r),t=t.child}return t;case 11:return o=t.type,i=(n=t.pendingProps).children,hi(t),i=i(o=pi(o,n.unstable_observedBits)),t.effectTag|=1,qi(e,t,i,r),t.memoizedProps=n,t.child;default:s("156")}}function to(e){e.effectTag|=4}var ro=void 0,no=void 0,io=void 0;function oo(e,t){var r=t.source,n=t.stack;null===n&&null!==r&&(n=ct(r)),null!==r&&at(r.type),t=t.value,null!==e&&2===e.tag&&at(e.type);try{console.error(t)}catch(e){setTimeout(function(){throw e})}}function so(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(t){Oo(e,t)}else t.current=null}function ao(e){switch("function"===typeof Nn&&Nn(e),e.tag){case 2:case 3:so(e);var t=e.stateNode;if("function"===typeof t.componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Oo(e,t)}break;case 7:so(e);break;case 6:uo(e)}}function co(e){return 7===e.tag||5===e.tag||6===e.tag}function lo(e){e:{for(var t=e.return;null!==t;){if(co(t)){var r=t;break e}t=t.return}s("160"),r=void 0}var n=t=void 0;switch(r.tag){case 7:t=r.stateNode,n=!1;break;case 5:case 6:t=r.stateNode.containerInfo,n=!0;break;default:s("161")}16&r.effectTag&&(nn(t,""),r.effectTag&=-17);e:t:for(r=e;;){for(;null===r.sibling;){if(null===r.return||co(r.return)){r=null;break e}r=r.return}for(r.sibling.return=r.return,r=r.sibling;7!==r.tag&&8!==r.tag;){if(2&r.effectTag)continue t;if(null===r.child||6===r.tag)continue t;r.child.return=r,r=r.child}if(!(2&r.effectTag)){r=r.stateNode;break e}}for(var i=e;;){if(7===i.tag||8===i.tag)if(r)if(n){var o=t,a=i.stateNode,c=r;8===o.nodeType?o.parentNode.insertBefore(a,c):o.insertBefore(a,c)}else t.insertBefore(i.stateNode,r);else n?(o=t,a=i.stateNode,8===o.nodeType?(c=o.parentNode).insertBefore(a,o):(c=o).appendChild(a),null===c.onclick&&(c.onclick=hn)):t.appendChild(i.stateNode);else if(6!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function uo(e){for(var t=e,r=!1,n=void 0,i=void 0;;){if(!r){r=t.return;e:for(;;){switch(null===r&&s("160"),r.tag){case 7:n=r.stateNode,i=!1;break e;case 5:case 6:n=r.stateNode.containerInfo,i=!0;break e}r=r.return}r=!0}if(7===t.tag||8===t.tag){e:for(var o=t,a=o;;)if(ao(a),null!==a.child&&6!==a.tag)a.child.return=a,a=a.child;else{if(a===o)break;for(;null===a.sibling;){if(null===a.return||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}i?(o=n,a=t.stateNode,8===o.nodeType?o.parentNode.removeChild(a):o.removeChild(a)):n.removeChild(t.stateNode)}else if(6===t.tag?(n=t.stateNode.containerInfo,i=!0):ao(t),null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;6===(t=t.return).tag&&(r=!1)}t.sibling.return=t.return,t=t.sibling}}function ho(e,t){switch(t.tag){case 2:case 3:break;case 7:var r=t.stateNode;if(null!=r){var n=t.memoizedProps,i=null!==e?e.memoizedProps:n;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(r[N]=n,"input"===e&&"radio"===n.type&&null!=n.name&&St(r,n),un(e,i),t=un(e,n),i=0;i<o.length;i+=2){var a=o[i],c=o[i+1];"style"===a?an(r,c):"dangerouslySetInnerHTML"===a?rn(r,c):"children"===a?nn(r,c):yt(r,a,c,t)}switch(e){case"input":bt(r,n);break;case"textarea":Yr(r,n);break;case"select":e=r._wrapperState.wasMultiple,r._wrapperState.wasMultiple=!!n.multiple,null!=(o=n.value)?Wr(r,!!n.multiple,o,!1):e!==!!n.multiple&&(null!=n.defaultValue?Wr(r,!!n.multiple,n.defaultValue,!0):Wr(r,!!n.multiple,n.multiple?[]:"",!1))}}}break;case 8:null===t.stateNode&&s("162"),t.stateNode.nodeValue=t.memoizedProps;break;case 5:case 15:case 16:break;default:s("163")}}function po(e,t,r){(r=Kn(r)).tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){fs(n),oo(e,t)},r}function fo(e,t,r){(r=Kn(r)).tag=3;var n=e.stateNode;return null!==n&&"function"===typeof n.componentDidCatch&&(r.callback=function(){null===Mo?Mo=new Set([this]):Mo.add(this);var r=t.value,n=t.stack;oo(e,t),this.componentDidCatch(r,{componentStack:null!==n?n:""})}),r}function go(e){switch(e.tag){case 2:En(e.type)&&In();var t=e.effectTag;return 1024&t?(e.effectTag=-1025&t|64,e):null;case 3:return En(e.type._reactResult)&&In(),1024&(t=e.effectTag)?(e.effectTag=-1025&t|64,e):null;case 5:return wi(),An(),0!==(64&(t=e.effectTag))&&s("285"),e.effectTag=-1025&t|64,e;case 7:return bi(e),null;case 16:return 1024&(t=e.effectTag)?(e.effectTag=-1025&t|64,e):null;case 6:return wi(),null;case 12:return di(e),null;default:return null}}ro=function(){},no=function(e,t,r,n,o){var s=e.memoizedProps;if(s!==n){var a=t.stateNode;switch(vi(gi.current),e=null,r){case"input":s=_t(a,s),n=_t(a,n),e=[];break;case"option":s=qr(a,s),n=qr(a,n),e=[];break;case"select":s=i({},s,{value:void 0}),n=i({},n,{value:void 0}),e=[];break;case"textarea":s=Jr(a,s),n=Jr(a,n),e=[];break;default:"function"!==typeof s.onClick&&"function"===typeof n.onClick&&(a.onclick=hn)}ln(r,n),a=r=void 0;var c=null;for(r in s)if(!n.hasOwnProperty(r)&&s.hasOwnProperty(r)&&null!=s[r])if("style"===r){var l=s[r];for(a in l)l.hasOwnProperty(a)&&(c||(c={}),c[a]="")}else"dangerouslySetInnerHTML"!==r&&"children"!==r&&"suppressContentEditableWarning"!==r&&"suppressHydrationWarning"!==r&&"autoFocus"!==r&&(_.hasOwnProperty(r)?e||(e=[]):(e=e||[]).push(r,null));for(r in n){var u=n[r];if(l=null!=s?s[r]:void 0,n.hasOwnProperty(r)&&u!==l&&(null!=u||null!=l))if("style"===r)if(l){for(a in l)!l.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(c||(c={}),c[a]="");for(a in u)u.hasOwnProperty(a)&&l[a]!==u[a]&&(c||(c={}),c[a]=u[a])}else c||(e||(e=[]),e.push(r,c)),c=u;else"dangerouslySetInnerHTML"===r?(u=u?u.__html:void 0,l=l?l.__html:void 0,null!=u&&l!==u&&(e=e||[]).push(r,""+u)):"children"===r?l===u||"string"!==typeof u&&"number"!==typeof u||(e=e||[]).push(r,""+u):"suppressContentEditableWarning"!==r&&"suppressHydrationWarning"!==r&&(_.hasOwnProperty(r)?(null!=u&&dn(o,r),e||l===u||(e=[])):(e=e||[]).push(r,u))}c&&(e=e||[]).push("style",c),o=e,(t.updateQueue=o)&&to(t)}},io=function(e,t,r,n){r!==n&&to(t)};var mo={readContext:pi},yo=We.ReactCurrentOwner,vo=0,_o=0,wo=!1,So=null,bo=null,xo=0,Po=!1,Co=null,To=!1,Mo=null;function Eo(){if(null!==So)for(var e=So.return;null!==e;){var t=e;switch(t.tag){case 2:var r=t.type.childContextTypes;null!==r&&void 0!==r&&In();break;case 3:null!==(r=t.type._reactResult.childContextTypes)&&void 0!==r&&In();break;case 5:wi(),An();break;case 7:bi(t);break;case 6:wi();break;case 12:di(t)}e=e.return}bo=null,xo=0,Po=!1,So=null}function Io(e){for(;;){var t=e.alternate,r=e.return,n=e.sibling;if(0===(512&e.effectTag)){var o=t,a=(t=e).pendingProps;switch(t.tag){case 0:case 1:break;case 2:En(t.type)&&In();break;case 3:En(t.type._reactResult)&&In();break;case 5:wi(),An(),(a=t.stateNode).pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),null!==o&&null!==o.child||(ji(t),t.effectTag&=-3),ro(t);break;case 7:bi(t);var c=vi(yi.current),l=t.type;if(null!==o&&null!=t.stateNode)no(o,t,l,a,c),o.ref!==t.ref&&(t.effectTag|=128);else if(a){var u=vi(gi.current);if(ji(t)){o=(a=t).stateNode;var d=a.type,h=a.memoizedProps,p=c;switch(o[F]=a,o[N]=h,l=void 0,c=d){case"iframe":case"object":Pr("load",o);break;case"video":case"audio":for(d=0;d<ne.length;d++)Pr(ne[d],o);break;case"source":Pr("error",o);break;case"img":case"image":case"link":Pr("error",o),Pr("load",o);break;case"form":Pr("reset",o),Pr("submit",o);break;case"details":Pr("toggle",o);break;case"input":wt(o,h),Pr("invalid",o),dn(p,"onChange");break;case"select":o._wrapperState={wasMultiple:!!h.multiple},Pr("invalid",o),dn(p,"onChange");break;case"textarea":Xr(o,h),Pr("invalid",o),dn(p,"onChange")}for(l in ln(c,h),d=null,h)h.hasOwnProperty(l)&&(u=h[l],"children"===l?"string"===typeof u?o.textContent!==u&&(d=["children",u]):"number"===typeof u&&o.textContent!==""+u&&(d=["children",""+u]):_.hasOwnProperty(l)&&null!=u&&dn(p,l));switch(c){case"input":He(o),xt(o,h,!0);break;case"textarea":He(o),Kr(o);break;case"select":case"option":break;default:"function"===typeof h.onClick&&(o.onclick=hn)}l=d,a.updateQueue=l,(a=null!==l)&&to(t)}else{h=t,o=l,p=a,d=9===c.nodeType?c:c.ownerDocument,u===Zr.html&&(u=Qr(o)),u===Zr.html?"script"===o?((o=d.createElement("div")).innerHTML="<script><\/script>",d=o.removeChild(o.firstChild)):"string"===typeof p.is?d=d.createElement(o,{is:p.is}):(d=d.createElement(o),"select"===o&&p.multiple&&(d.multiple=!0)):d=d.createElementNS(u,o),(o=d)[F]=h,o[N]=a;e:for(h=o,p=t,d=p.child;null!==d;){if(7===d.tag||8===d.tag)h.appendChild(d.stateNode);else if(6!==d.tag&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===p)break;for(;null===d.sibling;){if(null===d.return||d.return===p)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}p=o;var f=c,g=un(d=l,h=a);switch(d){case"iframe":case"object":Pr("load",p),c=h;break;case"video":case"audio":for(c=0;c<ne.length;c++)Pr(ne[c],p);c=h;break;case"source":Pr("error",p),c=h;break;case"img":case"image":case"link":Pr("error",p),Pr("load",p),c=h;break;case"form":Pr("reset",p),Pr("submit",p),c=h;break;case"details":Pr("toggle",p),c=h;break;case"input":wt(p,h),c=_t(p,h),Pr("invalid",p),dn(f,"onChange");break;case"option":c=qr(p,h);break;case"select":p._wrapperState={wasMultiple:!!h.multiple},c=i({},h,{value:void 0}),Pr("invalid",p),dn(f,"onChange");break;case"textarea":Xr(p,h),c=Jr(p,h),Pr("invalid",p),dn(f,"onChange");break;default:c=h}ln(d,c),u=void 0;var m=d,y=p,v=c;for(u in v)if(v.hasOwnProperty(u)){var w=v[u];"style"===u?an(y,w):"dangerouslySetInnerHTML"===u?null!=(w=w?w.__html:void 0)&&rn(y,w):"children"===u?"string"===typeof w?("textarea"!==m||""!==w)&&nn(y,w):"number"===typeof w&&nn(y,""+w):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(_.hasOwnProperty(u)?null!=w&&dn(f,u):null!=w&&yt(y,u,w,g))}switch(d){case"input":He(p),xt(p,h,!1);break;case"textarea":He(p),Kr(p);break;case"option":null!=h.value&&p.setAttribute("value",""+vt(h.value));break;case"select":(c=p).multiple=!!h.multiple,null!=(p=h.value)?Wr(c,!!h.multiple,p,!1):null!=h.defaultValue&&Wr(c,!!h.multiple,h.defaultValue,!0);break;default:"function"===typeof c.onClick&&(p.onclick=hn)}(a=gn(l,a))&&to(t),t.stateNode=o}null!==t.ref&&(t.effectTag|=128)}else null===t.stateNode&&s("166");break;case 8:o&&null!=t.stateNode?io(o,t,o.memoizedProps,a):("string"!==typeof a&&(null===t.stateNode&&s("166")),o=vi(yi.current),vi(gi.current),ji(t)?(l=(a=t).stateNode,o=a.memoizedProps,l[F]=a,(a=l.nodeValue!==o)&&to(t)):(l=t,(a=(9===o.nodeType?o:o.ownerDocument).createTextNode(a))[F]=l,t.stateNode=a));break;case 13:case 14:case 16:case 9:case 10:case 15:break;case 6:wi(),ro(t);break;case 12:di(t);break;case 11:break;case 4:s("167");default:s("156")}if(t=So=null,a=e,1073741823===xo||1073741823!==a.childExpirationTime){for(l=0,o=a.child;null!==o;)c=o.expirationTime,h=o.childExpirationTime,(0===l||0!==c&&c<l)&&(l=c),(0===l||0!==h&&h<l)&&(l=h),o=o.sibling;a.childExpirationTime=l}if(null!==t)return t;null!==r&&0===(512&r.effectTag)&&(null===r.firstEffect&&(r.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==r.lastEffect&&(r.lastEffect.nextEffect=e.firstEffect),r.lastEffect=e.lastEffect),1<e.effectTag&&(null!==r.lastEffect?r.lastEffect.nextEffect=e:r.firstEffect=e,r.lastEffect=e))}else{if(null!==(e=go(e)))return e.effectTag&=511,e;null!==r&&(r.firstEffect=r.lastEffect=null,r.effectTag|=512)}if(null!==n)return n;if(null===r)break;e=r}return null}function Ao(e){var t=eo(e.alternate,e,xo);return null===t&&(t=Io(e)),yo.current=null,t}function Ro(e,t,r){wo&&s("243"),wo=!0,yo.currentDispatcher=mo;var n=e.nextExpirationTimeToWorkOn;n===xo&&e===bo&&null!==So||(Eo(),xo=n,So=Un((bo=e).current,null,xo),e.pendingCommitExpirationTime=0);for(var i=!1;;){try{if(t)for(;null!==So&&!ps();)So=Ao(So);else for(;null!==So;)So=Ao(So)}catch(e){if(null===So)i=!0,fs(e);else{null===So&&s("271");var o=So,a=o.return;if(null!==a){e:{var c=a,l=o,u=e;a=xo,l.effectTag|=512,l.firstEffect=l.lastEffect=null,Po=!0,u=oi(u,l);do{switch(c.tag){case 5:c.effectTag|=1024,c.expirationTime=a,$n(c,a=po(c,u,a));break e;case 2:case 3:l=u;var d=c.stateNode;if(0===(64&c.effectTag)&&null!==d&&"function"===typeof d.componentDidCatch&&(null===Mo||!Mo.has(d))){c.effectTag|=1024,c.expirationTime=a,$n(c,a=fo(c,l,a));break e}}c=c.return}while(null!==c)}So=Io(o);continue}i=!0,fs(e)}}break}if(wo=!1,li=ci=ai=yo.currentDispatcher=null,i)bo=null,e.finishedWork=null;else if(null!==So)e.finishedWork=null;else{if(null===(t=e.current.alternate)&&s("281"),bo=null,Po){if(i=e.latestPendingTime,o=e.latestSuspendedTime,a=e.latestPingedTime,0!==i&&i>n||0!==o&&o>n||0!==a&&a>n)return e.didError=!1,0!==(r=e.latestPingedTime)&&r<=n&&(e.latestPingedTime=0),r=e.earliestPendingTime,t=e.latestPendingTime,r===n?e.earliestPendingTime=t===n?e.latestPendingTime=0:t:t===n&&(e.latestPendingTime=r),r=e.earliestSuspendedTime,t=e.latestSuspendedTime,0===r?e.earliestSuspendedTime=e.latestSuspendedTime=n:r>n?e.earliestSuspendedTime=n:t<n&&(e.latestSuspendedTime=n),Wn(n,e),void(e.expirationTime=e.expirationTime);if(!e.didError&&!r)return e.didError=!0,e.nextExpirationTimeToWorkOn=n,n=e.expirationTime=1,void(e.expirationTime=n)}e.pendingCommitExpirationTime=n,e.finishedWork=t}}function Oo(e,t){var r;e:{for(wo&&!To&&s("263"),r=e.return;null!==r;){switch(r.tag){case 2:case 3:var n=r.stateNode;if("function"===typeof r.type.getDerivedStateFromCatch||"function"===typeof n.componentDidCatch&&(null===Mo||!Mo.has(n))){Qn(r,e=fo(r,e=oi(t,e),1)),ko(r,1),r=void 0;break e}break;case 5:Qn(r,e=po(r,e=oi(t,e),1)),ko(r,1),r=void 0;break e}r=r.return}5===e.tag&&(Qn(e,r=po(e,r=oi(t,e),1)),ko(e,1)),r=void 0}return r}function Do(e,t){return 0!==_o?e=_o:wo?e=To?1:xo:1&t.mode?(e=Ko?2+10*(1+((e-2+15)/10|0)):2+25*(1+((e-2+500)/25|0)),null!==bo&&e===xo&&(e+=1)):e=1,Ko&&(0===Go||e>Go)&&(Go=e),e}function ko(e,t){e:{(0===e.expirationTime||e.expirationTime>t)&&(e.expirationTime=t);var r=e.alternate;null!==r&&(0===r.expirationTime||r.expirationTime>t)&&(r.expirationTime=t);var n=e.return;if(null===n&&5===e.tag)e=e.stateNode;else{for(;null!==n;){if(r=n.alternate,(0===n.childExpirationTime||n.childExpirationTime>t)&&(n.childExpirationTime=t),null!==r&&(0===r.childExpirationTime||r.childExpirationTime>t)&&(r.childExpirationTime=t),null===n.return&&5===n.tag){e=n.stateNode;break e}n=n.return}e=null}}null!==e&&(!wo&&0!==xo&&t<xo&&Eo(),qn(e,t),wo&&!To&&bo===e||(t=e,e=e.expirationTime,null===t.nextScheduledRoot?(t.expirationTime=e,null===Lo?(No=Lo=t,t.nextScheduledRoot=t):(Lo=Lo.nextScheduledRoot=t).nextScheduledRoot=No):(0===(r=t.expirationTime)||e<r)&&(t.expirationTime=e),Uo||(Xo?Yo&&(zo=t,jo=1,ds(t,1,!0)):1===e?us(1,null):ss(t,e))),rs>ts&&(rs=0,s("185")))}function Fo(e,t,r,n,i){var o=_o;_o=1;try{return e(t,r,n,i)}finally{_o=o}}var No=null,Lo=null,Bo=0,Vo=void 0,Uo=!1,zo=null,jo=0,Go=0,Ho=!1,qo=!1,Wo=null,Jo=null,Xo=!1,Yo=!1,Ko=!1,Zo=null,Qo=o.unstable_now(),$o=2+(Qo/10|0),es=$o,ts=50,rs=0,ns=null,is=1;function os(){$o=2+((o.unstable_now()-Qo)/10|0)}function ss(e,t){if(0!==Bo){if(t>Bo)return;null!==Vo&&o.unstable_cancelScheduledWork(Vo)}Bo=t,e=o.unstable_now()-Qo,Vo=o.unstable_scheduleWork(ls,{timeout:10*(t-2)-e})}function as(){return Uo?es:(cs(),0!==jo&&1073741823!==jo||(os(),es=$o),es)}function cs(){var e=0,t=null;if(null!==Lo)for(var r=Lo,n=No;null!==n;){var i=n.expirationTime;if(0===i){if((null===r||null===Lo)&&s("244"),n===n.nextScheduledRoot){No=Lo=n.nextScheduledRoot=null;break}if(n===No)No=i=n.nextScheduledRoot,Lo.nextScheduledRoot=i,n.nextScheduledRoot=null;else{if(n===Lo){(Lo=r).nextScheduledRoot=No,n.nextScheduledRoot=null;break}r.nextScheduledRoot=n.nextScheduledRoot,n.nextScheduledRoot=null}n=r.nextScheduledRoot}else{if((0===e||i<e)&&(e=i,t=n),n===Lo)break;if(1===e)break;r=n,n=n.nextScheduledRoot}}zo=t,jo=e}function ls(e){if(e.didTimeout&&null!==No){os();var t=No;do{var r=t.expirationTime;0!==r&&$o>=r&&(t.nextExpirationTimeToWorkOn=$o),t=t.nextScheduledRoot}while(t!==No)}us(0,e)}function us(e,t){if(Jo=t,cs(),null!==Jo)for(os(),es=$o;null!==zo&&0!==jo&&(0===e||e>=jo)&&(!Ho||$o>=jo);)ds(zo,jo,$o>=jo),cs(),os(),es=$o;else for(;null!==zo&&0!==jo&&(0===e||e>=jo);)ds(zo,jo,!0),cs();if(null!==Jo&&(Bo=0,Vo=null),0!==jo&&ss(zo,jo),Jo=null,Ho=!1,rs=0,ns=null,null!==Zo)for(e=Zo,Zo=null,t=0;t<e.length;t++){var r=e[t];try{r._onComplete()}catch(e){qo||(qo=!0,Wo=e)}}if(qo)throw e=Wo,Wo=null,qo=!1,e}function ds(e,t,r){if(Uo&&s("245"),Uo=!0,null===Jo||r){var n=e.finishedWork;null!==n?hs(e,n,t):(e.finishedWork=null,Ro(e,!1,r),null!==(n=e.finishedWork)&&hs(e,n,t))}else null!==(n=e.finishedWork)?hs(e,n,t):(e.finishedWork=null,Ro(e,!0,r),null!==(n=e.finishedWork)&&(ps()?e.finishedWork=n:hs(e,n,t)));Uo=!1}function hs(e,t,r){var n=e.firstBatch;if(null!==n&&n._expirationTime<=r&&(null===Zo?Zo=[n]:Zo.push(n),n._defer))return e.finishedWork=t,void(e.expirationTime=0);e.finishedWork=null,e===ns?rs++:(ns=e,rs=0),To=wo=!0,e.current===t&&s("177"),0===(r=e.pendingCommitExpirationTime)&&s("261"),e.pendingCommitExpirationTime=0,n=t.expirationTime;var i=t.childExpirationTime;if(n=0===n||0!==i&&i<n?i:n,e.didError=!1,0===n?(e.earliestPendingTime=0,e.latestPendingTime=0,e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0):(0!==(i=e.latestPendingTime)&&(i<n?e.earliestPendingTime=e.latestPendingTime=0:e.earliestPendingTime<n&&(e.earliestPendingTime=e.latestPendingTime)),0===(i=e.earliestSuspendedTime)?qn(e,n):n>e.latestSuspendedTime?(e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0,qn(e,n)):n<i&&qn(e,n)),Wn(0,e),yo.current=null,1<t.effectTag?null!==t.lastEffect?(t.lastEffect.nextEffect=t,n=t.firstEffect):n=t:n=t.firstEffect,pn=xr,Nr(i=Fr())){if("selectionStart"in i)var o={start:i.selectionStart,end:i.selectionEnd};else e:{var a=(o=(o=i.ownerDocument)&&o.defaultView||window).getSelection&&o.getSelection();if(a&&0!==a.rangeCount){o=a.anchorNode;var c=a.anchorOffset,l=a.focusNode;a=a.focusOffset;try{o.nodeType,l.nodeType}catch(e){o=null;break e}var u=0,d=-1,h=-1,p=0,f=0,g=i,m=null;t:for(;;){for(var y;g!==o||0!==c&&3!==g.nodeType||(d=u+c),g!==l||0!==a&&3!==g.nodeType||(h=u+a),3===g.nodeType&&(u+=g.nodeValue.length),null!==(y=g.firstChild);)m=g,g=y;for(;;){if(g===i)break t;if(m===o&&++p===c&&(d=u),m===l&&++f===a&&(h=u),null!==(y=g.nextSibling))break;m=(g=m).parentNode}g=y}o=-1===d||-1===h?null:{start:d,end:h}}else o=null}o=o||{start:0,end:0}}else o=null;for(fn={focusedElem:i,selectionRange:o},xr=!1,Co=n;null!==Co;){i=!1,o=void 0;try{for(;null!==Co;){if(256&Co.effectTag){var v=Co.alternate;e:switch(c=Co,c.tag){case 2:case 3:if(256&c.effectTag&&null!==v){var _=v.memoizedProps,w=v.memoizedState,S=c.stateNode;S.props=c.memoizedProps,S.state=c.memoizedState;var b=S.getSnapshotBeforeUpdate(_,w);S.__reactInternalSnapshotBeforeUpdate=b}break e;case 5:case 7:case 8:case 6:break e;default:s("163")}}Co=Co.nextEffect}}catch(e){i=!0,o=e}i&&(null===Co&&s("178"),Oo(Co,o),null!==Co&&(Co=Co.nextEffect))}for(Co=n;null!==Co;){v=!1,_=void 0;try{for(;null!==Co;){var x=Co.effectTag;if(16&x&&nn(Co.stateNode,""),128&x){var P=Co.alternate;if(null!==P){var C=P.ref;null!==C&&("function"===typeof C?C(null):C.current=null)}}switch(14&x){case 2:lo(Co),Co.effectTag&=-3;break;case 6:lo(Co),Co.effectTag&=-3,ho(Co.alternate,Co);break;case 4:ho(Co.alternate,Co);break;case 8:uo(w=Co),w.return=null,w.child=null,w.alternate&&(w.alternate.child=null,w.alternate.return=null)}Co=Co.nextEffect}}catch(e){v=!0,_=e}v&&(null===Co&&s("178"),Oo(Co,_),null!==Co&&(Co=Co.nextEffect))}if(C=fn,P=Fr(),x=C.focusedElem,_=C.selectionRange,P!==x&&x&&x.ownerDocument&&function e(t,r){return!(!t||!r)&&(t===r||(!t||3!==t.nodeType)&&(r&&3===r.nodeType?e(t,r.parentNode):"contains"in t?t.contains(r):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(r))))}(x.ownerDocument.documentElement,x)){null!==_&&Nr(x)&&(P=_.start,void 0===(C=_.end)&&(C=P),"selectionStart"in x?(x.selectionStart=P,x.selectionEnd=Math.min(C,x.value.length)):(P=((v=x.ownerDocument||document)&&v.defaultView||window).getSelection(),w=x.textContent.length,C=Math.min(_.start,w),_=void 0===_.end?C:Math.min(_.end,w),!P.extend&&C>_&&(w=_,_=C,C=w),w=kr(x,C),S=kr(x,_),w&&S&&(1!==P.rangeCount||P.anchorNode!==w.node||P.anchorOffset!==w.offset||P.focusNode!==S.node||P.focusOffset!==S.offset)&&((v=v.createRange()).setStart(w.node,w.offset),P.removeAllRanges(),C>_?(P.addRange(v),P.extend(S.node,S.offset)):(v.setEnd(S.node,S.offset),P.addRange(v))))),P=[];for(C=x;C=C.parentNode;)1===C.nodeType&&P.push({element:C,left:C.scrollLeft,top:C.scrollTop});for("function"===typeof x.focus&&x.focus(),x=0;x<P.length;x++)(C=P[x]).element.scrollLeft=C.left,C.element.scrollTop=C.top}for(fn=null,xr=!!pn,pn=null,e.current=t,Co=n;null!==Co;){n=!1,x=void 0;try{for(P=r;null!==Co;){var T=Co.effectTag;if(36&T){var M=Co.alternate;switch(v=P,(C=Co).tag){case 2:case 3:var E=C.stateNode;if(4&C.effectTag)if(null===M)E.props=C.memoizedProps,E.state=C.memoizedState,E.componentDidMount();else{var I=M.memoizedProps,A=M.memoizedState;E.props=C.memoizedProps,E.state=C.memoizedState,E.componentDidUpdate(I,A,E.__reactInternalSnapshotBeforeUpdate)}var R=C.updateQueue;null!==R&&(E.props=C.memoizedProps,E.state=C.memoizedState,ni(0,R,E));break;case 5:var O=C.updateQueue;if(null!==O){if(_=null,null!==C.child)switch(C.child.tag){case 7:_=C.child.stateNode;break;case 2:case 3:_=C.child.stateNode}ni(0,O,_)}break;case 7:var D=C.stateNode;null===M&&4&C.effectTag&&gn(C.type,C.memoizedProps)&&D.focus();break;case 8:case 6:case 15:case 16:break;default:s("163")}}if(128&T){var k=Co.ref;if(null!==k){var F=Co.stateNode;switch(Co.tag){case 7:var N=F;break;default:N=F}"function"===typeof k?k(N):k.current=N}}var L=Co.nextEffect;Co.nextEffect=null,Co=L}}catch(e){n=!0,x=e}n&&(null===Co&&s("178"),Oo(Co,x),null!==Co&&(Co=Co.nextEffect))}wo=To=!1,"function"===typeof Fn&&Fn(t.stateNode),T=t.expirationTime,t=t.childExpirationTime,0===(t=0===T||0!==t&&t<T?t:T)&&(Mo=null),e.expirationTime=t,e.finishedWork=null}function ps(){return!!Ho||!(null===Jo||Jo.timeRemaining()>is)&&(Ho=!0)}function fs(e){null===zo&&s("246"),zo.expirationTime=0,qo||(qo=!0,Wo=e)}function gs(e,t){var r=Xo;Xo=!0;try{return e(t)}finally{(Xo=r)||Uo||us(1,null)}}function ms(e,t){if(Xo&&!Yo){Yo=!0;try{return e(t)}finally{Yo=!1}}return e(t)}function ys(e,t,r){if(Ko)return e(t,r);Xo||Uo||0===Go||(us(Go,null),Go=0);var n=Ko,i=Xo;Xo=Ko=!0;try{return e(t,r)}finally{Ko=n,(Xo=i)||Uo||us(1,null)}}function vs(e,t,r,n,i){var o=t.current;return r=function(e){if(!e)return xn;e=e._reactInternalFiber;e:{(2!==tr(e)||2!==e.tag&&3!==e.tag)&&s("170");var t=e;do{switch(t.tag){case 5:t=t.stateNode.context;break e;case 2:if(En(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}break;case 3:if(En(t.type._reactResult)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);s("171"),t=void 0}if(2===e.tag){var r=e.type;if(En(r))return On(e,r,t)}else if(3===e.tag&&En(r=e.type._reactResult))return On(e,r,t);return t}(r),null===t.context?t.context=r:t.pendingContext=r,t=i,(i=Kn(n)).payload={element:e},null!==(t=void 0===t?null:t)&&(i.callback=t),Qn(o,i),ko(o,n),n}function _s(e,t,r,n){var i=t.current;return vs(e,t,r,i=Do(as(),i),n)}function ws(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 7:default:return e.child.stateNode}}function Ss(e){var t=2+25*(1+((as()-2+500)/25|0));t<=vo&&(t=vo+1),this._expirationTime=vo=t,this._root=e,this._callbacks=this._next=null,this._hasChildren=this._didComplete=!1,this._children=null,this._defer=!0}function bs(){this._callbacks=null,this._didCommit=!1,this._onCommit=this._onCommit.bind(this)}function xs(e,t,r){e={current:t=new Bn(5,null,null,t?3:0),containerInfo:e,pendingChildren:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:-1,context:null,pendingContext:null,hydrate:r,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null},this._internalRoot=t.stateNode=e}function Ps(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Cs(e,t,r,n,i){Ps(r)||s("200");var o=r._reactRootContainer;if(o){if("function"===typeof i){var a=i;i=function(){var e=ws(o._internalRoot);a.call(e)}}null!=e?o.legacy_renderSubtreeIntoContainer(e,t,i):o.render(t,i)}else{if(o=r._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var r;r=e.lastChild;)e.removeChild(r);return new xs(e,!1,t)}(r,n),"function"===typeof i){var c=i;i=function(){var e=ws(o._internalRoot);c.call(e)}}ms(function(){null!=e?o.legacy_renderSubtreeIntoContainer(e,t,i):o.render(t,i)})}return ws(o._internalRoot)}function Ts(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Ps(t)||s("200"),function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:Ke,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}}(e,t,null,r)}Ee=function(e,t,r){switch(t){case"input":if(bt(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=U(n);i||s("90"),qe(n),bt(n,i)}}}break;case"textarea":Yr(e,r);break;case"select":null!=(t=r.value)&&Wr(e,!!r.multiple,t,!1)}},Ss.prototype.render=function(e){this._defer||s("250"),this._hasChildren=!0,this._children=e;var t=this._root._internalRoot,r=this._expirationTime,n=new bs;return vs(e,t,null,r,n._onCommit),n},Ss.prototype.then=function(e){if(this._didComplete)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},Ss.prototype.commit=function(){var e=this._root._internalRoot,t=e.firstBatch;if(this._defer&&null!==t||s("251"),this._hasChildren){var r=this._expirationTime;if(t!==this){this._hasChildren&&(r=this._expirationTime=t._expirationTime,this.render(this._children));for(var n=null,i=t;i!==this;)n=i,i=i._next;null===n&&s("251"),n._next=i._next,this._next=t,e.firstBatch=this}this._defer=!1,t=r,Uo&&s("253"),zo=e,jo=t,ds(e,t,!0),us(1,null),t=this._next,this._next=null,null!==(t=e.firstBatch=t)&&t._hasChildren&&t.render(t._children)}else this._next=null,this._defer=!1},Ss.prototype._onComplete=function(){if(!this._didComplete){this._didComplete=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++)(0,e[t])()}},bs.prototype.then=function(e){if(this._didCommit)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},bs.prototype._onCommit=function(){if(!this._didCommit){this._didCommit=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++){var r=e[t];"function"!==typeof r&&s("191",r),r()}}},xs.prototype.render=function(e,t){var r=this._internalRoot,n=new bs;return null!==(t=void 0===t?null:t)&&n.then(t),_s(e,r,null,n._onCommit),n},xs.prototype.unmount=function(e){var t=this._internalRoot,r=new bs;return null!==(e=void 0===e?null:e)&&r.then(e),_s(null,t,null,r._onCommit),r},xs.prototype.legacy_renderSubtreeIntoContainer=function(e,t,r){var n=this._internalRoot,i=new bs;return null!==(r=void 0===r?null:r)&&i.then(r),_s(t,n,e,i._onCommit),i},xs.prototype.createBatch=function(){var e=new Ss(this),t=e._expirationTime,r=this._internalRoot,n=r.firstBatch;if(null===n)r.firstBatch=e,e._next=null;else{for(r=null;null!==n&&n._expirationTime<=t;)r=n,n=n._next;e._next=n,null!==r&&(r._next=e)}return e},ke=gs,Fe=ys,Ne=function(){Uo||0===Go||(us(Go,null),Go=0)};var Ms={createPortal:Ts,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;return void 0===t&&("function"===typeof e.render?s("188"):s("268",Object.keys(e))),e=null===(e=nr(t))?null:e.stateNode},hydrate:function(e,t,r){return Cs(null,e,t,!0,r)},render:function(e,t,r){return Cs(null,e,t,!1,r)},unstable_renderSubtreeIntoContainer:function(e,t,r,n){return(null==e||void 0===e._reactInternalFiber)&&s("38"),Cs(e,t,r,!1,n)},unmountComponentAtNode:function(e){return Ps(e)||s("40"),!!e._reactRootContainer&&(ms(function(){Cs(null,null,e,!1,function(){e._reactRootContainer=null})}),!0)},unstable_createPortal:function(){return Ts.apply(void 0,arguments)},unstable_batchedUpdates:gs,unstable_interactiveUpdates:ys,flushSync:function(e,t){Uo&&s("187");var r=Xo;Xo=!0;try{return Fo(e,t)}finally{Xo=r,us(1,null)}},unstable_flushControlled:function(e){var t=Xo;Xo=!0;try{Fo(e)}finally{(Xo=t)||Uo||us(1,null)}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[B,V,U,R.injectEventPluginsByName,v,W,function(e){T(e,q)},Oe,De,Mr,D]},unstable_createRoot:function(e,t){return Ps(e)||s("278"),new xs(e,!0,null!=t&&!0===t.hydrate)}};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var r=t.inject(e);Fn=Ln(function(e){return t.onCommitFiberRoot(r,e)}),Nn=Ln(function(e){return t.onCommitFiberUnmount(r,e)})}catch(e){}})(i({},e,{findHostInstanceByFiber:function(e){return null===(e=nr(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null}}))}({findFiberByHostInstance:L,bundleType:0,version:"16.5.2",rendererPackageName:"react-dom"});var Es={default:Ms},Is=Es&&Ms||Es;e.exports=Is.default||Is},function(e,t,r){"use strict";e.exports=r(390)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=null,i=!1,o=!1,s="object"===typeof performance&&"function"===typeof performance.now,a={timeRemaining:s?function(){var e=g()-performance.now();return 0<e?e:0}:function(){var e=g()-Date.now();return 0<e?e:0},didTimeout:!1};function c(){if(!i){var e=n.timesOutAt;o?f():o=!0,p(u,e)}}function l(){var e=n,t=n.next;if(n===t)n=null;else{var r=n.previous;n=r.next=t,t.previous=r}e.next=e.previous=null,(e=e.callback)(a)}function u(e){i=!0,a.didTimeout=e;try{if(e)for(;null!==n;){var r=t.unstable_now();if(!(n.timesOutAt<=r))break;do{l()}while(null!==n&&n.timesOutAt<=r)}else if(null!==n)do{l()}while(null!==n&&0<g()-t.unstable_now())}finally{i=!1,null!==n?c():o=!1}}var d,h,p,f,g,m=Date,y="function"===typeof setTimeout?setTimeout:void 0,v="function"===typeof clearTimeout?clearTimeout:void 0,_="function"===typeof requestAnimationFrame?requestAnimationFrame:void 0,w="function"===typeof cancelAnimationFrame?cancelAnimationFrame:void 0;function S(e){d=_(function(t){v(h),e(t)}),h=y(function(){w(d),e(t.unstable_now())},100)}if(s){var b=performance;t.unstable_now=function(){return b.now()}}else t.unstable_now=function(){return m.now()};if("undefined"===typeof window){var x=-1;p=function(e){x=setTimeout(e,0,!0)},f=function(){clearTimeout(x)},g=function(){return 0}}else if(window._schedMock){var P=window._schedMock;p=P[0],f=P[1],g=P[2]}else{"undefined"!==typeof console&&("function"!==typeof _&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof w&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));var C=null,T=!1,M=-1,E=!1,I=!1,A=0,R=33,O=33;g=function(){return A};var D="__reactIdleCallback$"+Math.random().toString(36).slice(2);window.addEventListener("message",function(e){if(e.source===window&&e.data===D){T=!1;var r=t.unstable_now();if(e=!1,0>=A-r){if(!(-1!==M&&M<=r))return void(E||(E=!0,S(k)));e=!0}if(M=-1,r=C,C=null,null!==r){I=!0;try{r(e)}finally{I=!1}}}},!1);var k=function(e){E=!1;var t=e-A+O;t<O&&R<O?(8>t&&(t=8),O=t<R?R:t):R=t,A=e+O,T||(T=!0,window.postMessage(D,"*"))};p=function(e,t){C=e,M=t,I?window.postMessage(D,"*"):E||(E=!0,S(k))},f=function(){C=null,T=!1,M=-1}}t.unstable_scheduleWork=function(e,r){var i=t.unstable_now();if(e={callback:e,timesOutAt:r=void 0!==r&&null!==r&&null!==r.timeout&&void 0!==r.timeout?i+r.timeout:i+5e3,next:null,previous:null},null===n)n=e.next=e.previous=e,c();else{i=null;var o=n;do{if(o.timesOutAt>r){i=o;break}o=o.next}while(o!==n);null===i?i=n:i===n&&(n=e,c()),(r=i.previous).next=i.previous=e,e.next=i,e.previous=r}return e},t.unstable_cancelScheduledWork=function(e){var t=e.next;if(null!==t){if(t===e)n=null;else{e===n&&(n=t);var r=e.previous;r.next=t,t.previous=r}e.next=e.previous=null}}},,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error("Assert: "+(void 0!==t?t:"Programmer Error"))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class EventContext{constructor(e,t,r){this.listener=e,this.scope=t,this.once=r}}class BeEvent{constructor(){this._listeners=[],this._insideRaiseEvent=!1}get numberOfListeners(){return this._listeners.length}addListener(e,t){this._listeners.push(new EventContext(e,t,!1));const r=this;return()=>{r.removeListener(e,t)}}addOnce(e,t){this._listeners.push(new EventContext(e,t,!0));const r=this;return()=>{r.removeListener(e,t)}}removeListener(e,t){const r=this._listeners;for(let n=0;n<r.length;++n){const i=r[n];if(i.listener===e&&i.scope===t)return this._insideRaiseEvent?i.listener=void 0:r.splice(n,1),!0}return!1}raiseEvent(...e){this._insideRaiseEvent=!0;const t=this._listeners;let r=t.length,n=!1;for(let i=0;i<r;++i){const e=t[i];e.listener?(e.listener.apply(e.scope,arguments),e.once&&(e.listener=void 0,n=!0)):n=!0,n&&(this._listeners.length=0,t.forEach(e=>{e.listener&&this._listeners.push(e)}),r=t.length)}this._insideRaiseEvent=!1}has(e,t){for(const r of this._listeners)if(r.listener===e&&r.scope===t)return!0;return!1}clear(){this._listeners.length=0}}t.BeEvent=BeEvent;t.BeUiEvent=class BeUiEvent extends BeEvent{emit(e){this.raiseEvent(e)}};t.BeEventList=class BeEventList{constructor(){this._events={}}get(e){let t=this._events[e];return t||(t=new BeEvent,this._events[e]=t,t)}remove(e){this._events[e]=void 0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Readonly=1]="Readonly",e[e.ReadWrite=2]="ReadWrite"}(t.OpenMode||(t.OpenMode={})),function(e){e[e.Delete=9]="Delete",e[e.Insert=18]="Insert",e[e.Update=23]="Update"}(t.DbOpcode||(t.DbOpcode={})),function(e){e[e.BE_SQLITE_OK=0]="BE_SQLITE_OK",e[e.BE_SQLITE_ERROR=1]="BE_SQLITE_ERROR",e[e.BE_SQLITE_INTERNAL=2]="BE_SQLITE_INTERNAL",e[e.BE_SQLITE_PERM=3]="BE_SQLITE_PERM",e[e.BE_SQLITE_ABORT=4]="BE_SQLITE_ABORT",e[e.BE_SQLITE_BUSY=5]="BE_SQLITE_BUSY",e[e.BE_SQLITE_LOCKED=6]="BE_SQLITE_LOCKED",e[e.BE_SQLITE_NOMEM=7]="BE_SQLITE_NOMEM",e[e.BE_SQLITE_READONLY=8]="BE_SQLITE_READONLY",e[e.BE_SQLITE_INTERRUPT=9]="BE_SQLITE_INTERRUPT",e[e.BE_SQLITE_IOERR=10]="BE_SQLITE_IOERR",e[e.BE_SQLITE_CORRUPT=11]="BE_SQLITE_CORRUPT",e[e.BE_SQLITE_NOTFOUND=12]="BE_SQLITE_NOTFOUND",e[e.BE_SQLITE_FULL=13]="BE_SQLITE_FULL",e[e.BE_SQLITE_CANTOPEN=14]="BE_SQLITE_CANTOPEN",e[e.BE_SQLITE_PROTOCOL=15]="BE_SQLITE_PROTOCOL",e[e.BE_SQLITE_EMPTY=16]="BE_SQLITE_EMPTY",e[e.BE_SQLITE_SCHEMA=17]="BE_SQLITE_SCHEMA",e[e.BE_SQLITE_TOOBIG=18]="BE_SQLITE_TOOBIG",e[e.BE_SQLITE_CONSTRAINT_BASE=19]="BE_SQLITE_CONSTRAINT_BASE",e[e.BE_SQLITE_MISMATCH=20]="BE_SQLITE_MISMATCH",e[e.BE_SQLITE_MISUSE=21]="BE_SQLITE_MISUSE",e[e.BE_SQLITE_NOLFS=22]="BE_SQLITE_NOLFS",e[e.BE_SQLITE_AUTH=23]="BE_SQLITE_AUTH",e[e.BE_SQLITE_FORMAT=24]="BE_SQLITE_FORMAT",e[e.BE_SQLITE_RANGE=25]="BE_SQLITE_RANGE",e[e.BE_SQLITE_NOTADB=26]="BE_SQLITE_NOTADB",e[e.BE_SQLITE_ROW=100]="BE_SQLITE_ROW",e[e.BE_SQLITE_DONE=101]="BE_SQLITE_DONE",e[e.BE_SQLITE_IOERR_READ=266]="BE_SQLITE_IOERR_READ",e[e.BE_SQLITE_IOERR_SHORT_READ=522]="BE_SQLITE_IOERR_SHORT_READ",e[e.BE_SQLITE_IOERR_WRITE=778]="BE_SQLITE_IOERR_WRITE",e[e.BE_SQLITE_IOERR_FSYNC=1034]="BE_SQLITE_IOERR_FSYNC",e[e.BE_SQLITE_IOERR_DIR_FSYNC=1290]="BE_SQLITE_IOERR_DIR_FSYNC",e[e.BE_SQLITE_IOERR_TRUNCATE=1546]="BE_SQLITE_IOERR_TRUNCATE",e[e.BE_SQLITE_IOERR_FSTAT=1802]="BE_SQLITE_IOERR_FSTAT",e[e.BE_SQLITE_IOERR_UNLOCK=2058]="BE_SQLITE_IOERR_UNLOCK",e[e.BE_SQLITE_IOERR_RDLOCK=2314]="BE_SQLITE_IOERR_RDLOCK",e[e.BE_SQLITE_IOERR_DELETE=2570]="BE_SQLITE_IOERR_DELETE",e[e.BE_SQLITE_IOERR_BLOCKED=2826]="BE_SQLITE_IOERR_BLOCKED",e[e.BE_SQLITE_IOERR_NOMEM=3082]="BE_SQLITE_IOERR_NOMEM",e[e.BE_SQLITE_IOERR_ACCESS=3338]="BE_SQLITE_IOERR_ACCESS",e[e.BE_SQLITE_IOERR_CHECKRESERVEDLOCK=3594]="BE_SQLITE_IOERR_CHECKRESERVEDLOCK",e[e.BE_SQLITE_IOERR_LOCK=3850]="BE_SQLITE_IOERR_LOCK",e[e.BE_SQLITE_IOERR_CLOSE=4106]="BE_SQLITE_IOERR_CLOSE",e[e.BE_SQLITE_IOERR_DIR_CLOSE=4362]="BE_SQLITE_IOERR_DIR_CLOSE",e[e.BE_SQLITE_IOERR_SHMOPEN=4618]="BE_SQLITE_IOERR_SHMOPEN",e[e.BE_SQLITE_IOERR_SHMSIZE=4874]="BE_SQLITE_IOERR_SHMSIZE",e[e.BE_SQLITE_IOERR_SHMLOCK=5130]="BE_SQLITE_IOERR_SHMLOCK",e[e.BE_SQLITE_IOERR_SHMMAP=5386]="BE_SQLITE_IOERR_SHMMAP",e[e.BE_SQLITE_IOERR_SEEK=5642]="BE_SQLITE_IOERR_SEEK",e[e.BE_SQLITE_IOERR_DELETE_NOENT=5898]="BE_SQLITE_IOERR_DELETE_NOENT",e[e.BE_SQLITE_ERROR_FileExists=16777226]="BE_SQLITE_ERROR_FileExists",e[e.BE_SQLITE_ERROR_AlreadyOpen=33554442]="BE_SQLITE_ERROR_AlreadyOpen",e[e.BE_SQLITE_ERROR_NoPropertyTable=50331658]="BE_SQLITE_ERROR_NoPropertyTable",e[e.BE_SQLITE_ERROR_FileNotFound=67108874]="BE_SQLITE_ERROR_FileNotFound",e[e.BE_SQLITE_ERROR_NoTxnActive=83886090]="BE_SQLITE_ERROR_NoTxnActive",e[e.BE_SQLITE_ERROR_BadDbProfile=100663306]="BE_SQLITE_ERROR_BadDbProfile",e[e.BE_SQLITE_ERROR_InvalidProfileVersion=117440522]="BE_SQLITE_ERROR_InvalidProfileVersion",e[e.BE_SQLITE_ERROR_ProfileUpgradeFailed=134217738]="BE_SQLITE_ERROR_ProfileUpgradeFailed",e[e.BE_SQLITE_ERROR_ProfileTooOldForReadWrite=150994954]="BE_SQLITE_ERROR_ProfileTooOldForReadWrite",e[e.BE_SQLITE_ERROR_ProfileTooOld=167772170]="BE_SQLITE_ERROR_ProfileTooOld",e[e.BE_SQLITE_ERROR_ProfileTooNewForReadWrite=184549386]="BE_SQLITE_ERROR_ProfileTooNewForReadWrite",e[e.BE_SQLITE_ERROR_ProfileTooNew=201326602]="BE_SQLITE_ERROR_ProfileTooNew",e[e.BE_SQLITE_ERROR_ChangeTrackError=218103818]="BE_SQLITE_ERROR_ChangeTrackError",e[e.BE_SQLITE_ERROR_InvalidChangeSetVersion=234881034]="BE_SQLITE_ERROR_InvalidChangeSetVersion",e[e.BE_SQLITE_ERROR_SchemaUpgradeRequired=251658250]="BE_SQLITE_ERROR_SchemaUpgradeRequired",e[e.BE_SQLITE_ERROR_SchemaTooNew=268435466]="BE_SQLITE_ERROR_SchemaTooNew",e[e.BE_SQLITE_ERROR_SchemaTooOld=285212682]="BE_SQLITE_ERROR_SchemaTooOld",e[e.BE_SQLITE_ERROR_SchemaLockFailed=301989898]="BE_SQLITE_ERROR_SchemaLockFailed",e[e.BE_SQLITE_ERROR_SchemaUpgradeFailed=318767114]="BE_SQLITE_ERROR_SchemaUpgradeFailed",e[e.BE_SQLITE_ERROR_SchemaImportFailed=335544330]="BE_SQLITE_ERROR_SchemaImportFailed",e[e.BE_SQLITE_ERROR_CouldNotAcquireLocksOrCodes=352321546]="BE_SQLITE_ERROR_CouldNotAcquireLocksOrCodes",e[e.BE_SQLITE_LOCKED_SHAREDCACHE=262]="BE_SQLITE_LOCKED_SHAREDCACHE",e[e.BE_SQLITE_BUSY_RECOVERY=261]="BE_SQLITE_BUSY_RECOVERY",e[e.BE_SQLITE_CANTOPEN_NOTEMPDIR=270]="BE_SQLITE_CANTOPEN_NOTEMPDIR",e[e.BE_SQLITE_CANTOPEN_ISDIR=526]="BE_SQLITE_CANTOPEN_ISDIR",e[e.BE_SQLITE_CANTOPEN_FULLPATH=782]="BE_SQLITE_CANTOPEN_FULLPATH",e[e.BE_SQLITE_CORRUPT_VTAB=267]="BE_SQLITE_CORRUPT_VTAB",e[e.BE_SQLITE_READONLY_RECOVERY=264]="BE_SQLITE_READONLY_RECOVERY",e[e.BE_SQLITE_READONLY_CANTLOCK=520]="BE_SQLITE_READONLY_CANTLOCK",e[e.BE_SQLITE_READONLY_ROLLBACK=776]="BE_SQLITE_READONLY_ROLLBACK",e[e.BE_SQLITE_ABORT_ROLLBACK=516]="BE_SQLITE_ABORT_ROLLBACK",e[e.BE_SQLITE_CONSTRAINT_CHECK=275]="BE_SQLITE_CONSTRAINT_CHECK",e[e.BE_SQLITE_CONSTRAINT_COMMITHOOK=531]="BE_SQLITE_CONSTRAINT_COMMITHOOK",e[e.BE_SQLITE_CONSTRAINT_FOREIGNKEY=787]="BE_SQLITE_CONSTRAINT_FOREIGNKEY",e[e.BE_SQLITE_CONSTRAINT_FUNCTION=1043]="BE_SQLITE_CONSTRAINT_FUNCTION",e[e.BE_SQLITE_CONSTRAINT_NOTNULL=1299]="BE_SQLITE_CONSTRAINT_NOTNULL",e[e.BE_SQLITE_CONSTRAINT_PRIMARYKEY=1555]="BE_SQLITE_CONSTRAINT_PRIMARYKEY",e[e.BE_SQLITE_CONSTRAINT_TRIGGER=1811]="BE_SQLITE_CONSTRAINT_TRIGGER",e[e.BE_SQLITE_CONSTRAINT_UNIQUE=2067]="BE_SQLITE_CONSTRAINT_UNIQUE",e[e.BE_SQLITE_CONSTRAINT_VTAB=2323]="BE_SQLITE_CONSTRAINT_VTAB"}(t.DbResult||(t.DbResult={})),function(e){e[e.None=0]="None",e[e.Merge=1]="Merge",e[e.Reverse=2]="Reverse",e[e.Reinstate=3]="Reinstate"}(t.ChangeSetApplyOption||(t.ChangeSetApplyOption={}))},function(e,t,r){"use strict";function n(e,t){return e===t?0:e<t?-1:1}function i(e,t,r){return void 0===t?void 0===r?0:-1:void 0===r?1:e(t,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.compareWithTolerance=function(e,t,r=.1){return e<t-r?-1:e>t+r?1:0},t.compareNumbers=function(e,t){return e-t},t.compareBooleans=function(e,t){return e!==t?e<t?-1:1:0},t.compareStrings=n,t.compare=function(e,t){return e.compare(t)},t.comparePossiblyUndefined=i,t.compareStringsOrUndefined=function(e,t){return i(n,e,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(162);t.Dictionary=class Dictionary{constructor(e,t=n.defaultClone,r=n.defaultClone){this._keys=[],this._values=[],this._compareKeys=e,this._cloneKey=t,this._cloneValue=r}get length(){return this._keys.length}clear(){this._keys=[],this._values=[]}get(e){const t=this.lowerBound(e);return t.equal?this._values[t.index]:void 0}delete(e){const t=this.lowerBound(e);t.equal&&(this._values.splice(t.index,1),this._keys.splice(t.index,1))}insert(e,t){const r=this.lowerBound(e);return r.equal||(this._keys.splice(r.index,0,this._cloneKey(e)),this._values.splice(r.index,0,this._cloneValue(t))),!r.equal}set(e,t){t=this._cloneValue(t);const r=this.lowerBound(e);r.equal?this._values[r.index]=t:(this._keys.splice(r.index,0,this._cloneKey(e)),this._values.splice(r.index,0,t))}extractPairs(){const e=[];for(let t=0;t<this.length;t++)e.push({key:this._keys[t],value:this._values[t]});return this.clear(),e}extractArrays(){const e={keys:this._keys,values:this._values};return this.clear(),e}lowerBound(e){return n.lowerBound(e,this._keys,this._compareKeys)}}},function(e,t,r){"use strict";function n(e){void 0!==e&&e.dispose()}Object.defineProperty(t,"__esModule",{value:!0}),t.dispose=n,t.disposeArray=function(e){if(void 0!==e){for(const t of e)n(t);e.length=0}},t.using=function e(t,r){if(!Array.isArray(t))return e([t],r);const n=()=>t.forEach(e=>e.dispose());let i=!0;try{const e=r.apply(void 0,t);return e&&e.then&&(i=!1,e.then(n,n)),e}finally{i&&n()}};class FuncDisposable{constructor(e){this._disposeFunc=e}dispose(){this._disposeFunc()}}t.DisposableList=class DisposableList{constructor(e=[]){this._disposables=[],e.forEach(e=>{this.add(e)})}isDisposable(e){return void 0!==e.dispose}add(e){this.isDisposable(e)?this._disposables.push(e):this._disposables.push(new FuncDisposable(e))}remove(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}dispose(){for(const e of this._disposables)e.dispose()}}},function(e,t,r){"use strict";function n(e){const t=parseInt(e,16);return Number.isNaN(t)?0:t}function i(e,t,r=!0){const n=e.charCodeAt(t);return n>=(r?48:49)&&n<=57||n>=97&&n<=102}function o(e,t,r){if(0===r)return!1;if(!i(e,t,!1))return!1;for(let n=1;n<r;n++)if(!i(e,t+n))return!1;return!0}var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(t,r){if("number"!==typeof t||"number"!==typeof r)return e.invalid;if(0===(t=Math.floor(t)))return e.invalid;r=Math.floor(r);const n=t.toString(16);return"0x"+(0===r?n:r.toString(16)+("0000000000"+n).substr(-10))}function r(e){const t=e.toString();return 18===t.length&&t.startsWith("0xffffff")}function i(t){return e.invalid!==t&&e.isId64(t)}function s(t){return e.invalid===t}e.getLocalId=function(e){if(s(e))return 0;let t=2;const r=e.length;return r>12&&(t=r-10),n(e.slice(t))},e.getBriefcaseId=function(e){if(s(e))return 0;const t=e.toString();let r=2;const i=t.length;return i<=12?0:(r=i-10,n(t.slice(2,r)))},e.fromJSON=function(t){return"string"===typeof t?e.fromString(t):e.invalid},e.fromString=function(r){if("string"!==typeof r)return e.invalid;if(e.isId64(r))return r;const i=(r=r.toLowerCase().trim()).length;if(i<2||"0"!==r[0]||"x"!==r[1])return e.invalid;let o=0,s=0,a=2;return i>12&&(a=i-10,s=n(r.slice(2,a))),t(o=n(r.slice(a)),s)},e.fromLocalAndBriefcaseIds=t,e.fromUint32Pair=function(t,r){const n=(t>>>0)+4294967296*(255&r),i=(4294967040&r)>>>8;return e.fromLocalAndBriefcaseIds(n,i)},e.getLowerUint32=function(e){if(s(e))return 0;const t=e.toString();let r=2;const i=t.length;return i>10&&(r=i-8),n(t.slice(r))},e.getUpperUint32=function(e){if(s(e))return 0;const t=e.length;if(t<=10)return 0;const r=t-8;return n(e.slice(2,r))},e.toIdSet=function(e){if(e instanceof Set)return e;const t=new Set;return"string"===typeof e?t.add(e):Array.isArray(e)&&e.forEach(e=>{"string"===typeof e&&t.add(e)}),t},e.invalid="0",e.isTransient=r,e.isTransientId64=function(e){return i(e)&&r(e)},e.isId64=function(e){const t=e.length;if(0===t)return!1;if("0"!==e[0])return!1;if(1===t)return!0;if(2===t||"x"!==e[1])return!1;let r=2;if(t>12){if(!o(e,2,(r=t-10)-2))return!1;for(let n=r;n<t&&48===e.charCodeAt(n);n++)r++;if(r>=t)return!1}return o(e,r,t-r)},e.isValid=function(t){return e.invalid!==t},e.isValidId64=i,e.isInvalid=s}(s=t.Id64||(t.Id64={}));t.TransientIdSequence=class TransientIdSequence{constructor(){this._localId=0}get next(){return s.fromLocalAndBriefcaseIds(++this._localId,16777215)}},function(e){const t=new RegExp("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$");e.isGuid=function(e){return t.test(e)},e.isV4Guid=function(e){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(e)},e.createValue=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}(t.Guid||(t.Guid={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(162);class IndexedValue{constructor(e,t){this.value=e,this.index=t}}t.IndexedValue=IndexedValue;t.IndexMap=class IndexMap{constructor(e,t=Number.MAX_SAFE_INTEGER,r=n.defaultClone){this._array=[],this._compareValues=e,this._clone=r,this._maximumSize=t}get length(){return this._array.length}get isFull(){return this.length>=this._maximumSize}get isEmpty(){return 0===this.length}clear(){this._array=[]}insert(e,t){const r=this.lowerBound(e);if(r.equal)return this._array[r.index].index;if(this.isFull)return-1;const n=new IndexedValue(this._clone(e),this._array.length);return void 0!==t&&t(n.value),this._array.splice(r.index,0,n),n.index}indexOf(e){const t=this.lowerBound(e);return t.equal?this._array[t.index].index:-1}lowerBound(e){return n.lowerBound(e,this._array,(e,t)=>this._compareValues(e,t.value))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return null===e||void 0===e}e.asBool=function(e,r=!1){return t(e)?r:!!e},e.asInt=function(e,t=0){return"number"===typeof e?Math.trunc(e):t},e.asDouble=function(e,t=0){return"number"===typeof e?e:t},e.asString=function(e,r=""){return t(e)?r:e.toString()},e.asArray=function(e){return Array.isArray(e)?e:void 0},e.asObject=function(e){return"object"===typeof e?e:void 0},e.setOrRemoveNumber=function(e,t,r,n){r===n?delete e[t]:e[t]=r},e.setOrRemoveBoolean=function(e,t,r,n){r===n?delete e[t]:e[t]=r},e.toObject=function e(t){if("boolean"===typeof t||"number"===typeof t||"string"===typeof t)return t;if("object"!==typeof t)return;if("undefined"!==typeof t.toJSON)return e(t.toJSON());if(Array.isArray(t)){const r=new Array(t.length);return t.forEach((t,n)=>{r[n]=e(t)}),r}const r={};return Object.getOwnPropertyNames(t).forEach(n=>{const i=e(t[n]);void 0!==i&&(r[n]=i)}),r}}(t.JsonUtils||(t.JsonUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class Entry{constructor(e,t){this.key=e,this.value=t}}t.Entry=Entry;class EntryIterator{constructor(e){this._entry=e}next(){const e=this._entry;return e?(this._entry=e.newer,{done:!1,value:[e.key,e.value]}):{done:!0,value:void 0}}}class KeyIterator{constructor(e){this._entry=e}next(){const e=this._entry;return e?(this._entry=e.newer,{done:!1,value:e.key}):{done:!0,value:void 0}}}class ValueIterator{constructor(e){this._entry=e}next(){const e=this._entry;return e?(this._entry=e.newer,{done:!1,value:e.value}):{done:!0,value:void 0}}}t.LRUMap=class LRUMap{constructor(e){this.size=0,this.limit=e,this.oldest=this.newest=void 0,this._keymap=new Map}markEntryAsUsed(e){e!==this.newest&&(e.newer&&(e===this.oldest&&(this.oldest=e.newer),e.newer.older=e.older),e.older&&(e.older.newer=e.newer),e.newer=void 0,e.older=this.newest,this.newest&&(this.newest.newer=e),this.newest=e)}assign(e){let t,r=this.limit||Number.MAX_VALUE;this._keymap.clear();const n=e[Symbol.iterator]();for(let i=n.next();!i.done;i=n.next()){const e=new Entry(i.value[0],i.value[1]);if(this._keymap.set(e.key,e),t?(t.newer=e,e.older=t):this.oldest=e,t=e,0===r--)throw new Error("overflow")}this.newest=t,this.size=this._keymap.size}get(e){const t=this._keymap.get(e);if(t)return this.markEntryAsUsed(t),t.value}set(e,t){let r=this._keymap.get(e);return r?(r.value=t,this.markEntryAsUsed(r),this):(this._keymap.set(e,r=new Entry(e,t)),this.newest?(this.newest.newer=r,r.older=this.newest):this.oldest=r,this.newest=r,++this.size,this.size>this.limit&&this.shift(),this)}shift(){const e=this.oldest;if(e)return e.newer?(this.oldest=e.newer,this.oldest.older=void 0):(this.oldest=void 0,this.newest=void 0),e.newer=e.older=void 0,this._keymap.delete(e.key),--this.size,[e.key,e.value]}find(e){const t=this._keymap.get(e);return t?t.value:void 0}has(e){return this._keymap.has(e)}delete(e){const t=this._keymap.get(e);if(t)return this._keymap.delete(t.key),t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=void 0,this.oldest=t.newer):t.older?(t.older.newer=void 0,this.newest=t.older):this.oldest=this.newest=void 0,this.size--,t.value}clear(){this.oldest=this.newest=void 0,this.size=0,this._keymap.clear()}keys(){return this.oldest?new KeyIterator(this.oldest):void 0}values(){return this.oldest?new ValueIterator(this.oldest):void 0}entries(){return this.oldest?new EntryIterator(this.oldest):void 0}forEach(e,t){"object"!==typeof t&&(t=this);let r=this.oldest;for(;r;)e.call(t,r.value,r.key,this),r=r.newer}toJSON(){const e=new Array(this.size);let t=0,r=this.oldest;for(;r;)e[t++]={key:r.key,value:r.value},r=r.newer;return e}toString(){let e="",t=this.oldest;for(;t;)e+=String(t.key)+":"+t.value,(t=t.newer)&&(e+=" < ");return e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class BusyError extends Error{static check(e){if(!(e instanceof BusyError||"abort"===e.message))throw e}}t.BusyError=BusyError;class PromiseWithAbort{constructor(e,t){this._run=e,this._args=t}init(e){return new Promise((t,r)=>{this.abort=(()=>r(new BusyError(e))),this._resolve=t})}start(){this._run(this._args).then(e=>this._resolve(e))}}t.OneAtATimePromise=class OneAtATimePromise{constructor(e,t,r=!0){this._msg=e,this._run=t,this._allowPending=r}async addRequest(...e){const t=new PromiseWithAbort(this._run,e),r=t.init(this._msg);return void 0!==this._active?(this._pending&&this._pending.abort(),this._allowPending&&(this._pending=t)):(this._active=t,t.start()),await r,this._active=this._pending,this._pending=void 0,this._active&&this._active.start(),r}}},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,r){return t<=e&&e<=r}e.decodeWithFromCharCode=function(e){let r="";const n=function(e){let r=0,n=0,i=0,o=128,s=191;const a=[],c=e.length;for(let l=0;l<c;l++){const c=e[l];if(0===i){if(t(c,0,127)){a.push(c);continue}if(t(c,194,223)){i=1,r=31&c;continue}if(t(c,224,239)){224===c?o=160:237===c&&(s=159),i=2,r=15&c;continue}if(t(c,240,244)){240===c?o=144:244===c&&(s=143),i=3,r=7&c;continue}return}t(c,o,s)?(o=128,s=191,r=r<<6|63&c,++n===i&&(a.push(r),r=i=n=0)):(r=i=n=0,o=128,s=191,--l)}return a}(e);if(void 0!==n){for(let e of n)e<=65535?r+=String.fromCharCode(e):(e-=65536,r+=String.fromCharCode(55296+(e>>10),56320+(1023&e)));return r}}}(n||(n={})),t.utf8ToString=function(e){return n.decodeWithFromCharCode(e)},t.base64StringToUint8Array=function(e){return new Uint8Array(atob(e).split("").map(e=>e.charCodeAt(0)))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class BeDuration{constructor(e=0){this._milliseconds=e}get milliseconds(){return this._milliseconds}get seconds(){return this._milliseconds/1e3}static fromSeconds(e){return new BeDuration(1e3*e)}static fromMilliseconds(e){return new BeDuration(e)}get isZero(){return 0===this._milliseconds}get isTowardsFuture(){return this._milliseconds>0}get isTowardsPast(){return this._milliseconds<0}minus(e){return new BeDuration(this._milliseconds-e._milliseconds)}plus(e){return new BeDuration(this._milliseconds+e._milliseconds)}static async wait(e){return new Promise(t=>setTimeout(t,e))}}t.BeDuration=BeDuration;class BeTimePoint{get milliseconds(){return this._milliseconds}constructor(e){this._milliseconds=e}static now(){return new BeTimePoint(Date.now())}static fromNow(e){return new BeTimePoint(Date.now()+e.milliseconds)}static beforeNow(e){return new BeTimePoint(Date.now()-e.milliseconds)}get isInFuture(){return Date.now()<this._milliseconds}get isInPast(){return Date.now()>this._milliseconds}before(e){return this._milliseconds<e._milliseconds}after(e){return this._milliseconds>e._milliseconds}minus(e){return new BeTimePoint(this._milliseconds-e.milliseconds)}plus(e){return new BeTimePoint(this._milliseconds+e.milliseconds)}}t.BeTimePoint=BeTimePoint;t.StopWatch=class StopWatch{constructor(e,t=!1){this.description=e,t&&this.start()}get current(){return BeDuration.fromMilliseconds(BeTimePoint.now().milliseconds-(this._start?this._start.milliseconds:0))}get currentSeconds(){return this.current.seconds}get elapsed(){return BeDuration.fromMilliseconds((this._stop?this._stop.milliseconds:BeTimePoint.now().milliseconds)-(this._start?this._start.milliseconds:0))}get elapsedSeconds(){return this.elapsed.seconds}start(){this.reset(),this._start=BeTimePoint.now()}stop(){return this._stop=BeTimePoint.now(),this.elapsed}reset(){this._start=this._stop=void 0}}},function(e,t,r){"use strict";e.exports=function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}},function(e,t,r){var n;"undefined"!==typeof window?n=window:"undefined"!==typeof self?n=self:(console.warn("Using browser-only version of superagent in non-browser environment"),n=this);var i=r(407),o=r(408),s=r(223),a=r(409),c=r(411);function l(){}var u=t=e.exports=function(e,r){return"function"==typeof r?new t.Request("GET",e).end(r):1==arguments.length?new t.Request("GET",e):new t.Request(e,r)};t.Request=y,u.getXHR=function(){if(!(!n.XMLHttpRequest||n.location&&"file:"==n.location.protocol&&n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var d="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};function h(e){if(!s(e))return e;var t=[];for(var r in e)p(t,r,e[r]);return t.join("&")}function p(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){p(e,t,r)});else if(s(r))for(var n in r)p(e,t+"["+n+"]",r[n]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}function f(e){for(var t,r,n={},i=e.split("&"),o=0,s=i.length;o<s;++o)-1==(r=(t=i[o]).indexOf("="))?n[decodeURIComponent(t)]="":n[decodeURIComponent(t.slice(0,r))]=decodeURIComponent(t.slice(r+1));return n}function g(e){return/[\/+]json($|[^-\w])/.test(e)}function m(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"===typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=function(e){for(var t,r,n,i,o=e.split(/\r?\n/),s={},a=0,c=o.length;a<c;++a)-1!==(t=(r=o[a]).indexOf(":"))&&(n=r.slice(0,t).toLowerCase(),i=d(r.slice(t+1)),s[n]=i);return s}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function y(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e,t=null,n=null;try{n=new m(r)}catch(e){return(t=new Error("Parser is unable to parse the response")).parse=!0,t.original=e,r.xhr?(t.rawResponse="undefined"==typeof r.xhr.responseType?r.xhr.responseText:r.xhr.response,t.status=r.xhr.status?r.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),r.callback(t)}r.emit("response",n);try{r._isResponseOK(n)||(e=new Error(n.statusText||"Unsuccessful HTTP response"))}catch(t){e=t}e?(e.original=t,e.response=n,e.status=n.status,r.callback(e,n)):r.callback(null,n)})}function v(e,t,r){var n=u("DELETE",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}u.serializeObject=h,u.parseString=f,u.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},u.serialize={"application/x-www-form-urlencoded":h,"application/json":JSON.stringify},u.parse={"application/x-www-form-urlencoded":f,"application/json":JSON.parse},a(m.prototype),m.prototype._parseBody=function(e){var t=u.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&g(this.type)&&(t=u.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},m.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,n="cannot "+t+" "+r+" ("+this.status+")",i=new Error(n);return i.status=this.status,i.method=t,i.url=r,i},u.Response=m,i(y.prototype),o(y.prototype),y.prototype.type=function(e){return this.set("Content-Type",u.types[e]||e),this},y.prototype.accept=function(e){return this.set("Accept",u.types[e]||e),this},y.prototype.auth=function(e,t,r){1===arguments.length&&(t=""),"object"===typeof t&&null!==t&&(r=t,t=""),r||(r={type:"function"===typeof btoa?"basic":"auto"});return this._auth(e,t,r,function(e){if("function"===typeof btoa)return btoa(e);throw new Error("Cannot use basic auth, btoa is not a function")})},y.prototype.query=function(e){return"string"!=typeof e&&(e=h(e)),e&&this._query.push(e),this},y.prototype.attach=function(e,t,r){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,r||t.name)}return this},y.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},y.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var r=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),r(e,t)},y.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},y.prototype.buffer=y.prototype.ca=y.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},y.prototype.pipe=y.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},y.prototype._isHost=function(e){return e&&"object"===typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},y.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||l,this._finalizeQueryString(),this._end()},y.prototype._end=function(){var e=this,t=this.xhr=u.getXHR(),r=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var r=t.readyState;if(r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==r){var n;try{n=t.status}catch(e){n=0}if(!n){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var n=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=t,e.emit("progress",r)};if(this.hasListeners("progress"))try{t.onprogress=n.bind(null,"download"),t.upload&&(t.upload.onprogress=n.bind(null,"upload"))}catch(e){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(e){return this.callback(e)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var i=this._header["content-type"],o=this._serializer||u.serialize[i?i.split(";")[0]:""];!o&&g(i)&&(o=u.serialize["application/json"]),o&&(r=o(r))}for(var s in this.header)null!=this.header[s]&&this.header.hasOwnProperty(s)&&t.setRequestHeader(s,this.header[s]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send("undefined"!==typeof r?r:null),this},u.agent=function(){return new c},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(e){c.prototype[e.toLowerCase()]=function(t,r){var n=new u.Request(e,t);return this._setDefaults(n),r&&n.end(r),n}}),c.prototype.del=c.prototype.delete,u.get=function(e,t,r){var n=u("GET",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},u.head=function(e,t,r){var n=u("HEAD",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},u.options=function(e,t,r){var n=u("OPTIONS",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},u.del=v,u.delete=v,u.patch=function(e,t,r){var n=u("PATCH",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},u.post=function(e,t,r){var n=u("POST",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},u.put=function(e,t,r){var n=u("PUT",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}},function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){"use strict";var n=r(223);function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(e){return this._parser=e,this},i.prototype.responseType=function(e){return this._responseType=e,this},i.prototype.serialize=function(e){return this._serializer=e,this},i.prototype.timeout=function(e){if(!e||"object"!==typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",t)}return this},i.prototype.retry=function(e,t){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=t,this};var o=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];i.prototype._shouldRetry=function(e,t){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(e,t);if(!0===r)return!0;if(!1===r)return!1}catch(e){console.error(e)}if(t&&t.status&&t.status>=500&&501!=t.status)return!0;if(e){if(e.code&&~o.indexOf(e.code))return!0;if(e.timeout&&"ECONNABORTED"==e.code)return!0;if(e.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(e,t){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(e,t){r.end(function(r,n){r?t(r):e(n)})})}return this._fullfilledPromise.then(e,t)},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.use=function(e){return e(this),this},i.prototype.ok=function(e){if("function"!==typeof e)throw Error("Callback required");return this._okCallback=e,this},i.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},i.prototype.get=function(e){return this._header[e.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(e,t){if(n(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},i.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},i.prototype.field=function(e,t){if(null===e||void 0===e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),n(e)){for(var r in e)this.field(r,e[r]);return this}if(Array.isArray(t)){for(var i in t)this.field(e,t[i]);return this}if(null===t||void 0===t)throw new Error(".field(name, val) val can not be empty");return"boolean"===typeof t&&(t=""+t),this._getFormData().append(e,t),this},i.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},i.prototype._auth=function(e,t,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},i.prototype.withCredentials=function(e){return void 0==e&&(e=!0),this._withCredentials=e,this},i.prototype.redirects=function(e){return this._maxRedirects=e,this},i.prototype.maxResponseSize=function(e){if("number"!==typeof e)throw TypeError("Invalid argument");return this._maxResponseSize=e,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(e){var t=n(e),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&n(this._data))for(var i in e)this._data[i]=e[i];else"string"==typeof e?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"==r?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||this._isHost(e)?this:(r||this.type("json"),this)},i.prototype.sortQuery=function(e){return this._sort="undefined"===typeof e||e,this},i.prototype._finalizeQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._query.length=0,this._sort){var t=this.url.indexOf("?");if(t>=0){var r=this.url.substring(t+1).split("&");"function"===typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,t)+"?"+r.join("&")}}},i.prototype._appendQueryString=function(){console.trace("Unsupported")},i.prototype._timeoutError=function(e,t,r){if(!this._aborted){var n=new Error(e+t+"ms exceeded");n.timeout=t,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},i.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},function(e,t,r){"use strict";var n=r(410);function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.get=function(e){return this.header[e.toLowerCase()]},i.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=n.type(t);var r=n.params(t);for(var i in r)this[i]=r[i];this.links={};try{e.link&&(this.links=n.parseLinks(e.link))}catch(e){}},i.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.created=201==e,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e,this.unprocessableEntity=422==e}},function(e,t,r){"use strict";t.type=function(e){return e.split(/ *; */).shift()},t.params=function(e){return e.split(/ *; */).reduce(function(e,t){var r=t.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(e[n]=i),e},{})},t.parseLinks=function(e){return e.split(/ *, */).reduce(function(e,t){var r=t.split(/ *; */),n=r[0].slice(1,-1);return e[r[1].split(/ *= */)[1].slice(1,-1)]=n,e},{})},t.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&(delete e.authorization,delete e.cookie),e}},function(e,t){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(e){r.prototype[e]=function(){return this._defaults.push({fn:e,arguments}),this}}),r.prototype._setDefaults=function(e){this._defaults.forEach(function(t){e[t.fn].apply(e,t.arguments)})},e.exports=r},function(e,t,r){"use strict";var n=r(413),i=r(414),o=r(225);e.exports={formats:o,parse:i,stringify:n}},function(e,t,r){"use strict";var n=r(224),i=r(225),o={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},s=Date.prototype.toISOString,a={delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,serializeDate:function(e){return s.call(e)},skipNulls:!1,strictNullHandling:!1},c=function e(t,r,i,o,s,c,l,u,d,h,p,f){var g=t;if("function"===typeof l)g=l(r,g);else if(g instanceof Date)g=h(g);else if(null===g){if(o)return c&&!f?c(r,a.encoder):r;g=""}if("string"===typeof g||"number"===typeof g||"boolean"===typeof g||n.isBuffer(g))return c?[p(f?r:c(r,a.encoder))+"="+p(c(g,a.encoder))]:[p(r)+"="+p(String(g))];var m,y=[];if("undefined"===typeof g)return y;if(Array.isArray(l))m=l;else{var v=Object.keys(g);m=u?v.sort(u):v}for(var _=0;_<m.length;++_){var w=m[_];s&&null===g[w]||(y=Array.isArray(g)?y.concat(e(g[w],i(r,w),i,o,s,c,l,u,d,h,p,f)):y.concat(e(g[w],r+(d?"."+w:"["+w+"]"),i,o,s,c,l,u,d,h,p,f)))}return y};e.exports=function(e,t){var r=e,s=t?n.assign({},t):{};if(null!==s.encoder&&void 0!==s.encoder&&"function"!==typeof s.encoder)throw new TypeError("Encoder has to be a function.");var l="undefined"===typeof s.delimiter?a.delimiter:s.delimiter,u="boolean"===typeof s.strictNullHandling?s.strictNullHandling:a.strictNullHandling,d="boolean"===typeof s.skipNulls?s.skipNulls:a.skipNulls,h="boolean"===typeof s.encode?s.encode:a.encode,p="function"===typeof s.encoder?s.encoder:a.encoder,f="function"===typeof s.sort?s.sort:null,g="undefined"!==typeof s.allowDots&&s.allowDots,m="function"===typeof s.serializeDate?s.serializeDate:a.serializeDate,y="boolean"===typeof s.encodeValuesOnly?s.encodeValuesOnly:a.encodeValuesOnly;if("undefined"===typeof s.format)s.format=i.default;else if(!Object.prototype.hasOwnProperty.call(i.formatters,s.format))throw new TypeError("Unknown format option provided.");var v,_,w=i.formatters[s.format];"function"===typeof s.filter?r=(_=s.filter)("",r):Array.isArray(s.filter)&&(v=_=s.filter);var S,b=[];if("object"!==typeof r||null===r)return"";S=s.arrayFormat in o?s.arrayFormat:"indices"in s?s.indices?"indices":"repeat":"indices";var x=o[S];v||(v=Object.keys(r)),f&&v.sort(f);for(var P=0;P<v.length;++P){var C=v[P];d&&null===r[C]||(b=b.concat(c(r[C],C,x,u,d,h?p:null,_,f,g,m,w,y)))}var T=b.join(l),M=!0===s.addQueryPrefix?"?":"";return T.length>0?M+T:""}},function(e,t,r){"use strict";var n=r(224),i=Object.prototype.hasOwnProperty,o={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:n.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},s=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,s=/(\[[^[\]]*])/.exec(n),a=s?n.slice(0,s.index):n,c=[];if(a){if(!r.plainObjects&&i.call(Object.prototype,a)&&!r.allowPrototypes)return;c.push(a)}for(var l=0;null!==(s=o.exec(n))&&l<r.depth;){if(l+=1,!r.plainObjects&&i.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(s[1])}return s&&c.push("["+n.slice(s.index)+"]"),function(e,t,r){for(var n=t,i=e.length-1;i>=0;--i){var o,s=e[i];if("[]"===s)o=(o=[]).concat(n);else{o=r.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,c=parseInt(a,10);!isNaN(c)&&s!==a&&String(c)===a&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(o=[])[c]=n:o[a]=n}n=o}return n}(c,t,r)}};e.exports=function(e,t){var r=t?n.assign({},t):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!==typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"===typeof r.delimiter||n.isRegExp(r.delimiter)?r.delimiter:o.delimiter,r.depth="number"===typeof r.depth?r.depth:o.depth,r.arrayLimit="number"===typeof r.arrayLimit?r.arrayLimit:o.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"===typeof r.decoder?r.decoder:o.decoder,r.allowDots="boolean"===typeof r.allowDots?r.allowDots:o.allowDots,r.plainObjects="boolean"===typeof r.plainObjects?r.plainObjects:o.plainObjects,r.allowPrototypes="boolean"===typeof r.allowPrototypes?r.allowPrototypes:o.allowPrototypes,r.parameterLimit="number"===typeof r.parameterLimit?r.parameterLimit:o.parameterLimit,r.strictNullHandling="boolean"===typeof r.strictNullHandling?r.strictNullHandling:o.strictNullHandling,""===e||null===e||"undefined"===typeof e)return r.plainObjects?Object.create(null):{};for(var a="string"===typeof e?function(e,t){for(var r={},n=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,s=t.parameterLimit===1/0?void 0:t.parameterLimit,a=n.split(t.delimiter,s),c=0;c<a.length;++c){var l,u,d=a[c],h=d.indexOf("]="),p=-1===h?d.indexOf("="):h+1;-1===p?(l=t.decoder(d,o.decoder),u=t.strictNullHandling?null:""):(l=t.decoder(d.slice(0,p),o.decoder),u=t.decoder(d.slice(p+1),o.decoder)),i.call(r,l)?r[l]=[].concat(r[l]).concat(u):r[l]=u}return r}(e,r):e,c=r.plainObjects?Object.create(null):{},l=Object.keys(a),u=0;u<l.length;++u){var d=l[u],h=s(d,a[d],r);c=n.merge(c,h,r)}return n.compact(c)}},function(e,t,r){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){for(var t,r=l(e),n=r[0],s=r[1],a=new o(function(e,t,r){return 3*(t+r)/4-r}(0,n,s)),c=0,u=s>0?n-4:n,d=0;d<u;d+=4)t=i[e.charCodeAt(d)]<<18|i[e.charCodeAt(d+1)]<<12|i[e.charCodeAt(d+2)]<<6|i[e.charCodeAt(d+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=255&t;2===s&&(t=i[e.charCodeAt(d)]<<2|i[e.charCodeAt(d+1)]>>4,a[c++]=255&t);1===s&&(t=i[e.charCodeAt(d)]<<10|i[e.charCodeAt(d+1)]<<4|i[e.charCodeAt(d+2)]>>2,a[c++]=t>>8&255,a[c++]=255&t);return a},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(u(e,s,s+16383>a?a:s+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!==typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,l=c>>1,u=-7,d=r?i-1:0,h=r?-1:1,p=e[t+d];for(d+=h,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=h,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===o)o=1-l;else{if(o===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=l}return(p?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,c,l=8*o-i-1,u=(1<<l)-1,d=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=f,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;e[r+p]=255&s,p+=f,s/=256,l-=8);e[r+p-f]|=128*g}},function(e,t){var r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),i=new RegExp("^"+r.source+n.source+"*(?::"+r.source+n.source+"*)?$"),o=0,s=1,a=2,c=3,l=4,u=5,d=6,h=7;function p(){}function f(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function g(e,t,r,n,i,p){for(var f,g=++t,m=o;;){var y=e.charAt(g);switch(y){case"=":if(m===s)f=e.slice(t,g),m=c;else{if(m!==a)throw new Error("attribute equal must after attrName");m=c}break;case"'":case'"':if(m===c||m===s){if(m===s&&(p.warning('attribute value must after "="'),f=e.slice(t,g)),t=g+1,!((g=e.indexOf(y,t))>0))throw new Error("attribute value no end '"+y+"' match");v=e.slice(t,g).replace(/&#?\w+;/g,i),r.add(f,v,t-1),m=u}else{if(m!=l)throw new Error('attribute value must after "="');v=e.slice(t,g).replace(/&#?\w+;/g,i),r.add(f,v,t),p.warning('attribute "'+f+'" missed start quot('+y+")!!"),t=g+1,m=u}break;case"/":switch(m){case o:r.setTagName(e.slice(t,g));case u:case d:case h:m=h,r.closed=!0;case l:case s:case a:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return p.error("unexpected end of input"),m==o&&r.setTagName(e.slice(t,g)),g;case">":switch(m){case o:r.setTagName(e.slice(t,g));case u:case d:case h:break;case l:case s:"/"===(v=e.slice(t,g)).slice(-1)&&(r.closed=!0,v=v.slice(0,-1));case a:m===a&&(v=f),m==l?(p.warning('attribute "'+v+'" missed quot(")!!'),r.add(f,v.replace(/&#?\w+;/g,i),t)):("http://www.w3.org/1999/xhtml"===n[""]&&v.match(/^(?:disabled|checked|selected)$/i)||p.warning('attribute "'+v+'" missed value!! "'+v+'" instead!!'),r.add(v,v,t));break;case c:throw new Error("attribute value missed!!")}return g;case"\x80":y=" ";default:if(y<=" ")switch(m){case o:r.setTagName(e.slice(t,g)),m=d;break;case s:f=e.slice(t,g),m=a;break;case l:var v=e.slice(t,g).replace(/&#?\w+;/g,i);p.warning('attribute "'+v+'" missed quot(")!!'),r.add(f,v,t);case u:m=d}else switch(m){case a:r.tagName;"http://www.w3.org/1999/xhtml"===n[""]&&f.match(/^(?:disabled|checked|selected)$/i)||p.warning('attribute "'+f+'" missed value!! "'+f+'" instead2!!'),r.add(f,f,t),t=g,m=s;break;case u:p.warning('attribute space is required"'+f+'"!!');case d:m=s,t=g;break;case c:m=l,t=g;break;case h:throw new Error("elements closed character '/' and '>' must be connected to")}}g++}}function m(e,t,r){for(var n=e.tagName,i=null,o=e.length;o--;){var s=e[o],a=s.qName,c=s.value;if((h=a.indexOf(":"))>0)var l=s.prefix=a.slice(0,h),u=a.slice(h+1),d="xmlns"===l&&u;else u=a,l=null,d="xmlns"===a&&"";s.localName=u,!1!==d&&(null==i&&(i={},_(r,r={})),r[d]=i[d]=c,s.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(d,c))}for(o=e.length;o--;){(l=(s=e[o]).prefix)&&("xml"===l&&(s.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(s.uri=r[l||""]))}var h;(h=n.indexOf(":"))>0?(l=e.prefix=n.slice(0,h),u=e.localName=n.slice(h+1)):(l=null,u=e.localName=n);var p=e.uri=r[l||""];if(t.startElement(p,u,n,e),!e.closed)return e.currentNSMap=r,e.localNSMap=i,!0;if(t.endElement(p,u,n),i)for(l in i)t.endPrefixMapping(l)}function y(e,t,r,n,i){if(/^(?:script|textarea)$/i.test(r)){var o=e.indexOf("</"+r+">",t),s=e.substring(t+1,o);if(/[&<]/.test(s))return/^script$/i.test(r)?(i.characters(s,0,s.length),o):(s=s.replace(/&#?\w+;/g,n),i.characters(s,0,s.length),o)}return t+1}function v(e,t,r,n){var i=n[r];return null==i&&((i=e.lastIndexOf("</"+r+">"))<t&&(i=e.lastIndexOf("</"+r)),n[r]=i),i<t}function _(e,t){for(var r in e)t[r]=e[r]}function w(e,t,r,n){switch(e.charAt(t+2)){case"-":return"-"===e.charAt(t+3)?(i=e.indexOf("--\x3e",t+4))>t?(r.comment(e,t+4,i-t-4),i+3):(n.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(t+3,6)){var i=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,i-t-9),r.endCDATA(),i+3}var o=function(e,t){var r,n=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;i.lastIndex=t,i.exec(e);for(;r=i.exec(e);)if(n.push(r),r[1])return n}(e,t),s=o.length;if(s>1&&/!doctype/i.test(o[0][0])){var a=o[1][0],c=s>3&&/^public$/i.test(o[2][0])&&o[3][0],l=s>4&&o[4][0],u=o[s-1];return r.startDTD(a,c&&c.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),u.index+u[0].length}}return-1}function S(e,t,r){var n=e.indexOf("?>",t);if(n){var i=e.substring(t,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){i[0].length;return r.processingInstruction(i[1],i[2]),n+2}return-1}return-1}function b(e){}function x(e,t){return e.__proto__=t,e}p.prototype={parse:function(e,t,r){var n=this.domBuilder;n.startDocument(),_(t,t={}),function(e,t,r,n,i){function o(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function s(t){if(t>_){var r=e.substring(_,t).replace(/&#?\w+;/g,o);d&&a(_),n.characters(r,0,t-_),_=t}}function a(t,r){for(;t>=l&&(r=u.exec(e));)c=r.index,l=c+r[0].length,d.lineNumber++;d.columnNumber=t-c+1}var c=0,l=0,u=/.*(?:\r\n?|\n)|.*$/g,d=n.locator,h=[{currentNSMap:t}],p={},_=0;for(;;){try{var x=e.indexOf("<",_);if(x<0){if(!e.substr(_).match(/^\s*$/)){var P=n.doc,C=P.createTextNode(e.substr(_));P.appendChild(C),n.currentElement=C}return}switch(x>_&&s(x),e.charAt(x+1)){case"/":var T=e.indexOf(">",x+3),M=e.substring(x+2,T),E=h.pop();T<0?(M=e.substring(x+2).replace(/[\s<].*/,""),i.error("end tag name: "+M+" is not complete:"+E.tagName),T=x+1+M.length):M.match(/\s</)&&(M=M.replace(/[\s<].*/,""),i.error("end tag name: "+M+" maybe not complete"),T=x+1+M.length);var I=E.localNSMap,A=E.tagName==M,R=A||E.tagName&&E.tagName.toLowerCase()==M.toLowerCase();if(R){if(n.endElement(E.uri,E.localName,M),I)for(var O in I)n.endPrefixMapping(O);A||i.fatalError("end tag name: "+M+" is not match the current start tagName:"+E.tagName)}else h.push(E);T++;break;case"?":d&&a(x),T=S(e,x,n);break;case"!":d&&a(x),T=w(e,x,n,i);break;default:d&&a(x);var D=new b,k=h[h.length-1].currentNSMap,T=g(e,x,D,k,o,i),F=D.length;if(!D.closed&&v(e,T,D.tagName,p)&&(D.closed=!0,r.nbsp||i.warning("unclosed xml attribute")),d&&F){for(var N=f(d,{}),L=0;L<F;L++){var B=D[L];a(B.offset),B.locator=f(d,{})}n.locator=N,m(D,n,k)&&h.push(D),n.locator=d}else m(D,n,k)&&h.push(D);"http://www.w3.org/1999/xhtml"!==D.uri||D.closed?T++:T=y(e,T,D.tagName,o,n)}}catch(e){i.error("element parse error: "+e),T=-1}T>_?_=T:s(Math.max(x,_)+1)}}(e,t,r,n,this.errorHandler),n.endDocument()}},b.prototype={setTagName:function(e){if(!i.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!i.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},x({},x.prototype)instanceof x||(x=function(e,t){function r(){}for(t in r.prototype=t,r=new r,e)r[t]=e[t];return r}),t.XMLReader=p},function(module,exports,__webpack_require__){(function(global){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(global,factory){module.exports=function(global){"use strict";var _Base64=global.Base64,version="2.4.9",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(e){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(e){for(var t={},r=0,n=e.length;r<n;r++)t[e.charAt(r)]=r;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?fromCharCode(192|t>>>6)+fromCharCode(128|63&t):fromCharCode(224|t>>>12&15)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)}var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return fromCharCode(240|t>>>18&7)+fromCharCode(128|t>>>12&63)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(e){return e.replace(re_utob,cb_utob)},cb_encode=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),n=[b64chars.charAt(r>>>18),b64chars.charAt(r>>>12&63),t>=2?"=":b64chars.charAt(r>>>6&63),t>=1?"=":b64chars.charAt(63&r)];return n.join("")},btoa=global.btoa?function(e){return global.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(e){return(e.constructor===buffer.constructor?e:buffer.from(e)).toString("base64")}:function(e){return(e.constructor===buffer.constructor?e:new buffer(e)).toString("base64")}:function(e){return btoa(utob(e))},encode=function(e,t){return t?_encode(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):_encode(String(e))},encodeURI=function(e){return encode(e,!0)},re_btou=new RegExp(["[\xc0-\xdf][\x80-\xbf]","[\xe0-\xef][\x80-\xbf]{2}","[\xf0-\xf7][\x80-\xbf]{3}"].join("|"),"g"),cb_btou=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return fromCharCode(55296+(r>>>10))+fromCharCode(56320+(1023&r));case 3:return fromCharCode((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return fromCharCode((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=function(e){return e.replace(re_btou,cb_btou)},cb_decode=function(e){var t=e.length,r=t%4,n=(t>0?b64tab[e.charAt(0)]<<18:0)|(t>1?b64tab[e.charAt(1)]<<12:0)|(t>2?b64tab[e.charAt(2)]<<6:0)|(t>3?b64tab[e.charAt(3)]:0),i=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(255&n)];return i.length-=[0,0,2,1][r],i.join("")},atob=global.atob?function(e){return global.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,cb_decode)},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(e){return(e.constructor===buffer.constructor?e:buffer.from(e,"base64")).toString()}:function(e){return(e.constructor===buffer.constructor?e:new buffer(e,"base64")).toString()}:function(e){return btou(atob(e))},decode=function(e){return _decode(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var e=global.Base64;return global.Base64=_Base64,e};if(global.Base64={VERSION:version,atob,btoa,fromBase64:decode,toBase64:encode,utob,encode,encodeURI,btou,decode,noConflict,__buffer__:buffer},"function"===typeof Object.defineProperty){var noEnum=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(e){return encode(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}global.Meteor&&(Base64=global.Base64);module.exports?module.exports.Base64=global.Base64:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return global.Base64}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__));return{Base64:global.Base64}}(global)}("undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof global?global:this)}).call(this,__webpack_require__(12))},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(97),o=r(29),s=r(17),a=r(56),c=r(70);let l=class Project extends s.WsgInstance{};n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Name")],l.prototype,"name",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Number")],l.prototype,"number",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.UltimateRefId")],l.prototype,"ultimateRefId",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.AssetId")],l.prototype,"assetId",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.DataLocationId")],l.prototype,"dataLocationId",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Industry")],l.prototype,"industry",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Type")],l.prototype,"type",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Location")],l.prototype,"location",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Latitude")],l.prototype,"latitude",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Longitude")],l.prototype,"longitude",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.CountryCode")],l.prototype,"countryCode",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.TimeZoneLocation")],l.prototype,"timeZoneLocation",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Status")],l.prototype,"status",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.RegisteredDate")],l.prototype,"registeredDate",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.LastModifiedDate")],l.prototype,"lastModifiedDate",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.IsRbacEnabled")],l.prototype,"isRbacEnabled",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.AllowExternalTeamMembers")],l.prototype,"allowExternalTeamMembers",void 0),l=n([s.ECJsonTypeMap.classToJson("wsg","CONNECTEDContext.Project",{schemaPropertyName:"schemaName",classPropertyName:"className"})],l),t.Project=l;let u=class RbacProject extends s.WsgInstance{};u=n([s.ECJsonTypeMap.classToJson("wsg","RBAC.Project",{schemaPropertyName:"schemaName",classPropertyName:"className"})],u),t.RbacProject=u;let d=class RbacUser extends s.WsgInstance{};d=n([s.ECJsonTypeMap.classToJson("wsg","RBAC.User",{schemaPropertyName:"schemaName",classPropertyName:"className"})],d),t.RbacUser=d;let h=class Permission extends s.WsgInstance{};var p;n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Name")],h.prototype,"name",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.Description")],h.prototype,"description",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.ServiceGPRId")],h.prototype,"serviceGprId",void 0),n([s.ECJsonTypeMap.propertyToJson("wsg","properties.CategoryId")],h.prototype,"categoryId",void 0),h=n([s.ECJsonTypeMap.classToJson("wsg","RBAC.Permission",{schemaPropertyName:"schemaName",classPropertyName:"className"})],h),t.Permission=h,function(e){e[e.None=0]="None",e[e.CreateIModel=1]="CreateIModel",e[e.ReadIModel=2]="ReadIModel",e[e.ModifyIModel=4]="ModifyIModel",e[e.ManageResources=8]="ManageResources",e[e.ManageVersions=16]="ManageVersions"}(p=t.IModelHubPermissions||(t.IModelHubPermissions={}));class RbacClient extends i.WsgClient{constructor(){super("v2.4")}getUrlSearchKey(){return RbacClient.searchKey}getRelyingPartyUrl(){if(a.Config.App.has(RbacClient.configRelyingPartyUri))return a.Config.App.get(RbacClient.configRelyingPartyUri)+"/";if(a.Config.App.getBoolean(i.WsgClient.configUseHostRelyingPartyUriAsFallback,!0)&&a.Config.App.has(i.WsgClient.configHostRelyingPartyUri))return a.Config.App.get(i.WsgClient.configHostRelyingPartyUri)+"/";throw new Error(`RelyingPartyUrl not set. Set it in Config.App using key ${RbacClient.configRelyingPartyUri}`)}async getProjects(e,t,r){const n=t.getUserInfo();if(!n)return Promise.reject(new Error("Invalid access token"));const i="/Repositories/BentleyCONNECT--Main/RBAC/User/"+n.id+"/Project";return this.getInstances(e,u,t,i,r)}async getUsers(e,t,r,n){const i="/Repositories/BentleyCONNECT--Main/RBAC/Project/"+r+"/User";return this.getInstances(e,d,t,i,n)}async getIModelHubPermissions(e,t,r){e.enter();const n=t.getUserInfo();if(!n)return Promise.reject(new Error("Invalid access token"));const i="/Repositories/BentleyCONNECT--Main/RBAC/User/"+n.id+"/Project",s=await this.getUrl(e)+i;e.enter();const a=`$id+eq+'${r}'+and+Permission.ServiceGPRId+eq+2485`,c={method:"GET",headers:{authorization:t.toTokenString()},qs:{$select:"Permission.$id",$filter:a}};await this.setupOptionDefaults(c);const l=await o.request(e,s,c);if(e.enter(),!l.body||!l.body.hasOwnProperty("instances"))return Promise.reject(new Error("Expected an array of instances to be returned"));const u=l.body.instances;if(!u||1!==u.length)return Promise.reject(new Error("Project with specified id was not found"));let d=p.None;for(const o of u[0].relationshipInstances)switch(o.relatedInstance.instanceId){case"IMHS_Create_iModel":d|=p.CreateIModel;break;case"IMHS_Read_iModel":d|=p.ReadIModel;break;case"IMHS_Modify_iModel":d|=p.ModifyIModel;break;case"IMHS_ManageResources":d|=p.ManageResources;break;case"IMHS_Manage_Versions":d|=p.ManageVersions}return d}}RbacClient.searchKey="RBAC.URL",RbacClient.configRelyingPartyUri="imjs_rbac_relying_party_uri",t.RbacClient=RbacClient;class ConnectClient extends i.WsgClient{constructor(){super("sv1.0"),this._rbacClient=new RbacClient}getUrlSearchKey(){return ConnectClient.searchKey}async setupOptionDefaults(e){await super.setupOptionDefaults(e),c(e,{headers:{"content-type":"application/json"}})}getRelyingPartyUrl(){if(a.Config.App.has(ConnectClient.configRelyingPartyUri))return a.Config.App.get(ConnectClient.configRelyingPartyUri)+"/";if(a.Config.App.getBoolean(i.WsgClient.configUseHostRelyingPartyUriAsFallback,!0)&&a.Config.App.has(i.WsgClient.configHostRelyingPartyUri))return a.Config.App.get(i.WsgClient.configHostRelyingPartyUri)+"/";throw new Error(`RelyingPartyUrl not set. Set it in Config.App using key ${ConnectClient.configRelyingPartyUri}`)}async getProjects(e,t,r){return this.postQuery(e,l,t,"/Repositories/BentleyCONNECT--Main/ConnectedContext/Project/",r||{})}async getProject(e,t,r){const n=await this.getProjects(e,t,r);if(0===n.length)throw new Error("Could not find a project with the specified criteria");if(n.length>1)throw new Error("More than one project found with the specified criteria");return n[0]}async getInvitedProjects(e,t,r){const n={$top:r?r.$top:void 0,$skip:r?r.$skip:void 0,$filter:"rbaconly+eq+true"},i="$id+in+["+(await this._rbacClient.getProjects(e,t,n).then(e=>e.map(e=>e.wsgId))).reduce((e,t)=>{const r="'"+t+"'";return e?e+","+r:r},"")+"]",o=r||{};return o.$filter=r&&r.$filter?r.$filter+"+and+"+i:i,this.getProjects(e,t,o)}}ConnectClient.searchKey="CONNECTEDContextService.URL",ConnectClient.configRelyingPartyUri="imjs_connected_context_service_relying_party_uri",t.ConnectClient=ConnectClient},function(e,t,r){var n=r(421),i=r(164),o=e.exports;for(var s in n)n.hasOwnProperty(s)&&(o[s]=n[s]);function a(e){if("string"===typeof e&&(e=i.parse(e)),e.protocol||(e.protocol="https:"),"https:"!==e.protocol)throw new Error('Protocol "'+e.protocol+'" not supported. Expected "https:"');return e}o.request=function(e,t){return e=a(e),n.request.call(this,e,t)},o.get=function(e,t){return e=a(e),n.get.call(this,e,t)}},function(e,t,r){(function(e){var n=r(422),i=r(234),o=r(430),s=r(431),a=r(164),c=t;c.request=function(t,r){t="string"===typeof t?a.parse(t):o(t);var i=-1===e.location.protocol.search(/^https?:$/)?"http:":"",s=t.protocol||i,c=t.hostname||t.host,l=t.port,u=t.path||"/";c&&-1!==c.indexOf(":")&&(c="["+c+"]"),t.url=(c?s+"//"+c:"")+(l?":"+l:"")+u,t.method=(t.method||"GET").toUpperCase(),t.headers=t.headers||{};var d=new n(t);return r&&d.on("response",r),d},c.get=function(e,t){var r=c.request(e,t);return r.end(),r},c.ClientRequest=n,c.IncomingMessage=i.IncomingMessage,c.Agent=function(){},c.Agent.defaultMaxSockets=4,c.globalAgent=new c.Agent,c.STATUS_CODES=s,c.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,r(12))},function(e,t,r){(function(t,n,i){var o=r(233),s=r(71),a=r(234),c=r(235),l=r(429),u=a.IncomingMessage,d=a.readyStates;var h=e.exports=function(e){var r,n=this;c.Writable.call(n),n._opts=e,n._body=[],n._headers={},e.auth&&n.setHeader("Authorization","Basic "+new t(e.auth).toString("base64")),Object.keys(e.headers).forEach(function(t){n.setHeader(t,e.headers[t])});var i=!0;if("disable-fetch"===e.mode||"requestTimeout"in e&&!o.abortController)i=!1,r=!0;else if("prefer-streaming"===e.mode)r=!1;else if("allow-wrong-content-type"===e.mode)r=!o.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");r=!0}n._mode=function(e,t){return o.fetch&&t?"fetch":o.mozchunkedarraybuffer?"moz-chunked-arraybuffer":o.msstream?"ms-stream":o.arraybuffer&&e?"arraybuffer":o.vbArray&&e?"text:vbarray":"text"}(r,i),n._fetchTimer=null,n.on("finish",function(){n._onFinish()})};s(h,c.Writable),h.prototype.setHeader=function(e,t){var r=e.toLowerCase();-1===p.indexOf(r)&&(this._headers[r]={name:e,value:t})},h.prototype.getHeader=function(e){var t=this._headers[e.toLowerCase()];return t?t.value:null},h.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},h.prototype._onFinish=function(){var e=this;if(!e._destroyed){var r=e._opts,s=e._headers,a=null;"GET"!==r.method&&"HEAD"!==r.method&&(a=o.arraybuffer?l(t.concat(e._body)):o.blobConstructor?new n.Blob(e._body.map(function(e){return l(e)}),{type:(s["content-type"]||{}).value||""}):t.concat(e._body).toString());var c=[];if(Object.keys(s).forEach(function(e){var t=s[e].name,r=s[e].value;Array.isArray(r)?r.forEach(function(e){c.push([t,e])}):c.push([t,r])}),"fetch"===e._mode){var u=null;if(o.abortController){var h=new AbortController;u=h.signal,e._fetchAbortController=h,"requestTimeout"in r&&0!==r.requestTimeout&&(e._fetchTimer=n.setTimeout(function(){e.emit("requestTimeout"),e._fetchAbortController&&e._fetchAbortController.abort()},r.requestTimeout))}n.fetch(e._opts.url,{method:e._opts.method,headers:c,body:a||void 0,mode:"cors",credentials:r.withCredentials?"include":"same-origin",signal:u}).then(function(t){e._fetchResponse=t,e._connect()},function(t){n.clearTimeout(e._fetchTimer),e._destroyed||e.emit("error",t)})}else{var p=e._xhr=new n.XMLHttpRequest;try{p.open(e._opts.method,e._opts.url,!0)}catch(t){return void i.nextTick(function(){e.emit("error",t)})}"responseType"in p&&(p.responseType=e._mode.split(":")[0]),"withCredentials"in p&&(p.withCredentials=!!r.withCredentials),"text"===e._mode&&"overrideMimeType"in p&&p.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in r&&(p.timeout=r.requestTimeout,p.ontimeout=function(){e.emit("requestTimeout")}),c.forEach(function(e){p.setRequestHeader(e[0],e[1])}),e._response=null,p.onreadystatechange=function(){switch(p.readyState){case d.LOADING:case d.DONE:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(p.onprogress=function(){e._onXHRProgress()}),p.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{p.send(a)}catch(t){return void i.nextTick(function(){e.emit("error",t)})}}}},h.prototype._onXHRProgress=function(){(function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},h.prototype._connect=function(){var e=this;e._destroyed||(e._response=new u(e._xhr,e._fetchResponse,e._mode,e._fetchTimer),e._response.on("error",function(t){e.emit("error",t)}),e.emit("response",e._response))},h.prototype._write=function(e,t,r){this._body.push(e),r()},h.prototype.abort=h.prototype.destroy=function(){this._destroyed=!0,n.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},h.prototype.end=function(e,t,r){"function"===typeof e&&(r=e,e=void 0),c.Writable.prototype.end.call(this,e,t,r)},h.prototype.flushHeaders=function(){},h.prototype.setTimeout=function(){},h.prototype.setNoDelay=function(){},h.prototype.setSocketKeepAlive=function(){};var p=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}).call(this,r(36).Buffer,r(12),r(48))},,function(e,t,r){"use strict";var n=r(122).Buffer,i=r(425);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,o=n.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,r=o,i=a,t.copy(r,i),a+=s.data.length,s=s.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},,function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i,o,s,a,c=1,l={},u=!1,d=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){f(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){f(e.data)},n=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,n=function(e){var t=d.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(f,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"===typeof t.data&&0===t.data.indexOf(s)&&f(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(s+t,"*")}),h.setImmediate=function(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return l[c]=i,n(c),c++},h.clearImmediate=p}function p(e){delete l[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{p(e),u=!1}}}}}("undefined"===typeof self?"undefined"===typeof e?this:e:self)}).call(this,r(12),r(48))},function(e,t,r){(function(t){function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var r=t.localStorage[e];return null!=r&&"true"===String(r).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,r(12))},function(e,t,r){"use strict";e.exports=o;var n=r(242),i=r(98);function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}i.inherits=r(71),i.inherits(o,n),o.prototype._transform=function(e,t,r){r(null,e)}},function(e,t,r){var n=r(36).Buffer;e.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"===typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(n.isBuffer(e)){for(var t=new Uint8Array(e.length),r=e.length,i=0;i<r;i++)t[i]=e[i];return t.buffer}throw new Error("Argument must be a Buffer")}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},function(e,t){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(e,t,r){(function(e,n){var i;!function(o){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n&&n;s.global!==s&&s.window!==s&&s.self;var a,c=2147483647,l=36,u=1,d=26,h=38,p=700,f=72,g=128,m="-",y=/^xn--/,v=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=l-u,b=Math.floor,x=String.fromCharCode;function P(e){throw new RangeError(w[e])}function C(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function T(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+C((e=e.replace(_,".")).split("."),t).join(".")}function M(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function E(e){return C(e,function(e){var t="";return e>65535&&(t+=x((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=x(e)}).join("")}function I(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function A(e,t,r){var n=0;for(e=r?b(e/p):e>>1,e+=b(e/t);e>S*d>>1;n+=l)e=b(e/S);return b(n+(S+1)*e/(e+h))}function R(e){var t,r,n,i,o,s,a,h,p,y,v,_=[],w=e.length,S=0,x=g,C=f;for((r=e.lastIndexOf(m))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&P("not-basic"),_.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<w;){for(o=S,s=1,a=l;i>=w&&P("invalid-input"),((h=(v=e.charCodeAt(i++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:l)>=l||h>b((c-S)/s))&&P("overflow"),S+=h*s,!(h<(p=a<=C?u:a>=C+d?d:a-C));a+=l)s>b(c/(y=l-p))&&P("overflow"),s*=y;C=A(S-o,t=_.length+1,0==o),b(S/t)>c-x&&P("overflow"),x+=b(S/t),S%=t,_.splice(S++,0,x)}return E(_)}function O(e){var t,r,n,i,o,s,a,h,p,y,v,_,w,S,C,T=[];for(_=(e=M(e)).length,t=g,r=0,o=f,s=0;s<_;++s)(v=e[s])<128&&T.push(x(v));for(n=i=T.length,i&&T.push(m);n<_;){for(a=c,s=0;s<_;++s)(v=e[s])>=t&&v<a&&(a=v);for(a-t>b((c-r)/(w=n+1))&&P("overflow"),r+=(a-t)*w,t=a,s=0;s<_;++s)if((v=e[s])<t&&++r>c&&P("overflow"),v==t){for(h=r,p=l;!(h<(y=p<=o?u:p>=o+d?d:p-o));p+=l)C=h-y,S=l-y,T.push(x(I(y+C%S,0))),h=b(C/S);T.push(x(I(h,0))),o=A(r,w,n==i),r=0,++n}++r,++t}return T.join("")}a={version:"1.4.1",ucs2:{decode:M,encode:E},decode:R,encode:O,toASCII:function(e){return T(e,function(e){return v.test(e)?"xn--"+O(e):e})},toUnicode:function(e){return T(e,function(e){return y.test(e)?R(e.slice(4).toLowerCase()):e})}},void 0===(i=function(){return a}.call(t,r,t,e))||(e.exports=i)}()}).call(this,r(123)(e),r(12))},function(e,t,r){"use strict";e.exports={isString:function(e){return"string"===typeof e},isObject:function(e){return"object"===typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){"use strict";t.decode=t.parse=r(435),t.encode=t.stringify=r(436)},function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,o){t=t||"&",r=r||"=";var s={};if("string"!==typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var c=1e3;o&&"number"===typeof o.maxKeys&&(c=o.maxKeys);var l=e.length;c>0&&l>c&&(l=c);for(var u=0;u<l;++u){var d,h,p,f,g=e[u].replace(a,"%20"),m=g.indexOf(r);m>=0?(d=g.substr(0,m),h=g.substr(m+1)):(d=g,h=""),p=decodeURIComponent(d),f=decodeURIComponent(h),n(s,p)?i(s[p])?s[p].push(f):s[p]=[s[p],f]:s[p]=f}return s};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,a){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"===typeof e?o(s(e),function(s){var a=encodeURIComponent(n(s))+r;return i(e[s])?o(e[s],function(e){return a+encodeURIComponent(n(e))}).join(t):a+encodeURIComponent(n(e[s]))}).join(t):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CustomRequestOptions=class CustomRequestOptions{setCustomOptions(e){this._customOptions=e}insertCustomOptions(e){return this._customOptions?(e||(e={}),e=Object.assign({},e,this._customOptions)):e}get isSet(){return null!=this._customOptions}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(18),s=r(0),a=r(57),c=r(18),l="imodeljs-clients.imodelhub";!function(e){e[e.Shared=0]="Shared",e[e.Exclusive=1]="Exclusive"}(t.BriefcaseAccessMode||(t.BriefcaseAccessMode={}));let u=class Briefcase extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileName")],u.prototype,"fileName",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileDescription")],u.prototype,"fileDescription",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileSize")],u.prototype,"fileSize",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileId")],u.prototype,"fileId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.BriefcaseId"),i.ECJsonTypeMap.propertyToJson("ecdb","briefcaseId")],u.prototype,"briefcaseId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.UserOwned"),i.ECJsonTypeMap.propertyToJson("ecdb","userId")],u.prototype,"userId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.MergedChangeSetId")],u.prototype,"mergedChangeSetId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.AcquiredDate")],u.prototype,"acquiredDate",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.IsReadOnly"),i.ECJsonTypeMap.propertyToJson("ecdb","isReadOnly")],u.prototype,"isReadOnly",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[FileAccessKey].relatedInstance[AccessKey].properties.DownloadUrl")],u.prototype,"downloadUrl",void 0),n([i.ECJsonTypeMap.propertyToJson("ecdb","accessMode")],u.prototype,"accessMode",void 0),n([i.ECJsonTypeMap.propertyToJson("ecdb","localPathname")],u.prototype,"localPathname",void 0),n([i.ECJsonTypeMap.propertyToJson("ecdb","lastAccessedAt")],u.prototype,"lastAccessedAt",void 0),n([i.ECJsonTypeMap.propertyToJson("ecdb","iModelId")],u.prototype,"iModelId",void 0),u=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.Briefcase",{schemaPropertyName:"schemaName",classPropertyName:"className"}),i.ECJsonTypeMap.classToJson("ecdb","ServiceStore.Briefcase",{classKeyPropertyName:"className"})],u),t.Briefcase=u;class BriefcaseQuery extends a.Query{byId(e){return c.ArgumentCheck.validBriefcaseId("id",e),this._byId=e,this}getId(){return this._byId}selectDownloadUrl(){return a.addSelectFileAccessKey(this._query),this}}t.BriefcaseQuery=BriefcaseQuery;t.BriefcaseHandler=class BriefcaseHandler{constructor(e,t){this._handler=e,this._fileHandler=t}getRelativeUrl(e,t){return`/Repositories/iModel--${e}/iModelScope/Briefcase/${t||""}`}async create(e,t,r){e.enter(),s.Logger.logInfo(l,`Acquiring briefcase for iModel ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("imodelId",r);let n=new u;return n=await this._handler.postInstance(e,u,t,this.getRelativeUrl(r),n),e.enter(),s.Logger.logTrace(l,`Acquired briefcase ${n.briefcaseId} for iModel ${r}`),n}async delete(e,t,r,n){e.enter(),s.Logger.logInfo(l,`Deleting briefcase ${n} from iModel ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("imodelId",r),c.ArgumentCheck.validBriefcaseId("briefcaseId",n),await this._handler.delete(e,t,this.getRelativeUrl(r,n)),e.enter(),s.Logger.logTrace(l,`Deleted briefcase ${n} from iModel ${r}`)}async get(e,t,r,n=new BriefcaseQuery){e.enter(),s.Logger.logInfo(l,`Querying briefcases for iModel ${r}`),c.ArgumentCheck.defined("token",t),c.ArgumentCheck.validGuid("imodelId",r);const i=n.getId(),o=await this._handler.getInstances(e,u,t,this.getRelativeUrl(r,i),n.getQueryOptions());e.enter();for(const s of o)s.iModelId=r;return s.Logger.logTrace(l,`Queried ${o.length} briefcases for iModel ${r}`),o}async download(e,t,r,n){return e.enter(),s.Logger.logInfo(l,`Downloading briefcase ${t.wsgId} for iModel ${t.iModelId}`),c.ArgumentCheck.defined("briefcase",t),c.ArgumentCheck.defined("downloadToPathname",r),"undefined"!==typeof window?Promise.reject(o.IModelHubClientError.browser()):this._fileHandler?t.downloadUrl?(await this._fileHandler.downloadFile(e,t.downloadUrl,r,parseInt(t.fileSize,10),n),e.enter(),void s.Logger.logTrace(l,`Downloading briefcase ${t.wsgId} for iModel ${t.iModelId}`)):Promise.reject(o.IModelHubClientError.missingDownloadUrl("briefcase")):Promise.reject(o.IModelHubClientError.fileHandler())}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(18),s=r(0),a=r(57),c="imodeljs-clients.imodelhub";!function(e){e[e.Regular=0]="Regular",e[e.Schema=1]="Schema"}(t.ChangesType||(t.ChangesType={}));let l=class ChangeSet extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Id")],l.prototype,"id",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileName")],l.prototype,"fileName",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Description")],l.prototype,"description",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileSize")],l.prototype,"fileSize",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Index")],l.prototype,"index",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.ParentId")],l.prototype,"parentId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.SeedFileId")],l.prototype,"seedFileId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.BriefcaseId")],l.prototype,"briefcaseId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.UserCreated")],l.prototype,"userCreated",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.PushDate")],l.prototype,"pushDate",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.ContainingChanges")],l.prototype,"changesType",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.IsUploaded")],l.prototype,"isUploaded",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[FileAccessKey].relatedInstance[AccessKey].properties.DownloadUrl")],l.prototype,"downloadUrl",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[FileAccessKey].relatedInstance[AccessKey].properties.UploadUrl")],l.prototype,"uploadUrl",void 0),l=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.ChangeSet",{schemaPropertyName:"schemaName",classPropertyName:"className"})],l),t.ChangeSet=l;class ChangeSetQuery extends a.StringIdQuery{selectDownloadUrl(){return a.addSelectFileAccessKey(this._query),this}checkValue(e){o.ArgumentCheck.validChangeSetId("id",e)}fromId(e){return o.ArgumentCheck.validChangeSetId("id",e),this._query.$filter=`FollowingChangeSet-backward-ChangeSet.Id+eq+'${e}'`,this}latest(){return this._query.$orderby="Index+desc",this}betweenChangeSets(e,t){let r;return o.ArgumentCheck.validChangeSetId("firstChangeSetId",e),t&&o.ArgumentCheck.validChangeSetId("secondChangeSetId",t),t?(r=`(CumulativeChangeSet-backward-ChangeSet.Id+eq+'${e}'`,r+=`+and+FollowingChangeSet-backward-ChangeSet.Id+eq+'${t}')`,r+=`+or+(CumulativeChangeSet-backward-ChangeSet.Id+eq+'${t}'`,r+=`+and+FollowingChangeSet-backward-ChangeSet.Id+eq+'${e}')`):r=`CumulativeChangeSet-backward-ChangeSet.Id+eq+'${e}'`,this._query.$filter=r,this}getVersionChangeSets(e){return o.ArgumentCheck.validGuid("versionId",e),this._query.$filter=`CumulativeChangeSet-backward-Version.Id+eq+'${e}'`,this}afterVersion(e){return o.ArgumentCheck.validGuid("versionId",e),this._query.$filter=`FollowingChangeSet-backward-Version.Id+eq+'${e}'`,this}betweenVersions(e,t){let r;return o.ArgumentCheck.validGuid("sourceVersionId",e),o.ArgumentCheck.validGuid("destinationVersionId",t),r=`(FollowingChangeSet-backward-Version.Id+eq+'${e}'`,r+=`+and+CumulativeChangeSet-backward-Version.Id+eq+'${t}')`,r+=`+or+(FollowingChangeSet-backward-Version.Id+eq+'${t}'`,r+=`+and+CumulativeChangeSet-backward-Version.Id+eq+'${e}')`,this._query.$filter=r,this}betweenVersionAndChangeSet(e,t){let r;return o.ArgumentCheck.validGuid("versionId",e),o.ArgumentCheck.validChangeSetId("changeSetId",t),r=`(CumulativeChangeSet-backward-Version.Id+eq+'${e}'+and+FollowingChangeSet-backward-ChangeSet.Id+eq+'${t}')`,r+="+or+",r+=`(FollowingChangeSet-backward-Version.Id+eq+'${e}'+and+CumulativeChangeSet-backward-ChangeSet.Id+eq+'${t}')`,this._query.$filter=r,this}bySeedFileId(e){return o.ArgumentCheck.validGuid("seedFileId",e),this.addFilter(`SeedFileId+eq+'${e}'`),this}}t.ChangeSetQuery=ChangeSetQuery;t.ChangeSetHandler=class ChangeSetHandler{constructor(e,t){this._handler=e,this._fileHandler=t}getRelativeUrl(e,t){return`/Repositories/iModel--${e}/iModelScope/ChangeSet/${t||""}`}async get(e,t,r,n=new ChangeSetQuery){e.enter(),s.Logger.logInfo(c,`Querying changesets for iModel ${r}`),o.ArgumentCheck.defined("token",t),o.ArgumentCheck.validGuid("imodelId",r);const i=n.getId(),a=await this._handler.getInstances(e,l,t,this.getRelativeUrl(r,i),n.getQueryOptions());return e.enter(),s.Logger.logTrace(c,`Queried ${a.length} changesets for iModel ${r}`),a}async download(e,t,r,n){if(e.enter(),s.Logger.logInfo(c,`Downloading ${t.length} changesets`),o.ArgumentCheck.nonEmptyArray("changeSets",t),o.ArgumentCheck.defined("downloadToPath",r),"undefined"!==typeof window)return Promise.reject(o.IModelHubClientError.browser());if(!this._fileHandler)return Promise.reject(o.IModelHubClientError.fileHandler());t.forEach(e=>{if(!e.downloadUrl)throw o.IModelHubClientError.missingDownloadUrl("changeSets")});const i=new Array;let a=0,l=0;t.forEach(e=>a+=parseInt(e.fileSize,10));for(const o of t){const t=o.downloadUrl,s=this._fileHandler.join(r,o.fileName);let c=0;const u=e=>{l+=e.loaded-c,c=e.loaded,n({loaded:l,total:a,percent:l/a})};i.push(this._fileHandler.downloadFile(e,t,s,parseInt(o.fileSize,10),n?u:void 0))}await Promise.all(i),e.enter(),s.Logger.logTrace(c,`Downloaded ${t.length} changesets`)}async create(e,t,r,n,i,a){if(e.enter(),s.Logger.logInfo(c,`Uploading changeset ${n.id} to iModel ${r}`),o.ArgumentCheck.defined("token",t),o.ArgumentCheck.validGuid("imodelId",r),o.ArgumentCheck.defined("changeSet",n),o.ArgumentCheck.defined("changeSetPathname",i),"undefined"!==typeof window)return Promise.reject(o.IModelHubClientError.browser());if(!this._fileHandler)return Promise.reject(o.IModelHubClientError.fileHandler());if(!this._fileHandler.exists(i)||this._fileHandler.isDirectory(i))return Promise.reject(o.IModelHubClientError.fileNotFound());const u=await this._handler.postInstance(e,l,t,this.getRelativeUrl(r),n);await this._fileHandler.uploadFile(e,u.uploadUrl,i,a),e.enter(),u.uploadUrl=void 0,u.downloadUrl=void 0,u.isUploaded=!0;const d=await this._handler.postInstance(e,l,t,this.getRelativeUrl(r,u.id),u);return e.enter(),n.isUploaded=!0,s.Logger.logTrace(c,`Uploaded changeset ${n.id} to iModel ${r}`),d}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(29),s=r(243),a=r(0),c=r(244),l=r(18),u="imodeljs-clients.imodelhub";class IModelHubEvent extends c.IModelHubBaseEvent{fromJson(e){super.fromJson(e),this.iModelId=this.eventTopic}}t.IModelHubEvent=IModelHubEvent;class BriefcaseEvent extends IModelHubEvent{fromJson(e){super.fromJson(e),this.briefcaseId=e.BriefcaseId}}t.BriefcaseEvent=BriefcaseEvent;class LockEvent extends BriefcaseEvent{fromJson(e){super.fromJson(e),this.lockType=parseInt(e.LockType,10),this.lockLevel=parseInt(e.LockLevel,10),this.objectIds=e.ObjectIds.map(e=>a.Id64.fromJSON(e)),this.releasedWithChangeSet=e.ReleasedWithChangeSet}}t.LockEvent=LockEvent;class AllLocksDeletedEvent extends BriefcaseEvent{}t.AllLocksDeletedEvent=AllLocksDeletedEvent;class ChangeSetPostPushEvent extends BriefcaseEvent{fromJson(e){super.fromJson(e),this.changeSetId=e.ChangeSetId,this.changeSetIndex=e.ChangeSetIndex}}t.ChangeSetPostPushEvent=ChangeSetPostPushEvent;class ChangeSetPrePushEvent extends IModelHubEvent{}t.ChangeSetPrePushEvent=ChangeSetPrePushEvent;class CodeEvent extends BriefcaseEvent{constructor(){super(...arguments),this.state=s.CodeState.Reserved}fromJson(e){super.fromJson(e),this.codeSpecId=a.Id64.fromJSON(e.CodeSpecId),this.codeScope=e.CodeScope,this.values=e.Values,this.state=e.State}}t.CodeEvent=CodeEvent;class AllCodesDeletedEvent extends BriefcaseEvent{}t.AllCodesDeletedEvent=AllCodesDeletedEvent;class BriefcaseDeletedEvent extends BriefcaseEvent{}t.BriefcaseDeletedEvent=BriefcaseDeletedEvent;class IModelDeletedEvent extends IModelHubEvent{}t.IModelDeletedEvent=IModelDeletedEvent;class VersionEvent extends IModelHubEvent{fromJson(e){super.fromJson(e),this.versionId=e.VersionId,this.versionName=e.VersionName,this.changeSetId=e.ChangeSetId}}function d(e){const t=new(function(e){switch(e){case"LockEvent":return LockEvent;case"AllLocksDeletedEvent":return AllLocksDeletedEvent;case"ChangeSetPostPushEvent":return ChangeSetPostPushEvent;case"ChangeSetPrePushEvent":return ChangeSetPrePushEvent;case"CodeEvent":return CodeEvent;case"AllCodesDeletedEvent":return AllCodesDeletedEvent;case"BriefcaseDeletedEvent":return BriefcaseDeletedEvent;case"iModelDeletedEvent":return IModelDeletedEvent;case"VersionEvent":return VersionEvent}}(e.header["content-type"]));return t.fromJson(e.body),t}t.VersionEvent=VersionEvent,t.ParseEvent=d;let h=class EventSubscription extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","properties.EventTypes")],h.prototype,"eventTypes",void 0),h=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.EventSubscription",{schemaPropertyName:"schemaName",classPropertyName:"className"})],h),t.EventSubscription=h;let p=class EventSAS extends c.BaseEventSAS{};p=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.EventSAS",{schemaPropertyName:"schemaName",classPropertyName:"className"})],p),t.EventSAS=p;class EventSubscriptionHandler{constructor(e){this._handler=e}getRelativeUrl(e,t){return`/Repositories/iModel--${e}/iModelScope/EventSubscription/${t||""}`}async create(e,t,r,n){e.enter(),a.Logger.logInfo(u,`Creating event subscription on iModel ${r}`),l.ArgumentCheck.defined("token",t),l.ArgumentCheck.validGuid("imodelId",r),l.ArgumentCheck.nonEmptyArray("events",n);let i=new h;return i.eventTypes=n,i=await this._handler.postInstance(e,h,t,this.getRelativeUrl(r),i),e.enter(),a.Logger.logTrace(u,`Created event subscription on iModel ${r}`),i}async update(e,t,r,n){e.enter(),a.Logger.logInfo(u,`Updating event subscription on iModel ${n.wsgId}`),l.ArgumentCheck.defined("token",t),l.ArgumentCheck.validGuid("imodelId",r),l.ArgumentCheck.defined("subscription",n),l.ArgumentCheck.validGuid("subscription.wsgId",n.wsgId);const i=await this._handler.postInstance(e,h,t,this.getRelativeUrl(r,n.wsgId),n);return e.enter(),a.Logger.logTrace(u,`Updated event subscription on iModel ${n.wsgId}`),i}async delete(e,t,r,n){e.enter(),a.Logger.logInfo(u,`Deleting event subscription ${n} from iModel ${r}`),l.ArgumentCheck.defined("token",t),l.ArgumentCheck.validGuid("imodelId",r),l.ArgumentCheck.validGuid("eventSubscriptionId",n),await this._handler.delete(e,t,this.getRelativeUrl(r,n)),e.enter(),a.Logger.logTrace(u,`Deleted event subscription ${n} from iModel ${r}`)}}t.EventSubscriptionHandler=EventSubscriptionHandler;t.EventHandler=class EventHandler extends c.EventBaseHandler{constructor(e){super(),this._handler=e}Subscriptions(){return this._subscriptionHandler||(this._subscriptionHandler=new EventSubscriptionHandler(this._handler)),this._subscriptionHandler}getEventSASRelativeUrl(e){return`/Repositories/iModel--${e}/iModelScope/EventSAS/`}async getSASToken(e,t,r){a.Logger.logInfo(u,`Getting event SAS token from iModel ${r}`),l.ArgumentCheck.defined("token",t),l.ArgumentCheck.validGuid("imodelId",r);const n=await this._handler.postInstance(e,p,t,this.getEventSASRelativeUrl(r),new p);return e.enter(),a.Logger.logTrace(u,`Got event SAS token from iModel ${r}`),n}getEventUrl(e,t,r){let n=`${e}/Subscriptions/${t}/messages/head`;return r&&(n+=`?timeout=${r}`),n}async getEvent(e,t,r,n,i){e.enter(),a.Logger.logInfo(u,`Getting event from subscription ${n}`),l.ArgumentCheck.defined("sasToken",t),l.ArgumentCheck.defined("baseAddress",r),l.ArgumentCheck.validGuid("subscriptionId",n);const s=this.getEventRequestOptions(c.GetEventOperationToRequestType.GetDestructive,t,i),h=await o.request(e,this.getEventUrl(r,n,i),s);if(e.enter(),204===h.status)return void a.Logger.logTrace(u,`No events found on subscription ${n}`);const p=d(h);return a.Logger.logTrace(u,`Got event from subscription ${n}`),Promise.resolve(p)}createListener(e,t,r,n,i){e.enter(),l.ArgumentCheck.defined("authenticationCallback",t),l.ArgumentCheck.validGuid("subscriptionId",r),l.ArgumentCheck.validGuid("imodelId",n);const o=new c.ListenerSubscription;return o.authenticationCallback=t,o.getEvent=((t,r,n,i)=>this.getEvent(e,t,r,n,i)),o.getSASToken=(t=>this.getSASToken(e,t,n)),o.id=r,c.EventListener.create(o,i)}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(18),s=r(57),a=r(0),c="imodeljs-clients.imodelhub";let l=class HubIModel extends i.WsgInstance{};var u;n([i.ECJsonTypeMap.propertyToJson("wsg","instanceId")],l.prototype,"id",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Description")],l.prototype,"description",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Name")],l.prototype,"name",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.UserCreated")],l.prototype,"userCreated",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.CreatedDate")],l.prototype,"createdDate",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Initialized")],l.prototype,"initialized",void 0),l=n([i.ECJsonTypeMap.classToJson("wsg","ProjectScope.iModel",{schemaPropertyName:"schemaName",classPropertyName:"className"})],l),t.HubIModel=l,function(e){e[e.Successful=0]="Successful",e[e.NotStarted=1]="NotStarted",e[e.Scheduled=2]="Scheduled",e[e.Failed=3]="Failed",e[e.OutdatedFile=4]="OutdatedFile",e[e.CodeTooLong=5]="CodeTooLong",e[e.SeedFileIsBriefcase=6]="SeedFileIsBriefcase"}(u=t.InitializationState||(t.InitializationState={}));let d=class SeedFile extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","instanceId")],d.prototype,"id",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileName")],d.prototype,"fileName",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileDescription")],d.prototype,"fileDescription",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileSize")],d.prototype,"fileSize",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.FileId")],d.prototype,"fileId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Index")],d.prototype,"index",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.IModelName")],d.prototype,"iModelName",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.MergedChangeSetId")],d.prototype,"mergedChangeSetId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.UserUploaded")],d.prototype,"userUploaded",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.UploadedDate")],d.prototype,"uploadedDate",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.IsUploaded")],d.prototype,"isUploaded",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.InitializationState")],d.prototype,"initializationState",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[FileAccessKey].relatedInstance[AccessKey].properties.DownloadUrl")],d.prototype,"downloadUrl",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[FileAccessKey].relatedInstance[AccessKey].properties.UploadUrl")],d.prototype,"uploadUrl",void 0),d=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.SeedFile",{schemaPropertyName:"schemaName",classPropertyName:"className"})],d),t.SeedFile=d;class SeedFileQuery extends s.InstanceIdQuery{selectDownloadUrl(){return s.addSelectFileAccessKey(this._query),this}latest(){return this._query.$orderby="Index+desc",this}}class SeedFileHandler{constructor(e,t){this._handler=e,this._fileHandler=t}getRelativeUrl(e,t){return`/Repositories/iModel--${e}/iModelScope/SeedFile/${t||""}`}async get(e,t,r,n=new SeedFileQuery){e.enter(),a.Logger.logInfo(c,`Querying seed files for iModel ${r}`);const i=await this._handler.getInstances(e,d,t,this.getRelativeUrl(r,n.getId()),n.getQueryOptions());return e.enter(),a.Logger.logTrace(c,`Queried ${i.length} seed files for iModel ${r}`),i}async uploadSeedFile(e,t,r,n,i,o){e.enter(),a.Logger.logInfo(c,`Uploading seed file to iModel ${r}`);const s=new d;s.fileName=this._fileHandler.basename(n),s.fileSize=this._fileHandler.getFileSize(n).toString(),i&&(s.fileDescription=i);const l=await this._handler.postInstance(e,d,t,this.getRelativeUrl(r),s);e.enter(),await this._fileHandler.uploadFile(e,l.uploadUrl,n,o),e.enter(),l.uploadUrl=void 0,l.downloadUrl=void 0,l.isUploaded=!0;const u=await this._handler.postInstance(e,d,t,this.getRelativeUrl(r,l.id),l);return e.enter(),a.Logger.logTrace(c,`Uploaded seed file ${s.wsgId} to iModel ${r}`),u}}class IModelQuery extends s.InstanceIdQuery{byName(e){return o.ArgumentCheck.defined("name",e),this.addFilter(`Name+eq+'${e}'`),this}primary(){return this.resetQueryOptions(),this.orderBy("CreatedDate+asc").top(1),this}}t.IModelQuery=IModelQuery;t.IModelHandler=class IModelHandler{constructor(e,t){this._handler=e,this._fileHandler=t,this._seedFileHandler=new SeedFileHandler(this._handler,this._fileHandler)}getRelativeUrl(e,t){return`/Repositories/Project--${this._handler.formatProjectIdForUrl(e)}/ProjectScope/iModel/${t||""}`}async get(e,t,r,n=new IModelQuery){e.enter(),a.Logger.logInfo(c,`Querying iModels in project ${r}`),o.ArgumentCheck.defined("token",t),o.ArgumentCheck.defined("contextId",r);const i=await this._handler.getInstances(e,l,t,this.getRelativeUrl(r,n.getId()),n.getQueryOptions());return e.enter(),a.Logger.logTrace(c,`Queried ${i.length} iModels in project ${r}`),i}async delete(e,t,r,n){if(e.enter(),a.Logger.logInfo(c,`Deleting iModel with id ${n} from project ${r}`),o.ArgumentCheck.defined("token",t),o.ArgumentCheck.validGuid("contextId",r),o.ArgumentCheck.validGuid("imodelId",n),this._handler.getCustomRequestOptions().isSet){const i=new l;i.id=n,i.changeState="deleted",await this._handler.deleteInstance(e,t,this.getRelativeUrl(r,n),i)}else await this._handler.delete(e,t,this.getRelativeUrl(r,n));e.enter(),a.Logger.logTrace(c,`Deleted iModel with id ${n} from project ${r}`)}async createIModelInstance(e,t,r,n,i){let s;e.enter(),a.Logger.logInfo(c,`Creating iModel with name ${n} in project ${r}`);const u=new l;u.name=n,i&&(u.description=i);try{s=await this._handler.postInstance(e,l,t,this.getRelativeUrl(r),u),e.enter(),a.Logger.logTrace(c,`Created iModel instance with name ${n} in project ${r}`)}catch(i){if(e.enter(),!(i instanceof o.IModelHubError)||a.IModelHubStatus.iModelAlreadyExists!==i.errorNumber)return a.Logger.logWarning(c,`Can not create iModel: ${i.message}`),Promise.reject(i);if(i.data.iModelInitialized)return a.Logger.logWarning(c,`Error creating iModel: iModel with name ${n} already exists and is initialized`),Promise.reject(i);a.Logger.logInfo(c,`Querying iModel by name ${n} in project ${r}`);const l=await this.get(e,t,r,(new IModelQuery).byName(n));if(e.enter(),a.Logger.logTrace(c,`Queried iModel by name ${n} in project ${r}`),!(l.length>0))return a.Logger.logTrace(c,`iModel by name: iModel ${n} not found`),Promise.reject(new Error(`iModel by name: iModel ${n} not found`));s=l[0]}return s}async getInitializationState(e,t,r){const n=await this._seedFileHandler.get(e,t,r,(new SeedFileQuery).latest());return e.enter(),n.length<1?Promise.reject(new o.IModelHubError(a.IModelHubStatus.FileDoesNotExist)):n[0].initializationState}async create(e,t,r,n,i,s,l,d=12e4){if(e.enter(),a.Logger.logInfo(c,`Creating iModel in project ${r}`),o.ArgumentCheck.defined("token",t),o.ArgumentCheck.validGuid("contextId",r),o.ArgumentCheck.defined("name",n),o.ArgumentCheck.defined("pathName",i),"undefined"!==typeof window)return Promise.reject(o.IModelHubClientError.browser());if(!this._fileHandler)return Promise.reject(o.IModelHubClientError.fileHandler());if(!this._fileHandler.exists(i)||this._fileHandler.isDirectory(i))return Promise.reject(o.IModelHubClientError.fileNotFound());const h=await this.createIModelInstance(e,t,r,n,s);e.enter();try{await this._seedFileHandler.uploadSeedFile(e,t,h.id,i,s,l)}catch(n){return await this.delete(e,t,r,h.id),Promise.reject(n)}e.enter();const p="Cannot upload SeedFile "+i,f=d/10;for(let g=10;g>0;--g)try{const n=await this.getInitializationState(e,t,h.id);if(e.enter(),n===u.Successful)return a.Logger.logTrace(c,`Created iModel with id ${h.id} in project ${r}`),h.initialized=!0,h;if(n!==u.NotStarted&&n!==u.Scheduled)return a.Logger.logWarning(c,p),Promise.reject(new o.IModelHubError(a.IModelHubStatus.SeedFileInitializationFailed,`Seed file initialization failed with status ${u[n]}`));await new Promise(e=>setTimeout(e,f)),e.enter()}catch(t){return e.enter(),a.Logger.logWarning(c,p),Promise.reject(t)}return a.Logger.logWarning(c,p),Promise.reject(new Error("Timed out waiting for seed file initialization."))}async update(e,t,r,n){e.enter(),a.Logger.logInfo(c,`Updating iModel in project ${r}`),o.ArgumentCheck.defined("token",t),o.ArgumentCheck.validGuid("contextId",r);const i=await this._handler.postInstance(e,l,t,this.getRelativeUrl(r,n.id),n);return a.Logger.logTrace(c,`Updated iModel with id ${n.wsgId}`),i}async download(e,t,r,n,i){if(e.enter(),a.Logger.logInfo(c,`Downloading seed file for iModel ${r}`),o.ArgumentCheck.defined("token",t),o.ArgumentCheck.validGuid("imodelId",r),o.ArgumentCheck.defined("downloadToPathname",n),"undefined"!==typeof window)return Promise.reject(o.IModelHubClientError.browser());if(!this._fileHandler)return Promise.reject(o.IModelHubClientError.fileHandler());const s=await this._seedFileHandler.get(e,t,r,(new SeedFileQuery).selectDownloadUrl().latest());if(e.enter(),!s||!s[0]||!s[0].downloadUrl)return Promise.reject(o.IModelHubError.fromId(a.IModelHubStatus.FileDoesNotExist,"Failed to get seed file."));await this._fileHandler.downloadFile(e,s[0].downloadUrl,n,parseInt(s[0].fileSize,10),i),e.enter(),a.Logger.logTrace(c,`Downloading seed file for iModel ${r}`)}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(70),o=r(17),s=r(29),a=r(0),c=r(120),l=r(18),u="imodeljs-clients.imodelhub";function d(e){if(e&&void 0!==e.briefcaseId&&void 0!==e.lockType&&e.objectId)return`${e.lockType}-${e.objectId}-${e.briefcaseId}`}!function(e){e[e.Db=0]="Db",e[e.Model=1]="Model",e[e.Element=2]="Element",e[e.Schemas=3]="Schemas",e[e.CodeSpecs=4]="CodeSpecs"}(t.LockType||(t.LockType={})),function(e){e[e.None=0]="None",e[e.Shared=1]="Shared",e[e.Exclusive=2]="Exclusive"}(t.LockLevel||(t.LockLevel={}));class DefaultLockUpdateOptionsProvider{constructor(){this._defaultOptions={locksPerRequest:2e3}}async assignOptions(e){const t=Object.assign({},e);return i(e,this._defaultOptions),i(e,t),Promise.resolve()}}t.DefaultLockUpdateOptionsProvider=DefaultLockUpdateOptionsProvider;class ConflictingLocksError extends l.IModelHubError{static fromError(e){if(e.errorNumber!==a.IModelHubStatus.LockOwnedByAnotherBriefcase&&e.errorNumber!==a.IModelHubStatus.ConflictsAggregate)return;const t=new ConflictingLocksError(e.errorNumber);return i(t,e),t.addLocks(e),t}addLocks(e){if(e.data&&e.data.ConflictingLocks){this.conflictingLocks||(this.conflictingLocks=[]);for(const t of e.data.ConflictingLocks){const e={className:"Lock",schemaName:"iModelScope",properties:t},r=o.ECJsonTypeMap.fromJson(h,"wsg",e);r&&this.conflictingLocks.push(r)}}}}t.ConflictingLocksError=ConflictingLocksError;class LockBase extends o.WsgInstance{}n([o.ECJsonTypeMap.propertyToJson("wsg","properties.LockType")],LockBase.prototype,"lockType",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.LockLevel")],LockBase.prototype,"lockLevel",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.BriefcaseId")],LockBase.prototype,"briefcaseId",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.SeedFileId")],LockBase.prototype,"seedFileId",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.ReleasedWithChangeSet")],LockBase.prototype,"releasedWithChangeSet",void 0),n([o.ECJsonTypeMap.propertyToJson("wsg","properties.ReleasedWithChangeSetIndex")],LockBase.prototype,"releasedWithChangeSetIndex",void 0),t.LockBase=LockBase;let h=class Lock extends LockBase{};n([o.ECJsonTypeMap.propertyToJson("wsg","properties.ObjectId")],h.prototype,"objectId",void 0),h=n([o.ECJsonTypeMap.classToJson("wsg","iModelScope.Lock",{schemaPropertyName:"schemaName",classPropertyName:"className"})],h),t.Lock=h;let p=class MultiLock extends LockBase{};n([o.ECJsonTypeMap.propertyToJson("wsg","properties.ObjectIds")],p.prototype,"objectIds",void 0),p=n([o.ECJsonTypeMap.classToJson("wsg","iModelScope.MultiLock",{schemaPropertyName:"schemaName",classPropertyName:"className"})],p),t.MultiLock=p;class LockQuery extends c.Query{constructor(){super(...arguments),this._isMultiLockQuery=!0}get isMultiLockQuery(){return this._isMultiLockQuery}byBriefcaseId(e){return l.ArgumentCheck.validBriefcaseId("briefcaseId",e),this.addFilter(`BriefcaseId+eq+${e}`),this}byLockType(e){return this.addFilter(`LockType+eq+${e}`),this}byLockLevel(e){return this.addFilter(`LockLevel+eq+${e}`),this}byObjectId(e){return l.ArgumentCheck.defined("objectId",e),this._isMultiLockQuery=!1,this.addFilter(`ObjectId+eq+'${e}'`),this}byReleasedWithChangeSet(e){return l.ArgumentCheck.validChangeSetId("changeSetId",e),this.addFilter(`ReleasedWithChangeSet+eq+'${e}'`),this}byReleasedWithChangeSetIndex(e){return l.ArgumentCheck.definedNumber("changeSetIndex",e),this.addFilter(`ReleasedWithChangeSetIndex+eq+${e}`),this}byLocks(e){l.ArgumentCheck.nonEmptyArray("locks",e);let t="$id+in+[",r=0;for(const n of e){const e=d(n);l.ArgumentCheck.valid(`locks[${r}]`,e),0!==r++&&(t+=","),t+=`'${e}'`}return t+="]",this.addFilter(t),this._isMultiLockQuery=!1,this}top(e){return this._isMultiLockQuery=!1,super.top(e)}unavailableLocks(e,t){l.ArgumentCheck.validBriefcaseId("briefcaseId",e),l.ArgumentCheck.defined("lastChangeSetIndex",t);let r=`BriefcaseId+ne+${e}`;return r+=`+and+(LockLevel+gt+0+or+ReleasedWithChangeSetIndex+gt+${t})`,this.addFilter(r),this}}t.LockQuery=LockQuery;class LockHandler{constructor(e){this._handler=e}getRelativeUrl(e,t=!0,r){return`/Repositories/iModel--${e}/iModelScope/${t?"MultiLock":"Lock"}/${r||""}`}static convertLocksToMultiLocks(e){const t=new Map;for(const r of e){const e=`${r.lockType}-${r.lockLevel}`;if(t.has(e))t.get(e).objectIds.push(r.objectId);else{const n=new p;n.changeState="new",n.briefcaseId=r.briefcaseId,n.seedFileId=r.seedFileId,n.releasedWithChangeSet=r.releasedWithChangeSet,n.releasedWithChangeSetIndex=r.releasedWithChangeSetIndex,n.lockLevel=r.lockLevel,n.lockType=r.lockType,n.objectIds=[r.objectId],t.set(e,n)}}return Array.from(t.values())}static convertMultiLocksToLocks(e){const t=[];for(const r of e)for(const e of r.objectIds){const n=new h;n.objectId=e,n.briefcaseId=r.briefcaseId,n.seedFileId&&(n.seedFileId=r.seedFileId),n.lockLevel=r.lockLevel,n.lockType=r.lockType,t.push(n)}return t}async setupOptionDefaults(e){return LockHandler._defaultUpdateOptionsProvider||(LockHandler._defaultUpdateOptionsProvider=new DefaultLockUpdateOptionsProvider),LockHandler._defaultUpdateOptionsProvider.assignOptions(e)}async updateInternal(e,t,r,n,i){let o;e.enter(),i&&((o={}).CustomOptions={},!1===i.deniedLocks&&(o.CustomOptions.DetailedError_Codes="false"),i.unlimitedReporting&&(o.CustomOptions.DetailedError_MaximumInstances="-1"),i.continueOnConflict&&(o.CustomOptions.ConflictStrategy="Continue"),0===Object.getOwnPropertyNames(o.CustomOptions).length&&(o=void 0));const s=await this._handler.postInstances(e,p,t,`/Repositories/iModel--${r}/$changeset`,LockHandler.convertLocksToMultiLocks(n),o);return e.enter(),LockHandler.convertMultiLocksToLocks(s)}async update(e,t,r,n,i){e.enter(),a.Logger.logInfo(u,`Requesting locks for iModel ${r}`),l.ArgumentCheck.defined("token",t),l.ArgumentCheck.validGuid("imodelId",r),l.ArgumentCheck.nonEmptyArray("locks",n),i=i||{},this.setupOptionDefaults(i);const o=[];let d;const h=new c.AggregateResponseError;for(let c=0;c<n.length;c+=i.locksPerRequest){const u=n.slice(c,c+i.locksPerRequest);try{o.push(...await this.updateInternal(e,t,r,u,i)),e.enter()}catch(t){if(e.enter(),t instanceof s.ResponseError)if(i&&i.deniedLocks&&t instanceof l.IModelHubError&&(t.errorNumber===a.IModelHubStatus.LockOwnedByAnotherBriefcase||t.errorNumber===a.IModelHubStatus.ConflictsAggregate)){if(d?d.addLocks(t):d=ConflictingLocksError.fromError(t),!i.continueOnConflict)return Promise.reject(d)}else h.errors.push(t)}}return d?Promise.reject(d):h.errors.length>0?Promise.reject(h.errors.length>1?h:h.errors[0]):(a.Logger.logTrace(u,`Requested ${n.length} locks for iModel ${r}`),o)}async get(e,t,r,n=new LockQuery){let i;if(e.enter(),a.Logger.logInfo(u,`Querying locks for iModel ${r}`),l.ArgumentCheck.defined("token",t),l.ArgumentCheck.validGuid("imodelId",r),n.isMultiLockQuery){const o=await this._handler.getInstances(e,p,t,this.getRelativeUrl(r),n.getQueryOptions());e.enter(),i=LockHandler.convertMultiLocksToLocks(o)}else i=await this._handler.postQuery(e,h,t,this.getRelativeUrl(r,!1),n.getQueryOptions()),e.enter(),i=i.map(e=>{const t=new h;return t.briefcaseId=e.briefcaseId,t.lockLevel=e.lockLevel,t.lockType=e.lockType,t.objectId=e.objectId,e.seedFileId&&(t.seedFileId=e.seedFileId),t});return a.Logger.logTrace(u,`Queried ${i.length} locks for iModel ${r}`),i}async deleteAll(e,t,r,n){e.enter(),a.Logger.logInfo(u,`Deleting all locks from briefcase ${n} in iModel ${r}`),l.ArgumentCheck.defined("token",t),l.ArgumentCheck.validGuid("imodelId",r),l.ArgumentCheck.validBriefcaseId("briefcaseId",n),await this._handler.delete(e,t,this.getRelativeUrl(r,!1,`DeleteAll-${n}`)),e.enter(),a.Logger.logTrace(u,`Deleted all locks from briefcase ${n} in iModel ${r}`)}}t.LockHandler=LockHandler},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(0),s=r(57),a=r(18),c="imodeljs-clients.imodelhub";let l=class HubUserInfo extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Id")],l.prototype,"id",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Name")],l.prototype,"firstName",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Surname")],l.prototype,"lastName",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Email")],l.prototype,"email",void 0),l=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.UserInfo",{schemaPropertyName:"schemaName",classPropertyName:"className"})],l),t.HubUserInfo=l;let u=class UserStatistics extends l{};n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[HasStatistics].relatedInstance[Statistics].properties.BriefcasesCount")],u.prototype,"briefcasesCount",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[HasStatistics].relatedInstance[Statistics].properties.OwnedLocksCount")],u.prototype,"ownedLocksCount",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[HasStatistics].relatedInstance[Statistics].properties.PushedChangeSetsCount")],u.prototype,"pushedChangeSetsCount",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[HasStatistics].relatedInstance[Statistics].properties.LastChangeSetPushDate")],u.prototype,"lastChangeSetPushDate",void 0),u=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.UserInfo",{schemaPropertyName:"schemaName",classPropertyName:"className"})],u),t.UserStatistics=u;class UserStatisticsQuery extends s.Query{constructor(){super(),this._statisticsPrefix="HasStatistics-forward-Statistics",this._queriedByIds=!1,this.select("*")}byId(e){return a.ArgumentCheck.validGuid("id",e),this._byId=e,this}getId(){return this._byId}byIds(e){a.ArgumentCheck.nonEmptyArray("ids",e);let t="$id+in+[";return e.forEach((e,r)=>{a.ArgumentCheck.validGuid(`ids[${r}]`,e),r>0&&(t+=","),t+=`'${e}'`}),t+="]",this.addFilter(t),this._queriedByIds=!0,this}selectAll(){return this.addSelect(`${this._statisticsPrefix}.*`)}selectBriefcasesCount(){return this.addSelect(`${this._statisticsPrefix}.BriefcasesCount`)}selectPushedChangeSetsCount(){return this.addSelect(`${this._statisticsPrefix}.PushedChangeSetsCount`)}selectOwnedLocksCount(){return this.addSelect(`${this._statisticsPrefix}.OwnedLocksCount`)}selectLastChangeSetPushDate(){return this.addSelect(`${this._statisticsPrefix}.LastChangeSetPushDate`)}get isQueriedByIds(){return this._queriedByIds}}t.UserStatisticsQuery=UserStatisticsQuery;class UserStatisticsHandler{constructor(e){this._handler=e}getRelativeUrl(e,t){return`/Repositories/iModel--${e}/iModelScope/UserInfo/${t||""}`}async get(e,t,r,n=new UserStatisticsQuery){let i;return e.enter(),o.Logger.logInfo(c,`Querying user statistics for iModel ${r}`),a.ArgumentCheck.defined("token",t),a.ArgumentCheck.validGuid("imodelId",r),"*"===n.getQueryOptions().$select&&n.selectAll(),i=n.isQueriedByIds?await this._handler.postQuery(e,u,t,this.getRelativeUrl(r),n.getQueryOptions()):await this._handler.getInstances(e,u,t,this.getRelativeUrl(r,n.getId()),n.getQueryOptions()),e.enter(),o.Logger.logTrace(c,`Queried ${i.length} user statistics for iModel ${r}`),i}}t.UserStatisticsHandler=UserStatisticsHandler;class UserInfoQuery extends s.Query{constructor(){super(...arguments),this._queriedByIds=!1}byIds(e){a.ArgumentCheck.nonEmptyArray("ids",e);let t="$id+in+[";return e.forEach((e,r)=>{a.ArgumentCheck.validGuid(`id[${r}]`,e),r>0&&(t+=","),t+=`'${e}'`}),t+="]",this.addFilter(t),this._queriedByIds=!0,this}get isQueriedByIds(){return this._queriedByIds}byId(e){return a.ArgumentCheck.validGuid("id",e),this._byId=e,this}getId(){return this._byId}}t.UserInfoQuery=UserInfoQuery;t.UserInfoHandler=class UserInfoHandler{constructor(e){this._handler=e}Statistics(){return new UserStatisticsHandler(this._handler)}getRelativeUrl(e,t){return`/Repositories/iModel--${e}/iModelScope/UserInfo/${t||""}`}async get(e,t,r,n=new UserInfoQuery){let i;return e.enter(),o.Logger.logInfo(c,`Querying users for iModel ${r}`),a.ArgumentCheck.defined("token",t),a.ArgumentCheck.validGuid("imodelId",r),i=n.isQueriedByIds?await this._handler.postQuery(e,l,t,this.getRelativeUrl(r,n.getId()),n.getQueryOptions()):await this._handler.getInstances(e,l,t,this.getRelativeUrl(r,n.getId()),n.getQueryOptions()),e.enter(),o.Logger.logTrace(c,`Queried users for iModel ${r}`),i}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(0),s=r(18),a=r(57),c="imodeljs-clients.imodelhub";let l=class Version extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","instanceId")],l.prototype,"id",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Description")],l.prototype,"description",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Name")],l.prototype,"name",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.UserCreated")],l.prototype,"userCreated",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.CreatedDate")],l.prototype,"createdDate",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.ChangeSetId")],l.prototype,"changeSetId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[HasThumbnail].relatedInstance[SmallThumbnail].instanceId")],l.prototype,"smallThumbnailId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","relationshipInstances[HasThumbnail].relatedInstance[LargeThumbnail].instanceId")],l.prototype,"largeThumbnailId",void 0),l=n([i.ECJsonTypeMap.classToJson("wsg","iModelScope.Version",{schemaPropertyName:"schemaName",classPropertyName:"className"})],l),t.Version=l;class VersionQuery extends a.InstanceIdQuery{byName(e){return s.ArgumentCheck.defined("name",e),this.addFilter(`Name+eq+'${e}'`),this}byChangeSet(e){return s.ArgumentCheck.validChangeSetId("changesetId",e),this.addFilter(`ChangeSetId+eq+'${e}'`),this}selectThumbnailId(...e){s.ArgumentCheck.nonEmptyArray("sizes",e),this._query.$select||(this._query.$select="*");for(const t of e)this._query.$select+=`,HasThumbnail-forward-${t}Thumbnail.*`;return this}}t.VersionQuery=VersionQuery;t.VersionHandler=class VersionHandler{constructor(e){this._handler=e}getRelativeUrl(e,t){return`/Repositories/iModel--${e}/iModelScope/Version/${t||""}`}async get(e,t,r,n=new VersionQuery){e.enter(),o.Logger.logInfo(c,`Querying named versions for iModel ${r}`),s.ArgumentCheck.defined("token",t),s.ArgumentCheck.validGuid("imodelId",r);const i=await this._handler.getInstances(e,l,t,this.getRelativeUrl(r,n.getId()),n.getQueryOptions());return e.enter(),o.Logger.logTrace(c,`Queried named versions for iModel ${r}`),i}async create(e,t,r,n,i,a){e.enter(),o.Logger.logInfo(c,`Creating named version for iModel ${r}, changeSet id: ${n}`),s.ArgumentCheck.defined("token",t),s.ArgumentCheck.validGuid("imodelId",r),s.ArgumentCheck.validChangeSetId("changeSetId",n),s.ArgumentCheck.defined("name",i);let u=new l;return u.changeSetId=n,u.name=i,u.description=a,u=await this._handler.postInstance(e,l,t,this.getRelativeUrl(r),u),e.enter(),o.Logger.logTrace(c,`Created named version for iModel ${r}, changeSet id: ${n}`),u}async update(e,t,r,n){e.enter(),o.Logger.logInfo(c,`Updating named version for iModel ${r}, changeSet id: ${n.changeSetId}`),s.ArgumentCheck.defined("token",t),s.ArgumentCheck.validGuid("imodelId",r),s.ArgumentCheck.validGuid("version.wsgId",n.wsgId);const i=await this._handler.postInstance(e,l,t,this.getRelativeUrl(r,n.id),n);return e.enter(),o.Logger.logTrace(c,`Updated named version for iModel ${r}, changeSet id: ${n.changeSetId}`),i}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(247),i=r(232),o=r(18);t.IModelHubClient=class IModelHubClient extends n.IModelClient{constructor(e){super(new i.IModelBaseHandler,e)}async getAccessToken(e,t){return o.ArgumentCheck.defined("authorizationToken",t),this._handler.getAccessToken(e,t)}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),o=r(97),s=r(164),a=r(29),c=r(56);let l=class RealityData extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Id")],l.prototype,"id",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.OrganizationId")],l.prototype,"organizationId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.UltimateId")],l.prototype,"ultimateId",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.ContainerName")],l.prototype,"containerName",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.DataLocationGuid")],l.prototype,"dataLocationGuid",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Name")],l.prototype,"name",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.DataSet")],l.prototype,"dataSet",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Group")],l.prototype,"group",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Description")],l.prototype,"description",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.RootDocument")],l.prototype,"rootDocument",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Size")],l.prototype,"size",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Classification")],l.prototype,"classification",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Streamed")],l.prototype,"streamed",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Type")],l.prototype,"type",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Footprint")],l.prototype,"footprint",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.ThumbnailDocument")],l.prototype,"thumbnailDocument",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.MetadataUrl")],l.prototype,"metadataUrl",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Copyright")],l.prototype,"copyright",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.TermsOfUse")],l.prototype,"termsOfUse",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.AccuracyInMeters")],l.prototype,"accuracyInMeters",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.ResolutionInMeters")],l.prototype,"resolutionInMeters",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Visibility")],l.prototype,"visibility",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Listable")],l.prototype,"listable",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.ModifiedTimestamp")],l.prototype,"modifiedTimestamp",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.CreatedTimestamp")],l.prototype,"createdTimestamp",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.OwnedBy")],l.prototype,"ownedBy",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Version")],l.prototype,"version",void 0),l=n([i.ECJsonTypeMap.classToJson("wsg","S3MX.RealityData",{schemaPropertyName:"schemaName",classPropertyName:"className"})],l),t.RealityData=l;let u=class FileAccessKey extends i.WsgInstance{};n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Url")],u.prototype,"url",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Type")],u.prototype,"type",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.Permissions")],u.prototype,"permissions",void 0),n([i.ECJsonTypeMap.propertyToJson("wsg","properties.RequiresConfirmation")],u.prototype,"requiresConfirmation",void 0),u=n([i.ECJsonTypeMap.classToJson("wsg","FileAccess.FileAccessKey",{schemaPropertyName:"schemaName",classPropertyName:"className"})],u),t.FileAccessKey=u;class RealityDataServicesClient extends o.WsgClient{constructor(){super("v2.5")}updateModelName(e){return e.includes("/")||e.includes("~2F")||e.includes("%2F")||void 0===this._blobRoot?e:this._blobRoot+"/"+e}getUrlSearchKey(){return RealityDataServicesClient.searchKey}getRelyingPartyUrl(){if(c.Config.App.has(RealityDataServicesClient.configRelyingPartyUri))return c.Config.App.get(RealityDataServicesClient.configRelyingPartyUri)+"/";if(c.Config.App.getBoolean(o.WsgClient.configUseHostRelyingPartyUriAsFallback,!0)&&c.Config.App.has(o.WsgClient.configHostRelyingPartyUri))return c.Config.App.get(o.WsgClient.configHostRelyingPartyUri)+"/";throw new Error(`RelyingPartyUrl not set. Set it in Config.App using key ${RealityDataServicesClient.configRelyingPartyUri}`)}async getRealityData(e,t,r,n){return this.getInstances(e,l,t,`/Repositories/S3MXECPlugin--${r}/S3MX/RealityData/${n}`)}async getAppDataFileAccessKey(e,t,r,n){return this.getFileAccessKey(e,t,r,n,"Bim_AppData.json")}async getFileAccessKey(e,t,r,n,i){const o=encodeURIComponent(n+"/"+this.updateModelName(i)).split("%").join("~");return this.getInstances(e,u,t,`/Repositories/S3MXECPlugin--${r}/S3MX/Document/${o}/FileAccess.FileAccessKey?$filter=Permissions+eq+%27Read%27`)}async getTileDataBlobUrl(e,t,r,n,i){return(await this.getFileAccessKey(e,t,r,n,i))[0].url}async getAppDataBlobUrl(e,t,r,n){return(await this.getFileAccessKey(e,t,r,n,"Bim_AppData.json"))[0].url}async getAppData(e,t,r,n){return this.getTileJson(e,t,r,n,"Bim_AppData.json")}cleanTilesetUrl(e){const t=e.split("//").filter(e=>"TileSets"!==e&&"Bim"!==e).join("/");return t.includes("?")?t.slice(0,t.indexOf("?")):t}async getModelData(e,t,r,n,i){return this.getTileJson(e,t,r,n,this.cleanTilesetUrl(i))}async getBlobUrl(e,t,r,n,i){const o=await this.getTileDataBlobUrl(e,t,r,n,i);return"undefined"===typeof this._blobUrl&&(this._blobUrl="undefined"!==typeof window?new window.URL(o):new s.URL(o)),Promise.resolve(this._blobUrl)}async getBlobStringUrl(e,t,r,n,i){const o=void 0===this._blobUrl?await this.getBlobUrl(e,t,r,n,i):this._blobUrl,s=o.origin+o.pathname,a=o.search;return`${s}/${this.updateModelName(i)}${a}`}async getTileJson(e,t,r,n,i){const o=await this.getBlobStringUrl(e,t,r,n,i);return(await a.request(e,o,{method:"GET",responseType:"json"})).body}async getTileContent(e,t,r,n,i){const o=await this.getBlobStringUrl(e,t,r,n,this.cleanTilesetUrl(i));return(await a.request(e,o,{method:"GET",responseType:"arraybuffer"})).body}async getRootDocumentJson(e,t,r,n){const i=await this.getRealityData(e,t,r,n);e.enter();let o=i[0].rootDocument;return this._blobUrl=void 0,o.includes("/")&&(o=o.split("/")[o.split("/").length-1]),await this.getModelData(e,t,r,n,o)}async getTileDataFromUrl(e,t,r){try{const n=t.split("/"),i=n.find(e=>e.includes("--")).split("--")[1],o=n.find(e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e));return r(e,i,o,t.split(o+"/")[1])}catch(e){throw new Error(e)}}async getTileJsonFromUrl(e,t){return this.getTileDataFromUrl(e,t,this.getTileJson.bind(this))}async getTileContentFromUrl(e,t){return this.getTileDataFromUrl(e,t,this.getTileContent.bind(this))}}RealityDataServicesClient.searchKey="RealityDataServices",RealityDataServicesClient.configRelyingPartyUri="imjs_reality_data_service_relying_party_uri",t.RealityDataServicesClient=RealityDataServicesClient},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(29),i=r(81),o=r(248),s=r(118),a=r(119);class ConnectSettingsClient extends i.Client{constructor(e){super(),this.applicationId=e}async getAccessToken(e,t){const r=await this.getUrl(e),n=new a.ImsDelegationSecureTokenClient;return await n.getToken(e,t,r)}getUrlSearchKey(){return ConnectSettingsClient.searchKey}getUrlOptions(e,t,r,n,i,o){let a,c;if(a=r?`/User/Setting/${e}/${t}`:`/Setting/${e}/${t}`,n)c=i?o?`/v1.0/Application/${this.applicationId}/Context/${i}/iModel/${o}${a}`:`/v1.0/Application/${this.applicationId}/Context/${i}${a}`:`/v1.0/Application/${this.applicationId}${a}`;else{if(!i)throw new s.BentleyError(32768,"Improperly specified setting");c=o?`/v1.0/Context/${i}/iModel/${o}${a}`:`/v1.0/Context/${i}${a}`}return c}formErrorResponse(e){return 400===e.status?new o.SettingsResult(110595,"Malformed URL or invalid Project "+JSON.stringify(e)):401===e.status?new o.SettingsResult(110593,"Authorization failure "+JSON.stringify(e)):404===e.status?new o.SettingsResult(110597):new o.SettingsResult(110598,"Status indicates server error "+JSON.stringify(e))}async saveAnySetting(e,t,r,i,s,a,c,l,u){const d=await this.getUrl(e),h={method:"PUT",headers:{authorization:a.toTokenString()},body:{properties:r}};await this.setupOptionDefaults(h);const p=this.getUrlOptions(i,s,t,c,l,u),f=d.concat(p);return n.request(e,f,h).then(e=>Promise.resolve(new o.SettingsResult(0)),e=>e.status<200||e.status>299?Promise.resolve(this.formErrorResponse(e)):Promise.resolve(new o.SettingsResult(110600,"Unexpected Status "+JSON.stringify(e))))}async getAnySetting(e,t,r,i,s,a,c,l){const u=await this.getUrl(e),d={method:"GET",headers:{authorization:s.toTokenString()}};await this.setupOptionDefaults(d);const h=this.getUrlOptions(r,i,t,a,c,l),p=u.concat(h);return n.request(e,p,d).then(e=>Promise.resolve(new o.SettingsResult(0,void 0,e.body.properties)),e=>e.status<200||e.status>299?Promise.resolve(this.formErrorResponse(e)):Promise.resolve(new o.SettingsResult(110600,"Unexpected Status "+JSON.stringify(e))))}async deleteAnySetting(e,t,r,i,s,a,c,l){const u=await this.getUrl(e),d={method:"DELETE",headers:{authorization:s.toTokenString()}};await this.setupOptionDefaults(d);const h=this.getUrlOptions(r,i,t,a,c,l),p=u.concat(h);return n.request(e,p,d).then(e=>Promise.resolve(new o.SettingsResult(0)),e=>e.status<200||e.status>299?Promise.resolve(this.formErrorResponse(e)):Promise.resolve(new o.SettingsResult(110600,"Unexpected Status "+JSON.stringify(e))))}async saveUserSetting(e,t,r,n,i,o,s,a){return this.saveAnySetting(e,!0,t,r,n,i,o,s,a)}async getUserSetting(e,t,r,n,i,o,s){return this.getAnySetting(e,!0,t,r,n,i,o,s)}async deleteUserSetting(e,t,r,n,i,o,s){return this.deleteAnySetting(e,!0,t,r,n,i,o,s)}async saveSetting(e,t,r,n,i,o,s,a){return this.saveAnySetting(e,!1,t,r,n,i,o,s,a)}async getSetting(e,t,r,n,i,o,s){return this.getAnySetting(e,!1,t,r,n,i,o,s)}async deleteSetting(e,t,r,n,i,o,s){return this.deleteAnySetting(e,!1,t,r,n,i,o,s)}}ConnectSettingsClient.searchKey="ProductSettingsService.RP",t.ConnectSettingsClient=ConnectSettingsClient},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(449))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(81);class OidcClient extends n.Client{constructor(){super()}getUrlSearchKey(){return OidcClient.searchKey}}OidcClient.searchKey="IMSOpenID",t.OidcClient=OidcClient},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);var n;!function(e){e[e.Blob=1]="Blob",e[e.Boolean=2]="Boolean",e[e.DateTime=3]="DateTime",e[e.Double=4]="Double",e[e.Geometry=5]="Geometry",e[e.Id=6]="Id",e[e.Int=7]="Int",e[e.Int64=8]="Int64",e[e.Point2d=9]="Point2d",e[e.Point3d=10]="Point3d",e[e.String=11]="String",e[e.Navigation=12]="Navigation",e[e.Struct=13]="Struct",e[e.PrimitiveArray=14]="PrimitiveArray",e[e.StructArray=15]="StructArray",e[e.Guid=16]="Guid"}(t.ECSqlValueType||(t.ECSqlValueType={})),function(e){e[e.Insert=1]="Insert",e[e.Update=2]="Update",e[e.Delete=4]="Delete"}(t.ChangeOpCode||(t.ChangeOpCode={})),function(e){e[e.AfterInsert=1]="AfterInsert",e[e.BeforeUpdate=2]="BeforeUpdate",e[e.AfterUpdate=3]="AfterUpdate",e[e.BeforeDelete=4]="BeforeDelete"}(t.ChangedValueState||(t.ChangedValueState={})),function(e){e[e.ECInstanceId=0]="ECInstanceId",e[e.ECClassId=1]="ECClassId",e[e.SourceECInstanceId=2]="SourceECInstanceId",e[e.SourceECClassId=3]="SourceECClassId",e[e.TargetECInstanceId=4]="TargetECInstanceId",e[e.TargetECClassId=5]="TargetECClassId",e[e.NavigationId=6]="NavigationId",e[e.NavigationRelClassId=7]="NavigationRelClassId",e[e.PointX=8]="PointX",e[e.PointY=9]="PointY",e[e.PointZ=10]="PointZ"}(n=t.ECSqlSystemProperty||(t.ECSqlSystemProperty={}));class ECJsNames{static toJsName(e,t){const r=void 0===t||null===t,i=e.split("."),o=i.length;if(1===o){if(r||t){if("ECInstanceId"===e)return ECJsNames.systemPropertyToJsName(n.ECInstanceId);if("ECClassId"===e)return ECJsNames.systemPropertyToJsName(n.ECClassId);if("SourceECInstanceId"===e)return ECJsNames.systemPropertyToJsName(n.SourceECInstanceId);if("TargetECInstanceId"===e)return ECJsNames.systemPropertyToJsName(n.TargetECInstanceId);if("SourceECClassId"===e)return ECJsNames.systemPropertyToJsName(n.SourceECClassId);if("TargetECClassId"===e)return ECJsNames.systemPropertyToJsName(n.TargetECClassId);if(r)return ECJsNames.lowerFirstChar(e);throw new Error(`Property ${e} is no ECSQL system property.`)}return ECJsNames.lowerFirstChar(e)}let s=ECJsNames.lowerFirstChar(i[0]+".");for(let n=1;n<o-1;n++)s+=i[n]+".";const a=i[o-1];if(r||t)if("Id"===a)s+=ECJsNames.systemPropertyToJsName(n.NavigationId);else if("RelECClassId"===a)s+=ECJsNames.systemPropertyToJsName(n.NavigationRelClassId);else if("X"===a)s+=ECJsNames.systemPropertyToJsName(n.PointX);else if("Y"===a)s+=ECJsNames.systemPropertyToJsName(n.PointY);else if("Z"===a)s+=ECJsNames.systemPropertyToJsName(n.PointZ);else{if(!r)throw new Error(`Property ${a} of access string ${e} is no ECSQL system property.`);s+=ECJsNames.lowerFirstChar(a)}else s+=a;return s}static systemPropertyToJsName(e){switch(e){case n.ECInstanceId:case n.NavigationId:return"id";case n.ECClassId:return"className";case n.SourceECInstanceId:return"sourceId";case n.SourceECClassId:return"sourceClassName";case n.TargetECInstanceId:return"targetId";case n.TargetECClassId:return"targetClassName";case n.NavigationRelClassId:return"relClassName";case n.PointX:return"x";case n.PointY:return"y";case n.PointZ:return"z";default:throw new Error(`Unknown ECSqlSystemProperty enum value ${e}.`)}}static lowerFirstChar(e){return e[0].toLowerCase()+e.substring(1)}}t.ECJsNames=ECJsNames},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3),o=r(250);!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Binary=257]="Binary",e[e.Boolean=513]="Boolean",e[e.DateTime=769]="DateTime",e[e.Double=1025]="Double",e[e.Integer=1281]="Integer",e[e.Long=1537]="Long",e[e.Point2d=1793]="Point2d",e[e.Point3d=2049]="Point3d",e[e.String=2305]="String"}(t.PrimitiveTypeCode||(t.PrimitiveTypeCode={}));class PropertyMetaData{constructor(e){this.primitiveType=e.primitiveType,e.structName&&(this.structName=e.structName),this.extendedType=e.extendedType,this.description=e.description,this.displayLabel=e.displayLabel,void 0!==e.minimumValue&&(this.minimumValue=e.minimumValue),void 0!==e.maximumValue&&(this.maximumValue=e.maximumValue),void 0!==e.minimumLength&&(this.minimumLength=e.minimumLength),void 0!==e.maximumLength&&(this.maximumLength=e.maximumLength),this.readOnly=e.readOnly,this.kindOfQuantity=e.kindOfQuantity,this.isCustomHandled=e.isCustomHandled,void 0!==e.minOccurs&&(this.minOccurs=e.minOccurs),void 0!==e.maxOccurs&&(this.maxOccurs=e.maxOccurs),this.direction=e.direction,this.relationshipClass=e.relationshipClass,this.customAttributes=e.customAttributes}createValueOrArray(e,t){if(void 0===this.minOccurs)return e(t);const r=[];return t.forEach(t=>r.push(e(t))),r}createProperty(e){if(void 0!==e){if(void 0!==this.primitiveType)switch(this.primitiveType){case 513:case 1025:case 1281:case 2305:return e;case 1793:return this.createValueOrArray(i.Point2d.fromJSON,e);case 2049:return this.createValueOrArray(i.Point3d.fromJSON,e)}return void 0!==this.direction?void 0!==e.id?new o.RelatedElement(e):n.Id64.fromJSON(e):e}}}t.PropertyMetaData=PropertyMetaData;t.EntityMetaData=class EntityMetaData{constructor(e){this.ecclass=e.ecclass,this.description=e.description,this.modifier=e.modifier,this.displayLabel=e.displayLabel,this.baseClasses=e.baseClasses,this.customAttributes=e.customAttributes,this.properties={};for(const t in e.properties)t&&(this.properties[t]=new PropertyMetaData(e.properties[t]))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class PascalCoefficients{static getRow(e){const t=PascalCoefficients._allRows;for(0===t.length&&(t.push(new Float64Array([1])),t.push(new Float64Array([1,1])),t.push(new Float64Array([1,2,1])),t.push(new Float64Array([1,3,3,1])),t.push(new Float64Array([1,4,6,4,1])),t.push(new Float64Array([1,5,10,10,5,1])),t.push(new Float64Array([1,6,15,20,15,6,1])),t.push(new Float64Array([1,7,21,35,35,21,7,1])));t.length<=e;){const e=t.length,r=t[e-1],n=new Float64Array(e+1);n[0]=1;for(let t=1;t<e;t++)n[t]=r[t-1]+r[t];n[e]=1,t.push(n)}return t[e]}static getBezierBasisValues(e,t,r){const n=e-1,i=PascalCoefficients.getRow(n);(void 0===r||r.length<e)&&(r=new Float64Array(e));for(let a=0;a<e;a++)r[a]=i[a];let o=t;for(let a=1;a<e;a++,o*=t)r[a]*=o;const s=1-t;o=s;for(let a=e-2;a>=0;a--,o*=s)r[a]*=o;return r}static getBezierBasisDerivatives(e,t,r){const n=e-1;(r=this.getBezierBasisValues(e-1,t,r))[e-1]=n*r[e-2];for(let i=e-2;i>0;i--)r[i]=n*(r[i-1]-r[i]);return r[0]=-n*r[0],r}}PascalCoefficients._allRows=[],t.PascalCoefficients=PascalCoefficients},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(6),o=r(19),s=r(21),a=r(22),c=r(72),l=r(5),u=r(16),d=r(14),h=r(254),p=r(59);class BezierCurve3d extends h.BezierCurveBase{isSameGeometryClass(e){return e instanceof BezierCurve3d}tryTransformInPlace(e){const t=this._workData0;for(let r=0;r<this._polygon.order;r++)this._polygon.getPolygonPoint(r,t),e.multiplyXYZToFloat64Array(t[0],t[1],t[2],t),this._polygon.setPolygonPoint(r,t);return!0}getPolePoint3d(e,t){const r=this._polygon.getPolygonPoint(e,this._workData0);if(r)return i.Point3d.create(r[0],r[1],r[2],t)}getPolePoint4d(e,t){const r=this._polygon.getPolygonPoint(e,this._workData0);if(r)return o.Point4d.create(r[0],r[1],r[2],1,t)}constructor(e){super(3,e),this._workRay0=s.Ray3d.createXAxis(),this._workRay1=s.Ray3d.createXAxis()}copyPointsAsLineString(){const e=d.LineString3d.create();for(let t=0;t<this._polygon.order;t++)e.addPoint(this.getPolePoint3d(t));return e}static create(e){if(e.length<1)return;const t=new Float64Array(3*e.length);if(e[0]instanceof i.Point3d){let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=n.z;return new BezierCurve3d(t)}if(e[0]instanceof n.Point2d){let r=0;for(const n of e)t[r++]=n.x,t[r++]=n.y,t[r++]=0;return new BezierCurve3d(t)}}static createOrder(e){const t=new Float64Array(3*e);return new BezierCurve3d(t)}loadSpanPoles(e,t){this._polygon.loadSpanPoles(e,t)}clone(){return new BezierCurve3d(this._polygon.clonePolygon())}clonePartialCurve(e,t){const r=new BezierCurve3d(this._polygon.clonePolygon());return r._polygon.subdivideToIntervalInPlace(e,t),r}cloneTransformed(e){const t=this.clone();return t.tryTransformInPlace(e),t}fractionToPoint(e,t){return this._polygon.evaluate(e,this._workData0),i.Point3d.create(this._workData0[0],this._workData0[1],this._workData0[2],t)}fractionToPointAndDerivative(e,t){return this._polygon.evaluate(e,this._workData0),this._polygon.evaluateDerivative(e,this._workData1),s.Ray3d.createXYZUVW(this._workData0[0],this._workData0[1],this._workData0[2],this._workData1[0],this._workData1[1],this._workData1[2],t)}fractionToPointAnd2Derivatives(e,t){t||(t=a.Plane3dByOriginAndVectors.createXYPlane());const r=this.fractionToPointAndDerivative(e,this._workRay0);t.origin.setFrom(r.origin),t.vectorU.setFrom(r.direction);const n=this.fractionToPointAndDerivative(e-1e-8,this._workRay0),o=this.fractionToPointAndDerivative(e+1e-8,this._workRay1);return i.Vector3d.createAdd2Scaled(n.direction,-5e7,o.direction,5e7,t.vectorV),t}isAlmostEqual(e){return e instanceof BezierCurve3d&&this._polygon.isAlmostEqual(e._polygon)}strokeCount(e){const t=this._polygon.packedData;let r,n,i,o=t[3]-t[0],s=t[4]-t[1],a=t[5]-t[2],d=0,h=l.Geometry.hypotenuseXYZ(o,s,a);const p=t.length;for(let c=6;c+2<p;c+=3)r=t[c]-t[c-3],n=t[c+1]-t[c-2],i=t[c+2]-t[c-1],d+=u.Angle.radiansBetweenVectorsXYZ(o,s,a,r,n,i),h+=l.Geometry.hypotenuseXYZ(r,n,i),o=r,s=n,a=i;return c.StrokeOptions.applyAngleTol(e,c.StrokeOptions.applyMaxEdgeLength(e,1,h),d,.2)}dispatchToGeometryHandler(e){return e.handleBezierCurve3d(this)}extendRange(e,t){const r=this.order;if(t){this.allocateAndZeroBezierWorkData(r-1,r,0);const n=this._workBezier,i=this._workCoffsA;this.getPolePoint3d(0,this._workPoint0),e.extendTransformedPoint(t,this._workPoint0),this.getPolePoint3d(r-1,this._workPoint0),e.extendTransformedPoint(t,this._workPoint0);const o=this._polygon.packedData;for(let s=0;s<3;s++){for(let e=0,n=0;e<r;e++,n+=3)i[e]=t.multiplyComponentXYZ(s,o[n],o[n+1],o[n+2]);p.BezierPolynomialAlgebra.univariateDifference(i,n.coffs);const a=n.roots(0,!0);if(a&&a.length>0)for(const r of a)this.fractionToPoint(r,this._workPoint0),e.extendTransformedPoint(t,this._workPoint0)}}else{this.allocateAndZeroBezierWorkData(r-1,0,0);const t=this._workBezier;this.getPolePoint3d(0,this._workPoint0),e.extend(this._workPoint0),this.getPolePoint3d(r-1,this._workPoint0),e.extend(this._workPoint0);for(let n=0;n<3;n++){p.BezierPolynomialAlgebra.componentDifference(t.coffs,this._polygon.packedData,3,r,n);const i=t.roots(0,!0);if(i)for(const t of i)this.fractionToPoint(t,this._workPoint0),e.extend(this._workPoint0)}}}}t.BezierCurve3d=BezierCurve3d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(16),i=r(10);class OrderedRotationAngles{constructor(e,t,r,n){this._x=e,this._y=t,this._z=r,this._order=n}get order(){return this._order}get xAngle(){return this._x.clone()}get yAngle(){return this._y.clone()}get zAngle(){return this._z.clone()}get xDegrees(){return this._x.degrees}get xRadians(){return this._x.radians}get yDegrees(){return this._y.degrees}get yRadians(){return this._y.radians}get zDegrees(){return this._z.degrees}get zRadians(){return this._z.radians}static get treatVectorsAsColumns(){return OrderedRotationAngles._sTreatVectorsAsColumns}static set treatVectorsAsColumns(e){OrderedRotationAngles._sTreatVectorsAsColumns=e}static createAngles(e,t,r,n,i){return i?(i._x.setFrom(e),i._y.setFrom(t),i._z.setFrom(r),i._order=n,i):new OrderedRotationAngles(e.clone(),t.clone(),r.clone(),n)}static createRadians(e,t,r,i,o){return o?(o._x.setRadians(e),o._y.setRadians(t),o._z.setRadians(r),o._order=i,o):new OrderedRotationAngles(n.Angle.createRadians(e),n.Angle.createRadians(t),n.Angle.createRadians(r),i)}static createDegrees(e,t,r,i,o){return o?(o._x.setDegrees(e),o._y.setDegrees(t),o._z.setDegrees(r),o._order=i,o):new OrderedRotationAngles(n.Angle.createDegrees(e),n.Angle.createDegrees(t),n.Angle.createDegrees(r),i)}static createFromMatrix3d(e,t,r){let n,i,o,s=e.coffs[0],a=e.coffs[3],c=e.coffs[6],l=e.coffs[1],u=e.coffs[4],d=e.coffs[7],h=e.coffs[2],p=e.coffs[5],f=e.coffs[8];switch(OrderedRotationAngles.treatVectorsAsColumns&&(s=e.coffs[0],a=e.coffs[1],c=e.coffs[2],l=e.coffs[3],u=e.coffs[4],d=e.coffs[5],h=e.coffs[6],p=e.coffs[7],f=e.coffs[8]),t){case 0:i=Math.asin(Math.max(-1,Math.min(1,c))),Math.abs(c)<.99999?(n=Math.atan2(-d,f),o=Math.atan2(-a,s)):(n=Math.atan2(p,u),o=0);break;case 5:n=Math.asin(-Math.max(-1,Math.min(1,d))),Math.abs(d)<.99999?(i=Math.atan2(c,f),o=Math.atan2(l,u)):(i=Math.atan2(-h,s),o=0);break;case 2:n=Math.asin(Math.max(-1,Math.min(1,p))),Math.abs(p)<.99999?(i=Math.atan2(-h,f),o=Math.atan2(-a,u)):(i=0,o=Math.atan2(l,s));break;case 6:i=-Math.asin(Math.max(-1,Math.min(1,h))),Math.abs(h)<.99999?(n=Math.atan2(p,f),o=Math.atan2(l,s)):(n=0,o=Math.atan2(-a,u));break;case 1:o=Math.asin(Math.max(-1,Math.min(1,l))),Math.abs(l)<.99999?(n=Math.atan2(-d,u),i=Math.atan2(-h,s)):(n=0,i=Math.atan2(c,f));break;case 4:o=-Math.asin(Math.max(-1,Math.min(1,a))),Math.abs(a)<.99999?(n=Math.atan2(p,u),i=Math.atan2(c,s)):(n=Math.atan2(-d,f),i=0);break;default:n=i=o=0}return OrderedRotationAngles.treatVectorsAsColumns?OrderedRotationAngles.createRadians(-n,-i,-o,t,r):OrderedRotationAngles.createRadians(n,i,o,t,r)}toMatrix3d(e){const t=void 0!==e?e:new i.Matrix3d,r=this.order,n=this.xAngle,o=this.yAngle,s=this.zAngle,a=n.cos();let c=n.sin();const l=o.cos();let u=o.sin();const d=s.cos();let h=s.sin();if(OrderedRotationAngles.treatVectorsAsColumns&&(c=-c,u=-u,h=-h),0===r){const e=a*d,r=a*h,n=c*d,i=c*h;t.setRowValues(l*d,r+n*u,i-e*u,-l*h,e-i*u,n+r*u,u,-c*l,a*l)}else if(5===r){const e=l*d,r=l*h,n=u*d,i=u*h;t.setRowValues(e+i*c,a*h,r*c-n,n*c-r,a*d,i+e*c,a*u,-c,a*l)}else if(2===r){const e=l*d,r=l*h,n=u*d,i=u*h;t.setRowValues(e-i*c,r+n*c,-a*u,-a*h,a*d,c,n+r*c,i-e*c,a*l)}else if(6===r){const e=a*d,r=a*h,n=c*d,i=c*h;t.setRowValues(l*d,l*h,-u,n*u-r,i*u+e,c*l,e*u+i,r*u-n,a*l)}else if(1===r){const e=a*l,r=a*u,n=c*l,i=c*u;t.setRowValues(l*d,h,-u*d,i-e*h,a*d,r*h+n,n*h+r,-c*d,e-i*h)}else if(4===r){const e=a*l,r=a*u,n=c*l,i=c*u;t.setRowValues(l*d,e*h+i,n*h-r,-h,a*d,c*d,u*d,r*h-n,i*h+e)}return OrderedRotationAngles.treatVectorsAsColumns&&t.transposeInPlace(),t}}OrderedRotationAngles._sTreatVectorsAsColumns=!1,t.OrderedRotationAngles=OrderedRotationAngles},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class Constant{}Constant.oneMillimeter=.001,Constant.oneCentimeter=.01,Constant.oneMeter=1,Constant.oneKilometer=1e3,Constant.diameterOfEarth=12742*Constant.oneKilometer,Constant.circumferenceOfEarth=40075*Constant.oneKilometer,Constant.radiansPerDegree=.0174532925,t.Constant=Constant},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(260),i=r(23),o=r(9),s=r(5),a=r(51);class ClipVector{constructor(e){this.boundingRange=i.Range3d.createNull(),this._clips=e||[]}get clips(){return this._clips}get isValid(){return this._clips.length>0}static createEmpty(e){return e?(e._clips.length=0,e):new ClipVector}static createClipShapeRefs(e,t){return t?(t._clips=e,t):new ClipVector(e)}static createClipShapeClones(e,t){const r=[];for(const n of e)r.push(n.clone());return ClipVector.createClipShapeRefs(r,t)}static createFrom(e,t){const r=t||new ClipVector;r._clips.length=0;for(const n of e._clips)r._clips.push(n.clone());return r.boundingRange.setFrom(e.boundingRange),r}toJSON(){if(!this.isValid)return[];const e=[];for(const t of this.clips)e.push(t.toJSON());return e}static fromJSON(e,t){(t=t||new ClipVector).clear();try{for(const r of e){const e=n.ClipShape.fromJSON(r);e&&t._clips.push(e)}}catch(e){t.clear()}return t}clone(e){return ClipVector.createFrom(this,e)}clear(){this._clips.length=0}appendClone(e){this._clips.push(e.clone())}appendReference(e){this._clips.push(e)}appendShape(e,t,r,i,o=!1,s=!1){const a=n.ClipShape.createShape(e,t,r,i,o,s);return!!a&&(this._clips.push(a),!0)}getRange(e,t){const r=i.Range3d.createNull(t);for(const n of this._clips){const t=n.getRange(!1,e);void 0!==t&&(r.isNull?r.setFrom(t):r.intersect(t,r))}return this.boundingRange.isNull||r.intersect(this.boundingRange,r),r}pointInside(e,t=s.Geometry.smallMetricDistanceSquared){if(!this.boundingRange.isNull&&!this.boundingRange.containsPoint(e))return!1;for(const r of this._clips)if(!r.pointInside(e,t))return!1;return!0}transformInPlace(e){for(const t of this._clips)if(!1===t.transformInPlace(e))return!1;return this.boundingRange.isNull||e.multiplyRange(this.boundingRange,this.boundingRange),!0}extractBoundaryLoops(e,t){let r=0,n=-Number.MAX_VALUE,i=Number.MAX_VALUE;const s=[];let a=0;if(0===this._clips.length)return s;const c=o.Transform.createIdentity();for(const l of this._clips){if(l!==this._clips[0]){let e=o.Transform.createIdentity(),t=o.Transform.createIdentity();this._clips[0].transformValid&&l.transformValid&&(e=l.transformFromClip.clone(),t=this._clips[0].transformToClip.clone()),c.setFrom(t.multiplyTransformTransform(e))}if(e[a]=[],void 0!==l.polygon){r=15,l.zHighValid&&(r|=32,i=l.zHigh),l.zLowValid&&(r|=16,n=l.zLow);for(const t of l.polygon)e[a].push(t.clone());c.multiplyPoint3dArray(e[a],e[a]),a++}}return s.push(r),s.push(n),s.push(i),t&&t.setFrom(this._clips[0].transformFromClip),s}setInvisible(e){for(const t of this._clips)t.setInvisible(e)}parseClipPlanes(){for(const e of this._clips)e.fetchClipPlanesRef()}multiplyPlanesTimesMatrix(e){let t=0;for(const r of this._clips)!1===r.multiplyPlanesTimesMatrix(e)&&t++;return 0===t}classifyPointContainment(e,t=!1){let r=2;for(const n of this._clips){const i=n.classifyPointContainment(e,t);if(2===i)return 2;if(2===r)r=i;else if(r!==i)return 2}return r}classifyRangeContainment(e,t){const r=e.corners();return this.classifyPointContainment(r,t)}isAnyLineStringPointInside(e){for(const t of this._clips){const r=t.fetchClipPlanesRef();for(let t=0;t+1<e.length;t++){const n=a.LineSegment3d.create(e[t],e[t+1]);if(r.isAnyPointInOrOnFromSegment(n))return!0}}return!1}sumSizes(e,t,r){let n=0;for(let i=t;i<r;i++)n+=e[i].x1-e[i].x0;return n}isLineStringCompletelyContained(e){const t=[];for(let r=0;r+1<e.length;r++){const n=a.LineSegment3d.create(e[r],e[r+1]);let i=0,o=0;for(const e of this._clips){e.fetchClipPlanesRef().appendIntervalsFromSegment(n,t);const r=t.length;if(i+=this.sumSizes(t,o,r),o=r,i>=ClipVector._TARGET_FRACTION_SUM)break}if(i<ClipVector._TARGET_FRACTION_SUM)return!1}return!0}}ClipVector._TARGET_FRACTION_SUM=.99999999,t.ClipVector=ClipVector},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(23),o=r(5);class Ray2d{constructor(e,t){this._origin=e,this._direction=t}static createOriginAndTarget(e,t){return new Ray2d(e.clone(),e.vectorTo(t))}static createOriginAndDirection(e,t){return new Ray2d(e.clone(),t.clone())}static createOriginAndDirectionCapture(e,t){return new Ray2d(e,t)}get origin(){return this._origin}get direction(){return this._direction}parallelRay(e){return new Ray2d(this._origin.addForwardLeft(0,e,this._direction),this._direction)}CCWPerpendicularRay(){return new Ray2d(this._origin,this._direction.rotate90CCWXY())}CWPerpendicularRay(){return new Ray2d(this._origin,this._direction.rotate90CWXY())}normalizeDirectionInPlace(){return!!this._direction.normalize(this._direction)||(this._direction.x=1,this._direction.y=0,!1)}intersectUnboundedLine(e,t,r,n){const i=e.vectorTo(t),s=e.vectorTo(this._origin).crossProduct(i);n[0]=this._direction.crossProduct(i);const a=o.Geometry.conditionalDivideFraction(-s,n[0]);return void 0!==a?(r[0]=a,!0):(r[0]=0,!1)}projectionFraction(e){return this._origin.vectorTo(e).fractionOfProjectionToVector(this._direction)}perpendicularProjectionFraction(e){const t=this._direction.crossProduct(this._origin.vectorTo(e)),r=this._direction.magnitudeSquared();return o.Geometry.safeDivideFraction(t,r,0)}fractionToPoint(e){return this._origin.plusScaled(this._direction,e)}}t.Ray2d=Ray2d;class ConvexPolygon2d{constructor(e){this._hullPoints=[];for(const t of e)this._hullPoints.push(t)}static createHull(e){return new ConvexPolygon2d(ConvexPolygon2d.computeConvexHull(e))}static createHullIsValidCheck(e){return ConvexPolygon2d.isValidConvexHull(e)?new ConvexPolygon2d(e):new ConvexPolygon2d(ConvexPolygon2d.computeConvexHull(e))}get points(){return this._hullPoints}static isValidConvexHull(e){if(e.length<3)return!1;const t=e.length;for(let r=0;r<t;r++){const n=(r+1)%t,i=(r+2)%t;if(e[r].crossProductToPoints(e[n],e[i])<0)return!1}return!0}containsPoint(e){let t=this._hullPoints[this._hullPoints.length-1];for(const r of this._hullPoints){const n=r;if(t.crossProductToPoints(n,e)<0)return!1;t=r}return!0}distanceOutside(e){let t=0;const r=this._hullPoints.length;let n=this._hullPoints[r-1];for(let i=0;i<r;i++){const r=this._hullPoints[i];if(n.crossProductToPoints(r,e)<0){const i=Ray2d.createOriginAndTarget(n,r),o=i.projectionFraction(e);let s=0;(s=o<0?n.distance(e):o>1?r.distance(e):e.distance(i.fractionToPoint(o)))>t&&(t=s)}n=this._hullPoints[i]}return t}offsetInPlace(e){const t=this._hullPoints.length;if(t>=3){const r=this._hullPoints[0];let i=this._hullPoints[t-1].vectorTo(r);if(void 0===(i=i.normalize()))return!1;let o,s,a=i.rotate90CWXY();for(let c=0;c<t;c++){const i=c+1;if(void 0===(o=(o=this._hullPoints[c].vectorTo(i<t?this._hullPoints[i]:r)).normalize()))return!1;s=o.rotate90CWXY();const l=n.Vector2d.createOffsetBisector(a,s,e);if(void 0===l)return!1;this._hullPoints[c]=this._hullPoints[c].plus(l),a=s}}return!0}clipRay(e){let t=-Number.MAX_VALUE,r=Number.MAX_VALUE;const n=this._hullPoints.length;if(n<3)return i.Range1d.createNull();let o=this._hullPoints[n-1];for(const a of this._hullPoints){const n=[],s=[];if(e.intersectUnboundedLine(o,a,n,s)){if(s[0]>0?n[0]<r&&(r=n[0]):n[0]>t&&(t=n[0]),t>r)return i.Range1d.createNull()}else if(o.crossProductToPoints(a,e.origin)<0)return i.Range1d.createNull();o=a}const s=i.Range1d.createNull();return s.extendX(t),s.extendX(r),s}rangeAlongRay(e){const t=i.Range1d.createNull();for(const r of this._hullPoints)t.extendX(e.projectionFraction(r));return t}rangePerpendicularToRay(e){const t=i.Range1d.createNull();for(const r of this._hullPoints)t.extendX(e.perpendicularProjectionFraction(r));return t}static computeConvexHull(e){const t=[],r=e.length;if(r<3)return t;const n=e.slice(0,r);n.sort(o.Geometry.lexicalXYLessThan),t.push(n[0]),t.push(n[1]);for(let o=2;o<r;o++){const e=n[o];let r=t.length-1;for(;r>0&&t[r-1].crossProductToPoints(t[r],e)<=0;)r--,t.pop();t.push(e)}const i=t.length-1;t.push(n[r-2]);for(let o=r-2;o-- >0;){const e=n[o];let r=t.length-1;for(;r>i&&t[r-1].crossProductToPoints(t[r],e)<=0;)r--,t.pop();o>0&&t.push(e)}return t}}t.ConvexPolygon2d=ConvexPolygon2d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(19);class PlaneByOriginAndVectors4d{constructor(e,t,r){this.origin=e,this.vectorU=t,this.vectorV=r}clone(e){return e?(e.setFrom(this),e):new PlaneByOriginAndVectors4d(this.origin.clone(),this.vectorU.clone(),this.vectorV.clone())}setFrom(e){this.origin.setFrom(e.origin),this.vectorU.setFrom(e.vectorU),this.vectorV.setFrom(e.vectorV)}isAlmostEqual(e){return this.origin.isAlmostEqual(e.origin)&&this.vectorU.isAlmostEqual(e.vectorU)&&this.vectorV.isAlmostEqual(e.vectorV)}static createOriginAndVectors(e,t,r,n){return n?(n.setOriginAndVectors(e,t,r),n):new PlaneByOriginAndVectors4d(e.clone(),t.clone(),r.clone())}setOriginAndVectorsXYZW(e,t,r,n,i,o,s,a,c,l,u,d){return this.origin.set(e,t,r,n),this.vectorU.set(i,o,s,a),this.vectorV.set(c,l,u,d),this}setOriginAndVectors(e,t,r){return this.origin.setFrom(e),this.vectorU.setFrom(t),this.vectorV.setFrom(r),this}static createOriginAndVectorsXYZW(e,t,r,i,o,s,a,c,l,u,d,h,p){return p?p.setOriginAndVectorsXYZW(e,t,r,i,o,s,a,c,l,u,d,h):new PlaneByOriginAndVectors4d(n.Point4d.create(e,t,r,i),n.Point4d.create(o,s,a,c),n.Point4d.create(l,u,d,c))}static createOriginAndTargets3d(e,t,r,n){return PlaneByOriginAndVectors4d.createOriginAndVectorsXYZW(e.x,e.y,e.z,1,t.x-e.x,t.y-e.y,t.z-e.z,0,r.x-e.x,r.y-e.y,r.z-e.z,0,n)}fractionToPoint(e,t,r){return this.origin.plus2Scaled(this.vectorU,e,this.vectorV,t,r)}static createXYPlane(e){return PlaneByOriginAndVectors4d.createOriginAndVectorsXYZW(0,0,0,1,1,0,0,0,0,1,0,0,e)}}t.PlaneByOriginAndVectors4d=PlaneByOriginAndVectors4d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9),i=r(10),o=r(99);class Map4d{constructor(e,t){this._matrix0=e,this._matrix1=t}get transform0(){return this._matrix0}get transform1(){return this._matrix1}static createRefs(e,t){return new Map4d(e,t)}static createIdentity(){return new Map4d(o.Matrix4d.createIdentity(),o.Matrix4d.createIdentity())}static createTransform(e,t){if(void 0===t){if(void 0===(t=e.inverse()))return}else{if(!e.multiplyTransformTransform(t).isIdentity)return}return new Map4d(o.Matrix4d.createTransform(e),o.Matrix4d.createTransform(t))}static createBoxMap(e,t,r,n,i){const s=o.Matrix4d.createBoxToBox(e,t,r,n,i?i.transform0:void 0),a=o.Matrix4d.createBoxToBox(r,n,e,t,i?i.transform1:void 0);if(s&&a)return i||new Map4d(s,a)}setFrom(e){this._matrix0.setFrom(e._matrix0),this._matrix1.setFrom(e._matrix1)}clone(){return new Map4d(this._matrix0.clone(),this._matrix1.clone())}setIdentity(){this._matrix0.setIdentity(),this._matrix1.setIdentity()}setFromJSON(e){e.matrix0&&e.matrix1?(this._matrix0.setFromJSON(e.matrix0),this._matrix1.setFromJSON(e.matrix1)):this.setIdentity()}static fromJSON(e){const t=new Map4d(o.Matrix4d.createIdentity(),o.Matrix4d.createIdentity());return t.setFromJSON(e),t}toJSON(){return{matrix0:this._matrix0.toJSON(),matrix1:this._matrix1.toJSON()}}isAlmostEqual(e){return this._matrix0.isAlmostEqual(e._matrix0)&&this._matrix1.isAlmostEqual(e._matrix1)}static createVectorFrustum(e,t,r,s,a){a=Math.max(a,1e-8);const c=n.Transform.createOriginAndMatrix(e,i.Matrix3d.createColumns(t,r,s)),l=c.inverse();if(!l)return;const u=new Map4d(o.Matrix4d.createTransform(l),o.Matrix4d.createTransform(c));return new Map4d(o.Matrix4d.createRowValues(1,0,0,0,0,1,0,0,0,0,a,0,0,0,a-1,1),o.Matrix4d.createRowValues(1,0,0,0,0,1,0,0,0,0,1/a,0,0,0,(1-a)/a,1)).multiplyMapMap(u)}multiplyMapMap(e){return new Map4d(this._matrix0.multiplyMatrixMatrix(e._matrix0),e._matrix1.multiplyMatrixMatrix(this._matrix1))}reverseInPlace(){const e=this._matrix0;this._matrix0=this._matrix1,this._matrix1=e}sandwich0This1(e){return new Map4d(e._matrix0.multiplyMatrixMatrix(this._matrix0.multiplyMatrixMatrix(e._matrix1)),e._matrix0.multiplyMatrixMatrix(this._matrix1.multiplyMatrixMatrix(e._matrix1)))}sandwich1This0(e){return new Map4d(e._matrix1.multiplyMatrixMatrix(this._matrix0.multiplyMatrixMatrix(e._matrix0)),e._matrix1.multiplyMatrixMatrix(this._matrix1.multiplyMatrixMatrix(e._matrix0)))}}t.Map4d=Map4d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(16);class Complex{set x(e){this._myX=e}get x(){return this._myX}set y(e){this._myY=e}get y(){return this._myY}constructor(e=0,t=0){this._myX=e,this._myY=t}set(e=0,t=0){this.x=e,this.y=t}setFrom(e){this.x=e.x,this.y=e.y}clone(){return new Complex(this.x,this.y)}isAlmostEqual(e){return n.Geometry.isAlmostEqualNumber(this.x,e.x)&&n.Geometry.isAlmostEqualNumber(this.x,e.x)}static create(e=0,t=0,r){return r?(r.x=e,r.y=t,r):new Complex(e,t)}plus(e,t){return Complex.create(this.x+e.x,this.y+e.y,t)}minus(e,t){return Complex.create(this.x-e.x,this.y-e.y,t)}times(e,t){return Complex.create(this.x*e.x-this.y*e.y,this.x*e.y+this.y*e.x,t)}timesXY(e,t,r){return Complex.create(this.x*e-this.y*t,this.x*t+this.y*e,r)}magnitude(){return Math.hypot(this.x,this.y)}angle(){return i.Angle.createAtan2(this.y,this.x)}distance(e){return Math.hypot(this.x-e.x,this.y-e.y)}magnitudeSquared(){return this.x*this.x+this.y*this.y}divide(e,t){const r=e.magnitudeSquared();if(0===r)return;const n=1/r;return Complex.create((this.x*e.x+this.y*e.y)*n,(this.y*e.x-this.x*e.y)*n,t)}sqrt(e){if(0===this.x&&0===this.y)return Complex.create(0,0,e);const t=Math.abs(this.x),r=Math.abs(this.y);let n=0,i=0;if(t>=r?(n=r/t,i=Math.sqrt(t)*Math.sqrt(.5*(1+Math.sqrt(1+n*n)))):(n=t/r,i=Math.sqrt(r)*Math.sqrt(.5*(n+Math.sqrt(1+n*n)))),this.x>=0)return Complex.create(i,this.y/(2*i),e);{const t=this.y>=0?i:-i;return Complex.create(this.y/(2*t),t,e)}}setFromJSON(e){Array.isArray(e)&&e.length>1?this.set(e[0],e[1]):e&&e.x&&e.y?this.set(e.x,e.y):this.set(0,0)}static fromJSON(e){const t=new Complex;return t.setFromJSON(e),t}toJSON(){return[this.x,this.y]}}t.Complex=Complex},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(23),i=r(37);class Range1dArray{static advanceIntervalDifference(e,t,r,i){const o=t.length;let s=e.low,a=e.high;for(;r<o;){const e=t[r];if(e.high<s)r++;else{if(!(e.high<=a)){e.low<a&&(a=e.low);break}e.low>s&&i.push(n.Range1d.createXX(s,e.low)),s=e.high,r++}}return s<a&&i.push(n.Range1d.createXX(s,a)),i}static differenceSorted(e,t){const r=e.length,n=[];for(let i=0;i<r;i++)Range1dArray.advanceIntervalDifference(e[i],t,0,n);return n}static advanceIntervalIntersection(e,t,r){return t.low>e.high||(t.high>=e.high?(r.push(n.Range1d.createXX(t.low,e.high)),!0):(r.push(n.Range1d.createXX(t.low,t.high)),!1))}static intersectSorted(e,t){let r=0,n=0;const i=e.length,o=t.length,s=[];for(;r<i&&n<o;){const i=e[r],o=t[n];i.low<=o.low?Range1dArray.advanceIntervalIntersection(i,o,s)?r++:n++:Range1dArray.advanceIntervalIntersection(o,i,s)?n++:r++}return s}static advanceIntervalUnion(e,t,r){if(r>=t.length)return!1;const n=t[r];return!(n.low>e.high)&&(n.high>e.high&&(e.high=n.high),!0)}static unionSorted(e,t){const r=e.length,n=t.length;let i=0,o=0;const s=[];for(;i<r&&o<n;){const r=e[i],n=t[o];let a;r.low<=n.low?(a=r.clone(),i++):(a=n.clone(),o++);let c=!0;do{const r=Range1dArray.advanceIntervalUnion(a,e,i),n=Range1dArray.advanceIntervalUnion(a,t,o);r&&i++,n&&o++,r||n||(c=!1)}while(c);s.push(a)}for(;i<r;)s.push(e[i++]);for(;o<n;)s.push(t[o++]);return s}static paritySorted(e,t){const r=[];for(const n of e)r.push(n.clone());for(const n of t)r.push(n.clone());return r.sort(o),Range1dArray.simplifySortParity(r,!0),r}static sort(e){e.sort(o)}static simplifySortUnion(e,t=!1){if(e.length<2)return;e.sort(o);let r=0,n=!1;for(let i=0;i<e.length;i++){if(i===e.length-1){n&&(t&&e[i].low===e[i].high||(e[r++]=e[i]));break}e[i+1].low>e[i].high?t&&e[i].low===e[i].high||(e[r++]=e[i]):(e[i+1].low=e[i].low,e[i+1].high=Math.max(e[i].high,e[i+1].high),n=!0)}e.length=r}static simplifySortParity(e,t=!1){const r=[];for(const n of e)n.low!==n.high&&(r.push(n.low),r.push(n.high));const i=r.length;r.sort((e,t)=>e<t?-1:e>t?1:0);let o,s,a=0;for(let c=0;c<i;c+=2)if(o=r[c],s=r[c+1],t){for(;c+2<i&&r[c+2]===s;)s=r[(c+=2)+1];s>o&&n.Range1d.createXX(o,s,e[a++])}else n.Range1d.createXX(o,s,e[a++]);e.length=a}static testUnion(e,t){for(const r of e)if(r.containsX(t))return!0;return!1}static testParity(e,t){let r=!1;for(const n of e)n.containsX(t)&&(r=!r);return r}static getBreaks(e,t){t||(t=new i.GrowableFloat64Array(2*e.length));for(const r of e)t.push(r.low),t.push(r.high);return t}static sumLengths(e){let t=0;for(const r of e)t+=r.length();return t}static isSorted(e,t=!0){const r=e.length;if(t){for(let n=0;n+1<r;n++)if(e[n].high>=e[n+1].low)return!1}else for(let n=0;n+1<r;n++)if(e[n].high>e[n+1].low)return!1;return!0}}function o(e,t){return e.low<t.low?-1:e.low>t.low?1:e.high<t.high?-1:e.high>t.high?1:0}t.Range1dArray=Range1dArray},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(6);var o;!function(e){e[e.RawMatrix=0]="RawMatrix",e[e.FactorOK=1]="FactorOK",e[e.FactorFailed=2]="FactorFailed"}(o||(o={}));class TriDiagonalSystem{constructor(e){this._aLeft=new Float64Array(e),this._aDiag=new Float64Array(e),this._aRight=new Float64Array(e),this._b=new Float64Array(e),this._x=new Float64Array(e),this.Reset()}Reset(){this._dataState=o.RawMatrix;const e=this._aDiag.length;for(let t=0;t<e;t++)this._aLeft[t]=this._aRight[t]=this._aDiag[t]=this._b[t]=this._x[t]=0}SetRow(e,t,r,n){this._aLeft[e]=t,this._aDiag[e]=r,this._aRight[e]=n}AddToRow(e,t,r,n){this._aLeft[e]+=t,this._aDiag[e]+=r,this._aRight[e]+=n}SetB(e,t){this._b[e]=t}AddToB(e,t){this._b[e]+=t}GetB(e){return this._b[e]}SetX(e,t){this._x[e]=t}GetX(e){return this._x[e]}Order(){return this._aDiag.length}MultiplyAX(){if(this._dataState===o.FactorFailed)return!1;if(this._dataState===o.FactorOK){const e=this._aDiag.length-1;for(let t=0;t<e;t++)this._b[t]=this._aDiag[t]*this._x[t]+this._aRight[t]*this._x[t+1];this._b[e]=this._aDiag[e]*this._x[e];for(let t=e;t>0;t--)this._b[t]+=this._aLeft[t]*this._b[t-1];return!0}{const e=this._aDiag.length,t=e-1;let r;for(this._b[0]=this._aDiag[0]*this._x[0]+this._aRight[0]*this._x[1],r=1;r<t;r++)this._b[r]=this._aLeft[r]*this._x[r-1]+this._aDiag[r]*this._x[r]+this._aRight[r]*this._x[r+1];return this._b[t]=this._aLeft[t]*this._x[e-2]+this._aDiag[r]*this._x[t],!0}}MultiplyAXPoints(e,t){for(t.length=0;t.length<e.length;)t.push(i.Point3d.create());if(t.length=e.length,this._dataState===o.FactorFailed)return!1;if(this._dataState===o.FactorOK){const r=this._aDiag.length-1;for(let n=0;n<r;n++)i.Point3d.createAdd2Scaled(e[n],this._aDiag[n],e[n+1],this._aRight[n],t[n]);i.Point3d.createScale(e[r],this._aDiag[r],t[r]);for(let e=r;e>0;e--)t[e].plusScaled(t[e-1],this._aLeft[e],t[e]);return!0}{const r=this._aDiag.length,n=r-1;let o;for(i.Point3d.createAdd2Scaled(e[0],this._aDiag[0],e[1],this._aRight[0],t[0]),o=1;o<n;o++)i.Point3d.createAdd3Scaled(e[o-1],this._aLeft[o],e[o],this._aDiag[o],e[o+1],this._aRight[o],t[o]);return i.Point3d.createAdd2Scaled(e[r-2],this._aLeft[n],e[n],this._aDiag[n],t[n]),!0}}Defactor(){if(this._dataState===o.RawMatrix)return!0;if(this._dataState===o.FactorFailed)return!1;for(let e=this._aDiag.length-1;e>0;e--)this._aDiag[e]+=this._aLeft[e]*this._aRight[e-1],this._aLeft[e]*=this._aDiag[e-1];return this._dataState=o.RawMatrix,!0}Factor(){if(this._dataState===o.FactorOK)return!0;if(this._dataState!==o.RawMatrix)return!1;this._dataState=o.FactorFailed;const e=this._aDiag.length-1;for(let t=0;t<e;t++){const e=n.Geometry.conditionalDivideFraction(this._aLeft[t+1],this._aDiag[t]);if(!e)return!1;this._aLeft[t+1]=e,this._aDiag[t+1]-=e*this._aRight[t]}return this._dataState=o.FactorOK,!0}FactorAndBackSubstitute(){const e=this._aDiag.length,t=e-1;if(!this.Factor())return!1;for(let r=0;r<e;r++)this._x[r]=this._b[r];for(let r=1;r<e;r++)this._x[r]-=this._aLeft[r]*this._x[r-1];this._x[t]/=this._aDiag[t];for(let r=t-1;r>=0;r--)this._x[r]=(this._x[r]-this._aRight[r]*this._x[r+1])/this._aDiag[r];return!0}FactorAndBackSubstitutePointArrays(e,t){const r=this._aDiag.length;if(e.length<r)return!1;for(;t.length<r;)t.push(i.Point3d.create(0,0,0));t.length=r;const n=r-1;if(!this.Factor())return!1;if(e!==t)for(let i=0;i<r;i++)t[i].setFrom(e[i]);let o,s;for(let i=1;i<r;i++)o=this._aLeft[i],t[i].x-=o*t[i-1].x,t[i].y-=o*t[i-1].y,t[i].z-=o*t[i-1].z;s=1/this._aDiag[n],t[n].x*=s,t[n].y*=s,t[n].z*=s;for(let i=n-1;i>=0;i--)o=this._aRight[i],s=1/this._aDiag[i],t[i].x=(t[i].x-o*t[i+1].x)*s,t[i].y=(t[i].y-o*t[i+1].y)*s,t[i].z=(t[i].z-o*t[i+1].z)*s;return!0}Copy(){const e=this._aDiag.length,t=new TriDiagonalSystem(e);for(let r=0;r<e;r++)t._aLeft[r]=this._aLeft[r],t._aDiag[r]=this._aDiag[r],t._aRight[r]=this._aRight[r],t._x[r]=this._x[r],t._b[r]=this._b[r];return t._dataState=this._dataState,t}flatten(){const e=this._aDiag.length,t=[];for(let r=0;r<e;r++)t.push([r,[this._aLeft[r],this._aDiag[r],this._aRight[r]],this._x[r],this._b[r]]);return t}flattenWithPoints(e){const t=this._aDiag.length,r=[];for(let n=0;n<t;n++)r.push([n,[this._aLeft[n],this._aDiag[n],this._aRight[n]],this._x[n],e[n].toJSON()]);return r}}t.TriDiagonalSystem=TriDiagonalSystem},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(101),i=r(49),o=r(49),s=r(5),a=r(51),c=r(14),l=r(13),u=r(6),d=r(83),h=r(19),p=r(10),f=r(60),g=r(37),m=r(100),y=r(59),v=r(166),_=r(21);class BezierBezierIntersectionXYRRToRRD extends v.NewtonEvaluatorRRtoRRD{constructor(e,t){super(),this._curveA=e,this._curveB=t,this._rayA=_.Ray3d.createZero(),this._rayB=_.Ray3d.createZero()}evaluate(e,t){return this._curveA.fractionToPointAndDerivative(e,this._rayA),this._curveB.fractionToPointAndDerivative(t,this._rayB),this.currentF.setOriginAndVectorsXYZ(this._rayB.origin.x-this._rayA.origin.x,this._rayB.origin.y-this._rayA.origin.y,0,-this._rayA.direction.x,-this._rayA.direction.y,0,this._rayB.direction.x,this._rayB.direction.y,0),!0}}class CurveLocationDetailArrayPair{constructor(){this.dataA=[],this.dataB=[]}}t.CurveLocationDetailArrayPair=CurveLocationDetailArrayPair;class CurveCurveIntersectXY extends n.NullGeometryHandler{constructor(e,t,r,n,i){super(),this._extendA=r,this._geometryB=n,this._extendB=i,this._worldToLocalPerspective=void 0,this._worldToLocalAffine=void 0,void 0===e||e.isIdentity()||(this._worldToLocalAffine=e.asTransform,this._worldToLocalAffine||(this._worldToLocalPerspective=e.clone())),this.reinitialize()}reinitialize(){this._results=new CurveLocationDetailArrayPair}grabResults(e=!1){const t=this._results;return e&&this.reinitialize(),t}acceptFraction(e,t,r){return!(!e&&t<0)&&!(!r&&t>1)}recordPointWithLocalFractions(e,t,r,n,a,c,l,u,d){const h=s.Geometry.interpolate(r,e,n),p=s.Geometry.interpolate(l,a,u),f=this._results.dataA.length;if(f>0){const e=this._results.dataA[f-1].fraction,t=this._results.dataB[f-1].fraction;if(d){if(s.Geometry.isAlmostEqualNumber(e,p)&&s.Geometry.isAlmostEqualNumber(t,h))return}else if(s.Geometry.isAlmostEqualNumber(e,h)&&s.Geometry.isAlmostEqualNumber(t,p))return}const g=i.CurveLocationDetail.createCurveFractionPoint(t,h,t.fractionToPoint(h));g.setIntervalRole(o.CurveIntervalRole.isolated);const m=i.CurveLocationDetail.createCurveFractionPoint(c,p,c.fractionToPoint(p));m.setIntervalRole(o.CurveIntervalRole.isolated),d?(this._results.dataA.push(m),this._results.dataB.push(g)):(this._results.dataA.push(g),this._results.dataB.push(m))}computeSegmentSegment3D(e,t,r,n,i,o,s,a,c,l,u,h,p,f,g){const m=CurveCurveIntersectXY._workVector2dA;d.SmallSystem.lineSegment3dXYTransverseIntersectionUnbounded(r,i,l,h,m)&&this.acceptFraction(t,m.x,s)&&this.acceptFraction(c,m.y,f)&&this.recordPointWithLocalFractions(m.x,e,n,o,m.y,a,u,p,g)}computeSegmentSegment3DH(e,t,r,n,i,o,s,a,c,l,u,h,p,f,g){const m=CurveCurveIntersectXY._workPointA0H,y=CurveCurveIntersectXY._workPointA1H,v=CurveCurveIntersectXY._workPointB0H,_=CurveCurveIntersectXY._workPointB1H;this._worldToLocalPerspective.multiplyPoint3d(r,1,m),this._worldToLocalPerspective.multiplyPoint3d(i,1,y),this._worldToLocalPerspective.multiplyPoint3d(l,1,v),this._worldToLocalPerspective.multiplyPoint3d(h,1,_);const w=d.SmallSystem.lineSegment3dHXYTransverseIntersectionUnbounded(m,y,v,_);if(void 0!==w){const r=w.x,i=w.y;this.acceptFraction(t,r,s)&&this.acceptFraction(c,i,f)&&this.recordPointWithLocalFractions(r,e,n,o,i,a,u,p,g)}}dispatchSegmentSegment(e,t,r,n,i,o,s,a,c,l,u,d,h,p,f){this._worldToLocalAffine?(CurveCurveIntersectXY.setTransformedWorkPoints(this._worldToLocalAffine,r,i,l,d),this.computeSegmentSegment3D(e,t,CurveCurveIntersectXY._workPointA0,n,CurveCurveIntersectXY._workPointA1,o,s,a,c,CurveCurveIntersectXY._workPointB0,u,CurveCurveIntersectXY._workPointB1,h,p,f)):this._worldToLocalPerspective?this.computeSegmentSegment3DH(e,t,r,n,i,o,s,a,c,l,u,d,h,p,f):this.computeSegmentSegment3D(e,t,r,n,i,o,s,a,c,l,u,d,h,p,f)}dispatchSegmentArc(e,t,r,n,i,o,a,c,l,u,h){if(this._worldToLocalPerspective){const p=c.toTransformedPoint4d(this._worldToLocalPerspective),f=this._worldToLocalPerspective.multiplyPoint3d(r,1),m=this._worldToLocalPerspective.multiplyPoint3d(i,1),y=s.Geometry.tripleProductPoint4dXYW(f,m,p.center),v=s.Geometry.tripleProductPoint4dXYW(f,m,p.vector0),_=s.Geometry.tripleProductPoint4dXYW(f,m,p.vector90),w=new g.GrowableFloat64Array(2),S=new g.GrowableFloat64Array(2),b=new g.GrowableFloat64Array(2),x=d.AnalyticRoots.appendImplicitLineUnitCircleIntersections(y,v,_,w,S,b);for(let r=0;r<x;r++){const i=p.center.plus2Scaled(p.vector0,w.at(r),p.vector90,S.at(r)),s=p.sweep.radiansToSignedPeriodicFraction(b.at(r)),g=d.SmallSystem.lineSegment3dHXYClosestPointUnbounded(f,m,i);void 0!==g&&this.acceptFraction(t,g,a)&&this.acceptFraction(l,s,u)&&this.recordPointWithLocalFractions(g,e,n,o,s,c,0,1,h)}}else{const p=c.toTransformedVectors(this._worldToLocalAffine);let f=r,m=i;this._worldToLocalAffine&&(f=this._worldToLocalAffine.multiplyPoint3d(r),m=this._worldToLocalAffine.multiplyPoint3d(i));const y=s.Geometry.tripleProductXYW(f,1,m,1,p.center,1),v=s.Geometry.tripleProductXYW(f,1,m,1,p.vector0,0),_=s.Geometry.tripleProductXYW(f,1,m,1,p.vector90,0),w=new g.GrowableFloat64Array(2),S=new g.GrowableFloat64Array(2),b=new g.GrowableFloat64Array(2),x=d.AnalyticRoots.appendImplicitLineUnitCircleIntersections(y,v,_,w,S,b);for(let r=0;r<x;r++){const i=p.center.plus2Scaled(p.vector0,w.at(r),p.vector90,S.at(r)),s=p.sweep.radiansToSignedPeriodicFraction(b.at(r)),g=d.SmallSystem.lineSegment3dXYClosestPointUnbounded(f,m,i);void 0!==g&&this.acceptFraction(t,g,a)&&this.acceptFraction(l,s,u)&&this.recordPointWithLocalFractions(g,e,n,o,s,c,0,1,h)}}}dispatchArcArc_thisOrder(e,t,r,n,i,o,s){const a=t.inverse();if(a){const t=a.multiplyMatrixMatrix(i),c=[],l=[];d.TrigPolynomial.SolveUnitCircleHomogeneousEllipseIntersection(t.coffs[2],t.coffs[5],t.coffs[8],t.coffs[0],t.coffs[3],t.coffs[6],t.coffs[1],t.coffs[4],t.coffs[7],c,l);for(let i=0;i<c.length;i++){const t=e.sweep.radiansToSignedPeriodicFraction(l[i]),a=e.sweep.radiansToSignedPeriodicFraction(c[i]);this.acceptFraction(r,t,r)&&this.acceptFraction(o,a,o)&&this.recordPointWithLocalFractions(t,e,0,1,a,n,0,1,s)}}}dispatchArcArc(e,t,r,n,i){let o,s;if(this._worldToLocalPerspective){const t=e.toTransformedPoint4d(this._worldToLocalPerspective),n=r.toTransformedPoint4d(this._worldToLocalPerspective);o=p.Matrix3d.createColumnsXYW(t.vector0,t.vector0.w,t.vector90,t.vector90.w,t.center,t.center.w),s=p.Matrix3d.createColumnsXYW(n.vector0,n.vector0.w,n.vector90,t.vector90.w,n.center,n.center.w)}else{const t=e.toTransformedVectors(this._worldToLocalAffine),n=r.toTransformedVectors(this._worldToLocalAffine);o=p.Matrix3d.createColumnsXYW(t.vector0,0,t.vector90,0,t.center,1),s=p.Matrix3d.createColumnsXYW(n.vector0,0,n.vector90,0,n.center,1)}o.conditionNumber()>s.conditionNumber()?this.dispatchArcArc_thisOrder(e,o,t,r,s,n,i):this.dispatchArcArc_thisOrder(r,s,n,e,o,t,!i)}dispatchArcBsplineCurve3d(e,t,r,n,i){let o;if(this._worldToLocalPerspective){const t=e.toTransformedPoint4d(this._worldToLocalPerspective);o=p.Matrix3d.createColumnsXYW(t.vector0,t.vector0.w,t.vector90,t.vector90.w,t.center,t.center.w)}else{const t=e.toTransformedVectors(this._worldToLocalAffine);o=p.Matrix3d.createColumnsXYW(t.vector0,0,t.vector90,0,t.center,1)}const s=o.inverse();if(s){const o=r.order,a=2*o-1,c=new Float64Array(o),l=new y.UnivariateBezier(a),u=s.at(0,0),d=s.at(0,1),h=0,p=s.at(0,2),f=s.at(1,0),g=s.at(1,1),m=0,v=s.at(1,2),_=s.at(2,0),w=s.at(2,1),S=0,b=s.at(2,2);if(s){let o;for(let s=0;o=r.getSaturatedBezierSpan3dH(s,o);s++){this._worldToLocalPerspective?o.tryMultiplyMatrix4dInPlace(this._worldToLocalPerspective):this._worldToLocalAffine&&o.tryTransformInPlace(this._worldToLocalAffine),l.zero(),o.poleProductsXYZW(c,u,d,h,p),l.addSquaredSquaredBezier(c,1),o.poleProductsXYZW(c,f,g,m,v),l.addSquaredSquaredBezier(c,1),o.poleProductsXYZW(c,_,w,S,b),l.addSquaredSquaredBezier(c,-1);const s=l.roots(0,!0);if(s)for(const a of s){const s=o.fractionToParentFraction(a),c=o.fractionToPoint4d(a),l=c.dotProductXYZW(u,d,h,p),y=c.dotProductXYZW(f,g,m,v),_=e.sweep.radiansToSignedPeriodicFraction(Math.atan2(y,l));this.acceptFraction(t,_,t)&&this.acceptFraction(n,s,n)&&this.recordPointWithLocalFractions(_,e,0,1,s,r,0,1,i)}}}}}transformBeziers(e){if(this._worldToLocalAffine)for(const t of e)t.tryTransformInPlace(this._worldToLocalAffine);else if(this._worldToLocalPerspective)for(const t of e)t.tryMultiplyMatrix4dInPlace(this._worldToLocalPerspective)}getRanges(e){const t=[];t.length=0;for(const r of e)t.push(r.range());return t}dispatchBezierBezierStrokeFirst(e,t,r,n,i,o,a,c){this._xyzwA0||(this._xyzwA0=h.Point4d.create()),this._xyzwA1||(this._xyzwA1=h.Point4d.create()),this._xyzwPlane||(this._xyzwPlane=h.Point4d.create()),this._xyzwB||(this._xyzwB=h.Point4d.create()),e.fractionToPoint4d(0,this._xyzwA0);let l=0,u=1;const p=1/r;for(let f=1;f<=r;f++,l=u,this._xyzwA0.setFrom(this._xyzwA1)){u=f*p,e.fractionToPoint4d(u,this._xyzwA1),h.Point4d.createPlanePointPointZ(this._xyzwA0,this._xyzwA1,this._xyzwPlane),n.poleProductsXYZW(a.coffs,this._xyzwPlane.x,this._xyzwPlane.y,this._xyzwPlane.z,this._xyzwPlane.w);let r=0;const o=a.roots(0,!0);if(o)for(const a of o){let o=a;n.fractionToPoint4d(o,this._xyzwB);const h=d.SmallSystem.lineSegment3dHXYClosestPointUnbounded(this._xyzwA0,this._xyzwA1,this._xyzwB);if(h&&s.Geometry.isIn01WithTolerance(h,1e-5)){let a=s.Geometry.interpolate(l,h,u);const d=new BezierBezierIntersectionXYRRToRRD(e,n),p=new v.Newton2dUnboundedWithDerivative(d);p.setUV(a,o),p.runIterations()&&(a=p.getU(),o=p.getV());const f=e.fractionToParentFraction(a),g=n.fractionToParentFraction(o),m=e.fractionToPoint(a),y=t.fractionToPoint(f),_=n.fractionToPoint(o),w=i.fractionToPoint(g);m.isAlmostEqualXY(y)||r++,_.isAlmostEqualXY(w)||r++,r>0&&!m.isAlmostEqual(_)&&r++,r>0&&!y.isAlmostEqual(w)&&r++,this.acceptFraction(!1,f,!1)&&this.acceptFraction(!1,g,!1)&&this.recordPointWithLocalFractions(f,t,0,1,g,i,0,1,c)}}}}dispatchBSplineCurve3dBSplineCurve3d(e,t,r){const n=e.collectBezierSpans(!0),i=t.collectBezierSpans(!0),o=n.length,s=i.length;this.transformBeziers(n),this.transformBeziers(i);const a=this.getRanges(n),c=this.getRanges(i),l=e.order,u=t.order,d=new y.UnivariateBezier(l),h=new y.UnivariateBezier(u);for(let p=0;p<o;p++)for(let o=0;o<s;o++)if(a[p].intersectsRangeXY(c[o])){const s=n[p].strokeCount(),a=i[o].strokeCount();s<a?this.dispatchBezierBezierStrokeFirst(n[p],e,s,i[o],t,a,h,!r):this.dispatchBezierBezierStrokeFirst(i[o],t,a,n[p],e,s,d,r)}}projectPoint(e,t=1){return this._worldToLocalPerspective?this._worldToLocalPerspective.multiplyPoint3d(e,t):this._worldToLocalAffine?this._worldToLocalAffine.multiplyXYZW(e.x,e.y,e.z,t):h.Point4d.createFromPointAndWeight(e,t)}mapNPCPlaneToWorld(e,t){this._worldToLocalAffine?this._worldToLocalAffine.multiplyTransposeXYZW(e.x,e.y,e.z,e.w,t):this._worldToLocalPerspective?this._worldToLocalPerspective.multiplyTransposePoint4d(e,t):e.clone(t)}dispatchSegmentBsplineCurve(e,t,r,n,i,o,s,a,c,l){const u=this.projectPoint(r),p=this.projectPoint(i),f=h.Point4d.createPlanePointPointZ(u,p);this.mapNPCPlaneToWorld(f,f);const g=[];a.appendPlaneIntersectionPoints(f,g);for(const h of g){const r=h.fraction,i=h.point,f=this.projectPoint(i),g=d.SmallSystem.lineSegment3dHXYClosestPointUnbounded(u,p,f);void 0!==g&&this.acceptFraction(t,g,s)&&this.acceptFraction(c,r,c)&&this.recordPointWithLocalFractions(g,e,n,o,r,a,0,1,l)}}dispatchLineStringBSplineCurve(e,t,r,n,i){const o=e.numPoints();if(o>1){const s=1/(o-1);let a,c;a=0;const l=CurveCurveIntersectXY._workPointA0,u=CurveCurveIntersectXY._workPointA1;e.pointAt(0,l);for(let d=1;d<o;d++,l.setFrom(u),a=c)e.pointAt(d,u),c=d*s,this.dispatchSegmentBsplineCurve(e,1===d&&t,l,a,u,c,d+1===o&&t,r,n,i)}}computeSegmentLineString(e,t,r,n,i){const o=e.point0Ref,s=e.point1Ref,a=CurveCurveIntersectXY._workPointBB0,c=CurveCurveIntersectXY._workPointBB1,l=r.numPoints();if(l>1){const u=1/(l-1);let d,h;d=0,r.pointAt(0,a);for(let p=1;p<l;p++,a.setFrom(c),d=h)r.pointAt(p,c),h=p*u,this.dispatchSegmentSegment(e,t,o,0,s,1,t,r,1===p&&n,a,d,c,h,p+1===l&&n,i)}}computeArcLineString(e,t,r,n,i){const o=CurveCurveIntersectXY._workPointBB0,s=CurveCurveIntersectXY._workPointBB1,a=r.numPoints();if(a>1){const c=1/(a-1);let l,u;l=0,r.pointAt(0,o);for(let d=1;d<a;d++,o.setFrom(s),l=u)r.pointAt(d,s),u=d*c,this.dispatchSegmentArc(r,1===d&&n,o,l,s,u,d+1===a&&n,e,t,t,!i)}}static setTransformedWorkPoints(e,t,r,n,i){e.multiplyPoint3d(t,this._workPointA0),e.multiplyPoint3d(r,this._workPointA1),e.multiplyPoint3d(n,this._workPointB0),e.multiplyPoint3d(i,this._workPointB1)}handleLineSegment3d(e){if(this._geometryB instanceof a.LineSegment3d){const t=this._geometryB;this.dispatchSegmentSegment(e,this._extendA,e.point0Ref,0,e.point1Ref,1,this._extendA,t,this._extendB,t.point0Ref,0,t.point1Ref,1,this._extendB,!1)}else this._geometryB instanceof c.LineString3d?this.computeSegmentLineString(e,this._extendA,this._geometryB,this._extendB,!1):this._geometryB instanceof f.Arc3d?this.dispatchSegmentArc(e,this._extendA,e.point0Ref,0,e.point1Ref,1,this._extendA,this._geometryB,this._extendB,this._extendB,!1):this._geometryB instanceof m.BSplineCurve3d&&this.dispatchSegmentBsplineCurve(e,this._extendA,e.point0Ref,0,e.point1Ref,1,this._extendA,this._geometryB,this._extendB,!1)}handleLineString3d(e){if(this._geometryB instanceof c.LineString3d){const t=this._geometryB,r=CurveCurveIntersectXY._workPointAA0,n=CurveCurveIntersectXY._workPointAA1,i=CurveCurveIntersectXY._workPointBB0,o=CurveCurveIntersectXY._workPointBB1,s=e.numPoints(),a=t.numPoints();if(s>1&&a>1){e.pointAt(0,r);const c=1/(s-1),l=1/(a-1);let u,d,h,p=0;const f=this._extendA,g=this._extendB;e.pointAt(0,r);for(let m=1;m<s;m++,r.setFrom(n),p=d){d=m*c,u=0,e.pointAt(m,n),t.pointAt(0,i);for(let c=1;c<a;c++,i.setFrom(o),u=h)t.pointAt(c,o),h=c*l,this.dispatchSegmentSegment(e,1===m&&f,r,p,n,d,m+1===s&&f,t,1===c&&g,i,u,o,h,c+1===a&&g,!1)}}}else this._geometryB instanceof a.LineSegment3d?this.computeSegmentLineString(this._geometryB,this._extendB,e,this._extendA,!0):this._geometryB instanceof f.Arc3d?this.computeArcLineString(this._geometryB,this._extendB,e,this._extendA,!0):this._geometryB instanceof m.BSplineCurve3d&&this.dispatchLineStringBSplineCurve(e,this._extendA,this._geometryB,this._extendB,!1)}handleArc3d(e){this._geometryB instanceof a.LineSegment3d?this.dispatchSegmentArc(this._geometryB,this._extendB,this._geometryB.point0Ref,0,this._geometryB.point1Ref,1,this._extendB,e,this._extendA,this._extendA,!0):this._geometryB instanceof c.LineString3d?this.computeArcLineString(e,this._extendA,this._geometryB,this._extendB,!1):this._geometryB instanceof f.Arc3d?this.dispatchArcArc(e,this._extendA,this._geometryB,this._extendB,!1):this._geometryB instanceof m.BSplineCurve3d&&this.dispatchArcBsplineCurve3d(e,this._extendA,this._geometryB,this._extendB,!1)}handleBSplineCurve3d(e){this._geometryB instanceof a.LineSegment3d?this.dispatchSegmentBsplineCurve(this._geometryB,this._extendB,this._geometryB.point0Ref,0,this._geometryB.point1Ref,1,this._extendB,e,this._extendA,!0):this._geometryB instanceof c.LineString3d?this.dispatchLineStringBSplineCurve(this._geometryB,this._extendB,e,this._extendA,!0):this._geometryB instanceof f.Arc3d?this.dispatchArcBsplineCurve3d(this._geometryB,this._extendB,e,this._extendA,!0):this._geometryB instanceof m.BSplineCurve3dBase&&this.dispatchBSplineCurve3dBSplineCurve3d(e,this._geometryB,!1)}handleBSplineCurve3dH(e){}}CurveCurveIntersectXY._workVector2dA=l.Vector2d.create(),CurveCurveIntersectXY._workPointA0H=h.Point4d.create(),CurveCurveIntersectXY._workPointA1H=h.Point4d.create(),CurveCurveIntersectXY._workPointB0H=h.Point4d.create(),CurveCurveIntersectXY._workPointB1H=h.Point4d.create(),CurveCurveIntersectXY._workPointAA0=u.Point3d.create(),CurveCurveIntersectXY._workPointAA1=u.Point3d.create(),CurveCurveIntersectXY._workPointBB0=u.Point3d.create(),CurveCurveIntersectXY._workPointBB1=u.Point3d.create(),CurveCurveIntersectXY._workPointA0=u.Point3d.create(),CurveCurveIntersectXY._workPointA1=u.Point3d.create(),CurveCurveIntersectXY._workPointB0=u.Point3d.create(),CurveCurveIntersectXY._workPointB1=u.Point3d.create();t.CurveCurve=class CurveCurve{static IntersectionXY(e,t,r,n){const i=new CurveCurveIntersectXY(void 0,e,t,r,n);return e.dispatchToGeometryHandler(i),i.grabResults()}static IntersectionProjectedXY(e,t,r,n,i){const o=new CurveCurveIntersectXY(e,t,r,n,i);return t.dispatchToGeometryHandler(o),o.grabResults()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(13),o=r(6),s=r(37);class ClusterableArray extends s.GrowableBlockedArray{constructor(e,t,r){super(1+e+t,r),this._numExtraDataPerPoint=t,this._numCoordinatePerPoint=e}static sortVectorComponent(e){let t=1;for(let r=1;r<e;r++)t*=ClusterableArray._vectorFactor;return t}addBlock(e){const t=this.newBlockIndex()+1,r=Math.min(this.numPerBlock-1,e.length);for(let n=0;n<r;n++)this._data[t+n]=e[n]}addDirect(e,t,r,n,i){const o=this.newBlockIndex();this._data[o+1]=e,this._data[o+2]=t,void 0!==r&&(this._data[o+3]=r),void 0!==n&&(this._data[o+4]=n),void 0!==i&&(this._data[o+5]=i)}addPoint2d(e,t,r,n){const i=this.newBlockIndex();this._data[i+1]=e.x,this._data[i+2]=e.y,void 0!==t&&(this._data[i+3]=t),void 0!==r&&(this._data[i+4]=r),void 0!==n&&(this._data[i+5]=n)}addPoint3d(e,t,r,n){const i=this.newBlockIndex();this._data[i+1]=e.x,this._data[i+2]=e.y,this._data[i+3]=e.z,void 0!==t&&(this._data[i+4]=t),void 0!==r&&(this._data[i+5]=r),void 0!==n&&(this._data[i+6]=n)}getPoint2d(e,t){const r=this.blockIndexToDoubleIndex(e);return i.Point2d.create(this._data[r+1],this._data[r+2],t)}getPoint3d(e,t){const r=this.blockIndexToDoubleIndex(e);return o.Point3d.create(this._data[r+1],this._data[r+2],this._data[r+3],t)}getExtraData(e,t){const r=this.blockIndexToDoubleIndex(e);return this._data[r+1+this._numCoordinatePerPoint+t]}getData(e,t){const r=this.blockIndexToDoubleIndex(e);return this._data[r+t]}setExtraData(e,t,r){const n=this.blockIndexToDoubleIndex(e);this._data[n+1+this._numCoordinatePerPoint+t]=r}static isClusterTerminator(e){return e===ClusterableArray.clusterTerminator}clusterIndicesLexical(e=n.Geometry.smallMetricDistance){this.setupPrimaryClusterSort();const t=this.sortIndicesLexical(),r=new Uint32Array(2*t.length);let i=0;const o=this.numBlocks;let s=0,a=0,c=0,l=0,u=0;const d=1+this._numCoordinatePerPoint;for(l=0;l<o;l++)if(s=t[l],!ClusterableArray.isClusterTerminator(s)){for(r[i++]=s,c=this.component(s,0)+e,t[l]=ClusterableArray.clusterTerminator,u=l+1;u<o;u++)if((a=t[u])!==ClusterableArray.clusterTerminator){if(this.component(a,0)>=c)break;this.distanceBetweenSubBlocks(s,a,1,d)<e&&(r[i++]=a,t[u]=ClusterableArray.clusterTerminator)}r[i++]=ClusterableArray.clusterTerminator}return r.slice(0,i)}setupPrimaryClusterSort(){const e=this.numBlocks,t=this._numCoordinatePerPoint,r=new Float64Array(t);r[0]=1;for(let s=1;s<t;s++)r[s]=r[s-1]*ClusterableArray._vectorFactor;let n=0,i=0;const o=this._data;for(let s=0;s<e;s++){n=this.blockIndexToDoubleIndex(s),i=0;for(let e=0;e<t;e++)i+=r[e]*o[n+1+e];o[n]=i}}ToJSON(){const e=[];for(let t=0;t<this.numBlocks;t++){let r=this.blockIndexToDoubleIndex(t);const n=[t,this._data[r++]],i=[];for(let e=0;e<this._numCoordinatePerPoint;e++)i.push(this._data[r++]);n.push(i);for(let e=0;e<this._numExtraDataPerPoint;e++)n.push(this._data[r++]);e.push(n)}return e}createIndex_blockToClusterIndex(e){const t=this.numBlocks,r=new Uint32Array(t);r.fill(ClusterableArray.clusterTerminator);let n=0;for(const i of e)i>=t?n++:r[i]=n;return r}createIndex_blockToClusterStart(e){const t=e.length,r=this.numBlocks,n=new Uint32Array(r),i=ClusterableArray.clusterTerminator;n.fill(i);let o=0;for(let s=0;s<t;s++){const t=e[s];t>r?o=s+1:n[t]=o}return n}countClusters(e){let t=0;const r=ClusterableArray.clusterTerminator;for(const n of e)n===r&&t++;return t}createIndex_clusterToClusterStart(e){let t=this.countClusters(e);const r=new Uint32Array(t),n=ClusterableArray.clusterTerminator;r.fill(n);const i=e.length;let o=0;for(let s=0;s<i;s++){e[s]===n?o=s+1:s===o&&(r[t++]=o)}return r}sortSubsetsBySingleKey(e,t){const r=1+t;let n,i,o,s=0;const a=e.length;for(let c=0;c<a;c++)if(e[c]===ClusterableArray.clusterTerminator){for(let t=s;t+1<c;t++){i=this.getWithinBlock(e[t],r);for(let s=t+1;s<c;s++)(o=this.getWithinBlock(e[s],r))<i&&(n=e[t],e[t]=e[s],e[s]=n,i=o)}s=c+1}}static clusterPoint3dArray(e,t=n.Geometry.smallMetricDistance){const r=new ClusterableArray(3,0,e.length);e.forEach(e=>{r.addDirect(e.x,e.y,e.z)});const i=r.clusterIndicesLexical(t),o=new PackedPointsWithIndex(e.length);let s=0,a=0;return i.forEach(t=>{ClusterableArray.isClusterTerminator(t)?(s++,a=0):(0===a&&o.packedPoints.push(e[t].clone()),o.oldToNew[t]=s,a++)}),o}static clusterGrowablePoint3dArray(e,t=n.Geometry.smallMetricDistance){const r=new ClusterableArray(3,0,e.length),i=o.Point3d.create(),a=e.length;for(let n=0;n<a;n++)e.getPoint3dAt(n,i),r.addDirect(i.x,i.y,i.z);const c=r.clusterIndicesLexical(t),l=new PackedPointsWithIndex(e.length),u=r.countClusters(c);l.growablePackedPoints=new s.GrowableXYZArray(u);let d=0,h=0;return c.forEach(t=>{ClusterableArray.isClusterTerminator(t)?(d++,h=0):(0===h&&l.growablePackedPoints.pushFromGrowableXYZArray(e,t),l.oldToNew[t]=d,h++)}),l}}ClusterableArray._vectorFactor=.8732,ClusterableArray.clusterTerminator=4294967295,t.ClusterableArray=ClusterableArray;class PackedPointsWithIndex{constructor(e){this.packedPoints=[],this.oldToNew=new Uint32Array(e);for(let t=0;t<e;t++)this.oldToNew[t]=PackedPointsWithIndex.invalidIndex}updateIndices(e){let t=0;return e.forEach((e,r,n)=>{e<this.oldToNew.length?n[r]=this.oldToNew[e]:t++}),0===t}}PackedPointsWithIndex.invalidIndex=4294967295,t.PackedPointsWithIndex=PackedPointsWithIndex},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(130),o=r(99),s=r(33),a=r(39),c=r(14),l=r(24),u=r(262);class PolyfaceQuery{static VisitorToLoop(e){const t=c.LineString3d.createPoints(e.point.getPoint3dArray());return a.Loop.create(t)}static IndexedPolyfaceToLoops(e){const t=s.BagOfCurves.create(),r=e.createVisitor(1);for(;r.moveToNextFacet();){const e=PolyfaceQuery.VisitorToLoop(r);t.tryAddChild(e)}return t}static sumFacetAreas(e){let t=0;if(e instanceof i.Polyface)return PolyfaceQuery.sumFacetAreas(e.createVisitor(1));const r=e;for(r.reset();r.moveToNextFacet();)t+=l.PolygonOps.sumTriangleAreas(r.point.getPoint3dArray());return t}static sumTetrahedralVolumes(e,t){let r=0;if(e instanceof i.Polyface)return PolyfaceQuery.sumTetrahedralVolumes(e.createVisitor(0),t);let o=t;const s=e,a=n.Point3d.create(),c=n.Point3d.create(),l=n.Point3d.create();for(s.reset();s.moveToNextFacet();){void 0===o&&(o=s.point.getPoint3dAt(0)),s.point.getPoint3dAt(0,a);for(let e=1;e+1<s.point.length;e++)s.point.getPoint3dAt(e,c),s.point.getPoint3dAt(e+1,l),r+=o.tripleProductToPoints(a,c,l)}return r/6}static SumFacetSecondAreaMomentProducts(e,t){if(e instanceof i.Polyface)return PolyfaceQuery.SumFacetSecondAreaMomentProducts(e.createVisitor(0),t);const r=o.Matrix4d.createZero(),n=e;for(n.reset();n.moveToNextFacet();)l.PolygonOps.addSecondMomentAreaProducts(n.point,t,r);return r}static computePrincipalAreaMoments(e){const t=e.data.getPoint(0);if(!t)return;const r=PolyfaceQuery.SumFacetSecondAreaMomentProducts(e,t);return u.MomentData.inertiaProductsToPrincipalAxes(t,r)}}t.PolyfaceQuery=PolyfaceQuery},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.FeatureGates=class FeatureGates{constructor(){this.onChanged=new n.BeEvent,this.gates=new Map}check(e,t){const r=this.gates.get(e);return void 0===r?t:r}setGate(e,t){0!==e.length&&(void 0===t?this.gates.delete(e):this.gates.set(e,t),this.onChanged.raiseEvent(e,t))}addMonitor(e,t){return this.onChanged.addListener((r,n)=>{r===e&&t(n)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(58);class NonUniformColor{constructor(e,t,r){this.colors=new Uint32Array(e.buffer),this.indices=new Uint16Array(t.buffer),this.isOpaque=!r}}t.NonUniformColor=NonUniformColor;t.ColorIndex=class ColorIndex{get hasAlpha(){return!this._color.isOpaque}get isUniform(){return this._color instanceof n.ColorDef}get numColors(){return this.isUniform?1:this.nonUniform.colors.length}constructor(){this._color=n.ColorDef.white.clone()}reset(){this._color=n.ColorDef.white.clone()}get uniform(){return this.isUniform?this._color:void 0}initUniform(e){this._color="number"===typeof e?new n.ColorDef(e):e.clone()}get nonUniform(){return this.isUniform?void 0:this._color}initNonUniform(e,t,r){this._color=new NonUniformColor(e,t,r)}},function(e){e[e.Empty=0]="Empty",e[e.Uniform=1]="Uniform",e[e.NonUniform=2]="NonUniform"}(t.FeatureIndexType||(t.FeatureIndexType={}));t.FeatureIndex=class FeatureIndex{constructor(){this.type=0,this.featureID=0,this.reset()}get isUniform(){return 1===this.type}get isEmpty(){return 0===this.type}reset(){this.type=0,this.featureID=0,this.featureIDs=void 0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TrueType=1]="TrueType",e[e.Rsc=2]="Rsc",e[e.Shx=3]="Shx"}(t.FontType||(t.FontType={}));t.FontMap=class FontMap{constructor(e){this.fonts=new Map,e.fonts.forEach(e=>this.fonts.set(e.id,e))}toJSON(){const e=[];return this.fonts.forEach(t=>e.push(t)),{fonts:e}}getFont(e){if("number"===typeof e)return this.fonts.get(e);for(const t of this.fonts.values())if(t.name===e)return t}}},function(e,t,r){(function(r){var n;t=e.exports=X,n="object"===typeof r&&Object({NODE_ENV:"production",CORS_PROXY_PORT:void 0,PUBLIC_URL:"."})&&Object({NODE_ENV:"production",CORS_PROXY_PORT:void 0,PUBLIC_URL:"."}).NODE_DEBUG&&/\bsemver\b/i.test(Object({NODE_ENV:"production",CORS_PROXY_PORT:void 0,PUBLIC_URL:"."}).NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var i=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,s=t.re=[],a=t.src=[],c=0,l=c++;a[l]="0|[1-9]\\d*";var u=c++;a[u]="[0-9]+";var d=c++;a[d]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var h=c++;a[h]="("+a[l]+")\\.("+a[l]+")\\.("+a[l]+")";var p=c++;a[p]="("+a[u]+")\\.("+a[u]+")\\.("+a[u]+")";var f=c++;a[f]="(?:"+a[l]+"|"+a[d]+")";var g=c++;a[g]="(?:"+a[u]+"|"+a[d]+")";var m=c++;a[m]="(?:-("+a[f]+"(?:\\."+a[f]+")*))";var y=c++;a[y]="(?:-?("+a[g]+"(?:\\."+a[g]+")*))";var v=c++;a[v]="[0-9A-Za-z-]+";var _=c++;a[_]="(?:\\+("+a[v]+"(?:\\."+a[v]+")*))";var w=c++,S="v?"+a[h]+a[m]+"?"+a[_]+"?";a[w]="^"+S+"$";var b="[v=\\s]*"+a[p]+a[y]+"?"+a[_]+"?",x=c++;a[x]="^"+b+"$";var P=c++;a[P]="((?:<|>)?=?)";var C=c++;a[C]=a[u]+"|x|X|\\*";var T=c++;a[T]=a[l]+"|x|X|\\*";var M=c++;a[M]="[v=\\s]*("+a[T]+")(?:\\.("+a[T]+")(?:\\.("+a[T]+")(?:"+a[m]+")?"+a[_]+"?)?)?";var E=c++;a[E]="[v=\\s]*("+a[C]+")(?:\\.("+a[C]+")(?:\\.("+a[C]+")(?:"+a[y]+")?"+a[_]+"?)?)?";var I=c++;a[I]="^"+a[P]+"\\s*"+a[M]+"$";var A=c++;a[A]="^"+a[P]+"\\s*"+a[E]+"$";var R=c++;a[R]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var O=c++;a[O]="(?:~>?)";var D=c++;a[D]="(\\s*)"+a[O]+"\\s+",s[D]=new RegExp(a[D],"g");var k=c++;a[k]="^"+a[O]+a[M]+"$";var F=c++;a[F]="^"+a[O]+a[E]+"$";var N=c++;a[N]="(?:\\^)";var L=c++;a[L]="(\\s*)"+a[N]+"\\s+",s[L]=new RegExp(a[L],"g");var B=c++;a[B]="^"+a[N]+a[M]+"$";var V=c++;a[V]="^"+a[N]+a[E]+"$";var U=c++;a[U]="^"+a[P]+"\\s*("+b+")$|^$";var z=c++;a[z]="^"+a[P]+"\\s*("+S+")$|^$";var j=c++;a[j]="(\\s*)"+a[P]+"\\s*("+b+"|"+a[M]+")",s[j]=new RegExp(a[j],"g");var G=c++;a[G]="^\\s*("+a[M]+")\\s+-\\s+("+a[M]+")\\s*$";var H=c++;a[H]="^\\s*("+a[E]+")\\s+-\\s+("+a[E]+")\\s*$";var q=c++;a[q]="(<|>)?=?\\s*\\*";for(var W=0;W<c;W++)n(W,a[W]),s[W]||(s[W]=new RegExp(a[W]));function J(e,t){if(e instanceof X)return e;if("string"!==typeof e)return null;if(e.length>i)return null;if(!(t?s[x]:s[w]).test(e))return null;try{return new X(e,t)}catch(e){return null}}function X(e,t){if(e instanceof X){if(e.loose===t)return e;e=e.version}else if("string"!==typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError("version is longer than "+i+" characters");if(!(this instanceof X))return new X(e,t);n("SemVer",e,t),this.loose=t;var r=e.trim().match(t?s[x]:s[w]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}t.parse=J,t.valid=function(e,t){var r=J(e,t);return r?r.version:null},t.clean=function(e,t){var r=J(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null},t.SemVer=X,X.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},X.prototype.toString=function(){return this.version},X.prototype.compare=function(e){return n("SemVer.compare",this.version,this.loose,e),e instanceof X||(e=new X(e,this.loose)),this.compareMain(e)||this.comparePre(e)},X.prototype.compareMain=function(e){return e instanceof X||(e=new X(e,this.loose)),K(this.major,e.major)||K(this.minor,e.minor)||K(this.patch,e.patch)},X.prototype.comparePre=function(e){if(e instanceof X||(e=new X(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return K(r,i)}while(++t)},X.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"===typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,r,n){"string"===typeof r&&(n=r,r=void 0);try{return new X(e,r).inc(t,n).version}catch(e){return null}},t.diff=function(e,t){if(ee(e,t))return null;var r=J(e),n=J(t);if(r.prerelease.length||n.prerelease.length){for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return"pre"+i;return"prerelease"}for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return i},t.compareIdentifiers=K;var Y=/^[0-9]+$/;function K(e,t){var r=Y.test(e),n=Y.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function Z(e,t,r){return new X(e,r).compare(new X(t,r))}function Q(e,t,r){return Z(e,t,r)>0}function $(e,t,r){return Z(e,t,r)<0}function ee(e,t,r){return 0===Z(e,t,r)}function te(e,t,r){return 0!==Z(e,t,r)}function re(e,t,r){return Z(e,t,r)>=0}function ne(e,t,r){return Z(e,t,r)<=0}function ie(e,t,r,n){var i;switch(t){case"===":"object"===typeof e&&(e=e.version),"object"===typeof r&&(r=r.version),i=e===r;break;case"!==":"object"===typeof e&&(e=e.version),"object"===typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=ee(e,r,n);break;case"!=":i=te(e,r,n);break;case">":i=Q(e,r,n);break;case">=":i=re(e,r,n);break;case"<":i=$(e,r,n);break;case"<=":i=ne(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function oe(e,t){if(e instanceof oe){if(e.loose===t)return e;e=e.value}if(!(this instanceof oe))return new oe(e,t);n("comparator",e,t),this.loose=t,this.parse(e),this.semver===se?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return K(t,e)},t.major=function(e,t){return new X(e,t).major},t.minor=function(e,t){return new X(e,t).minor},t.patch=function(e,t){return new X(e,t).patch},t.compare=Z,t.compareLoose=function(e,t){return Z(e,t,!0)},t.rcompare=function(e,t,r){return Z(t,e,r)},t.sort=function(e,r){return e.sort(function(e,n){return t.compare(e,n,r)})},t.rsort=function(e,r){return e.sort(function(e,n){return t.rcompare(e,n,r)})},t.gt=Q,t.lt=$,t.eq=ee,t.neq=te,t.gte=re,t.lte=ne,t.cmp=ie,t.Comparator=oe;var se={};function ae(e,t){if(e instanceof ae)return e.loose===t?e:new ae(e.raw,t);if(e instanceof oe)return new ae(e.value,t);if(!(this instanceof ae))return new ae(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ce(e){return!e||"x"===e.toLowerCase()||"*"===e}function le(e,t,r,n,i,o,s,a,c,l,u,d,h){return((t=ce(r)?"":ce(n)?">="+r+".0.0":ce(i)?">="+r+"."+n+".0":">="+t)+" "+(a=ce(c)?"":ce(l)?"<"+(+c+1)+".0.0":ce(u)?"<"+c+"."+(+l+1)+".0":d?"<="+c+"."+l+"."+u+"-"+d:"<="+a)).trim()}function ue(e,t){for(var r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length){for(r=0;r<e.length;r++)if(n(e[r].semver),e[r].semver!==se&&e[r].semver.prerelease.length>0){var i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}function de(e,t,r){try{t=new ae(t,r)}catch(e){return!1}return t.test(e)}function he(e,t,r,n){var i,o,s,a,c;switch(e=new X(e,n),t=new ae(t,n),r){case">":i=Q,o=ne,s=$,a=">",c=">=";break;case"<":i=$,o=re,s=Q,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(de(e,t,n))return!1;for(var l=0;l<t.set.length;++l){var u=null,d=null;if(t.set[l].forEach(function(e){e.semver===se&&(e=new oe(">=0.0.0")),u=u||e,d=d||e,i(e.semver,u.semver,n)?u=e:s(e.semver,d.semver,n)&&(d=e)}),u.operator===a||u.operator===c)return!1;if((!d.operator||d.operator===a)&&o(e,d.semver))return!1;if(d.operator===c&&s(e,d.semver))return!1}return!0}oe.prototype.parse=function(e){var t=this.loose?s[U]:s[z],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new X(r[2],this.loose):this.semver=se},oe.prototype.toString=function(){return this.value},oe.prototype.test=function(e){return n("Comparator.test",e,this.loose),this.semver===se||("string"===typeof e&&(e=new X(e,this.loose)),ie(e,this.operator,this.semver,this.loose))},oe.prototype.intersects=function(e,t){if(!(e instanceof oe))throw new TypeError("a Comparator is required");var r;if(""===this.operator)return r=new ae(e.value,t),de(this.value,r,t);if(""===e.operator)return r=new ae(this.value,t),de(e.semver,r,t);var n=(">="===this.operator||">"===this.operator)&&(">="===e.operator||">"===e.operator),i=("<="===this.operator||"<"===this.operator)&&("<="===e.operator||"<"===e.operator),o=this.semver.version===e.semver.version,s=(">="===this.operator||"<="===this.operator)&&(">="===e.operator||"<="===e.operator),a=ie(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=ie(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||i||o&&s||a||c},t.Range=ae,ae.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},ae.prototype.toString=function(){return this.range},ae.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),n("range",e,t);var r=t?s[H]:s[G];e=e.replace(r,le),n("hyphen replace",e),e=e.replace(s[j],"$1$2$3"),n("comparator trim",e,s[j]),e=(e=(e=e.replace(s[D],"$1~")).replace(s[L],"$1^")).split(/\s+/).join(" ");var i=t?s[U]:s[z],o=e.split(" ").map(function(e){return function(e,t){return n("comp",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){n("caret",e,t);var r=t?s[V]:s[B];return e.replace(r,function(t,r,i,o,s){var a;return n("caret",e,t,r,i,o,s),ce(r)?a="":ce(i)?a=">="+r+".0.0 <"+(+r+1)+".0.0":ce(o)?a="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":s?(n("replaceCaret pr",s),"-"!==s.charAt(0)&&(s="-"+s),a="0"===r?"0"===i?">="+r+"."+i+"."+o+s+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+s+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+s+" <"+(+r+1)+".0.0"):(n("no pr"),a="0"===r?"0"===i?">="+r+"."+i+"."+o+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+" <"+(+r+1)+".0.0"),n("caret return",a),a})}(e,t)}).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){var r=t?s[F]:s[k];return e.replace(r,function(t,r,i,o,s){var a;return n("tilde",e,t,r,i,o,s),ce(r)?a="":ce(i)?a=">="+r+".0.0 <"+(+r+1)+".0.0":ce(o)?a=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":s?(n("replaceTilde pr",s),"-"!==s.charAt(0)&&(s="-"+s),a=">="+r+"."+i+"."+o+s+" <"+r+"."+(+i+1)+".0"):a=">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0",n("tilde return",a),a})}(e,t)}).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim();var r=t?s[A]:s[I];return e.replace(r,function(t,r,i,o,s,a){n("xRange",e,t,r,i,o,s,a);var c=ce(i),l=c||ce(o),u=l||ce(s),d=u;return"="===r&&d&&(r=""),c?t=">"===r||"<"===r?"<0.0.0":"*":r&&d?(l&&(o=0),u&&(s=0),">"===r?(r=">=",l?(i=+i+1,o=0,s=0):u&&(o=+o+1,s=0)):"<="===r&&(r="<",l?i=+i+1:o=+o+1),t=r+i+"."+o+"."+s):l?t=">="+i+".0.0 <"+(+i+1)+".0.0":u&&(t=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0"),n("xRange return",t),t})}(e,t)}).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(s[q],"")}(e,t),n("stars",e),e}(e,t)}).join(" ").split(/\s+/);return this.loose&&(o=o.filter(function(e){return!!e.match(i)})),o=o.map(function(e){return new oe(e,t)})},ae.prototype.intersects=function(e,t){if(!(e instanceof ae))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(r){return e.set.some(function(e){return e.every(function(e){return r.intersects(e,t)})})})})},t.toComparators=function(e,t){return new ae(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},ae.prototype.test=function(e){if(!e)return!1;"string"===typeof e&&(e=new X(e,this.loose));for(var t=0;t<this.set.length;t++)if(ue(this.set[t],e))return!0;return!1},t.satisfies=de,t.maxSatisfying=function(e,t,r){var n=null,i=null;try{var o=new ae(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&-1!==i.compare(e)||(i=new X(n=e,r)))}),n},t.minSatisfying=function(e,t,r){var n=null,i=null;try{var o=new ae(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&1!==i.compare(e)||(i=new X(n=e,r)))}),n},t.validRange=function(e,t){try{return new ae(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,r){return he(e,t,"<",r)},t.gtr=function(e,t,r){return he(e,t,">",r)},t.outside=he,t.prerelease=function(e,t){var r=J(e,t);return r&&r.prerelease.length?r.prerelease:null},t.intersects=function(e,t,r){return e=new ae(e,r),t=new ae(t,r),e.intersects(t)},t.coerce=function(e){if(e instanceof X)return e;if("string"!==typeof e)return null;var t=e.match(s[R]);return null==t?null:J((t[1]||"0")+"."+(t[2]||"0")+"."+(t[3]||"0"))}}).call(this,r(48))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(58),o=r(3);!function(e){e[e.Invalid=0]="Invalid",e[e.Solar=1]="Solar",e[e.Ambient=2]="Ambient",e[e.Flash=3]="Flash",e[e.Portrait=4]="Portrait",e[e.Point=5]="Point",e[e.Spot=6]="Spot",e[e.Area=7]="Area",e[e.Distant=8]="Distant",e[e.SkyOpening=9]="SkyOpening"}(t.LightType||(t.LightType={}));class Light{constructor(e){e=e||{},this.lightType=n.JsonUtils.asInt(e.lightType),this.intensity=n.JsonUtils.asDouble(e.intensity),this.kelvin=n.JsonUtils.asDouble(e.kelvin),this.shadows=n.JsonUtils.asDouble(e.shadows),this.bulbs=n.JsonUtils.asInt(e.bulbs),this.lumens=n.JsonUtils.asDouble(e.lumens),this.color=i.ColorDef.fromJSON(e.color),e.intensity2&&(this.intensity2=n.JsonUtils.asDouble(e.intensity2)),e.color2&&(this.color2=i.ColorDef.fromJSON(e.color2))}get isValid(){return 0!==this.lightType}get isVisible(){return this.isValid&&this.intensity>0}}t.Light=Light;t.Spot=class Spot extends Light{constructor(e){super(e=e||{}),this.lightType=6,this.inner=o.Angle.fromJSON(e.inner),this.outer=o.Angle.fromJSON(e.outer)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);class OctEncodedNormal{constructor(e){this.value=OctEncodedNormal.roundUint16(e)}static clamp(e,t,r){return e<t?t:e>r?r:e}static clampUint8(e){return this.roundUint16(.5+255*(.5*this.clamp(e,-1,1)+.5))}static roundUint16(e){return this._scratchUInt16[0]=e,this._scratchUInt16[0]}static signNotZero(e){return e<0?-1:1}static encode(e){const t=Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z);let r=e.x/t,n=e.y/t;if(e.z<0){const e=r,t=n;r=(1-Math.abs(t))*OctEncodedNormal.signNotZero(e),n=(1-Math.abs(e))*OctEncodedNormal.signNotZero(t)}return this.clampUint8(n)<<8|this.clampUint8(r)}static fromVector(e){return new OctEncodedNormal(this.encode(e))}decode(){const e=this.value;let t=255&e,r=e>>8;t=t/255*2-1,r=r/255*2-1;const i=new n.Vector3d(t,r,1-(Math.abs(t)+Math.abs(r)));if(i.z<0){const e=i.x,t=i.y;i.x=(1-Math.abs(t))*OctEncodedNormal.signNotZero(e),i.y=(1-Math.abs(e))*OctEncodedNormal.signNotZero(t)}return i.normalize()}}OctEncodedNormal._scratchUInt16=new Uint16Array(1),t.OctEncodedNormal=OctEncodedNormal;t.OctEncodedNormalPair=class OctEncodedNormalPair{constructor(e,t){this.first=e,this.second=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(3);r(0);var o;!function(e){const t=65535;function r(e){return e>=0&&e<t+1}function n(e,r,n){return Math.floor(Math.max(0,Math.min(t,.5+(e-r)*n)))}e.computeScale=function(e){return 0===e?e:t/e},e.isInRange=r,e.quantize=n,e.isQuantizable=function(e,t,i){return r(n(e,t,i))},e.unquantize=function(e,t,r){return 0===r?t:t+e/r},e.isQuantized=function(e){return r(e)&&e===Math.floor(e)}}(o=t.Quantization||(t.Quantization={}));class QParams2d{constructor(e=0,t=0,r=0,n=0){this.origin=new i.Point2d,this.scale=new i.Point2d,this.setFrom(e,t,r,n)}setFrom(e,t,r,n){this.origin.x=e,this.origin.y=t,this.scale.x=r,this.scale.y=n}copyFrom(e){this.setFrom(e.origin.x,e.origin.y,e.scale.x,e.scale.y)}clone(e){const t=void 0!==e?e:new QParams2d;return t.copyFrom(this),t}setFromRange(e){e.isNull?this.origin.x=this.origin.y=this.scale.x=this.scale.y=0:this.setFrom(e.low.x,e.low.y,o.computeScale(e.high.x-e.low.x),o.computeScale(e.high.y-e.low.y))}static fromRange(e,t){const r=void 0!==t?t:new QParams2d;return r.setFromRange(e),r}static fromNormalizedRange(){return QParams2d.fromRange(n.Range2d.createArray([i.Point2d.create(-1,-1),i.Point2d.create(1,1)]))}static fromZeroToOne(){return QParams2d.fromRange(n.Range2d.createArray([i.Point2d.create(0,0),i.Point2d.create(1,1)]))}}t.QParams2d=QParams2d;class QPoint2d{constructor(){this._x=0,this._y=0}get x(){return this._x}set x(e){o.isQuantized(e),this._x=e}get y(){return this._y}set y(e){o.isQuantized(e),this._y=e}init(e,t){this.x=o.quantize(e.x,t.origin.x,t.scale.x),this.y=o.quantize(e.y,t.origin.y,t.scale.y)}static create(e,t){const r=new QPoint2d;return r.init(e,t),r}copyFrom(e){this.x=e.x,this.y=e.y}clone(e){const t=void 0!==e?e:new QPoint2d;return t.copyFrom(this),t}setFromScalars(e,t){this.x=e,this.y=t}static fromScalars(e,t){const r=new QPoint2d;return r.setFromScalars(e,t),r}unquantize(e,t){const r=void 0!==t?t:new i.Point2d;return r.x=o.unquantize(this.x,e.origin.x,e.scale.x),r.y=o.unquantize(this.y,e.origin.y,e.scale.y),r}}t.QPoint2d=QPoint2d;t.QPoint2dList=class QPoint2dList{constructor(e){this._list=new Array,this.params=e.clone()}clear(){this._list.length=0}reset(e){this.clear(),this.params.copyFrom(e)}add(e){this._list.push(QPoint2d.create(e,this.params))}push(e){this._list.push(e.clone())}get length(){return this._list.length}unquantize(e,t){return this.length,e<this.length?this._list[e].unquantize(this.params,t):void 0!==t?t:new i.Point2d}requantize(e){for(let t=0;t<this.length;t++){const r=this.unquantize(t);this._list[t].init(r,e)}this.params.copyFrom(e)}toTypedArray(){const e=new Uint16Array(2*this.length),t=this._list;for(let r=0;r<this.length;r++){const n=t[r];e[2*r]=n.x,e[2*r+1]=n.y}return e}};class QParams3d{constructor(e=0,t=0,r=0,n=0,o=0,s=0){this.origin=new i.Point3d,this.scale=new i.Point3d,this.setFrom(e,t,r,n,o,s)}setFrom(e,t,r,n,i,o){this.origin.x=e,this.origin.y=t,this.origin.z=r,this.scale.x=n,this.scale.y=i,this.scale.z=o}copyFrom(e){this.setFrom(e.origin.x,e.origin.y,e.origin.z,e.scale.x,e.scale.y,e.scale.z)}clone(e){const t=void 0!==e?e:new QParams3d;return t.copyFrom(this),t}setFromOriginAndScale(e,t){this.setFrom(e.x,e.y,e.z,t.x,t.y,t.z)}setFromRange(e){e.isNull?(this.origin.x=this.origin.y=this.origin.z=0,this.scale.x=this.scale.y=this.scale.z=0):this.setFrom(e.low.x,e.low.y,e.low.z,o.computeScale(e.high.x-e.low.x),o.computeScale(e.high.y-e.low.y),o.computeScale(e.high.z-e.low.z))}static fromRange(e,t){const r=void 0!==t?t:new QParams3d;return r.setFromRange(e),r}static fromOriginAndScale(e,t,r){const n=void 0!==r?r:new QParams3d;return n.setFromOriginAndScale(e,t),n}static fromNormalizedRange(){return QParams3d.fromRange(n.Range3d.createArray([i.Point3d.create(-1,-1,-1),i.Point3d.create(1,1,1)]))}static fromZeroToOne(){return QParams3d.fromRange(n.Range3d.createArray([i.Point3d.create(0,0,0),i.Point3d.create(1,1,1)]))}}t.QParams3d=QParams3d;class QPoint3d{constructor(){this._x=0,this._y=0,this._z=0}get x(){return this._x}set x(e){o.isQuantized(e),this._x=e}get y(){return this._y}set y(e){o.isQuantized(e),this._y=e}get z(){return this._z}set z(e){o.isQuantized(e),this._z=e}init(e,t){this.x=o.quantize(e.x,t.origin.x,t.scale.x),this.y=o.quantize(e.y,t.origin.y,t.scale.y),this.z=o.quantize(e.z,t.origin.z,t.scale.z)}static create(e,t){const r=new QPoint3d;return r.init(e,t),r}copyFrom(e){this.x=e.x,this.y=e.y,this.z=e.z}clone(e){const t=void 0!==e?e:new QPoint3d;return t.copyFrom(this),t}setFromScalars(e,t,r){this.x=e,this.y=t,this.z=r}static fromScalars(e,t,r,n){const i=void 0===n?new QPoint3d:n;return i.setFromScalars(e,t,r),i}unquantize(e,t){const r=void 0!==t?t:new i.Point3d;return r.x=o.unquantize(this.x,e.origin.x,e.scale.x),r.y=o.unquantize(this.y,e.origin.y,e.scale.y),r.z=o.unquantize(this.z,e.origin.z,e.scale.z),r}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}compare(e){let t=this.x-e.x;return 0===t&&0===(t=this.y-e.y)&&(t=this.z-e.z),t}}t.QPoint3d=QPoint3d;class QPoint3dList{constructor(e){this._list=[],this.params=e?e.clone():QParams3d.fromRange(n.Range3d.createNull())}get list(){return this._list}static fromPoints(e){const t=new QPoint3dList(QParams3d.fromRange(n.Range3d.createArray(e)));for(const r of e)t.add(r);return t}clear(){this._list.length=0}reset(e){this.clear(),this.params.copyFrom(e)}add(e){this._list.push(QPoint3d.create(e,this.params))}push(e){this._list.push(e.clone())}get length(){return this._list.length}unquantize(e,t){return this.length,e<this.length?this._list[e].unquantize(this.params,t):void 0!==t?t:new i.Point3d}requantize(e){for(let t=0;t<this.length;t++){const r=this.unquantize(t);this._list[t].init(r,e)}this.params.copyFrom(e)}toTypedArray(){const e=new Uint16Array(3*this.length),t=this._list;for(let r=0;r<this.length;r++){const n=t[r];e[3*r+0]=n.x,e[3*r+1]=n.y,e[3*r+2]=n.z}return e}static createFrom(e,t){const r=new QPoint3dList(t);for(const n of e)r.add(n);return r}[Symbol.iterator](){let e=0;return{next:()=>{const t=e<this._list.length?{value:this._list[e],done:!1}:{value:this._list[e-1],done:!0};return e++,t}}}}t.QPoint3dList=QPoint3dList},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DecorationGeometryProps=class DecorationGeometryProps{constructor(e,t){this.id=e,this.geometryStream=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(58),o=r(173),s=r(283);!function(e){e[e.Street=1]="Street",e[e.Aerial=2]="Aerial",e[e.Hybrid=3]="Hybrid"}(t.BackgroundMapType||(t.BackgroundMapType={})),function(e){e[e.None=0]="None",e[e.Spherical=1]="Spherical",e[e.Cube=2]="Cube",e[e.Cylindrical=3]="Cylindrical"}(t.SkyBoxImageType||(t.SkyBoxImageType={}));class DisplayStyleSettings{constructor(e){this._subCategoryOverrides=new Map,void 0===e.styles&&(e.styles={}),this._json=e.styles,this._viewFlags=o.ViewFlags.fromJSON(this._json.viewflags),this._background=i.ColorDef.fromJSON(this._json.backgroundColor),this._monochrome=void 0!==this._json.monochromeColor?i.ColorDef.fromJSON(this._json.monochromeColor):i.ColorDef.white.clone(),void 0!==this._json.analysisStyle&&(this._analysisStyle=o.AnalysisStyle.fromJSON(this._json.analysisStyle));const t=n.JsonUtils.asArray(this._json.subCategoryOvr);if(void 0!==t)for(const r of t){const e=n.Id64.fromJSON(r.subCategory);if(n.Id64.isValid(e)){const t=s.SubCategoryOverride.fromJSON(r);t.anyOverridden&&this.changeSubCategoryOverride(e,!1,t)}}}get viewFlags(){return this._viewFlags}set viewFlags(e){e.clone(this._viewFlags),this._json.viewflags=e.toJSON()}get backgroundColor(){return this._background}set backgroundColor(e){this._background.setFrom(e),this._json.backgroundColor=e.toJSON()}get monochromeColor(){return this._monochrome}set monochromeColor(e){this._monochrome.setFrom(e),this._json.monochromeColor=e.toJSON()}get backgroundMap(){const e=this._json.backgroundMap;return void 0!==e?e:{}}set backgroundMap(e){this._json.backgroundMap=e}get analysisStyle(){return this._analysisStyle}set analysisStyle(e){void 0===e?this._analysisStyle=void 0:void 0===this._analysisStyle?this._analysisStyle=o.AnalysisStyle.fromJSON(e):this._analysisStyle.copyFrom(e),this._json.analysisStyle=this._analysisStyle}overrideSubCategory(e,t){this.changeSubCategoryOverride(e,!0,t)}dropSubCategoryOverride(e){this.changeSubCategoryOverride(e,!0)}getSubCategoryOverride(e){return this._subCategoryOverrides.get(e)}get hasSubCategoryOverride(){return this._subCategoryOverrides.size>0}toJSON(){return this._json}findIndexOfSubCategoryOverrideInJSON(e,t){const r=n.JsonUtils.asArray(this._json.subCategoryOvr);if(void 0===r)return t?(this._json.subCategoryOvr=[],0):-1;for(let n=0;n<r.length;n++)if(r[n].subCategory===e)return n;return t?r.length:-1}changeSubCategoryOverride(e,t,r){if(void 0===r){if(this._subCategoryOverrides.delete(e),t){const t=this.findIndexOfSubCategoryOverrideInJSON(e,!1);-1!==t&&this._json.subCategoryOvr.splice(t,1)}}else if(this._subCategoryOverrides.set(e,r),t){const t=this.findIndexOfSubCategoryOverrideInJSON(e,!0);this._json.subCategoryOvr[t]=r.toJSON()}}}t.DisplayStyleSettings=DisplayStyleSettings;t.DisplayStyle3dSettings=class DisplayStyle3dSettings extends DisplayStyleSettings{get _json3d(){return this._json}constructor(e){super(e),this._hline=o.HiddenLine.Settings.fromJSON(this._json3d.hline)}toJSON(){return this._json3d}get hiddenLineSettings(){return this._hline}set hiddenLineSettings(e){this._hline=e,this._json3d.hline=e.toJSON()}get environment(){const e=this._json3d.environment;return void 0!==e?e:{}}set environment(e){this._json3d.environment=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(131),o=r(0),s=r(58),a=r(173),c=r(285),l=r(286),u=r(284),d=r(15);!function(e){let t;!function(e){e[e.Solid=0]="Solid",e[e.Sheet=1]="Sheet",e[e.Wire=2]="Wire"}(t=e.Type||(e.Type={}))}(t.BRepEntity||(t.BRepEntity={}));t.GeometryStreamBuilder=class GeometryStreamBuilder{constructor(){this.geometryStream=[]}setLocalToWorld(e){this._worldToLocal=void 0===e||e.isIdentity?void 0:e.inverse()}setLocalToWorld3d(e,t=n.YawPitchRollAngles.createDegrees(0,0,0)){this.setLocalToWorld(n.Transform.createOriginAndMatrix(e,t.toMatrix3d()))}setLocalToWorld2d(e,t=n.Angle.createDegrees(0)){this.setLocalToWorld(n.Transform.createOriginAndMatrix(n.Point3d.createFrom(e),n.Matrix3d.createRotationAroundVector(n.Vector3d.unitZ(),t)))}appendGeometryRanges(){this.geometryStream.push({subRange:n.Range3d.createNull()})}appendSubCategoryChange(e){return this.geometryStream.push({appearance:{subCategory:e}}),!0}appendGeometryParamsChange(e){const t={subCategory:e.subCategoryId,color:e.lineColor,weight:e.weight,style:e.styleInfo?e.styleInfo.styleId:void 0,transparency:e.elmTransparency,displayPriority:e.elmPriority,geometryClass:e.geometryClass};if(this.geometryStream.push({appearance:t}),void 0!==e.materialId&&this.geometryStream.push({material:{materialId:e.materialId}}),void 0!==e.fillDisplay&&0!==e.fillDisplay){const t={display:e.fillDisplay,transparency:e.fillTransparency};void 0!==e.gradient&&0!==e.gradient.mode?t.gradient=e.gradient.clone():void 0!==e.backgroundFill&&0!==e.backgroundFill?t.backgroundFill=e.backgroundFill:void 0!==e.fillColor&&(t.color=e.fillColor),this.geometryStream.push({fill:t})}if(void 0!==e.pattern){const t=e.pattern.clone();if(void 0!==this._worldToLocal&&!t.applyTransform(this._worldToLocal))return!1;this.geometryStream.push({pattern:t})}if(void 0!==e.styleInfo&&void 0!==e.styleInfo.styleMod){const t=new l.LineStyle.Modifier(e.styleInfo.styleMod);if(void 0!==this._worldToLocal&&!t.applyTransform(this._worldToLocal))return!1;this.geometryStream.push({styleMod:t})}return!0}appendGeometryPart3d(e,t,r,i){if(void 0===this._worldToLocal)return this.geometryStream.push({geomPart:{part:e,origin:t,rotation:r,scale:i}}),!0;const o=n.Transform.createOriginAndMatrix(t,r?r.toMatrix3d():n.Matrix3d.createIdentity());void 0!==i&&o.matrix.scaleColumnsInPlace(i,i,i);const s=o.multiplyTransformTransform(this._worldToLocal),a=new n.Vector3d;if(!s.matrix.normalizeColumnsInPlace(a))return!1;const c=n.YawPitchRollAngles.createFromMatrix3d(s.matrix);return void 0!==c&&(this.geometryStream.push({geomPart:{part:e,origin:s.getOrigin(),rotation:c,scale:a.x}}),!0)}appendGeometryPart2d(e,t,r,i){return this.appendGeometryPart3d(e,t?n.Point3d.createFrom(t):void 0,r?new n.YawPitchRollAngles(r):void 0,i)}appendTextString(e){if(void 0===this._worldToLocal)return this.geometryStream.push({textString:e}),!0;const t=new c.TextString(e);return!!t.transformInPlace(this._worldToLocal)&&(this.geometryStream.push({textString:t}),!0)}appendGeometry(e){if(void 0===this._worldToLocal){const t=i.IModelJson.Writer.toIModelJson(e);return void 0!==t&&(this.geometryStream.push(t),!0)}const t=e.cloneTransformed(this._worldToLocal);if(void 0===t)return!1;const r=i.IModelJson.Writer.toIModelJson(t);return void 0!==r&&(this.geometryStream.push(r),!0)}appendBRepData(e){if(void 0===this._worldToLocal)return this.geometryStream.push({brep:e}),!0;const t=n.Transform.fromJSON(e.transform).multiplyTransformTransform(this._worldToLocal),r={data:e.data,type:e.type,transform:t.isIdentity?void 0:t,faceSymbology:e.faceSymbology};return this.geometryStream.push({brep:r}),!0}};class GeometryStreamIteratorEntry{constructor(e){this.geomParams=new a.GeometryParams(void 0!==e?e:o.Id64.invalid)}}t.GeometryStreamIteratorEntry=GeometryStreamIteratorEntry;class GeometryStreamIterator{constructor(e,t){this._index=0,this.geometryStream=e,this.entry=new GeometryStreamIteratorEntry(void 0!==t?t:o.Id64.invalid)}setLocalToWorld(e){this.entry.localToWorld=void 0===e||e.isIdentity?void 0:e.clone()}setLocalToWorld3d(e,t=n.YawPitchRollAngles.createDegrees(0,0,0)){this.setLocalToWorld(n.Transform.createOriginAndMatrix(e,t.toMatrix3d()))}setLocalToWorld2d(e,t=n.Angle.createDegrees(0)){this.setLocalToWorld(n.Transform.createOriginAndMatrix(n.Point3d.createFrom(e),n.Matrix3d.createRotationAroundVector(n.Vector3d.unitZ(),t)))}static fromGeometricElement3d(e){if(void 0===e.geom)throw new d.IModelError(65570,"GeometricElement has no geometry or geometry wasn't requested");const t=new GeometryStreamIterator(e.geom,e.category);return void 0!==e.placement&&t.setLocalToWorld3d(n.Point3d.fromJSON(e.placement.origin),n.YawPitchRollAngles.fromJSON(e.placement.angles)),t}static fromGeometricElement2d(e){if(void 0===e.geom)throw new d.IModelError(65570,"GeometricElement has no geometry or geometry wasn't requested");const t=new GeometryStreamIterator(e.geom,e.category);return void 0!==e.placement&&t.setLocalToWorld2d(n.Point2d.fromJSON(e.placement.origin),n.Angle.fromJSON(e.placement.angle)),t}static fromGeometryPart(e,t,r){if(void 0===e.geom)throw new d.IModelError(65570,"GeometryPart has no geometry or geometry wasn't requested");const n=new GeometryStreamIterator(e.geom);return void 0!==t&&(n.entry.geomParams=t.clone()),void 0!==r&&n.setLocalToWorld(r),n}partToWorld(){return void 0===this.entry.localToWorld||void 0===this.entry.partToLocal?this.entry.localToWorld:this.entry.partToLocal.multiplyTransformTransform(this.entry.localToWorld)}next(){for(this.entry.partToLocal=this.entry.partId=this.entry.geometryQuery=this.entry.textString=this.entry.brep=void 0;this._index<this.geometryStream.length;){const e=this.geometryStream[this._index++];if(e.appearance)this.entry.geomParams.resetAppearance(),e.appearance.subCategory&&(this.entry.geomParams.subCategoryId=o.Id64.fromJSON(e.appearance.subCategory)),e.appearance.color&&(this.entry.geomParams.lineColor=new s.ColorDef(e.appearance.color)),e.appearance.weight&&(this.entry.geomParams.weight=e.appearance.weight),e.appearance.style&&(this.entry.geomParams.styleInfo=new l.LineStyle.Info(o.Id64.fromJSON(e.appearance.style))),e.appearance.transparency&&(this.entry.geomParams.elmTransparency=e.appearance.transparency),e.appearance.displayPriority&&(this.entry.geomParams.elmPriority=e.appearance.displayPriority),e.appearance.geometryClass&&(this.entry.geomParams.geometryClass=e.appearance.geometryClass);else if(e.styleMod){if(void 0===this.entry.geomParams.styleInfo)continue;const t=new l.LineStyle.Modifier(e.styleMod);void 0!==this.entry.localToWorld&&t.applyTransform(this.entry.localToWorld),this.entry.geomParams.styleInfo=new l.LineStyle.Info(this.entry.geomParams.styleInfo.styleId,t)}else if(e.fill)e.fill.display&&(this.entry.geomParams.fillDisplay=e.fill.display),e.fill.transparency&&(this.entry.geomParams.fillTransparency=e.fill.transparency),e.fill.gradient?this.entry.geomParams.gradient=a.Gradient.Symb.fromJSON(e.fill.gradient):e.fill.backgroundFill?this.entry.geomParams.backgroundFill=e.fill.backgroundFill:e.fill.color&&(this.entry.geomParams.fillColor=new s.ColorDef(e.fill.color));else if(e.pattern){const t=u.AreaPattern.Params.fromJSON(e.pattern);void 0!==this.entry.localToWorld&&t.applyTransform(this.entry.localToWorld),this.entry.geomParams.pattern=t}else if(e.material)e.material.materialId&&(this.entry.geomParams.materialId=o.Id64.fromJSON(e.material.materialId));else{if(!e.subRange){if(e.geomPart){if(this.entry.partId=o.Id64.fromJSON(e.geomPart.part),void 0!==e.geomPart.origin||void 0!==e.geomPart.rotation||void 0!==e.geomPart.scale){const t=e.geomPart.origin?n.Point3d.fromJSON(e.geomPart.origin):n.Point3d.createZero(),r=e.geomPart.rotation?n.YawPitchRollAngles.fromJSON(e.geomPart.rotation).toMatrix3d():n.Matrix3d.createIdentity();this.entry.partToLocal=n.Transform.createRefs(t,r),e.geomPart.scale&&this.entry.partToLocal.multiplyTransformTransform(n.Transform.createRefs(n.Point3d.createZero(),n.Matrix3d.createUniformScale(e.geomPart.scale)),this.entry.partToLocal)}return{value:this.entry,done:!1}}if(e.textString)return this.entry.textString=new c.TextString(e.textString),void 0!==this.entry.localToWorld&&this.entry.textString.transformInPlace(this.entry.localToWorld),{value:this.entry,done:!1};if(e.brep){if(this.entry.brep=e.brep,void 0!==this.entry.localToWorld){const t=n.Transform.fromJSON(e.brep.transform);this.entry.brep.transform=t.multiplyTransformTransform(this.entry.localToWorld)}return{value:this.entry,done:!1}}if(this.entry.geometryQuery=i.IModelJson.Reader.parse(e),void 0===this.entry.geometryQuery)continue;return void 0!==this.entry.localToWorld&&this.entry.geometryQuery.tryTransformInPlace(this.entry.localToWorld),{value:this.entry,done:!1}}this.entry.localRange=n.Range3d.fromJSON(e.subRange)}}return{value:this.entry,done:!0}}[Symbol.iterator](){return this}}t.GeometryStreamIterator=GeometryStreamIterator},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(75),i=r(25);class RpcPendingQueue{constructor(){this._pendingInterval=void 0,this._pending=[],this._pendingLock=0,this._pendingIntervalHandler=function(){const e=(new Date).getTime();++this._pendingLock;for(const t of this._pending)t.connecting||t.lastSubmitted+t.retryInterval>e||t.submit();--this._pendingLock,this.cleanupPendingQueue()}.bind(this),n.RpcRequest.events.addListener(this.requestEventHandler,this)}static initialize(){RpcPendingQueue.instance||(RpcPendingQueue.instance=new RpcPendingQueue)}requestEventHandler(e,t){if(e===i.RpcRequestEvent.StatusChanged)switch(t.status){case i.RpcRequestStatus.Submitted:this.enqueuePending(t);break;case i.RpcRequestStatus.Resolved:case i.RpcRequestStatus.Rejected:case i.RpcRequestStatus.NotFound:this.dequeuePending(t)}}enqueuePending(e){this._pending.push(e),this.setPendingInterval()}dequeuePending(e){if(this._pendingLock)return;const t=this._pending.indexOf(e);this._pending.splice(t,1),this.clearPendingInterval()}cleanupPendingQueue(){if(this._pendingLock)return;let e=this._pending.length;for(;e--;)this._pending[e].pending||this._pending.splice(e,1);this.clearPendingInterval()}setPendingInterval(){this._pendingInterval||(this._pendingInterval=setInterval(this._pendingIntervalHandler,0))}clearPendingInterval(){this._pending.length||(clearInterval(this._pendingInterval),this._pendingInterval=void 0)}}t.RpcPendingQueue=RpcPendingQueue},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(40),i=r(62),o=r(287);class ElectronRpcConfiguration extends i.RpcConfiguration{static get isElectron(){return null!==o.interop}}t.ElectronRpcConfiguration=ElectronRpcConfiguration;class ElectronRpcManager extends n.RpcManager{static initializeClient(e,t){return ElectronRpcManager.performInitialization(e,t)}static initializeImpl(e,t){return ElectronRpcManager.performInitialization(e,t)}static performInitialization(e,t){const r=e.protocol||o.ElectronRpcProtocol,n=class extends ElectronRpcConfiguration{constructor(){super(...arguments),this.interfaces=(()=>t),this.protocol=new r(this)}};for(const o of t)i.RpcConfiguration.assign(o,()=>n);const s=i.RpcConfiguration.obtain(n);return i.RpcConfiguration.initializeInterfaces(s),s}}t.ElectronRpcManager=ElectronRpcManager},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(75),i=r(287),o=r(25);t.ElectronRpcRequest=class ElectronRpcRequest extends n.RpcRequest{constructor(){super(...arguments),this._response=(()=>void 0),this._fulfillment=void 0,this.protocol=this.client.configuration.protocol}send(){try{this.protocol.requests.set(this.id,this);const e=this.protocol.serialize(this);i.interop.ipcRenderer.send(i.CHANNEL,e)}catch(e){this.protocol.events.raiseEvent(o.RpcProtocolEvent.ConnectionErrorReceived,this)}return new Promise(e=>{this._response=e})}load(){const e=this._fulfillment;return e?Promise.resolve(e.result):Promise.reject("No request fulfillment available.")}setHeader(e,t){}notifyResponse(e){this._fulfillment=e,this._response(e.status)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(40),i=r(62),o=r(75),s=r(480),a=r(25);class BentleyCloudRpcConfiguration extends i.RpcConfiguration{constructor(){super(...arguments),this.applicationAuthorizationKey="Authorization"}}t.BentleyCloudRpcConfiguration=BentleyCloudRpcConfiguration;class BentleyCloudRpcManager extends n.RpcManager{static initializeClient(e,t){return BentleyCloudRpcManager.performInitialization(e,t)}static initializeImpl(e,t){return BentleyCloudRpcManager.performInitialization(e,t)}static performInitialization(e,t){const r=class extends BentleyCloudRpcConfiguration{constructor(){super(...arguments),this.interfaces=(()=>t),this.protocol=new class extends(e.protocol||s.BentleyCloudRpcProtocol){constructor(){super(...arguments),this.pathPrefix=e.uriPrefix||"",this.info=e.info}}(this)}};for(const o of t)i.RpcConfiguration.assign(o,()=>r);const n=i.RpcConfiguration.obtain(r);if(i.RpcConfiguration.initializeInterfaces(n),e.pendingRequestListener){const t=e.pendingRequestListener;o.RpcRequest.events.addListener((e,r)=>{e===a.RpcRequestEvent.PendingUpdateReceived&&r.protocol===n.protocol&&t(e,r)})}return n}}t.BentleyCloudRpcManager=BentleyCloudRpcManager},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(174),i=r(15),o=r(0);var s;!function(e){e.MilestoneReview="1",e.WorkGroupEdit="2"}(s||(s={}));t.BentleyCloudRpcProtocol=class BentleyCloudRpcProtocol extends n.WebAppRpcProtocol{constructor(){super(...arguments),this.requestIdHeaderName="X-Correlation-Id"}getOperationFromPath(e){const t=e.split("/"),r=t.length%2===0?-1:-2,n=t.slice(r)[0],i=-1===r?"":t.slice(-1)[0],o=n.indexOf("-"),s=n.lastIndexOf("-"),a=n.slice(0,o),c=n.slice(o+1,s);return{interfaceDefinition:a,operationName:n.slice(s+1),interfaceVersion:c,encodedRequest:i}}supplyPathForOperation(e,t){const r=this.pathPrefix,n=this.info.title,a=this.info.version,c=`${e.interfaceDefinition.name}-${e.interfaceVersion}-${e.operationName}`;let l,u,d,h;if(void 0===t)l="{modeId}",u="{contextId}",d="{iModelId}",h="{changeSetId}";else{const r=e.policy.token(t);if(!r||!r.contextId||!r.iModelId)throw new i.IModelError(32768,"Invalid iModelToken for RPC operation request",o.Logger.logError,"imodeljs-frontend.BentleyCloudRpcProtocol");u=encodeURIComponent(r.contextId),d=encodeURIComponent(r.iModelId),1===r.openMode?(l=s.MilestoneReview,r.changeSetId,h=""===r.changeSetId?"0":r.changeSetId):l=s.WorkGroupEdit}return`${r}/${n}/${a}/mode/${l}/context/${u}/imodel/${d}${h?"/changeset/"+h:""}/${c}`}supplyPathParametersForOperation(e){return[{name:"modeId",in:"path",required:!0,schema:{type:"string"}},{name:"contextId",in:"path",required:!0,schema:{type:"string"}},{name:"iModelId",in:"path",required:!0,schema:{type:"string"}},{name:"changeSetId",in:"path",required:!1,schema:{type:"string"}}]}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(163),i=r(74),o=0,s=1,a=2,c=3,l=4,u=5,d=6,h=7,p=8,f=9,g=10,m=11,y=10,v=13,_=32,w=45,S=58,b=97,x=122,P=/^multipart\/(?:form-data|related)(?:;|$)/i,C=/;\s*([^=]+)=(?:"([^"]+)"|([^;]+))/gi;t.RpcMultipartParser=class RpcMultipartParser{constructor(e,t){let r=P.exec(e);if(!r)throw new Error("unsupported content-type");let n="";for(C.lastIndex=r.index+r[0].length-1;r=C.exec(e);)if("boundary"===r[1].toLowerCase()){n=r[2]||r[3];break}if(!n)throw new Error("content-type missing boundary");this._headerFieldDecoder=null,this._headerValueDecoder=null,this._headerField="",this._partHeaders={},this._partName=null,this._partChunks=[],this._headerValue="",this._headerFieldMark=null,this._headerValueMark=null,this._partDataMark=null,this._partBoundaryFlag=!1,this._boundary=n,this._buffer=t,this._value=i.RpcSerializedValue.create()}parse(){let t=0;const r=this._buffer.length;let n=0,i=0,P=o;const C=e.alloc(this._boundary.length+4);C.write("\r\n--",0,this._boundary.length+4,"ascii"),C.write(this._boundary,4,this._boundary.length,"ascii");const T={};for(const e of C)T[e]=!0;const M=C.length,E=M-1,I=this._buffer.length,A=e.alloc(M+8);let R,O;for(t=0;t<r;t++)switch(R=this._buffer[t],P){case o:i=0,P=s;case s:if(i===M-2&&R===w){i=1,P=g;break}if(i===M-2){if(R!==v)throw new Error("Expected CR Received "+R);i++;break}if(i===M-1){if(R!==y)throw new Error("Expected LF Received "+R);i=0,this._onParsePartBegin(),P=a;break}R!==C[i+2]&&(i=-2),R===C[i+2]&&i++;break;case a:P=c,this._headerFieldMark=t,i=0;case c:if(R===v){this._headerFieldMark=null,P=h;break}if(i++,R===w)break;if(R===S){if(1===i)throw new Error("Empty header field");this._onParseHeaderField(this._buffer.slice(this._headerFieldMark,t)),this._headerFieldMark=null,P=l;break}if((O=32|R)<b||O>x)throw new Error("Expected alphabetic character, received "+R);break;case l:if(R===_)break;this._headerValueMark=t,P=u;case u:R===v&&(this._onParseHeaderValue(this._buffer.slice(this._headerValueMark,t)),this._headerValueMark=null,this._onParseHeaderEnd(),P=d);break;case d:if(R!==y)throw new Error("Expected LF Received "+R);P=a;break;case h:if(R!==y)throw new Error("Expected LF Received "+R);const e=this._onParseHeadersEnd(t+1);if(e)throw e;P=p;break;case p:P=f,this._partDataMark=t;case f:if(n=i,0===i){for(t+=E;t<I&&!(this._buffer[t]in T);)t+=M;t-=E,R=this._buffer[t]}if(i<M)C[i]===R?(0===i&&(this._onParsePartData(this._buffer.slice(this._partDataMark,t)),this._partDataMark=null),i++):i=0;else if(i===M)if(i++,R===v)this._partBoundaryFlag=!0;else{if(R===w){i=1,P=g;break}i=0}else if(i-1===M)if(this._partBoundaryFlag){if(i=0,R===y){this._partBoundaryFlag=!1,this._onParsePartEnd(),this._onParsePartBegin(),P=a;break}}else i=0;i>0?A[i-1]=R:n>0&&(this._onParsePartData(A.slice(0,n)),n=0,this._partDataMark=t,t--);break;case g:if(R!==w)throw new Error("Expected HYPHEN Received "+R);if(1===i)this._onParsePartEnd(),P=m;else if(i>1)throw new Error("Parser has invalid state.");i++;break;case m:break;default:throw new Error("Parser has invalid state.")}return null!=this._headerFieldMark&&(this._onParseHeaderField(this._buffer.slice(this._headerFieldMark)),this._headerFieldMark=0),null!=this._headerValueMark&&(this._onParseHeaderValue(this._buffer.slice(this._headerValueMark)),this._headerValueMark=0),null!=this._partDataMark&&(this._onParsePartData(this._buffer.slice(this._partDataMark)),this._partDataMark=0),this._value}_onParsePartBegin(){this._clearPartVars()}_clearPartVars(){this._partHeaders={},this._partName=null,this._partChunks.length=0,this._headerFieldDecoder=new n.StringDecoder("utf8"),this._headerField="",this._headerValueDecoder=new n.StringDecoder("utf8"),this._headerValue=""}_onParseHeaderField(e){this._headerField+=this._headerFieldDecoder.write(e)}_onParseHeaderValue(e){this._headerValue+=this._headerValueDecoder.write(e)}_onParseHeaderEnd(){let e;this._headerField=this._headerField.toLowerCase(),this._partHeaders[this._headerField]=this._headerValue,"content-disposition"===this._headerField?(e=this._headerValue.match(/\bname="([^"]+)"/i))&&(this._partName=e[1]):this._headerField,this._headerFieldDecoder=new n.StringDecoder("utf8"),this._headerField="",this._headerValueDecoder=new n.StringDecoder("utf8"),this._headerValue=""}_onParsePartData(e){this._partChunks.push(e)}_onParsePartEnd(){const t=1===this._partChunks.length?this._partChunks[0]:e.concat(this._partChunks);"objects"===this._partName?this._value.objects=t.toString():this._value.data.push(t),this._clearPartVars()}_onParseHeadersEnd(e){}}}).call(this,r(36).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(73);t.RpcOpenAPIDescription=class RpcOpenAPIDescription{get paths(){const e={};return this.protocol.configuration.interfaces().forEach(t=>{n.RpcOperation.forEach(t,t=>{const r=this.protocol.supplyPathForOperation(t,void 0);e[r]=this.generateDescription(t)})}),e}get document(){return{openapi:"3.0.0",info:this.protocol.info,paths:this.paths}}constructor(e){this.protocol=e}toJSON(){return this.document}generateDescription(e){const t={"application/json":{schema:{type:"object"}}},r={};r.head={requestBody:{content:{"application/json":{schema:{type:"array"}}},required:!0},responses:{200:{description:"Success",content:t},default:{description:"Error",content:t}}};const n=this.protocol.supplyPathParametersForOperation(e);return n.length&&(r.parameters=n),r}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(172),i=r(288),o=r(0),s=r(25),a="imodeljs-rpc.WebAppRpcProtocol",c="undefined"!==typeof e?r(484):void 0;function l(){return void 0!==c?c.hostname():"undefined"!==typeof window?window.location.host:"imodeljs-mobile"}class WebAppRpcLogging{static logProtocolEvent(e,t){if(t instanceof i.WebAppRpcRequest)switch(e){case s.RpcProtocolEvent.RequestCreated:return WebAppRpcLogging.logRequest("RpcInterface.frontend.request",t);case s.RpcProtocolEvent.ResponseLoaded:return WebAppRpcLogging.logResponse("RpcInterface.frontend.response",t,t.metadata.status,t.elapsed);case s.RpcProtocolEvent.ConnectionErrorReceived:return WebAppRpcLogging.logErrorFrontend("RpcInterface.frontend.connectionError",t);case s.RpcProtocolEvent.ConnectionAborted:return WebAppRpcLogging.logErrorFrontend("RpcInterface.frontend.connectionAborted",t)}else if(t instanceof n.RpcInvocation)switch(e){case s.RpcProtocolEvent.RequestReceived:return WebAppRpcLogging.logRequest("RpcInterface.backend.request",t.request);case s.RpcProtocolEvent.BackendErrorOccurred:return WebAppRpcLogging.logErrorBackend("RpcInterface.backend.error",t);case s.RpcProtocolEvent.BackendResponseCreated:return WebAppRpcLogging.logResponse("RpcInterface.backend.response",t.request,t.status,t.elapsed)}}static getRpcInterfaceName(e){return"string"===typeof e?e:e.name}static logRequest(e,t){o.Logger.logTrace(a,e,()=>({method:t.method,path:t.path,operation:t.operation.operationName,rpcInterface:WebAppRpcLogging.getRpcInterfaceName(t.operation.interfaceDefinition),ActivityId:t.id,TimeElapsed:"elapsed"in t?t.elapsed:0,MachineName:l()}))}static logResponse(e,t,r,n){o.Logger.logTrace(a,e,()=>({method:t.method,path:t.path,operation:t.operation.operationName,rpcInterface:WebAppRpcLogging.getRpcInterfaceName(t.operation.interfaceDefinition),status:r,ActivityId:t.id,TimeElapsed:n,MachineName:l()}))}static logErrorFrontend(e,t){o.Logger.logInfo(a,e,()=>({method:t.method,path:t.path,ActivityId:t.id,MachineName:l()}))}static logErrorBackend(e,t){o.Logger.logInfo(a,e,()=>({method:t.request.method,path:t.request.path,status:t.status,error:t.result,ActivityId:t.request.id,MachineName:l()}))}}t.WebAppRpcLogging=WebAppRpcLogging}).call(this,r(48))},function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!==typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!==typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(62),i=r(289),o=r(25);class MobileRpcConfiguration extends n.RpcConfiguration{static getMobilePlaform(){if("undefined"===typeof window)return o.RpcMobilePlatform.Unknown;const e=window,t=e.navigator.userAgent||e.navigator.vendor||e.opera;return/windows phone/i.test(t)?o.RpcMobilePlatform.Window:/android/i.test(t)?o.RpcMobilePlatform.Android:/iPad|iPhone|iPod/.test(t)&&!e.MSStream?o.RpcMobilePlatform.iOS:o.RpcMobilePlatform.Unknown}static get isMobileBackend(){return null!==i.interop}static get isMobileFrontend(){return MobileRpcConfiguration.platform!==o.RpcMobilePlatform.Unknown}}MobileRpcConfiguration.platform=MobileRpcConfiguration.getMobilePlaform(),t.MobileRpcConfiguration=MobileRpcConfiguration;class MobileRpcManager{static performInitialization(e,t){const r=class extends MobileRpcConfiguration{constructor(){super(...arguments),this.interfaces=(()=>e),this.protocol=new i.MobileRpcProtocol(this,t)}};for(const i of e)n.RpcConfiguration.assign(i,()=>r);const o=n.RpcConfiguration.obtain(r);return n.RpcConfiguration.initializeInterfaces(o),o}static initializeClient(e){return MobileRpcManager.performInitialization(e,o.RpcEndpoint.Frontend)}static initializeImpl(e){return MobileRpcManager.performInitialization(e,o.RpcEndpoint.Backend)}}t.MobileRpcManager=MobileRpcManager},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(75),i=r(289);t.MobileRpcRequest=class MobileRpcRequest extends n.RpcRequest{constructor(){super(...arguments),this._response=(()=>void 0),this._fulfillment=void 0,this.protocol=this.client.configuration.protocol}send(){this.protocol.requests.set(this.id,this);const e=new Blob(i.MobileRpcProtocol.encodeRequest(this),{type:"application/octet-stream"});return this.protocol.socket.readyState===WebSocket.OPEN?this.protocol.socket.send(e):this.protocol.pending.push(e),new Promise(e=>{this._response=e})}load(){const e=this._fulfillment;return e?Promise.resolve(e.result):Promise.reject("No request fulfillment available.")}setHeader(e,t){}notifyResponse(e){this._fulfillment=e,this._response(e.status)}}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const i=r(42),o=r(40),s=r(43),a=r(73);class IModelTileRpcInterface extends i.RpcInterface{static getClient(){return o.RpcManager.getClientForInterface(IModelTileRpcInterface)}getTileTreeProps(e,t){return this.forward.apply(this,arguments)}getTileContent(e,t,r){return this.forward.apply(this,arguments)}}IModelTileRpcInterface.types=(()=>[s.IModelToken]),IModelTileRpcInterface.version="0.1.0",n([a.RpcOperation.allowResponseCaching()],IModelTileRpcInterface.prototype,"getTileContent",null),t.IModelTileRpcInterface=IModelTileRpcInterface},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(69),i=r(3),o=r(42),s=r(40),a=r(43),c=r(171),l=r(290);class IModelWriteRpcInterface extends o.RpcInterface{static getClient(){return s.RpcManager.getClientForInterface(IModelWriteRpcInterface)}openForWrite(e,t){return this.forward.apply(this,arguments)}saveChanges(e,t){return this.forward.apply(this,arguments)}updateProjectExtents(e,t){return this.forward.apply(this,arguments)}saveThumbnail(e,t){return this.forward.apply(this,arguments)}}IModelWriteRpcInterface.types=(()=>[n.AccessToken,c.AxisAlignedBox3d,a.IModelToken,i.Point3d,l.IModelNotFoundResponse]),IModelWriteRpcInterface.version="0.2.0",t.IModelWriteRpcInterface=IModelWriteRpcInterface},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(42),i=r(40),o=r(43);class StandaloneIModelRpcInterface extends n.RpcInterface{static getClient(){return i.RpcManager.getClientForInterface(StandaloneIModelRpcInterface)}openStandalone(e,t){return this.forward.apply(this,arguments)}closeStandalone(e){return this.forward.apply(this,arguments)}}StandaloneIModelRpcInterface.version="1.0.0",StandaloneIModelRpcInterface.types=(()=>[o.IModelToken]),t.StandaloneIModelRpcInterface=StandaloneIModelRpcInterface},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(491))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(906),i=r(492),o=r(496),s=r(0),a=r(0);t.I18N=class I18N{constructor(e,t,r,s){this._namespaceRegistry=new Map,this._i18n=n.createInstance();const a={interpolation:{escapeValue:!0},fallbackLng:"en",ns:e,defaultNS:t,backend:{loadPath:r&&r.urlTemplate?r.urlTemplate:"locales/{{lng}}/{{ns}}.json",crossDomain:!0}};this._i18n=this._i18n.use(o),this._i18n.use(i).use(BentleyLogger).init(a,s).changeLanguage(void 0,void 0)}translateKeys(e){return e.replace(/\%\{(.+?)\}/g,(e,t)=>this.translate(t))}translate(e,t){return this._i18n.t(e,t)}loadNamespace(e,t){this._i18n.loadNamespaces(e,t)}languageList(){return this._i18n.languages}registerNamespace(e){if(this._namespaceRegistry.get(e))throw new s.BentleyError(-1,"namespace '"+e+"' is not unique");const t=new Promise((t,r)=>{this.loadNamespace(e,(r,n)=>{if(!r)return void t();const i=r;let o=this.languageList().map(e=>"/"+e+"/");for(const t of i)t.includes(e)&&(o=o.filter(e=>!t.includes(e)));0===o.length&&a.Logger.logError("I81N","The resource for namespace "+e+" could not be loaded"),t()})}),r=new I18NNamespace(e,t);return this._namespaceRegistry.set(e,r),r}waitForAllRead(){const e=new Array;for(const t of this._namespaceRegistry.values())e.push(t.readFinished);return Promise.all(e)}};class I18NNamespace{constructor(e,t){this.name=e,this.readFinished=t}}t.I18NNamespace=I18NNamespace;class BentleyLogger{log(e){a.Logger.logInfo("i18n",this.createLogMessage(e))}warn(e){a.Logger.logWarning("i18n",this.createLogMessage(e))}error(e){a.Logger.logError("i18n",this.createLogMessage(e))}createLogMessage(e){let t=e[0];for(let r=1;r<e.length;++r){t+="\n";for(let e=0;e<r;++e)t+="    ";t+=e[r]}return t}}BentleyLogger.type="logger"},function(e,t,r){e.exports=r(493).default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(494)),s=r(495),a=(n=s)&&n.__esModule?n:{default:n};var c=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(t,r),this.type="backend"}return i(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=e,this.options=o.defaults(t,this.options||{},{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:JSON.parse,crossDomain:!1,ajax:a.default})}},{key:"readMulti",value:function(e,t,r){var n=this.options.loadPath;"function"===typeof this.options.loadPath&&(n=this.options.loadPath(e,t));var i=this.services.interpolator.interpolate(n,{lng:e.join("+"),ns:t.join("+")});this.loadUrl(i,r)}},{key:"read",value:function(e,t,r){var n=this.options.loadPath;"function"===typeof this.options.loadPath&&(n=this.options.loadPath([e],[t]));var i=this.services.interpolator.interpolate(n,{lng:e,ns:t});this.loadUrl(i,r)}},{key:"loadUrl",value:function(e,t){var r=this;this.options.ajax(e,this.options,function(n,i){if(i.status>=500&&i.status<600)return t("failed loading "+e,!0);if(i.status>=400&&i.status<500)return t("failed loading "+e,!1);var o=void 0,s=void 0;try{o=r.options.parse(n,e)}catch(t){s="failed parsing "+e+" to json"}if(s)return t(s,!1);t(null,o)})}},{key:"create",value:function(e,t,r,n){var i=this;"string"===typeof e&&(e=[e]);var o={};o[r]=n||"",e.forEach(function(e){var r=i.services.interpolator.interpolate(i.options.addPath,{lng:e,ns:t});i.options.ajax(r,i.options,function(e,t){},o)})}}]),e}();c.type="backend",t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=function(e){return i.call(o.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e},t.extend=function(e){return i.call(o.call(arguments,1),function(t){if(t)for(var r in t)e[r]=t[r]}),e};var n=[],i=n.forEach,o=n.slice},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(t&&"object"===("undefined"===typeof t?"undefined":n(t))){var r="",i=encodeURIComponent;for(var o in t)r+="&"+i(o)+"="+i(t[o]);if(!r)return e;e=e+(-1!==e.indexOf("?")?"&":"?")+r.slice(1)}return e}t.default=function(e,t,r,o,s){o&&"object"===("undefined"===typeof o?"undefined":n(o))&&(s||(o._t=new Date),o=i("",o).slice(1)),t.queryStringParams&&(e=i(e,t.queryStringParams));try{var a;(a=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0")).open(o?"POST":"GET",e,1),t.crossDomain||a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.withCredentials=!!t.withCredentials,o&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.overrideMimeType&&a.overrideMimeType("application/json");var c=t.customHeaders;if(c)for(var l in c)a.setRequestHeader(l,c[l]);a.onreadystatechange=function(){a.readyState>3&&r&&r(a.responseText,a)},a.send(o)}catch(e){console&&console.log(e)}}},function(e,t,r){e.exports=r(497).default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(498)),o=h(r(499)),s=h(r(500)),a=h(r(501)),c=h(r(502)),l=h(r(503)),u=h(r(504)),d=h(r(505));function h(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="languageDetector",this.detectors={},this.init(t,r)}return n(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=i.defaults(t,this.options||{},{order:["querystring","cookie","localStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"]}),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(o.default),this.addDetector(s.default),this.addDetector(a.default),this.addDetector(c.default),this.addDetector(l.default),this.addDetector(u.default),this.addDetector(d.default)}},{key:"addDetector",value:function(e){this.detectors[e.name]=e}},{key:"detect",value:function(e){var t=this;e||(e=this.options.order);var r=[];e.forEach(function(e){if(t.detectors[e]){var n=t.detectors[e].lookup(t.options);n&&"string"===typeof n&&(n=[n]),n&&(r=r.concat(n))}});var n=void 0;if(r.forEach(function(e){if(!n){var r=t.services.languageUtils.formatLanguageCode(e);t.services.languageUtils.isWhitelisted(r)&&(n=r)}}),!n){var i=this.i18nOptions.fallbackLng;"string"===typeof i&&(i=[i]),i||(i=[]),n="[object Array]"===Object.prototype.toString.apply(i)?i[0]:i[0]||i.default&&i.default[0]}return n}},{key:"cacheUserLanguage",value:function(e,t){var r=this;t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(function(t){r.detectors[t]&&r.detectors[t].cacheUserLanguage(e,r.options)}))}}]),e}();p.type="languageDetector",t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=function(e){return i.call(o.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e},t.extend=function(e){return i.call(o.call(arguments,1),function(t){if(t)for(var r in t)e[r]=t[r]}),e};var n=[],i=n.forEach,o=n.slice},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,r,n){var i=void 0;if(r){var o=new Date;o.setTime(o.getTime()+60*r*1e3),i="; expires="+o.toGMTString()}else i="";n=n?"domain="+n+";":"",document.cookie=e+"="+t+i+";"+n+"path=/"},i=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var i=r[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null};t.default={name:"cookie",lookup:function(e){var t=void 0;if(e.lookupCookie&&"undefined"!==typeof document){var r=i(e.lookupCookie);r&&(t=r)}return t},cacheUserLanguage:function(e,t){t.lookupCookie&&"undefined"!==typeof document&&n(t.lookupCookie,e,t.cookieMinutes,t.cookieDomain)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"querystring",lookup:function(e){var t=void 0;if("undefined"!==typeof window)for(var r=window.location.search.substring(1).split("&"),n=0;n<r.length;n++){var i=r[n].indexOf("=");if(i>0)r[n].substring(0,i)===e.lookupQuerystring&&(t=r[n].substring(i+1))}return t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0;try{n="undefined"!==window&&null!==window.localStorage;window.localStorage.setItem("i18next.translate.boo","foo"),window.localStorage.removeItem("i18next.translate.boo")}catch(e){n=!1}t.default={name:"localStorage",lookup:function(e){var t=void 0;if(e.lookupLocalStorage&&n){var r=window.localStorage.getItem(e.lookupLocalStorage);r&&(t=r)}return t},cacheUserLanguage:function(e,t){t.lookupLocalStorage&&n&&window.localStorage.setItem(t.lookupLocalStorage,e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"navigator",lookup:function(e){var t=[];if("undefined"!==typeof navigator){if(navigator.languages)for(var r=0;r<navigator.languages.length;r++)t.push(navigator.languages[r]);navigator.userLanguage&&t.push(navigator.userLanguage),navigator.language&&t.push(navigator.language)}return t.length>0?t:void 0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"htmlTag",lookup:function(e){var t=void 0,r=e.htmlTag||("undefined"!==typeof document?document.documentElement:null);return r&&"function"===typeof r.getAttribute&&(t=r.getAttribute("lang")),t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"path",lookup:function(e){var t=void 0;if("undefined"!==typeof window){var r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(r instanceof Array)if("number"===typeof e.lookupFromPathIndex){if("string"!==typeof r[e.lookupFromPathIndex])return;t=r[e.lookupFromPathIndex].replace("/","")}else t=r[0].replace("/","")}return t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"subdomain",lookup:function(e){var t=void 0;if("undefined"!==typeof window){var r=window.location.pathname.match(/(?:http[s]*\:\/\/)*(.*?)\.(?=[^\/]*\..{2,5})/gi);r instanceof Array&&(t="number"===typeof e.lookupFromSubdomainIndex?r[e.lookupFromSubdomainIndex].replace("http://","").replace("https://","").replace(".",""):r[0].replace("http://","").replace("https://","").replace(".",""))}return t}}},function(e,t,r){var n;n=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";e.exports=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=r(5),o=r(7),s=r(4),a=function(){function e(t,r){var n=r.location,i=void 0===n?0:n,o=r.distance,a=void 0===o?100:o,c=r.threshold,l=void 0===c?.6:c,u=r.maxPatternLength,d=void 0===u?32:u,h=r.isCaseSensitive,p=void 0!==h&&h,f=r.tokenSeparator,g=void 0===f?/ +/g:f,m=r.findAllMatches,y=void 0!==m&&m,v=r.minMatchCharLength,_=void 0===v?1:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:l,maxPatternLength:d,isCaseSensitive:p,tokenSeparator:g,findAllMatches:y,minMatchCharLength:_},this.pattern=this.options.isCaseSensitive?t:t.toLowerCase(),this.pattern.length<=d&&(this.patternAlphabet=s(this.pattern))}return n(e,[{key:"search",value:function(e){if(this.options.isCaseSensitive||(e=e.toLowerCase()),this.pattern===e)return{isMatch:!0,score:0,matchedIndices:[[0,e.length-1]]};var t=this.options,r=t.maxPatternLength,n=t.tokenSeparator;if(this.pattern.length>r)return i(e,this.pattern,n);var s=this.options,a=s.location,c=s.distance,l=s.threshold,u=s.findAllMatches,d=s.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:a,distance:c,threshold:l,findAllMatches:u,minMatchCharLength:d})}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(0);e.exports=function(e,t){return function e(t,r,i){if(r){var o=r.indexOf("."),s=r,a=null;-1!==o&&(s=r.slice(0,o),a=r.slice(o+1));var c=t[s];if(null!==c&&void 0!==c)if(a||"string"!==typeof c&&"number"!==typeof c)if(n(c))for(var l=0,u=c.length;l<u;l+=1)e(c[l],a,i);else a&&e(c,a,i);else i.push(c.toString())}else i.push(t);return i}(e,t,[])}},function(e,t,r){"use strict";e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[],n=-1,i=-1,o=0,s=e.length;o<s;o+=1){var a=e[o];a&&-1===n?n=o:a||-1===n||((i=o-1)-n+1>=t&&r.push([n,i]),n=-1)}return e[o-1]&&o-n>=t&&r.push([n,o-1]),r}},function(e,t,r){"use strict";e.exports=function(e){for(var t={},r=e.length,n=0;n<r;n+=1)t[e.charAt(n)]=0;for(var i=0;i<r;i+=1)t[e.charAt(i)]|=1<<r-i-1;return t}},function(e,t,r){"use strict";var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,i=new RegExp(t.replace(n,"\\$&").replace(r,"|")),o=e.match(i),s=!!o,a=[];if(s)for(var c=0,l=o.length;c<l;c+=1){var u=o[c];a.push([e.indexOf(u),u.length-1])}return{score:s?.5:1,isMatch:s,matchedIndices:a}}},function(e,t,r){"use strict";e.exports=function(e,t){var r=t.errors,n=void 0===r?0:r,i=t.currentLocation,o=void 0===i?0:i,s=t.expectedLocation,a=void 0===s?0:s,c=t.distance,l=void 0===c?100:c,u=n/e.length,d=Math.abs(a-o);return l?u+d/l:d?1:u}},function(e,t,r){"use strict";var n=r(6),i=r(3);e.exports=function(e,t,r,o){for(var s=o.location,a=void 0===s?0:s,c=o.distance,l=void 0===c?100:c,u=o.threshold,d=void 0===u?.6:u,h=o.findAllMatches,p=void 0!==h&&h,f=o.minMatchCharLength,g=void 0===f?1:f,m=a,y=e.length,v=d,_=e.indexOf(t,m),w=t.length,S=[],b=0;b<y;b+=1)S[b]=0;if(-1!==_){var x=n(t,{errors:0,currentLocation:_,expectedLocation:m,distance:l});if(v=Math.min(x,v),-1!==(_=e.lastIndexOf(t,m+w))){var P=n(t,{errors:0,currentLocation:_,expectedLocation:m,distance:l});v=Math.min(P,v)}}_=-1;for(var C=[],T=1,M=w+y,E=1<<w-1,I=0;I<w;I+=1){for(var A=0,R=M;A<R;){n(t,{errors:I,currentLocation:m+R,expectedLocation:m,distance:l})<=v?A=R:M=R,R=Math.floor((M-A)/2+A)}M=R;var O=Math.max(1,m-R+1),D=p?y:Math.min(m+R,y)+w,k=Array(D+2);k[D+1]=(1<<I)-1;for(var F=D;F>=O;F-=1){var N=F-1,L=r[e.charAt(N)];if(L&&(S[N]=1),k[F]=(k[F+1]<<1|1)&L,0!==I&&(k[F]|=(C[F+1]|C[F])<<1|1|C[F+1]),k[F]&E&&(T=n(t,{errors:I,currentLocation:N,expectedLocation:m,distance:l}))<=v){if(v=T,(_=N)<=m)break;O=Math.max(1,2*m-_)}}if(n(t,{errors:I+1,currentLocation:m,expectedLocation:m,distance:l})>v)break;C=k}return{isMatch:_>=0,score:0===T?.001:T,matchedIndices:i(S,g)}}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=r(1),o=r(2),s=r(0),a=function(){function e(t,r){var n=r.location,i=void 0===n?0:n,s=r.distance,a=void 0===s?100:s,c=r.threshold,l=void 0===c?.6:c,u=r.maxPatternLength,d=void 0===u?32:u,h=r.caseSensitive,p=void 0!==h&&h,f=r.tokenSeparator,g=void 0===f?/ +/g:f,m=r.findAllMatches,y=void 0!==m&&m,v=r.minMatchCharLength,_=void 0===v?1:v,w=r.id,S=void 0===w?null:w,b=r.keys,x=void 0===b?[]:b,P=r.shouldSort,C=void 0===P||P,T=r.getFn,M=void 0===T?o:T,E=r.sortFn,I=void 0===E?function(e,t){return e.score-t.score}:E,A=r.tokenize,R=void 0!==A&&A,O=r.matchAllTokens,D=void 0!==O&&O,k=r.includeMatches,F=void 0!==k&&k,N=r.includeScore,L=void 0!==N&&N,B=r.verbose,V=void 0!==B&&B;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:l,maxPatternLength:d,isCaseSensitive:p,tokenSeparator:g,findAllMatches:y,minMatchCharLength:_,id:S,keys:x,includeMatches:F,includeScore:L,shouldSort:C,getFn:M,sortFn:I,verbose:V,tokenize:R,matchAllTokens:D},this.setCollection(t)}return n(e,[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"search",value:function(e){this._log('---------\nSearch pattern: "'+e+'"');var t=this._prepareSearchers(e),r=t.tokenSearchers,n=t.fullSearcher,i=this._search(r,n),o=i.weights,s=i.results;return this._computeScore(o,s),this.options.shouldSort&&this._sort(s),this._format(s)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var r=e.split(this.options.tokenSeparator),n=0,o=r.length;n<o;n+=1)t.push(new i(r[n],this.options));return{tokenSearchers:t,fullSearcher:new i(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],r=this.list,n={},i=[];if("string"===typeof r[0]){for(var o=0,s=r.length;o<s;o+=1)this._analyze({key:"",value:r[o],record:o,index:o},{resultMap:n,results:i,tokenSearchers:e,fullSearcher:t});return{weights:null,results:i}}for(var a={},c=0,l=r.length;c<l;c+=1)for(var u=r[c],d=0,h=this.options.keys.length;d<h;d+=1){var p=this.options.keys[d];if("string"!==typeof p){if(a[p.name]={weight:1-p.weight||1},p.weight<=0||p.weight>1)throw new Error("Key weight has to be > 0 and <= 1");p=p.name}else a[p]={weight:1};this._analyze({key:p,value:this.options.getFn(u,p),record:u,index:c},{resultMap:n,results:i,tokenSearchers:e,fullSearcher:t})}return{weights:a,results:i}}},{key:"_analyze",value:function(e,t){var r=e.key,n=e.arrayIndex,i=void 0===n?-1:n,o=e.value,a=e.record,c=e.index,l=t.tokenSearchers,u=void 0===l?[]:l,d=t.fullSearcher,h=void 0===d?[]:d,p=t.resultMap,f=void 0===p?{}:p,g=t.results,m=void 0===g?[]:g;if(void 0!==o&&null!==o){var y=!1,v=-1,_=0;if("string"===typeof o){this._log("\nKey: "+(""===r?"-":r));var w=h.search(o);if(this._log('Full text: "'+o+'", score: '+w.score),this.options.tokenize){for(var S=o.split(this.options.tokenSeparator),b=[],x=0;x<u.length;x+=1){var P=u[x];this._log('\nPattern: "'+P.pattern+'"');for(var C=!1,T=0;T<S.length;T+=1){var M=S[T],E=P.search(M),I={};E.isMatch?(I[M]=E.score,y=!0,C=!0,b.push(E.score)):(I[M]=1,this.options.matchAllTokens||b.push(1)),this._log('Token: "'+M+'", score: '+I[M])}C&&(_+=1)}v=b[0];for(var A=b.length,R=1;R<A;R+=1)v+=b[R];v/=A,this._log("Token score average:",v)}var O=w.score;v>-1&&(O=(O+v)/2),this._log("Score average:",O);var D=!this.options.tokenize||!this.options.matchAllTokens||_>=u.length;if(this._log("\nCheck Matches: "+D),(y||w.isMatch)&&D){var k=f[c];k?k.output.push({key:r,arrayIndex:i,value:o,score:O,matchedIndices:w.matchedIndices}):(f[c]={item:a,output:[{key:r,arrayIndex:i,value:o,score:O,matchedIndices:w.matchedIndices}]},m.push(f[c]))}}else if(s(o))for(var F=0,N=o.length;F<N;F+=1)this._analyze({key:r,arrayIndex:F,value:o[F],record:a,index:c},{resultMap:f,results:m,tokenSearchers:u,fullSearcher:h})}}},{key:"_computeScore",value:function(e,t){this._log("\n\nComputing score:\n");for(var r=0,n=t.length;r<n;r+=1){for(var i=t[r].output,o=i.length,s=1,a=1,c=0;c<o;c+=1){var l=e?e[i[c].key].weight:1,u=(1===l?i[c].score:i[c].score||.001)*l;1!==l?a=Math.min(a,u):(i[c].nScore=u,s*=u)}t[r].score=1===a?s:a,this._log(t[r])}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];this.options.verbose&&this._log("\n\nOutput:\n\n",JSON.stringify(e));var r=[];this.options.includeMatches&&r.push(function(e,t){var r=e.output;t.matches=[];for(var n=0,i=r.length;n<i;n+=1){var o=r[n];if(0!==o.matchedIndices.length){var s={indices:o.matchedIndices,value:o.value};o.key&&(s.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(s.arrayIndex=o.arrayIndex),t.matches.push(s)}}}),this.options.includeScore&&r.push(function(e,t){t.score=e.score});for(var n=0,i=e.length;n<i;n+=1){var o=e[n];if(this.options.id&&(o.item=this.options.getFn(o.item,this.options.id)[0]),r.length){for(var s={item:o.item},a=0,c=r.length;a<c;a+=1)r[a](o,s);t.push(s)}else t.push(o.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}]),e}();e.exports=a}])},e.exports=n()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(88),i=r(178),o=r(77),s=r(4),a=r(0);!function(e){class Header extends n.TileIO.Header{constructor(e){super(e),this.length=e.nextUint32,this.featureTableJsonLength=e.nextUint32,this.featureTableBinaryLength=e.nextUint32,this.batchTableJsonLength=e.nextUint32,this.batchTableBinaryLength=e.nextUint32,e.advance(this.featureTableJsonLength),e.advance(this.featureTableBinaryLength),e.advance(this.batchTableJsonLength),e.advance(this.batchTableBinaryLength),e.isPastTheEnd&&this.invalidate()}get isValid(){return 1835283298===this.format}}e.Header=Header;class Reader extends i.GltfTileIO.Reader{constructor(e,t,r,n,i,o,s,a){super(e,t,r,n,i,0,a),this._range=o,this._isLeaf=s}static create(e,t,r,n,o,s,a,c,l){if(!new Header(e).isValid)return;const u=i.GltfTileIO.ReaderProps.create(e,a);return void 0!==u?new Reader(u,t,r,n,s,o,c,l):void 0}async read(){const e=new s.FeatureTable(1,this._modelId,this._type),t=new s.Feature(this._modelId);return e.insert(t),await this.loadTextures(),this._isCanceled?Promise.resolve({readStatus:6,isLeaf:this._isLeaf}):Promise.resolve(this.readGltfAndCreateGraphics(this._isLeaf,!1,!0,e,this._range))}readFeatures(e,t){const r=new s.Feature(this._modelId);return e.add(r,1),!0}readColorTable(e,t){return e.insert(7829367),!0}createDisplayParams(e){let t;void 0!==e&&void 0!==e.values.tex&&(t=this.findTextureMapping(e.values.tex));const r=new s.ColorDef(2004318071);return new o.DisplayParams(o.DisplayParams.Type.Mesh,r,r,1,0,s.FillFlags.Always,void 0,void 0,!0,t)}extractReturnToCenter(e){if(void 0===e)return;const t=a.JsonUtils.asObject(e.CESIUM_RTC);return void 0===t?void 0:a.JsonUtils.asArray(t.center)}get _hasBakedLighting(){return!0}}e.Reader=Reader}(t.B3dmTileIO||(t.B3dmTileIO={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(88),i=r(4),o=(r(0),r(26)),s=r(0),a=r(509),c=r(53),l=r(3);!function(e){class Header extends n.TileIO.Header{get isValid(){return 1937010288===this.format}constructor(e){super(e),this.length=e.nextUint32,this.featureTableJsonLength=e.nextUint32,this.featureTableBinaryLength=e.nextUint32,this.batchTableJsonLength=e.nextUint32,this.batchTableBinaryLength=e.nextUint32}}e.readPointCloud=function(e,t,r,n,u,d,h){const p=new Header(e);if(!p.isValid)return;const f=e.curPos,g=e.nextBytes(p.featureTableJsonLength),m=s.utf8ToString(g),y=JSON.parse(m);if(void 0===y.POSITION_QUANTIZED||void 0===y.QUANTIZED_VOLUME_OFFSET||void 0===y.QUANTIZED_VOLUME_SCALE||void 0===y.POINTS_LENGTH||void 0===y.POSITION_QUANTIZED)return;const v=new l.Point3d(y.QUANTIZED_VOLUME_OFFSET[0],y.QUANTIZED_VOLUME_OFFSET[1],y.QUANTIZED_VOLUME_OFFSET[2]),_=new l.Point3d(i.Quantization.computeScale(y.QUANTIZED_VOLUME_SCALE[0]),i.Quantization.computeScale(y.QUANTIZED_VOLUME_SCALE[1]),i.Quantization.computeScale(y.QUANTIZED_VOLUME_SCALE[2])),w=i.QParams3d.fromOriginAndScale(v,_),S=new Uint16Array(e.arrayBuffer,f+p.featureTableJsonLength+y.POSITION_QUANTIZED.byteOffset,3*y.POINTS_LENGTH);let b;void 0!==y.RGB?b=new Uint8Array(e.arrayBuffer,f+p.featureTableJsonLength+y.RGB.byteOffset,3*y.POINTS_LENGTH):(b=new Uint8Array(3*y.POINTS_LENGTH)).fill(255,0,b.length);const x=new i.FeatureTable(1,r,0),P=new c.Mesh.Features(x);P.add(new i.Feature(r),1);let C=d.createPointCloud(new a.PointCloudArgs(S,w,b,P),t);if(C=d.createBatch(C,o.PackedFeatureTable.pack(x),u),h){const e=new o.GraphicBranch;e.add(C);const t=l.Transform.createOriginAndMatrix(void 0,l.Matrix3d.createRotationAroundVector(l.Vector3d.create(1,0,0),l.Angle.createRadians(l.Angle.piOver2Radians)));C=d.createBranch(e,t)}return C}}(t.PntsTileIO||(t.PntsTileIO={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);t.PointCloudArgs=class PointCloudArgs{constructor(e,t,r,i){this.features=new n.FeatureIndex,this.points=e,this.colors=r,this.pointParams=t,i.toFeatureIndex(this.features)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(88),i=r(178),o=r(77),s=r(0),a=r(63),c=r(4);!function(e){let t;!function(e){e[e.None=0]="None",e[e.ContainsCurves=1]="ContainsCurves",e[e.Incomplete=2]="Incomplete",e[e.IsLeaf=4]="IsLeaf",e[e.HasSizeMultiplier=8]="HasSizeMultiplier"}(t=e.Flags||(e.Flags={}));class Header extends n.TileIO.Header{constructor(e){super(e),this.flags=e.nextUint32,this.contentRange=c.ElementAlignedBox3d.createFromPoints(e.nextPoint3d64,e.nextPoint3d64),this.sizeMultiplier=e.nextFloat64,this.length=e.nextUint32,e.isPastTheEnd&&this.invalidate()}get isValid(){return 1416521572===this.format}}e.Header=Header;class FeatureTableHeader{constructor(e,t,r){this.length=e,this.maxFeatures=t,this.count=r}static readFrom(e){const t=e.nextUint32,r=e.nextUint32,n=e.nextUint32;return e.isPastTheEnd?void 0:new FeatureTableHeader(t,r,n)}}class Reader extends i.GltfTileIO.Reader{constructor(e,t,r,n,i,o=0,s){super(e,t,r,n,i,o,s)}static create(e,t,r,n,o,s=0,a){if(!new Header(e).isValid)return;if(!this.skipFeatureTable(e))return;const c=i.GltfTileIO.ReaderProps.create(e);return void 0!==c?new Reader(c,t,r,n,o,s,a):void 0}extractReturnToCenter(e){}static skipFeatureTable(e){const t=e.curPos,r=FeatureTableHeader.readFrom(e);return void 0!==r&&(e.curPos=t+r.length),void 0!==r}async read(){this._buffer.reset();const e=new Header(this._buffer);let t=!0;if(!e.isValid)return{readStatus:2,isLeaf:t};t=0!==(4&e.flags);const r=0!==(8&e.flags)?e.sizeMultiplier:void 0,n=this.readFeatureTable();if(void 0===n)return{readStatus:5,isLeaf:t,sizeMultiplier:r};const i=0===(2&e.flags),o=0!==(1&e.flags);return await this.loadNamedTextures(),this._isCanceled?Promise.resolve({readStatus:6,isLeaf:t,sizeMultiplier:r}):Promise.resolve(this.readGltfAndCreateGraphics(t,o,i,n,e.contentRange,r))}readFeatureTable(){const e=this._buffer.curPos,t=FeatureTableHeader.readFrom(this._buffer);if(void 0===t)return;const r=new c.FeatureTable(t.maxFeatures,this._modelId,this._type);for(let n=0;n<t.count;n++){const e=this._buffer.nextId64,t=this._buffer.nextId64,n=this._buffer.nextUint32,i=this._buffer.nextUint32;if(this._buffer.isPastTheEnd)return;r.insertWithIndex(new c.Feature(e,t,n),i)}return this._buffer.curPos=e+t.length,r}readFeatureIndices(e){const t=e.featureID;return void 0!==t?[t]:this.readIndices(e,"featureIDs")}readColorTable(e,t){const r=s.JsonUtils.asArray(t.colorTable);if(void 0!==r)for(const n of r)e.insert(n);return 0<e.length}createDisplayParams(e){const t=s.JsonUtils.asInt(e.type,o.DisplayParams.Type.Mesh),r=new c.ColorDef(s.JsonUtils.asInt(e.lineColor)),n=new c.ColorDef(s.JsonUtils.asInt(e.fillColor)),i=s.JsonUtils.asInt(e.lineWidth),a=s.JsonUtils.asInt(e.linePixels,0),l=s.JsonUtils.asInt(e.fillFlags,c.FillFlags.None),u=s.JsonUtils.asBool(e.ignoreLighting),d=e.materialId,h=void 0!==d?this.materialFromJson(d):void 0;let p;if(!h){const t=e.texture;if(void 0===(p=void 0!==t?this.textureMappingFromJson(t):void 0)){const t=e.gradient,r=void 0!==t?c.Gradient.Symb.fromJSON(t):void 0;if(void 0!==r){const e=this._system.getGradientTexture(r,this._iModel);void 0!==e&&(p=new c.TextureMapping(e,new c.TextureMapping.Params({textureMat2x3:new c.TextureMapping.Trans2x3(0,1,0,1,0,0)})))}}}return new o.DisplayParams(t,r,n,i,a,l,h,void 0,u,p)}colorDefFromMaterialJson(e){return void 0!==e?c.ColorDef.from(255*e[0]+.5,255*e[1]+.5,255*e[2]+.5):void 0}materialFromJson(e){if(void 0===this._renderMaterials||void 0===this._renderMaterials[e])return;let t=this._system.findMaterial(e,this._iModel);if(!t){const r=this._renderMaterials[e],n=new c.RenderMaterial.Params(e);n.diffuseColor=this.colorDefFromMaterialJson(r.diffuseColor),void 0!==r.diffuse&&(n.diffuse=s.JsonUtils.asDouble(r.diffuse)),n.specularColor=this.colorDefFromMaterialJson(r.specularColor),void 0!==r.specular&&(n.specular=s.JsonUtils.asDouble(r.specular)),n.reflectColor=this.colorDefFromMaterialJson(r.reflectColor),void 0!==r.reflect&&(n.reflect=s.JsonUtils.asDouble(r.reflect)),void 0!==r.specularExponent&&(n.specularExponent=r.specularExponent),void 0!==r.transparency&&(n.transparency=r.transparency),n.refract=s.JsonUtils.asDouble(r.refract),n.shadows=s.JsonUtils.asBool(r.shadows),n.ambient=s.JsonUtils.asDouble(r.ambient),void 0!==r.textureMapping&&(n.textureMapping=this.textureMappingFromJson(r.textureMapping.texture)),t=this._system.createMaterial(n,this._iModel)}return t}textureMappingFromJson(e){if(void 0===e)return;const t=s.JsonUtils.asString(e.name),r=0!==t.length?this._namedTextures[t]:void 0,n=void 0!==r?r.renderTexture:void 0;if(void 0===n)return;const i=e.params,o=i.transform,a={textureMat2x3:new c.TextureMapping.Trans2x3(o[0][0],o[0][1],o[0][2],o[1][0],o[1][1],o[1][2]),textureWeight:s.JsonUtils.asDouble(i.weight,1),mapMode:s.JsonUtils.asInt(i.mode),worldMapping:s.JsonUtils.asBool(i.worldMapping)};return new c.TextureMapping(n,new c.TextureMapping.Params(a))}async loadNamedTextures(){if(void 0===this._namedTextures)return Promise.resolve();const e=new Array;for(const t of Object.keys(this._namedTextures))e.push(this.loadNamedTexture(t));return e.length>0?Promise.all(e).then(e=>void 0):Promise.resolve()}async loadNamedTexture(e){if(this._isCanceled)return Promise.resolve();const t=this._namedTextures[e];return void 0===t?Promise.resolve():void 0!==this._system.findTexture(e,this._iModel)?Promise.resolve():this.readNamedTexture(t).then(e=>{t.renderTexture=e})}async readNamedTexture(e){const t=s.JsonUtils.asString(e.bufferView),r=0!==t.length?this._bufferViews[t]:void 0;if(void 0===r)return Promise.resolve(void 0);const n=s.JsonUtils.asInt(r.byteOffset),i=s.JsonUtils.asInt(r.byteLength);if(0===i)return Promise.resolve(void 0);const o=this._binaryData.subarray(n,n+i),l=e.format,u=new c.ImageSource(o,l);return a.imageElementFromImageSource(u).then(t=>{if(this._isCanceled)return;let r=0;s.JsonUtils.asBool(e.isGlyph)?r=1:s.JsonUtils.asBool(e.isTileSection)&&(r=2);const n=new c.RenderTexture.Params(name,r);return this._system.createTextureFromImage(t,2===l,this._iModel,n)})}}e.Reader=Reader}(t.DgnTileIO||(t.DgnTileIO={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(88),i=r(178),o=r(77),s=r(177),a=r(0),c=r(26),l=r(63),u=r(4),d=r(3);!function(e){let t;!function(e){e[e.None=0]="None",e[e.ContainsCurves=1]="ContainsCurves",e[e.Incomplete=4]="Incomplete"}(t=e.Flags||(e.Flags={}));class Header extends n.TileIO.Header{constructor(e){super(e),this.flags=e.nextUint32,this.contentRange=u.ElementAlignedBox3d.createFromPoints(e.nextPoint3d64,e.nextPoint3d64),this.tolerance=e.nextFloat64,this.numElementsIncluded=e.nextUint32,this.numElementsExcluded=e.nextUint32,this.length=e.nextUint32,e.isPastTheEnd&&this.invalidate()}get isValid(){return 1818512745===this.format}}e.Header=Header;class FeatureTableHeader{constructor(e,t,r){this.length=e,this.maxFeatures=t,this.count=r}static readFrom(e){const t=e.nextUint32,r=e.nextUint32,n=e.nextUint32;return e.isPastTheEnd?void 0:new FeatureTableHeader(t,r,n)}}FeatureTableHeader.sizeInBytes=12;const r=1,h=100;class Reader extends i.GltfTileIO.Reader{constructor(e,t,r,n,i,o,s,a){super(e,t,r,n,i,o,s),this._sizeMultiplier=a}static create(e,t,r,n,o,s=0,a,c){if(!new Header(e).isValid)return;if(!this.skipFeatureTable(e))return;const l=i.GltfTileIO.ReaderProps.create(e,!1);return void 0!==l?new Reader(l,t,r,n,o,s,a,c):void 0}async read(){this._buffer.reset();const e=new Header(this._buffer);let t=!0;if(!e.isValid)return{readStatus:2,isLeaf:t};const n=this.readFeatureTable();if(void 0===n)return{readStatus:5,isLeaf:t};if(await this.loadNamedTextures(),this._isCanceled)return Promise.resolve({readStatus:6,isLeaf:t});t=!1;let i=this._sizeMultiplier;const o=0===(4&e.flags);if(o&&0===e.numElementsIncluded&&0===e.numElementsExcluded||this._isClassifier)t=!0;else{if(e.tolerance<=r)if(o&&0===e.numElementsExcluded&&e.numElementsIncluded<=h){0!==(1&e.flags)?void 0===i&&(i=1):t=!0}else void 0===i&&e.numElementsIncluded+e.numElementsExcluded<=h&&(i=1)}return Promise.resolve(this.finishRead(t,n,e.contentRange,i))}extractReturnToCenter(e){}readColorTable(e,t){return!1}createDisplayParams(e){const t=a.JsonUtils.asInt(e.type,o.DisplayParams.Type.Mesh),r=new u.ColorDef(a.JsonUtils.asInt(e.lineColor)),n=new u.ColorDef(a.JsonUtils.asInt(e.fillColor)),i=a.JsonUtils.asInt(e.lineWidth),s=a.JsonUtils.asInt(e.linePixels,0),c=a.JsonUtils.asInt(e.fillFlags,u.FillFlags.None),l=a.JsonUtils.asBool(e.ignoreLighting),d=e.materialId,h=void 0!==d?this.materialFromJson(d):void 0;let p;if(!h){const t=e.texture;if(void 0===(p=void 0!==t?this.textureMappingFromJson(t):void 0)){const t=e.gradient,r=void 0!==t?u.Gradient.Symb.fromJSON(t):void 0;if(void 0!==r){const e=this._system.getGradientTexture(r,this._iModel);void 0!==e&&(p=new u.TextureMapping(e,new u.TextureMapping.Params({textureMat2x3:new u.TextureMapping.Trans2x3(0,1,0,1,0,0)})))}}}return new o.DisplayParams(t,r,n,i,s,c,h,void 0,l,p)}colorDefFromMaterialJson(e){return void 0!==e?u.ColorDef.from(255*e[0]+.5,255*e[1]+.5,255*e[2]+.5):void 0}materialFromJson(e){if(void 0===this._renderMaterials||void 0===this._renderMaterials[e])return;let t=this._system.findMaterial(e,this._iModel);if(!t){const r=this._renderMaterials[e],n=new u.RenderMaterial.Params(e);n.diffuseColor=this.colorDefFromMaterialJson(r.diffuseColor),void 0!==r.diffuse&&(n.diffuse=a.JsonUtils.asDouble(r.diffuse)),n.specularColor=this.colorDefFromMaterialJson(r.specularColor),void 0!==r.specular&&(n.specular=a.JsonUtils.asDouble(r.specular)),n.reflectColor=this.colorDefFromMaterialJson(r.reflectColor),void 0!==r.reflect&&(n.reflect=a.JsonUtils.asDouble(r.reflect)),void 0!==r.specularExponent&&(n.specularExponent=r.specularExponent),void 0!==r.transparency&&(n.transparency=r.transparency),n.refract=a.JsonUtils.asDouble(r.refract),n.shadows=a.JsonUtils.asBool(r.shadows),n.ambient=a.JsonUtils.asDouble(r.ambient),void 0!==r.textureMapping&&(n.textureMapping=this.textureMappingFromJson(r.textureMapping.texture)),t=this._system.createMaterial(n,this._iModel)}return t}textureMappingFromJson(e){if(void 0===e)return;const t=a.JsonUtils.asString(e.name),r=0!==t.length?this._namedTextures[t]:void 0,n=void 0!==r?r.renderTexture:void 0;if(void 0===n)return;const i=e.params,o=i.transform,s={textureMat2x3:new u.TextureMapping.Trans2x3(o[0][0],o[0][1],o[0][2],o[1][0],o[1][1],o[1][2]),textureWeight:a.JsonUtils.asDouble(i.weight,1),mapMode:a.JsonUtils.asInt(i.mode),worldMapping:a.JsonUtils.asBool(i.worldMapping)};return new u.TextureMapping(n,new u.TextureMapping.Params(s))}async loadNamedTextures(){if(void 0===this._namedTextures)return Promise.resolve();const e=new Array;for(const t of Object.keys(this._namedTextures))e.push(this.loadNamedTexture(t));return e.length>0?Promise.all(e).then(e=>void 0):Promise.resolve()}async loadNamedTexture(e){if(this._isCanceled)return Promise.resolve();const t=this._namedTextures[e];if(void 0===t)return Promise.resolve();const r=this._system.findTexture(e,this._iModel);return void 0!==r?(t.renderTexture=r,Promise.resolve()):this.readNamedTexture(t,e).then(e=>{t.renderTexture=e})}async readNamedTexture(e,t){const r=a.JsonUtils.asString(e.bufferView),n=0!==r.length?this._bufferViews[r]:void 0;if(void 0===n)return Promise.resolve(void 0);const i=a.JsonUtils.asInt(n.byteOffset),o=a.JsonUtils.asInt(n.byteLength);if(0===o)return Promise.resolve(void 0);const s=this._binaryData.subarray(i,i+o),c=e.format,d=new u.ImageSource(s,c);return l.imageElementFromImageSource(d).then(r=>{if(this._isCanceled)return;let n=0;a.JsonUtils.asBool(e.isGlyph)?n=1:a.JsonUtils.asBool(e.isTileSection)&&(n=2);const i=new u.RenderTexture.Params(e.isGlyph?void 0:t,n);return this._system.createTextureFromImage(r,2===c,this._iModel,i)})}readFeatureTable(){const e=this._buffer.curPos,t=FeatureTableHeader.readFrom(this._buffer);if(void 0===t||0!==t.length%4)return;const r=(t.length-FeatureTableHeader.sizeInBytes)/4,n=new Uint32Array(this._buffer.nextUint32s(r));return this._buffer.isPastTheEnd?void 0:(this._buffer.curPos=e+t.length,new c.PackedFeatureTable(n,this._modelId,t.count,t.maxFeatures,this._type))}static skipFeatureTable(e){const t=e.curPos,r=FeatureTableHeader.readFrom(e);return void 0!==r&&(e.curPos=t+r.length),void 0!==r}readMeshGraphic(e){const t=a.JsonUtils.asString(e.material),r=0<t.length?a.JsonUtils.asObject(this._materialValues[t]):void 0,n=void 0!==r?this.createDisplayParams(r):void 0;if(void 0===n)return;const i=this.readVertexTable(e);if(void 0===i)return;const o=a.JsonUtils.asBool(e.isPlanar);switch(a.JsonUtils.asInt(e.type,0)){case 0:return this.createMeshGraphic(e,n,i,o);case 1:return this.createPolylineGraphic(e,n,i,o);case 2:return this.createPointStringGraphic(e,n,i)}}findBuffer(e){if("string"!==typeof e||0===e.length)return;const t=this._bufferViews[e];if(void 0===t)return;const r=a.JsonUtils.asInt(t.byteOffset),n=a.JsonUtils.asInt(t.byteLength);return 0!==n?this._binaryData.subarray(r,r+n):void 0}readVertexTable(e){const t=e.vertices;if(void 0===t)return;const r=this.findBuffer(a.JsonUtils.asString(t.bufferView));if(void 0===r)return;const n=void 0!==t.featureID?a.JsonUtils.asInt(t.featureID):void 0,i=a.JsonUtils.asArray(t.params.decodedMin),o=a.JsonUtils.asArray(t.params.decodedMax);if(void 0===i||void 0===o)return;const c=u.QParams3d.fromRange(d.Range3d.create(d.Point3d.create(i[0],i[1],i[2]),d.Point3d.create(o[0],o[1],o[2]))),l=void 0!==t.uniformColor?u.ColorDef.fromJSON(t.uniformColor):void 0;let h,p,f,g;if(void 0!==e.surface&&void 0!==e.surface.uvParams){const t=a.JsonUtils.asArray(e.surface.uvParams.decodedMin),r=a.JsonUtils.asArray(e.surface.uvParams.decodedMax);if(void 0===t||void 0===r)return;const n=new d.Range2d(t[0],t[1],r[0],r[1]);h=u.QParams2d.fromRange(n)}if(void 0!==t.auxDisplacements){p=[];for(const e of t.auxDisplacements)p.push(new s.AuxDisplacement({name:e.name,qOrigin:e.qOrigin,qScale:e.qScale,inputs:e.inputs,indices:e.indices}))}if(void 0!==t.auxNormals){f=[];for(const e of t.auxNormals)f.push(new s.AuxNormal({name:e.name,inputs:e.inputs,indices:e.indices}))}if(void 0!==t.auxParams){g=[];for(const e of t.auxParams)g.push(new s.AuxParam({name:e.name,qOrigin:e.qOrigin,qScale:e.qScale,inputs:e.inputs,indices:e.indices}))}return new s.VertexTable({data:r,qparams:c,width:t.width,height:t.height,hasTranslucency:t.hasTranslucency,uniformColor:l,featureIndexType:t.featureIndexType,uniformFeatureID:n,numVertices:t.count,numRgbaPerVertex:t.numRgbaPerVertex,uvParams:h,auxDisplacements:p,auxNormals:f,auxParams:g})}readVertexIndices(e){const t=this.findBuffer(e);return void 0!==t?new s.VertexIndices(t):void 0}createPointStringGraphic(e,t,r){const n=this.readVertexIndices(e.indices);if(void 0===n)return;const i=new s.PointStringParams(r,n,t.width);return this._system.createPointString(i)}readTesselatedPolyline(e){const t=this.readVertexIndices(e.indices),r=this.readVertexIndices(e.prevIndices),n=this.findBuffer(e.nextIndicesAndParams),i=this.findBuffer(e.distances);if(void 0!==t&&void 0!==r&&void 0!==n&&void 0!==i)return{indices:t,prevIndices:r,nextIndicesAndParams:n,distances:new Float32Array(i.buffer)}}createPolylineGraphic(e,t,r,n){const i=this.readTesselatedPolyline(e);if(void 0===i)return;let a=u.PolylineTypeFlags.Normal;o.DisplayParams.RegionEdgeType.Outline===t.regionEdgeType&&(a=void 0===t.gradient||t.gradient.isOutlined?u.PolylineTypeFlags.Edge:u.PolylineTypeFlags.Outline);const c=new s.PolylineParams(r,i,t.width,t.linePixels,n,a);return this._system.createPolyline(c)}readSurface(e,t){const r=e.surface;if(void 0===r)return;const n=this.readVertexIndices(r.indices);if(void 0===n)return;const i=a.JsonUtils.asInt(r.type,-1);if(!s.isValidSurfaceType(i))return;const o=void 0!==t.textureMapping?t.textureMapping.texture:void 0;return{type:i,indices:n,fillFlags:t.fillFlags,hasBakedLighting:this._hasBakedLighting,material:t.material,texture:o}}readSegmentEdges(e){const t=this.readVertexIndices(e.indices),r=this.findBuffer(e.endPointAndQuadIndices);return void 0!==t&&void 0!==r?{indices:t,endPointAndQuadIndices:r}:void 0}readSilhouettes(e){const t=this.readSegmentEdges(e),r=this.findBuffer(e.normalPairs);return void 0!==t&&void 0!==r?{normalPairs:r,indices:t.indices,endPointAndQuadIndices:t.endPointAndQuadIndices}:void 0}readEdges(e,t){let r,n,i,o,s=!1;return void 0!==e.segments&&void 0===(r=this.readSegmentEdges(e.segments))?{succeeded:s}:void 0!==e.silhouettes&&void 0===(n=this.readSilhouettes(e.silhouettes))?{succeeded:s}:void 0!==e.polylines&&void 0===(i=this.readTesselatedPolyline(e.polylines))?{succeeded:s}:(s=!0,void 0===r&&void 0===n&&void 0===i||(o={segments:r,silhouettes:n,polylines:i,weight:t.width,linePixels:t.linePixels}),{succeeded:s,params:o})}createMeshGraphic(e,t,r,n){const i=this.readSurface(e,t);if(void 0===i)return;let o;if(void 0!==e.edges&&4!==i.type){const r=this.readEdges(e.edges,t);if(!r.succeeded)return;o=r.params}const a=new s.MeshParams(r,i,o,n);return this._system.createMesh(a)}finishRead(e,t,r,n){const i=[];for(const s of Object.keys(this._meshes)){const e=this._meshes[s],t=a.JsonUtils.asArray(e.primitives);if(void 0!==t)for(const r of t){const e=this.readMeshGraphic(r);void 0!==e&&i.push(e)}}let o;switch(i.length){case 0:break;case 1:o=i[0];break;default:o=this._system.createGraphicList(i)}return void 0!==o&&(o=this._system.createBatch(o,t,r)),{readStatus:0,isLeaf:e,sizeMultiplier:n,contentRange:r.isNull?void 0:r,renderGraphic:o}}}e.Reader=Reader}(t.IModelTileIO||(t.IModelTileIO={}))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(513)),n(r(136)),n(r(180)),n(r(517)),n(r(518)),n(r(294))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(514)),n(r(515)),n(r(516))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(180),i=r(136);class Format{constructor(e){this._name="",this._roundFactor=0,this._type=0,this._precision=6,this._showSignOption=1,this._decimalSeparator=i.QuantityConstants.LocaleSpecificDecimalSeparator,this._thousandSeparator=i.QuantityConstants.LocaleSpecificThousandSeparator,this._uomSeparator=" ",this._stationSeparator="+",this._formatTraits=0,this._spacer=" ",this._includeZero=!0,this._name=e}get name(){return this._name}get roundFactor(){return this._roundFactor}get type(){return this._type}get precision(){return this._precision}get minWidth(){return this._minWidth}get scientificType(){return this._scientificType}get showSignOption(){return this._showSignOption}get decimalSeparator(){return this._decimalSeparator}get thousandSeparator(){return this._thousandSeparator}get uomSeparator(){return this._uomSeparator}get stationSeparator(){return this._stationSeparator}get stationOffsetSize(){return this._stationOffsetSize}get formatTraits(){return this._formatTraits}get spacer(){return this._spacer}get includeZero(){return this._includeZero}get units(){return this._units}get hasUnits(){return void 0!==this._units&&this._units.length>0}static scientificTypeToString(e){return 0===e?"Normalized":"ZeroNormalized"}static parseScientificType(e,t){switch(e){case"normalized":return 0;case"zeronormalized":return 1;default:throw new n.QuantityError(35040,`The Format ${t} has an invalid 'SCIENTIFIC_TYPE' attribute.`)}}static showSignOptionToString(e){switch(e){case 3:return"NegativeParentheses";case 0:return"NoSign";case 1:return"OnlyNegative";case 2:return"SignAlways"}}static parseShowSignOption(e,t){switch(e.toLowerCase()){case"nosign":return 0;case"onlynegative":return 1;case"signalways":return 2;case"negativeparentheses":return 3;default:throw new n.QuantityError(35040,`The Format ${t} has an invalid 'showSignOption' attribute.`)}}static formatTraitsToArray(e){const t=Array();return 1===(1&e)&&t.push("trailZeroes"),2===(2&e)&&t.push("keepSingleZero"),4===(4&e)&&t.push("zeroEmpty"),8===(8&e)&&t.push("keepDecimalPoint"),16===(16&e)&&t.push("applyRounding"),32===(32&e)&&t.push("fractionDash"),64===(64&e)&&t.push("showUnitLabel"),128===(128&e)&&t.push("prependUnitLabel"),256===(256&e)&&t.push("use1000Separator"),512===(512&e)&&t.push("exponentOnlyNegative"),t}static parseFormatTrait(e,t){let r=t;switch(e.toLowerCase()){case"trailzeroes":r=1|t;break;case"keepsinglezero":r=2|t;break;case"zeroempty":r=4|t;break;case"keepdecimalpoint":r=8|t;break;case"applyrounding":r=16|t;break;case"fractiondash":r=32|t;break;case"showunitlabel":r=64|t;break;case"prependunitlabel":r=128|t;break;case"use1000separator":r=256|t;break;case"exponentonlynegative":r=512|t;break;default:throw new n.QuantityError(35040,"Format has an invalid 'formatTraits' option.")}return r}static formatTypeToString(e){switch(e){case 0:return"Decimal";case 2:return"Scientific";case 3:return"Station";case 1:return"Fractional"}}static parseFormatType(e,t){switch(e.toLowerCase()){case"decimal":return 0;case"scientific":return 2;case"station":return 3;case"fractional":return 1;default:throw new n.QuantityError(35040,`The Format ${t} has an invalid 'type' attribute.`)}}static parseDecimalPrecision(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9;case 10:return 10;case 11:return 11;case 12:return 12;default:throw new n.QuantityError(35040,"The 'precision' attribute must be an integer in the range 0-12.")}}static parseFractionalPrecision(e,t){switch(e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:return 256;default:throw new n.QuantityError(35040,`The Format ${t} has an invalid 'precision' attribute.`)}}static parsePrecision(e,t,r){switch(r){case 0:case 2:case 3:return Format.parseDecimalPrecision(e);case 1:return Format.parseFractionalPrecision(e,t)}}verifyFormatTraitsOptions(e){(Array.isArray(e)?e:e.split(/,|;|\|/)).forEach(e=>{this._formatTraits=Format.parseFormatTrait(e,this.formatTraits)})}hasFormatTraitSet(e){return(this._formatTraits&e)===e}async createUnit(e,t,r){let i;if(void 0===t||"string"!==typeof t||void 0!==r&&"string"!==typeof r)return Promise.reject(new n.QuantityError(35040,"This Composite has a unit with an invalid 'name' or 'label' attribute."));for(const o of this.units){const e=o[0].name;if(e.toLowerCase()===t.toLowerCase())return Promise.reject(new n.QuantityError(35040,`The unit ${e} has a duplicate name.`))}if(!(i=await e.findUnit(t))||!i.isValid)return Promise.reject(new n.QuantityError(35040,`Invalid unit name '${t}'.`));this.units.push([i,r])}loadFormatProperties(e){if(void 0===e.type)throw new n.QuantityError(35040,`The Format ${this.name} does not have the required 'type' attribute.`);if("string"!==typeof e.type)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'type' attribute. It should be of type 'string'.`);if(this._type=Format.parseFormatType(e.type,this.name),void 0===e.precision)throw new n.QuantityError(35040,`The Format ${this.name} does not have the required 'precision' attribute.`);if("number"!==typeof e.precision)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'precision' attribute. It should be of type 'number'.`);if(!Number.isInteger(e.precision))throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'precision' attribute. It should be an integer.`);if(this._precision=Format.parsePrecision(e.precision,this.name,this._type),2===this.type){if(void 0===e.scientificType)throw new n.QuantityError(35040,`The Format ${this.name} has type 'Scientific' therefore attribute 'scientificType' is required.`);if("string"!==typeof e.scientificType)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'scientificType' attribute. It should be of type 'string'.`);this._scientificType=Format.parseScientificType(e.scientificType.toLowerCase(),this.name)}if(3===this.type){if(void 0===e.stationOffsetSize)throw new n.QuantityError(35040,`The Format ${this.name} has type 'Station' therefore attribute 'stationOffsetSize' is required.`);if("number"!==typeof e.stationOffsetSize)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'stationOffsetSize' attribute. It should be of type 'number'.`);if(!Number.isInteger(e.stationOffsetSize)||e.stationOffsetSize<=0)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'stationOffsetSize' attribute. It should be a positive integer.`);this._stationOffsetSize=e.stationOffsetSize}if(void 0!==e.roundFactor){if("number"!==typeof e.roundFactor)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'roundFactor' attribute. It should be of type 'number'.`);e.roundFactor!==this.roundFactor&&(this._roundFactor=e.roundFactor)}if(void 0!==e.minWidth){if("number"!==typeof e.minWidth)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'minWidth' attribute. It should be of type 'number'.`);if(!Number.isInteger(e.minWidth)||e.minWidth<0)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'minWidth' attribute. It should be a positive integer.`);this._minWidth=e.minWidth}if(void 0!==e.showSignOption){if("string"!==typeof e.showSignOption)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'showSignOption' attribute. It should be of type 'string'.`);this._showSignOption=Format.parseShowSignOption(e.showSignOption,this.name)}if(void 0!==e.formatTraits&&0!==e.formatTraits.length){if(!Array.isArray(e.formatTraits)&&"string"!==typeof e.formatTraits)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'formatTraits' attribute. It should be of type 'string' or 'string[]'.`);this.verifyFormatTraitsOptions(e.formatTraits)}if(void 0!==e.decimalSeparator){if("string"!==typeof e.decimalSeparator)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'decimalSeparator' attribute. It should be of type 'string'.`);if(1!==e.decimalSeparator.length)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'decimalSeparator' attribute. It must be a one character string.`);this._decimalSeparator=e.decimalSeparator}if(void 0!==e.thousandSeparator){if("string"!==typeof e.thousandSeparator)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'thousandSeparator' attribute. It should be of type 'string'.`);if(1!==e.thousandSeparator.length)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'thousandSeparator' attribute. It must be a one character string.`);this._thousandSeparator=e.thousandSeparator}if(void 0!==e.uomSeparator){if("string"!==typeof e.uomSeparator)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'uomSeparator' attribute. It should be of type 'string'.`);if(e.uomSeparator.length<0||e.uomSeparator.length>1)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'uomSeparator' attribute. It must be empty or a string with a single character.`);this._uomSeparator=e.uomSeparator}if(void 0!==e.stationSeparator){if("string"!==typeof e.stationSeparator)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'stationSeparator' attribute. It should be of type 'string'.`);if(1!==e.stationSeparator.length)throw new n.QuantityError(35040,`The Format ${this.name} has an invalid 'stationSeparator' attribute. It must be a one character string.`);this._stationSeparator=e.stationSeparator}}async fromJson(e,t){if(this.loadFormatProperties(t),void 0!==t.composite){if(this._units=new Array,void 0!==t.composite.includeZero){if("boolean"!==typeof t.composite.includeZero)return Promise.reject(new n.QuantityError(35040,`The Format ${this.name} has a Composite with an invalid 'includeZero' attribute. It should be of type 'boolean'.`));this._includeZero=t.composite.includeZero}if(void 0!==t.composite.spacer){if("string"!==typeof t.composite.spacer)return Promise.reject(new n.QuantityError(35040,`The Format ${this.name} has a Composite with an invalid 'spacer' attribute. It must be of type 'string'.`));if(t.composite.spacer.length<0||t.composite.spacer.length>1)return Promise.reject(new n.QuantityError(35040,`The Format ${this.name} has a Composite with an invalid 'spacer' attribute. It must be empty or a string with a single character.`));this._spacer=t.composite.spacer}if(void 0!==t.composite.units){if(!Array.isArray(t.composite.units))return Promise.reject(new n.QuantityError(35040,`The Format ${this.name} has a Composite with an invalid 'units' attribute. It must be of type 'array'`));if(t.composite.units.length>0&&t.composite.units.length<=4)try{const r=[];for(const n of t.composite.units)r.push(this.createUnit(e,n.name,n.label));await Promise.all(r)}catch(e){return Promise.reject(e)}}if(void 0===this.units||0===this.units.length)return Promise.reject(new n.QuantityError(35040,`The Format ${this.name} has a Composite with no valid 'units'`))}}toJson(){const e={};if(e.type=Format.formatTypeToString(this.type),e.precision=this.precision,e.roundFactor=this.roundFactor,void 0!==this.minWidth&&(e.minWidth=this.minWidth),e.showSignOption=Format.showSignOptionToString(this.showSignOption),e.formatTraits=Format.formatTraitsToArray(this.formatTraits),e.decimalSeparator=this.decimalSeparator,e.thousandSeparator=this.thousandSeparator,e.uomSeparator=this.uomSeparator,void 0!==this.scientificType&&(e.scientificType=Format.scientificTypeToString(this.scientificType)),void 0!==this.stationOffsetSize&&(e.stationOffsetSize=this.stationOffsetSize),e.stationSeparator=this.stationSeparator,void 0!==this.units){const t={};t.spacer=this.spacer,t.includeZero=this.includeZero,t.units=[],this.units.forEach(e=>{void 0!==e[1]?t.units.push({name:e[0].name,label:e[1]}):t.units.push({name:e[0].name})}),e.composite=t}return e}}t.Format=Format;class FormatterSpec{constructor(e,t,r){this._name="",this._conversions=[],this._name=e,this._format=t,r&&(this._conversions=r)}get name(){return this._name}get unitConversions(){return this._conversions}get format(){return this._format}static async create(e,t,r,n){const i=[];if(t.units){let e=n;for(const n of t.units){let t;t=e?await r.getConversion(e,n[0]):{factor:1,offset:0};const o=n[1]&&n[1].length>0?n[1]:n[0].label,s={name:n[0].name,label:o,conversion:t};i.push(s),e=n[0]}}else if(n){const e={name:n.name,label:n.label,conversion:{factor:1,offset:0}};i.push(e)}return Promise.resolve(new FormatterSpec(e,t,i))}}t.FormatterSpec=FormatterSpec},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TrailZeroes=1]="TrailZeroes",e[e.KeepSingleZero=2]="KeepSingleZero",e[e.ZeroEmpty=4]="ZeroEmpty",e[e.KeepDecimalPoint=8]="KeepDecimalPoint",e[e.ApplyRounding=16]="ApplyRounding",e[e.FractionDash=32]="FractionDash",e[e.ShowUnitLabel=64]="ShowUnitLabel",e[e.PrependUnitLabel=128]="PrependUnitLabel",e[e.Use1000Separator=256]="Use1000Separator",e[e.ExponentOnlyNegative=512]="ExponentOnlyNegative"}(t.FormatTraits||(t.FormatTraits={})),function(e){e[e.One=1]="One",e[e.Two=2]="Two",e[e.Four=4]="Four",e[e.Eight=8]="Eight",e[e.Sixteen=16]="Sixteen",e[e.ThirtyTwo=32]="ThirtyTwo",e[e.SixtyFour=64]="SixtyFour",e[e.OneHundredTwentyEight=128]="OneHundredTwentyEight",e[e.TwoHundredFiftySix=256]="TwoHundredFiftySix"}(t.FractionalPrecision||(t.FractionalPrecision={})),function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven",e[e.Eight=8]="Eight",e[e.Nine=9]="Nine",e[e.Ten=10]="Ten",e[e.Eleven=11]="Eleven",e[e.Twelve=12]="Twelve"}(t.DecimalPrecision||(t.DecimalPrecision={})),function(e){e[e.Decimal=0]="Decimal",e[e.Fractional=1]="Fractional",e[e.Scientific=2]="Scientific",e[e.Station=3]="Station"}(t.FormatType||(t.FormatType={})),function(e){e[e.Normalized=0]="Normalized",e[e.ZeroNormalized=1]="ZeroNormalized"}(t.ScientificType||(t.ScientificType={})),function(e){e[e.NoSign=0]="NoSign",e[e.OnlyNegative=1]="OnlyNegative",e[e.SignAlways=2]="SignAlways",e[e.NegativeParentheses=3]="NegativeParentheses"}(t.ShowSignOption||(t.ShowSignOption={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(136),i=r(180),o=1e-14,s=.50000000001;class FractionalNumeric{constructor(e,t,r){this._integral=0,this._numerator=0,this._denominator=1,this._greatestCommonFactor=1,this._textParts=[],this.calculate(e,t),this.formTextParts(r)}calculate(e,t){const r=Math.abs(e);this._denominator=t,this._integral=Math.floor(r);const n=r-this._integral;this._numerator=Math.floor(n*this._denominator+s),0!==t&&this._numerator/this._denominator===1?(this._numerator=0,this._integral+=1):this._greatestCommonFactor=this.getGreatestCommonFactor(this._numerator,this._denominator)}getGreatestCommonFactor(e,t){let r;for(;0!==t;)r=e%t,e=t,t=r;return e<0?-e:e}get greatestCommonFactor(){return this._greatestCommonFactor}get hasFractionPart(){return this._textParts.length>0}get isZero(){return 0===this._numerator}getIntegralString(){return this._textParts.length>0?this._textParts[0]:""}getNumeratorString(){return this._textParts.length>=3?this._textParts[1]:""}getDenominatorString(){return this._textParts.length>=3?this._textParts[2]:""}formTextParts(e){let t=this._numerator,r=this._denominator;e&&this._greatestCommonFactor>1&&(t/=this.greatestCommonFactor,r/=this.greatestCommonFactor),this._textParts.push(this._integral.toFixed(0)),t>0&&(this._textParts.push(t.toFixed(0)),this._textParts.push(r.toFixed(0)))}}class Formatter{static isNegligible(e){return Math.abs(e)<o}static roundDouble(e,t){if(Formatter.isNegligible(t))return e;t=Math.abs(t);let r=s+e/t;return r=Math.floor(r)*t,e<0?-r:r}static integerPartToText(e,t){let r=e.toFixed(0);if(r.length>3&&t.format.hasFormatTraitSet(256)&&t.format.thousandSeparator.length>0){let e=Math.floor(r.length/3),n=r.length%3;0===n&&(e-=1,n+=3);let i=r.substr(0,n);for(let o=1;o<=e;o+=1)i=i+t.format.thousandSeparator+r.substr(n,3),n+=3;r=i}return r}static trimTrailingZeroes(e){let t=-1;for(let r=e.length-1;r>=0;r--)if(e.charCodeAt(r)!==n.QuantityConstants.CHAR_DIGIT_ZERO){t=r;break}return t>=0?e.substr(0,t+1):""}static formatCompositePart(e,t,r,n){let i="";return i=t?Formatter.formatMagnitude(e,n):Formatter.integerPartToText(e,n),n.format.hasFormatTraitSet(64)?i=i+n.format.uomSeparator+r:t||(i+=":"),i}static formatComposite(e,t){const r=[];let n=Math.abs(e);if(Math.abs(n)<1e-4&&t.format.hasFormatTraitSet(4))return"";for(let o=0;o<t.unitConversions.length;o++){const e=t.unitConversions[o].label,s=t.unitConversions[o].conversion;if(s.factor<1)throw new i.QuantityError(35041,`The Format ${t.format.name} has a invalid unit specification..`);if(o>0&&0!==s.offset)throw new i.QuantityError(35041,`The Format ${t.format.name} has a invalid unit specification..`);const a=n*s.factor+s.offset;if(o<t.format.units.length-1){const i=Math.floor(a),o=Formatter.formatCompositePart(i,!1,e,t);n=a-i,r.push(o)}else{const n=Formatter.formatCompositePart(a,!0,e,t);r.push(n)}}return r.join(t.format.spacer?t.format.spacer:"")}static formatMagnitude(e,t){let r=Math.abs(e);if(Math.abs(r)<1e-4&&t.format.hasFormatTraitSet(4))return"";t.format.hasFormatTraitSet(16)&&(r=Math.abs(Formatter.roundDouble(e,t.format.roundFactor)));const n=r>1e12||2===t.format.type,i=n||0===t.format.type,a=!i&&1===t.format.type,c=0===t.format.precision,l=t.format.hasFormatTraitSet(2),u=Math.pow(10,t.format.precision),d=t.format.hasFormatTraitSet(1);let h=0;if(n&&0!==r){let e=Math.log10(r),n=!1;e<0&&(e=-e,n=!0),h=Math.floor(e),2===t.format.type&&(1===t.format.scientificType&&r>1?h+=1:0===t.format.scientificType&&r<1&&(h+=1),n&&(h=-h)),r*=Math.pow(10,-h)}let p="";if(i){const e=c?r+s:r+o;let i=Math.floor(e),a=e-i;if(c||(a=Math.abs(a)*u+s)>=u&&(i+=1,a-=u),p=Formatter.integerPartToText(i,t),c)l&&(p=p+t.format.decimalSeparator+"0");else{let e=(a=Math.floor(a)/u).toFixed(t.format.precision);e=e.substr(2).padEnd(t.format.precision,"0"),d||(e=Formatter.trimTrailingZeroes(e)),e.length>0?p=p+t.format.decimalSeparator+e:t.format.hasFormatTraitSet(8)&&(p+=t.format.decimalSeparator)}if(n){p+="e"+h.toFixed(0)}}else if(a){const e=new FractionalNumeric(r,t.format.precision,!0);if(p=e.getIntegralString(),!e.isZero&&e.hasFractionPart){p=p+(t.format.hasFormatTraitSet(32)?"-":" ")+(e.getNumeratorString()+"/"+e.getDenominatorString())}}else{const e=Math.pow(10,t.format.stationOffsetSize),n=Math.floor(r),i=Math.floor(n/e),o=n-i*e,s=r-n,a=Math.floor(.5+s*u),c=i.toFixed(0)+t.format.stationSeparator+o.toFixed(0).padStart(t.format.stationOffsetSize,"0");let l="";a>0?(l=a.toFixed(0).padEnd(t.format.precision,"0"),d||(l=Formatter.trimTrailingZeroes(l)),p=c+t.format.decimalSeparator+l):(d?l=t.format.decimalSeparator+"".padEnd(t.format.precision,"0"):t.format.hasFormatTraitSet(8)&&(l=t.format.decimalSeparator),p=c+l)}return p}static formatQuantity(e,t){const r=e<0;let n="",i="",o="";switch(t.format.showSignOption){case 3:r&&(n="(",i=")");break;case 1:r&&(n="-");break;case 2:n=r?"-":"+"}let s="";return t.format.hasUnits?s=Formatter.formatComposite(e,t):(s=Formatter.formatMagnitude(e,t)).length>0&&t.unitConversions.length>0&&t.format.hasFormatTraitSet(64)&&(s=t.format.hasFormatTraitSet(128)?t.unitConversions[0].label+t.format.uomSeparator+s:s+t.format.uomSeparator+t.unitConversions[0].label),o=(n.length>0||i.length>0)&&s.length>0?n+s+i:s,t.format.minWidth&&t.format.minWidth<o.length&&o.padStart(t.format.minWidth," "),o}}t.Formatter=Formatter},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BadUnit=class BadUnit{constructor(){this.name="",this.label="",this.unitFamily="",this.isValid=!1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(136),i=r(294);class ParseToken{constructor(e){this.value="string"===typeof e?e.trim():e}get isString(){return"string"===typeof this.value}get isNumber(){return"number"===typeof this.value}}class ScientificToken{constructor(e,t){this.exponent="",this.index=e,t&&(this.exponent=t)}}class FractionToken{constructor(e,t){this.fraction=0,this.exponent="",this.index=e,t&&(this.fraction=t)}}class Parser{static checkForScientificNotation(e,t,r){let i="",o=e+1;for(;o<t.length;o++){const s=t.charCodeAt(o);if(!Parser.isDigit(s)&&(s!==n.QuantityConstants.CHAR_MINUS&&s!==n.QuantityConstants.CHAR_PLUS||o!==e+1)){o=r===s?o:o-1;break}i=i.concat(t[o])}return i.length>1||1===i.length&&i.charCodeAt(0)!==n.QuantityConstants.CHAR_MINUS&&i.charCodeAt(0)!==n.QuantityConstants.CHAR_PLUS?new ScientificToken(o,i):new ScientificToken(e)}static checkForFractions(e,t,r,i){let o="",s="",a=!0,c=e;for(i&&i.length>0&&(o=i,a=!1);c<t.length;c++){const e=t.charCodeAt(c);if(Parser.isDigit(e))a?o=o.concat(t[c]):s=s.concat(t[c]);else{if(!a||e!==n.QuantityConstants.CHAR_SLASH&&e!==n.QuantityConstants.CHAR_DIVISION_SLASH&&e!==n.QuantityConstants.CHAR_DIVISION_SLASH){r!==e&&(c-=1);break}a=!1}}if(o.length>0&&s.length>0){const e=parseInt(o,10),t=parseInt(s,10);return t>0?new FractionToken(c,e/t):new FractionToken(c)}return new FractionToken(e+1)}static isDigit(e){return e>=n.QuantityConstants.CHAR_DIGIT_ZERO&&e<=n.QuantityConstants.CHAR_DIGIT_NINE}static isDigitOrDecimalSeparator(e,t){return e===t.decimalSeparator.charCodeAt(0)||Parser.isDigit(e)}static parseQuantitySpecification(e,t){const r=[],i=e.trim();let o=!1,s="",a="",c=0,l=0;const u=[t.thousandSeparator.charCodeAt(0)];3===t.type&&t.stationSeparator&&1===t.stationSeparator.length&&u.push(t.stationSeparator.charCodeAt(0)),1===t.type&&t.hasFormatTraitSet(32)&&(l=n.QuantityConstants.CHAR_MINUS),t.uomSeparator&&" "!==t.uomSeparator&&1===t.uomSeparator.length&&(c=t.uomSeparator.charCodeAt(0),u.push(c));for(let d=0;d<i.length;d++){const e=i.charCodeAt(d);if(Parser.isDigitOrDecimalSeparator(e,t))o||(s.length>0&&(r.push(new ParseToken(s)),s=""),o=!0),s=s.concat(i[d]);else if(o){if(e===n.QuantityConstants.CHAR_SLASH||e===n.QuantityConstants.CHAR_FRACTION_SLASH||e===n.QuantityConstants.CHAR_DIVISION_SLASH){const e=Parser.checkForFractions(d+1,i,c,s);let t=e.fraction;if(d=e.index,0!==e.fraction){s="",a.length>0&&("-"===a&&(t=0-t),a=""),r.push(new ParseToken(t)),o=!1;continue}}else if(e===n.QuantityConstants.CHAR_SPACE||e===l){const e=Parser.checkForFractions(d+1,i,c);let t=e.fraction;if(d=e.index,0!==e.fraction){a.length>0&&(s=a+s,"-"===a&&(t=0-t),a="");const e=parseFloat(s)+t;r.push(new ParseToken(e)),o=!1,s="";continue}}else if(e===n.QuantityConstants.CHAR_UPPER_E||e===n.QuantityConstants.CHAR_LOWER_E){const e=Parser.checkForScientificNotation(d,i,c);if(d=e.index,e.exponent&&e.exponent.length>0){a.length>0&&(s=a+s,a=""),s=s+"e"+e.exponent;const t=Number(s);r.push(new ParseToken(t)),o=!1,s="";continue}}if(-1!==u.findIndex(t=>t===e))continue;a.length>0&&(s=a+s,a=""),r.push(new ParseToken(parseFloat(s))),s=d<i.length?i[d]:"",o=!1}else{if(e===n.QuantityConstants.CHAR_PLUS||e===n.QuantityConstants.CHAR_MINUS){a=i[d];continue}s=s.concat(i[d])}}return s.length>0&&(o?(a.length>0&&(s=a+s,a=""),r.push(new ParseToken(parseFloat(s))),o=!1):r.push(new ParseToken(s))),r}static async createQuantityFromParseTokens(e,t,r){const n=t.units&&t.units.length>0?t.units[0][0]:void 0;if(1===e.length){if(e[0].isNumber)return Promise.resolve(new i.Quantity(n,e[0].value));try{const t=await r.findUnit(e[0].value,n?n.unitFamily:void 0);return Promise.resolve(new i.Quantity(t))}catch(e){}}if(2===e.length){if(e[0].isNumber&&e[1].isString){const t=await r.findUnit(e[1].value,n?n.unitFamily:void 0);return Promise.resolve(new i.Quantity(t,e[0].value))}if(e[1].isNumber&&e[0].isString){const t=await r.findUnit(e[0].value,n?n.unitFamily:void 0);return Promise.resolve(new i.Quantity(t,e[1].value))}}if(e.length%2===0){let t=0,o=n;for(let i=0;i<e.length;i+=2)if(e[i].isNumber&&e[i+1].isString){const s=e[i].value,a=await r.findUnit(e[i+1].value,n?n.unitFamily:void 0);if(0===i)o=a,t+=s;else if(o){const e=await r.getConversion(a,o);t=t<0?t-s*e.factor+e.offset:t+s*e.factor+e.offset}}return Promise.resolve(new i.Quantity(o,t))}return Promise.resolve(new i.Quantity(n))}static parseIntoQuantity(e,t,r){const n=Parser.parseQuantitySpecification(e,t);return 0===n.length?Promise.resolve(new i.Quantity):Parser.createQuantityFromParseTokens(n,t,r)}}t.Parser=Parser},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(4),o=(r(0),r(133));class BranchState{static fromBranch(e,t){const r=t.branch.getViewFlags(e.viewFlags),n=e.transform.multiplyTransformTransform(t.localToWorldTransform),i=void 0!==t.branch.symbologyOverrides?t.branch.symbologyOverrides:e.symbologyOverrides;return new BranchState(r,n,i,t.clips)}static create(e,t,r,o){return new BranchState(i.ViewFlags.createFrom(t),void 0!==r?r.clone():n.Transform.createIdentity(),e,o)}static createForDecorations(){const e=new i.ViewFlags;return e.renderMode=6,e.sourceLights=!1,e.cameraLights=!1,e.solarLight=!1,new BranchState(e,n.Transform.createIdentity(),new o.FeatureSymbology.Overrides)}get viewFlags(){return this._viewFlags}set viewFlags(e){e.clone(this._viewFlags)}get showClipVolume(){return this.viewFlags.clipVolume}constructor(e,t,r,n){this._viewFlags=e,this.transform=t,this.symbologyOverrides=r,this.clipVolume=n}}t.BranchState=BranchState;t.BranchStack=class BranchStack{constructor(e,t){this._stack=[],this.pushState(BranchState.create(new o.FeatureSymbology.Overrides,e,t))}get top(){return this.empty,this._stack[this._stack.length-1]}get bottom(){return this.empty,this._stack[0]}get length(){return this._stack.length}get empty(){return 0===this.length}pushBranch(e){this.length,this.pushState(BranchState.fromBranch(this.top,e))}pushState(e){this._stack.push(e)}pop(){this.empty,this.empty||this._stack.pop()}setViewFlags(e){this.length,this.top.viewFlags=e}setSymbologyOverrides(e){this.length,this.top.symbologyOverrides=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(141),i=r(41),o=r(44),s=r(3),a=r(7),c=r(26),l=r(0),u=r(11),d=r(90),h=r(140),p=r(54);let f,g;function m(e,t){return void 0===f&&(f=new d.ShaderProgramParams,g=new d.DrawParams),f.init(e),g.init(f,t),g}class Textures{dispose(){this.accumulation=l.dispose(this.accumulation),this.revealage=l.dispose(this.revealage),this.color=l.dispose(this.color),this.idLow=l.dispose(this.idLow),this.idHigh=l.dispose(this.idHigh),this.depthAndOrder=l.dispose(this.depthAndOrder),this.hilite=l.dispose(this.hilite)}init(e,t){this.accumulation;let r=u.GL.Texture.DataType.UnsignedByte;switch(a.System.instance.capabilities.maxRenderType){case 2:r=u.GL.Texture.DataType.Float;break;case 1:{const e=a.System.instance.capabilities.queryExtensionObject("OES_texture_half_float");if(void 0!==e){r=e.HALF_FLOAT_OES;break}}}return this.accumulation=i.TextureHandle.createForAttachment(e,t,u.GL.Texture.Format.Rgba,r),this.revealage=i.TextureHandle.createForAttachment(e,t,u.GL.Texture.Format.Rgba,r),this.hilite=i.TextureHandle.createForAttachment(e,t,u.GL.Texture.Format.Rgba,r),this.color=i.TextureHandle.createForAttachment(e,t,u.GL.Texture.Format.Rgba,u.GL.Texture.DataType.UnsignedByte),this.idLow=i.TextureHandle.createForAttachment(e,t,u.GL.Texture.Format.Rgba,u.GL.Texture.DataType.UnsignedByte),this.idHigh=i.TextureHandle.createForAttachment(e,t,u.GL.Texture.Format.Rgba,u.GL.Texture.DataType.UnsignedByte),this.depthAndOrder=i.TextureHandle.createForAttachment(e,t,u.GL.Texture.Format.Rgba,u.GL.Texture.DataType.UnsignedByte),void 0!==this.accumulation&&void 0!==this.revealage&&void 0!==this.color&&void 0!==this.idLow&&void 0!==this.idHigh&&void 0!==this.depthAndOrder&&void 0!==this.hilite}}class FrameBuffers{init(e,t){const r=a.System.instance.frameBufferStack.currentColorBuffer;return void 0!==r&&(this.opaqueColor=n.FrameBuffer.create([r],t),this.opaqueAndCompositeColor=n.FrameBuffer.create([e.color],t),this.depthAndOrder=n.FrameBuffer.create([e.depthAndOrder]),this.hilite=n.FrameBuffer.create([e.hilite]),this.hiliteUsingStencil=n.FrameBuffer.create([e.hilite],t),1===a.System.instance.capabilities.maxDepthType&&(this.stencilSet=n.FrameBuffer.create([],t)),void 0!==this.opaqueColor&&void 0!==this.opaqueAndCompositeColor&&void 0!==this.depthAndOrder&&void 0!==this.hilite&&void 0!==this.hiliteUsingStencil)}dispose(){this.opaqueColor=l.dispose(this.opaqueColor),this.opaqueAndCompositeColor=l.dispose(this.opaqueAndCompositeColor),this.depthAndOrder=l.dispose(this.depthAndOrder),this.hilite=l.dispose(this.hilite),this.hiliteUsingStencil=l.dispose(this.hiliteUsingStencil),this.stencilSet=l.dispose(this.stencilSet)}}class Geometry{init(e){return this.composite,this.composite=o.CompositeGeometry.createGeometry(e.color.getHandle(),e.accumulation.getHandle(),e.revealage.getHandle(),e.hilite.getHandle()),this.stencilCopy=o.ViewportQuadGeometry.create(13),void 0!==this.composite}dispose(){this.composite=l.dispose(this.composite),this.stencilCopy=l.dispose(this.stencilCopy)}}class PixelBuffer{constructor(e,t,r){if(this._scratchUint32Array=new Uint32Array(1),this._scratchUint8Array=new Uint8Array(this._scratchUint32Array.buffer),this._scratchVector3d=new s.Vector3d,this._mult=new s.Vector3d(1,1/255,1/65025),this._invalidPixelData=new c.Pixel.Data,this._rect=e.clone(),this._selector=t,0!==(6&t)){const t=r.readDepthAndOrder(e);void 0!==t?this._depthAndOrder=new Uint32Array(t.buffer):this._selector&=-7}if(0!==(1&t)){const t=r.readElementIds(!1,e),n=void 0!==t?r.readElementIds(!0,e):void 0;void 0!==t&&void 0!==n?(this._elemIdLow=new Uint32Array(t.buffer),this._elemIdHi=new Uint32Array(n.buffer)):this._selector&=-2}}get _numPixels(){return this._rect.width*this._rect.height}getPixelIndex(e,t){return e<this._rect.left||t<this._rect.top?this._numPixels:(e-=this._rect.left,t-=this._rect.top,e>=this._rect.width||t>=this._rect.height?this._numPixels:(t=this._rect.height-1-t)*this._rect.width+e)}getPixel32(e,t){return t<e.length?e[t]:void 0}getElementId(e){if(void 0===this._elemIdLow||void 0===this._elemIdHi)return;const t=this.getPixel32(this._elemIdLow,e),r=this.getPixel32(this._elemIdHi,e);return void 0!==t&&void 0!==r?l.Id64.fromUint32Pair(t,r):void 0}decodeDepthRgba(e){this._scratchUint32Array[0]=e;const t=this._scratchUint8Array;let r=s.Vector3d.create(t[1]/255,t[2]/255,t[3]/255,this._scratchVector3d).dotProduct(this._mult);return r=Math.min(1,r),r=Math.max(0,r)}decodeRenderOrderRgba(e){this._scratchUint32Array[0]=e;const t=this._scratchUint8Array[0]/255;return Math.floor(16*t+.5)}getPixel(e,t){const r=this._invalidPixelData,n=this.getPixelIndex(e,t);if(n>=this._numPixels)return r;let i=r.distanceFraction,o=r.type,s=r.planarity;const a=0!==(1&this._selector)?this.getElementId(n):void 0;if(void 0!==this._depthAndOrder){const e=0!==(2&this._selector),t=0!==(4&this._selector),r=e||t?this.getPixel32(this._depthAndOrder,n):void 0;if(void 0!==r&&(e&&(i=this.decodeDepthRgba(r)),t)){const e=this.decodeRenderOrderRgba(r),t=-9&e;switch(s=e===t?3:2,t){case 0:o=1,s=1;break;case 1:case 2:o=2;break;case 3:o=3;break;case 4:o=4;break;case 5:o=5;break;default:o=1,s=1}}}return new c.Pixel.Data(a,i,o,s)}get isEmpty(){return 0===this._selector}static create(e,t,r){const n=new PixelBuffer(e,t,r);return n.isEmpty?void 0:n}}class SceneCompositor{constructor(){}static create(e){return a.System.instance.capabilities.supportsDrawBuffers?new MRTCompositor(e):new MPCompositor(e)}}t.SceneCompositor=SceneCompositor;class Compositor extends SceneCompositor{constructor(e,t,r){super(),this._width=-1,this._height=-1,this._textures=new Textures,this._readPickDataFromPingPong=!0,this._opaqueRenderState=new h.RenderState,this._translucentRenderState=new h.RenderState,this._noDepthMaskRenderState=new h.RenderState,this._stencilSetRenderState=new h.RenderState,this._classifyColorRenderState=new h.RenderState,this._classifyPickDataRenderState=new h.RenderState,this._debugStencilRenderState=new h.RenderState,this._debugStencil=0,this._target=e,this._frameBuffers=t,this._geom=r,this._opaqueRenderState.flags.depthTest=!0,this._translucentRenderState.flags.depthMask=!1,this._translucentRenderState.flags.blend=this._translucentRenderState.flags.depthTest=!0,this._translucentRenderState.blend.setBlendFuncSeparate(u.GL.BlendFactor.One,u.GL.BlendFactor.Zero,u.GL.BlendFactor.One,u.GL.BlendFactor.OneMinusSrcAlpha),this._noDepthMaskRenderState.flags.depthMask=!1,this._stencilSetRenderState.flags.depthTest=!0,this._stencilSetRenderState.flags.depthMask=!1,this._stencilSetRenderState.flags.colorWrite=!1,this._stencilSetRenderState.flags.stencilTest=!0,this._stencilSetRenderState.depthFunc=u.GL.DepthFunc.LessOrEqual,this._stencilSetRenderState.stencil.frontFunction.function=u.GL.StencilFunction.Always,this._stencilSetRenderState.stencil.frontOperation.zFail=u.GL.StencilOperation.IncrWrap,this._stencilSetRenderState.stencil.backFunction.function=u.GL.StencilFunction.Always,this._stencilSetRenderState.stencil.backOperation.zFail=u.GL.StencilOperation.DecrWrap,this._classifyPickDataRenderState.flags.depthTest=!1,this._classifyPickDataRenderState.flags.depthMask=!1,this._classifyPickDataRenderState.flags.colorWrite=!0,this._classifyPickDataRenderState.flags.stencilTest=!0,this._classifyPickDataRenderState.flags.cull=!0,this._classifyPickDataRenderState.cullFace=u.GL.CullFace.Front,this._classifyPickDataRenderState.stencil.backFunction.function=u.GL.StencilFunction.NotEqual,this._classifyPickDataRenderState.stencil.backOperation.zPass=u.GL.StencilOperation.Zero,this._classifyColorRenderState.flags.depthTest=!1,this._classifyColorRenderState.flags.depthMask=!1,this._classifyColorRenderState.flags.colorWrite=!0,this._classifyColorRenderState.flags.stencilTest=!0,this._classifyColorRenderState.stencil.frontFunction.function=u.GL.StencilFunction.NotEqual,this._classifyColorRenderState.stencil.frontOperation.fail=u.GL.StencilOperation.Zero,this._classifyColorRenderState.stencil.frontOperation.zFail=u.GL.StencilOperation.Zero,this._classifyColorRenderState.stencil.frontOperation.zPass=u.GL.StencilOperation.Zero,this._classifyColorRenderState.stencil.backFunction.function=u.GL.StencilFunction.NotEqual,this._classifyColorRenderState.stencil.backOperation.fail=u.GL.StencilOperation.Zero,this._classifyColorRenderState.stencil.backOperation.zFail=u.GL.StencilOperation.Zero,this._classifyColorRenderState.stencil.backOperation.zPass=u.GL.StencilOperation.Zero,this._classifyColorRenderState.flags.blend=!0,this._debugStencil>0&&(this._debugStencilRenderState.flags.depthTest=!0,this._debugStencilRenderState.flags.blend=!0,this._debugStencilRenderState.blend.setBlendFunc(u.GL.BlendFactor.OneMinusConstColor,u.GL.BlendFactor.ConstColor),this._debugStencilRenderState.blend.color=[.67,.67,.67,1])}update(){const e=this._target.viewRect,t=e.width,r=e.height;if(void 0!==this._textures.accumulation&&t===this._width&&r===this._height)return!0;this._width=t,this._height=r;const n=this.init();return n}draw(e){if(!this.update())return;const t=e.compositeFlags,r=0!==(1&t)||0!==(2&t);this.clearOpaque(r),this.renderBackground(e,r),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Render Background"),this.renderSkyBox(e,r),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Render SkyBox"),this.renderTerrain(e,r),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Render Terrain"),this._target.pushActiveVolume(),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Enable Clipping"),this.renderOpaque(e,r,!1),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Render Opaque"),this.renderClassification(e,r,!1),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Render Stencils"),r&&(this._geom.composite.update(t),this.clearTranslucent(),this.renderTranslucent(e),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Render Translucent"),this.renderHilite(e),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Render Hilite"),this.composite(),this._target.performanceMetrics&&this._target.performanceMetrics.recordTime("Composite")),this._target.popActiveVolume()}get fullHeight(){return this._target.viewRect.height}drawForReadPixels(e,t){if(!this.update())return;this.clearOpaque(!1);const r=!e.isEmpty;if(r&&(this._target.pushActiveVolume(),this.renderOpaque(e,!1,!0),this.renderClassification(e,!1,!0),this._target.popActiveVolume()),void 0!==t&&0!==t.length&&(e.initForPickOverlays(t),!e.isEmpty)){if(r){const e=a.System.instance;e.frameBufferStack.execute(this._frameBuffers.opaqueColor,!0,()=>{e.applyRenderState(h.RenderState.defaults),e.context.clearDepth(1),e.context.clear(u.GL.BufferBit.Depth)})}this.renderOpaque(e,!1,!0)}}readPixels(e,t){return PixelBuffer.create(e,t,this)}readDepthAndOrder(e){return this.readFrameBuffer(e,this._frameBuffers.depthAndOrder)}readElementIds(e,t){const r=e?this._textures.idHigh:this._textures.idLow;if(void 0===r)return;const i=n.FrameBuffer.create([r]),o=this.readFrameBuffer(t,i);return l.dispose(i),o}readFrameBuffer(e,t){if(void 0===t||!t.isValid)return;const r=this.fullHeight-e.bottom,n=a.System.instance.context,i=new Uint8Array(e.width*e.height*4);let o=i;return a.System.instance.frameBufferStack.execute(t,!0,()=>{try{n.readPixels(e.left,r,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,i)}catch(e){o=void 0}}),o}dispose(){this._depth=l.dispose(this._depth),l.dispose(this._textures),l.dispose(this._frameBuffers),l.dispose(this._geom)}init(){return this.dispose(),this._depth=a.System.instance.createDepthBuffer(this._width,this._height),void 0!==this._depth&&(this._textures.init(this._width,this._height)&&this._frameBuffers.init(this._textures,this._depth)&&this._geom.init(this._textures))}renderTerrain(e,t){const r=e.getCommands(11);if(0===r.length)return;this._target.plan.selectTerrainFrustum(),this._target.changeFrustum(this._target.plan);const n=a.System.instance.frameBufferStack,i=this.getBackgroundFbo(t);n.execute(i,!0,()=>{a.System.instance.applyRenderState(this.getRenderState(11)),this._target.techniques.execute(this._target,r,11)}),this._target.plan.selectViewFrustum(),this._target.changeFrustum(this._target.plan)}renderSkyBox(e,t){const r=e.getCommands(10);if(0===r.length)return;const n=a.System.instance.frameBufferStack,i=this.getBackgroundFbo(t);n.execute(i,!0,()=>{this._target.pushState(this._target.decorationState),a.System.instance.applyRenderState(this.getRenderState(10)),this._target.techniques.execute(this._target,r,10),this._target.popBranch()})}renderBackground(e,t){const r=e.getCommands(0);if(0===r.length)return;const n=a.System.instance.frameBufferStack,i=this.getBackgroundFbo(t);n.execute(i,!0,()=>{this._target.pushState(this._target.decorationState),a.System.instance.applyRenderState(this.getRenderState(0)),this._target.techniques.execute(this._target,r,0),this._target.popBranch()})}findFlashedClassifier(e){if(!l.Id64.isValid(this._target.flashedElemId))return-1;for(let t=1;t<e.length;t+=3){const r=e[t];if(r.isPrimitiveCommand&&r instanceof d.BatchPrimitiveCommand){if(r.computeIsFlashed(this._target.flashedElemId))return(t-1)/3}}return-1}renderIndexedClassifier(e,t,r){a.System.instance.frameBufferStack.execute(this._frameBuffers.stencilSet,!1,()=>{this._target.pushState(this._target.decorationState),a.System.instance.applyRenderState(this._stencilSetRenderState),this._target.techniques.executeForIndexedClassifier(this._target,e,4,t),this._target.popBranch()}),this.renderIndexedClassifierForReadPixels(e,t,this._classifyPickDataRenderState,r)}renderClassification(e,t,r){const n=e.getCommands(4),i=e.getCommands(13);if(0===n.length||0===i.length)return;if(this._debugStencil>0)return void a.System.instance.frameBufferStack.execute(this.getBackgroundFbo(t),!0,()=>{1===this._debugStencil?(a.System.instance.applyRenderState(this.getRenderState(3)),this._target.techniques.execute(this._target,n,3)):(this._target.pushState(this._target.decorationState),a.System.instance.applyRenderState(this._debugStencilRenderState),this._target.techniques.execute(this._target,n,4),this._target.popBranch())});const o=a.System.instance.frameBufferStack,s=this._frameBuffers.stencilSet,c=this.getBackgroundFbo(t);if(void 0===s||void 0===c)return;if(o.execute(s,!1,()=>{a.System.instance.context.clearStencil(0),a.System.instance.context.clear(u.GL.BufferBit.Stencil)}),r){const e=i.length/3;for(let r=0;r<e;++r)this.renderIndexedClassifier(i,r,t);return}const l=this.findFlashedClassifier(i),d=e.getCommands(12);n.length>0&&(o.execute(s,!1,()=>{this._target.pushState(this._target.decorationState),a.System.instance.applyRenderState(this._stencilSetRenderState),this._target.techniques.execute(this._target,d,7),this._target.popBranch()}),o.execute(c,!0,()=>{this._target.pushState(this._target.decorationState),this._classifyColorRenderState.blend.color=[1,1,1,.2],this._classifyColorRenderState.blend.setBlendFunc(u.GL.BlendFactor.ConstAlpha,u.GL.BlendFactor.OneMinusConstAlpha),a.System.instance.applyRenderState(this._classifyColorRenderState);const e=m(this._target,this._geom.stencilCopy);this._target.techniques.draw(e),this._target.popBranch()})),-1!==l&&(o.execute(this._frameBuffers.stencilSet,!1,()=>{this._target.pushState(this._target.decorationState),a.System.instance.applyRenderState(this._stencilSetRenderState),this._target.techniques.executeForIndexedClassifier(this._target,i,4,l),this._target.popBranch()}),o.execute(c,!0,()=>{this._target.pushState(this._target.decorationState),this._classifyColorRenderState.blend.color=[1,1,1,.5*this._target.flashIntensity],this._classifyColorRenderState.blend.setBlendFuncSeparate(u.GL.BlendFactor.ConstAlpha,u.GL.BlendFactor.ConstAlpha,u.GL.BlendFactor.One,u.GL.BlendFactor.OneMinusConstAlpha),a.System.instance.applyRenderState(this._classifyColorRenderState),this._target.techniques.executeForIndexedClassifier(this._target,i,2,l),this._target.popBranch()})),o.execute(s,!1,()=>{this._target.pushState(this._target.decorationState),a.System.instance.applyRenderState(this._stencilSetRenderState),this._target.techniques.execute(this._target,n,4),this._target.popBranch()}),o.execute(c,!0,()=>{this._target.pushState(this._target.decorationState),this._classifyColorRenderState.stencil.frontFunction.function=u.GL.StencilFunction.Equal,this._classifyColorRenderState.stencil.backFunction.function=u.GL.StencilFunction.Equal,this._classifyColorRenderState.blend.color=[1,1,1,.4],this._classifyColorRenderState.blend.setBlendFuncSeparate(u.GL.BlendFactor.Zero,u.GL.BlendFactor.Zero,u.GL.BlendFactor.ConstAlpha,u.GL.BlendFactor.One),a.System.instance.applyRenderState(this._classifyColorRenderState),this._classifyColorRenderState.stencil.frontFunction.function=u.GL.StencilFunction.NotEqual,this._classifyColorRenderState.stencil.backFunction.function=u.GL.StencilFunction.NotEqual;const e=m(this._target,this._geom.stencilCopy);this._target.techniques.draw(e),this._target.popBranch()})}renderHilite(e){const t=a.System.instance;t.frameBufferStack.execute(this._frameBuffers.hilite,!0,()=>{t.context.clearColor(0,0,0,0),t.context.clear(u.GL.BufferBit.Color),this.drawPass(e,7)});const r=e.getCommands(12);0!==r.length&&(t.frameBufferStack.execute(this._frameBuffers.stencilSet,!1,()=>{this._target.pushState(this._target.decorationState),t.applyRenderState(this._stencilSetRenderState),this._target.techniques.execute(this._target,r,7),this._target.popBranch()}),t.frameBufferStack.execute(this._frameBuffers.hiliteUsingStencil,!0,()=>{t.applyRenderState(this._classifyPickDataRenderState),this._target.techniques.execute(this._target,r,7)}))}composite(){a.System.instance.applyRenderState(h.RenderState.defaults);const e=m(this._target,this._geom.composite);this._target.techniques.draw(e)}getRenderState(e){switch(e){case 1:case 2:case 3:return this._opaqueRenderState;case 5:return this._translucentRenderState;default:return this._noDepthMaskRenderState}}drawPass(e,t,r=!1){const n=e.getCommands(t);0!==n.length&&(r&&this.pingPong(),a.System.instance.applyRenderState(this.getRenderState(t)),this._target.techniques.execute(this._target,n,t))}}class MRTFrameBuffers extends FrameBuffers{init(e,t){if(!super.init(e,t))return!1;this.opaqueAll;const r=a.System.instance.frameBufferStack.currentColorBuffer;if(void 0===r)return!1;const i=[r,e.idLow,e.idHigh,e.depthAndOrder];this.opaqueAll=n.FrameBuffer.create(i,t),i[0]=e.color,this.opaqueAndCompositeAll=n.FrameBuffer.create(i,t);const o=[e.accumulation,e.revealage];this.translucent=n.FrameBuffer.create(o,t),this.clearTranslucent=n.FrameBuffer.create(o);const s=[e.accumulation,e.hilite,e.revealage];this.pingPong=n.FrameBuffer.create(s);const c=[r,e.idLow,e.idHigh];return this.idOnly=n.FrameBuffer.create(c,t),i[0]=e.color,this.idOnlyAndComposite=n.FrameBuffer.create(c,t),void 0!==this.opaqueAll&&void 0!==this.opaqueAndCompositeAll&&void 0!==this.pingPong&&void 0!==this.translucent&&void 0!==this.clearTranslucent&&void 0!==this.idOnly&&void 0!==this.idOnlyAndComposite}dispose(){super.dispose(),this.opaqueAll=l.dispose(this.opaqueAll),this.opaqueAndCompositeAll=l.dispose(this.opaqueAndCompositeAll),this.pingPong=l.dispose(this.pingPong),this.translucent=l.dispose(this.translucent),this.clearTranslucent=l.dispose(this.clearTranslucent),this.idOnly=l.dispose(this.idOnly),this.idOnlyAndComposite=l.dispose(this.idOnlyAndComposite)}}class MRTGeometry extends Geometry{init(e){return!!super.init(e)&&(this.copyPickBuffers,this.copyPickBuffers=o.CopyPickBufferGeometry.createGeometry(e.idLow.getHandle(),e.idHigh.getHandle(),e.depthAndOrder.getHandle()),this.clearTranslucent=o.ViewportQuadGeometry.create(9),this.clearPickAndColor=o.ViewportQuadGeometry.create(14),void 0!==this.copyPickBuffers&&void 0!==this.clearTranslucent&&void 0!==this.clearPickAndColor)}dispose(){super.dispose(),this.copyPickBuffers=l.dispose(this.copyPickBuffers),this.clearTranslucent=l.dispose(this.clearTranslucent),this.clearPickAndColor=l.dispose(this.clearPickAndColor)}}class MRTCompositor extends Compositor{constructor(e){super(e,new MRTFrameBuffers,new MRTGeometry)}get currentRenderTargetIndex(){return 0}get elementId0(){return this.getSamplerTexture(this._readPickDataFromPingPong?0:1)}get elementId1(){return this.getSamplerTexture(this._readPickDataFromPingPong?1:2)}get depthAndOrder(){return this.getSamplerTexture(this._readPickDataFromPingPong?2:3)}get _fbos(){return this._frameBuffers}get _geometry(){return this._geom}clearOpaque(e){const t=e?this._fbos.opaqueAndCompositeAll:this._fbos.opaqueAll,r=a.System.instance;r.frameBufferStack.execute(t,!0,()=>{r.applyRenderState(this._noDepthMaskRenderState);const e=m(this._target,this._geometry.clearPickAndColor);this._target.techniques.draw(e),r.applyRenderState(h.RenderState.defaults),r.context.clearDepth(1),r.context.clear(u.GL.BufferBit.Depth)})}renderOpaque(e,t,r){this._readPickDataFromPingPong=!0;let n=a.System.instance.frameBufferStack;n.execute(t?this._fbos.opaqueAndCompositeAll:this._fbos.opaqueAll,!0,()=>{this.drawPass(e,1),this.drawPass(e,2,!0),r&&this.drawPass(e,3,!0)}),this._readPickDataFromPingPong=!1,r||(n=a.System.instance.frameBufferStack).execute(t?this._fbos.opaqueAndCompositeColor:this._fbos.opaqueColor,!0,()=>{this.drawPass(e,3,!1),this.drawPass(e,6,!1)})}renderIndexedClassifierForReadPixels(e,t,r,n){this._readPickDataFromPingPong=!0,a.System.instance.frameBufferStack.execute(n?this._fbos.idOnlyAndComposite:this._fbos.idOnly,!0,()=>{a.System.instance.applyRenderState(r),this._target.techniques.executeForIndexedClassifier(this._target,e,3,t)}),this._readPickDataFromPingPong=!1}clearTranslucent(){a.System.instance.applyRenderState(this._noDepthMaskRenderState),a.System.instance.frameBufferStack.execute(this._fbos.clearTranslucent,!0,()=>{const e=m(this._target,this._geometry.clearTranslucent);this._target.techniques.draw(e)})}renderTranslucent(e){a.System.instance.frameBufferStack.execute(this._fbos.translucent,!0,()=>{this.drawPass(e,5)})}pingPong(){a.System.instance.applyRenderState(this._noDepthMaskRenderState),a.System.instance.frameBufferStack.execute(this._fbos.pingPong,!0,()=>{const e=m(this._target,this._geometry.copyPickBuffers);this._target.techniques.draw(e)})}getBackgroundFbo(e){return e?this._fbos.opaqueAndCompositeColor:this._fbos.opaqueColor}get _samplerFbo(){return this._readPickDataFromPingPong?this._fbos.pingPong:this._fbos.opaqueAll}getSamplerTexture(e){return this._samplerFbo.getColor(e)}}class MPFrameBuffers extends FrameBuffers{init(e,t){return!!super.init(e,t)&&(this.accumulation,this.accumulation=n.FrameBuffer.create([e.accumulation],t),this.revealage=n.FrameBuffer.create([e.revealage],t),this.idLow=n.FrameBuffer.create([e.idLow]),this.idHigh=n.FrameBuffer.create([e.idHigh]),this.idLowWithDepth=n.FrameBuffer.create([e.idLow],t),this.idHighWithDepth=n.FrameBuffer.create([e.idHigh],t),void 0!==this.accumulation&&void 0!==this.revealage&&void 0!==this.idLow&&void 0!==this.idHigh&&void 0!==this.idLowWithDepth&&void 0!==this.idHighWithDepth)}dispose(){super.dispose(),this.accumulation=l.dispose(this.accumulation),this.revealage=l.dispose(this.revealage),this.idLow=l.dispose(this.idLow),this.idHigh=l.dispose(this.idHigh),this.idLowWithDepth=l.dispose(this.idLowWithDepth),this.idHighWithDepth=l.dispose(this.idHighWithDepth)}}class MPGeometry extends Geometry{init(e){return!!super.init(e)&&(this.copyColor,this.copyColor=o.SingleTexturedViewportQuadGeometry.createGeometry(e.idLow.getHandle(),11),void 0!==this.copyColor)}dispose(){super.dispose(),this.copyColor=l.dispose(this.copyColor)}}class MPCompositor extends Compositor{constructor(e){super(e,new MPFrameBuffers,new MPGeometry),this._currentRenderTargetIndex=0}get _fbos(){return this._frameBuffers}get _geometry(){return this._geom}get currentRenderTargetIndex(){return this._currentRenderTargetIndex}get elementId0(){return this._readPickDataFromPingPong?this._textures.accumulation:this._textures.idLow}get elementId1(){return this._readPickDataFromPingPong?this._textures.hilite:this._textures.idHigh}get depthAndOrder(){return this._readPickDataFromPingPong?this._textures.revealage:this._textures.depthAndOrder}getBackgroundFbo(e){return e?this._fbos.opaqueAndCompositeColor:this._fbos.opaqueColor}clearOpaque(e){const t=p.FloatRgba.fromColorDef(this._target.bgColor);this.clearFbo(e?this._fbos.opaqueAndCompositeColor:this._fbos.opaqueColor,t.red,t.green,t.blue,t.alpha,!0),this.clearFbo(this._fbos.depthAndOrder,0,0,0,0,!0),this.clearFbo(this._fbos.idLow,0,0,0,0,!0),this.clearFbo(this._fbos.idHigh,0,0,0,0,!0)}renderOpaque(e,t,r){this._readPickDataFromPingPong=!0;const n=t?this._fbos.opaqueAndCompositeColor:this._fbos.opaqueColor;this.drawOpaquePass(n,e,1,!1),this.drawOpaquePass(n,e,2,!0),r&&this.drawOpaquePass(n,e,3,!0),this._readPickDataFromPingPong=!1,r||a.System.instance.frameBufferStack.execute(n,!0,()=>{this.drawPass(e,3,!1),this.drawPass(e,6,!1)})}renderIndexedClassifierForReadPixels(e,t,r,n){this._readPickDataFromPingPong=!0;const i=a.System.instance.frameBufferStack;this._currentRenderTargetIndex=1,i.execute(this._fbos.idLowWithDepth,!0,()=>{r.stencil.backOperation.zPass=u.GL.StencilOperation.Keep,a.System.instance.applyRenderState(r),this._target.techniques.executeForIndexedClassifier(this._target,e,3,t)}),this._currentRenderTargetIndex=2,i.execute(this._fbos.idHighWithDepth,!0,()=>{r.stencil.backOperation.zPass=u.GL.StencilOperation.Zero,a.System.instance.applyRenderState(r),this._target.techniques.executeForIndexedClassifier(this._target,e,3,t)}),this._currentRenderTargetIndex=0,this._readPickDataFromPingPong=!1}drawOpaquePass(e,t,r,n){const i=a.System.instance.frameBufferStack;i.execute(e,!0,()=>this.drawPass(t,r,n)),this._currentRenderTargetIndex++,i.execute(this._fbos.idLow,!0,()=>this.drawPass(t,r,!1)),this._currentRenderTargetIndex++,i.execute(this._fbos.idHigh,!0,()=>this.drawPass(t,r,!1)),this._currentRenderTargetIndex++,i.execute(this._fbos.depthAndOrder,!0,()=>this.drawPass(t,r,!1)),this._currentRenderTargetIndex=0}clearTranslucent(){this.clearFbo(this._fbos.accumulation,0,0,0,1,!1),this.clearFbo(this._fbos.revealage,1,0,0,1,!1)}renderTranslucent(e){a.System.instance.frameBufferStack.execute(this._fbos.accumulation,!0,()=>{this.drawPass(e,5)}),this._currentRenderTargetIndex=1,a.System.instance.frameBufferStack.execute(this._fbos.revealage,!0,()=>{this.drawPass(e,5)}),this._currentRenderTargetIndex=0}pingPong(){a.System.instance.applyRenderState(this._noDepthMaskRenderState),this.copyFbo(this._textures.idLow,this._fbos.accumulation),this.copyFbo(this._textures.idHigh,this._fbos.revealage),this.copyFbo(this._textures.depthAndOrder,this._fbos.hilite)}copyFbo(e,t){const r=this._geometry.copyColor;r.texture=e.getHandle(),a.System.instance.frameBufferStack.execute(t,!0,()=>{const e=m(this._target,r);this._target.techniques.draw(e)})}clearFbo(e,t,r,n,i,o){const s=a.System.instance,c=s.context;s.frameBufferStack.execute(e,!0,()=>{s.applyRenderState(o?h.RenderState.defaults:this._noDepthMaskRenderState),c.clearColor(t,r,n,i);let e=u.GL.BufferBit.Color;o&&(c.clearDepth(1),e|=u.GL.BufferBit.Depth),c.clear(e)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(43),i=r(42),o=r(40);class WipRpcInterface extends i.RpcInterface{static getClient(){return o.RpcManager.getClientForInterface(WipRpcInterface)}placeholder(e){return this.forward.apply(this,arguments)}isChangeCacheAttached(e){return this.forward.apply(this,arguments)}attachChangeCache(e){return this.forward.apply(this,arguments)}detachChangeCache(e){return this.forward.apply(this,arguments)}}WipRpcInterface.types=(()=>[n.IModelToken]),WipRpcInterface.version="0.2.0",t.WipRpcInterface=WipRpcInterface},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(42),i=r(40),o=r(43);class IModelUnitTestRpcInterface extends n.RpcInterface{static getClient(){return i.RpcManager.getClientForInterface(IModelUnitTestRpcInterface)}executeTest(e,t,r){return this.forward.apply(this,arguments)}}IModelUnitTestRpcInterface.version="1.0.0",IModelUnitTestRpcInterface.types=(()=>[o.IModelToken]),t.IModelUnitTestRpcInterface=IModelUnitTestRpcInterface},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4),o=r(0),s=r(3),a=r(64),c=r(0),l=r(69),u=r(63),d=r(8),h=r(104),p=r(3);function f(e){const t=i.Cartographic.fromEcef(e);return s.Point3d.create((t.longitude+s.Angle.piRadians)/s.Angle.pi2Radians,function(e){const t=Math.sin(e);return.5-Math.log((1+t)/(1-t))/(4*s.Angle.piRadians)}(t.latitude),0)}class QuadId{get isValid(){return this.level>=0}constructor(e){const t=e.split("_");3===t.length?(this.level=parseInt(t[0],10),this.column=parseInt(t[1],10),this.row=parseInt(t[2],10)):this.level=this.row=this.column=-1}getMercatorCorners(){const e=1/(1<<this.level),t=[];return t.push(s.Point3d.create(e*this.column,e*this.row,0)),t.push(s.Point3d.create(e*(this.column+1),e*this.row,0)),t.push(s.Point3d.create(e*this.column,e*(this.row+1),0)),t.push(s.Point3d.create(e*(this.column+1),e*(this.row+1),0)),t}getCorners(e){const t=this.getMercatorCorners();return e.multiplyPoint3dArrayInPlace(t),t}getRange(e){const t=this.getCorners(e);return s.Range3d.createArray(t)}pixelXYToLatLong(e,t){const r=256<<this.level,n=(256*this.column+e)/r-.5,i=.5-(256*this.row+t)/r;return new s.Point2d(360*n,90-360*Math.atan(Math.exp(2*-i*Math.PI))/Math.PI)}getLatLongRange(){const e=this.pixelXYToLatLong(0,256),t=this.pixelXYToLatLong(256,0),r=new s.Range2d;return r.low=e,r.high=t,r}}class WebMercatorTileTreeProps{constructor(e){this.id="",this.yAxisUp=!0,this.isTerrain=!0,this.rootTile=new WebMercatorTileProps("0_0_0",e),this.location=s.Transform.createIdentity()}}class WebMercatorTileProps{constructor(e,t){this.sizeMultiplier=1,this.isLeaf=!1,this.contentId=e;const r=new QuadId(e);this.range=r.getRange(t),this.maximumSize=0===r.level?0:256}}class WebMercatorTileLoader extends a.TileLoader{constructor(e,t,r){super(),this._imageryProvider=e,this._iModel=t,this._providerInitialized=!1;const n=t.ecefLocation,i=s.Transform.createOriginAndMatrix(n.origin,n.orientation.toMatrix3d()),o=t.projectExtents.center,a=s.Point3d.create(o.x+1,o.y,r),c=s.Point3d.create(o.x,o.y+1,r),l=f(i.multiplyPoint3d(o)),u=f(i.multiplyPoint3d(a)),d=f(i.multiplyPoint3d(c)),h=s.Vector3d.createStartEnd(l,u),p=s.Vector3d.createStartEnd(l,d),g=s.Transform.createOriginAndMatrixColumns(l,h,p,s.Vector3d.create(0,0,1)).multiplyTransformTransform(s.Transform.createTranslationXYZ(-o.x,-o.y,-r));this.mercatorToDb=g.inverse()}tileRequiresLoading(e){return 0!==e.maximumSize}async getChildrenProps(e){const t=new QuadId(e.contentId),r=t.level+1,n=2*t.column,i=2*t.row,o=[];for(let s=0;s<2;s++)for(let e=0;e<2;e++){const t=r+"_"+(n+s)+"_"+(i+e);o.push(new WebMercatorTileProps(t,this.mercatorToDb))}return o}async loadTileContents(e){for(const t of e)t.setIsQueued();this._providerInitialized||(void 0===this._providerInitializing&&(this._providerInitializing=this._imageryProvider.initialize()),await this._providerInitializing,this._providerInitialized=!0,this._providerInitializing=void 0),await Promise.all(e.map(async e=>{e.isQueued;const t=new QuadId(e.contentId),r=t.getCorners(this.mercatorToDb),n=await this._imageryProvider.loadTile(t.row,t.column,t.level);if(void 0===n)e.setNotFound();else{const t=this.loadTextureImage(n,this._iModel,d.IModelApp.renderSystem);t.catch(t=>e.setNotFound()),t.then(t=>{e.setGraphic(d.IModelApp.renderSystem.createTile(t,r))})}}))}async loadTextureImage(e,t,r){try{const n=!1,o=new i.RenderTexture.Params(void 0,2);return u.imageElementFromImageSource(e).then(i=>n?void 0:r.createTextureFromImage(i,2===e.format,t,o)).catch(e=>void 0)}catch(e){return}}get maxDepth(){return this._providerInitialized?this._imageryProvider.maximumZoomLevel:32}}class ImageryProvider{constructor(e){this.mapType=e}matchesMissingTile(e){return!1}async loadTile(e,t,r){const o=this.constructUrl(e,t,r),s=new n.ActivityLoggingContext(n.Guid.createValue()),a={method:"GET",responseType:"arraybuffer"};try{const e=await l.request(s,o,a),t=new Uint8Array(e.body);if(!t||0===t.length)return;if(this.matchesMissingTile(t))return;let r;switch(e.header["content-type"]){case"image/jpeg":r=0;break;case"image/png":r=2;break;default:return}return new i.ImageSource(t,r)}catch(e){return}}}class Coverage{constructor(e,t,r,n,i,o){this._lowerLeftLongitude=e,this._lowerLeftLatitude=t,this._upperRightLongitude=r,this._upperRightLatitude=n,this._minimumZoomLevel=i,this._maximumZoomLevel=o}overlaps(e){const t=e.getLatLongRange();return!(e.level<this._minimumZoomLevel)&&(!(e.level>this._maximumZoomLevel)&&(!(t.low.x>this._upperRightLongitude)&&(!(t.low.y>this._upperRightLatitude)&&(!(t.high.x<this._lowerLeftLongitude)&&!(t.high.y<this._lowerLeftLatitude)))))}}class BingAttribution{constructor(e,t){this.copyrightMessage=e,this._coverages=t}matchesTile(e){const t=new QuadId(e.contentId);for(const r of this._coverages)if(r.overlaps(t))return!0;return!1}}class BingMapProvider extends ImageryProvider{constructor(e){super(e),this._zoomMin=this._zoomMax=0,this._tileHeight=this._tileWidth=0}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get minimumZoomLevel(){return this._zoomMin}get maximumZoomLevel(){return this._zoomMax}tileXYToQuadKey(e,t,r){let n="";for(let i=r;i>0;i--){let r=48;const o=1<<i-1;0!==(e&o)&&r++,0!==(t&o)&&(r++,r++),n=n.concat(String.fromCharCode(r))}return n}constructUrl(e,t,r){const n=this.tileXYToQuadKey(t,e,r),i=this._urlSubdomains[(e+t)%this._urlSubdomains.length];let o=this._urlTemplate.replace("{subdomain}",i);return o=o.replace("{quadkey}",n)}getMatchingAttributions(e){const t=new Array;if(!this._attributions)return t;const r=this._attributions.slice();for(const n of e)for(let e=0;e<r.length;e++){const i=r[e];i&&i.matchesTile(n)&&(t.push(i),delete r[e])}return t}showAttributions(e,t){const r=e.getTilesForView(t),n=this.getMatchingAttributions(r);let i=d.IModelApp.i18n.translate("iModelJs:BackgroundMap.BingDataAttribution");for(const o of n)i=i.concat("<li>",o.copyrightMessage,"</li>");d.IModelApp.notifications.openMessageBox(2,i,1)}getCopyrightImage(e){return this._logoImage}getCopyrightMessage(e,t){const r=document.createElement("span");return r.className="bgmap-copyright",r.onclick=this.showAttributions.bind(this,e,t),r.innerText=d.IModelApp.i18n.translate("iModelJs:BackgroundMap.BingDataClickTarget"),r.style.textDecoration="underline",r.style.cursor="pointer",r}matchesMissingTile(e){if(!this._missingTileData)return!1;if(e.length!==this._missingTileData.length)return!1;for(let t=0;t<e.length;t+=10)if(this._missingTileData[t]!==e[t])return!1;return!0}async initialize(){const e=new n.ActivityLoggingContext(n.Guid.createValue());let t="Road";2===this.mapType?t="Aerial":3===this.mapType&&(t="AerialWithLabels");let r="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/{imagerySet}?o=json&incl=ImageryProviders&key={bingKey}";r=(r=r.replace("{imagerySet}",t)).replace("{bingKey}","AtaeI3QDNG7Bpv1L53cSfDBgBKXIgLq3q-xmn_Y2UyzvF-68rdVxwAuje49syGZt");const i={method:"GET"};try{const t=(await l.request(e,r,i)).body;this._logoUrl=t.brandLogoUri;const n=t.resourceSets[0].resources[0];this._zoomMin=n.zoomMin,this._zoomMax=n.zoomMax,this._tileHeight=n.imageHeight,this._tileWidth=n.imageWidth,this._urlTemplate=n.imageUrl.replace("{culture}","en-US"),this._urlSubdomains=n.imageUrlSubdomains,this.readAttributions(n.imageryProviders),this.readLogo().then(e=>{this._logoImage=new Image;const t=Base64.btoa(String.fromCharCode.apply(null,e));this._logoImage.src="data:image/png;base64,"+t}),this.loadTile(0,0,this._zoomMax-1).then(e=>{void 0!==e&&(this._missingTileData=e.data)})}catch(e){throw new c.BentleyError(65541,"Error in Bing Server communications")}}readLogo(){const e=new n.ActivityLoggingContext(n.Guid.createValue());if(!this._logoUrl||0===this._logoUrl.length)return Promise.resolve(void 0);return l.request(e,this._logoUrl,{method:"GET",responseType:"arraybuffer"}).then(e=>{const t=new Uint8Array(e.body);if(t&&0!==t.length)return t},e=>{})}readAttributions(e){for(const t of e){const e=t.attribution,r=new Array;for(const i of t.coverageAreas){const e=new Coverage(i.bbox[0],i.bbox[1],i.bbox[2],i.bbox[3],i.zoomMin,i.zoomMax);r.push(e)}const n=new BingAttribution(e,r);this._attributions||(this._attributions=new Array),this._attributions.push(n)}}}class MapBoxProvider extends ImageryProvider{constructor(e){switch(super(e),this._zoomMin=1,this._zoomMax=20,e){case 1:this._baseUrl="http://api.mapbox.com/v4/mapbox.streets/";break;case 2:this._baseUrl="http://api.mapbox.com/v4/mapbox.satellite/";break;case 3:this._baseUrl="http://api.mapbox.com/v4/mapbox.streets-satellite/";break;default:this._baseUrl=""}}get tileWidth(){return 256}get tileHeight(){return 256}get minimumZoomLevel(){return this._zoomMin}get maximumZoomLevel(){return this._zoomMax}constructUrl(e,t,r){let n=this._baseUrl.concat(r.toString());return n=(n=n.concat("/").concat(t.toString()).concat("/").concat(e.toString())).concat(".jpg80?access_token=pk%2EeyJ1IjoibWFwYm94YmVudGxleSIsImEiOiJjaWZvN2xpcW00ZWN2czZrcXdreGg2eTJ0In0%2Ef7c9GAxz6j10kZvL%5F2DBHg")}getCopyrightImage(e){}getCopyrightMessage(e,t){const r=document.createElement("span");return r.innerText=d.IModelApp.i18n.translate("IModelJs:BackgroundMap.MapBoxCopyright"),r.className="bgmap-copyright",r}async initialize(){}}t.BackgroundMapState=class BackgroundMapState{constructor(e,t){this._iModel=t,this._loadStatus=a.TileTree.LoadStatus.NotLoaded,this.providerName=o.JsonUtils.asString(e.providerName,"BingProvider"),this._groundBias=o.JsonUtils.asDouble(e.groundBias,0),this.mapType=e.providerData?o.JsonUtils.asInt(e.providerData.mapType,3):3}setTileTree(e,t){this._tileTree=new a.TileTree(a.TileTree.Params.fromJSON(e,this._iModel,!0,t,"")),this._loadStatus=a.TileTree.LoadStatus.Loaded}getPlane(){return p.Plane3dByOriginAndUnitNormal.createXYPlane(new s.Point3d(0,0,this._groundBias))}getTilesForView(e){let t=[];if(this._tileTree){const r=new h.SceneContext(e,new a.TileRequests);r.backgroundMap=this,t=this._tileTree.selectTilesForScene(r)}return t}loadTileTree(){if(a.TileTree.LoadStatus.NotLoaded!==this._loadStatus)return this._loadStatus;if(void 0===this._iModel.ecefLocation)return this._loadStatus;if("BingProvider"===this.providerName?this._provider=new BingMapProvider(this.mapType):"MapBoxProvider"===this.providerName&&(this._provider=new MapBoxProvider(this.mapType)),void 0===this._provider)throw new c.BentleyError(65541,"WebMercator provider invalid");const e=new WebMercatorTileLoader(this._provider,this._iModel,this._groundBias),t=new WebMercatorTileTreeProps(e.mercatorToDb);return this.setTileTree(t,e),this._loadStatus}addToScene(e){e.viewFlags.backgroundMap&&(this.loadTileTree(),void 0!==this._tileTree&&(e.backgroundMap=this,this._tileTree.drawScene(e),e.backgroundMap=void 0))}decorate(e){if(!this._provider)return;const t=this._provider.getCopyrightImage(this);if(t){const r=new s.Point2d(0,e.viewport.viewRect.height-t.height),n=e=>{e.drawImage(t,0,0,t.width,t.height)};e.addCanvasDecoration({position:r,drawDecoration:n})}const r=this._provider.getCopyrightMessage(this,e.screenViewport);if(r){const t=e.decorationDiv;t.appendChild(r);const n=r.getBoundingClientRect(),i=r.style;i.display="block",i.position="absolute",i.left=t.clientWidth-(n.width+15)+"px",i.top=t.clientHeight-(n.height+5)+"px",i.color="silver",i.backgroundColor="transparent",i.pointerEvents="initial"}}equalsProps(e){const t=o.JsonUtils.asString(e.providerName,"BingProvider"),r=o.JsonUtils.asDouble(e.groundBias,0),n=void 0!==e.providerData?o.JsonUtils.asInt(e.providerData.mapType,3):3;return t===this.providerName&&r===this._groundBias&&n===this.mapType}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(313),o=r(142),s=r(45),a=r(527),c=r(528),l=r(529),u=r(530),d=r(531),h=r(532),p=r(533),f=r(534),g=r(535),m=r(185),y=r(536),v=r(537),_=r(91),w=r(27),S=r(46),b=r(31),x=r(315),P=r(538),C=r(539),T=r(540);class SingularTechnique{constructor(e){this.program=e}getShader(e){return this.program}compileShaders(){return this.program.compile()}dispose(){n.dispose(this.program)}}function M(e){return 3*e}t.SingularTechnique=SingularTechnique;const E=1,I=[0,1,2],A=new o.TechniqueFlags;class VariedTechnique{constructor(e){this._basicPrograms=[],this._clippingPrograms=[],this._basicPrograms.length=e}compileShaders(){let e=!0;for(const t of this._basicPrograms)t.compile()||(e=!1);return e}dispose(){for(const e of this._basicPrograms)n.dispose(e);this._basicPrograms.length=0;for(const e of this._clippingPrograms){n.dispose(e.maskShader);for(const t of e.shaders)n.dispose(t);e.shaders.length=0,e.maskShader=void 0}}addShader(e,t,r){const n=this._debugDescription+": "+t.buildDescription();e.setDebugDescription(n);const i=this.getShaderIndex(t);this._basicPrograms[i],this._basicPrograms[i]=e.buildProgram(r),this._basicPrograms[i],this._clippingPrograms[i],this._clippingPrograms[i]=new s.ClippingShaders(e,r),this._clippingPrograms[i]}addProgram(e,t){const r=this.getShaderIndex(e);this._basicPrograms[r],this._basicPrograms[r]=t}addHiliteShader(e,t){const r=t();A.initForHilite(new o.ClipDef),this.addShader(r,A,e)}addTranslucentShader(e,t,r){t.isTranslucent=!0,f.addTranslucency(e),this.addShader(e,t,r)}addElementId(e,t,r=!1){const n=e.frag;if(0===t)n.set(13,w.GLSLFragment.assignFragColor);else{const t=e.vert;t.set(4,r?_.computeUniformElementId:_.computeElementId),S.addFrustum(e),S.addEyeSpace(e),b.addModelViewMatrix(t),_.addRenderOrder(n),_.addElementId(e,r),w.addPickBufferOutputs(n)}}getShaderIndex(e){!e.isHilite||!e.isTranslucent&&e.hasFeatures;const t=this.computeShaderIndex(e);return this._basicPrograms.length,t}getShader(e){const t=this.getShaderIndex(e);let r;if(e.hasClip){const n=this._clippingPrograms[t];r=n.getProgram(e.clip)}return void 0===r&&(r=this._basicPrograms[t]),r}}t.VariedTechnique=VariedTechnique;class SurfaceTechnique extends VariedTechnique{constructor(e){super(M(4)+E);const t=A;this.addHiliteShader(e,m.createSurfaceHiliter);for(let r=0;r<2;r++)for(const n of I){t.reset(n),t.isAnimated=0!==r;const i=m.createSurfaceBuilder(n,t.isAnimated);g.addMonochrome(i.frag),m.addMaterial(i.frag),m.addSurfaceDiscardByAlpha(i.frag),this.addShader(i,t,e),i.frag.unset(6),this.addTranslucentShader(i,t,e)}}get _debugDescription(){return"Surface"}computeShaderIndex(e){if(e.isHilite)return e.hasFeatures,SurfaceTechnique._kHilite;let t=e.isTranslucent?SurfaceTechnique._kTranslucent:SurfaceTechnique._kOpaque;return t+=SurfaceTechnique._kFeature*e.featureMode,e.isAnimated&&(t+=SurfaceTechnique._kAnimated),t}}SurfaceTechnique._kOpaque=0,SurfaceTechnique._kTranslucent=1,SurfaceTechnique._kAnimated=2,SurfaceTechnique._kFeature=4,SurfaceTechnique._kHilite=M(SurfaceTechnique._kFeature);class PolylineTechnique extends VariedTechnique{constructor(e){super(M(2)+E);const t=A;this.addHiliteShader(e,x.createPolylineHiliter);for(const r of I){t.reset(r);const n=x.createPolylineBuilder();g.addMonochrome(n.frag);const i=x.createPolylineBuilder();g.addMonochrome(i.frag),2===r?(_.addFeatureSymbology(i,r,31),_.addFeatureSymbology(n,r,31),this.addTranslucentShader(i,t,e)):(this.addTranslucentShader(i,t,e),_.addFeatureSymbology(n,r,0)),this.addElementId(n,r),t.reset(r),this.addShader(n,t,e)}}get _debugDescription(){return"Polyline"}computeShaderIndex(e){if(e.isHilite)return e.hasFeatures,PolylineTechnique._kHilite;let t=e.isTranslucent?PolylineTechnique._kTranslucent:PolylineTechnique._kOpaque;return t+=PolylineTechnique._kFeature*e.featureMode}}PolylineTechnique._kOpaque=0,PolylineTechnique._kTranslucent=1,PolylineTechnique._kFeature=2,PolylineTechnique._kHilite=M(PolylineTechnique._kFeature);class EdgeTechnique extends VariedTechnique{constructor(e,t=!1){super(M(4)),this._isSilhouette=t;const r=A;for(let n=0;n<2;n++)for(const i of I){r.reset(i),r.isAnimated=0!==n;const o=P.createEdgeBuilder(t,r.isAnimated);g.addMonochrome(o.frag);const s=P.createEdgeBuilder(t,r.isAnimated);g.addMonochrome(s.frag),2===i?(_.addFeatureSymbology(s,i,31),_.addFeatureSymbology(o,i,31),this.addTranslucentShader(s,r,e)):(this.addTranslucentShader(s,r,e),_.addFeatureSymbology(o,i,0)),this.addElementId(o,i),r.reset(i),this.addShader(o,r,e)}}get _debugDescription(){return this._isSilhouette?"Silhouette":"Edge"}computeShaderIndex(e){let t=e.isTranslucent?EdgeTechnique._kTranslucent:EdgeTechnique._kOpaque;return t+=EdgeTechnique._kFeature*e.featureMode,e.isAnimated&&(t+=EdgeTechnique._kAnimated),t}}EdgeTechnique._kOpaque=0,EdgeTechnique._kTranslucent=1,EdgeTechnique._kAnimated=2,EdgeTechnique._kFeature=4;class PointStringTechnique extends VariedTechnique{constructor(e){super(M(2)+E);const t=A;this.addHiliteShader(e,y.createPointStringHiliter);for(const r of I){t.reset(r);const n=y.createPointStringBuilder();g.addMonochrome(n.frag);const i=y.createPointStringBuilder();g.addMonochrome(i.frag),2===r?(_.addFeatureSymbology(i,r,29),_.addFeatureSymbology(n,r,29),this.addTranslucentShader(i,t,e)):(this.addTranslucentShader(i,t,e),_.addFeatureSymbology(n,r,0)),this.addElementId(n,r),t.reset(r),this.addShader(n,t,e)}}get _debugDescription(){return"PointString"}computeShaderIndex(e){if(e.isHilite)return e.hasFeatures,PointStringTechnique._kHilite;let t=e.isTranslucent?PointStringTechnique._kTranslucent:PointStringTechnique._kOpaque;return t+=PointStringTechnique._kFeature*e.featureMode}}PointStringTechnique._kOpaque=0,PointStringTechnique._kTranslucent=1,PointStringTechnique._kFeature=2,PointStringTechnique._kHilite=M(PointStringTechnique._kFeature);class PointCloudTechnique extends VariedTechnique{constructor(e){super(M(1)+E);const t=A;this.addHiliteShader(e,v.createPointCloudHiliter);for(const r of I){t.reset(r);const n=v.createPointCloudBuilder(),i=2===r?12:0;_.addFeatureSymbology(n,r,i,!0),this.addElementId(n,r,!0),this.addShader(n,t,e)}}get _debugDescription(){return"PointCloud"}computeShaderIndex(e){let t;return t=e.isHilite?PointCloudTechnique._kHilite:e.featureMode}}PointCloudTechnique._kHilite=M(1);class Techniques{constructor(){this._list=new Array,this._dynamicTechniqueIds=new Array,this._scratchTechniqueFlags=new o.TechniqueFlags}static create(e){const t=new Techniques;return t.initializeBuiltIns(e),t}getTechnique(e){return this._list.length,this._list[e]}addDynamicTechnique(e,t){for(let r=0;r<this._dynamicTechniqueIds.length;r++)if(this._dynamicTechniqueIds[r]===t)return 19+r;return this._dynamicTechniqueIds.push(t),this._list.push(e),19+this._dynamicTechniqueIds.length-1}execute(e,t,r){const o=this._scratchTechniqueFlags;n.using(new i.ShaderProgramExecutor(e,r),n=>{for(const i of t){i.preExecute(n);const t=i.getTechniqueId(e);if(-1!==t){i.isPrimitiveCommand,o.init(e,r,i.hasAnimation);const s=this.getTechnique(t).getShader(o);n.setProgram(s)&&i.execute(n)}else i.isPrimitiveCommand,i.execute(n);i.postExecute(n)}})}executeForIndexedClassifier(e,t,r,o,s){if((o*=3)<0||o>t.length-3)return;const a=t[o],c=t[o+1],l=t[o+2],u=this._scratchTechniqueFlags;n.using(new i.ShaderProgramExecutor(e,r),t=>{a.preExecute(t);let n=a.getTechniqueId(e);a.isPrimitiveCommand,a.execute(t),a.postExecute(t),c.preExecute(t),n=c.getTechniqueId(e),c.isPrimitiveCommand,u.init(e,r,c.hasAnimation);const i=this.getTechnique(void 0!==s?s:n).getShader(u);t.setProgram(i)&&c.execute(t),c.postExecute(t),l.preExecute(t),n=l.getTechniqueId(e),l.isPrimitiveCommand,l.execute(t),l.postExecute(t)})}draw(e){const t=this.getTechnique(e.geometry.getTechniqueId(e.target)).getShader(o.TechniqueFlags.defaults);n.using(new i.ShaderProgramExecutor(e.target,e.renderPass,t),t=>{t.isValid,t.isValid&&t.draw(e)})}dispose(){for(const e of this._list)n.dispose(e);this._list.length=0}compileShaders(){let e=!0;for(const t of this._list)t.compileShaders()||(e=!1);return e}initializeBuiltIns(e){this._list[9]=new SingularTechnique(a.createClearTranslucentProgram(e)),this._list[14]=new SingularTechnique(c.createClearPickAndColorProgram(e)),this._list[11]=new SingularTechnique(l.createCopyColorProgram(e)),this._list[12]=new SingularTechnique(l.createCopyColorProgram(e,!1)),this._list[10]=new SingularTechnique(u.createCopyPickBuffersProgram(e)),this._list[13]=new SingularTechnique(d.createCopyStencilProgram(e)),this._list[6]=new SingularTechnique(h.createCompositeProgram(2,e)),this._list[7]=new SingularTechnique(h.createCompositeProgram(1,e)),this._list[8]=new SingularTechnique(h.createCompositeProgram(3,e)),this._list[15]=new SingularTechnique(p.createClipMaskProgram(e)),this._list[16]=new SingularTechnique(C.createSkyBoxProgram(e)),this._list[17]=new SingularTechnique(T.createSkySphereProgram(e,!0)),this._list[18]=new SingularTechnique(T.createSkySphereProgram(e,!1)),this._list[0]=new SurfaceTechnique(e),this._list[4]=new EdgeTechnique(e,!1),this._list[5]=new EdgeTechnique(e,!0),this._list[1]=new PolylineTechnique(e),this._list[3]=new PointStringTechnique(e),this._list[2]=new PointCloudTechnique(e),this._list.length}}t.Techniques=Techniques},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(46),i=r(187),o="\nvoid computeSimpleLight (inout float diffuse, inout float specular, vec3 normal, vec3 toEye, vec3 lightDir, float lightIntensity, float specularExponent) {\n  diffuse += lightIntensity * max(dot(normal, lightDir), 0.0);\n  vec3 toReflectedLight = normalize(reflect(lightDir, normal));\n  float specularDot = max(dot(toReflectedLight, toEye), 0.0);\n  specular += lightIntensity * pow(specularDot, specularExponent);\n}\n",s="\n  if (isSurfaceBitSet(kSurfaceBit_ApplyLighting) && baseColor.a > 0.0) {\n    // Lighting algorithms written in terms of non-pre-multiplied alpha...\n    float alpha = baseColor.a;\n    baseColor.rgb /= alpha;\n\n    vec3 normal = normalize(v_n.xyz);\n    vec3 toEye;\n\n    if (!gl_FrontFacing)\n      normal = -normal;\n\n    if (kFrustumType_Perspective == u_frustum.z) // perspective\n      toEye = normalize (v_pos.xyz);\n    else\n      toEye = vec3(0.0, 0.0, -1.0);\n\n    bool    useDefaults = isSurfaceBitSet(kSurfaceBit_IgnoreMaterial);\n    float   specularExp =  useDefaults ? 43.2 : u_specular.a;\n    vec3    specularColor = useDefaults ? vec3(1.0) : u_specular.rgb;\n    float   diffuseWeight = useDefaults ? .6 : u_material.r;\n    float   specularWeight = useDefaults ? .4 : u_material.g;\n    vec3    litColor = vec3(0.0);\n\n    /* ##TODO: IBL\n    baseColor.rgb = applyReflection(baseColor.rgb, normal, u_reflect);\n\n    if (u_lightMix.x > 0.0001) {\n      vec3    normalWorld = normal * u_nmx;\n      vec3 normalWorld = normal * u_nmx;\n      vec3 imageDiffuse = sampleRGBM(u_diffuseMap, normalWorld);\n\n      litColor += u_lightMix.x * toLuminance (imageDiffuse) * baseColor.rgb;\n\n      if (0.0 != u_imageSolar.w) {\n        float diffuseIntensity = 0.0, specularIntensity = 0.0;\n\n        computeSimpleLight(diffuseIntensity, specularIntensity, normalWorld, toEye, u_imageSolar.xyz, 1.0, specularExp);\n        litColor += u_lightMix.x * (u_imageSolar.w * diffuseWeight * diffuseIntensity * baseColor.rgb + specularIntensity * specularWeight * specularColor);\n      }\n    }\n    */\n\n    if (u_lightMix.y > 0.0001) { // Default.\n      float diffuseIntensity = 0.0, specularIntensity = 0.0;\n\n      // Use a pair of lights that is something in-between portrait lighting & something more out-doorsy with a slightly more overhead main light.\n      // This will make more sense in a wider variety of scenes since this is the only lighting currently supported.\n      computeSimpleLight (diffuseIntensity, specularIntensity, normal, toEye, normalize(vec3(0.2, 0.5, 0.5)), 1.0, specularExp);\n      computeSimpleLight (diffuseIntensity, specularIntensity, normal, toEye, normalize(vec3(-0.3, 0.0, 0.3)), .30, specularExp);\n\n      litColor += u_lightMix.y * diffuseWeight * diffuseIntensity * baseColor.rgb + specularIntensity * specularWeight * specularColor;\n    }\n\n    /* ###TODO: Source Lighting\n    if (u_lightMix.z > 0.0) // Source.\n        litColor += u_lightMix.z * computeSourceLighting(normal, toEye, v_pos, specularExp, specularColor, baseColor.rgb);\n    */\n\n    if (u_lightMix.a > 0.0)\n        litColor.rgb += u_lightMix.a * baseColor.rgb;\n\n    // Clamp while preserving hue.\n    float   maxIntensity = max(litColor.r, max(litColor.g, litColor.b));\n\n    baseColor.rgb = (maxIntensity > 1.0) ? (litColor / maxIntensity) : litColor;\n\n    // Restore pre-multiplied alpha...\n    baseColor.rgb *= alpha;\n  }\n\n  return baseColor;\n",a={lightMix:new Float32Array(4)};t.addLighting=function(e){n.addFrustum(e);const t=e.frag;t.addUniform("u_lightMix",5,e=>{e.addGraphicUniform("u_lightMix",(e,t)=>{const r=a.lightMix;r[0]=0,r[1]=0,r[2]=0,r[3]=0,void 0===t.target?r[0]=1:(r[1]=.92,r[3]=.08),e.setUniform4fv(r)})}),t.addUniform("u_material",4,e=>{e.addGraphicUniform("u_material",(e,t)=>{const r=t.target.currentViewFlags.materials?t.geometry.material:void 0,n=void 0!==r?r.weights:i.Material.default.weights;e.setUniform3fv(n)})}),t.addUniform("u_specular",5,e=>{e.addGraphicUniform("u_specular",(e,t)=>{let r=t.target.currentViewFlags.materials?t.geometry.material:void 0;void 0===r&&(r=i.Material.default),e.setUniform4fv(r.specular)})}),t.addFunction(o),t.set(7,s)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(31),i=r(27),o=r(34),s=(r(7),r(46)),a="\n  float unpackFloat(vec4 v) {\n    const float bias = 38.0;\n    v *= 255.0;\n    float temp = v.w / 2.0;\n    float exponent = floor(temp);\n    float sign = (temp - exponent) * 2.0;\n    exponent = exponent - bias;\n    sign = -(sign * 2.0 - 1.0);\n    float unpacked = sign * v.x * (1.0 / 256.0); // shift right 8\n    unpacked += sign * v.y * (1.0 / 65536.0); // shift right 16\n    unpacked += sign * v.z * (1.0 / 16777216.0); // shift right 24\n    return unpacked * pow(10.0, exponent);\n  }\n",c="\n  vec4 getClipPlane(int index) {\n    // ###TODO: oct-encode the normal to reduce # of samples from 4 to 2\n    float y = (float(index) + 0.5) / float(u_numClips);\n    float sx = 0.25;\n    vec2 tc = vec2(0.125, y);\n    float nx = unpackFloat(TEXTURE(s_clipSampler, tc));\n    tc.x += sx;\n    float ny = unpackFloat(TEXTURE(s_clipSampler, tc));\n    tc.x += sx;\n    float nz = unpackFloat(TEXTURE(s_clipSampler, tc));\n    tc.x += sx;\n    float dist = unpackFloat(TEXTURE(s_clipSampler, tc));\n    return vec4(nx, ny, nz, dist);\n  }\n",l="\n  float calcClipPlaneDist(vec4 camPos, vec4 plane, mat4 viewMatrix) {\n    // Transform direction of clip plane\n    vec3 norm = plane.xyz;\n    vec3 viewX = vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]);\n    vec3 viewY = vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]);\n    vec3 viewZ = vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]);\n\n    vec3 dir = vec3(dot(norm, viewX), dot(norm, viewY), dot(norm, viewZ));\n    dir = normalize(dir);\n\n    // Transform distance of clip plane\n    vec3 pos = norm * plane.w;\n    vec3 v0 = vec3(dot(pos, viewX) + viewMatrix[3][0],\n        dot(pos, viewY) + viewMatrix[3][1],\n        dot(pos, viewZ) + viewMatrix[3][2]);\n\n    vec4 viewPlane = vec4(dir, -dot(v0, dir));\n    return dot(camPos, viewPlane);\n  }\n",u="\n  int numPlaneSets = 1;\n  int numSetsClippedBy = 0;\n  bool clippedByCurrentPlaneSet = false;\n  for (int i = 0; i < MAX_CLIPPING_PLANES; i++)\n      {\n      if (i >= u_numClips)\n          break;\n\n      vec4 plane = getClipPlane(i);\n      if (plane.xyz == vec3(0.0)) // indicates start of new clip plane set\n          {\n          numPlaneSets = numPlaneSets + 1;\n          if (clippedByCurrentPlaneSet)\n              numSetsClippedBy = numSetsClippedBy + 1;\n\n          clippedByCurrentPlaneSet = false;\n          }\n      else if (!clippedByCurrentPlaneSet && calcClipPlaneDist(v_eyeSpace, plane, u_viewMatrix) < 0.0)\n          clippedByCurrentPlaneSet = true;\n      }\n\n  if (clippedByCurrentPlaneSet)\n      numSetsClippedBy = numSetsClippedBy + 1;\n\n  if (numSetsClippedBy == numPlaneSets)\n      discard;\n",d="\n  vec2 tc = windowCoordsToTexCoords(gl_FragCoord.xy);\n  vec4 texel = TEXTURE(s_clipSampler, tc);\n  if (texel.r < 0.5)\n    discard;\n";t.addClipping=function(e,t){1===t.type?function(e){e.frag.addUniform("s_clipSampler",8,e=>{e.addGraphicUniform("s_clipSampler",(e,t)=>{const r=t.target.clipMask;void 0!==r&&r.bindSampler(e,o.TextureUnit.ClipVolume)})},3),i.addWindowToTexCoords(e.frag),e.frag.set(10,d)}(e):2===t.type&&function(e,t){const r=e.frag,i=e.vert;s.addEyeSpace(e),e.addUniform("u_numClips",1,e=>{e.addGraphicUniform("u_numClips",(e,t)=>{const r=t.target.hasClipVolume?t.target.clips.count:0;e.setUniform1i(r)})}),n.addModelViewMatrix(i),s.addViewMatrix(r),r.addFunction(a),r.addFunction(c),r.addFunction(l),r.maxClippingPlanes=t,r.addUniform("s_clipSampler",8,e=>{e.addGraphicUniform("s_clipSampler",(e,t)=>{const r=t.target.clips.texture;void 0!==r&&r.bindSampler(e,o.TextureUnit.ClipVolume)})},3),r.set(10,u)}(e,t.numberOfPlanes)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(79),i=r(7),o="return vec4(0.0);",s="\n  FragColor0 = vec4(0.0, 0.0, 0.0, 1.0);\n  FragColor1 = vec4(1.0, 0.0, 0.0, 1.0);\n",a="FragColor = vec4(0.0, 0.0, 0.0, 1.0);";t.createClearTranslucentProgram=function(e){const t=n.createViewportQuadBuilder(!1),r=t.frag;return r.set(1,o),i.System.instance.capabilities.supportsMRTTransparency?(r.addDrawBuffersExtension(),r.set(13,s)):r.set(13,a),t.buildProgram(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(79),i=r(54),o=r(7),s="return u_bgColor;",a="\n  FragColor0 = baseColor;\n  FragColor1 = vec4(0.0);\n  FragColor2 = vec4(0.0);\n  FragColor3 = vec4(0.0);\n";t.createClearPickAndColorProgram=function(e){const t=n.createViewportQuadBuilder(!1),r=t.frag;return r.addUniform("u_bgColor",5,e=>{e.addProgramUniform("u_bgColor",(e,t)=>{i.FloatRgba.fromColorDef(t.target.bgColor).bind(e)})}),r.set(1,s),o.System.instance.capabilities.supportsMRTPickShaders?(r.addDrawBuffersExtension(),r.set(13,a)):r.set(13,"FragColor = baseColor;"),t.buildProgram(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(34),i=r(41),o=r(27),s=r(79),a="return TEXTURE(u_color, v_texCoord);",c="return vec4(TEXTURE(u_color, v_texCoord).rgb, 1.0);";t.createCopyColorProgram=function(e,t=!0){const r=s.createViewportQuadBuilder(!0),l=r.frag;return l.set(1,t?a:c),l.set(13,o.GLSLFragment.assignFragColor),l.addUniform("u_color",8,e=>{e.addGraphicUniform("u_color",(e,t)=>{const r=t.geometry;i.Texture2DHandle.bindSampler(e,r.texture,n.TextureUnit.Zero)})}),r.buildProgram(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(34),i=r(41),o=r(79),s=r(7),a="return vec4(1.0);",c="\n  FragColor0 = TEXTURE(u_pickElementId0, v_texCoord);\n  FragColor1 = TEXTURE(u_pickElementId1, v_texCoord);\n  FragColor2 = TEXTURE(u_pickDepthAndOrder, v_texCoord);\n";t.createCopyPickBuffersProgram=function(e){const t=o.createViewportQuadBuilder(!0),r=t.frag;return r.set(1,a),s.System.instance.capabilities.maxColorAttachments<3?r.set(13,"FragColor = vec4(0.0);"):(r.addUniform("u_pickElementId0",8,e=>{e.addGraphicUniform("u_pickElementId0",(e,t)=>{i.Texture2DHandle.bindSampler(e,t.geometry.elemIdLow,n.TextureUnit.Zero)})},3),r.addUniform("u_pickElementId1",8,e=>{e.addGraphicUniform("u_pickElementId1",(e,t)=>{i.Texture2DHandle.bindSampler(e,t.geometry.elemIdHigh,n.TextureUnit.One)})},3),r.addUniform("u_pickDepthAndOrder",8,e=>{e.addGraphicUniform("u_pickDepthAndOrder",(e,t)=>{i.Texture2DHandle.bindSampler(e,t.geometry.depthAndOrder,n.TextureUnit.Two)})},3),r.addDrawBuffersExtension(),r.set(13,c)),t.buildProgram(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(27),i=r(79),o=r(54),s="return vec4(u_hilite_color.rgb, 1.0);";t.createCopyStencilProgram=function(e){const t=i.createViewportQuadBuilder(!0),r=t.frag;return r.set(1,s),r.set(13,n.GLSLFragment.assignFragColor),r.addUniform("u_hilite_color",5,e=>{e.addGraphicUniform("u_hilite_color",(e,t)=>{const r=t.target.currentViewFlags,n=t.geometry.wantMixHiliteColorForFlash(r,t.target)?0:255;o.FloatRgba.fromColorDef(t.target.hiliteSettings.color,n).bind(e)})}),t.buildProgram(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(34),i=r(41),o=r(79),s=r(27),a=r(91),c="\nbool isEdgePixel(float xOffset, float yOffset) {\n  vec2 t = windowCoordsToTexCoords(gl_FragCoord.xy + vec2(xOffset, yOffset));\n  vec4 texel = TEXTURE(u_hilite, t);\n  return 0.0 != texel.r;\n}\n",l="\nbool isOutlined() {\n  float width = u_hilite_settings.z;\n  if (0.0 == width)\n    return false;\n\n  // 1-pixel-wide outline requires max 9 samples. 2-pixel-wide requires max 25 samples.\n  if (isEdgePixel(0.0, 1.0) || isEdgePixel(1.0, 0.0) || isEdgePixel(1.0, 1.0)\n      || isEdgePixel(0.0, -1.0) || isEdgePixel(-1.0, 0.0) || isEdgePixel(-1.0, -1.0)\n      || isEdgePixel(1.0, -1.0) || isEdgePixel(-1.0, 1.0))\n    return true;\n\n  if (1.0 == width)\n    return false;\n\n  return isEdgePixel(-2.0, -2.0) || isEdgePixel(-1.0, -2.0) || isEdgePixel(0.0, -2.0) || isEdgePixel(1.0, -2.0) || isEdgePixel(2.0, -2.0)\n    || isEdgePixel(-2.0, -1.0) || isEdgePixel(2.0, -1.0)\n    || isEdgePixel(-2.0, 0.0) || isEdgePixel(2.0, 0.0)\n    || isEdgePixel(-2.0, 1.0) || isEdgePixel(2.0, 1.0)\n    || isEdgePixel(-2.0, 2.0) || isEdgePixel(-1.0, 2.0) || isEdgePixel(0.0, 2.0) || isEdgePixel(1.0, 2.0) || isEdgePixel(2.0, 2.0);\n}\n",u="\nbool isInHiliteRegion() { return 0.0 != TEXTURE(u_hilite, v_texCoord).r; }\n",d="\nvec4 computeColor() { return TEXTURE(u_opaque, v_texCoord); }\n",h="\n  bool isHilite = isInHiliteRegion();\n  if (isHilite || !isOutlined()) {\n    float ratio = isHilite ? u_hilite_settings.y : 0.0;\n    vec4 baseColor = computeColor();\n    baseColor.rgb = mix(baseColor.rgb, u_hilite_color.rgb, ratio);\n    return baseColor;\n  } else {\n    return vec4(u_hilite_color.rgb, 1.0);\n  }\n",p="\nvec4 computeColor() {\n  vec4 opaque = TEXTURE(u_opaque, v_texCoord);\n  vec4 accum = TEXTURE(u_accumulation, v_texCoord);\n  float r = TEXTURE(u_revealage, v_texCoord).r;\n\n  vec4 transparent = vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);\n  return (1.0 - transparent.a) * transparent + transparent.a * opaque;\n}\n",f="return computeColor();";t.createCompositeProgram=function(e,t){const r=0!==(2&e),g=0!==(1&e),m=o.createViewportQuadBuilder(!0),y=m.frag;return y.set(13,s.GLSLFragment.assignFragColor),y.addUniform("u_opaque",8,e=>{e.addGraphicUniform("u_opaque",(e,t)=>{i.Texture2DHandle.bindSampler(e,t.geometry.opaque,n.TextureUnit.Zero)})}),r&&(a.addHiliteSettings(y),s.addWindowToTexCoords(y),y.addFunction(c),y.addFunction(l),y.addFunction(u),y.addUniform("u_hilite",8,e=>{e.addGraphicUniform("u_hilite",(e,t)=>{i.Texture2DHandle.bindSampler(e,t.geometry.hilite,n.TextureUnit.Three)})}),y.set(1,h),g||y.addFunction(d)),g&&(y.addUniform("u_accumulation",8,e=>{e.addGraphicUniform("u_accumulation",(e,t)=>{i.Texture2DHandle.bindSampler(e,t.geometry.accum,n.TextureUnit.One)})}),y.addUniform("u_revealage",8,e=>{e.addGraphicUniform("u_revealage",(e,t)=>{i.Texture2DHandle.bindSampler(e,t.geometry.reveal,n.TextureUnit.Two)})}),y.addFunction(p),r||y.set(1,f)),m.buildProgram(t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(45),i=r(27),o=r(31),s="return u_mvp * rawPos;",a="return vec4(1.0);";t.createClipMaskProgram=function(e){const t=new n.ProgramBuilder(!1);return o.addModelViewProjectionMatrix(t.vert),t.vert.set(3,s),t.frag.set(1,a),t.frag.set(13,i.GLSLFragment.assignFragColor),t.buildProgram(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(27),i=r(31),o=r(46),s=r(7),a="\nfloat computeAlphaWeight(float a, bool flatAlpha) {\n  // See Weighted Blended Order-Independent Transparency for examples of different weighting functions:\n  // http://jcgt.org/published/0002/02/09/\n  // We are using Equation 10 from the above paper.  Equation 10 directly uses screen-space gl_FragCoord.z.\n\n  // flatAlphaWeight bit is set if we want to apply OIT transparency using a constant Z value of 1.\n  // computeLinearDepth() removes the perspective and puts z in linear [0..1]\n  float z = flatAlpha ? 1.0 : computeLinearDepth(v_eyeSpace.z);\n  return pow(a + 0.01, 4.0) + max(1e-2, 3.0 * 1e3 * pow(z, 3.0));\n}\n",c="\n  bool flatAlpha = isShaderBitSet(kShaderBit_OITScaleOutput);\n  vec3 Ci = baseColor.rgb;\n  float ai = min(0.99, baseColor.a); // OIT algorithm does not nicely handle a=1\n  float wzi = computeAlphaWeight(ai, flatAlpha);\n\n  // If we are scaling output into the 0 to 1 range, we use the maximum output of the alpha weight function.\n  float outputScale = flatAlpha ? 1.0 / 3001.040604 : 1.0;\n\n  vec4 output0 = vec4(Ci * wzi * outputScale, ai);\n  vec4 output1 = vec4(ai * wzi * outputScale);\n",l=c+"\n  FragColor0 = output0;\n  FragColor1 = output1;\n",u=c+"\n  FragColor = (0 == u_renderTargetIndex) ? output0 : output1;\n";t.addTranslucency=function(e){const t=e.frag;o.addEyeSpace(e),o.addFrustum(e),i.addModelViewMatrix(e.vert),t.addFunction(n.GLSLFragment.computeLinearDepth),t.addFunction(a),s.System.instance.capabilities.supportsMRTTransparency?(t.addDrawBuffersExtension(),t.set(13,l)):(n.addRenderTargetIndex(t),t.set(13,u))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(54),i="\n  if (!isShaderBitSet(kShaderBit_Monochrome))\n    return baseColor;\n\n  // The alpha component of the mono color = 1.0 if lit, 0.0 if unlit\n  // We need to use the mono color directly for unlit stuff (i.e. edges, polylines) in order for white-on-white reversal to work correctly.\n  // But it looks terrible for lit surfaces.\n  if (u_monoRgb.a  > 0.5) {\n    // Preserve translucency...\n    if (baseColor.a > 0.0)\n      baseColor.rgb /= baseColor.a;\n\n    baseColor.rgb = vec3(dot(baseColor.rgb, vec3(.222, .707, .071)));\n    baseColor.rgb *= u_monoRgb.rgb;\n  } else {\n    baseColor.rgb = u_monoRgb.rgb;\n  }\n\n  baseColor.rgb *= baseColor.a;\n  return baseColor;\n";t.addMonochrome=function(e){e.set(8,i),e.addUniform("u_monoRgb",5,e=>{e.addGraphicUniform("u_monoRgb",(e,t)=>{const r=t.geometry.isLitSurface?0:255;n.FloatRgba.fromColorDef(t.target.monoColor,r).bind(e)})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(91),i=r(31),o=r(46),s=r(145),a=r(27),c=r(45),l="\n  float lineWeight = ComputeLineWeight();\n  if (lineWeight > 4.0)\n    lineWeight += 0.5; // ###TODO: Fudge factor for rounding fat points...\n\n  gl_PointSize = lineWeight;\n  return u_mvp * rawPos;\n",u="\n  // gl_PointSize specifies coordinates of this fragment within the point in range [0,1].\n  // This should be the most precise of the many approaches we've tried, but it still yields some asymmetry...\n  // Discarding if it meets radius precisely seems to reduce that slightly...\n  // ###TODO try point sprites?\n  const vec2 center = vec2(0.5, 0.5);\n  vec2 vt = gl_PointCoord - center;\n  return dot(vt, vt) * v_roundCorners >= 0.25; // meets or exceeds radius of circle\n",d="  v_roundCorners = gl_PointSize > 4.0 ? 1.0 : 0.0;";function h(){const e=new c.ProgramBuilder(!0),t=e.vert;return t.set(3,l),i.addModelViewProjectionMatrix(t),t.addFunction(i.GLSLVertex.computeLineWeight),t.addUniform("u_lineWeight",2,e=>{e.addGraphicUniform("u_lineWeight",(e,t)=>{e.setUniform1f(t.geometry.getLineWeight(t.programParams))})}),e.addInlineComputedVarying("v_roundCorners",2,d),e.frag.set(0,u),e}t.createPointStringHiliter=function(){const e=h();return n.addHiliter(e,!0),e},t.createPointStringBuilder=function(){const e=h();return o.addShaderFlags(e),s.addColor(e),a.addWhiteOnWhiteReversal(e.frag),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(31),i=r(91),o=r(45),s=r(11),a="gl_PointSize = 1.0; return u_mvp * rawPos;",c="return vec4(a_color, 1.0);",l="return v_color;";function u(){const e=new o.ProgramBuilder(!1),t=e.vert;return t.set(3,a),n.addModelViewProjectionMatrix(t),e}t.createPointCloudBuilder=function(){const e=u();return e.vert.addAttribute("a_color",4,e=>{e.addAttribute("a_color",(e,t)=>{const r=t.geometry;void 0!==r&&void 0!==r.colors&&e.enableArray(r.colors,3,s.GL.DataType.UnsignedByte,!0,0,0)})}),e.addFunctionComputedVarying("v_color",5,"computeNonUniformColor",c),e.frag.set(1,l),e},t.createPointCloudHiliter=function(){const e=u();return i.addHiliter(e,!1,!0),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(45),i=r(31),o=r(316),s=r(11),a=r(145),c=r(27),l=r(46),u=r(315),d=r(139),h=r(31),p=r(185),f="\n  g_otherIndex = decodeUInt32(a_endPointAndQuadIndices.xyz);\n  vec2 tc = computeLUTCoords(g_otherIndex, u_vertParams.xy, g_vert_center, u_vertParams.z);\n  vec4 enc1 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  tc.x += g_vert_stepX;\n  vec4 enc2 = floor(TEXTURE(u_vertLUT, tc) * 255.0 + 0.5);\n  vec3 qpos = vec3(decodeUInt16(enc1.xy), decodeUInt16(enc1.zw), decodeUInt16(enc2.xy));\n  g_otherPos = unquantizePosition(qpos, u_qOrigin, u_qScale);\n  g_quadIndex = a_endPointAndQuadIndices.w;\n",g="g_otherPos.xyz += computeAnimationDisplacement(g_otherIndex, u_animDispParams.x, u_animDispParams.y, u_animDispParams.z, u_qAnimDispOrigin, u_qAnimDispScale);\n",m="\n  vec3 n0 = u_nmx * octDecodeNormal(a_normals.xy);\n  vec3 n1 = u_nmx * octDecodeNormal(a_normals.zw);\n\n  if (0.0 == u_mvp[0].w) {\n    return n0.z * n1.z > 0.0;           // orthographic.\n  } else {\n    vec4  viewPos = u_mv * rawPos;     // perspective\n    vec3  toEye = normalize(viewPos.xyz);\n    float dot0 = dot(n0, toEye);\n    float dot1 = dot(n1, toEye);\n\n    if (dot0 * dot1 > 0.0)\n      return true;\n\n    // Need to discard if either is non-silhouette.\n    vec4 otherPosition = g_otherPos;\n    viewPos = u_mv * otherPosition;\n    toEye = normalize(viewPos.xyz);\n    dot0 = dot(n0, toEye);\n    dot1 = dot(n1, toEye);\n\n    return dot0 * dot1 > 0.0;\n  }\n",y="\n  v_lnInfo = vec4(0.0, 0.0, 0.0, 0.0);  // init and set flag to false\n  vec4  pos = u_mvp * rawPos;\n  vec4  other = g_otherPos;\n  vec3  modelDir = other.xyz - pos.xyz;\n  float miterAdjust = 0.0;\n  float weight = ComputeLineWeight();\n\n  g_windowPos = modelToWindowCoordinates(rawPos, other);\n\n  if (g_windowPos.w == 0.0) // Clipped out.\n    return g_windowPos;\n\n  vec4 projOther = modelToWindowCoordinates(other, rawPos);\n\n  g_windowDir = projOther.xy - g_windowPos.xy;\n\n  adjustWidth(weight, g_windowDir, g_windowPos.xy);\n  g_windowDir = normalize(g_windowDir);\n\n  vec2  perp = vec2(-g_windowDir.y, g_windowDir.x);\n  float perpDist = weight / 2.0;\n  float alongDist = 0.0;\n\n  if (g_quadIndex == 1.0) {\n    perpDist = -perpDist;\n  } else if (g_quadIndex == 2.0) {\n    perpDist = -perpDist;\n    alongDist = distance(rawPos, other);\n  } else if (g_quadIndex == 3.0) {\n    alongDist = distance(rawPos, other);\n  }\n\n  pos.x += perp.x * perpDist * 2.0 * pos.w / u_viewport.z;\n  pos.y += perp.y * perpDist * 2.0 * pos.w / u_viewport.w;\n\n  lineCodeEyePos = .5 * (rawPos + other);\n  lineCodeDist = alongDist;\n\n  return pos;\n",v="g_windowDir, g_windowPos, 0.0";t.createEdgeBuilder=function(e,t){const r=function(e,t){const r=new n.ProgramBuilder(!0,t),a=r.vert;return a.addGlobal("g_otherPos",5),a.addGlobal("g_quadIndex",2),a.addGlobal("g_windowPos",5),a.addGlobal("g_windowDir",3),a.addGlobal("g_otherIndex",2),a.addInitializer(f),t&&a.addInitializer(g),a.addGlobal("lineCodeEyePos",5),a.addGlobal("lineCodeDist",2,"0.0"),o.addModelToWindowCoordinates(a),i.addProjectionMatrix(a),u.addLineCode(r,v),a.set(3,y),a.addFunction(i.GLSLVertex.computeLineWeight),r.addVarying("v_lnInfo",5),a.addFunction(u.adjustWidth),o.addViewport(a),i.addModelViewMatrix(a),t&&i.addAnimation(a,!1,!1),a.addAttribute("a_endPointAndQuadIndices",5,e=>{e.addAttribute("a_endPointAndQuadIndices",(e,t)=>{const r=t.geometry;d.EdgeGeometry;const n=r;e.enableArray(n.endPointAndQuadIndices,4,s.GL.DataType.UnsignedByte,!1,0,0)})}),a.addUniform("u_lineWeight",2,e=>{e.addGraphicUniform("u_lineWeight",(e,t)=>{e.setUniform1f(t.geometry.getLineWeight(t.programParams))})}),e&&(h.addNormalMatrix(a),a.set(0,m),a.addFunction(p.octDecodeNormal),a.addAttribute("a_normals",5,e=>{e.addAttribute("a_normals",(e,t)=>{const r=t.geometry;d.SilhouetteEdgeGeometry;const n=r;e.enableArray(n.normalPairs,4,s.GL.DataType.UnsignedByte,!1,0,0)})})),r}(e,t);return l.addShaderFlags(r),a.addColor(r),c.addWhiteOnWhiteReversal(r.frag),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(45),i=r(34),o=r(137),s="return vec4(0, 0, 0, 0);",a="FragColor = TEXTURE_CUBE(s_cube, v_texDir);",c="vec3 pos = u_rot * vec3(rawPos.x, rawPos.z, -rawPos.y); return pos.xyzz;",l="v_texDir = rawPosition.xyz;";t.createSkyBoxProgram=function(e){const t=new n.ProgramBuilder(!1);return t.frag.set(1,s),t.frag.set(13,a),t.vert.set(3,c),t.vert.addUniform("u_rot",6,e=>{e.addGraphicUniform("u_rot",(e,t)=>{const r=t.viewMatrix.getRotation(),n=new o.Matrix3;n.m00=-r.m00,n.m01=-r.m01,n.m02=-r.m02,n.m10=-r.m10,n.m11=-r.m11,n.m12=-r.m12,n.m20=r.m20,n.m21=r.m21,n.m22=r.m22,e.setMatrix3(n)})}),t.frag.addUniform("s_cube",9,e=>{e.addGraphicUniform("s_cube",(e,t)=>{t.geometry.cube.texture.bindSampler(e,i.TextureUnit.Zero)})}),t.addInlineComputedVarying("v_texDir",4,l),t.buildProgram(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(0);const n=r(27),i=r(79),o=r(295),s=r(3),a=r(44),c=r(11),l=r(34),u=r(7),d="\n  // For the gradient sky it's good enough to calculate these in the vertex shader.\n  vec3 eyeToVert = a_worldPos - u_worldEye;\n  float radius = sqrt(eyeToVert.x * eyeToVert.x + eyeToVert.y * eyeToVert.y);\n  float zValue = eyeToVert.z - radius * u_zOffset;\n  float d = atan(zValue, radius);\n  if (u_skyParams.x < 0.0) { // 2-color gradient\n    d = 0.5 - d / 3.14159265359;\n    return vec4(d, 0.0, 0.0, 0.0);\n  }\n  d = d / 1.570796326795;\n  return vec4(d, 1.0 - (d - horizonSize) / (1.0 - horizonSize), 1.0 - (-d - horizonSize) / (1.0 - horizonSize), (d + horizonSize) / (horizonSize * 2.0));\n",h="\n  if (u_skyParams.x < 0.0) // 2-color\n    return vec4(mix(u_zenithColor, u_nadirColor, v_gradientValue.x), 1.0);\n\n  if (v_gradientValue.x > horizonSize) // above horizon\n    return vec4(mix(u_zenithColor, u_skyColor, pow(v_gradientValue.y, u_skyParams.y)), 1.0);\n  else if (v_gradientValue.x < -horizonSize) // below horizon\n    return vec4(mix(u_nadirColor, u_groundColor, pow(v_gradientValue.z, u_skyParams.z)), 1.0);\n\n  return vec4(mix(u_groundColor, u_skyColor, v_gradientValue.w), 1.0);\n",p="v_eyeToVert = a_worldPos - u_worldEye;",f="\n  // For the texture we must calculate these per pixel.  Alternatively we could use a finer mesh.\n  float radius = sqrt(v_eyeToVert.x * v_eyeToVert.x + v_eyeToVert.y * v_eyeToVert.y);\n  float zValue = v_eyeToVert.z - radius * u_zOffset;\n  float u = 0.25 - (atan(v_eyeToVert.y, v_eyeToVert.x) + u_rotation) / 6.28318530718;\n  float v = 0.5 - atan(zValue, radius) / 3.14159265359;\n  if (u < 0.0)\n    u += 1.0;\n  if (v < 0.0)\n    v += 1.0;\n  return TEXTURE(s_skyTxtr, vec2(u, v));\n",g=new Float32Array(3),m=new s.Vector3d,y=new s.Point3d;t.createSkySphereProgram=function(e,t){const r=i.createViewportQuadBuilder(!1);t?(r.addFunctionComputedVarying("v_gradientValue",5,"computeGradientValue",d),r.addGlobal("horizonSize",2,3,"0.0015",!0)):r.addInlineComputedVarying("v_eyeToVert",4,p);const v=r.vert;v.addAttribute("a_worldPos",4,e=>{e.addAttribute("a_worldPos",(e,t)=>{const r=t.geometry;a.SkySphereViewportQuadGeometry;const n=r;!function(e,t){const r=e.worldPos;let n=t.getCorner(0).interpolate(.5,t.getCorner(4),y);r[0]=n.x,r[1]=n.y,r[2]=n.z,n=t.getCorner(1).interpolate(.5,t.getCorner(5),y),r[3]=n.x,r[4]=n.y,r[5]=n.z,n=t.getCorner(3).interpolate(.5,t.getCorner(7),y),r[6]=n.x,r[7]=n.y,r[8]=n.z,n=t.getCorner(2).interpolate(.5,t.getCorner(6),y),r[9]=n.x,r[10]=n.y,r[11]=n.z}(n,t.target.planFrustum),n.bind(),e.enableArray(n.worldPosBuff,3,c.GL.DataType.Float,!1,0,0)})}),v.addUniform("u_worldEye",4,e=>{e.addGraphicUniform("u_worldEye",(e,t)=>{const r=t.target.planFrustum;if(2===t.target.frustumUniforms.type){const n=r.getCorner(0),i=r.getCorner(4),a=1/(1-t.target.planFraction),c=s.Vector3d.createStartEnd(n,i,m),l=o.fromSumOf(n,c,a,y);g[0]=l.x,g[1]=l.y,g[2]=l.z,e.setUniform3fv(g)}else{const t=s.Vector3d.createStartEnd(r.getCorner(0),r.getCorner(4)),n=22.5,i=r.getCorner(0).distance(r.getCorner(3))/(2*Math.atan(n*s.Constant.radiansPerDegree)),o=s.Point3d.createAdd3Scaled(r.getCorner(0),.5,r.getCorner(3),.5,t,i/t.magnitude());g[0]=o.x,g[1]=o.y,g[2]=o.z,e.setUniform3fv(g)}})}),t&&(v.addUniform("u_skyParams",4,e=>{e.addGraphicUniform("u_skyParams",(e,t)=>{const r=t.geometry;e.setUniform3fv(r.typeAndExponents)})}),v.addUniform("u_zOffset",2,e=>{e.addGraphicUniform("u_zOffset",(e,t)=>{const r=t.geometry;e.setUniform1f(r.zOffset)})}));const _=r.frag;return t?(_.addUniform("u_skyParams",4,e=>{e.addGraphicUniform("u_skyParams",(e,t)=>{const r=t.geometry;e.setUniform3fv(r.typeAndExponents)})}),_.addUniform("u_zenithColor",4,e=>{e.addGraphicUniform("u_zenithColor",(e,t)=>{const r=t.geometry;e.setUniform3fv(r.zenithColor)})}),_.addUniform("u_skyColor",4,e=>{e.addGraphicUniform("u_skyColor",(e,t)=>{const r=t.geometry;e.setUniform3fv(r.skyColor)})}),_.addUniform("u_groundColor",4,e=>{e.addGraphicUniform("u_groundColor",(e,t)=>{const r=t.geometry;e.setUniform3fv(r.groundColor)})}),_.addUniform("u_nadirColor",4,e=>{e.addGraphicUniform("u_nadirColor",(e,t)=>{const r=t.geometry;e.setUniform3fv(r.nadirColor)})}),_.set(1,h)):(_.addUniform("s_skyTxtr",8,e=>{e.addGraphicUniform("s_skyTxtr",(e,t)=>{const r=t.geometry;void 0!==r.skyTexture?r.skyTexture.texture.bindSampler(e,l.TextureUnit.Zero):u.System.instance.ensureSamplerBound(e,l.TextureUnit.FeatureSymbology)})}),_.addUniform("u_zOffset",2,e=>{e.addGraphicUniform("u_zOffset",(e,t)=>{const r=t.geometry;e.setUniform1f(r.zOffset)})}),_.addUniform("u_rotation",2,e=>{e.addGraphicUniform("u_rotation",(e,t)=>{const r=t.geometry;e.setUniform1f(r.rotation)})}),_.set(1,f)),_.set(13,n.GLSLFragment.assignFragColor),r.vert.headerComment="// ----- SkySphere -----",r.frag.headerComment="// ----- SkySphere -----",r.buildProgram(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(107),o=r(44),s=r(106),a=r(89),c=r(181),l=r(11),u=r(7),d=r(0);class PolylineGeometry extends o.LUTGeometry{constructor(e,t,r){super(),this.vertexParams=r.vertices.qparams,this.features=s.FeaturesInfo.createFromVertexTable(r.vertices),this.lineWeight=r.weight,this.lineCode=a.LineCode.valueFromLinePixels(r.linePixels),this.type=r.type,this._isPlanar=r.isPlanar,this.lut=e,this.numIndices=r.polyline.indices.length,this._buffers=t}dispose(){d.dispose(this.lut),d.dispose(this._buffers)}get isAnyEdge(){return n.PolylineTypeFlags.Normal!==this.type}get isNormalEdge(){return n.PolylineTypeFlags.Edge===this.type}get isOutlineEdge(){return n.PolylineTypeFlags.Outline===this.type}get renderOrder(){return this.isAnyEdge?this.isPlanar?12:4:this.isPlanar?11:3}_wantWoWReversal(e){return!0}get polylineBuffers(){return this._buffers}_computeEdgePass(e,t){const r=e.currentViewFlags;return 6!==r.renderMode||r.visibleEdges?0===r.renderMode&&r.transparency&&t.hasTranslucency?5:1:255}getRenderPass(e){const t=e.currentViewFlags;if(this.isEdge){let r=this._computeEdgePass(e,this.lut.colorInfo);return 255!==r&&this.isOutlineEdge&&0===t.renderMode&&t.fill&&(r=255),r}return t.transparency&&this.lut.colorInfo.hasTranslucency?5:1}getTechniqueId(e){return 1}get isPlanar(){return this._isPlanar}get isEdge(){return this.isAnyEdge}get qOrigin(){return this.lut.qOrigin}get qScale(){return this.lut.qScale}get numRgbaPerVertex(){return this.lut.numRgbaPerVertex}get featuresInfo(){return this.features}_getLineWeight(e){return this.isEdge?e.target.getEdgeWeight(e,this.lineWeight):this.lineWeight}_getLineCode(e){return this.isEdge?e.target.getEdgeLineCode(e,this.lineCode):this.lineCode}getColor(e){return this.isEdge&&e.isEdgeColorOverridden?e.edgeColor:this.lut.colorInfo}bindVertexArray(e){e.enableArray(this._buffers.indices,3,l.GL.DataType.UnsignedByte,!1,0,0)}draw(){const e=u.System.instance.context;this._buffers.indices.bind(l.GL.Buffer.Target.ArrayBuffer),e.drawArrays(l.GL.PrimitiveType.Triangles,0,this.numIndices)}static create(e){const t=c.VertexLUT.createFromVertexTable(e.vertices);if(void 0===t)return;const r=o.PolylineBuffers.create(e.polyline);return void 0!==r?new PolylineGeometry(t,r,e):void 0}}t.PolylineGeometry=PolylineGeometry;class PolylinePrimitive extends i.Primitive{constructor(e){super(e)}static create(e){const t=PolylineGeometry.create(e);return void 0!==t?new PolylinePrimitive(t):void 0}get renderOrder(){return this.cachedGeometry.renderOrder}get isPlanar(){return this.cachedGeometry.isPlanar}get isEdge(){return this.cachedGeometry.isEdge}}t.PolylinePrimitive=PolylinePrimitive},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(107),o=r(44),s=r(181),a=r(106),c=r(65),l=r(11),u=r(7);class PointStringGeometry extends o.LUTGeometry{constructor(e,t,r,n,i,o){super(),this.numIndices=t,this.indices=e,this.lut=r,this.vertexParams=n,this.weight=i,this.features=o}_wantWoWReversal(e){return!0}getTechniqueId(e){return 3}getRenderPass(e){return 1}get featuresInfo(){return this.features}get renderOrder(){return 11}bindVertexArray(e){e.enableArray(this.indices,3,l.GL.DataType.UnsignedByte,!1,0,0)}_getLineWeight(e){return this.weight}draw(){const e=u.System.instance.context;this.indices.bind(l.GL.Buffer.Target.ArrayBuffer),e.drawArrays(l.GL.PrimitiveType.Points,0,this.numIndices)}static create(e){const t=c.BufferHandle.createArrayBuffer(e.indices.data);if(void 0===t)return;const r=s.VertexLUT.createFromVertexTable(e.vertices);return void 0!==r?new PointStringGeometry(t,e.indices.length,r,e.vertices.qparams,e.weight,a.FeaturesInfo.createFromVertexTable(e.vertices)):void 0}dispose(){n.dispose(this.lut),n.dispose(this.indices)}}t.PointStringGeometry=PointStringGeometry;class PointStringPrimitive extends i.Primitive{static create(e){const t=PointStringGeometry.create(e);return void 0!==t?new PointStringPrimitive(t):void 0}constructor(e){super(e)}get renderOrder(){return 3}}t.PointStringPrimitive=PointStringPrimitive},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(106),i=r(107),o=r(44),s=r(65),a=r(11),c=r(7),l=r(0);class PointCloudPrimitive extends i.Primitive{get renderOrder(){return 2}addCommands(e){e.addPrimitive(this)}dispose(){}static create(e){return new PointCloudPrimitive(e)}constructor(e){super(new PointCloudGeometry(e))}}t.PointCloudPrimitive=PointCloudPrimitive;class PointCloudGeometry extends o.CachedGeometry{constructor(e){super(),this._colorHandle=void 0,this._vertices=s.QBufferHandle3d.create(e.pointParams,e.points),this._vertexCount=e.points.length/3,this.features=n.FeaturesInfo.create(e.features),void 0!==e.colors&&(this._colorHandle=s.BufferHandle.createArrayBuffer(e.colors))}dispose(){l.dispose(this._vertices)}_wantWoWReversal(e){return!1}getTechniqueId(e){return 2}getRenderPass(e){return 3}get renderOrder(){return 2}get qOrigin(){return this._vertices.origin}get qScale(){return this._vertices.scale}get colors(){return this._colorHandle}get featuresInfo(){return this.features}get hasBakedLighting(){return!0}bindVertexArray(e){e.enableArray(this._vertices,3,a.GL.DataType.UnsignedShort,!1,0,0)}draw(){c.System.instance.context.drawArrays(a.GL.PrimitiveType.Points,0,this._vertexCount)}}t.PointCloudGeometry=PointCloudGeometry},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3),o=r(4),s=r(26),a=r(44),c=r(20),l=r(141),u=r(41),d=r(11),h=r(7),p=r(140),f=r(90);class PlanesWriter{constructor(e){this._curPos=0,this._view=new DataView(e.buffer)}advance(e){this._curPos+=e}appendFloat(e){this._view.setFloat32(this._curPos,e,!0),this.advance(4)}appendUint8(e){this._view.setUint8(this._curPos,e),this.advance(1)}appendValues(e,t,r,n){this.append(e),this.append(t),this.append(r),this.append(n)}appendPlane(e,t){this.appendValues(e.x,e.y,e.z,t)}appendZeroPlane(){this.appendValues(0,0,0,0)}}class PackedPlanesWriter extends PlanesWriter{constructor(e){super(e)}get numPixelsPerPlane(){return 4}get dataType(){return d.GL.Texture.DataType.Float}append(e){if(0===e)return void this.advance(4);const t=e<0?1:0;e=Math.abs(e);const r=Math.floor(Math.log10(e))+1;let n=256*(e/=Math.pow(10,r));const i=Math.floor(n);n=256*(n-i);const o=Math.floor(n);n=256*(n-o);const s=Math.floor(n),a=2*(r+38)+t;this.appendUint8(i),this.appendUint8(o),this.appendUint8(s),this.appendUint8(a)}}class ClipPlanesVolume extends s.RenderClipVolume{constructor(e){super(),this._texture=e}get type(){return 2}get texture(){return this._texture}static create(e){if(1!==e.clips.length)return;const t=e.clips[0].fetchClipPlanesRef();let r=0,n=0;for(const o of t.convexSets){const e=o.planes.length;0!==e&&(n++,r+=e)}if(0===r)return;const i=this.createTexture(t,r,n);return new ClipPlanesVolume(i)}static createTexture(e,t,r){const n=t+(r-1),i=new Uint8Array(4*n*4);let o;o=new PackedPlanesWriter(i);let s=0;for(const a of e.convexSets)if(0!==a.planes.length){for(const e of a.planes)o.appendPlane(e.inwardNormalRef,e.distance);++s<r&&o.appendZeroPlane()}return u.Texture2DHandle.createForData(o.numPixelsPerPlane,n,i,!1,d.GL.Texture.WrapMode.ClampToEdge,d.GL.Texture.Format.Rgba)}dispose(){this._texture=n.dispose(this._texture)}pushToTarget(e){void 0!==this._texture&&e.clips.set(this._texture.height,this._texture)}pushToShaderExecutor(e){this.pushToTarget(e.target)}pop(e){e.clips.clear()}}t.ClipPlanesVolume=ClipPlanesVolume;class ClipMaskVolume{constructor(e){this.geometry=e,this.frustum=new o.Frustum,this.rect=new c.ViewRect(0,0,0,0)}get type(){return 1}static create(e){const t=e.boundingRange;if(t.isNull)return;const r=[i.Point3d.create(t.low.x,t.low.y,0),i.Point3d.create(t.high.x,t.low.y,0),i.Point3d.create(t.high.x,t.high.y,0),i.Point3d.create(t.low.x,t.high.y,0)],n=i.ClipUtilities.clipPolygonToClipShape(r,e.clips[0]),s=[],c=o.QPoint3dList.createFrom([],o.QParams3d.fromRange(t)),l=new i.StrokeOptions;l.shouldTriangulate=!0;const u=i.PolyfaceBuilder.create(l);for(const o of n)if(!(o.length<3))if(3===o.length)u.addTriangleFacet(o);else if(4===o.length)u.addQuadFacet(o);else if(o.length>4){const e=i.Triangulator.earcutSingleLoop(o);i.Triangulator.cleanupTriangulation(e),u.addGraph(e,!1)}const d=u.claimPolyface(),h=d.pointCount,p=d.data.point;for(let i=0;i<h;i++)c.add(p.getPoint3dAt(i));const f=i.IndexedPolyfaceVisitor.create(d,0);for(;f.moveToNextFacet();)for(let e=0;e<3;e++)s.push(f.clientPointIndex(e));return s.length,0!==s.length&&0!==c.length?new ClipMaskVolume(new a.ClipMaskGeometry(new Uint32Array(s),c)):void 0}get texture(){return this._texture}get fbo(){return this._fbo}dispose(){this._texture=n.dispose(this._texture),this._fbo=n.dispose(this._fbo)}pushToTarget(e){}pushToShaderExecutor(e){const t=this.getTexture(e);void 0!==t&&(e.target.clipMask=t)}pop(e){e.is2d&&void 0!==this._texture&&(e.clipMask=void 0)}getTexture(e){const t=e.target;if(!t.is2d)return;const r=t.planFrustum,n=t.viewRect,i=!this.frustum.equals(r),o=void 0===this._texture||this.rect.width!==n.width||this.rect.height!==n.height;return o&&(this.dispose(),this._texture=u.TextureHandle.createForAttachment(n.width,n.height,d.GL.Texture.Format.Rgba,d.GL.Texture.DataType.UnsignedByte),void 0!==this._texture&&(this._fbo=l.FrameBuffer.create([this._texture]))),this.rect.init(n.left,n.top,n.right,n.bottom),(o||i)&&(this.frustum.setFrom(r),this.render(e)),this._texture}render(e){if(void 0===this._fbo)return;const t=new p.RenderState;t.flags.depthMask=!1,t.flags.blend=!1,t.flags.depthTest=!1,h.System.instance.frameBufferStack.execute(this._fbo,!0,()=>{const r=h.System.instance.currentRenderState.clone(),n=e.target;h.System.instance.applyRenderState(t);const i=h.System.instance.context;i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),void 0===ClipMaskVolume._drawParams&&(ClipMaskVolume._drawParams=new f.DrawParams);const o=ClipMaskVolume._drawParams;o.init(e.params,this.geometry,n.currentTransform),e.drawInterrupt(o),h.System.instance.applyRenderState(r)})}}t.ClipMaskVolume=ClipMaskVolume},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3),o=r(4),s=r(183),a=r(133),c=r(26),l=r(64),u=r(104),d=r(20),h=r(108);class SheetBorder{constructor(e,t,r){this._rect=e,this._shadow=t,this._gradient=r}static create(e,t,r){const n=[i.Point3d.create(0,t),i.Point3d.create(0,0),i.Point3d.create(e,0),i.Point3d.create(e,t),i.Point3d.create(0,t)];r&&r.viewport.worldToViewArray(n);const s=.01*Math.sqrt(e*e+t*t),a=[i.Point3d.create(s,0),i.Point3d.create(s,-s),i.Point3d.create(e+s,-s),i.Point3d.create(e+s,t-s),i.Point3d.create(e,t-s),i.Point3d.create(e,0),i.Point3d.create(s,0)];r&&r.viewport.worldToViewArray(a);const c=new o.Gradient.Symb;c.mode=1,c.angle=i.Angle.createDegrees(-45),c.keys=[{value:0,color:o.ColorDef.from(25,25,25)},{value:.5,color:o.ColorDef.from(150,150,150)}];const l=[];for(const o of n)l.push(i.Point2d.createFrom(o));const u=[];for(const o of a)u.push(i.Point2d.createFrom(o));return new SheetBorder(l,u,c)}getRange(){const e=i.Range2d.createArray(this._rect),t=i.Range2d.createArray(this._shadow);return e.extendRange(t),e}addToBuilder(e){const t=o.ColorDef.black,r=o.ColorDef.black,n=new o.GraphicParams;n.setFillColor(r),n.gradient=this._gradient,e.activateGraphicParams(n),e.addShape2d(this._shadow,c.RenderTarget.frustumDepth2d),e.setSymbology(t,r,2),e.addLineString2d(this._rect,0)}}var p;t.SheetBorder=SheetBorder,function(e){class AttachmentViewport extends d.OffScreenViewport{constructor(){super(...arguments),this.rendering=!1,this.toParent=i.Transform.createIdentity(),this._sceneDepth=4294967295}get texture(){return this._texture}createScene(e){if(1===e||3===e)return e;const t=this.view;t.areFeatureOverridesDirty&&(this.target.overrideFeatureSymbology(new a.FeatureSymbology.Overrides(t)),t.setFeatureOverridesDirty(!1)),this.sync.isValidController||this.setupFromView(),this._scene=[];const r=new u.SceneContext(this,new l.TileRequests);return t.createScene(r),r.requests.requestMissing(),!t.areAllTileTreesLoaded||r.requests.hasMissingTiles?2:3}renderImage(){return this.sync.isValidRenderPlan||(this.target.changeRenderPlan(c.RenderPlan.createFromViewport(this)),this.sync.setValidRenderPlan()),this.target.changeScene(this._scene),this.renderFrame(),this._texture=void 0,this.readImage()}renderTexture(){const e=this.renderImage();if(void 0===e)return;const t=new o.RenderTexture.Params(void 0,2);this._texture=this.target.renderSystem.createTextureFromImageBuffer(e,this.view.iModel,t),this._texture}setSceneDepth(e,t){if(this._sceneDepth!==e){4294967295!==this._sceneDepth&&3===t.getState(this._sceneDepth)&&t.setState(this._sceneDepth,0),this.sync.invalidateScene(),this.view.cancelAllTileLoads(),this._sceneDepth=e;let r=s;r*=Math.pow(2,e),this.setRect(new d.ViewRect(0,0,r,r),!0)}}get isAspectRatioLocked(){return!0}}let t,r;e.AttachmentViewport=AttachmentViewport,function(e){e[e.UpperLeft=0]="UpperLeft",e[e.UpperRight=1]="UpperRight",e[e.LowerLeft=2]="LowerLeft",e[e.LowerRight=3]="LowerRight",e[e.Root=4]="Root"}(t=e.Tile3dPlacement||(e.Tile3dPlacement={})),function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Empty=1]="Empty",e[e.Loading=2]="Loading",e[e.Ready=3]="Ready"}(r=e.State||(e.State={}));const s=512;class AttachmentTileLoader extends l.TileLoader{tileRequiresLoading(e){return!0}async getChildrenProps(e){return Promise.resolve([])}async loadTileContents(e){return Promise.resolve()}}class TileLoader2d extends AttachmentTileLoader{constructor(e){super(),this._viewFlagOverrides=new o.ViewFlag.Overrides(e.viewFlags),this._viewFlagOverrides.setShowCameraLights(!1)}get maxDepth(){return 1}get viewFlagOverrides(){return this._viewFlagOverrides}get is3dAttachment(){return!1}}class TileLoader3d extends AttachmentTileLoader{get maxDepth(){return 32}get viewFlagOverrides(){return TileLoader3d._viewFlagOverrides}get is3dAttachment(){return!0}}TileLoader3d._DEBUG_NO_TEXTURES=!1,TileLoader3d._viewFlagOverrides=new o.ViewFlag.Overrides(o.ViewFlags.fromJSON({renderMode:6,noCameraLights:!0,noSourceLights:!0,noSolarLight:!0,noTexture:TileLoader3d._DEBUG_NO_TEXTURES}));class Tile2d extends l.Tile{constructor(e,t){super(new l.Tile.Params(e,"",new o.ElementAlignedBox3d(0,0,-c.RenderTarget.frustumDepth2d,t.high.x,t.high.y,c.RenderTarget.frustumDepth2d),512,!0)),this.setIsReady()}get hasChildren(){return!1}get hasGraphics(){return!0}drawGraphics(e){const t=this.root,r=t.viewRoot,n=r.createDrawArgs(e.context);n.location.setFrom(t.drawingToAttachment),n.clip=t.graphicsClip,n.graphics.setViewFlagOverrides(this.root.viewFlagOverrides),n.graphics.symbologyOverrides=t.symbologyOverrides,r.draw(n)}}e.Tile2d=Tile2d;class Tile3d extends l.Tile{constructor(e,t,r){super(new l.Tile.Params(e,"",r,.5*Math.sqrt(2*s*s),!0,t)),this._tilePolyfaces=[]}static create(e,t,r){let n;const s=(n=void 0!==t?t.range.clone():e.getRootRange()).low.interpolate(.5,n.high),a=new o.ElementAlignedBox3d;switch(r){case 0:a.extend(s),a.extend(i.Point3d.create(n.low.x,n.high.y,0));break;case 1:a.extend(s),a.extend(n.high);break;case 2:a.extend(n.low),a.extend(s);break;case 3:a.extend(i.Point3d.create(n.high.x,n.low.y,0)),a.extend(s);break;case 4:default:a.extendRange(n)}return a.low.z=0,a.high.z=1,new Tile3d(e,t,a)}get _rootAsTree3d(){return this.root}getState(){return this._rootAsTree3d.getState(this.depth-1)}setState(e){this._rootAsTree3d.setState(this.depth-1,e)}get hasGraphics(){return this.isReady}get hasChildren(){return!0}selectTiles(e,t,r=0){return this.select(e,t)}select(e,t,r=0){if(1===this.depth&&(this._rootAsTree3d.viewport.rendering=!1),this.isNotFound)return 0;const n=this.computeVisibility(t);if(0===n)return this.unloadChildren(t.purgeOlderThan),0;const i=1===n?this.prepareChildren():void 0;if(void 0!==i){const r=e.length;this._childrenLastUsed=t.now;for(const n of i)if(1===n.selectTiles(e,t))return e.length=r,this.isReady?(e.push(this),0):1;return 0}if(!this.isReady){if(0===this._tilePolyfaces.length&&(this.createPolyfaces(t.context),0===this._tilePolyfaces.length))return this.setNotFound(),0;this.createGraphics(t.context)}return this.isReady?(e.push(this),this.unloadChildren(t.purgeOlderThan),0):(this._rootAsTree3d.sheetView.markAttachment3dSceneIncomplete(),1)}createPolyfaces(e){const t=e.target.renderSystem,r=this._rootAsTree3d,n=this.range.low.x,o=this.range.high.x,s=this.range.low.y,a=this.range.high.y,c=[i.Point3d.create(n,s,r.biasDistance),i.Point3d.create(o,s,r.biasDistance),i.Point3d.create(o,a,r.biasDistance),i.Point3d.create(n,a,r.biasDistance)];this._tilePolyfaces=t.createSheetTilePolyfaces(c,r.graphicsClip)}createGraphics(e){const t=this._rootAsTree3d;let r=this.getState();if(1===r)return void this.setNotFound();const n=e.target.renderSystem,i=t.viewport;switch(3!==r&&(i.setSceneDepth(this.depth-1,t),i.setupFromView(),r=i.createScene(r),this.setState(r)),r){case 0:case 2:return;case 1:return void this.setNotFound();case 3:if(!i.rendering){i.rendering=!0;const e=i.getFrustum(),t=s;i.setRect(new d.ViewRect(0,0,t,t));const r=i.getFrustum(1);if(r.initFromRange(this.range),i.viewFrustum.worldToNpcMap.transform1.multiplyPoint3dArrayQuietNormalize(r.points),i.setupViewFromFrustum(r),i.renderTexture(),void 0===i.texture)this.setNotFound();else{const e=n.createGraphicList(n.createSheetTile(i.texture,this._tilePolyfaces,this._rootAsTree3d.tileColor));this.setGraphic(n.createBatch(e,this._rootAsTree3d.featureTable,this.contentRange))}i.setupViewFromFrustum(e)}}}prepareChildren(){if(void 0===this._children&&(this._children=[]),0===this._children.length){const e=Tile3d.create(this._rootAsTree3d,this,0),t=Tile3d.create(this._rootAsTree3d,this,1),r=Tile3d.create(this._rootAsTree3d,this,2),n=Tile3d.create(this._rootAsTree3d,this,3);this._children.push(e),this._children.push(t),this._children.push(r),this._children.push(n)}return 0===this._children.length?void 0:this._children}drawGraphics(e){if(super.drawGraphics(e),!Tile3d._DRAW_DEBUG_POLYFACE_GRAPHICS)return;const t=this._tilePolyfaces;if(0===t.length)return;const r=o.ColorDef.blue.clone(),n=o.ColorDef.green.clone();n.setAlpha(136),r.setAlpha(255);const s=e.context.createGraphicBuilder(1);s.setSymbology(r,n,2);for(const o of t){const e=i.IndexedPolyfaceVisitor.create(o,0);for(;e.moveToNextFacet();){const t=[];for(let r=0;r<3;r++)t.push(e.getPoint(r));t.length>0&&t.push(t[0].clone()),s.addLineString(t)}}e.graphics.add(s.finish())}}Tile3d._DRAW_DEBUG_POLYFACE_GRAPHICS=!1,e.Tile3d=Tile3d;class Tree extends l.TileTree{constructor(e,t,r){const n=e.is3dAttachment;super(new l.TileTree.Params(r,{contentId:"",range:{low:{x:0,y:0,z:0},high:{x:0,y:0,z:0}},maximumSize:512,isLeaf:n},t,!1,e,i.Transform.createIdentity(),r,void 0,void 0))}}e.Tree=Tree;class Tree2d extends Tree{constructor(e,t,r,o){super(new TileLoader2d(r),e,t.id),this.view=r,this.viewRoot=o,this.symbologyOverrides=new a.FeatureSymbology.Overrides(r);const s=t.placement.calculateRange(),l=s.high.x-s.low.x,u=s.high.y-s.low.y,d=r.getExtents(),h=i.Point2d.create(l/d.x,u/d.y),p=i.Point3d.createFrom(t.placement.origin);p.z=c.RenderTarget.depthFromDisplayPriority(t.displayPriority);const f=i.Transform.createOriginAndMatrix(p,i.Matrix3d.createIdentity());this.location.setFrom(f);const g=r.getAspectRatioSkew();this.drawingToAttachment=i.Transform.createOriginAndMatrix(i.Point3d.create(),r.getRotation()),this.drawingToAttachment.matrix.scaleColumns(h.x,g*h.y,1,this.drawingToAttachment.matrix);const m=o.location.origin.cloneAsPoint3d(),y=r.getOrigin().minus(m);this.drawingToAttachment.multiplyPoint3d(y,y),m.plus(y,y),y.z=0;const v=p.minus(y);m.plus(v,m),this.drawingToAttachment.origin.setFrom(m),this.expirationTime=n.BeDuration.fromSeconds(15);const _=f.inverse();void 0!==_&&(this.clipVector=t.getOrCreateClip(_),_.multiplyRange(s,this.clipVector.boundingRange));const w=this.drawingToAttachment.inverse();void 0!==w&&(this.graphicsClip=t.getOrCreateClip(w),w.multiplyRange(s,this.graphicsClip.boundingRange)),this._rootTile=new Tile2d(this,t.placement.bbox)}static create(e){const t=e.view,r=t.getViewedModel();if(!r)return 1;r.getOrLoadTileTree();const n=r.loadStatus();return n===l.TileTree.LoadStatus.Loaded?(e.tree=new Tree2d(r.iModel,e,t,r.tileTree()),3):n===l.TileTree.LoadStatus.Loading?2:1}}e.Tree2d=Tree2d;const h=new class TileColorSequence{constructor(){this._index=0,this._colors=[16711680,65280,255,8388352,8323327,32767,16744192,16711807,65407]}get next(){this._index>=this._colors.length&&(this._index=0);const e=new o.ColorDef(this._colors[this._index]);return e.setAlpha(127),this._index++,e}};class Tree3d extends Tree{constructor(e,t,r,a,l){super(new TileLoader3d,l.iModel,n.Id64.invalid),this.tileColor=h.next;const u=new o.FeatureTable(1);let p;u.insert(new o.Feature(t.id)),this.featureTable=c.PackedFeatureTable.pack(u),this.viewport=a,this.sheetView=e,this.attachment=t;const f=l.getAspectRatio();p=f<1?i.Point2d.create(1/f,1):i.Point2d.create(1,f);const g=s;this.viewport.setRect(new d.ViewRect(0,0,g,g)),this.viewport.setupFromView();const m=this.viewport.getFrustum(1).transformBy(i.Transform.createOriginAndMatrix(i.Point3d.create(),i.Matrix3d.createScale(p.x,p.y,1)));this.viewport.npcToWorldArray(m.points),this.viewport.setupViewFromFrustum(m);const y=l.displayStyle,v=e.displayStyle.backgroundColor.clone();if(v.setAlpha(0),y.backgroundColor.setFrom(v),l.isSpatialView()){const e=l.getDisplayStyle3d().environment;e.ground.display=!1,e.sky.display=!1}const _=t.placement.calculateRange();this.biasDistance=c.RenderTarget.depthFromDisplayPriority(t.displayPriority),_.getNpcToWorldRangeTransform(this.viewport.toParent),this.viewport.toParent.matrix.scaleColumns(p.x,p.y,1,this.viewport.toParent.matrix);const w=this.viewport.toParent.inverse();void 0!==w&&(this.graphicsClip=t.getOrCreateClip(w)),this._rootTile=Tile3d.create(this,void 0,4),this._rootTile.createPolyfaces(r),this.location.setFrom(this.viewport.toParent.clone()),this.expirationTime=n.BeDuration.fromSeconds(15)}static create(e,t,r){const n=t.view,i=AttachmentViewport.create(n);return new Tree3d(e,t,r,i,n)}getState(e){return this.attachment.getState(e)}setState(e,t){this.attachment.setState(e,t)}getRootRange(e){const t=[i.Point3d.create(0,0,this.biasDistance),i.Point3d.create(1,0,this.biasDistance),i.Point3d.create(0,1,this.biasDistance),i.Point3d.create(1,1,this.biasDistance)];return i.Range3d.createArray(t,e)}}e.Tree3d=Tree3d;class Attachment{constructor(e,t){let r,s;this.id=n.Id64.fromJSON(e.id),this.view=t,this.displayPriority=0;const a=e.jsonProperties;e.placement&&(s=o.Placement2d.fromJSON(e.placement)),void 0!==a?(r=void 0!==a.scale?n.JsonUtils.asDouble(a.scale):void 0,this.clip=void 0!==a.clip?i.ClipVector.fromJSON(a.clip):i.ClipVector.createEmpty(),this.displayPriority=n.JsonUtils.asInt(e.jsonProperties.displayPriority)):this.clip=i.ClipVector.createEmpty(),this.clip.parseClipPlanes(),void 0===r&&void 0===s?(r=1,s=Attachment.computePlacement(t,i.Point2d.create(),r)):void 0===r?r=Attachment.computeScale(t,s):void 0===s&&(s=Attachment.computePlacement(t,i.Point2d.create(),r)),this.scale=r,this.placement=s}get isReady(){return void 0!==this._tree}get tree(){return this._tree}set tree(e){this._tree=e}static computeScale(e,t){return e.getExtents().x/t.bbox.width}static computePlacement(e,t,r){const n=e.getExtents(),s=new o.ElementAlignedBox2d;return s.low.setZero(),s.high.x=n.x/r,s.high.y=n.y/r,new o.Placement2d(t,i.Angle.createDegrees(0),s)}clearClipping(){this.clip.clear()}createBoundaryClip(){const e=this.placement.calculateRange(),t=[i.Point3d.create(e.low.x,e.low.y),i.Point3d.create(e.high.x,e.low.y),i.Point3d.create(e.high.x,e.high.y),i.Point3d.create(e.low.x,e.high.y),i.Point3d.create(e.low.x,e.low.y)],r=i.ClipVector.createEmpty();return r.appendShape(t),r}getOrCreateClip(e){this.clip.isValid||(this.clip=this.createBoundaryClip());const t=this.clip.clone();return void 0!==e&&t.transformInPlace(e),t}debugDrawBorder(e){const t=this.placement.origin,r=this.placement.bbox,n=[i.Point2d.create(t.x,t.y),i.Point2d.create(t.x+r.high.x,t.y),i.Point2d.create(t.x+r.high.x,t.y+r.high.y),i.Point2d.create(t.x,t.y+r.high.y),i.Point2d.create(t.x,t.y)],o=e.createGraphicBuilder(2);o.setSymbology(Attachment.DEBUG_BOUNDING_BOX_COLOR,Attachment.DEBUG_BOUNDING_BOX_COLOR,2),o.addLineString2d(n,0);const s=o.finish();e.outputGraphic(s)}}Attachment.DEBUG_BOUNDING_BOX_COLOR=o.ColorDef.red,e.Attachment=Attachment;e.Attachment2d=class Attachment2d extends Attachment{constructor(e,t){super(e,t)}get is2d(){return!0}load(e,t){return void 0===this.tree?Tree2d.create(this):3}};e.Attachment3d=class Attachment3d extends Attachment{constructor(e,t){super(e,t),this._states=[]}get is2d(){return!1}getState(e){return e<this._states.length?this._states[e]:0}setState(e,t){for(;this._states.length<e+1;)this._states.push(0);this._states[e]=t}load(e,t){return void 0===this._tree&&(this._tree=Tree3d.create(e,this,t)),3}};e.AttachmentList=class AttachmentList{constructor(){this.list=[],this._allReady=!0}get length(){return this.list.length}get allReady(){return this._allReady}clear(){this.list.length=0,this._allReady=!0}add(e){this._allReady=this._allReady&&e.isReady,this.list.push(e)}drop(e){const t=this.list.indexOf(e);-1!==t&&this.list.splice(t,1),this.updateAllReady()}updateAllReady(){this._allReady=!0;for(const e of this.list)if(!e.isReady){this._allReady=!1;break}}load(e,t,r){this.length;const n=this.list[e].load(t,r);return 3!==n&&2!==n&&this.list.splice(e,1),this.updateAllReady(),n}}}(p=t.Attachments||(t.Attachments={}));class SheetViewState extends h.ViewState2d{constructor(e,t,r,n,o,s){super(e,t,r,n),this._all3dAttachmentTilesLoaded=!0,r instanceof SheetViewState?(this.sheetSize=r.sheetSize.clone(),this._attachmentIds=r._attachmentIds,this._attachments=r._attachments):(this.sheetSize=i.Point2d.create(o.width,o.height),this._attachmentIds=[],s.forEach(e=>this._attachmentIds.push(e)),this._attachments=new p.AttachmentList)}static createFromStateData(e,t,r){const n=new s.DisplayStyle2dState(e.displayStyleProps,r);return new this(e.viewDefinitionProps,r,t,n,e.sheetProps,e.sheetAttachments)}static get className(){return"SheetViewDefinition"}getExtentLimits(){return{min:i.Constant.oneMillimeter,max:10*this.sheetSize.magnitude()}}markAttachment3dSceneIncomplete(){this._all3dAttachmentTilesLoaded=!1}async load(){if(await super.load(),void 0===this.getViewedModel())return;this._attachments.clear();const e=await this.iModel.elements.getProps(this._attachmentIds);for(const t of e)this.iModel.views.load(t.view.id).then(e=>{e.is3d()?this._attachments.add(new p.Attachment3d(t,e)):this._attachments.add(new p.Attachment2d(t,e))})}onRenderFrame(e){this._attachments.allReady&&this._all3dAttachmentTilesLoaded||e.sync.invalidateScene()}createScene(e){if(this._all3dAttachmentTilesLoaded=!0,super.createScene(e),!this._attachments.allReady){let t=0;for(;t<this._attachments.length;){const r=this._attachments.load(t,this,e);3!==r&&2!==r||t++}}for(const t of this._attachments.list)t.isReady&&t.tree.drawScene(e)}createBorder(e,t,r){const n=SheetBorder.create(e,t,r),i=r.createGraphicBuilder(0);return n.addToBuilder(i),i.finish()}decorate(e){if(super.decorate(e),void 0!==this.sheetSize){const t=this.createBorder(this.sheetSize.x,this.sheetSize.y,e);e.setViewBackground(t)}}computeFitRange(){const e=this.sheetSize;return 0>=e.x||0>=e.y?super.computeFitRange():new i.Range3d(0,0,-1,e.x,e.y,1)}}t.SheetViewState=SheetViewState},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(30),i=r(8),o=r(3),s=r(3);!function(e){let t;!function(e){e[e.Synch=0]="Synch",e[e.Cancel=1]="Cancel",e[e.Accept=2]="Accept"}(t=e.EventType||(e.EventType={}));class HandleTool extends n.InputCollector{constructor(e){super(),this.manipulator=e}init(){this.receivedDownEvent=!0,this.initLocateElements(!1,!0,void 0,0)}cancel(e){return!0}onPostInstall(){super.onPostInstall(),this.init()}async onDataButtonDown(e){return this.accept(e)?(this.exitTool(),this.manipulator.onManipulatorEvent(2),n.EventHandled.Yes):n.EventHandled.No}async onResetButtonUp(e){return this.cancel(e)?(this.exitTool(),this.manipulator.onManipulatorEvent(1),n.EventHandled.Yes):n.EventHandled.No}async onTouchMove(e){i.IModelApp.toolAdmin.convertTouchMoveToMotion(e)}async onTouchComplete(e){i.IModelApp.toolAdmin.convertTouchEndToButtonUp(e)}async onTouchCancel(e){i.IModelApp.toolAdmin.convertTouchEndToButtonUp(e,1)}}HandleTool.toolId="Select.Manipulator",HandleTool.hidden=!0,e.HandleTool=HandleTool;e.HandleProvider=class HandleProvider{constructor(e){this.iModel=e,this._isActive=!1,this._removeManipulatorToolListener=i.IModelApp.toolAdmin.manipulatorToolEvent.addListener(this.onManipulatorToolEvent,this)}stop(){this._removeSelectionListener&&(this._removeSelectionListener(),this._removeSelectionListener=void 0),this._removeManipulatorToolListener&&(this._removeManipulatorToolListener(),this._removeManipulatorToolListener=void 0),this.clearControls()}onManipulatorToolEvent(e,t){switch(t){case 1:if(this._removeSelectionListener)break;this._removeSelectionListener=this.iModel.selectionSet.onChanged.addListener(this.onSelectionChanged,this),this.iModel.selectionSet.isActive&&this.onManipulatorEvent(0);break;case 2:if(!this._removeSelectionListener)break;this._removeSelectionListener(),this._removeSelectionListener=void 0,this.clearControls()}}onSelectionChanged(e,t,r){this.iModel===e&&this.onManipulatorEvent(0)}updateDecorationListener(e){this._removeDecorationListener?(e||(this._removeDecorationListener(),this._removeDecorationListener=void 0),i.IModelApp.viewManager.invalidateDecorationsAllViews()):e&&(this._removeDecorationListener||(this._removeDecorationListener=i.IModelApp.viewManager.addDecorator(this)),i.IModelApp.viewManager.invalidateDecorationsAllViews())}decorate(e){}async updateControls(){const e=await this.createControls();this._isActive&&!e?this.clearControls():this.updateDecorationListener(this._isActive=e)}clearControls(){this.updateDecorationListener(this._isActive=!1)}onManipulatorEvent(e){this.updateControls()}async onDoubleClick(e,t){return n.EventHandled.No}async onRightClick(e,t){return n.EventHandled.No}async onDecorationButtonEvent(e,t){return this._isActive?t.isDoubleClick?this.onDoubleClick(e,t):1!==t.button||t.isDown||t.isDragging?0!==t.button?n.EventHandled.No:t.isControlKey?n.EventHandled.No:2!==t.inputSource||t.isDragging?t.isDown&&!t.isDragging?n.EventHandled.No:this.modifyControls(e,t)?(i.IModelApp.accuDraw.refreshDecorationsAndDynamics(),n.EventHandled.Yes):n.EventHandled.No:n.EventHandled.Yes:this.onRightClick(e,t):n.EventHandled.No}};e.HandleUtils=class HandleUtils{static getBoresite(e,t,r=!1,n=!1){if(r&&i.IModelApp.accuDraw.isActive)return s.Ray3d.create(e,i.IModelApp.accuDraw.getRotation().getRow(2).negate());if(n&&t.isContextRotationRequired)return s.Ray3d.create(e,t.getAuxCoordRotation().getRow(2).negate());const a=t.worldToViewMap.transform1.columnZ(),c=o.Vector3d.createFrom(a),l=o.Geometry.conditionalDivideFraction(1,a.w);if(void 0!==l){const t=c.scale(l);c.setFrom(e.vectorTo(t))}return c.scaleToLength(-1,c),s.Ray3d.create(e,c)}static projectPointToPlaneInView(t,r,n,i,a=!1,c=!1){const l=s.Plane3dByOriginAndUnitNormal.create(r,n);if(void 0===l)return;const u=e.HandleUtils.getBoresite(t,i,a,c),d=o.Point3d.createZero();return void 0!==u.intersectionWithPlane(l,d)?d:void 0}static projectPointToLineInView(t,r,n,i,a=!1,c=!1){const l=s.Ray3d.create(r,n),u=e.HandleUtils.getBoresite(t,i,a,c);if(u.direction.isParallelTo(l.direction))return l.projectPointToRay(t);const d=o.Matrix3d.createRigidFromColumns(l.direction,u.direction,4);if(void 0===d)return;const h=s.Plane3dByOriginAndUnitNormal.create(r,d.columnZ());if(void 0===h)return;const p=o.Point3d.createZero();return void 0!==u.intersectionWithPlane(h,p)?l.projectPointToRay(p):void 0}static getArrowTransform(t,r,n,i){const s=e.HandleUtils.getBoresite(r,t);if(Math.abs(n.dotProduct(s.direction))>=.99)return;const a=t.pixelsFromInches(i),c=t.viewFrustum.getPixelSizeAtPoint(r)*a,l=o.Matrix3d.createRigidFromColumns(n,s.direction,4);return void 0!==l?(l.scaleColumnsInPlace(c,c,c),o.Transform.createRefs(r.clone(),l)):void 0}static getArrowShape(e=0,t=.15,r=.55,n=1,i=.3,s=r,a=t){const c=[];return c[0]=o.Point3d.create(n,0),c[1]=o.Point3d.create(s,i),c[2]=o.Point3d.create(r,a),c[3]=o.Point3d.create(e,t),c[4]=o.Point3d.create(e,-t),c[5]=o.Point3d.create(r,-a),c[6]=o.Point3d.create(s,-i),c[7]=c[0].clone(),c}}}(t.EditManipulator||(t.EditManipulator={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);!function(e){e[e.Pick=0]="Pick",e[e.Fence=1]="Fence",e[e.SelectionSet=2]="SelectionSet"}(t.ElemSource||(t.ElemSource={})),function(e){e[e.Add=0]="Add",e[e.Invert=1]="Invert"}(t.ElemMethod||(t.ElemMethod={})),function(e){e[e.Check=0]="Check",e[e.Required=1]="Required",e[e.None=2]="None"}(t.UsesFence||(t.UsesFence={})),function(e){e[e.Check=0]="Check",e[e.Required=1]="Required",e[e.None=2]="None"}(t.UsesSelection||(t.UsesSelection={})),function(e){e[e.Box=0]="Box",e[e.Line=1]="Line",e[e.None=2]="None"}(t.UsesDragSelect||(t.UsesDragSelect={})),function(e){e[e.NotSupported=0]="NotSupported",e[e.NewElements=1]="NewElements",e[e.OriginalElements=2]="OriginalElements"}(t.ClipResult||(t.ClipResult={})),function(e){e[e.NoFence=0]="NoFence",e[e.NoFenceElems=1]="NoFenceElems",e[e.NoFenceElemsOutside=2]="NoFenceElemsOutside",e[e.NoSSElems=3]="NoSSElems",e[e.NotSupportedElmType=4]="NotSupportedElmType"}(t.ErrorNums||(t.ErrorNums={})),function(e){e[e.Unknown=0]="Unknown",e[e.Yes=1]="Yes",e[e.No=2]="No"}(t.HilitedState||(t.HilitedState={}));t.ElementAgenda=class ElementAgenda{constructor(e){this.iModel=e,this.elements=[],this.groupMarks=[],this.hiliteOnAdd=!0,this.hilitedState=0}getSource(){return 0===this.groupMarks.length?0:this.groupMarks[this.groupMarks.length-1].source}setSource(e){this.groupMarks.length>0&&(this.groupMarks[this.groupMarks.length-1].source=e)}get isEmpty(){return 0===this.length}get count(){return this.length}get length(){return this.elements.length}clear(){this.clearHilite(),this.elements.length=0,this.groupMarks.length=0}clearHilite(){2!==this.hilitedState&&(this.setEntriesHiliteState(!1),this.hilitedState=2)}setEntriesHiliteState(e,t=0,r=0){const n=0===r?this.elements:this.elements.filter((e,n)=>n>=t&&n<r);this.iModel.hilited.setHilite(n,e)}popGroup(){if(this.groupMarks.length<=1)return void this.clear();const e=this.groupMarks.pop();2!==this.hilitedState&&this.setEntriesHiliteState(!1,e.start,this.length),this.elements.splice(e.start)}hilite(){1!==this.hilitedState&&(this.setEntriesHiliteState(this.hiliteOnAdd),this.hilitedState=1)}has(e){return this.elements.some(t=>e===t)}find(e){return this.has(e)}add(e){const t=this.length;return n.Id64.toIdSet(e).forEach(e=>{this.has(e)||this.elements.push(e)}),t!==this.length&&(this.groupMarks.push({start:t,source:0}),2!==this.hilitedState&&this.setEntriesHiliteState(this.hiliteOnAdd,t,this.length),!0)}removeOne(e){let t=-1;const r=this.elements,n=this.groupMarks;if(r.some((r,n)=>e===r&&(t=n,!0)),-1===t)return!1;if(1===r.length||1===n.length&&5!==n[n.length-1].source)return this.clear(),!0;const i=t;let o=0,s=0,a=0,c=!1;for(let l=0;l<n.length;++l)0!==s?n[l].start-=c?1:s-o:l+1===n.length?(a=l,c=5===n[l].source,o=n[l].start,s=r.length):n[l].start<=i&&n[l+1].start>i&&(a=l,c=5===n[l].source,o=n[l].start,s=n[l+1].start);return c?(2!==this.hilitedState&&this.setEntriesHiliteState(!1,i,i+1),r.splice(i,1),s===o+1&&n.splice(a,1),!0):(2!==this.hilitedState&&this.setEntriesHiliteState(!1,o,s),r.splice(o,s-o),n.splice(a,1),!0)}remove(e){if(0===this.length)return!1;const t=n.Id64.toIdSet(e);if(0===t.size)return!1;const r=2!==this.hilitedState;return r&&this.clearHilite(),t.forEach(e=>this.removeOne(e)),r&&this.hilite(),!0}invert(e){if(0===this.length)return this.add(e);const t=n.Id64.toIdSet(e);if(0===t.size)return!1;const r=[],i=[];if(t.forEach(e=>{this.has(e)?i.push(e):r.push(e)}),0===r.length&&0===i.length)return!1;const o=2!==this.hilitedState;if(o&&this.clearHilite(),i.forEach(e=>this.removeOne(e)),r.length>0){const e=this.length;r.forEach(e=>this.elements.push(e)),this.groupMarks.push({start:e,source:0}),2!==this.hilitedState&&this.setEntriesHiliteState(this.hiliteOnAdd,e,this.length)}return o&&this.hilite(),!0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);!function(e){e[e.None=0]="None",e[e.Original=1]="Original",e[e.Copy=3]="Copy"}(t.FenceClipMode||(t.FenceClipMode={}));t.FenceParams=class FenceParams{constructor(){this.overlapMode=!1,this.onTolerance=.25,this.clipMode=0,this.hasOverlaps=!1,this.fenceRangeNPC=new n.Range3d}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(63),o=r(20);t.Marker=class Marker{constructor(e,t){this.visible=!0,this._isHilited=!1,this.rect=new o.ViewRect,this.worldLocation=n.Point3d.createFrom(e),this.size=n.Point2d.createFrom(t),this.position=new n.Point3d}get wantImage(){return!0}onMouseEnter(e){this._isHilited=!0,this._hiliteColor=e.viewport.hilite.color}onMouseLeave(){this._isHilited=!1}onMouseMove(e){this.title&&e.viewport.openToolTip(this.title,e.viewPoint,this.tooltipOptions)}pick(e){return this.rect.containsPoint(e)}setScaleFactor(e){this._scaleFactorRange=n.Range1d.fromJSON(e),this._scaleFactor=n.Point2d.create(1,1)}static makeFrom(e,...t){const r=new this(e.worldLocation,e.size,...t);return r.rect.setFrom(e.rect),r.position.setFrom(e.position),e._scaleFactor&&(r._scaleFactor=n.Point2d.createFrom(e._scaleFactor)),r._scaleFactorRange=e._scaleFactorRange,r}drawHilited(e){return e.shadowBlur=30,e.shadowColor=this._hiliteColor?this._hiliteColor.toHexString():"white",e.scale(1.25,1.25),!1}drawDecoration(e){if(!this._isHilited||!this.drawHilited(e)){if(void 0!==this._scaleFactor&&e.scale(this._scaleFactor.x,this._scaleFactor.y),void 0!==this.drawFunc&&this.drawFunc(e),this.wantImage&&void 0!==this.image){const t=this.imageSize?this.imageSize:this.size,r=new n.Point2d(t.x/2,t.y/2);this.imageOffset&&r.plus(this.imageOffset,r),e.drawImage(this.image,-r.x,-r.y,t.x,t.y)}void 0!==this.label&&(e.textAlign=this.labelAlign?this.labelAlign:"center",e.textBaseline=this.labelBaseline?this.labelBaseline:"middle",e.font=this.labelFont?this.labelFont:"14px san-serif",e.fillStyle=this.labelColor?this.labelColor:"white",e.fillText(this.label,this.labelOffset?-this.labelOffset.x:0,this.labelOffset?-this.labelOffset.y:0))}}setImage(e){e instanceof Promise?e.then(e=>this.image=e):this.image=e}setImageUrl(e){this.setImage(i.imageElementFromUrl(e))}setPosition(e){if(!this.visible)return!1;const t=e.worldToView4d(this.worldLocation);if(t.w>1||t.w<0)return!1;if(t.realPoint(this.position),!e.viewRect.containsPoint(this.position))return!1;const r=this.position,i=this.size.x/2,o=this.size.y/2;if(this.rect.init(r.x-i,r.y-o,r.x+i,r.y+o),this._scaleFactor&&this._scaleFactorRange){let r=1;if(e.isCameraOn){const e=this._scaleFactorRange;r=n.Geometry.clamp(e.low+(1-t.w)*e.length(),.4,2),this.rect.scaleAboutCenter(r,r)}this._scaleFactor.set(r,r)}return!0}addMarker(e){e.addCanvasDecoration(this)}addDecoration(e){this.setPosition(e.viewport)&&this.addMarker(e)}};class Cluster{constructor(e){this.markers=e,this.rect=e[0].rect,this.markers=e}}t.Cluster=Cluster;t.MarkerSet=class MarkerSet{constructor(){this._entries=[],this._worldToViewMap=n.Matrix4d.createZero(),this.minimumClusterSize=1,this.markers=new Set}addDecoration(e){const t=e.viewport,r=this._entries;if(!this._worldToViewMap.isAlmostEqual(t.worldToViewMap.transform0)){this._worldToViewMap.setFrom(t.worldToViewMap.transform0),r.length=0;for(const e of this.markers){if(!e.setPosition(t))continue;let n=!1;for(let t=0;t<r.length;++t){const i=r[t];if(e.rect.overlaps(i.rect)){n=!0,i instanceof Cluster?i.markers.push(e):r[t]=new Cluster([i,e]);break}}n||r.push(e)}}for(const n of r)n instanceof Cluster?n.markers.length<=this.minimumClusterSize?n.markers.forEach(t=>t.addMarker(e)):(void 0===n.clusterMarker&&(n.clusterMarker=this.getClusterMarker(n)),n.clusterMarker.addMarker(e)):n.addMarker(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(551),i=r(8),o=r(20);class NullTarget extends n.RenderTarget{get animationFraction(){return 0}set animationFraction(e){}get renderSystem(){}get cameraFrustumNearScaleLimit(){return 0}get viewRect(){return new o.ViewRect}get wantInvertBlackBackground(){return!1}onDestroy(){}reset(){}changeScene(){}changeTerrain(){}changeDynamics(){}changeDecorations(){}changeRenderPlan(){}drawFrame(e){}overrideFeatureSymbology(){}setHiliteSet(){}setFlashed(){}setViewRect(){}onResized(){}dispose(){}updateViewRect(){return!1}readPixels(){}readImage(){}}t.NullTarget=NullTarget;class NullRenderSystem extends n.RenderSystem{get isValid(){return!1}createTarget(){return new NullTarget}createOffscreenTarget(){return new NullTarget}createGraphicBuilder(){}createGraphicList(){}createBranch(){}createBatch(){}dispose(){}constructor(){super()}}t.NullRenderSystem=NullRenderSystem;t.NoRenderApp=class NoRenderApp extends i.IModelApp{static supplyRenderSystem(){return new NullRenderSystem}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(305)),n(r(308)),n(r(299)),n(r(301)),n(r(303)),n(r(302)),n(r(53)),n(r(292)),n(r(77)),n(r(87)),n(r(306)),n(r(307)),n(r(304)),n(r(177)),n(r(133)),n(r(300)),n(r(26))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(322);t.SelectionChangeEvent=n.default,t.SelectionChangeType=n.SelectionChangeType;var i=r(323);t.SelectionManager=i.default;var o=r(572);t.SelectionHandler=o.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(324),o=r(188);t.default=class KeySet{constructor(e){this._instanceKeys=new Map,this._nodeKeys=new Set,this._guid=n.Guid.createValue(),e&&this.add(e)}get guid(){return this._guid}toJSON(){const e=new Array;for(const r of this._instanceKeys.entries())e.push([r[0],[...r[1]]]);const t=new Array;for(const r of this._nodeKeys.values())t.push(JSON.parse(r));return{instanceKeys:e,nodeKeys:t}}get instanceKeys(){const e=new Map;for(const t of this._instanceKeys)e.set(t[0],new Set([...t[1]].map(e=>n.Id64.fromJSON(e))));return e}get nodeKeys(){const e=new Set;for(const t of this._nodeKeys){const r=i.fromJSON(JSON.parse(t));e.add(r)}return e}isKeySetJSON(e){return Array.isArray(e.nodeKeys)&&Array.isArray(e.instanceKeys)}isKeySet(e){return e._nodeKeys&&e._instanceKeys}isKeysArray(e){return Array.isArray(e)}isNodeKey(e){return e.type}isInstanceKey(e){return e.className&&e.id}isEntityProps(e){return e.classFullName&&e.id}clear(){return this.isEmpty?this:(this._instanceKeys=new Map,this._nodeKeys=new Set,this._guid=n.Guid.createValue(),this)}addKeySet(e){for(const t of e._nodeKeys)this._nodeKeys.add(t);for(const t of e._instanceKeys){let e=this._instanceKeys.get(t[0]);e||(e=new Set,this._instanceKeys.set(t[0],e)),t[1].forEach(t=>{e.add(t)})}}addKeySetJSON(e){for(const t of e.nodeKeys)this._nodeKeys.add(JSON.stringify(t));for(const t of e.instanceKeys)this._instanceKeys.set(t[0],new Set(t[1]))}add(e){if(!e)throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: value = ${e}`);const t=this.size;if(this.isKeySet(e))this.addKeySet(e);else if(this.isKeySetJSON(e))this.addKeySetJSON(e);else if(this.isKeysArray(e))for(const r of e)this.add(r);else if(this.isNodeKey(e))this._nodeKeys.add(JSON.stringify(e));else if(this.isInstanceKey(e))this._instanceKeys.has(e.className)||this._instanceKeys.set(e.className,new Set),this._instanceKeys.get(e.className).add(e.id);else{if(!this.isEntityProps(e))throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: value = ${e}`);this.add({className:e.classFullName,id:n.Id64.fromJSON(e.id)})}return this.size!==t&&(this._guid=n.Guid.createValue()),this}deleteKeySet(e){for(const t of e._nodeKeys)this._nodeKeys.delete(t);for(const t of e._instanceKeys){const e=this._instanceKeys.get(t[0]);e&&t[1].forEach(t=>{e.delete(t)})}}deleteKeySetJSON(e){for(const t of e.nodeKeys)this._nodeKeys.delete(JSON.stringify(t));for(const t of e.instanceKeys){const e=this._instanceKeys.get(t[0]);e&&t[1].forEach(t=>{e.delete(t)})}}delete(e){if(!e)throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: value = ${e}`);const t=this.size;if(this.isKeySet(e))this.deleteKeySet(e);else if(this.isKeySetJSON(e))this.deleteKeySetJSON(e);else if(this.isKeysArray(e))for(const r of e)this.delete(r);else if(this.isNodeKey(e))this._nodeKeys.delete(JSON.stringify(e));else if(this.isInstanceKey(e)){const t=this._instanceKeys.get(e.className);t&&t.delete(e.id)}else{if(!this.isEntityProps(e))throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: value = ${e}`);this.delete({className:e.classFullName,id:e.id})}return this.size!==t&&(this._guid=n.Guid.createValue()),this}has(e){if(!e)throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: value = ${e}`);if(this.isNodeKey(e))return this._nodeKeys.has(JSON.stringify(e));if(this.isInstanceKey(e)){const t=this._instanceKeys.get(e.className);return!(!t||!t.has(e.id))}if(this.isEntityProps(e))return this.has({className:e.classFullName,id:e.id});throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: value = ${e}`)}hasKeySet(e,t){const r=e;if("all"===t){if(this._nodeKeys.size<r._nodeKeys.size||this._instanceKeys.size<r._instanceKeys.size)return!1;if([...r._nodeKeys].some(e=>!this._nodeKeys.has(e)))return!1;for(const e of r._instanceKeys){const t=this._instanceKeys.get(e[0]);if(!t||t.size<e[1].size)return!1;if([...e[1]].some(e=>!t.has(e)))return!1}return!0}if([...r._nodeKeys].some(e=>this._nodeKeys.has(e)))return!0;for(const n of r._instanceKeys){const e=this._instanceKeys.get(n[0]);if(e&&[...n[1]].some(t=>e.has(t)))return!0}return!1}hasKeySetJSON(e,t){if("all"===t){if(this._nodeKeys.size<e.nodeKeys.length||this._instanceKeys.size<e.instanceKeys.length)return!1;if([...e.nodeKeys].some(e=>!this._nodeKeys.has(JSON.stringify(e))))return!1;for(const t of e.instanceKeys){const e=this._instanceKeys.get(t[0]);if(!e||e.size<t[1].length)return!1;if([...t[1]].some(t=>!e.has(t)))return!1}return!0}if([...e.nodeKeys].some(e=>this._nodeKeys.has(JSON.stringify(e))))return!0;for(const r of e.instanceKeys){const e=this._instanceKeys.get(r[0]);if(e&&[...r[1]].some(t=>e.has(t)))return!0}return!1}hasKeysArray(e,t){if("all"===t){if(this.size<e.length)return!1;for(const t of e)if(!this.has(t))return!1;return!0}for(const r of e)if(this.has(r))return!0;return!1}hasAll(e){if(!e)throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: value = ${e}`);if(this.isKeySet(e))return this.hasKeySet(e,"all");if(this.isKeySetJSON(e))return this.hasKeySetJSON(e,"all");if(this.isKeysArray(e))return this.hasKeysArray(e,"all");throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: keys = ${e}`)}hasAny(e){if(!e)throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: value = ${e}`);if(this.isKeySet(e))return this.hasKeySet(e,"any");if(this.isKeySetJSON(e))return this.hasKeySetJSON(e,"any");if(this.isKeysArray(e))return this.hasKeysArray(e,"any");throw new o.PresentationError(o.PresentationStatus.InvalidArgument,`Invalid argument: keys = ${e}`)}get size(){const e=this._nodeKeys.size;let t=0;for(const r of this._instanceKeys.values())t+=r.size;return e+t}get isEmpty(){return 0===this.size}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(326),i=r(328);class Content{constructor(e,t){this.descriptor=e,this.contentSet=t}static fromJSON(e){if(!e)return;if("string"===typeof e)return JSON.parse(e,Content.reviver);const t=Object.create(Content.prototype);return Object.assign(t,{descriptor:n.default.fromJSON(e.descriptor),contentSet:e.contentSet.map(e=>i.default.fromJSON(e))})}static reviver(e,t){return""===e?Content.fromJSON(t):t}}t.default=Content},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80);t.propertyFromJSON=(e=>({property:n.propertyInfoFromJSON(e.property),relatedClassPath:e.relatedClassPath.map(e=>n.relatedClassInfoFromJSON(e))}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80);function i(e){return void 0!==e&&Array.isArray(e)&&(0===e.length||void 0!==e[0].primaryKeys&&void 0!==e[0].values&&void 0!==e[0].displayValues&&void 0!==e[0].mergedFieldNames)}function o(e){return void 0!==e&&Array.isArray(e)}function s(e){return void 0!==e&&"object"===typeof e&&!Array.isArray(e)}function a(e){if(null!==e)return i(e)?e.map(p):o(e)?c(e):s(e)?l(e):e}function c(e){return e.map(a)}function l(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=a(e[r]));return t}function u(e){if(null!==e)return o(e)?d(e):s(e)?h(e):e}function d(e){return e.map(u)}function h(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=u(e[r]));return t}function p(e){return{primaryKeys:e.primaryKeys.map(n.instanceKeyFromJSON),values:l(e.values),displayValues:h(e.displayValues),mergedFieldNames:e.mergedFieldNames}}t.isNestedContentValue=i,t.isArray=o,t.isMap=s,t.isPrimitive=function(e){return!o(e)&&!s(e)},t.valueFromJSON=a,t.valuesArrayFromJSON=c,t.valuesMapFromJSON=l,t.displayValueFromJSON=u,t.displayValuesArrayFromJSON=d,t.displayValuesMapFromJSON=h,t.nestedContentValueFromJSON=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class DefaultContentDisplayTypes{}DefaultContentDisplayTypes.UNDEFINED="Undefined",DefaultContentDisplayTypes.GRID="Grid",DefaultContentDisplayTypes.PROPERTY_PANE="PropertyPane",DefaultContentDisplayTypes.LIST="List",DefaultContentDisplayTypes.VIEWPORT="Graphics",t.default=DefaultContentDisplayTypes},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Primitive="Primitive",e.Array="Array",e.Struct="Struct"}(t.PropertyValueFormat||(t.PropertyValueFormat={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(324);t.StandardNodeTypes=n.StandardNodeTypes},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),o=r(4),s=r(188),a=r(329);t.default=class RpcRequestsHandler{constructor(e){this.onClientStateChanged=(()=>{this._clientStateId=i.Guid.createValue()}),this.clientId=e&&e.clientId?e.clientId:i.Guid.createValue(),this._clientStateHolders=[]}get clientStateId(){return this._clientStateId}dispose(){this._clientStateHolders.forEach(e=>e.onStateChanged.removeListener(this.onClientStateChanged)),this._clientStateHolders=[]}get rpcClient(){return o.RpcManager.getClientForInterface(a.default)}createRequestOptions(e){return Object.assign({},e,{clientId:this.clientId,clientStateId:this._clientStateId})}registerClientStateHolder(e){this._clientStateHolders.push(e),e.onStateChanged.addListener(this.onClientStateChanged)}unregisterClientStateHolder(e){const t=this._clientStateHolders.indexOf(e);-1!==t&&this._clientStateHolders.splice(t,1),e.onStateChanged.removeListener(this.onClientStateChanged)}async sync(e){const t={};for(const r of this._clientStateHolders){const e=r.state,n=t[r.key];t[r.key]=n&&"object"===typeof n&&"object"===typeof e?Object.assign({},n,e):e}await this.rpcClient.syncClientState(e,this.createRequestOptions({state:t}))}async request(e,t,r,...i){const o=r,{imodel:a}=o,c=n(o,["imodel"]),l=()=>t.apply(e,[a,c,...i]);try{return await l()}catch(e){if(e.errorNumber===s.PresentationStatus.BackendOutOfSync)return await this.sync(r.imodel),await l();throw e}}async getRootNodes(e){return await this.request(this.rpcClient,this.rpcClient.getRootNodes,this.createRequestOptions(e))}async getRootNodesCount(e){return await this.request(this.rpcClient,this.rpcClient.getRootNodesCount,this.createRequestOptions(e))}async getChildren(e,t){return await this.request(this.rpcClient,this.rpcClient.getChildren,this.createRequestOptions(e),t)}async getChildrenCount(e,t){return await this.request(this.rpcClient,this.rpcClient.getChildrenCount,this.createRequestOptions(e),t)}async getNodePaths(e,t,r){return await this.request(this.rpcClient,this.rpcClient.getNodePaths,this.createRequestOptions(e),t,r)}async getFilteredNodePaths(e,t){return await this.request(this.rpcClient,this.rpcClient.getFilteredNodePaths,this.createRequestOptions(e),t)}async getContentDescriptor(e,t,r,n){return await this.request(this.rpcClient,this.rpcClient.getContentDescriptor,this.createRequestOptions(e),t,r,n)}async getContentSetSize(e,t,r){return await this.request(this.rpcClient,this.rpcClient.getContentSetSize,this.createRequestOptions(e),t,r)}async getContent(e,t,r){return await this.request(this.rpcClient,this.rpcClient.getContent,this.createRequestOptions(e),t,r)}async getDistinctValues(e,t,r,n,i){return await this.request(this.rpcClient,this.rpcClient.getDistinctValues,this.createRequestOptions(e),t,r,n,i)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(562);t.QuerySpecificationTypes=n.QuerySpecificationTypes;var i=r(563);t.GroupingSpecificationTypes=i.GroupingSpecificationTypes,t.PropertyGroupingValue=i.PropertyGroupingValue;var o=r(564);t.RelationshipMeaning=o.RelationshipMeaning;var s=r(565);t.PropertyEditorParameterTypes=s.PropertyEditorParameterTypes;var a=r(566);t.RuleTypes=a.RuleTypes;var c=r(567);t.RuleSpecificationTypes=c.RuleSpecificationTypes;var l=r(568);t.RelationshipDirection=l.RelationshipDirection},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.String="String",e.ECPropertyValue="ECPropertyValue"}(t.QuerySpecificationTypes||(t.QuerySpecificationTypes={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Class="Class",e.Property="Property",e.SameLabelInstance="SameLabelInstance"}(t.GroupingSpecificationTypes||(t.GroupingSpecificationTypes={})),function(e){e.PropertyValue="PropertyValue",e.DisplayLabel="DisplayLabel"}(t.PropertyGroupingValue||(t.PropertyGroupingValue={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SameInstance="SameInstance",e.RelatedInstance="RelatedInstance"}(t.RelationshipMeaning||(t.RelationshipMeaning={})),function(e){e.None="_none_"}(t.RelatedPropertiesSpecialValues||(t.RelatedPropertiesSpecialValues={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Json="Json",e.Multiline="Multiline",e.Range="Range",e.Slider="Slider"}(t.PropertyEditorParameterTypes||(t.PropertyEditorParameterTypes={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.RootNodes="RootNodes",e.ChildNodes="ChildNodes",e.Content="Content",e.ContentModifier="ContentModifier",e.Grouping="Grouping",e.PropertySorting="PropertySorting",e.DisabledSorting="DisabledSorting",e.InstanceLabelOverride="InstanceLabelOverride",e.LabelOverride="LabelOverride",e.CheckBox="CheckBox",e.ImageIdOverride="ImageIdOverride",e.StyleOverride="StyleOverride"}(t.RuleTypes||(t.RuleTypes={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.AllInstanceNodes="AllInstanceNodes",e.AllRelatedInstanceNodes="AllRelatedInstanceNodes",e.RelatedInstanceNodes="RelatedInstanceNodes",e.InstanceNodesOfSpecificClasses="InstanceNodesOfSpecificClasses",e.CustomQueryInstanceNodes="CustomQueryInstanceNodes",e.CustomNode="CustomNode",e.ContentInstancesOfSpecificClasses="ContentInstancesOfSpecificClasses",e.ContentRelatedInstances="ContentRelatedInstances",e.SelectedNodeInstances="SelectedNodeInstances"}(t.RuleSpecificationTypes||(t.RuleSpecificationTypes={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Both="Both",e.Forward="Forward",e.Backward="Backward"}(t.RelationshipDirection||(t.RelationshipDirection={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Int="int",e.IntArray="int[]",e.Bool="bool",e.String="string",e.Id64="id64",e.Id64Array="id64[]"}(t.VariableValueTypes||(t.VariableValueTypes={})),function(e){e.STATE_ID="ruleset variables"}(t.RulesetVariablesState||(t.RulesetVariablesState={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RegisteredRuleset=class RegisteredRuleset{constructor(e,t,r){this._disposeFunc=r,this._ruleset=e,this._uniqueIdentifier=t}dispose(){this._disposeFunc(this)}get uniqueIdentifier(){return this._uniqueIdentifier}get id(){return this._ruleset.id}get supportedSchemas(){return this._ruleset.supportedSchemas}get supplementationInfo(){return this._ruleset.supplementationInfo}get rules(){return this._ruleset.rules}get vars(){return this._ruleset.vars}toJSON(){return this._ruleset}},function(e){e.STATE_ID="rulesets"}(t.RulesetManagerState||(t.RulesetManagerState={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ECObjects="ECObjects",e.ECObjects_ECExpressions="ECObjects.ECExpressions",e.ECObjects_ECExpressions_Parse="ECObjects.ECExpressions.Parse",e.ECObjects_ECExpressions_Evaluate="ECObjects.ECExpressions.Evaluate",e.ECPresentation="ECPresentation",e.ECPresentation_Connections="ECPresentation.Connections",e.ECPresentation_RulesEngine="ECPresentation.RulesEngine",e.ECPresentation_RulesEngine_Content="ECPresentation.RulesEngine.Content",e.ECPresentation_RulesEngine_Localization="ECPresentation.RulesEngine.Localization",e.ECPresentation_RulesEngine_Navigation="ECPresentation.RulesEngine.Navigation",e.ECPresentation_RulesEngine_Navigation_Cache="ECPresentation.RulesEngine.Navigation.Cache",e.ECPresentation_RulesEngine_Threads="ECPresentation.RulesEngine.Threads",e.ECPresentation_RulesEngine_Update="ECPresentation.RulesEngine.Update",e.ECPresentation_RulesEngine_RulesetVariables="ECPresentation.RulesEngine.RulesetVariables"}(t.LoggingNamespaces||(t.LoggingNamespaces={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.default=class SelectionHandler{constructor(e,t,r,i,o){this.onSelectionChanged=((e,t)=>{this.onSelect&&this.shouldHandle(e)&&(this._inSelect=!0,this.onSelect(e,t),this._inSelect=!1)}),this._inSelect=!1,this._manager=e,this._disposables=new n.DisposableList,this.name=t,this.rulesetId=i,this.imodel=r,this.onSelect=o,this._disposables.add(this._manager.selectionChange.addListener(this.onSelectionChanged))}dispose(){this._disposables.dispose()}shouldHandle(e){return this.name!==e.source}getSelectionLevels(){return this._manager.getSelectionLevels(this.imodel)}getSelection(e){return this._manager.getSelection(this.imodel,e)}addToSelection(e,t=0){if(!this._inSelect)return this._manager.addToSelection(this.name,this.imodel,e,t,this.rulesetId)}removeFromSelection(e,t=0){if(!this._inSelect)return this._manager.removeFromSelection(this.name,this.imodel,e,t,this.rulesetId)}replaceSelection(e,t=0){if(!this._inSelect)return this._manager.replaceSelection(this.name,this.imodel,e,t,this.rulesetId)}clearSelection(e=0){if(!this._inSelect)return this._manager.clearSelection(this.name,this.imodel,e,this.rulesetId)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(47);t.default=class PersistenceHelper{constructor(){}static async createPersistentKeysContainer(e,t){const r=Array.from(t.instanceKeys.keys()),n=r.map(()=>"?").join(","),i=await e.executeQuery(`\n      SELECT s.Alias || '.' || c.Name AS fullClassName\n        FROM [meta].[ECSchemaDef] s\n        JOIN [meta].[ECClassDef] c ON c.SchemaId = s.ECInstanceId\n        JOIN [meta].[ClassHasAllBaseClasses] b ON b.SourceECInstanceId = c.ECInstanceId\n        JOIN [meta].[ECClassDef] mc ON mc.ECInstanceId = b.TargetECInstanceId\n        JOIN [meta].[ECSchemaDef] ms ON ms.ECInstanceId = mc.SchemaId\n       WHERE ms.Alias || '.' || mc.Name = 'bis.Model'\n             AND s.Alias || '.' || c.Name IN (${n})\n    `,r),o=new Set(i.map(e=>e.fullClassName));let s=new Array,a=new Array;for(const c of t.instanceKeys.entries()){const e=c[0],t=c[1];o.has(e)?s=s.concat(Array.from(t)):a=a.concat(Array.from(t))}return{models:s,elements:a,nodes:Array.from(t.nodeKeys)}}static async createKeySet(e,t){const r=new n.KeySet;return r.add(t.nodes),r.add(await e.models.getProps(t.models)),r.add(await e.elements.getProps(t.elements)),r}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(68),i=r(47),o=r(575),s=r(323);let a,c,l;class Presentation{constructor(){}static initialize(e){if(!n.IModelApp.initialized)throw new i.PresentationError(i.PresentationStatus.NotInitialized,"IModelApp.startup must be called before calling Presentation.initialize");if(l||(l=n.IModelApp.i18n),!a){if(e||(e={}),!e.activeLocale){const t=Presentation.i18n.languageList();e.activeLocale=t.length?t[0]:void 0}a=o.default.create(e)}c||(c=new s.default)}static terminate(){a&&a.dispose(),a=void 0,c=void 0,l=void 0}static get presentation(){if(!a)throw new Error("Presentation must be first initialized by calling Presentation.initialize");return a}static set presentation(e){a&&a.dispose(),a=e}static get selection(){if(!c)throw new Error("Presentation must be first initialized by calling Presentation.initialize");return c}static set selection(e){c=e}static get i18n(){if(!l)throw new Error("Presentation must be first initialized by calling Presentation.initialize");return l}static set i18n(e){l=e}}t.default=Presentation},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(47),i=r(576),o=r(577);class PresentationManager{constructor(e){e&&(this.activeLocale=e.activeLocale),this._rulesets=new o.default,this._rulesetVars=new Map,this._requestsHandler=e&&e.rpcRequestsHandler?e.rpcRequestsHandler:new n.RpcRequestsHandler,this._requestsHandler.registerClientStateHolder(this._rulesets)}dispose(){this._requestsHandler.dispose()}static create(e){return new PresentationManager(e)}get rpcRequestsHandler(){return this._requestsHandler}rulesets(){return this._rulesets}vars(e){if(!this._rulesetVars.has(e)){const t=new i.default(e);this._rulesetVars.set(e,t),this._requestsHandler.registerClientStateHolder(t)}return this._rulesetVars.get(e)}toIModelTokenOptions(e){return Object.assign({},{locale:this.activeLocale},e,{imodel:e.imodel.iModelToken})}async getRootNodes(e){return await this._requestsHandler.getRootNodes(this.toIModelTokenOptions(e))}async getRootNodesCount(e){return await this._requestsHandler.getRootNodesCount(this.toIModelTokenOptions(e))}async getChildren(e,t){return await this._requestsHandler.getChildren(this.toIModelTokenOptions(e),t)}async getChildrenCount(e,t){return await this._requestsHandler.getChildrenCount(this.toIModelTokenOptions(e),t)}async getNodePaths(e,t,r){return await this._requestsHandler.getNodePaths(this.toIModelTokenOptions(e),t,r)}async getFilteredNodePaths(e,t){return await this._requestsHandler.getFilteredNodePaths(this.toIModelTokenOptions(e),t)}async getContentDescriptor(e,t,r,n){const i=await this._requestsHandler.getContentDescriptor(this.toIModelTokenOptions(e),t,r,n);return i&&i.rebuildParentship(),i}async getContentSetSize(e,t,r){return await this._requestsHandler.getContentSetSize(this.toIModelTokenOptions(e),t.createStrippedDescriptor(),r)}async getContent(e,t,r){const n=await this._requestsHandler.getContent(this.toIModelTokenOptions(e),t.createStrippedDescriptor(),r);return n.descriptor.rebuildParentship(),n}async getDistinctValues(e,t,r,n,i=0){return await this._requestsHandler.getDistinctValues(this.toIModelTokenOptions(e),t.createStrippedDescriptor(),r,n,i)}}t.default=PresentationManager},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(47);t.default=class RulesetVariablesManager{constructor(e){this._clientValues=new Map,this.key=i.RulesetVariablesState.STATE_ID,this.onStateChanged=new n.BeEvent,this._rulesetId=e}get state(){const e={},t=[];for(const r of this._clientValues)t.push([r[0],r[1][0],r[1][1]]);return e[this._rulesetId]=t,e}changeValueType(e,t,r){switch(r){case"bool":switch(t){case"int":return 0!==e;case"id64":return n.Id64.isValidId64(e);default:return}case"int":switch(t){case"bool":return e?1:0;case"id64":return n.Id64.getUpperUint32(e);default:return}case"int[]":switch(t){case"id64[]":return e.map(e=>n.Id64.getUpperUint32(e));default:return}case"id64":switch(t){case"bool":return n.Id64.fromLocalAndBriefcaseIds(e?1:0,0);case"int":return n.Id64.fromLocalAndBriefcaseIds(e,0);default:return}case"id64[]":switch(t){case"int[]":return e.map(e=>n.Id64.fromLocalAndBriefcaseIds(e,0));default:return}}}async getValue(e,t){const r=this._clientValues.get(e);if(r)return r[0]!==t?this.changeValueType(r[1],r[0],t):r[1]}async setValue(e,t,r){this._clientValues.set(e,[t,r]),this.onStateChanged.raiseEvent()}async getString(e){return await this.getValue(e,"string")||""}async setString(e,t){await this.setValue(e,"string",t)}async getBool(e){return await this.getValue(e,"bool")||!1}async setBool(e,t){await this.setValue(e,"bool",t)}async getInt(e){return await this.getValue(e,"int")||0}async setInt(e,t){await this.setValue(e,"int",t)}async getInts(e){return await this.getValue(e,"int[]")||[]}async setInts(e,t){await this.setValue(e,"int[]",t)}async getId64(e){return await this.getValue(e,"id64")||n.Id64.invalid}async setId64(e,t){await this.setValue(e,"id64",t)}async getId64s(e){return await this.getValue(e,"id64[]")||[]}async setId64s(e,t){await this.setValue(e,"id64[]",t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(47);t.default=class RulesetManager{constructor(){this._clientRulesets=new Map,this.key=i.RulesetManagerState.STATE_ID,this.onStateChanged=new n.BeEvent}get state(){const e=[];return this._clientRulesets.forEach(t=>{t.forEach(t=>e.push(t.toJSON()))}),e}async get(e){const t=this._clientRulesets.get(e);if(t)return t[0]}async add(e){const t=new i.RegisteredRuleset(e,n.Guid.createValue(),e=>this.remove(e));return this._clientRulesets.has(e.id)||this._clientRulesets.set(e.id,[]),this._clientRulesets.get(e.id).push(t),this.onStateChanged.raiseEvent(),t}async remove(e){let t,r;Array.isArray(e)?(t=e[0],r=e[1]):(t=e.id,r=e.uniqueIdentifier);const n=this._clientRulesets.get(t);if(!n)return!1;let i=!1;for(let o=0;o<n.length;++o)if(n[o].uniqueIdentifier===r){n.splice(o,1),i=!0;break}return i&&this.onStateChanged.raiseEvent(),i}async clear(){0!==this._clientRulesets.size&&(this._clientRulesets.clear(),this.onStateChanged.raiseEvent())}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(579);t.CheckListBox=n.CheckListBox,t.CheckListBoxItem=n.CheckListBoxItem,t.CheckListBoxSeparator=n.CheckListBoxSeparator},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(2),o=r(330);r(580);t.CheckListBoxItem=class CheckListBoxItem extends n.Component{constructor(e,t){super(e,t),this._onClick=(()=>{this.props.onClick&&this.props.onClick()})}render(){const e=i("chk-listboxitem-checkbox");return n.createElement("li",null,n.createElement(o.Checkbox,{checked:this.props.checked,disabled:this.props.disabled,className:e,label:this.props.label,onClick:this._onClick}))}},t.CheckListBoxSeparator=(()=>n.createElement("div",{className:"chk-listboxseparator"}));t.CheckListBox=class CheckListBox extends n.Component{render(){const e=i("chk-listbox",this.props.className);return n.createElement("ul",{className:e},this.props.children)}}},function(e,t,r){},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(582)),n(r(583)),n(r(584)),n(r(585)),n(r(586)),n(r(587))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Left=1]="Left",e[e.Center=2]="Center",e[e.Right=3]="Right",e[e.Justify=4]="Justify"}(t.HorizontalAlignment||(t.HorizontalAlignment={})),function(e){e[e.Top=1]="Top",e[e.Middle=2]="Middle",e[e.Bottom=3]="Bottom"}(t.VerticalAlignment||(t.VerticalAlignment={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.Partial=2]="Partial"}(t.CheckBoxState||(t.CheckBoxState={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.Short=1]="Short",e[e.Medium=2]="Medium",e[e.Long=3]="Long"}(t.DateFormat||(t.DateFormat={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(t.Orientation||(t.Orientation={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NoSort=0]="NoSort",e[e.Ascending=1]="Ascending",e[e.Descending=2]="Descending"}(t.SortDirection||(t.SortDirection={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.Short=1]="Short",e[e.Long=2]="Long"}(t.TimeFormat||(t.TimeFormat={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(589);t.ExpandableList=n.ExpandableList;var i=r(591);t.ExpandableBlock=i.ExpandableBlock},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);r(590);class ExpandableList extends n.Component{constructor(e,t){super(e,t),this._handleBlockClick=((e,t)=>{this.setState({activeBlock:e}),t&&t()}),this.state={activeBlock:this.props.defaultActiveBlock}}renderBlocks(){return n.Children.map(this.props.children,(e,t)=>n.cloneElement(e,{key:t,isExpanded:this.props.singleExpandOnly?t===this.state.activeBlock:e.props.isExpanded,onClick:this._handleBlockClick.bind(this,t,e.props.onClick)}))}render(){return n.createElement("div",{className:"BwcExpandableBlocksList"},this.renderBlocks())}}ExpandableList.defaultProps={singleExpandOnly:!1,defaultActiveBlock:0},t.ExpandableList=ExpandableList,t.default=ExpandableList},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(592);r(664);class ExpandableBlock extends n.Component{render(){return n.createElement(i.ExpandableBlock,{className:"core-property-block"+(this.props.className?" "+this.props.className:""),isExpanded:this.props.isExpanded,onClick:this.props.onClick,onKeyPress:this.props.onKeyPress,title:this.props.title,caption:this.props.caption},this.props.children)}}t.ExpandableBlock=ExpandableBlock,t.default=ExpandableBlock},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),r(593),n(r(594)),n(r(599)),n(r(609)),n(r(612)),n(r(618)),n(r(622)),n(r(624)),n(r(636)),n(r(639)),n(r(650)),n(r(654)),n(r(656)),n(r(661))},function(e,t,r){},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(595)),n(r(596)),n(r(597)),n(r(598))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-alerts-error",this.props.className)}),s.createElement("i",{className:"icon icon-status-error"}),this.props.children)},t}(s.Component);t.ErrorAlert=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-alerts-info",this.props.className)}),s.createElement("i",{className:"icon icon-info"}),this.props.children)},t}(s.Component);t.InfoAlert=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-alerts-success",this.props.className)}),s.createElement("i",{className:"icon icon-status-success"}),this.props.children)},t}(s.Component);t.SuccessAlert=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-alerts-warning",this.props.className)}),s.createElement("i",{className:"icon icon-status-warning"}),this.props.children)},t}(s.Component);t.WarningAlert=c,t.default=c},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(55)),n(r(601)),n(r(602)),n(r(603)),n(r(604)),n(r(605)),n(r(606)),n(r(607)),n(r(608))},function(e,t,r){},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(55),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.Button,o({},this.props,{className:a("bwc-buttons-blue",this.props.className)}))},t}(s.Component);t.BlueButton=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(55),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.Button,o({},this.props,{className:a("bwc-buttons-blue-large",this.props.className)}))},t}(s.Component);t.BlueLargeButton=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(55),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.Button,o({},this.props,{className:a("bwc-buttons-disabled",this.props.className)}))},t}(s.Component);t.DisabledButton=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(55),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.Button,o({},this.props,{className:a("bwc-buttons-disabled-large",this.props.className)}))},t}(s.Component);t.DisabledLargeButton=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(55),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.Button,o({},this.props,{className:a("bwc-buttons-hollow",this.props.className)}))},t}(s.Component);t.HollowButton=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(55),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.Button,o({},this.props,{className:a("bwc-buttons-hollow-large",this.props.className)}))},t}(s.Component);t.HollowLargeButton=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(55),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.Button,o({},this.props,{className:a("bwc-buttons-primary",this.props.className)}))},t}(s.Component);t.PrimaryButton=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(55),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.Button,o({},this.props,{className:a("bwc-buttons-primary-large",this.props.className)}))},t}(s.Component);t.PrimaryLargeButton=l},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(610)),n(r(611))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=r(2);r(331);var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=s("bwc-expandable-blocks-block",this.props.caption&&"with-caption",this.props.isExpanded?"is-expanded":"is-collapsed",this.props.className),t=!!this.props.isExpanded;return o.createElement("div",{className:e,style:this.props.style},o.createElement("div",{"aria-expanded":t,className:"header",onClick:this.props.onClick,onKeyPress:this.props.onKeyPress,tabIndex:this.props.onKeyPress?0:void 0},o.createElement("div",{className:"icon-container"},o.createElement("i",{className:"icon icon-chevron-right"})),this.props.caption&&o.createElement("div",{className:"caption",title:this.props.caption},this.props.caption),o.createElement("div",{className:"title",title:this.props.title},this.props.title)),o.createElement("div",{className:"content"},this.props.isExpanded?this.props.children:null))},t}(o.Component);t.ExpandableBlock=a,t.default=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=r(2);r(331);var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return o.createElement("div",{className:s("bwc-expandable-blocks-list",this.props.className),style:this.props.style},this.props.children)},t}(o.Component);t.ExpandableBlocksList=a,t.default=a},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(330)),n(r(613)),n(r(614)),n(r(332)),n(r(615)),n(r(333)),n(r(616)),n(r(334)),n(r(617))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("label",{className:a("bwc-inputs-radio",{disabled:this.props.disabled},this.props.status,this.props.className)},s.createElement("input",o({},this.props,{disabled:this.props.disabled,type:"radio"})),s.createElement("span",{className:"label"}," ",this.props.label," "))},t}(s.Component);t.Radio=c,t.default=c},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Success="success",e.Warning="warning",e.Error="error"}(n=t.InputStatus||(t.InputStatus={})),t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(332),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("label",{className:a("bwc-inputs-labeled-input",{disabled:this.props.disabled},this.props.status,this.props.className)},s.createElement("div",{className:"label"}," ",this.props.label," "),this.props.label&&s.createElement("div",{className:"label"}," ",this.props.label," "),s.createElement("div",{className:a("input",{"with-icon":!!this.props.status})},s.createElement(c.default,o({disabled:this.props.disabled},this.props)),this.props.status&&s.createElement("i",{className:a("icon","icon-status-"+this.props.status)})),this.props.message&&s.createElement("div",{className:"message"},this.props.message))},t}(s.Component);t.LabeledInput=l,t.default=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(333),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("label",{className:a("bwc-inputs-labeled-select",{disabled:this.props.disabled},this.props.status,this.props.className)},s.createElement("div",{className:"label"},this.props.label),s.createElement(c.default,o({disabled:this.props.disabled},this.props)),this.props.message&&s.createElement("div",{className:"message"},this.props.message))},t}(s.Component);t.LabeledSelect=l,t.default=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(334),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("label",{className:a("bwc-inputs-labeled-textarea",{disabled:this.props.disabled},this.props.status,this.props.className)},s.createElement("div",{className:"label"},this.props.label),s.createElement(c.default,o({disabled:this.props.disabled},this.props)),this.props.message&&s.createElement("div",{className:"message"},this.props.message))},t}(s.Component);t.LabeledTextarea=l,t.default=l},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(147)),n(r(619)),n(r(620)),n(r(621))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(147),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.default,o({className:a("bwc-loaders-large",this.props.className)},this.props))},t}(s.Component);t.LargeLoader=l,t.default=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(147),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.default,o({className:a("bwc-loaders-medium",this.props.className)},this.props))},t}(s.Component);t.MediumLoader=l,t.default=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(147),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.default,o({className:a("bwc-loaders-small",this.props.className)},this.props))},t}(s.Component);t.SmallLoader=l,t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(623))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(1),a=r(2);!function(e){e.Horizontal="horizontal",e.Vertical="vertical"}(o=t.SliderOrientation||(t.SliderOrientation={}));var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",{className:a("slider",this.props.className)},s.createElement("span",{className:"range-number"},this.props.from),s.createElement("input",{type:"text",className:"slider-body",value:"","data-slider-min":this.props.from,"data-slider-max":this.props.to,"data-slider-value":void 0!==this.props.valueFrom?"["+this.props.valueFrom+","+this.props.valueTo+"]":this.props.value,"data-slider-orientation":this.props.orientation,"data-slider-selection":"before","data-slider-tooltip":"show"}),s.createElement("span",{className:"range-toolbar"},this.props.to))},t.defaultProps={from:0,to:100,step:1,orientation:o.Horizontal,value:0},t}(s.Component);t.Slider=c,t.default=c},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(625)),n(r(626)),n(r(627)),n(r(628)),n(r(629)),n(r(630)),n(r(631)),n(r(632)),n(r(633)),n(r(634)),n(r(635))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("td",o({className:a("bwc-tables-cell",this.props.className)},this.props),this.props.children)},t}(s.Component);t.TablesCell=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("td",{className:a("bwc-tables-checkbox-cell",this.props.className)},s.createElement("label",null,s.createElement("input",o({},this.props,{type:"checkbox"}))))},t}(s.Component);t.TablesCheckboxCell=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("th",{className:a("bwc-tables-head-checkbox-cell",this.props.className)},s.createElement("label",null,s.createElement("input",o({},this.props,{type:"checkbox"}))))},t}(s.Component);t.TablesHeadCheckboxCell=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("td",o({className:a("bwc-tables-empty-cell",this.props.className)},this.props),this.props.children)},t}(s.Component);t.TablesEmptyCell=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("th",o({className:a("bwc-tables-head-empty-cell",this.props.className)},this.props),this.props.children)},t}(s.Component);t.TablesHeadEmptyCell=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("td",o({className:a("bwc-tables-icon-cell",this.props.className)},this.props),this.props.children)},t}(s.Component);t.TablesIconCell=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("th",o({className:a("bwc-tables-head-icon-cell",this.props.className)},this.props),this.props.children)},t}(s.Component);t.TablesHeadIconCell=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("th",o({className:a("bwc-tables-head-label-cell",this.props.className)},this.props),s.createElement("div",{className:"label-container"},s.createElement("span",{className:"label-text"},this.props.children),this.props.filterIcon&&s.createElement("img",{className:"filter-icon",src:this.props.filterIcon}),this.props.sortIcon&&s.createElement(s.Fragment,null,s.createElement("span",{className:"label-spacer"}),s.createElement("img",{className:"filter-icon",src:this.props.filterIcon}))))},t}(s.Component);t.TablesHeadLabelCell=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("tr",o({className:a("bwc-tables-row",this.props.className)},this.props),this.props.children)},t}(s.Component);t.TablesRow=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("table",o({className:a("bwc-tables-table-condensed",this.props.className)},this.props),this.props.children)},t}(s.Component);t.TablesTableCondensed=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("table",o({className:a("bwc-tables-table",this.props.className)},this.props),this.props.children)},t}(s.Component);t.TablesTable=c,t.default=c},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(637)),n(r(638))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=r(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this;return o.createElement("ul",{className:s("bwc-tabs-horizontal",{green:this.props.green},this.props.className)},this.props.labels.map(function(t,r){return o.createElement("li",{key:r,className:s({active:r===e.props.activeIndex})},o.createElement("a",{onClick:function(){e.props.onClickLabel&&e.props.onClickLabel(r)}},t))}))},t}(o.Component);t.HorizontalTabs=a,t.default=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=r(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this;return o.createElement("ul",{className:s("bwc-tabs-vertical",{green:this.props.green},this.props.className)},this.props.labels.map(function(t,r){return o.createElement("li",{key:r,className:s({active:r===e.props.activeIndex})},o.createElement("a",{onClick:function(){e.props.onClickLabel&&e.props.onClickLabel(r)}},t))}))},t}(o.Component);t.VerticalTabs=a,t.default=a},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(640)),n(r(641)),n(r(642)),n(r(643)),n(r(644)),n(r(645)),n(r(646)),n(r(647)),n(r(648)),n(r(649))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-block",this.props.className)}),this.props.children)},t}(s.Component);t.BodyText=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-headline",this.props.className)}),this.props.children)},t}(s.Component);t.Headline=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-leading",this.props.className)}),this.props.children)},t}(s.Component);t.LeadingText=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-leading-2",this.props.className)}),this.props.children)},t}(s.Component);t.LeadingText2=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-muted",this.props.className)}),this.props.children)},t}(s.Component);t.MutedText=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-small",this.props.className)}),this.props.children)},t}(s.Component);t.SmallText=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-subheading",this.props.className)}),this.props.children)},t}(s.Component);t.Subheading=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-subheading-2",this.props.className)}),this.props.children)},t}(s.Component);t.Subheading2=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-title",this.props.className)}),this.props.children)},t}(s.Component);t.Title=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement("div",o({},this.props,{className:a("bwc-text-title-2",this.props.className)}),this.props.children)},t}(s.Component);t.Title2=c,t.default=c},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(148)),n(r(651)),n(r(652)),n(r(653))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(148),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(a.default,o({},this.props,{featured:!0}),this.props.children)},t}(s.Component);t.FeaturedTile=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(148),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(a.default,o({},this.props,{minimal:!0}))},t}(s.Component);t.MinimalTile=c,t.default=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(148),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(a.default,o({},this.props,{minimal:!0,featured:!0}))},t}(s.Component);t.MinimalFeaturedTile=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(655))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=r(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return o.createElement("label",{className:s("toggle",{disabled:this.props.disabled},this.props.className)},o.createElement("input",{defaultChecked:this.props.isOn,className:"toggle-input",disabled:this.props.disabled,type:"checkbox"}),o.createElement("span",{className:"toggle-label","data-off":this.props.noLabel?"":"Off","data-on":this.props.noLabel?"":"On"}),o.createElement("span",{className:"toggle-handle"}))},t}(o.Component);t.Toggle=a},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(190)),n(r(191)),n(r(657)),n(r(658)),n(r(192)),n(r(659)),n(r(660))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(191),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.default,o({},this.props,{className:a("bwc-user-icons-medium",this.props.className)}))},t}(s.Component);t.UserIconsMedium=l,t.default=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(191),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.default,o({},this.props,{className:a("bwc-user-icons-large",this.props.className)}))},t}(s.Component);t.UserIconsLarge=l,t.default=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(192),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.default,o({},this.props,{className:a("bwc-user-icons-medium-block",this.props.className)}))},t}(s.Component);t.UserIconsMediumBlock=l,t.default=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(2),c=r(192),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return s.createElement(c.default,o({},this.props,{className:a("bwc-user-icons-large-block",this.props.className)}))},t}(s.Component);t.UserIconsLargeBlock=l,t.default=l},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(662)),n(r(663))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=r(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return o.createElement("div",{className:s("wizard",{advanced:this.props.advanced},this.props.className)},o.createElement("div",{className:"steps","data-steps":this.props.steps.length},this.props.steps),this.props.advanced&&o.createElement("p",{className:"lead"},o.createElement("span",{className:"step-count"},"Step ",this.props.stepNum," of ",this.props.steps.length)," ",this.props.children))},t}(o.Component);t.Wizard=a,t.default=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=r(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return o.createElement("div",{className:s("step",{first:this.props.first,last:this.props.last,completed:this.props.completed,current:this.props.current})},o.createElement("a",{href:this.props.href,onClick:this.props.onClick,"data-toggle":this.props.tooltip&&"tooltip","data-placement":this.props.tooltip&&"top",title:this.props.tooltip},o.createElement("span",{className:"step-bullet"},this.props.stepNum),o.createElement("p",null,this.props.children)))},t}(o.Component);t.WizardStep=a,t.default=a},function(e,t,r){},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(666)),n(r(667)),n(r(670)),n(r(672))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);class Div extends n.Component{render(){return n.createElement("div",Object.assign({className:this.props.className,style:this.props.style},this.props,this.state))}}t.Div=Div,t.default=Div},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(2);r(668),r(669),t.WebFontIcon=function(e){const t=i("bui-webfont-icon",e.iconName,e.className),r=Object.assign({},e,{className:t});return delete r.iconName,n.createElement("span",Object.assign({},r))}},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(2);r(671),t.WaitSpinner=function(e){const t=i("bui-waitspinner-div",e.className);return n.createElement("div",{className:t},n.createElement("div",{className:"bui-waitspinner-loader"},n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null)))}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.UiEvent=class UiEvent extends n.BeEvent{emit(e){this.raiseEvent(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(335))},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(676))},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),o=r(2);r(677);const s=r(3);var a;!function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Front=4]="Front",e[e.Bottom=5]="Bottom",e[e.Top=6]="Top"}(a=t.Face||(t.Face={}));t.Cube=class Cube extends i.Component{render(){const e=this.props,{faces:t,rotMatrix:r,className:s}=e,c=n(e,["faces","rotMatrix","className"]);return i.createElement("div",Object.assign({className:o("cube-css3d",s)},c),[a.Front,a.Back,a.Right,a.Left,a.Top,a.Bottom].map(e=>{const n=t&&t[e];return i.createElement(CubeFace,{key:e,rotMatrix:r,face:e},n)}))}};const c={[a.None]:"",[a.Front]:"front",[a.Back]:"back",[a.Right]:"right",[a.Left]:"left",[a.Top]:"top",[a.Bottom]:"bottom"};class CubeFace extends i.Component{constructor(){super(...arguments),this._faceWidth=0}render(){const e=this.props,{rotMatrix:t,face:r,style:l,children:u}=e,d=n(e,["rotMatrix","face","style","children"]);if(r===a.None)return null;const h=c[r],p=o("face",h);let f=s.Matrix3d.createRowValues(1,0,0,0,-1,0,0,0,1),g=s.Matrix3d.createIdentity();switch(this.props.face){case a.Bottom:g=s.Matrix3d.createRowValues(-1,0,0,0,1,0,0,0,-1),f=s.Matrix3d.createRowValues(-1,0,0,0,1,0,0,0,1);break;case a.Right:g=s.Matrix3d.createRowValues(0,0,1,0,1,0,-1,0,0),f=s.Matrix3d.createRowValues(0,1,0,1,0,0,0,0,1);break;case a.Left:g=s.Matrix3d.createRowValues(0,0,-1,0,1,0,1,0,0),f=s.Matrix3d.createRowValues(0,-1,0,-1,0,0,0,0,1);break;case a.Back:g=s.Matrix3d.createRowValues(1,0,0,0,0,1,0,-1,0),f=s.Matrix3d.createRowValues(-1,0,0,0,1,0,0,0,1);break;case a.Front:g=s.Matrix3d.createRowValues(1,0,0,0,0,-1,0,1,0),f=s.Matrix3d.createRowValues(1,0,0,0,-1,0,0,0,1)}const m=t.multiplyMatrixMatrix(g),y=m.multiplyXYZ(0,0,this._faceWidth),v=m.multiplyMatrixMatrix(f),_=`matrix3d(${[v.at(0,0),-v.at(1,0),v.at(2,0),0,v.at(0,1),-v.at(1,1),v.at(2,1),0,v.at(0,2),-v.at(1,2),v.at(2,2),0,y.at(0),-y.at(1),y.at(2)-this._faceWidth,1].join(",")})`,w=Object.assign({transform:_,WebkitTransform:_},l);return i.createElement("div",Object.assign({style:w,className:p,ref:e=>{this._faceWidth=e&&e.clientWidth/2||0}},d),u)}}t.CubeFace=CubeFace},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(336);t.Dialog=n.Dialog,t.ButtonStyle=n.ButtonStyle,t.ButtonType=n.ButtonType},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(681))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);r(682);t.ElementSeparator=class ElementSeparator extends n.PureComponent{constructor(){super(...arguments),this._dragStarted=!1,this._initialGlobalPosition=0,this._updateThreshold=.025,this._separatorSize=30,this._onPointerUp=(()=>{this.stopDrag()}),this._onPointerDown=(e=>{this._dragStarted?this.stopDrag():this.startDrag(e)}),this._onPointerMove=(e=>{if(!this.props.movableArea)return void this.stopDrag();const t=this.getCurrentGlobalPosition(e)-this._initialGlobalPosition;if(Math.abs(t)<this.props.movableArea*this._updateThreshold)return;const r=(this.props.movableArea*this.props.ratio+t)/this.props.movableArea;this._initialGlobalPosition=this.getCurrentGlobalPosition(e),this.props.onRatioChanged(r)})}getCurrentGlobalPosition(e){return 0===this.props.orientation?e.clientX:e.clientY}startDrag(e){this._dragStarted=!0,this._initialGlobalPosition=this.getCurrentGlobalPosition(e),document.addEventListener("pointerup",this._onPointerUp),document.addEventListener("pointermove",this._onPointerMove)}stopDrag(){this._dragStarted=!1,document.removeEventListener("pointerup",this._onPointerUp),document.removeEventListener("pointermove",this._onPointerMove)}getStyle(e){return 0===e?{width:this._separatorSize,height:"100%",margin:`1px ${-Math.floor(this._separatorSize/2)}px`,cursor:"col-resize"}:{width:"100%",height:this._separatorSize,margin:`${-Math.floor(this._separatorSize/2)}px 1px`,cursor:"row-resize"}}render(){return n.createElement("button",{style:this.getStyle(this.props.orientation),className:"core-element-separator",onPointerDown:this._onPointerDown})}}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(684);t.withIsPressed=n.withIsPressed;var i=r(685);t.withOnOutsideClick=i.withOnOutsideClick;var o=r(686);t.withTimeout=o.withTimeout},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1);t.withIsPressed=(e=>(class WithIsPressed extends i.Component{constructor(){super(...arguments),this.handleOnPointerDown=(()=>{this.changeIsPressed(!0)}),this.handleOnPointerUp=(()=>{this.changeIsPressed(!1)}),this.handleOnMouseLeave=(()=>{this.changeIsPressed(!1)}),this.changeIsPressed=(e=>{this.props.isPressed!==e&&this.props.onIsPressedChange&&this.props.onIsPressedChange(e)})}render(){const t=this.props,{isPressed:r,onIsPressedChange:o}=t,s=n(t,["isPressed","onIsPressedChange"]);return i.createElement("div",{className:"withispressed-wrapper",onMouseDown:this.handleOnPointerDown,onMouseUp:this.handleOnPointerUp,onTouchStart:this.handleOnPointerDown,onTouchEnd:this.handleOnPointerUp,onMouseLeave:this.handleOnMouseLeave},i.createElement(e,Object.assign({},s,this.state)))}})),t.default=t.withIsPressed},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),o=r(96);t.withOnOutsideClick=(e=>(class WithOnOutsideClick extends i.Component{constructor(){super(...arguments),this.handleDocumentClick=(e=>{if(!this.ref)return;const t=o.findDOMNode(this.ref);t&&t instanceof Element&&!t.contains(e.target)&&this.props.onOutsideClick&&this.props.onOutsideClick()}),this.setRef=(e=>{this.ref=e})}componentDidMount(){document.addEventListener("click",this.handleDocumentClick,!0)}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick,!0)}render(){const t=this.props,{onOutsideClick:r}=t,o=n(t,["onOutsideClick"]);return i.createElement("div",{ref:this.setRef},i.createElement(e,Object.assign({},o,this.state)))}})),t.default=t.withOnOutsideClick},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),o=r(193);t.withTimeout=(e=>(class WithTimeout extends i.Component{constructor(){super(...arguments),this.timer=new o.default(0)}componentDidMount(){this.timer.setOnExecute(()=>this.props.onTimeout&&this.props.onTimeout()),this.startTimer(this.props.timeout)}componentDidUpdate(e){this.startTimer(this.props.timeout)}componentWillUnmount(){this.timer.stop()}render(){const t=this.props,{timeout:r,onTimeout:o}=t,s=n(t,["timeout","onTimeout"]);return i.createElement(e,Object.assign({},s,this.state))}startTimer(e){this.timer.isRunning||(this.timer.delay=e,this.timer.start())}})),t.default=t.withTimeout},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(688);t.MessageBox=n.MessageBox,t.MessageSeverity=n.MessageSeverity,t.MessageContainer=n.MessageContainer},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(2);r(337),r(689);const o=r(336);var s;!function(e){e[e.None=0]="None",e[e.Information=1]="Information",e[e.Question=2]="Question",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Fatal=5]="Fatal"}(s=t.MessageSeverity||(t.MessageSeverity={}));class MessageBox extends n.Component{render(){return n.createElement(o.Dialog,{title:this.props.title,buttonCluster:this.props.buttonCluster,opened:this.props.opened,width:this.props.width,onClose:this.props.onClose,onEscape:this.props.onEscape,modal:!0},n.createElement(MessageContainer,{severity:this.props.severity},this.props.children))}}MessageBox.defaultProps={minWidth:400,minHeight:400,width:"512px"},t.MessageBox=MessageBox;class MessageContainer extends n.Component{static getIconClassName(e,t){switch(e){case s.Information:return t?"icon-info-hollow":"icon-info message-box-information";case s.Question:return t?"icon-help-hollow":"icon-help message-box-question";case s.Warning:return t?"icon-status-warning":"icon-status-warning message-box-warning";case s.Error:return t?"icon-status-error-hollow":"icon-status-error message-box-error";case s.Fatal:return t?"icon-status-rejected":"icon-status-rejected message-box-fatal"}return"icon-info"}render(){const e=i("icon","message-box-icon",MessageContainer.getIconClassName(this.props.severity));return n.createElement("div",{className:"message-box-container"},n.createElement("div",{className:e}),n.createElement("div",{className:"message-box-content"},this.props.children))}}t.MessageContainer=MessageContainer,t.default=MessageBox},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(691);t.Popup=n.Popup,t.Position=n.Position},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(96),o=r(2),s=r(193);var a;r(692),function(e){e[e.TopLeft=0]="TopLeft",e[e.TopRight=1]="TopRight",e[e.BottomLeft=2]="BottomLeft",e[e.BottomRight=3]="BottomRight",e[e.Top=4]="Top",e[e.Bottom=5]="Bottom",e[e.Left=6]="Left",e[e.Right=7]="Right"}(a=t.Position||(t.Position={}));class Popup extends n.Component{constructor(e,t){super(e,t),this._targetRef=null,this._hoverTimer=new s.default(300),this._onMouseEnter=(()=>{this.props.showOnHover&&(this._hoverTimer.setOnExecute(()=>{this._onShow()}),this._hoverTimer.start())}),this._onMouseLeave=(()=>{this.props.showOnHover&&(this._hoverTimer.stop(),this._onClose())}),this._onBodyClick=(e=>{const t=this._getContext();t!==e.target&&(t&&t.contains(e.target)||this._ref&&(this._ref===e.target||this._ref.contains(e.target))||this._onClose())}),this._onEsc=(e=>{"Escape"===e.key&&this._onClose()}),this.setRef=(e=>{this._ref=e}),this._getContext=(()=>this.props.context||this._targetRef),this.state={isShown:this.props.isShown,position:this.props.position}}componentDidMount(){const e=i.findDOMNode(this);e&&e.parentElement&&(this._targetRef=e.parentElement,this._targetRef.onmouseenter=this._onMouseEnter,this._targetRef.onmouseleave=this._onMouseLeave),this._hoverTimer.delay=this.props.showTime}componentDidUpdate(e){this.props.isShown!==e.isShown&&(this._hoverTimer.delay=this.props.showTime,this.props.isShown?this._onShow():this._onClose())}componentWillUnmount(){this._hoverTimer.stop(),document.body.removeEventListener("click",this._onBodyClick,!1),document.body.removeEventListener("keydown",this._onEsc,!1)}_onShow(){if(this.state.isShown&&!this.props.showOnHover)return;document.addEventListener("click",this._onBodyClick,!0),document.addEventListener("keydown",this._onEsc,!0);const e=this.withinViewport();this.setState(t=>({position:e,isShown:!0}),()=>{this.props.onOpen&&this.props.onOpen()})}_onClose(){this.state.isShown&&(document.removeEventListener("click",this._onBodyClick,!0),document.removeEventListener("keydown",this._onEsc,!0),this.setState(e=>({isShown:!1,position:this.props.position}),()=>{this.props.onClose&&this.props.onClose()}))}getPositionClassName(e){switch(e){case a.TopLeft:return o("popup-top-left");case a.TopRight:return o("popup-top-right");case a.BottomLeft:return o("popup-bottom-left");case a.BottomRight:return o("popup-bottom-right");case a.Top:return o("popup-top");case a.Left:return o("popup-left");case a.Right:return o("popup-right");default:return o("popup-bottom")}}withinViewport(){const e=i.findDOMNode(this);if(e&&this._targetRef){const t={left:window.scrollX,top:window.scrollY,right:window.scrollX+window.innerWidth,bottom:window.scrollY+window.innerHeight},r=this._targetRef.getBoundingClientRect(),n=e.getBoundingClientRect(),i=window.getComputedStyle(this._targetRef),o=this.props.showArrow?12:4;switch(this.props.position){case a.BottomRight:{const e=i.marginBottom?parseFloat(i.marginBottom):0;if(r.bottom+n.height+e+o>t.bottom)return a.TopRight;break}case a.TopRight:{const e=i.marginTop?parseFloat(i.marginTop):0;if(r.top-n.height-e-o<t.top)return a.BottomRight;break}case a.TopLeft:{const e=i.marginTop?parseFloat(i.marginTop):0;if(r.top-n.height-e-o<t.top)return a.BottomLeft;break}case a.BottomLeft:{const e=i.marginBottom?parseFloat(i.marginBottom):0;if(r.bottom+n.height+e+o>t.bottom)return a.TopLeft;break}case a.Bottom:{const e=i.marginBottom?parseFloat(i.marginBottom):0;if(r.bottom+n.height+e+o>t.bottom)return a.Top;break}case a.Top:{const e=i.marginTop?parseFloat(i.marginTop):0;if(r.top-n.height-e-o<t.top)return a.Bottom;break}case a.Left:{const e=i.marginLeft?parseFloat(i.marginLeft):0;if(r.left-n.width-e-o<t.left)return a.Right;break}case a.Right:{const e=i.marginRight?parseFloat(i.marginRight):0;if(r.right+n.width+e+o>t.right)return a.Left;break}}}return this.props.position}render(){const e=o("popup",this.getPositionClassName(this.state.position),this.props.showShadow&&"popup-shadow",this.state.isShown&&"visible",this.props.showArrow&&"arrow",this.props.className);return n.createElement("div",{className:e,ref:this.setRef},this.props.children)}}Popup.defaultProps={position:a.Bottom,showShadow:!0,showArrow:!1,showOnHover:!1,showTime:300,hideTime:300},t.Popup=Popup,t.default=Popup},function(e,t,r){},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(694)),n(r(338))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(2),o=r(338);r(695);class RadialMenu extends n.Component{constructor(){super(...arguments),this._root=null,this._selectedButton=null,this.state={sectors:[]},this._handleKeyUp=(e=>{27===e.keyCode&&this.props.onEsc&&this.props.onEsc(e)}),this._handleClick=(e=>{e.target instanceof HTMLElement&&this._root&&!e.target.contains(this._root)&&this.props.onBlur&&this.props.onBlur(e)}),this.select=(()=>{this._selectedButton&&this._selectedButton.select()}),this._generateAnnularSectors=(()=>{const e=n.Children.count(this.props.children),t=2*Math.PI/e,r=this.props.outerRadius,i=this.props.innerRadius,s=-Math.PI/8,a=new o.Annulus(new o.Point(r+1,r+1),i+1,r-1),c=[];for(let n=0;n<e;n++)c.push(new o.AnnularSector(a,t*n+s,t*(n+1)+s));this.setState({sectors:c})})}render(){const e=2*(this.props.outerRadius+1);let t=this.props.left,r=this.props.top;return this.props.left&&this.props.top&&"number"===typeof this.props.left&&"number"===typeof this.props.top&&(t=this.props.left,r=this.props.top,t<0&&(t=0),t>window.innerWidth-e&&(t=window.innerWidth-e),r<0&&(r=0),r>window.innerHeight-e&&(r=window.innerHeight-e)),n.createElement("div",{ref:e=>{this._root=e},className:i("radial-menu",{opened:this.props.opened}),style:{left:t,top:r}},n.createElement("svg",{xmlns:"http://w3.org/2000/svg",version:"1.1",width:e,height:e,className:"radial-menu-container"},n.Children.map(this.props.children,(e,t)=>"string"===typeof e||"number"===typeof e?e:n.cloneElement(e,{key:t,ref:e=>{this.props.selected===t&&(this._selectedButton=e)},selected:t===this.props.selected,labelRotate:e.props.labelRotate||this.props.labelRotate,annularSector:this.state.sectors[t]}))))}componentDidMount(){this._generateAnnularSectors(),window.addEventListener("keyup",this._handleKeyUp),window.addEventListener("mouseup",this._handleClick)}componentWillUnmount(){window.removeEventListener("keyup",this._handleKeyUp),window.removeEventListener("mouseup",this._handleClick)}componentDidUpdate(e){e.innerRadius===this.props.innerRadius&&e.outerRadius===this.props.outerRadius||this._generateAnnularSectors()}}RadialMenu.defaultProps={labelRotate:!1,selected:-1},t.RadialMenu=RadialMenu;t.RadialButton=class RadialButton extends n.Component{constructor(){super(...arguments),this.state={hover:this.props.selected||!1},this.select=(()=>{this.props.onSelect&&this.props.onSelect(void 0)}),this._handleClick=(e=>{this.props.onSelect&&this.props.onSelect(e)}),this._handleMouseOver=(e=>{this.setState({hover:!0})}),this._handleMouseOut=(e=>{this.setState({hover:!1})})}render(){const e=this.props.annularSector;let t=new o.Point,r=0,s="",a="";if(e){r=e.start.p1.distTo(e.end.p2),a=e.path;const n=e.parent,{x:i,y:c}=n.center,l=(n.inner.radius+n.outer.radius)/2,u=(e.startAngle+e.endAngle)/2;if(t=new o.Point(i+l*Math.cos(u),c+l*Math.sin(u)),this.props.labelRotate){let e=180*u/Math.PI+90;for(;e>180;)e-=360;for(;e<-180;)e+=360;e>90&&(e-=180),e<-90&&(e+=180),s=`rotate(${e} ${t.x}, ${t.y})`}}return n.createElement("g",{onMouseOver:this._handleMouseOver,onMouseOut:this._handleMouseOut,onClick:this._handleClick},n.createElement("path",{className:i("radial-menu-sector",{selected:this.state.hover}),d:a}),n.createElement("foreignObject",{transform:s,x:t.x-r/2,y:t.y-16,width:r,height:r,className:"radial-menu-button-svg"},n.createElement("div",Object.assign({},{xmlns:"http://www.w3.org/1999/xhtml"},{className:"radial-menu-button-container"}),n.createElement("div",{className:i("radial-menu-icon","icon",this.props.icon)}),n.createElement("div",{className:"radial-menu-button-content"},this.props.children))))}}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(697);t.SearchBox=n.SearchBox},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(2),o=r(189);r(698);class SearchBox extends n.Component{constructor(){super(...arguments),this._inputElement=null,this._timeoutId=0,this.state={value:this.props.initialValue||""},this._trackChange=(e=>{let t="";this._inputElement&&(t=this._inputElement.value),this.setState(e=>({value:t}),()=>{this.props.valueChangedDelay?(this._unsetTimeout(),this._timeoutId=window.setTimeout(()=>{this.props.onValueChanged(this.state.value)},this.props.valueChangedDelay)):this.props.onValueChanged(this.state.value)})}),this._handleKeyDown=(e=>{switch(e.key){case"Escape":this.props.onEscPressed&&this.props.onEscPressed();break;case"Enter":this.props.onEnterPressed&&this.props.onEnterPressed()}}),this._handleIconClick=(e=>{if(this._inputElement){const e=""!==this.state.value;this._inputElement.value="",e&&this.props.onClear&&this.props.onClear(),this._inputElement.focus()}this._trackChange()}),this._unsetTimeout=(()=>{this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=0)})}render(){const e=""===this.state.value,t=i("searchbox-icon","icon",{"icon-search":e,"icon-close":!e});return n.createElement("div",{className:"searchbox"},n.createElement("input",{ref:e=>{this._inputElement=e},onChange:this._trackChange,onKeyDown:this._handleKeyDown,onPaste:this._trackChange,onCut:this._trackChange,placeholder:this.props.placeholder?this.props.placeholder:o.default.i18n.translate("UiCore:searchbox.search")}),n.createElement("div",{className:"searchbox-button",onClick:this._handleIconClick},n.createElement("span",{className:t})))}componentWillUnmount(){this._unsetTimeout()}}t.SearchBox=SearchBox,t.default=SearchBox},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(700))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(2),o=r(335);r(701),function(e){e[e.ContextMenu=0]="ContextMenu",e[e.List=1]="List"}(t.SplitButtonActionType||(t.SplitButtonActionType={}));class SplitButton extends n.Component{constructor(){super(...arguments),this._arrowElement=null,this._menu=null,this._closing=!1,this.state={expanded:!1},this._handleKeyUp=(e=>{13!==e.keyCode&&40!==e.keyCode||this.state.expanded||(this._closing=!1,this._open())}),this._open=(()=>{this.state.expanded||this._closing?this._closing=!1:this.setState({expanded:!0},()=>{this._menu&&this.state.expanded&&this._menu.focus()})}),this._handleClick=(e=>{this.state.expanded?(e.stopPropagation(),this.setState({expanded:!1})):this._open()}),this._handleClose=(e=>{this._arrowElement&&(this.state.expanded&&"target"in e&&this._arrowElement.contains(e.target)&&(this._closing=!0),this.setState(e=>({expanded:!1})),this._arrowElement.focus())})}render(){let e=n.createElement(n.Fragment,null);return void 0!==this.props.icon&&(e=n.createElement("span",{className:i.default("icon",this.props.icon)})),n.createElement("div",{className:i.default("split-button",this.props.className,{expanded:this.state.expanded})},n.createElement("div",{onClick:this.props.onClick,className:"split-button-label"},e," ",this.props.label),n.createElement("div",{className:"split-button-arrow",ref:e=>{this._arrowElement=e},onClick:this._handleClick,tabIndex:0,onKeyUp:this._handleKeyUp},n.createElement("div",{className:i.default("split-button-arrow-icon","icon","icon-chevron-down")}),n.createElement(o.ContextMenu,{ref:e=>{this._menu=e},selected:0,onSelect:this._handleClose,onBlur:this._handleClose,onEsc:this._handleClose,opened:this.state.expanded,autoflip:!1},this.props.children)))}}t.SplitButton=SplitButton,t.default=SplitButton},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(703))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(2);var o;r(704),function(e){e[e.Primary=0]="Primary",e[e.Blue=1]="Blue"}(o=t.ToggleButtonType||(t.ToggleButtonType={}));class Toggle extends n.Component{constructor(e,t){super(e,t),this._padding=2,this._handleChange=(()=>{this.setState({checked:!this.state.checked},()=>{this.props.onChange&&this.props.onChange(this.state.checked)})}),this._setHeight=((e,t)=>{this.state.height===e&&this.state.width===t||this.setState({height:e,width:t})}),this.state={height:0,width:0,checked:this.props.isOn}}_getOffset(){return this.state.checked?this.state.width-this.state.height:0}render(){const e=this.state.height/2,t=i("toggle-checkmark icon icon-checkmark",this.props.showCheckmark&&"visible"),r={borderRadius:this.props.rounded?e:3,fontSize:e},s=i("toggle",this.props.buttonType===o.Primary&&"toggle-primary",this.props.rounded&&"rounded",{disabled:this.props.disabled},this.props.className),a={width:this.state.height-2*this._padding,transform:"translateX("+this._getOffset()+"px)",top:this._padding,bottom:this._padding,left:this._padding};return n.createElement("label",{ref:e=>{e&&this._setHeight(e.clientHeight,e.clientWidth)},style:r,className:s},n.createElement("input",{defaultChecked:this.props.isOn,className:"toggle-input",disabled:this.props.disabled,type:"checkbox",onChange:this._handleChange}),n.createElement("span",{className:"toggle-label"}),n.createElement("span",{className:t}),n.createElement("span",{className:"toggle-handle",style:a}))}}Toggle.defaultProps={rounded:!0,isOn:!1,showCheckmark:!0,buttonType:o.Blue},t.Toggle=Toggle,t.default=Toggle},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(339);t.ExpansionToggle=n.default;var i=r(707);t.TreeBranch=i.default;var o=r(709);t.TreeNode=o.default;var s=r(711);t.Tree=s.default},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(1);r(708);t.default=class TreeBranch extends i.PureComponent{render(){const e=n("nz-tree-branch",this.props.className);return i.createElement("div",{className:e,style:this.props.style},this.props.children)}}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(1),o=r(339);r(710);t.default=class TreeNode extends i.PureComponent{constructor(){super(...arguments),this._onClickExpansionToggle=(e=>{e.stopPropagation(),this.props.onClickExpansionToggle&&this.props.onClickExpansionToggle()}),this._onClick=(e=>{e.stopPropagation(),this.props.onClick&&this.props.onClick(e)})}render(){const e=n("nz-tree-node",this.props.isFocused&&"is-focused",this.props.isSelected&&"is-selected",this.props.isHoverDisabled&&"is-hover-disabled",this.props.className),t=20*this.props.level,r=this.props.isLoading?i.createElement("div",{className:"loader"},i.createElement("i",null),i.createElement("i",null),i.createElement("i",null),i.createElement("i",null),i.createElement("i",null),i.createElement("i",null)):void 0,s=this.props.icon?i.createElement("div",{className:"icon"},this.props.icon):void 0,a=this.props.isLoading||this.props.isLeaf?void 0:i.createElement(o.default,{className:"expansion-toggle","data-testid":this.createSubComponentTestId("expansion-toggle"),onClick:this._onClickExpansionToggle,isExpanded:this.props.isExpanded}),c=Object.assign({},this.props.style,{paddingLeft:t});return i.createElement("div",{className:e,style:c,"data-testid":this.props["data-testid"]},r,a,i.createElement("div",{className:"contents","data-testid":this.createSubComponentTestId("contents"),onClick:this._onClick,onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onMouseMove:this.props.onMouseMove},s,this.props.label),i.createElement("div",{className:"whole-row"}),this.props.children)}createSubComponentTestId(e){if(this.props["data-testid"])return`${this.props["data-testid"]}-${e}`}}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(1);r(712);t.default=class Tree extends i.PureComponent{constructor(){super(...arguments),this._treeElement=i.createRef()}scrollToElement(e){if(!this._treeElement.current)return;const t=this._treeElement.current.getBoundingClientRect(),r=e.left-t.left+this._treeElement.current.scrollLeft,n=e.top-t.top+this._treeElement.current.scrollTop;this._treeElement.current.scrollTo(Math.max(0,r-t.width+e.width+30),n)}getElementsByClassName(e){return this._treeElement.current?[...this._treeElement.current.getElementsByClassName(e)]:[]}render(){const e=n.default("nz-tree-tree",this.props.className);return i.createElement("div",{ref:this._treeElement,className:e,style:this.props.style,onMouseDown:this.props.onMouseDown,onMouseMove:this.props.onMouseMove,onMouseUp:this.props.onMouseUp},this.props.children)}}},function(e,t,r){},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(340)),n(r(714))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(340);t.LocalUiSettings=class LocalUiSettings{constructor(e=window){this.w=e,this.getSetting=((e,t)=>{const r=this.w.localStorage.getItem(`${e}.${t}`);return null!==r?{status:n.UiSettingsStatus.Success,setting:JSON.parse(r)}:{status:n.UiSettingsStatus.NotFound}}),this.saveSetting=((e,t,r)=>(this.w.localStorage.setItem(`${e}.${t}`,JSON.stringify(r)),{status:n.UiSettingsStatus.Success})),this.deleteSetting=((e,t)=>{const r=`${e}.${t}`;return null===this.w.localStorage.getItem(r)?{status:n.UiSettingsStatus.NotFound}:(this.w.localStorage.removeItem(r),{status:n.UiSettingsStatus.Success})})}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});var i=r(193);t.Timer=i.default,n(r(716)),n(r(717))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDisplayName=(e=>e.displayName?e.displayName:e.name?e.name:"Component")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shallowDiffers=((e,t)=>{if(e===t)return!1;if(void 0===e||void 0===t)return!0;for(const r in e)if(!(r in t))return!0;for(const r in t)if(e[r]!==t[r])return!0;return!1})},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(719)),n(r(849)),n(r(365)),n(r(866))},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(1)),s=i(r(2));r(720);const a=r(0),c=r(32),l=r(195),u=r(32),d=r(196),h=i(r(92));var p;!function(e){e.Dropdown="dropdown",e.Input="input"}(p=t.BreadcrumbMode||(t.BreadcrumbMode={}));class Breadcrumb extends o.Component{constructor(e){super(e),this._mounted=!1,this._handleUpdate=(e=>{if(e.currentNode&&this._mounted){const t=this._tree.node(e.currentNode.id);this.setState({current:t})}else this.setState({current:void 0})}),this._onModelLoaded=(e=>{this.props.onRootNodesLoaded&&this.props.onRootNodesLoaded(e.map(e=>e.payload));const t=this.state.current?this._tree.node(this.state.current.payload.id):void 0;t!==this.state.current&&this.setState({current:t})}),this._onChildrenLoaded=(e=>{const t=e.getChildren();this.props.onChildrenLoaded&&this.props.onChildrenLoaded(e.payload,d.toNodes(t).map(e=>e.payload));const r=this.state.current?this._tree.node(this.state.current.payload.id):void 0;r!==this.state.current&&this.setState({current:r})}),this._onModelChanged=(e=>{}),this._onModelReady=(()=>{this._mounted&&this.setState({modelReady:!0})}),this._onTreeNodeChanged=(e=>{a.using(this._tree.pauseRendering(),async()=>{if(e)for(const t of e)if(t){const e=this._tree.node(t.id);e&&(e.assign(Breadcrumb.inspireNodeFromTreeNodeItem(t,Breadcrumb.inspireNodeFromTreeNodeItem.bind(this))),await e.loadChildren())}else await this._tree.reload(),await Promise.all(this._tree.nodes().map(e=>e.loadChildren()))})}),this._handleOutsideClick=(()=>{this.setState({currentMode:p.Dropdown})}),this._handleInputCancel=(()=>{this.setState({currentMode:p.Dropdown})}),this._handleInputSubmit=(e=>{if(this.props.path)this.props.path.setCurrentNode(e);else if(e){const t=this._tree.node(e.id);this.setState({current:t})}else this.setState({current:void 0});this.setState({currentMode:p.Dropdown})}),this._handleNodeSelected=(e=>{this.props.path&&this.props.path.setCurrentNode(e)}),this._handleInputStart=(()=>{this.setState({currentMode:p.Input})}),this.state={modelReady:!l.isTreeDataProviderInterface(e.dataProvider),width:e.width,currentMode:e.initialBreadcrumbMode},this._recreateTree()}componentDidMount(){this._mounted=!0,this.props.onRender&&this.props.onRender(),this.props.path&&(this.props.path.setDataProvider(this.props.dataProvider),this.props.path.BreadcrumbUpdateEvent.addListener(this._handleUpdate)),l.isTreeDataProviderInterface(this.props.dataProvider)&&this.props.dataProvider.onTreeNodeChanged&&this.props.dataProvider.onTreeNodeChanged.addListener(this._onTreeNodeChanged)}componentWillUnmount(){this._tree.removeAllListeners(),this.props.path&&this.props.path.BreadcrumbUpdateEvent.removeListener(this._handleUpdate),l.isTreeDataProviderInterface(this.props.dataProvider)&&this.props.dataProvider.onTreeNodeChanged&&this.props.dataProvider.onTreeNodeChanged.removeListener(this._onTreeNodeChanged),this._mounted=!1}_recreateTree(){this._tree=new d.BeInspireTree({dataProvider:this.props.dataProvider,renderer:this._onModelChanged,mapPayloadToInspireNodeConfig:Breadcrumb.inspireNodeFromTreeNodeItem}),this._tree.on(d.BeInspireTreeEvent.ModelLoaded,this._onModelLoaded),this._tree.on(d.BeInspireTreeEvent.ChildrenLoaded,this._onChildrenLoaded),this._tree.ready.then(this._onModelReady)}shouldComponentUpdate(e,t){return this.state.modelReady!==t.modelReady||!!t.modelReady&&(this.props.renderNode!==e.renderNode||this.props.dataProvider!==e.dataProvider||this.state.current!==t.current||this.state.currentMode!==t.currentMode)}componentDidUpdate(e){this.props.onRender&&this.props.onRender(),this.props.dataProvider!==e.dataProvider&&(l.isTreeDataProviderInterface(e.dataProvider)&&e.dataProvider.onTreeNodeChanged&&e.dataProvider.onTreeNodeChanged.removeListener(this._onTreeNodeChanged),l.isTreeDataProviderInterface(this.props.dataProvider)&&this.props.dataProvider.onTreeNodeChanged&&this.props.dataProvider.onTreeNodeChanged.addListener(this._onTreeNodeChanged),this.setState({modelReady:!1},()=>{this._recreateTree()}))}static inspireNodeFromTreeNodeItem(e,t){const r={id:e.id,text:e.label,itree:{state:{collapsed:!1}}};return e.icon&&(r.itree.icon=e.icon),e.hasChildren?r.children=!0:e.children&&(r.children=e.children.map(e=>t(e,t))),r}render(){return o.createElement(o.StrictMode,null,o.createElement("div",{className:s.default("breadcrumb",{background:this.props.background})},o.createElement("div",{className:"breadcrumb-head","data-testid":"breadcrumb-dropdown-input-parent"},this.props.dropdownOnly||this.props.staticOnly?o.createElement(BreadcrumbDropdown,{tree:this._tree,node:this.state.current,onNodeSelected:this._handleNodeSelected,renderNode:this.props.renderNode,staticOnly:this.props.staticOnly,showUpDir:this.props.showUpDir,parentsOnly:this.props.parentsOnly,width:this.props.width}):o.createElement(f,{tree:this._tree,node:this.state.current,currentMode:this.state.currentMode,onInputStart:this._handleInputStart,onInputSubmit:this._handleInputSubmit,onInputCancel:this._handleInputCancel,onNodeSelected:this._handleNodeSelected,width:this.props.width,showUpDir:this.props.showUpDir,parentsOnly:this.props.parentsOnly,delimiter:this.props.delimiter,onOutsideClick:this._handleOutsideClick,renderNode:this.props.renderNode}))))}}Breadcrumb.defaultProps={delimiter:"\\",background:!0,initialBreadcrumbMode:p.Dropdown,showUpDir:!0,parentsOnly:!0,width:""},t.Breadcrumb=Breadcrumb;class InputSwitchComponent extends o.PureComponent{render(){const{currentMode:e,tree:t,node:r,onInputStart:n,onInputSubmit:i,onInputCancel:s,onNodeSelected:a,renderNode:c,width:l,showUpDir:u,delimiter:d}=this.props;switch(e){case p.Dropdown:return o.createElement(BreadcrumbDropdown,{tree:t,node:r,onNodeSelected:a,renderNode:c,onInputStart:n,parentsOnly:this.props.parentsOnly,showUpDir:u,width:l});case p.Input:return o.createElement(BreadcrumbInput,{tree:t,node:r,onSubmit:i,onCancel:s,parentsOnly:this.props.parentsOnly,delimiter:d,width:l});default:throw new Error("Invalid Prop: currentMode. Must be of type BreadcrumbMode.")}}}t.InputSwitchComponent=InputSwitchComponent;const f=c.withOnOutsideClick(InputSwitchComponent);class BreadcrumbInput extends o.Component{constructor(){super(...arguments),this._inputElement=null,this._autocomplete=null,this.state={autocompleting:!1,autocompleteList:[]},this._handleClose=(()=>{this.props.onCancel&&this.props.onCancel(),this.setState({autocompleting:!1})}),this._getAutocompleteList=(async e=>{const t=await this._findChild(e);if(t){const e=t.getTextualHierarchy().join(this.props.delimiter),r="boolean"===typeof t.getChildren()?await t.loadChildren():t.getChildren();return(this.props.parentsOnly?r.filter(e=>e.hasOrWillHaveChildren()):r).map(t=>e+this.props.delimiter+t.toString())}{const e=this.props.tree.nodes();return(this.props.parentsOnly?e.filter(e=>e.hasOrWillHaveChildren()):e).map(e=>e.toString()+this.props.delimiter)}}),this._findChild=(async e=>{const t=this.props.delimiter;if(e.lastIndexOf(t)===e.length-t.length&&(e=e.substr(0,e.length-t.length)),0===e.length)return;const r=await this.props.tree.nodes();for(const n of r){const t=await this._find(n,e);if(t)return t}}),this._find=(async(e,t)=>{const r=this.props.delimiter;0===t.indexOf(r)&&(t=t.substr(r.length));const{text:n}=e;if(n===t)return e;if(0===t.indexOf(n)&&e.hasOrWillHaveChildren()){const r="boolean"===typeof e.getChildren()?await e.loadChildren():e.getChildren();for(const e of r){const r=await this._find(e,t.substr(n.length));if(r)return r}}}),this._handleClick=(e=>{this._autocomplete&&this._inputElement&&e.target===this._inputElement&&(this.setState({autocompleting:!1}),this._inputElement.focus())}),this._handleKeyDown=(e=>{switch(e.keyCode){case 38:case 40:e.preventDefault()}}),this._handleKeyUp=(async e=>{switch(e.keyCode){case 27:this.setState({autocompleting:!1});break;case 38:case 40:e.preventDefault(),this._autocomplete&&this.state.autocompleteList.length>0?(this._autocomplete.focus(),this.setState({autocompleting:!0})):this._inputElement&&this._inputElement.focus();break;case 13:if(this._inputElement&&this.props.onSubmit){const e=this._inputElement.value;if(""===e||e===this.props.delimiter)this.props.onSubmit(void 0),this.setState({autocompleting:!1});else{const t=await this._findChild(e);void 0===t?alert(h.default.i18n.translate("UiComponents:breadcrumb.invalidBreadcrumbPath")):(this.props.onSubmit(t.payload),this.setState({autocompleting:!1}))}}}}),this._handleChange=(()=>{if(this._inputElement){const e=this._inputElement.value.substring(0,this._inputElement.selectionEnd);this._getAutocompleteList(e).then(e=>{this.setState({autocompleting:e.length>0,autocompleteList:e})})}})}render(){let e=0;if(this._inputElement){e=this._inputElement.getBoundingClientRect().width}return o.createElement("div",{className:"breadcrumb-input-root","data-testid":"breadcrumb-input-root"},o.createElement("input",{className:"breadcrumb-input",type:"text",ref:e=>{this._inputElement=e},style:{width:this.props.width},onKeyDown:this._handleKeyDown,onKeyUp:this._handleKeyUp,onChange:this._handleChange,onPaste:this._handleChange,onCut:this._handleChange,onFocus:this._handleChange,onClick:this._handleChange,spellCheck:!1}),o.createElement("div",{className:"breadcrumb-close icon icon-close","data-testid":"breadcrumb-input-close",onClick:this._handleClose}),o.createElement(u.ContextMenu,{ref:e=>{this._autocomplete=e},opened:this.state.autocompleting,edgeLimit:!1,style:{width:e},selected:0,floating:!1,autoflip:!1,onEsc:()=>{this._inputElement&&this._inputElement.focus()}},this.state.autocompleteList.map((e,t)=>{let r=0;return this._inputElement&&(r=this._inputElement.value.length),o.createElement(u.ContextMenuItem,{key:t,onSelect:t=>{if(this._inputElement){this._inputElement.value=e,this._inputElement.focus(),this._inputElement.setSelectionRange(e.length,e.length);const r=this._inputElement.value.substring(0,this._inputElement.selectionEnd);this._getAutocompleteList(r).then(e=>{this.setState({autocompleting:!1,autocompleteList:e})}),t.stopPropagation()}}},o.createElement("span",{className:"breadcrumb-selected"},e.substr(0,r)),e.substr(r))})))}componentDidMount(){window.addEventListener("click",this._handleClick),this._inputElement&&(this._inputElement.value=this.props.node?this.props.node.getTextualHierarchy().join(this.props.delimiter):"",this._inputElement.focus())}componentWillUnmount(){window.removeEventListener("click",this._handleClick)}}t.BreadcrumbInput=BreadcrumbInput;class BreadcrumbDropdown extends o.Component{constructor(){super(...arguments),this._onModelLoaded=(e=>{this.forceUpdate()}),this._onChildrenLoaded=(e=>{this.forceUpdate()}),this._handleUpClick=(()=>{if(this.props.onNodeSelected){let e;if(this.props.node){const t=this.props.node.getParent();t&&(e=t.payload)}this.props.onNodeSelected(e)}}),this._focusInput=(e=>{e.target===e.currentTarget&&this.props.onInputStart&&this.props.onInputStart()})}componentDidMount(){this.props.node&&this.props.node.hasOrWillHaveChildren()&&!this.props.node.hasLoadedChildren()&&this.props.node.loadChildren(),this.props.tree.on(d.BeInspireTreeEvent.ChildrenLoaded,this._onChildrenLoaded),this.props.tree.on(d.BeInspireTreeEvent.ModelLoaded,this._onModelLoaded)}componentWillUnmount(){this.props.tree.removeListener(d.BeInspireTreeEvent.ChildrenLoaded,this._onChildrenLoaded),this.props.tree.removeListener(d.BeInspireTreeEvent.ModelLoaded,this._onModelLoaded)}shouldComponentUpdate(e){return this.props.tree!==e.tree||this.props.node!==e.node||e.node&&e.node.isDirty()||this.props.onInputStart!==e.onInputStart||this.props.delimiter!==e.delimiter||this.props.width!==e.delimiter||this.props.renderNode!==e.renderNode}render(){const e=this.props.node;let t;return e&&((t=d.toNodes(e.getParents())).reverse(),t.push(e)),o.createElement("div",{className:"breadcrumb-dropdown","data-testid":"breadcrumb-dropdown-background",style:{width:this.props.width},onClick:this._focusInput},!this.props.staticOnly&&this.props.showUpDir?o.createElement("div",{className:s.default("breadcrumb-up-dir","icon","icon-sort-up",{root:void 0===this.props.node}),onClick:this._handleUpClick}):void 0,o.createElement("div",{className:"breadcrumb-crumb-list","data-testid":"breadcrumb-crumb-list"},o.createElement(BreadcrumbDropdownNode,{key:-1,tree:this.props.tree,node:void 0,onNodeSelected:this.props.onNodeSelected,staticOnly:this.props.staticOnly,parentsOnly:this.props.parentsOnly,last:!t||0===t.length,renderNode:this.props.renderNode}),t&&t.map((e,r)=>o.createElement(BreadcrumbDropdownNode,{key:r,tree:this.props.tree,node:e,onNodeSelected:this.props.onNodeSelected,staticOnly:this.props.staticOnly,parentsOnly:this.props.parentsOnly,last:r===t.length-1,renderNode:this.props.renderNode}))))}}t.BreadcrumbDropdown=BreadcrumbDropdown;class BreadcrumbDropdownNode extends o.Component{constructor(e){super(e),this.renderNode=((e,t,r,n)=>o.createElement(BreadcrumbNode,{label:e.label,icon:e.icon}))}render(){const{node:e}=this.props;let t=this.props.tree.nodes();e&&(t=d.toNodes(e.getChildren()));const r=e&&e.payload;let n;if(e){const t=e.getParent();t&&(n=t.payload)}const i=r&&r.label?r.label:" ",a=r&&r.icon?r.icon:"icon-browse",l=this.props.renderNode?this.props.renderNode:this.renderNode;return this.props.parentsOnly&&(t=t.filter(e=>e.hasOrWillHaveChildren())),t.length>0?this.props.staticOnly?o.createElement("span",{className:"breadcrumb-split-button static"},l({label:i,icon:a},r,n),this.props.last?void 0:o.createElement("span",{className:"static-arrow-icon icon icon-chevron-right"})):o.createElement(c.SplitButton,{className:"breadcrumb-split-button",onClick:e=>{e.stopPropagation(),this.props.onNodeSelected&&this.props.onNodeSelected(r)},label:l({label:i,icon:a},r,n)},t.map((e,t)=>o.createElement(u.ContextMenuItem,{key:t,icon:e.payload.icon,onSelect:t=>{this.props.onNodeSelected&&this.props.onNodeSelected(e.payload)}},e.payload.label))):o.createElement("span",{className:s.default("breadcrumb-end-node",{static:this.props.staticOnly})},l({label:i,icon:a},r,n))}}t.BreadcrumbDropdownNode=BreadcrumbDropdownNode;class BreadcrumbNode extends o.Component{render(){const{icon:e,label:t}=this.props;return o.createElement("span",null,o.createElement("span",{className:s.default("icon",e||"")})," ",t)}}t.BreadcrumbNode=BreadcrumbNode},function(e,t,r){},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(722)),s=i(r(1));r(723);t.default=class HighlightingEngine{constructor(e){this._searchText=e.searchText,this._activeResultNode=e.activeResultNode}isNodeActive(e){return this._activeResultNode&&e.id===this._activeResultNode.id}getActiveNodeIndex(e){return this.isNodeActive(e)?this._activeResultNode.index:void 0}static scrollToActiveNode(e){const t=e.getElementsByClassName("ui-components-activehighlight");0!==t.length&&(Element.prototype.scrollTo?e.scrollToElement(t[0].getBoundingClientRect()):t[0].scrollIntoView())}createRenderProps(e){return{searchText:this._searchText,activeResultIndex:this.getActiveNodeIndex(e)}}static renderNodeLabel(e,t){return s.createElement(o.default,{searchWords:[t.searchText],activeIndex:t.activeResultIndex,activeClassName:"ui-components-activehighlight",autoEscape:!0,textToHighlight:e})}}},function(e,t,r){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(2),o=(n=i)&&n.__esModule?n:{default:n};t.default=o.default,e.exports=t.default},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var i=r(3),o=n(r(4)),s=n(r(14)),a=n(r(15));function c(e){var t=e.activeClassName,r=void 0===t?"":t,n=e.activeIndex,o=void 0===n?-1:n,c=e.activeStyle,l=e.autoEscape,u=e.caseSensitive,d=void 0!==u&&u,h=e.className,p=e.findChunks,f=e.highlightClassName,g=void 0===f?"":f,m=e.highlightStyle,y=void 0===m?{}:m,v=e.highlightTag,_=void 0===v?"mark":v,w=e.sanitize,S=e.searchWords,b=e.textToHighlight,x=e.unhighlightClassName,P=void 0===x?"":x,C=e.unhighlightStyle,T=(0,i.findAll)({autoEscape:l,caseSensitive:d,findChunks:p,sanitize:w,searchWords:S,textToHighlight:b}),M=_,E=-1,I="",A=void 0,R=(0,a.default)(function(e){var t={};for(var r in e)t[r.toLowerCase()]=e[r];return t});return s.default.createElement("span",{className:h},T.map(function(e,t){var n=b.substr(e.start,e.end-e.start);if(e.highlight){E++;var i=void 0;i="object"===typeof g?d?g[n]:(g=R(g))[n.toLowerCase()]:g;var a=E===+o;return I=i+" "+(a?r:""),A=!0===a&&null!=c?Object.assign({},y,c):y,s.default.createElement(M,{className:I,key:t,style:A},n)}return s.default.createElement("span",{className:P,key:t,style:C},n)}))}c.propTypes={activeClassName:o.default.string,activeIndex:o.default.number,activeStyle:o.default.object,autoEscape:o.default.bool,className:o.default.string,findChunks:o.default.func,highlightClassName:o.default.oneOfType([o.default.object,o.default.string]),highlightStyle:o.default.object,highlightTag:o.default.oneOfType([o.default.node,o.default.func,o.default.string]),sanitize:o.default.func,searchWords:o.default.arrayOf(o.default.oneOfType([o.default.string,o.default.instanceOf(RegExp)])).isRequired,textToHighlight:o.default.string.isRequired,unhighlightClassName:o.default.string,unhighlightStyle:o.default.object},e.exports=t.default},function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);Object.defineProperty(t,"combineChunks",{enumerable:!0,get:function(){return n.combineChunks}}),Object.defineProperty(t,"fillInChunks",{enumerable:!0,get:function(){return n.fillInChunks}}),Object.defineProperty(t,"findAll",{enumerable:!0,get:function(){return n.findAll}}),Object.defineProperty(t,"findChunks",{enumerable:!0,get:function(){return n.findChunks}})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.findAll=function(e){var t=e.autoEscape,o=e.caseSensitive,s=void 0!==o&&o,a=e.findChunks,c=void 0===a?n:a,l=e.sanitize,u=e.searchWords,d=e.textToHighlight;return i({chunksToHighlight:r({chunks:c({autoEscape:t,caseSensitive:s,sanitize:l,searchWords:u,textToHighlight:d})}),totalLength:d?d.length:0})};var r=t.combineChunks=function(e){var t=e.chunks;return t=t.sort(function(e,t){return e.start-t.start}).reduce(function(e,t){if(0===e.length)return[t];var r=e.pop();if(t.start<=r.end){var n=Math.max(r.end,t.end);e.push({start:r.start,end:n})}else e.push(r,t);return e},[])},n=function(e){var t=e.autoEscape,r=e.caseSensitive,n=e.sanitize,i=void 0===n?o:n,s=e.searchWords,a=e.textToHighlight;return a=i(a),s.filter(function(e){return e}).reduce(function(e,n){n=i(n),t&&(n=n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"));for(var o=new RegExp(n,r?"g":"gi"),s=void 0;s=o.exec(a);){var c=s.index,l=o.lastIndex;l>c&&e.push({start:c,end:l}),s.index==o.lastIndex&&o.lastIndex++}return e},[])};t.findChunks=n;var i=t.fillInChunks=function(e){var t=e.chunksToHighlight,r=e.totalLength,n=[],i=function(e,t,r){t-e>0&&n.push({start:e,end:t,highlight:r})};if(0===t.length)i(0,r,!1);else{var o=0;t.forEach(function(e){i(o,e.start,!1),i(e.start,e.end,!0),o=e.end}),i(o,r,!1)}return n};function o(e){return e}}])},function(e,t,r){(function(t){if("production"!==t.env.NODE_ENV){var n="function"===typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;e.exports=r(6)(function(e){return"object"===typeof e&&null!==e&&e.$$typeof===n},!0)}else e.exports=r(13)()}).call(t,r(5))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"===typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"===typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,l=[],u=!1,d=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&p())}function p(){if(!u){var e=a(h);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){(function(t){"use strict";var n=r(7),i=r(8),o=r(9),s=r(10),a=r(11),c=r(12);e.exports=function(e,r){var l="function"===typeof Symbol&&Symbol.iterator,u="@@iterator";var d="<<anonymous>>",h={array:m("array"),bool:m("boolean"),func:m("function"),number:m("number"),object:m("object"),string:m("string"),symbol:m("symbol"),any:g(n.thatReturnsNull),arrayOf:function(e){return g(function(t,r,n,i,o){if("function"!==typeof e)return new f("Property `"+o+"` of component `"+n+"` has invalid PropType notation inside arrayOf.");var s=t[r];if(!Array.isArray(s)){var c=v(s);return new f("Invalid "+i+" `"+o+"` of type `"+c+"` supplied to `"+n+"`, expected an array.")}for(var l=0;l<s.length;l++){var u=e(s,l,n,i,o+"["+l+"]",a);if(u instanceof Error)return u}return null})},element:function(){return g(function(t,r,n,i,o){var s=t[r];if(!e(s)){var a=v(s);return new f("Invalid "+i+" `"+o+"` of type `"+a+"` supplied to `"+n+"`, expected a single ReactElement.")}return null})}(),instanceOf:function(e){return g(function(t,r,n,i,o){if(!(t[r]instanceof e)){var s=e.name||d,a=function(e){if(!e.constructor||!e.constructor.name)return d;return e.constructor.name}(t[r]);return new f("Invalid "+i+" `"+o+"` of type `"+a+"` supplied to `"+n+"`, expected instance of `"+s+"`.")}return null})},node:function(){return g(function(e,t,r,n,i){if(!y(e[t]))return new f("Invalid "+n+" `"+i+"` supplied to `"+r+"`, expected a ReactNode.");return null})}(),objectOf:function(e){return g(function(t,r,n,i,o){if("function"!==typeof e)return new f("Property `"+o+"` of component `"+n+"` has invalid PropType notation inside objectOf.");var s=t[r],c=v(s);if("object"!==c)return new f("Invalid "+i+" `"+o+"` of type `"+c+"` supplied to `"+n+"`, expected an object.");for(var l in s)if(s.hasOwnProperty(l)){var u=e(s,l,n,i,o+"."+l,a);if(u instanceof Error)return u}return null})},oneOf:function(e){if(!Array.isArray(e))return"production"!==t.env.NODE_ENV&&o(!1,"Invalid argument supplied to oneOf, expected an instance of array."),n.thatReturnsNull;return g(function(t,r,n,i,o){for(var s=t[r],a=0;a<e.length;a++)if(p(s,e[a]))return null;var c=JSON.stringify(e);return new f("Invalid "+i+" `"+o+"` of value `"+s+"` supplied to `"+n+"`, expected one of "+c+".")})},oneOfType:function(e){if(!Array.isArray(e))return"production"!==t.env.NODE_ENV&&o(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),n.thatReturnsNull;for(var r=0;r<e.length;r++){var i=e[r];if("function"!==typeof i)return o(!1,"Invalid argument supplied to oneOfType. Expected an array of check functions, but received %s at index %s.",w(i),r),n.thatReturnsNull}return g(function(t,r,n,i,o){for(var s=0;s<e.length;s++){var c=e[s];if(null==c(t,r,n,i,o,a))return null}return new f("Invalid "+i+" `"+o+"` supplied to `"+n+"`.")})},shape:function(e){return g(function(t,r,n,i,o){var s=t[r],c=v(s);if("object"!==c)return new f("Invalid "+i+" `"+o+"` of type `"+c+"` supplied to `"+n+"`, expected `object`.");for(var l in e){var u=e[l];if(u){var d=u(s,l,n,i,o+"."+l,a);if(d)return d}}return null})},exact:function(e){return g(function(t,r,n,i,o){var c=t[r],l=v(c);if("object"!==l)return new f("Invalid "+i+" `"+o+"` of type `"+l+"` supplied to `"+n+"`, expected `object`.");var u=s({},t[r],e);for(var d in u){var h=e[d];if(!h)return new f("Invalid "+i+" `"+o+"` key `"+d+"` supplied to `"+n+"`.\nBad object: "+JSON.stringify(t[r],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var p=h(c,d,n,i,o+"."+d,a);if(p)return p}return null})}};function p(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function f(e){this.message=e,this.stack=""}function g(e){if("production"!==t.env.NODE_ENV)var n={},s=0;function c(c,l,u,h,p,g,m){if(h=h||d,g=g||u,m!==a)if(r)i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("production"!==t.env.NODE_ENV&&"undefined"!==typeof console){var y=h+":"+u;!n[y]&&s<3&&(o(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",g,h),n[y]=!0,s++)}return null==l[u]?c?null===l[u]?new f("The "+p+" `"+g+"` is marked as required in `"+h+"`, but its value is `null`."):new f("The "+p+" `"+g+"` is marked as required in `"+h+"`, but its value is `undefined`."):null:e(l,u,h,p,g)}var l=c.bind(null,!1);return l.isRequired=c.bind(null,!0),l}function m(e){return g(function(t,r,n,i,o,s){var a=t[r];return v(a)!==e?new f("Invalid "+i+" `"+o+"` of type `"+_(a)+"` supplied to `"+n+"`, expected `"+e+"`."):null})}function y(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(y);if(null===t||e(t))return!0;var r=function(e){var t=e&&(l&&e[l]||e[u]);if("function"===typeof t)return t}(t);if(!r)return!1;var n,i=r.call(t);if(r!==t.entries){for(;!(n=i.next()).done;)if(!y(n.value))return!1}else for(;!(n=i.next()).done;){var o=n.value;if(o&&!y(o[1]))return!1}return!0;default:return!1}}function v(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||"Symbol"===t["@@toStringTag"]||"function"===typeof Symbol&&t instanceof Symbol}(t,e)?"symbol":t}function _(e){if("undefined"===typeof e||null===e)return""+e;var t=v(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function w(e){var t=_(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return f.prototype=Error.prototype,h.checkPropTypes=c,h.PropTypes=h,h}}).call(t,r(5))},function(e,t){"use strict";function r(e){return function(){return e}}var n=function(){};n.thatReturns=r,n.thatReturnsFalse=r(!1),n.thatReturnsTrue=r(!0),n.thatReturnsNull=r(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(e){return e},e.exports=n},function(e,t,r){(function(t){"use strict";var r=function(e){};"production"!==t.env.NODE_ENV&&(r=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),e.exports=function(e,t,n,i,o,s,a,c){if(r(t),!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,i,o,s,a,c],d=0;(l=new Error(t.replace(/%s/g,function(){return u[d++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}}}).call(t,r(5))},function(e,t,r){(function(t){"use strict";var n=r(7);if("production"!==t.env.NODE_ENV){n=function(e,t){if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==t.indexOf("Failed Composite propType: ")&&!e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];(function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=0,o="Warning: "+e.replace(/%s/g,function(){return r[i++]});"undefined"!==typeof console&&console.error(o);try{throw new Error(o)}catch(e){}}).apply(void 0,[t].concat(n))}}}e.exports=n}).call(t,r(5))},function(e,t){"use strict";var r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var o,s,a=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),c=1;c<arguments.length;c++){for(var l in o=Object(arguments[c]))n.call(o,l)&&(a[l]=o[l]);if(r){s=r(o);for(var u=0;u<s.length;u++)i.call(o,s[u])&&(a[s[u]]=o[s[u]])}}return a}},function(e,t){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,r){(function(t){"use strict";if("production"!==t.env.NODE_ENV)var n=r(8),i=r(9),o=r(11),s={};e.exports=function(e,r,a,c,l){if("production"!==t.env.NODE_ENV)for(var u in e)if(e.hasOwnProperty(u)){var d;try{n("function"===typeof e[u],"%s: %s type `%s` is invalid; it must be a function, usually from the `prop-types` package, but received `%s`.",c||"React class",a,u,typeof e[u]),d=e[u](r,u,c,a,null,o)}catch(e){d=e}if(i(!d||d instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",c||"React class",a,u,typeof d),d instanceof Error&&!(d.message in s)){s[d.message]=!0;var h=l?l():"";i(!1,"Failed %s type: %s%s",a,d.message,null!=h?h:"")}}}}).call(t,r(5))},function(e,t,r){"use strict";var n=r(7),i=r(8),o=r(11);e.exports=function(){function e(e,t,r,n,s,a){a!==o&&i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return r.checkPropTypes=n,r.PropTypes=r,r}},function(e,t){e.exports=r(1)},function(e,t){"use strict";var r=function(e,t){return e===t};e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,n=void 0,i=[],o=void 0,s=!1,a=function(e,r){return t(e,i[r])};return function(){for(var t=arguments.length,r=Array(t),c=0;c<t;c++)r[c]=arguments[c];return s&&n===this&&r.length===i.length&&r.every(a)?o:(s=!0,n=this,i=r,o=e.apply(this,r))}}}])},function(e,t,r){},function(e,t,r){(function(t,n){var i;i=function(e){"use strict";var r="undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:{};function i(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function o(e,t){return e(t={exports:{}},t.exports),t.exports}for(var s=o(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}}),a=[],c=0;c<256;++c)a[c]=(c+256).toString(16).substr(1);var l=function(e,t){var r=t||0,n=a;return n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]};var u=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||s)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[n+o]=i[o];return t||l(i)};function d(t,r,n,i,o){return i.state(t)!==r&&(i._tree.batch(),i._tree.config.nodes.resetStateOnRestore&&"restored"===n&&function(t){e.each(t._tree.defaultState,function(e,r){t.state(r,e)})}(i),r&&"checked"===t&&i.state("indeterminate",!1),i.state(t,r),i._tree.emit("node."+n,i,!1),o&&i.hasChildren()&&i.children.recurseDown(function(e){d(t,r,n,e)}),i.markDirty(),i._tree.end()),i}var h=o(function(e,t){e.exports=function(){function e(e){return"function"===typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,s=void 0,a=void 0,c=function(e,t){g[o]=e,g[o+1]=t,2===(o+=2)&&(a?a(m):S())},l="undefined"!==typeof window?window:void 0,u=l||{},d=u.MutationObserver||u.WebKitMutationObserver,h="undefined"===typeof self&&"undefined"!==typeof n&&"[object process]"==={}.toString.call(n),p="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(m,1)}}var g=new Array(1e3);function m(){for(var e=0;e<o;e+=2){var t=g[e],r=g[e+1];t(r),g[e]=void 0,g[e+1]=void 0}o=0}var y,v,_,w,S=void 0;function b(e,t){var r=this,n=new this.constructor(C);void 0===n[P]&&j(n);var i=r._state;if(i){var o=arguments[i-1];c(function(){return U(i,n,o,r._result)})}else N(r,n,e,t);return n}function x(e){if(e&&"object"===typeof e&&e.constructor===this)return e;var t=new this(C);return O(t,e),t}h?S=function(){return n.nextTick(m)}:d?(v=0,_=new d(m),w=document.createTextNode(""),_.observe(w,{characterData:!0}),S=function(){w.data=v=++v%2}):p?((y=new MessageChannel).port1.onmessage=m,S=function(){return y.port2.postMessage(0)}):S=void 0===l?function(){try{var e=i,t=e("vertx");return"undefined"!==typeof(s=t.runOnLoop||t.runOnContext)?function(){s(m)}:f()}catch(e){return f()}}():f();var P=Math.random().toString(36).substring(16);function C(){}var T=void 0,M=1,E=2,I=new B;function A(e){try{return e.then}catch(e){return I.error=e,I}}function R(t,r,n){r.constructor===t.constructor&&n===b&&r.constructor.resolve===x?function(e,t){t._state===M?k(e,t._result):t._state===E?F(e,t._result):N(t,void 0,function(t){return O(e,t)},function(t){return F(e,t)})}(t,r):n===I?(F(t,I.error),I.error=null):void 0===n?k(t,r):e(n)?function(e,t,r){c(function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,function(r){n||(n=!0,t!==r?O(e,r):k(e,r))},function(t){n||(n=!0,F(e,t))},e._label);!n&&i&&(n=!0,F(e,i))},e)}(t,r,n):k(t,r)}function O(e,t){var r,n;e===t?F(e,new TypeError("You cannot resolve a promise with itself")):(n=typeof(r=t),null===r||"object"!==n&&"function"!==n?k(e,t):R(e,t,A(t)))}function D(e){e._onerror&&e._onerror(e._result),L(e)}function k(e,t){e._state===T&&(e._result=t,e._state=M,0!==e._subscribers.length&&c(L,e))}function F(e,t){e._state===T&&(e._state=E,e._result=t,c(D,e))}function N(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+M]=r,i[o+E]=n,0===o&&e._state&&c(L,e)}function L(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,s=0;s<t.length;s+=3)n=t[s],i=t[s+r],n?U(r,n,i,o):i(o);e._subscribers.length=0}}function B(){this.error=null}var V=new B;function U(t,r,n,i){var o=e(n),s=void 0,a=void 0,c=void 0,l=void 0;if(o){if((s=function(e,t){try{return e(t)}catch(e){return V.error=e,V}}(n,i))===V?(l=!0,a=s.error,s.error=null):c=!0,r===s)return void F(r,new TypeError("A promises callback cannot return that same promise."))}else s=i,c=!0;r._state!==T||(o&&c?O(r,s):l?F(r,a):t===M?k(r,s):t===E&&F(r,s))}var z=0;function j(e){e[P]=z++,e._state=void 0,e._result=void 0,e._subscribers=[]}var G=function(){function e(e,r){this._instanceConstructor=e,this.promise=new e(C),this.promise[P]||j(this.promise),t(r)?(this.length=r.length,this._remaining=r.length,this._result=new Array(this.length),0===this.length?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(r),0===this._remaining&&k(this.promise,this._result))):F(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===T&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===x){var i=A(e);if(i===b&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!==typeof i)this._remaining--,this._result[t]=e;else if(r===H){var o=new r(C);R(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===T&&(this._remaining--,e===E?F(n,r):this._result[t]=r),0===this._remaining&&k(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;N(e,void 0,function(e){return r._settledAt(M,t,e)},function(e){return r._settledAt(E,t,e)})},e}(),H=function(){function e(t){this[P]=z++,this._result=this._state=void 0,this._subscribers=[],C!==t&&("function"!==typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){O(e,t)},function(t){F(e,t)})}catch(t){F(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this.constructor;return this.then(function(r){return t.resolve(e()).then(function(){return r})},function(r){return t.resolve(e()).then(function(){throw r})})},e}();return H.prototype.then=b,H.all=function(e){return new G(this,e).promise},H.race=function(e){var r=this;return t(e)?new r(function(t,n){for(var i=e.length,o=0;o<i;o++)r.resolve(e[o]).then(t,n)}):new r(function(e,t){return t(new TypeError("You must pass an array to race."))})},H.resolve=x,H.reject=function(e){var t=new this(C);return F(t,e),t},H._setScheduler=function(e){a=e},H._setAsap=function(e){c=e},H._asap=c,H.polyfill=function(){var e=void 0;if("undefined"!==typeof r)e=r;else if("undefined"!==typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=H},H.Promise=H,H}()}).Promise,p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),g=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t};function y(e,t){if(t)return this.extract(e);var r=_(e);return this.flatten(function(t){return("removed"===e||!t.removed())&&r(t)})}function v(t,r,n,i){return r=e.castArray(r),t._tree.batch(),t[i?"recurseDown":"each"](function(t){e.each(r,function(r){e.isFunction(t[r])&&t[r].apply(t,n)})}),t._tree.end(),t}function _(t){var r=t;return e.isString(t)&&(r=function(r){return e.isFunction(r[t])?r[t]():r[t]}),r}var w=function(t){function r(t,n){p(this,r);var i=m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));if(e.isFunction(e.get(t,"isTree"))&&!t.isTree(t))throw new TypeError("Invalid tree instance.");return i._tree=t,i.length=0,i._pagination={limit:t.config.pagination.limit,total:0},(e.isArray(n)||n instanceof r)&&e.each(n,function(e){e instanceof P?i.push(e.clone()):i.addNode(e)}),i}return g(r,t),f(r,[{key:"addNode",value:function(t){var r=this.length;return this._tree.config.sort&&(r=e.sortedIndexBy(this,t,this._tree.config.sort)),this.insertAt(r,t)}},{key:"available",value:function(e){return y.call(this,"available",e)}},{key:"blur",value:function(){return this.invoke("blur")}},{key:"blurDeep",value:function(){return this.invokeDeep("blur")}},{key:"checked",value:function(e){return y.call(this,"checked",e)}},{key:"clean",value:function(){return this.invoke("clean")}},{key:"clone",value:function(){return new r(this._tree,this)}},{key:"collapse",value:function(){return this.invoke("collapse")}},{key:"collapsed",value:function(e){return y.call(this,"collapsed",e)}},{key:"collapseDeep",value:function(){return this.invokeDeep("collapse")}},{key:"concat",value:function(t){var n=new r(this._tree);n._context=this._context;var i=function(e){e instanceof P&&n.push(e)};return e.each(this,i),e.each(t,i),n._pagination.limit=this._pagination.limit,n}},{key:"context",value:function(){return this._context||this._tree}},{key:"copy",value:function(t,n){var i=new r(this._tree);return e.each(this,function(e){i.push(e.copy(t,n))}),i}},{key:"deepest",value:function(){var e=new r(this._tree);return this.recurseDown(function(t){t.children||e.push(t)}),e}},{key:"deselect",value:function(){return this.invoke("deselect")}},{key:"deselectDeep",value:function(){return this.invokeDeep("deselect")}},{key:"each",value:function(t){return e.each(this,t),this}},{key:"editable",value:function(e){return y.call(this,"editable",e)}},{key:"editing",value:function(e){return y.call(this,"editing",e)}},{key:"expand",value:function(){return this.invoke("expand")}},{key:"expanded",value:function(e){return y.call(this,"expanded",e)}},{key:"expandDeep",value:function(){var e=this;return new h(function(t){var r=0,n=function(){0===--r&&t(e)};e.recurseDown(function(e){r++,e.children?e.expand().catch(n).then(function(){e.children.expandDeep().catch(n).then(n)}):n()})})}},{key:"expandParents",value:function(){return this.invoke("expandParents")}},{key:"extract",value:function(t){var n=this.flatten(t),i=new r(this._tree);return e.each(n,function(e){return i.addNode(e.copyHierarchy())}),i}},{key:"filterBy",value:function(t){var n=_(t),i=new r(this._tree);return e.each(this,function(e){n(e)&&i.push(e)}),i}},{key:"find",value:function(e){var t=void 0;return this.recurseDown(function(r){if(e(r))return t=r,!1}),t}},{key:"flatten",value:function(e){var t=new r(this._tree),n=_(e);return this.recurseDown(function(e){n(e)&&t.push(e)}),t}},{key:"focused",value:function(e){return y.call(this,"focused",e)}},{key:"forEach",value:function(e){return this.each(e)}},{key:"get",value:function(e){return this[e]}},{key:"hidden",value:function(e){return y.call(this,"hidden",e)}},{key:"hide",value:function(){return this.invoke("hide")}},{key:"hideDeep",value:function(){return this.invokeDeep("hide")}},{key:"indeterminate",value:function(e){return y.call(this,"indeterminate",e)}},{key:"insertAt",value:function(t,n){if(n.id){var i=this.node(n.id);if(i)return i.restore().show(),e.isArrayLike(n.children)?(e.isArrayLike(i.children)||(i.children=new r(this._tree),i.children._context=i),e.each(n.children,function(e){i.children.addNode(e)})):n.children&&e.isBoolean(i.children)&&(i.children=n.children),i.markDirty(),this._tree.applyChanges(),i}var o=this._tree.constructor.isTreeNode(n)?n:C(this._tree,n);return this.splice(t,0,o),this._context&&(o.itree.parent=this._context,this._context.refreshIndeterminateState().markDirty()),this._tree.emit("node.added",o),o.markDirty(),this.length-1!==t&&this.invoke("markDirty"),this._tree.applyChanges(),o}},{key:"invoke",value:function(e,t){return v(this,e,t)}},{key:"invokeDeep",value:function(t,r){return(!e.isArrayLikeObject(r)||arguments.length>2)&&(r=e.tail(arguments)),v(this,t,r,!0)}},{key:"loading",value:function(e){return y.call(this,"loading",e)}},{key:"loadMore",value:function(t){var r=this;if(this._loading)return h.reject(new Error("Pending loadMore call must complete before being invoked again."));var n=void 0;return this._pagination.limit===this._pagination.total?h.resolve():(this._loading=!0,this._tree.batch(),e.invoke(this._context,"markDirty"),this._pagination.limit+=this._tree.config.pagination.limit,this._tree.emit("node.paginated",this._context||this._tree,this.pagination,t),this._tree.config.deferredLoading?n=this._context?this._context.loadChildren():this._tree.load(this._tree.config.data):(this._loading=!1,n=h.resolve()),this._tree.end(),this._tree.config.deferredLoading&&n.then(function(){r._loading=!1,r._tree.applyChanges()}).catch(function(){r._loading=!1,r._tree.applyChanges()}),n)}},{key:"matched",value:function(e){return y.call(this,"matched",e)}},{key:"move",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._tree.batch();var n=this[e].remove(),i=r.insertAt(t,n);return this._tree.emit("node.moved",i,this,e,r,t),this._tree.end(),i}},{key:"node",value:function(e){var t=void 0;return this.recurseDown(function(r){if(r.id===e)return t=r,!1}),t}},{key:"nodes",value:function(t){var n=void 0;return e.isArray(t)&&(n=new r(this._tree),this.recurseDown(function(e){t.indexOf(e.id)>-1&&n.push(e)})),e.isArray(t)?n:this}},{key:"pagination",value:function(){return this._pagination}},{key:"recurseDown",value:function(e){return S(this,e),this}},{key:"remove",value:function(t){return e.remove(this,{id:t.id}),e.invoke(this._context,"markDirty"),this._tree.applyChanges(),this}},{key:"removed",value:function(e){return y.call(this,"removed",e)}},{key:"restore",value:function(){return this.invoke("restore")}},{key:"restoreDeep",value:function(){return this.invokeDeep("restore")}},{key:"select",value:function(){return this.invoke("select")}},{key:"selectable",value:function(e){return y.call(this,"selectable",e)}},{key:"selectDeep",value:function(){return this.invokeDeep("select")}},{key:"selected",value:function(e){return y.call(this,"selected",e)}},{key:"show",value:function(){return this.invoke("show")}},{key:"showDeep",value:function(){return this.invokeDeep("show")}},{key:"softRemove",value:function(){return this.invoke("softRemove")}},{key:"sortBy",value:function(t){var r=this;if(t=t||this._tree.config.sort){var n=e.sortBy(this,t);this.length=0,e.each(n,function(e){r.push(e)})}return this}},{key:"sortDeep",value:function(e){return this.sort(e),this.each(function(t){t.hasChildren()&&t.children.sortDeep(e)}),this}},{key:"state",value:function(){return this.invoke("state",arguments)}},{key:"stateDeep",value:function(){return this.invokeDeep("state",arguments)}},{key:"swap",value:function(e,t){this._tree.batch();var r=e.context(),n=t.context(),i=r.indexOf(e),o=n.indexOf(t);return r===n?(this[i]=t,this[o]=e,this._tree.emit("node.moved",e,r,i,n,o),this._tree.emit("node.moved",t,n,o,r,i)):(r.move(i,n.indexOf(t),n),n.move(n.indexOf(t),i,r)),this._tree.end(),this._tree.emit("node.swapped",e,r,i,t,n,o),this}},{key:"tree",value:function(){return this._tree}},{key:"toArray",value:function(){var t=[];return e.each(this,function(e){t.push(e.toObject())}),t}},{key:"visible",value:function(e){return y.call(this,"visible",e)}}]),r}(function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));function S(t,r){var n=void 0;return t instanceof w?e.each(t,function(e){return n=S(e,r)}):t instanceof P&&!1!==(n=r(t))&&t.hasChildren()&&(n=S(t.children,r)),n}function b(t){return new h(function(r,n){if(!e.isObject(t))return n(new Error("Invalid Promise"));e.isFunction(t.then)&&t.then(r),e.isFunction(t.error)?t.error(n):e.isFunction(t.catch)&&t.catch(n)})}function x(e,t,r){var n=e.itree.state[t];return"undefined"!==typeof r&&n!==r&&(e.itree.state[t]=r,"rendered"!==t&&e.markDirty(),e._tree.emit("node.state.changed",e,t,n,r)),n}var P=function(){function t(r,n,i){var o=this;p(this,t),this._tree=r,n instanceof t&&((i=e.castArray(i)).push("_tree"),e.each(n,function(t,r){e.includes(i,r)||(e.isObject(t)?o[r]=t instanceof w?t.clone():"itree"===r?function(t,r){var n={};return(r=e.castArray(r)).push("ref"),e.each(t,function(t,i){e.includes(r,i)||(n[i]=e.cloneDeep(t))}),n}(t):e.cloneDeep(t):o[r]=t)}))}return f(t,[{key:"addChild",value:function(t){return!e.isArray(this.children)&&e.isArrayLike(this.children)||(this.children=new w(this._tree),this.children._context=this),this.children.addNode(t)}},{key:"addChildren",value:function(t){var r=this,n=new w(this._tree);return this._tree.batch(),e.each(t,function(e){n.push(r.addChild(e))}),this._tree.end(),n}},{key:"allowDynamicLoad",value:function(){return this._tree.isDynamic&&(e.isArrayLike(this.children)||!0===this.children)}},{key:"assign",value:function(){return e.assign.apply(e,[this].concat(Array.prototype.slice.call(arguments))),this.markDirty(),this._tree.applyChanges(),this}},{key:"available",value:function(){return!this.hidden()&&!this.removed()}},{key:"blur",value:function(){return this.state("editing",!1),d("focused",!1,"blurred",this)}},{key:"check",value:function(e){return this._tree.batch(),d("checked",!0,"checked",this,!e&&this._tree.config.checkbox.autoCheckChildren),this.hasParent()&&this.getParent().refreshIndeterminateState(),this._tree.end(),this}},{key:"checked",value:function(){return this.state("checked")}},{key:"clean",value:function(){return this.recurseUp(function(e){if(e.hasParent()){var t=e.getParent();t.hasVisibleChildren()||t.hide()}}),this}},{key:"clone",value:function(e){return new t(this._tree,this,e)}},{key:"collapse",value:function(){return d("collapsed",!0,"collapsed",this)}},{key:"collapsed",value:function(){return this.state("collapsed")}},{key:"context",value:function(){return this.hasParent()?this.getParent().children:this._tree.model}},{key:"copy",value:function(t,r){if(!t||!e.isFunction(t.addNode))throw new Error("Destination must be an Inspire Tree instance.");var n=this;return r&&(n=n.copyHierarchy()),t.addNode(n.toObject())}},{key:"copyHierarchy",value:function(t){var r=[],n=this.getParents();if(e.each(n,function(e){r.push(e.toObject(t))}),n=r.reverse(),!t){var i=this.toObject(!0);this.hasChildren()&&(i.children=this.children.filterBy(function(e){return!e.state("hidden")}).toArray(),i.children._context=i),r.push(i)}var o=r[0],s=o,a=r.length;return e.each(r,function(e,t){var n=[];t+1<a&&(n.push(r[t+1]),s.children=n,s=s.children[0])}),C(this._tree,o)}},{key:"deselect",value:function(e){this.selected()&&(!this._tree.config.selection.require||this._tree.selected().length>1)&&(this._tree.batch(),d("selected",!1,"deselected",this,!e&&this._tree.config.selection.autoSelectChildren),this._tree.end());return this}},{key:"editable",value:function(){return this._tree.config.editable&&this._tree.config.editing.edit&&this.state("editable")}},{key:"editing",value:function(){return this.state("editing")}},{key:"expand",value:function(){var e=this;return new h(function(t,r){(e.hasChildren()||e._tree.isDynamic&&!0===e.children)&&(e.collapsed()||e.hidden())?(e.state("collapsed",!1),e.state("hidden",!1),e._tree.emit("node.expanded",e),e._tree.isDynamic&&!0===e.children?e.loadChildren().then(t).catch(r):(e._tree.applyChanges(),t(e))):t(e)})}},{key:"expanded",value:function(){return!this.collapsed()}},{key:"expandParents",value:function(){return this.hasParent()&&this.getParent().recurseUp(function(e){e.expand()}),this}},{key:"focus",value:function(){return this.focused()||(this._tree.batch(),this._tree.blurDeep(),this.state("focused",!0),this._tree.emit("node.focused",this),this.markDirty(),this._tree.end()),this}},{key:"focused",value:function(){return this.state("focused")}},{key:"getChildren",value:function(){return this.hasChildren()?this.children:new w(this._tree)}},{key:"getParent",value:function(){return this.itree.parent}},{key:"getParents",value:function(){var e=new w(this._tree);return this.hasParent()&&this.getParent().recurseUp(function(t){e.push(t)}),e}},{key:"getTextualHierarchy",value:function(){var e=[];return this.recurseUp(function(t){e.unshift(t.text)}),e}},{key:"hasAncestor",value:function(e){var t=!1;return this.recurseUp(function(r){return!(t=r.id===e.id)}),t}},{key:"hasChildren",value:function(){return e.isArrayLike(this.children)&&this.children.length>0}},{key:"hasLoadedChildren",value:function(){return e.isArrayLike(this.children)}},{key:"hasOrWillHaveChildren",value:function(){return e.isArrayLike(this.children)?Boolean(this.children.length):this.allowDynamicLoad()}},{key:"hasParent",value:function(){return Boolean(this.itree.parent)}},{key:"hasVisibleChildren",value:function(){var e=!1;return this.hasChildren()&&(e=this.children.filterBy("available").length>0),e}},{key:"hide",value:function(){var e=d("hidden",!0,"hidden",this);return e.hasChildren()&&e.children.hide(),e}},{key:"hidden",value:function(){return this.state("hidden")}},{key:"indexPath",value:function(){var t=[];return this.recurseUp(function(r){t.push(e.indexOf(r.context(),r))}),t.reverse().join(".")}},{key:"indeterminate",value:function(){return this.state("indeterminate")}},{key:"lastDeepestVisibleChild",value:function(){var t=void 0;if(this.hasChildren()&&!this.collapsed()){var r=(t=e.findLast(this.children,function(e){return e.visible()})).lastDeepestVisibleChild();r&&(t=r)}return t}},{key:"loadChildren",value:function(){var t=this;return new h(function(r,n){if(!t.allowDynamicLoad())return n(new Error("Node does not have or support dynamic children."));t.state("loading",!0),t.markDirty(),t._tree.applyChanges();var i=function(i,o){if(!e.isArrayLike(i))return n(new TypeError("Loader requires an array-like `nodes` parameter."));t._tree.batch(),t.state("loading",!1);var s=T(t._tree,i,t);e.isArrayLike(t.children)?t.children=t.children.concat(s):t.children=s,e.parseInt(o)>i.length&&(t.children._pagination.total=e.parseInt(o)),"checkbox"===t._tree.config.selection.mode&&t.selected()&&t.children.select(),t.markDirty(),t._tree.end(),r(t.children),t._tree.emit("children.loaded",t)},o=function(e){t.state("loading",!1),t.children=new w(t._tree),t.children._context=t,t.markDirty(),t._tree.applyChanges(),n(e),t._tree.emit("tree.loaderror",e)},s=t._tree.constructor.isTreeNodes(t.children)?t.children.pagination():null,a=t._tree.config.data(t,i,o,s);e.isObject(a)&&b(a).then(i).catch(o)})}},{key:"loading",value:function(){return this.state("loading")}},{key:"loadMore",value:function(){return this.children&&!0!==this.children?this.children.loadMore():h.reject(new Error("Children have not yet been loaded."))}},{key:"markDirty",value:function(){return this.itree.dirty||(this.itree.dirty=!0,this.hasParent()&&this.getParent().markDirty()),this}},{key:"matched",value:function(){return this.state("matched")}},{key:"nextVisibleAncestralSiblingNode",value:function(){var e=void 0;if(this.hasParent()){var t=this.getParent();(e=t.nextVisibleSiblingNode())||(e=t.nextVisibleAncestralSiblingNode())}return e}},{key:"nextVisibleChildNode",value:function(){var t=void 0;return this.hasChildren()&&(t=e.find(this.children,function(e){return e.visible()})),t}},{key:"nextVisibleNode",value:function(){var e=void 0;return(e=this.nextVisibleChildNode())||(e=this.nextVisibleSiblingNode()),e||(e=this.nextVisibleAncestralSiblingNode()),e}},{key:"nextVisibleSiblingNode",value:function(){var t=this.hasParent()?this.getParent().children:this._tree.nodes(),r=e.findIndex(t,{id:this.id});return e.find(e.slice(t,r+1),function(e){return e.visible()})}},{key:"pagination",value:function(){return e.get(this,"children._pagination")}},{key:"previousVisibleNode",value:function(){var e=void 0;return(e=this.previousVisibleSiblingNode())&&e.hasChildren()&&!e.collapsed()&&(e=e.lastDeepestVisibleChild()),!e&&this.hasParent()&&(e=this.getParent()),e}},{key:"previousVisibleSiblingNode",value:function(){var t=this.hasParent()?this.getParent().children:this._tree.nodes(),r=e.findIndex(t,{id:this.id});return e.findLast(e.slice(t,0,r),function(e){return e.visible()})}},{key:"recurseDown",value:function(e){return S(this,e),this}},{key:"recurseUp",value:function(e){return!1!==e(this)&&this.hasParent()&&this.getParent().recurseUp(e),this}},{key:"refreshIndeterminateState",value:function(){var e=this.indeterminate();if(this.state("indeterminate",!1),this.hasChildren()){var t=this.children.length,r=0,n=0;this.children.each(function(e){e.checked()&&n++,e.indeterminate()&&r++}),n===t?d("checked",!0,"checked",this):d("checked",!1,"unchecked",this),this.checked()||this.state("indeterminate",r>0||t>0&&n>0&&n<t)}return this.hasParent()&&this.getParent().refreshIndeterminateState(),e!==this.state("indeterminate")&&this.markDirty(),this}},{key:"reload",value:function(){var e=this;return new h(function(t,r){if(!e.allowDynamicLoad())return r(new Error("Node or tree does not support dynamic children."));e.children=!0,e.collapse(),e.loadChildren().then(t).catch(r)})}},{key:"remove",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getParent();this.context().remove(this),t&&(t.refreshIndeterminateState(),t.markDirty()),(t?t.pagination():this._tree.pagination()).total--;var r=this.toObject(!1,e);return this._tree.emit("node.removed",r,t),this._tree.applyChanges(),r}},{key:"removed",value:function(){return this.state("removed")}},{key:"rendered",value:function(){return this.state("rendered")}},{key:"restore",value:function(){return d("removed",!1,"restored",this)}},{key:"select",value:function(e){if(!this.selected()&&this.selectable()){if(this._tree.batch(),this._tree.canAutoDeselect()){var t=this._tree.config.selection.require;this._tree.config.selection.require=!1,this._tree.deselectDeep(),this._tree.config.selection.require=t}d("selected",!0,"selected",this,!e&&this._tree.config.selection.autoSelectChildren),this._tree._lastSelectedNode=this,this.markDirty(),this._tree.end()}return this}},{key:"selectable",value:function(){var e=this._tree.config.selection.allow(this);return"boolean"===typeof e?e:this.state("selectable")}},{key:"selected",value:function(){return this.state("selected")}},{key:"set",value:function(e,t){return this[e]=t,this.markDirty(),this._tree.applyChanges(),this}},{key:"show",value:function(){return d("hidden",!1,"shown",this)}},{key:"state",value:function(t,r){var n=this;if(e.isString(t))return x(this,t,r);this._tree.batch();var i={};return e.each(t,function(e,t){i[t]=x(n,t,e)}),this._tree.end(),i}},{key:"states",value:function(t,r){var n=this,i=[];return this._tree.batch(),e.each(t,function(e){i.push(n.state(e,r))}),this._tree.end(),i}},{key:"swap",value:function(e){return this.context().swap(this,e),this}},{key:"softRemove",value:function(){return d("removed",!0,"softremoved",this,"softRemove")}},{key:"toggleCheck",value:function(){return this.checked()?this.uncheck():this.check()}},{key:"toggleCollapse",value:function(){return this.collapsed()?this.expand():this.collapse()}},{key:"toggleEditing",value:function(){return this.state("editing",!this.state("editing")),this.markDirty(),this._tree.applyChanges(),this}},{key:"toggleSelect",value:function(){return this.selected()?this.deselect():this.select()}},{key:"toObject",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i={},o=e.pull(Object.keys(this),"_tree","children","itree");e.each(o,function(e){i[e]=t[e]});var s=i.itree={};return s.a=this.itree.a,s.icon=this.itree.icon,s.li=this.itree.li,n&&(s.state=this.itree.state),!r&&this.hasChildren()&&e.isFunction(this.children.toArray)&&(i.children=this.children.toArray()),i}},{key:"toString",value:function(){return this.text}},{key:"tree",value:function(){return this.context().tree()}},{key:"uncheck",value:function(e){return this._tree.batch(),d("checked",!1,"unchecked",this,!e&&this._tree.config.checkbox.autoCheckChildren),this.state("indeterminate",!1),this.hasParent()&&this.getParent().refreshIndeterminateState(),this._tree.end(),this}},{key:"visible",value:function(){return!(this.hidden()||this.removed()||this._tree.usesNativeDOM&&!this.rendered())&&(!this.hasParent()||!this.getParent().collapsed()&&this.getParent().visible())}}]),t}();function C(t,r,n){r.id=r.id||u(),"string"!==typeof r.id&&"number"!==typeof r.id&&(r.id=r.id.toString());var i=r.itree=r.itree||{};i.icon=i.icon||!1,i.dirty=!1;var o=i.li=i.li||{};o.attributes=o.attributes||{};var s=i.a=i.a||{};s.attributes=s.attributes||{};var a=i.state=i.state||{};return a.collapsed="boolean"===typeof a.collapsed?a.collapsed:t.defaultState.collapsed,a.selectable="boolean"===typeof a.selectable?a.selectable:t.defaultState.selectable,a.draggable="boolean"===typeof a.draggable?a.draggable:t.defaultState.draggable,a["drop-target"]="boolean"===typeof a["drop-target"]?a["drop-target"]:t.defaultState["drop-target"],a.checked="boolean"===typeof a.checked&&a.checked,a.editable="boolean"===typeof a.editable?a.editable:t.defaultState.editable,a.editing="boolean"===typeof a.editing?a.editing:t.defaultState.editing,a.focused=a.focused||t.defaultState.focused,a.hidden=a.hidden||t.defaultState.hidden,a.indeterminate=a.indeterminate||t.defaultState.indeterminate,a.loading=a.loading||t.defaultState.loading,a.removed=a.removed||t.defaultState.removed,a.rendered=a.rendered||t.defaultState.rendered,a.selected=a.selected||t.defaultState.selected,r.itree.parent=n,r=e.assign(new P(t),r),e.isArrayLike(r.children)&&(r.children=T(t,r.children,r)),t.allowsLoadEvents&&e.each(t.config.allowLoadEvents,function(e){a[e]&&t.emit("node."+e,r,!0)}),r}function T(t,r,n){var i=new w(t);return t.config.sort&&(r=e.sortBy(r,t.config.sort)),e.each(r,function(e){i.push(C(t,e,n))}),i._context=n,i}var M=o(function(e,t){!function(t){var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=10;function o(){this._events={},this._conf&&s.call(this,this._conf)}function s(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==t?e.maxListeners:i,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=i}function a(e,t){var r="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(r+=" Event name: "+t+"."),"undefined"!==typeof n&&n.emitWarning){var i=new Error(r);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=e,n.emitWarning(i)}else console.error(r),console.trace&&console.trace()}function c(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,s.call(this,e)}function l(e,t,r,n){if(!r)return[];var i,o,s,a,c,u,d,h=[],p=t.length,f=t[n],g=t[n+1];if(n===p&&r._listeners){if("function"===typeof r._listeners)return e&&e.push(r._listeners),[r];for(i=0,o=r._listeners.length;i<o;i++)e&&e.push(r._listeners[i]);return[r]}if("*"===f||"**"===f||r[f]){if("*"===f){for(s in r)"_listeners"!==s&&r.hasOwnProperty(s)&&(h=h.concat(l(e,t,r[s],n+1)));return h}if("**"===f){for(s in(d=n+1===p||n+2===p&&"*"===g)&&r._listeners&&(h=h.concat(l(e,t,r,p))),r)"_listeners"!==s&&r.hasOwnProperty(s)&&("*"===s||"**"===s?(r[s]._listeners&&!d&&(h=h.concat(l(e,t,r[s],p))),h=h.concat(l(e,t,r[s],n))):h=s===g?h.concat(l(e,t,r[s],n+2)):h.concat(l(e,t,r[s],n)));return h}h=h.concat(l(e,t,r[f],n+1))}if((a=r["*"])&&l(e,t,a,n+1),c=r["**"])if(n<p)for(s in c._listeners&&l(e,t,c,p),c)"_listeners"!==s&&c.hasOwnProperty(s)&&(s===g?l(e,t,c[s],n+2):s===f?l(e,t,c[s],n+1):((u={})[s]=c[s],l(e,t,{"**":u},n+1)));else c._listeners?l(e,t,c,p):c["*"]&&c["*"]._listeners&&l(e,t,c["*"],p);return h}c.EventEmitter2=c,c.prototype.delimiter=".",c.prototype.setMaxListeners=function(e){e!==t&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},c.prototype.event="",c.prototype.once=function(e,t){return this._once(e,t,!1)},c.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},c.prototype._once=function(e,t,r){return this._many(e,1,t,r),this},c.prototype.many=function(e,t,r){return this._many(e,t,r,!1)},c.prototype.prependMany=function(e,t,r){return this._many(e,t,r,!0)},c.prototype._many=function(e,t,r,n){var i=this;if("function"!==typeof r)throw new Error("many only accepts instances of Function");function o(){return 0===--t&&i.off(e,o),r.apply(this,arguments)}return o._origin=r,this._on(e,o,n),i},c.prototype.emit=function(){this._events||o.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,r,n,i,s,a=arguments.length;if(this._all&&this._all.length){if(s=this._all.slice(),a>3)for(t=new Array(a),i=0;i<a;i++)t[i]=arguments[i];for(n=0,r=s.length;n<r;n++)switch(this.event=e,a){case 1:s[n].call(this,e);break;case 2:s[n].call(this,e,arguments[1]);break;case 3:s[n].call(this,e,arguments[1],arguments[2]);break;default:s[n].apply(this,t)}}if(this.wildcard){s=[];var c="string"===typeof e?e.split(this.delimiter):e.slice();l.call(this,s,c,this.listenerTree,0)}else{if("function"===typeof(s=this._events[e])){switch(this.event=e,a){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];s.apply(this,t)}return!0}s&&(s=s.slice())}if(s&&s.length){if(a>3)for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];for(n=0,r=s.length;n<r;n++)switch(this.event=e,a){case 1:s[n].call(this);break;case 2:s[n].call(this,arguments[1]);break;case 3:s[n].call(this,arguments[1],arguments[2]);break;default:s[n].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},c.prototype.emitAsync=function(){this._events||o.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,r,n,i,s,a=[],c=arguments.length;if(this._all){if(c>3)for(t=new Array(c),i=1;i<c;i++)t[i]=arguments[i];for(n=0,r=this._all.length;n<r;n++)switch(this.event=e,c){case 1:a.push(this._all[n].call(this,e));break;case 2:a.push(this._all[n].call(this,e,arguments[1]));break;case 3:a.push(this._all[n].call(this,e,arguments[1],arguments[2]));break;default:a.push(this._all[n].apply(this,t))}}if(this.wildcard){s=[];var u="string"===typeof e?e.split(this.delimiter):e.slice();l.call(this,s,u,this.listenerTree,0)}else s=this._events[e];if("function"===typeof s)switch(this.event=e,c){case 1:a.push(s.call(this));break;case 2:a.push(s.call(this,arguments[1]));break;case 3:a.push(s.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(c-1),i=1;i<c;i++)t[i-1]=arguments[i];a.push(s.apply(this,t))}else if(s&&s.length){if(s=s.slice(),c>3)for(t=new Array(c-1),i=1;i<c;i++)t[i-1]=arguments[i];for(n=0,r=s.length;n<r;n++)switch(this.event=e,c){case 1:a.push(s[n].call(this));break;case 2:a.push(s[n].call(this,arguments[1]));break;case 3:a.push(s[n].call(this,arguments[1],arguments[2]));break;default:a.push(s[n].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(a)},c.prototype.on=function(e,t){return this._on(e,t,!1)},c.prototype.prependListener=function(e,t){return this._on(e,t,!0)},c.prototype.onAny=function(e){return this._onAny(e,!1)},c.prototype.prependAny=function(e){return this._onAny(e,!0)},c.prototype.addListener=c.prototype.on,c.prototype._onAny=function(e,t){if("function"!==typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},c.prototype._on=function(e,r,n){if("function"===typeof e)return this._onAny(e,r),this;if("function"!==typeof r)throw new Error("on only accepts instances of Function");return this._events||o.call(this),this._newListener&&this.emit("newListener",e,r),this.wildcard?(function(e,r){for(var n=0,i=(e="string"===typeof e?e.split(this.delimiter):e.slice()).length;n+1<i;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var o=this.listenerTree,s=e.shift();s!==t;){if(o[s]||(o[s]={}),o=o[s],0===e.length)return o._listeners?("function"===typeof o._listeners&&(o._listeners=[o._listeners]),o._listeners.push(r),!o._listeners.warned&&this._maxListeners>0&&o._listeners.length>this._maxListeners&&(o._listeners.warned=!0,a.call(this,o._listeners.length,s))):o._listeners=r,!0;s=e.shift()}return!0}.call(this,e,r),this):(this._events[e]?("function"===typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(r):this._events[e].push(r),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,a.call(this,this._events[e].length,e))):this._events[e]=r,this)},c.prototype.off=function(e,n){if("function"!==typeof n)throw new Error("removeListener only takes instances of Function");var i,o=[];if(this.wildcard){var s="string"===typeof e?e.split(this.delimiter):e.slice();o=l.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;i=this._events[e],o.push({_listeners:i})}for(var a=0;a<o.length;a++){var c=o[a];if(i=c._listeners,r(i)){for(var u=-1,d=0,h=i.length;d<h;d++)if(i[d]===n||i[d].listener&&i[d].listener===n||i[d]._origin&&i[d]._origin===n){u=d;break}if(u<0)continue;return this.wildcard?c._listeners.splice(u,1):this._events[e].splice(u,1),0===i.length&&(this.wildcard?delete c._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,n),this}(i===n||i.listener&&i.listener===n||i._origin&&i._origin===n)&&(this.wildcard?delete c._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,n))}return function e(r){if(r!==t){var n=Object.keys(r);for(var i in n){var o=n[i],s=r[o];s instanceof Function||"object"!==typeof s||null===s||(Object.keys(s).length>0&&e(r[o]),0===Object.keys(s).length&&delete r[o])}}}(this.listenerTree),this},c.prototype.offAny=function(e){var t,r=0,n=0;if(e&&this._all&&this._all.length>0){for(r=0,n=(t=this._all).length;r<n;r++)if(e===t[r])return t.splice(r,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(r=0,n=t.length;r<n;r++)this.emit("removeListenerAny",t[r]);this._all=[]}return this},c.prototype.removeListener=c.prototype.off,c.prototype.removeAllListeners=function(e){if(e===t)return!this._events||o.call(this),this;if(this.wildcard)for(var r="string"===typeof e?e.split(this.delimiter):e.slice(),n=l.call(this,null,r,this.listenerTree,0),i=0;i<n.length;i++){n[i]._listeners=null}else this._events&&(this._events[e]=null);return this},c.prototype.listeners=function(e){if(this.wildcard){var t=[],n="string"===typeof e?e.split(this.delimiter):e.slice();return l.call(this,t,n,this.listenerTree,0),t}return this._events||o.call(this),this._events[e]||(this._events[e]=[]),r(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},c.prototype.eventNames=function(){return Object.keys(this._events)},c.prototype.listenerCount=function(e){return this.listeners(e).length},c.prototype.listenersAny=function(){return this._all?this._all:[]},"function"===typeof t&&t.amd?t(function(){return c}):e.exports=c}()}).EventEmitter2;function E(e,t,r){return e.model[t].apply(e.model,r)}return function(t){function r(t){p(this,r);var n=m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this)),i=n;i._lastSelectedNode,i._muted=!1,i.allowsLoadEvents=!1,i.batching=0,i.id=u(),i.initialized=!1,i.isDynamic=!1,i.opts=t,i.preventDeselection=!1,i.config=e.defaultsDeep({},t,{allowLoadEvents:[],checkbox:{autoCheckChildren:!0},contextMenu:!1,data:!1,editable:!1,editing:{add:!1,edit:!1,remove:!1},nodes:{resetStateOnRestore:!0},pagination:{limit:-1},search:{matcher:!1,matchProcessor:!1},selection:{allow:e.noop,autoDeselect:!0,autoSelectChildren:!1,disableDirectDeselection:!1,mode:"default",multiple:!1,require:!1},showCheckboxes:!1,sort:!1}),"checkbox"===i.config.selection.mode&&(i.config.selection.autoSelectChildren=!0,i.on("node.checked",function(e){e.selected()||e.select(!0)}),i.on("node.selected",function(e){e.checked()||e.check(!0)}),i.on("node.unchecked",function(e){e.selected()&&e.deselect(!0)}),i.on("node.deselected",function(e){e.checked()&&e.uncheck(!0)})),i.config.selection.autoSelectChildren&&(i.config.selection.multiple=!0,i.config.selection.autoDeselect=!1),t.editable&&!t.editing&&(i.config.editing.add=!0,i.config.editing.edit=!0,i.config.editing.remove=!0),e.isFunction(t.search)&&(i.config.search={matcher:t.search,matchProcessor:!1}),i.defaultState={collapsed:!0,editable:e.get(i,"config.editing.edit"),editing:!1,draggable:!0,"drop-target":!0,focused:!1,hidden:!1,indeterminate:!1,loading:!1,matched:!1,removed:!1,rendered:!1,selectable:!0,selected:!1},i.allowsLoadEvents=e.isArray(i.config.allowLoadEvents)&&i.config.allowLoadEvents.length>0,i.isDynamic=e.isFunction(i.config.data);var o=i.emit;return i.emit=function(t){if(!i.isEventMuted(t)){if(e.isFunction(e.get(arguments,"[1].preventDefault"))){var r=arguments[1];r.treeDefaultPrevented=!1,r.preventTreeDefault=function(){r.treeDefaultPrevented=!0}}o.apply(i,arguments)}},i.model=new w(i),i.config.data&&i.load(i.config.data),i.initialized=!0,n}return g(r,M),f(r,[{key:"addNode",value:function(){return E(this,"addNode",arguments)}},{key:"addNodes",value:function(t){var r=this;this.batch();var n=new w(this);return e.each(t,function(e){return n.push(r.addNode(e))}),this.end(),n}},{key:"applyChanges",value:function(){0===this.batching&&this.emit("changes.applied")}},{key:"available",value:function(){return E(this,"available",arguments)}},{key:"batch",value:function(){this.batching<0&&(this.batching=0),this.batching++}},{key:"blur",value:function(){return E(this,"blur",arguments)}},{key:"blurDeep",value:function(){return E(this,"blurDeep",arguments)}},{key:"boundingNodes",value:function(){var t,r=e.transform(arguments,function(e,t){e[t.indexPath().replace(/\./g,"")]=t},{}),n=e.sortBy(Object.keys(r)),i=(t=n,Array.isArray(t)?t:Array.from(t)),o=i[0],s=i.slice(1);return[e.get(r,o),e.get(r,s)]}},{key:"canAutoDeselect",value:function(){return this.config.selection.autoDeselect&&!this.preventDeselection}},{key:"checked",value:function(){return E(this,"checked",arguments)}},{key:"clean",value:function(){return E(this,"clean",arguments)}},{key:"clearSearch",value:function(){return this.batch(),this.recurseDown(function(e){e.show().collapse().state("matched",!1)}),this.end(),this}},{key:"clone",value:function(){return E(this,"clone",arguments)}},{key:"collapse",value:function(){return E(this,"collapse",arguments)}},{key:"collapsed",value:function(){return E(this,"collapsed",arguments)}},{key:"collapseDeep",value:function(){return E(this,"collapseDeep",arguments)}},{key:"concat",value:function(){return E(this,"concat",arguments)}},{key:"copy",value:function(){return E(this,"copy",arguments)}},{key:"createNode",value:function(e){return r.isTreeNode(e)?e:C(this,e)}},{key:"deepest",value:function(){return E(this,"deepest",arguments)}},{key:"deselect",value:function(){return E(this,"deselect",arguments)}},{key:"deselectDeep",value:function(){return E(this,"deselectDeep",arguments)}},{key:"disableDeselection",value:function(){return this.config.selection.multiple&&(this.preventDeselection=!0),this}},{key:"each",value:function(){return E(this,"each",arguments)}},{key:"every",value:function(){return E(this,"every",arguments)}},{key:"editable",value:function(){return E(this,"editable",arguments)}},{key:"editing",value:function(){return E(this,"editing",arguments)}},{key:"enableDeselection",value:function(){return this.preventDeselection=!1,this}},{key:"end",value:function(){this.batching--,0===this.batching&&this.applyChanges()}},{key:"expand",value:function(){return E(this,"expand",arguments)}},{key:"expandDeep",value:function(){return E(this,"expandDeep",arguments)}},{key:"expanded",value:function(){return E(this,"expanded",arguments)}},{key:"extract",value:function(){return E(this,"extract",arguments)}},{key:"filter",value:function(){return E(this,"filter",arguments)}},{key:"filterBy",value:function(){return E(this,"filterBy",arguments)}},{key:"find",value:function(){return E(this,"find",arguments)}},{key:"flatten",value:function(){return E(this,"flatten",arguments)}},{key:"focused",value:function(){return E(this,"focused",arguments)}},{key:"forEach",value:function(){return E(this,"each",arguments)}},{key:"get",value:function(){return E(this,"get",arguments)}},{key:"hidden",value:function(){return E(this,"hidden",arguments)}},{key:"hide",value:function(){return E(this,"hide",arguments)}},{key:"hideDeep",value:function(){return E(this,"hideDeep",arguments)}},{key:"indeterminate",value:function(){return E(this,"indeterminate",arguments)}},{key:"indexOf",value:function(){return E(this,"indexOf",arguments)}},{key:"insertAt",value:function(){return E(this,"insertAt",arguments)}},{key:"invoke",value:function(){return E(this,"invoke",arguments)}},{key:"invokeDeep",value:function(){return E(this,"invokeDeep",arguments)}},{key:"isEventMuted",value:function(t){return e.isBoolean(this.muted())?this.muted():e.includes(this.muted(),t)}},{key:"isTree",value:function(e){return e instanceof r}},{key:"join",value:function(){return E(this,"join",arguments)}},{key:"lastSelectedNode",value:function(){return this._lastSelectedNode}},{key:"load",value:function(t){var r=this,n=new h(function(n,i){var o=function(t,o){if(!e.isArrayLike(t))return i(new TypeError("Loader requires an array-like `nodes` parameter."));!r.initialized&&e.isArrayLike(t)?setTimeout(function(){r.emit("data.loaded",t)}):r.emit("data.loaded",t);var s=T(r,t);r.config.deferredLoading?r.model=r.model.concat(s):r.model=s,r.model._pagination.total=t.length,e.parseInt(o)>t.length&&(r.model._pagination.total=e.parseInt(o)),o||r.model.recurseDown(function(e){e.hasChildren()&&(e.children._pagination.total=e.children.length)}),r.config.selection.require&&!r.selected().length&&r.selectFirstAvailableNode();var a=function(){r.emit("model.loaded",r.model),n(r.model),r.applyChanges()};!r.initialized&&e.isArray(t)?setTimeout(a):a()};if(e.isArrayLike(t))o(t);else if(e.isFunction(t)){var s=t(null,o,i,r.pagination());s&&(t=s)}e.isObject(t)?b(t).then(o).catch(i):error(new Error("Invalid data loader."))});return n.catch(function(e){r.emit("data.loaderror",e)}),this._loader={promise:n},n}},{key:"loading",value:function(){return E(this,"loading",arguments)}},{key:"loadMore",value:function(){return E(this,"loadMore",arguments)}},{key:"map",value:function(){return E(this,"map",arguments)}},{key:"matched",value:function(){return E(this,"matched",arguments)}},{key:"move",value:function(){return E(this,"move",arguments)}},{key:"mute",value:function(t){return e.isString(t)||e.isArray(t)?this._muted=e.castArray(t):this._muted=!0,this}},{key:"muted",value:function(){return this._muted}},{key:"node",value:function(){return E(this,"node",arguments)}},{key:"nodes",value:function(){return E(this,"nodes",arguments)}},{key:"pagination",value:function(){return E(this,"pagination",arguments)}},{key:"pop",value:function(){return E(this,"pop",arguments)}},{key:"push",value:function(){return E(this,"push",arguments)}},{key:"recurseDown",value:function(){return E(this,"recurseDown",arguments)}},{key:"reduce",value:function(){return E(this,"reduce",arguments)}},{key:"reduceRight",value:function(){return E(this,"reduceRight",arguments)}},{key:"reload",value:function(){return this.removeAll(),this.load(this.opts.data||this.config.data)}},{key:"remove",value:function(){return E(this,"remove",arguments)}},{key:"removeAll",value:function(){return this.model=new w(this),this.applyChanges(),this}},{key:"removed",value:function(){return E(this,"removed",arguments)}},{key:"restore",value:function(){return E(this,"restore",arguments)}},{key:"restoreDeep",value:function(){return E(this,"restoreDeep",arguments)}},{key:"reverse",value:function(){return E(this,"reverse",arguments)}},{key:"search",value:function(t){var n=this,i=this.config.search,o=i.matcher,s=i.matchProcessor;return!t||e.isString(t)&&e.isEmpty(t)?h.resolve(this.clearSearch()):(this.batch(),this.recurseDown(function(e){e.state("hidden",!0),e.state("matched",!1)}),this.end(),o=e.isFunction(o)?o:function(t,r){var i=new w(n);e.isString(t)&&(t=new RegExp(t,"i"));var o=void 0;o=e.isRegExp(t)?function(e){return t.test(e.text)}:t,n.model.recurseDown(function(e){e.removed()||o(e)&&i.push(e)}),r(i)},s=e.isFunction(s)?s:function(e){e.each(function(e){e.show().state("matched",!0),e.expandParents().collapse(),e.hasChildren()&&e.children.showDeep()})},new h(function(i,a){o(t,function(t){r.isTreeNodes(t)||(t=n.nodes(e.map(t,"id"))),n.batch(),s(t),n.end(),i(t)},a)}))}},{key:"select",value:function(){return E(this,"select",arguments)}},{key:"selectable",value:function(){return E(this,"selectable",arguments)}},{key:"selectBetween",value:function(e,t){this.batch();for(var r=e.nextVisibleNode();r.id!==t.id;)r.select(),r=r.nextVisibleNode();return this.end(),this}},{key:"selectDeep",value:function(){return E(this,"selectDeep",arguments)}},{key:"selected",value:function(){return E(this,"selected",arguments)}},{key:"selectFirstAvailableNode",value:function(){var e=this.model.filterBy("available").get(0);return e&&e.select(),e}},{key:"shift",value:function(){return E(this,"shift",arguments)}},{key:"show",value:function(){return E(this,"show",arguments)}},{key:"showDeep",value:function(){return E(this,"showDeep",arguments)}},{key:"slice",value:function(){return E(this,"slice",arguments)}},{key:"softRemove",value:function(){return E(this,"softRemove",arguments)}},{key:"some",value:function(){return E(this,"some",arguments)}},{key:"sort",value:function(){return E(this,"sort",arguments)}},{key:"sortBy",value:function(){return E(this,"sortBy",arguments)}},{key:"sortDeep",value:function(){return E(this,"sortDeep",arguments)}},{key:"splice",value:function(){return E(this,"slice",arguments)}},{key:"state",value:function(){return E(this,"state",arguments)}},{key:"stateDeep",value:function(){return E(this,"stateDeep",arguments)}},{key:"swap",value:function(){return E(this,"swap",arguments)}},{key:"toArray",value:function(){return E(this,"toArray",arguments)}},{key:"toString",value:function(){return E(this,"toString",arguments)}},{key:"unmute",value:function(t){return e.isString(t)||e.isArray(t)?(this._muted=e.difference(this._muted,e.castArray(t)),this._muted.length||(this._muted=!1)):this._muted=!1,this}},{key:"unshift",value:function(){return E(this,"unshift",arguments)}},{key:"visible",value:function(){return E(this,"visible",arguments)}}],[{key:"isTreeNode",value:function(e){return e instanceof P}},{key:"isTreeNodes",value:function(e){return e instanceof w}}]),r}()},e.exports=i(r(197))}).call(this,r(12),r(48))},function(e,t,r){},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(r(1)),s=r(32),a=r(93),c=r(342),l=r(846);function u(e){const t=a.withDropTarget(e);return class WithDragAndDrop extends o.Component{constructor(){super(...arguments),this.renderNode=((e,t)=>{const r=this.props.renderNode?this.props.renderNode(e,t):o.createElement(c.TreeNode,Object.assign({},t)),n=l.DragDropTreeNode();return o.createElement(n,{key:e.id,dragProps:this.createNodeDragProps(e),dropProps:this.createNodeDropProps(e),shallow:!0},r)})}static get displayName(){return`WithDragAndDrop(${s.getDisplayName(e)})`}createTreeDropProps(){if(!this.props.dropProps)return{};const{onDropTargetOver:e,onDropTargetDrop:t,canDropTargetDrop:r,objectTypes:n}=this.props.dropProps;return{onDropTargetOver:t=>{e&&(t.dropLocation=this.props.dataProvider,e(t))},onDropTargetDrop:e=>(e.dropLocation=this.props.dataProvider,t?t(e):e),canDropTargetDrop:e=>(e.dropLocation=this.props.dataProvider,!r||r(e)),objectTypes:n}}createNodeDragProps(e){if(!this.props.dragProps)return{};const t=e.getParent();let r;if(t){const n=t.getChildren();r=n.indexOf(e)}const{onDragSourceBegin:n,onDragSourceEnd:i,objectType:o}=this.props.dragProps;return{onDragSourceBegin:i=>(i.row=r,i.dataObject=e.payload,i.parentObject=t&&t.payload||this.props.dataProvider,n?n(i):i),onDragSourceEnd:e=>{i&&(e.parentObject=t&&t.payload||this.props.dataProvider,i(e))},objectType:()=>o?"function"===typeof o?o(e.payload.extendedData):o:""}}createNodeDropProps(e){if(!this.props.dropProps)return{};const t=e.getParent();let r=0;void 0!==t&&(r=t.getChildren().indexOf(e));const{onDropTargetOver:n,onDropTargetDrop:i,canDropTargetDrop:o,objectTypes:s}=this.props.dropProps;return{onDropTargetOver:i=>{if(i.dropLocation=e.payload,i.dropRect){const e=(i.clientOffset.y-i.dropRect.top)/i.dropRect.height;e<1/3&&e>2/3&&void 0!==r&&(i.dropLocation=t&&t.payload||this.props.dataProvider,i.row=r,e>2/3&&(i.row=r+1))}n&&n(i)},onDropTargetDrop:n=>{if(n.dropLocation=e.payload,n.dropRect){const e=(n.clientOffset.y-n.dropRect.top)/n.dropRect.height;(e<1/3||e>2/3)&&void 0!==r&&(n.dropLocation=t&&t.payload||this.props.dataProvider,n.row=r,e>2/3&&(n.row=r+1))}return i?i(n):n},canDropTargetDrop:t=>(t.dropLocation=e.payload,!o||o(t)),objectTypes:s}}render(){const e=this.props,{dragProps:r,dropProps:i,renderNode:s}=e,a=n(e,["dragProps","dropProps","renderNode"]);return o.createElement(t,Object.assign({},a,{renderNode:this.renderNode,dropStyle:{height:"100%"},dropProps:this.createTreeDropProps(),shallow:!0}))}}}t.withDragDrop=u,t.default=u},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(r(1)),s=r(199),a=r(343);let c;t.withDragSource=(e=>{var t;return s.DragSource(e=>e.dragProps.objectType?"function"===typeof e.dragProps.objectType?e.dragProps.objectType():e.dragProps.objectType:"",{beginDrag(e,t,r){let n=e.defaultDropEffect||a.DropEffects.Move;r.state.ctrlKey?n=e.ctrlDropEffect||a.DropEffects.Copy:r.state.altKey&&(n=e.altDropEffect||a.DropEffects.Link);let i={left:0,top:0};const o=r.rootElement;o&&(i=o.getBoundingClientRect());const s={dataObject:{},dropEffect:n,dropStatus:a.DropStatus.None,dragRect:i,defaultDragLayer:e.dragProps.defaultDragLayer,clientOffset:{x:i.left||0,y:i.top||0},initialClientOffset:{x:i.left||0,y:i.top||0}};return e.dragProps.onDragSourceBegin?e.dragProps.onDragSourceBegin(s):s},endDrag(e,t,r){let n={left:0,top:0};const i=r&&r.rootElement;i&&(n=i.getBoundingClientRect());const o=t.getDropResult()||t.getItem()||{dataObject:{},dropEffect:a.DropEffects.None,dropStatus:a.DropStatus.None,dragRect:n,clientOffset:{x:0,y:0},initialClientOffset:{x:0,y:0},sourceClientOffset:{x:0,y:0},initialSourceClientOffset:{x:0,y:0}},{dataObject:s,dropEffect:c,dropStatus:l,dropRect:u,initialClientOffset:d,initialSourceClientOffset:h,local:p,row:f,col:g}=o,m={dataObject:s,dropEffect:c,dropStatus:l,dropRect:u,dragRect:n,clientOffset:t.getClientOffset()||o.clientOffset,initialClientOffset:d,sourceClientOffset:t.getSourceClientOffset()||o.sourceClientOffset,initialSourceClientOffset:h,local:p,row:f,col:g};e.dragProps.onDragSourceEnd&&e.dragProps.onDragSourceEnd(m)}},(e,t)=>({connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview(),isDragging:t.isDragging(),canDrag:t.canDrag(),item:t.getItem(),type:t.getItemType()}))(((t=class WithDragSource extends o.Component{constructor(){super(...arguments),this.rootElement=null,this.state={ctrlKey:!1,altKey:!1},this.handleKeyChange=(e=>{const{ctrlKey:t,altKey:r}=e;this.state.ctrlKey!==t&&this.setState({ctrlKey:t}),this.state.altKey!==r&&this.setState({altKey:r})})}render(){const t=this.props,{dragProps:r,connectDragSource:i,connectDragPreview:s,isDragging:c,canDrag:l,item:u,type:d,defaultDropEffect:h,ctrlDropEffect:p,altDropEffect:f,dragStyle:g}=t,m=n(t,["dragProps","connectDragSource","connectDragPreview","isDragging","canDrag","item","type","defaultDropEffect","ctrlDropEffect","altDropEffect","dragStyle"]),y={item:u,type:d,isDragging:c,canDrag:l},v={[a.DropEffects.Move]:"move",[a.DropEffects.Copy]:"copy",[a.DropEffects.Link]:"link"},_=v[h],w=v[p],S=v[f],b=this.state.ctrlKey?w||"copy":this.state.altKey?S||"link":_||"move";return i(o.createElement("div",{className:"drag-source-wrapper",ref:e=>{this.rootElement=e},style:this.props.dragStyle},o.createElement(e,Object.assign({},m,y))),{dropEffect:b})}componentDidMount(){this.props.connectDragPreview&&this.props.connectDragPreview((c||((c=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),c),{captureDraggingState:!0}),window.addEventListener("keydown",this.handleKeyChange),window.addEventListener("keyup",this.handleKeyChange)}componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyChange),window.removeEventListener("keyup",this.handleKeyChange)}}).defaultProps={defaultDropEffect:a.DropEffects.Move,ctrlDropEffect:a.DropEffects.Copy,altDropEffect:a.DropEffects.Link},t))})},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(344)),n(r(729))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(730);t.createDragDropManager=function(e,t){return new n.default(e,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(731),i=r(733),o=r(150),s=r(798),a=r(800),c=function(){function e(e,t){void 0===t&&(t={}),this.context=t,this.isSetUp=!1;var r=n.createStore(i.default);this.store=r,this.monitor=new s.default(r,new a.default(r)),this.backend=e(this),r.subscribe(this.handleRefCountChange.bind(this))}return e.prototype.getContext=function(){return this.context},e.prototype.getMonitor=function(){return this.monitor},e.prototype.getBackend=function(){return this.backend},e.prototype.getRegistry=function(){return this.monitor.registry},e.prototype.getActions=function(){var e=this,t=this.store.dispatch;var r=o.default(this);return Object.keys(r).reduce(function(n,i){var o,s=r[i];return n[i]=(o=s,function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=o.apply(e,r);"undefined"!==typeof i&&t(i)}),n},{})},e.prototype.dispatch=function(e){this.store.dispatch(e)},e.prototype.handleRefCountChange=function(){var e=this.store.getState().refCount>0;e&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!e&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1)},e}();t.default=c},function(e,t,r){"use strict";r.r(t),r.d(t,"createStore",function(){return c}),r.d(t,"combineReducers",function(){return u}),r.d(t,"bindActionCreators",function(){return h}),r.d(t,"applyMiddleware",function(){return f}),r.d(t,"compose",function(){return p}),r.d(t,"__DO_NOT_USE__ActionTypes",function(){return i});var n=r(217),i={INIT:"@@redux/INIT"+Math.random().toString(36).substring(7).split("").join("."),REPLACE:"@@redux/REPLACE"+Math.random().toString(36).substring(7).split("").join(".")},o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function a(e){if("object"!==("undefined"===typeof e?"undefined":o(e))||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function c(e,t,r){var s;if("function"===typeof t&&"undefined"===typeof r&&(r=t,t=void 0),"undefined"!==typeof r){if("function"!==typeof r)throw new Error("Expected the enhancer to be a function.");return r(c)(e,t)}if("function"!==typeof e)throw new Error("Expected the reducer to be a function.");var l=e,u=t,d=[],h=d,p=!1;function f(){h===d&&(h=d.slice())}function g(){if(p)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return u}function m(e){if("function"!==typeof e)throw new Error("Expected the listener to be a function.");if(p)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return f(),h.push(e),function(){if(t){if(p)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,f();var r=h.indexOf(e);h.splice(r,1)}}}function y(e){if(!a(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"===typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(p)throw new Error("Reducers may not dispatch actions.");try{p=!0,u=l(u,e)}finally{p=!1}for(var t=d=h,r=0;r<t.length;r++){(0,t[r])()}return e}return y({type:i.INIT}),(s={dispatch:y,subscribe:m,getState:g,replaceReducer:function(e){if("function"!==typeof e)throw new Error("Expected the nextReducer to be a function.");l=e,y({type:i.REPLACE})}})[n.a]=function(){var e,t=m;return(e={subscribe:function(e){if("object"!==("undefined"===typeof e?"undefined":o(e))||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(g())}return r(),{unsubscribe:t(r)}}})[n.a]=function(){return this},e},s}function l(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function u(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];0,"function"===typeof e[o]&&(r[o]=e[o])}var s=Object.keys(r);var a=void 0;try{!function(e){Object.keys(e).forEach(function(t){var r=e[t];if("undefined"===typeof r(void 0,{type:i.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if("undefined"===typeof r(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+i.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(r)}catch(e){a=e}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(a)throw a;for(var n=!1,i={},o=0;o<s.length;o++){var c=s[o],u=r[c],d=e[c],h=u(d,t);if("undefined"===typeof h){var p=l(c,t);throw new Error(p)}i[c]=h,n=n||h!==d}return n?i:e}}function d(e,t){return function(){return t(e.apply(this,arguments))}}function h(e,t){if("function"===typeof e)return d(e,t);if("object"!==("undefined"===typeof e?"undefined":o(e))||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":"undefined"===typeof e?"undefined":o(e))+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),n={},i=0;i<r.length;i++){var s=r[i],a=e[s];"function"===typeof a&&(n[s]=d(a,t))}return n}function p(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function f(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];var o=e.apply(void 0,n),a=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},c={getState:o.getState,dispatch:function(){return a.apply(void 0,arguments)}},l=t.map(function(e){return e(c)});return a=p.apply(void 0,l)(o.dispatch),s({},o,{dispatch:a})}}}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var i=r(734),o=r(735),s=r(775),a=r(776),c=r(788),l=r(789);t.default=function(e,t){return void 0===e&&(e={}),{dirtyHandlerIds:a.default(e.dirtyHandlerIds,{type:t.type,payload:n({},t.payload,{prevTargetIds:l(e,"dragOperation.targetIds",[])})}),dragOffset:i.default(e.dragOffset,t),refCount:s.default(e.refCount,t),dragOperation:o.default(e.dragOperation,t),stateId:c.default(e.stateId)}}},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var i=r(150),o=r(346),s={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};t.default=function(e,t){void 0===e&&(e=s);var r=t.payload;switch(t.type){case i.BEGIN_DRAG:return{initialSourceClientOffset:r.sourceClientOffset,initialClientOffset:r.clientOffset,clientOffset:r.clientOffset};case i.HOVER:return o.areCoordsEqual(e.clientOffset,r.clientOffset)?e:n({},e,{clientOffset:r.clientOffset});case i.END_DRAG:case i.DROP:return s;default:return e}}},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var i=r(150),o=r(151),s=r(347),a={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};t.default=function(e,t){void 0===e&&(e=a);var r=t.payload;switch(t.type){case i.BEGIN_DRAG:return n({},e,{itemType:r.itemType,item:r.item,sourceId:r.sourceId,isSourcePublic:r.isSourcePublic,dropResult:null,didDrop:!1});case i.PUBLISH_DRAG_SOURCE:return n({},e,{isSourcePublic:!0});case i.HOVER:return n({},e,{targetIds:r.targetIds});case o.REMOVE_TARGET:return-1===e.targetIds.indexOf(r.targetId)?e:n({},e,{targetIds:s(e.targetIds,r.targetId)});case i.DROP:return n({},e,{dropResult:r.dropResult,didDrop:!0,targetIds:[]});case i.END_DRAG:return n({},e,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return e}}},function(e,t,r){var n=r(737),i=r(750),o=r(756);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(o||i),string:new n}}},function(e,t,r){var n=r(738),i=r(746),o=r(747),s=r(748),a=r(749);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,r){var n=r(152);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(e,t,r){var n=r(202),i=r(742),o=r(111),s=r(744),a=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,d=l.hasOwnProperty,h=RegExp("^"+u.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(n(e)?h:a).test(s(e))}},function(e,t,r){var n=r(154),i=Object.prototype,o=i.hasOwnProperty,s=i.toString,a=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),r=e[a];try{e[a]=void 0;var n=!0}catch(e){}var i=s.call(e);return n&&(t?e[a]=r:delete e[a]),i}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var n,i=r(743),o=(n=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!o&&o in e}},function(e,t,r){var n=r(113)["__core-js_shared__"];e.exports=n},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,r){var n=r(152),i="__lodash_hash_undefined__",o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return r===i?void 0:r}return o.call(t,e)?t[e]:void 0}},function(e,t,r){var n=r(152),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:i.call(t,e)}},function(e,t,r){var n=r(152),i="__lodash_hash_undefined__";e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?i:t,this}},function(e,t,r){var n=r(751),i=r(752),o=r(753),s=r(754),a=r(755);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,r){var n=r(155),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0)&&(r==t.length-1?t.pop():i.call(t,r,1),--this.size,!0)}},function(e,t,r){var n=r(155);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},function(e,t,r){var n=r(155);e.exports=function(e){return n(this.__data__,e)>-1}},function(e,t,r){var n=r(155);e.exports=function(e,t){var r=this.__data__,i=n(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}},function(e,t,r){var n=r(153)(r(113),"Map");e.exports=n},function(e,t,r){var n=r(156);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,r){var n=r(156);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(156);e.exports=function(e){return n(this,e).has(e)}},function(e,t,r){var n=r(156);e.exports=function(e,t){var r=n(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}},function(e,t){var r="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,r),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var n=r(765),i=r(766),o=r(767);e.exports=function(e,t,r){return t===t?o(e,t,r):n(e,i,r)}},function(e,t){e.exports=function(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}},function(e,t){e.exports=function(e){return e!==e}},function(e,t){e.exports=function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}},function(e,t,r){var n=r(769),i=Math.max;e.exports=function(e,t,r){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,s=-1,a=i(o.length-t,0),c=Array(a);++s<a;)c[s]=o[t+s];s=-1;for(var l=Array(t+1);++s<t;)l[s]=o[s];return l[t]=r(c),n(e,this,l)}}},function(e,t){e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},function(e,t,r){var n=r(771),i=r(774)(n);e.exports=i},function(e,t,r){var n=r(772),i=r(773),o=r(351),s=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:o;e.exports=s},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,r){var n=r(153),i=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},function(e,t){var r=800,n=16,i=Date.now;e.exports=function(e){var t=0,o=0;return function(){var s=i(),a=n-(s-o);if(o=s,a>0){if(++t>=r)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(151);t.default=function(e,t){switch(void 0===e&&(e=0),t.type){case n.ADD_SOURCE:case n.ADD_TARGET:return e+1;case n.REMOVE_SOURCE:case n.REMOVE_TARGET:return e-1;default:return e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(150),i=r(151),o=r(346),s=r(353),a=r(780);t.default=function(e,t){switch(void 0===e&&(e=s.NONE),t.type){case n.HOVER:break;case i.ADD_SOURCE:case i.ADD_TARGET:case i.REMOVE_TARGET:case i.REMOVE_SOURCE:return s.NONE;case n.BEGIN_DRAG:case n.PUBLISH_DRAG_SOURCE:case n.END_DRAG:case n.DROP:default:return s.ALL}var r=t.payload,c=r.targetIds,l=void 0===c?[]:c,u=r.prevTargetIds,d=void 0===u?[]:u,h=a(l,d);if(!(h.length>0)&&o.areArraysEqual(l,d))return s.NONE;var p=d[d.length-1],f=l[l.length-1];return p!==f&&(p&&h.push(p),f&&h.push(f)),h}},function(e,t,r){var n=r(157),i=r(778),o=r(114),s=r(779),a=o(function(e){var t=n(e,s);return t.length&&t[0]===e[0]?i(t):[]});e.exports=a},function(e,t,r){var n=r(201),i=r(204),o=r(205),s=r(157),a=r(206),c=r(207),l=Math.min;e.exports=function(e,t,r){for(var u=r?o:i,d=e[0].length,h=e.length,p=h,f=Array(h),g=1/0,m=[];p--;){var y=e[p];p&&t&&(y=s(y,a(t))),g=l(y.length,g),f[p]=!r&&(t||d>=120&&y.length>=120)?new n(p&&y):void 0}y=e[0];var v=-1,_=f[0];e:for(;++v<d&&m.length<g;){var w=y[v],S=t?t(w):w;if(w=r||0!==w?w:0,!(_?c(_,S):u(m,S,r))){for(p=h;--p;){var b=f[p];if(!(b?c(b,S):u(e[p],S,r)))continue e}_&&_.push(S),m.push(w)}}return m}},function(e,t,r){var n=r(158);e.exports=function(e){return n(e)?e:[]}},function(e,t,r){var n=r(781),i=r(114),o=r(782),s=r(158),a=i(function(e){return o(n(e,s))});e.exports=a},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var s=e[r];t(s,r,e)&&(o[i++]=s)}return o}},function(e,t,r){var n=r(348),i=r(354),o=r(356);e.exports=function(e,t,r){var s=e.length;if(s<2)return s?o(e[0]):[];for(var a=-1,c=Array(s);++a<s;)for(var l=e[a],u=-1;++u<s;)u!=a&&(c[a]=n(c[a]||l,e[u],t,r));return o(i(c,1),t,r)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}},function(e,t,r){var n=r(154),i=r(355),o=r(115),s=n?n.isConcatSpreadable:void 0;e.exports=function(e){return o(e)||i(e)||!!(s&&e&&e[s])}},function(e,t,r){var n=r(112),i=r(94),o="[object Arguments]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(787),i=r(357),o=r(358),s=n&&1/o(new n([,-0]))[1]==1/0?function(e){return new n(e)}:i;e.exports=s},function(e,t,r){var n=r(153)(r(113),"Set");e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return void 0===e&&(e=0),e+1}},function(e,t,r){var n=r(790);e.exports=function(e,t,r){var i=null==e?void 0:n(e,t);return void 0===i?r:i}},function(e,t,r){var n=r(791),i=r(797);e.exports=function(e,t){for(var r=0,o=(t=n(t,e)).length;null!=e&&r<o;)e=e[i(t[r++])];return r&&r==o?e:void 0}},function(e,t,r){var n=r(115),i=r(792),o=r(793),s=r(795);e.exports=function(e,t){return n(e)?e:i(e,t)?[e]:o(s(e))}},function(e,t,r){var n=r(115),i=r(209),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!i(e))||s.test(e)||!o.test(e)||null!=t&&e in Object(t)}},function(e,t,r){var n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,o=r(794)(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(n,function(e,r,n,o){t.push(n?o.replace(i,"$1"):r||e)}),t});e.exports=o},function(e,t,r){var n=r(359),i=500;e.exports=function(e){var t=n(e,function(e){return r.size===i&&r.clear(),e}),r=t.cache;return t}},function(e,t,r){var n=r(796);e.exports=function(e){return null==e?"":n(e)}},function(e,t,r){var n=r(154),i=r(157),o=r(115),s=r(209),a=1/0,c=n?n.prototype:void 0,l=c?c.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(s(t))return l?l.call(t):"";var r=t+"";return"0"==r&&1/t==-a?"-0":r}},function(e,t,r){var n=r(209),i=1/0;e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(345),i=r(799),o=r(353),s=r(28),a=function(){function e(e,t){this.store=e,this.registry=t}return e.prototype.subscribeToStateChange=function(e,t){var r=this;void 0===t&&(t={handlerIds:void 0});var n=t.handlerIds;s("function"===typeof e,"listener must be a function."),s("undefined"===typeof n||Array.isArray(n),"handlerIds, when specified, must be an array of strings.");var i=this.store.getState().stateId;return this.store.subscribe(function(){var t=r.store.getState(),s=t.stateId;try{s===i||s===i+1&&!o.areDirty(t.dirtyHandlerIds,n)||e()}finally{i=s}})},e.prototype.subscribeToOffsetChange=function(e){var t=this;s("function"===typeof e,"listener must be a function.");var r=this.store.getState().dragOffset;return this.store.subscribe(function(){var n=t.store.getState().dragOffset;n!==r&&(r=n,e())})},e.prototype.canDragSource=function(e){var t=this.registry.getSource(e);return s(t,"Expected to find a valid source."),!this.isDragging()&&t.canDrag(this,e)},e.prototype.canDropOnTarget=function(e){var t=this.registry.getTarget(e);if(s(t,"Expected to find a valid target."),!this.isDragging()||this.didDrop())return!1;var r=this.registry.getTargetType(e),i=this.getItemType();return n.default(r,i)&&t.canDrop(this,e)},e.prototype.isDragging=function(){return Boolean(this.getItemType())},e.prototype.isDraggingSource=function(e){var t=this.registry.getSource(e,!0);return s(t,"Expected to find a valid source."),!(!this.isDragging()||!this.isSourcePublic())&&(this.registry.getSourceType(e)===this.getItemType()&&t.isDragging(this,e))},e.prototype.isOverTarget=function(e,t){void 0===t&&(t={shallow:!1});var r=t.shallow;if(!this.isDragging())return!1;var i=this.registry.getTargetType(e),o=this.getItemType();if(o&&!n.default(i,o))return!1;var s=this.getTargetIds();if(!s.length)return!1;var a=s.indexOf(e);return r?a===s.length-1:a>-1},e.prototype.getItemType=function(){return this.store.getState().dragOperation.itemType},e.prototype.getItem=function(){return this.store.getState().dragOperation.item},e.prototype.getSourceId=function(){return this.store.getState().dragOperation.sourceId},e.prototype.getTargetIds=function(){return this.store.getState().dragOperation.targetIds},e.prototype.getDropResult=function(){return this.store.getState().dragOperation.dropResult},e.prototype.didDrop=function(){return this.store.getState().dragOperation.didDrop},e.prototype.isSourcePublic=function(){return this.store.getState().dragOperation.isSourcePublic},e.prototype.getInitialClientOffset=function(){return this.store.getState().dragOffset.initialClientOffset},e.prototype.getInitialSourceClientOffset=function(){return this.store.getState().dragOffset.initialSourceClientOffset},e.prototype.getClientOffset=function(){return this.store.getState().dragOffset.clientOffset},e.prototype.getSourceClientOffset=function(){return i.getSourceClientOffset(this.store.getState().dragOffset)},e.prototype.getDifferenceFromInitialOffset=function(){return i.getDifferenceFromInitialOffset(this.store.getState().dragOffset)},e}();t.default=a},function(e,t,r){"use strict";function n(e,t){return{x:e.x+t.x,y:e.y+t.y}}function i(e,t){return{x:e.x-t.x,y:e.y-t.y}}Object.defineProperty(t,"__esModule",{value:!0}),t.add=n,t.subtract=i,t.getSourceClientOffset=function(e){var t=e.clientOffset,r=e.initialClientOffset,o=e.initialSourceClientOffset;return t&&r&&o?i(n(t,o),r):null},t.getDifferenceFromInitialOffset=function(e){var t=e.clientOffset,r=e.initialClientOffset;return t&&r?i(t,r):null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(151),i=r(801),o=r(344),s=r(802),a=r(28),c=r(803);function l(e){switch(e[0]){case"S":return o.HandlerRole.SOURCE;case"T":return o.HandlerRole.TARGET;default:a(!1,"Cannot parse handler ID: "+e)}}function u(e,t){var r=e.entries(),n=!1;do{var i=r.next(),o=i.done;if(i.value[1]===t)return!0;n=o}while(!n);return!1}var d=function(){function e(e){this.store=e,this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null}return e.prototype.addSource=function(e,t){s.validateType(e),s.validateSourceContract(t);var r=this.addHandler(o.HandlerRole.SOURCE,e,t);return this.store.dispatch(n.addSource(r)),r},e.prototype.addTarget=function(e,t){s.validateType(e,!0),s.validateTargetContract(t);var r=this.addHandler(o.HandlerRole.TARGET,e,t);return this.store.dispatch(n.addTarget(r)),r},e.prototype.containsHandler=function(e){return u(this.dragSources,e)||u(this.dropTargets,e)},e.prototype.getSource=function(e,t){return void 0===t&&(t=!1),a(this.isSourceId(e),"Expected a valid source ID."),t&&e===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(e)},e.prototype.getTarget=function(e){return a(this.isTargetId(e),"Expected a valid target ID."),this.dropTargets.get(e)},e.prototype.getSourceType=function(e){return a(this.isSourceId(e),"Expected a valid source ID."),this.types.get(e)},e.prototype.getTargetType=function(e){return a(this.isTargetId(e),"Expected a valid target ID."),this.types.get(e)},e.prototype.isSourceId=function(e){return l(e)===o.HandlerRole.SOURCE},e.prototype.isTargetId=function(e){return l(e)===o.HandlerRole.TARGET},e.prototype.removeSource=function(e){var t=this;a(this.getSource(e),"Expected an existing source."),this.store.dispatch(n.removeSource(e)),c(function(){t.dragSources.delete(e),t.types.delete(e)})},e.prototype.removeTarget=function(e){a(this.getTarget(e),"Expected an existing target."),this.store.dispatch(n.removeTarget(e)),this.dropTargets.delete(e),this.types.delete(e)},e.prototype.pinSource=function(e){var t=this.getSource(e);a(t,"Expected an existing source."),this.pinnedSourceId=e,this.pinnedSource=t},e.prototype.unpinSource=function(){a(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null},e.prototype.addHandler=function(e,t,r){var n=function(e){var t=i.default().toString();switch(e){case o.HandlerRole.SOURCE:return"S"+t;case o.HandlerRole.TARGET:return"T"+t;default:throw new Error("Unknown Handler Role: "+e)}}(e);return this.types.set(n,t),e===o.HandlerRole.SOURCE?this.dragSources.set(n,r):e===o.HandlerRole.TARGET&&this.dropTargets.set(n,r),n},e}();t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=0;t.default=function(){return n++}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(28);t.validateSourceContract=function(e){n("function"===typeof e.canDrag,"Expected canDrag to be a function."),n("function"===typeof e.beginDrag,"Expected beginDrag to be a function."),n("function"===typeof e.endDrag,"Expected endDrag to be a function.")},t.validateTargetContract=function(e){n("function"===typeof e.canDrop,"Expected canDrop to be a function."),n("function"===typeof e.hover,"Expected hover to be a function."),n("function"===typeof e.drop,"Expected beginDrag to be a function.")},t.validateType=function e(t,r){r&&Array.isArray(t)?t.forEach(function(t){return e(t,!1)}):n("string"===typeof t||"symbol"===typeof t,r?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}},function(e,t,r){"use strict";var n=r(219),i=[],o=[],s=n.makeRequestCallFromTimer(function(){if(o.length)throw o.shift()});function a(e){var t;(t=i.length?i.pop():new c).task=e,n(t)}function c(){this.task=null}e.exports=a,c.prototype.call=function(){try{this.task.call()}catch(e){a.onerror?a.onerror(e):(o.push(e),s())}finally{this.task=null,i[i.length]=this}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=r(159),c=r(200),l=r(210),u=r(95),d=r(28),h=r(116),p=r(211).default;t.default=function(e,t){return void 0===t&&(t={}),a.default("DragLayer","collect[, options]",e,t),d("function"===typeof e,'Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ',"Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-layer.html",e),d(u(t),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-layer.html',t),function(r){var n=r,a=t.arePropsEqual,u=void 0===a?h:a,f=n.displayName||n.name||"Component",g=function(t){function a(e){var r=t.call(this,e)||this;return r.isCurrentlyMounted=!1,r.ref=s.createRef(),r.handleChange=r.handleChange.bind(r),r}return i(a,t),Object.defineProperty(a.prototype,"DecoratedComponent",{get:function(){return r},enumerable:!0,configurable:!0}),a.prototype.getDecoratedComponentInstance=function(){return d(this.ref.current,"In order to access an instance of the decorated component it can not be a stateless component."),this.ref.current},a.prototype.shouldComponentUpdate=function(e,t){return!u(e,this.props)||!h(t,this.state)},a.prototype.componentDidMount=function(){this.isCurrentlyMounted=!0,this.handleChange()},a.prototype.componentWillUnmount=function(){this.isCurrentlyMounted=!1,this.unsubscribeFromOffsetChange&&(this.unsubscribeFromOffsetChange(),this.unsubscribeFromOffsetChange=void 0),this.unsubscribeFromStateChange&&(this.unsubscribeFromStateChange(),this.unsubscribeFromStateChange=void 0)},a.prototype.render=function(){var e=this;return s.createElement(c.Consumer,null,function(t){var r=t.dragDropManager;return void 0===r?null:(e.receiveDragDropManager(r),e.isCurrentlyMounted?s.createElement(n,o({},e.props,e.state,{ref:p(n)?e.ref:void 0})):null)})},a.prototype.receiveDragDropManager=function(e){if(void 0===this.manager){this.manager=e,d("object"===typeof e,"Could not find the drag and drop manager in the context of %s. Make sure to wrap the top-level component of your app with DragDropContext. Read more: http://react-dnd.github.io/react-dnd/docs-troubleshooting.html#could-not-find-the-drag-and-drop-manager-in-the-context",f,f);var t=this.manager.getMonitor();this.unsubscribeFromOffsetChange=t.subscribeToOffsetChange(this.handleChange),this.unsubscribeFromStateChange=t.subscribeToStateChange(this.handleChange)}},a.prototype.handleChange=function(){if(this.isCurrentlyMounted){var e=this.getCurrentState();h(e,this.state)||this.setState(e)}},a.prototype.getCurrentState=function(){if(!this.manager)return{};var t=this.manager.getMonitor();return e(t,this.props)},a.displayName="DragLayer("+f+")",a}(s.Component);return l(g,r)}}},function(e,t,r){var n=r(806)(Object.getPrototypeOf,Object);e.exports=n},function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(159),i=r(360),o=r(812),s=r(813),a=r(814),c=r(815),l=r(362),u=r(28),d=r(95);t.default=function(e,t,r,h){void 0===h&&(h={}),n.default("DragSource","type, spec, collect[, options]",e,t,r,h);var p=e;"function"!==typeof e&&(u(l.default(e),'Expected "type" provided as the first argument to DragSource to be a string, or a function that returns a string given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',e),p=function(){return e}),u(d(t),'Expected "spec" provided as the second argument to DragSource to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',t);var f=s.default(t);return u("function"===typeof r,'Expected "collect" provided as the third argument to DragSource to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',r),u(d(h),'Expected "options" provided as the fourth argument to DragSource to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',r),function(e){return i.default({containerDisplayName:"DragSource",createHandler:f,registerHandler:o.default,createMonitor:a.default,createConnector:c.default,DecoratedComponent:e,getType:p,collect:r,options:h})}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(809)),n(r(810)),n(r(811))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(202),i=r(357),o=function(){function e(e){this.isDisposed=!1,this.action=n(e)?e:i}return e.isDisposable=function(e){return e&&n(e.dispose)},e._fixup=function(t){return e.isDisposable(t)?t:e.empty},e.create=function(t){return new e(t)},e.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)},e.empty={dispose:i},e}();t.Disposable=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.isDisposed=!1}return e.prototype.getDisposable=function(){return this.current},e.prototype.setDisposable=function(e){var t=this.isDisposed;if(!t){var r=this.current;this.current=e,r&&r.dispose()}t&&e&&e.dispose()},e.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=void 0,e&&e.dispose()}},e}();t.SerialDisposable=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isDisposed=!1,this.disposables=e}return e.prototype.add=function(e){this.isDisposed?e.dispose():this.disposables.push(e)},e.prototype.remove=function(e){var t=!1;if(!this.isDisposed){var r=this.disposables.indexOf(e);-1!==r&&(t=!0,this.disposables.splice(r,1),e.dispose())}return t},e.prototype.clear=function(){if(!this.isDisposed){for(var e=this.disposables.length,t=new Array(e),r=0;r<e;r++)t[r]=this.disposables[r];this.disposables=[];for(r=0;r<e;r++)t[r].dispose()}},e.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),r=0;r<e;r++)t[r]=this.disposables[r];this.disposables=[];for(r=0;r<e;r++)t[r].dispose()}},e}();t.CompositeDisposable=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){var n=r.getRegistry(),i=n.addSource(e,t);return{handlerId:i,unregister:function(){n.removeSource(i)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(28),o=(r(95),["canDrag","beginDrag","isDragging","endDrag"]),s=["beginDrag"];t.default=function(e){Object.keys(e).forEach(function(t){i(o.indexOf(t)>-1,'Expected the drag source specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',o.join(", "),t),i("function"===typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html",t,t,e[t])}),s.forEach(function(t){i("function"===typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html",t,t,e[t])});var t=function(){function t(e){this.monitor=e,this.props=null,this.ref=n.createRef(),this.beginDrag=this.beginDrag.bind(this)}return t.prototype.receiveProps=function(e){this.props=e},t.prototype.canDrag=function(){return!!this.props&&(!e.canDrag||e.canDrag(this.props,this.monitor))},t.prototype.isDragging=function(t,r){return!!this.props&&(e.isDragging?e.isDragging(this.props,this.monitor):r===t.getSourceId())},t.prototype.beginDrag=function(){if(this.props)return e.beginDrag(this.props,this.monitor,this.ref.current)},t.prototype.endDrag=function(){this.props&&e.endDrag&&e.endDrag(this.props,this.monitor,this.ref.current)},t}();return function(e){return new t(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(28),i=!1,o=!1,s=function(){function e(e){this.internalMonitor=e.getMonitor()}return e.prototype.receiveHandlerId=function(e){this.sourceId=e},e.prototype.canDrag=function(){n(!i,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source-monitor.html");try{return i=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{i=!1}},e.prototype.isDragging=function(){n(!o,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs-drag-source-monitor.html");try{return o=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{o=!1}},e.prototype.subscribeToStateChange=function(e,t){return this.internalMonitor.subscribeToStateChange(e,t)},e.prototype.isDraggingSource=function(e){return this.internalMonitor.isDraggingSource(e)},e.prototype.isOverTarget=function(e,t){return this.internalMonitor.isOverTarget(e,t)},e.prototype.getTargetIds=function(){return this.internalMonitor.getTargetIds()},e.prototype.isSourcePublic=function(){return this.internalMonitor.isSourcePublic()},e.prototype.getSourceId=function(){return this.internalMonitor.getSourceId()},e.prototype.subscribeToOffsetChange=function(e){return this.internalMonitor.subscribeToOffsetChange(e)},e.prototype.canDragSource=function(e){return this.internalMonitor.canDragSource(e)},e.prototype.canDropOnTarget=function(e){return this.internalMonitor.canDropOnTarget(e)},e.prototype.getItemType=function(){return this.internalMonitor.getItemType()},e.prototype.getItem=function(){return this.internalMonitor.getItem()},e.prototype.getDropResult=function(){return this.internalMonitor.getDropResult()},e.prototype.didDrop=function(){return this.internalMonitor.didDrop()},e.prototype.getInitialClientOffset=function(){return this.internalMonitor.getInitialClientOffset()},e.prototype.getInitialSourceClientOffset=function(){return this.internalMonitor.getInitialSourceClientOffset()},e.prototype.getSourceClientOffset=function(){return this.internalMonitor.getSourceClientOffset()},e.prototype.getClientOffset=function(){return this.internalMonitor.getClientOffset()},e.prototype.getDifferenceFromInitialOffset=function(){return this.internalMonitor.getDifferenceFromInitialOffset()},e}();t.default=function(e){return new s(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(361),i=r(116);t.default=function(e){var t,r,o,s,a,c,l;function u(){s&&(s(),s=void 0),t&&r&&(s=e.connectDragSource(t,r,o))}function d(){l&&(l(),l=void 0),t&&a&&(l=e.connectDragPreview(t,a,c))}return{receiveHandlerId:function(e){e!==t&&(t=e,u(),d())},hooks:n.default({dragSource:function(e,t){e===r&&i(t,o)||(r=e,o=t,u())},dragPreview:function(e,t){e===a&&i(t,c)||(a=e,c=t,d())}})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(28);t.default=function(e,t){var r=e.ref;return i("string"!==typeof r,"Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://facebook.github.io/react/docs/more-about-refs.html#the-ref-callback-attribute"),r?n.cloneElement(e,{ref:function(e){t(e),r&&r(e)}}):n.cloneElement(e,{ref:t})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(159),i=r(360),o=r(818),s=r(819),a=r(820),c=r(821),l=r(362),u=r(28),d=r(95);t.default=function(e,t,r,h){void 0===h&&(h={}),n.default("DropTarget","type, spec, collect[, options]",e,t,r,h);var p=e;"function"!==typeof e&&(u(l.default(e,!0),'Expected "type" provided as the first argument to DropTarget to be a string, an array of strings, or a function that returns either given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',e),p=function(){return e}),u(d(t),'Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',t);var f=s.default(t);return u("function"===typeof r,'Expected "collect" provided as the third argument to DropTarget to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',r),u(d(h),'Expected "options" provided as the fourth argument to DropTarget to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',r),function(e){return i.default({containerDisplayName:"DropTarget",createHandler:f,registerHandler:o.default,createMonitor:a.default,createConnector:c.default,DecoratedComponent:e,getType:p,collect:r,options:h})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){var n=r.getRegistry(),i=n.addTarget(e,t);return{handlerId:i,unregister:function(){n.removeTarget(i)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(28),o=(r(95),["canDrop","hover","drop"]);t.default=function(e){Object.keys(e).forEach(function(t){i(o.indexOf(t)>-1,'Expected the drop target specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',o.join(", "),t),i("function"===typeof e[t],"Expected %s in the drop target specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html",t,t,e[t])});var t=function(){function t(e){this.monitor=e,this.props=null,this.ref=n.createRef()}return t.prototype.receiveProps=function(e){this.props=e},t.prototype.receiveMonitor=function(e){this.monitor=e},t.prototype.canDrop=function(){return!e.canDrop||e.canDrop(this.props,this.monitor)},t.prototype.hover=function(){e.hover&&e.hover(this.props,this.monitor,this.ref.current)},t.prototype.drop=function(){if(e.drop)return e.drop(this.props,this.monitor,this.ref.current)},t}();return function(e){return new t(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(28),i=!1,o=function(){function e(e){this.internalMonitor=e.getMonitor()}return e.prototype.receiveHandlerId=function(e){this.targetId=e},e.prototype.canDrop=function(){n(!i,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs-drop-target-monitor.html");try{return i=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{i=!1}},e.prototype.isOver=function(e){return this.internalMonitor.isOverTarget(this.targetId,e)},e.prototype.getItemType=function(){return this.internalMonitor.getItemType()},e.prototype.getItem=function(){return this.internalMonitor.getItem()},e.prototype.getDropResult=function(){return this.internalMonitor.getDropResult()},e.prototype.didDrop=function(){return this.internalMonitor.didDrop()},e.prototype.getInitialClientOffset=function(){return this.internalMonitor.getInitialClientOffset()},e.prototype.getInitialSourceClientOffset=function(){return this.internalMonitor.getInitialSourceClientOffset()},e.prototype.getSourceClientOffset=function(){return this.internalMonitor.getSourceClientOffset()},e.prototype.getClientOffset=function(){return this.internalMonitor.getClientOffset()},e.prototype.getDifferenceFromInitialOffset=function(){return this.internalMonitor.getDifferenceFromInitialOffset()},e}();t.TargetMonitor=o,t.default=function(e){return new o(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(361),i=r(116);t.default=function(e){var t,r,o,s;function a(){s&&(s(),s=void 0),t&&r&&(s=e.connectDropTarget(t,r,o))}return{receiveHandlerId:function(e){e!==t&&(t=e,a())},hooks:n.default({dropTarget:function(e,t){e===r&&i(t,o)||(r=e,o=t,a())}})}}},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(r(1)),s=r(199);t.withDropTarget=(e=>s.DropTarget(e=>e.dropProps.objectTypes?"function"===typeof e.dropProps.objectTypes?e.dropProps.objectTypes():e.dropProps.objectTypes:[],{drop(e,t,r){const n=t.getItem();if(t.isOver({shallow:e.shallow||!1})){let i={};const o=r.rootElement;o&&(i=o.getBoundingClientRect());const s=t.getClientOffset()||n.clientOffset,a=t.getInitialClientOffset()||n.initialClientOffset,c=t.getSourceClientOffset()||n.sourceClientOffset,l=t.getInitialSourceClientOffset()||n.initialSourceClientOffset,u=Object.assign({},n,{dropRect:i,clientOffset:s,initialClientOffset:a,sourceClientOffset:c,initialSourceClientOffset:l});if(e.dropProps.onDropTargetDrop)return e.dropProps.onDropTargetDrop(u)}},hover(e,t,r){if(t.isOver({shallow:e.shallow||!1})&&e.dropProps.onDropTargetOver){const n=t.getItem();let i={};const o=r.rootElement;o&&(i=o.getBoundingClientRect());const s=t.getClientOffset()||n.clientOffset,a=t.getInitialClientOffset()||n.initialClientOffset,c=t.getSourceClientOffset()||n.sourceClientOffset,l=t.getInitialSourceClientOffset()||n.initialSourceClientOffset,u=Object.assign({},n,{dropRect:i,clientOffset:s,initialClientOffset:a,sourceClientOffset:c,initialSourceClientOffset:l});e.dropProps.onDropTargetOver(u)}},canDrop(e,t){if(t.isOver({shallow:e.shallow||!1})&&e.dropProps.canDropTargetDrop){const r=t.getItem(),n=t.getClientOffset()||r.clientOffset,i=t.getInitialClientOffset()||r.initialClientOffset,o=t.getSourceClientOffset()||r.sourceClientOffset,s=t.getInitialSourceClientOffset()||r.initialSourceClientOffset,a=Object.assign({},r,{clientOffset:n,initialClientOffset:i,sourceClientOffset:o,initialSourceClientOffset:s});return e.dropProps.canDropTargetDrop(a)}return!0}},(e,t)=>({connectDropTarget:e.dropTarget(),isOver:t.isOver({shallow:!0}),canDrop:t.canDrop(),item:t.getItem(),type:t.getItemType()||void 0}))(class WithDropTarget extends o.Component{constructor(){super(...arguments),this.rootElement=null}render(){const t=this.props,{dropProps:r,shallow:i,connectDropTarget:s,isOver:a,canDrop:c,item:l,type:u,dropStyle:d}=t,h=n(t,["dropProps","shallow","connectDropTarget","isOver","canDrop","item","type","dropStyle"]),p={item:l,type:u,isOver:a,canDrop:c};return s(o.createElement("div",{ref:e=>{this.rootElement=e},style:this.props.dropStyle},o.createElement(e,Object.assign({},h,p))))}}))},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(1)),s=i(r(824)),a=r(199);t.BeDragDropContext=a.DragDropContext(s.default)(class BeDragDropContextComponent extends o.Component{render(){return o.createElement(o.Fragment,null,this.props.children)}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(825),i=r(845);t.getEmptyImage=i.default;var o=r(212);t.NativeTypes=o,t.default=function(e){return new n.default(e)}},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});var i=r(826),o=r(363),s=r(828),a=r(830),c=r(212),l=r(831),u=r(832),d=r(116),h=function(){function e(e){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.enterLeaveCounter=new i.default,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.currentDragSourceNodeOffset=null,this.currentDragSourceNodeOffsetChanged=!1,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.context=e.getContext()}return Object.defineProperty(e.prototype,"window",{get:function(){return this.context&&this.context.window?this.context.window:"undefined"!==typeof window?window:void 0},enumerable:!0,configurable:!0}),e.prototype.setup=function(){if(void 0!==this.window){if(this.window.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");this.window.__isReactDndBackendSetUp=!0,this.addEventListeners(this.window)}},e.prototype.teardown=function(){void 0!==this.window&&(this.window.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.window),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId&&this.window.cancelAnimationFrame(this.asyncEndDragFrameId))},e.prototype.connectDragPreview=function(e,t,r){var n=this;return this.sourcePreviewNodeOptions.set(e,r),this.sourcePreviewNodes.set(e,t),function(){n.sourcePreviewNodes.delete(e),n.sourcePreviewNodeOptions.delete(e)}},e.prototype.connectDragSource=function(e,t,r){var n=this;this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,r);var i=function(t){return n.handleDragStart(t,e)},o=function(e){return n.handleSelectStart(e)};return t.setAttribute("draggable",!0),t.addEventListener("dragstart",i),t.addEventListener("selectstart",o),function(){n.sourceNodes.delete(e),n.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",i),t.removeEventListener("selectstart",o),t.setAttribute("draggable",!1)}},e.prototype.connectDropTarget=function(e,t){var r=this,n=function(t){return r.handleDragEnter(t,e)},i=function(t){return r.handleDragOver(t,e)},o=function(t){return r.handleDrop(t,e)};return t.addEventListener("dragenter",n),t.addEventListener("dragover",i),t.addEventListener("drop",o),function(){t.removeEventListener("dragenter",n),t.removeEventListener("dragover",i),t.removeEventListener("drop",o)}},e.prototype.addEventListeners=function(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))},e.prototype.removeEventListeners=function(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))},e.prototype.getCurrentSourceNodeOptions=function(){var e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return u(t||{},{dropEffect:this.altKeyPressed?"copy":"move"})},e.prototype.getCurrentDropEffect=function(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect},e.prototype.getCurrentSourcePreviewNodeOptions=function(){var e=this.monitor.getSourceId(),t=this.sourcePreviewNodeOptions.get(e);return u(t||{},{anchorX:.5,anchorY:.5,captureDraggingState:!1})},e.prototype.getSourceClientOffset=function(e){return s.getNodeClientOffset(this.sourceNodes.get(e))},e.prototype.isDraggingNativeItem=function(){var e=this.monitor.getItemType();return Object.keys(c).some(function(t){return c[t]===e})},e.prototype.beginDragNativeItem=function(e){this.clearCurrentDragSourceNode();var t=a.createNativeDragSource(e);this.currentNativeSource=new t,this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])},e.prototype.endDragNativeItem=function(){this.isDraggingNativeItem()&&(this.actions.endDrag(),this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},e.prototype.isNodeInDocument=function(e){return!!document&&document.body.contains(e)||!!this.window&&this.window.document.body.contains(e)},e.prototype.endDragIfSourceWasRemovedFromDOM=function(){var e=this.currentDragSourceNode;this.isNodeInDocument(e)||this.clearCurrentDragSourceNode()&&this.actions.endDrag()},e.prototype.setCurrentDragSourceNode=function(e){var t=this;this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e,this.currentDragSourceNodeOffset=s.getNodeClientOffset(e),this.currentDragSourceNodeOffsetChanged=!1;this.mouseMoveTimeoutTimer=setTimeout(function(){return t.window&&t.window.addEventListener("mousemove",t.endDragIfSourceWasRemovedFromDOM,!0)},1e3)},e.prototype.clearCurrentDragSourceNode=function(){return!!this.currentDragSourceNode&&(this.currentDragSourceNode=null,this.currentDragSourceNodeOffset=null,this.currentDragSourceNodeOffsetChanged=!1,this.window&&(this.window.clearTimeout(this.mouseMoveTimeoutTimer),this.window.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)),this.mouseMoveTimeoutTimer=null,!0)},e.prototype.checkIfCurrentDragSourceRectChanged=function(){var e=this.currentDragSourceNode;return!!e&&(!!this.currentDragSourceNodeOffsetChanged||(this.currentDragSourceNodeOffsetChanged=!d(s.getNodeClientOffset(e),this.currentDragSourceNodeOffset),this.currentDragSourceNodeOffsetChanged))},e.prototype.handleTopDragStartCapture=function(){this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},e.prototype.handleDragStart=function(e,t){this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t)},e.prototype.handleTopDragStart=function(e){var t=this,r=this.dragStartSourceIds;this.dragStartSourceIds=null;var n=s.getEventClientOffset(e);this.monitor.isDragging()&&this.actions.endDrag(),this.actions.beginDrag(r||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:n});var i=e.dataTransfer,o=a.matchNativeItemType(i);if(this.monitor.isDragging()){if("function"===typeof i.setDragImage){var c=this.monitor.getSourceId(),l=this.sourceNodes.get(c),u=this.sourcePreviewNodes.get(c)||l,d=this.getCurrentSourcePreviewNodeOptions(),h={anchorX:d.anchorX,anchorY:d.anchorY},p={offsetX:d.offsetX,offsetY:d.offsetY},f=s.getDragPreviewOffset(l,u,n,h,p);i.setDragImage(u,f.x,f.y)}try{i.setData("application/json",{})}catch(e){}this.setCurrentDragSourceNode(e.target),this.getCurrentSourcePreviewNodeOptions().captureDraggingState?this.actions.publishDragSource():setTimeout(function(){return t.actions.publishDragSource()},0)}else if(o)this.beginDragNativeItem(o);else{if(!(i.types||e.target.hasAttribute&&e.target.hasAttribute("draggable")))return;e.preventDefault()}},e.prototype.handleTopDragEndCapture=function(){this.clearCurrentDragSourceNode()&&this.actions.endDrag()},e.prototype.handleTopDragEnterCapture=function(e){if(this.dragEnterTargetIds=[],this.enterLeaveCounter.enter(e.target)&&!this.monitor.isDragging()){var t=e.dataTransfer,r=a.matchNativeItemType(t);r&&this.beginDragNativeItem(r)}},e.prototype.handleDragEnter=function(e,t){this.dragEnterTargetIds.unshift(t)},e.prototype.handleTopDragEnter=function(e){var t=this,r=this.dragEnterTargetIds;(this.dragEnterTargetIds=[],this.monitor.isDragging())&&(this.altKeyPressed=e.altKey,o.isFirefox()||this.actions.hover(r,{clientOffset:s.getEventClientOffset(e)}),r.some(function(e){return t.monitor.canDropOnTarget(e)})&&(e.preventDefault(),e.dataTransfer.dropEffect=this.getCurrentDropEffect()))},e.prototype.handleTopDragOverCapture=function(){this.dragOverTargetIds=[]},e.prototype.handleDragOver=function(e,t){null===this.dragOverTargetIds&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)},e.prototype.handleTopDragOver=function(e){var t=this,r=this.dragOverTargetIds;if(this.dragOverTargetIds=[],!this.monitor.isDragging())return e.preventDefault(),void(e.dataTransfer.dropEffect="none");this.altKeyPressed=e.altKey,this.actions.hover(r||[],{clientOffset:s.getEventClientOffset(e)}),(r||[]).some(function(e){return t.monitor.canDropOnTarget(e)})?(e.preventDefault(),e.dataTransfer.dropEffect=this.getCurrentDropEffect()):this.isDraggingNativeItem()?(e.preventDefault(),e.dataTransfer.dropEffect="none"):this.checkIfCurrentDragSourceRectChanged()&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},e.prototype.handleTopDragLeaveCapture=function(e){this.isDraggingNativeItem()&&e.preventDefault(),this.enterLeaveCounter.leave(e.target)&&this.isDraggingNativeItem()&&this.endDragNativeItem()},e.prototype.handleTopDropCapture=function(e){this.dropTargetIds=[],e.preventDefault(),this.isDraggingNativeItem()&&this.currentNativeSource.mutateItemByReadingDataTransfer(e.dataTransfer),this.enterLeaveCounter.reset()},e.prototype.handleDrop=function(e,t){this.dropTargetIds.unshift(t)},e.prototype.handleTopDrop=function(e){var t=this.dropTargetIds;this.dropTargetIds=[],this.actions.hover(t,{clientOffset:s.getEventClientOffset(e)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.endDragIfSourceWasRemovedFromDOM()},e.prototype.handleSelectStart=function(e){var t=e.target;"function"===typeof t.dragDrop&&("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||(e.preventDefault(),t.dragDrop()))},n([l.default],e.prototype,"getSourceClientOffset",null),n([l.default],e.prototype,"endDragNativeItem",null),n([l.default],e.prototype,"isNodeInDocument",null),n([l.default],e.prototype,"endDragIfSourceWasRemovedFromDOM",null),n([l.default],e.prototype,"handleTopDragStartCapture",null),n([l.default],e.prototype,"handleTopDragStart",null),n([l.default],e.prototype,"handleTopDragEndCapture",null),n([l.default],e.prototype,"handleTopDragEnterCapture",null),n([l.default],e.prototype,"handleTopDragEnter",null),n([l.default],e.prototype,"handleTopDragOverCapture",null),n([l.default],e.prototype,"handleTopDragOver",null),n([l.default],e.prototype,"handleTopDragLeaveCapture",null),n([l.default],e.prototype,"handleTopDropCapture",null),n([l.default],e.prototype,"handleTopDrop",null),n([l.default],e.prototype,"handleSelectStart",null),e}();t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(827),i=r(347),o=function(){function e(){this.entered=[]}return e.prototype.enter=function(e){var t=this.entered.length;return this.entered=n(this.entered.filter(function(t){return document.documentElement.contains(t)&&(!t.contains||t.contains(e))}),[e]),0===t&&this.entered.length>0},e.prototype.leave=function(e){var t=this.entered.length;return this.entered=i(this.entered.filter(function(e){return document.documentElement.contains(e)}),e),t>0&&0===this.entered.length},e.prototype.reset=function(){this.entered=[]},e}();t.default=o},function(e,t,r){var n=r(354),i=r(114),o=r(356),s=r(158),a=i(function(e){return o(n(e,1,s,!0))});e.exports=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(363),i=r(829),o=1;function s(e){var t=e.nodeType===o?e:e.parentElement;if(!t)return null;var r=t.getBoundingClientRect(),n=r.top;return{x:r.left,y:n}}t.getNodeClientOffset=s,t.getEventClientOffset=function(e){return{x:e.clientX,y:e.clientY}},t.getDragPreviewOffset=function(e,t,r,o,a){var c,l,u="IMG"===(c=t).nodeName&&(n.isFirefox()||!document.documentElement.contains(c)),d=s(u?e:t),h={x:r.x-d.x,y:r.y-d.y},p=e.offsetWidth,f=e.offsetHeight,g=o.anchorX,m=o.anchorY,y=function(e,t,r,i){var o=e?t.width:r,s=e?t.height:i;return n.isSafari()&&e&&(s/=window.devicePixelRatio,o/=window.devicePixelRatio),{dragPreviewWidth:o,dragPreviewHeight:s}}(u,t,p,f),v=y.dragPreviewWidth,_=y.dragPreviewHeight,w=a.offsetX,S=a.offsetY,b=0===S||S;return{x:0===w||w?w:new i.default([0,.5,1],[h.x,h.x/p*v,h.x+v-p]).interpolate(g),y:b?S:(l=new i.default([0,.5,1],[h.y,h.y/f*_,h.y+_-f]).interpolate(m),n.isSafari()&&u&&(l+=(window.devicePixelRatio-1)*_),l)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=e.length,n=[],i=0;i<r;i++)n.push(i);n.sort(function(t,r){return e[t]<e[r]?-1:1});var o,s,a=[],c=[],l=[];for(i=0;i<r-1;i++)o=e[i+1]-e[i],s=t[i+1]-t[i],c.push(o),a.push(s),l.push(s/o);var u=[l[0]];for(i=0;i<c.length-1;i++){var d=l[i],h=l[i+1];if(d*h<=0)u.push(0);else{o=c[i];var p=c[i+1],f=o+p;u.push(3*f/((f+p)/d+(f+o)/h))}}u.push(l[l.length-1]);var g,m=[],y=[];for(i=0;i<u.length-1;i++){g=l[i];var v=u[i],_=1/c[i];f=v+u[i+1]-g-g;m.push((g-v-f)*_),y.push(f*_*_)}this.xs=e,this.ys=t,this.c1s=u,this.c2s=m,this.c3s=y}return e.prototype.interpolate=function(e){var t=this,r=t.xs,n=t.ys,i=t.c1s,o=t.c2s,s=t.c3s,a=r.length-1;if(e===r[a])return n[a];for(var c,l=0,u=s.length-1;l<=u;){var d=r[c=Math.floor(.5*(l+u))];if(d<e)l=c+1;else{if(!(d>e))return n[c];u=c-1}}var h=e-r[a=Math.max(0,u)],p=h*h;return n[a]+i[a]*h+o[a]*p+s[a]*h*p},e}();t.default=n},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0});var i=r(212);function o(e,t,r){var n=t.reduce(function(t,r){return t||e.getData(r)},null);return null!=n?n:r}var s=((n={})[i.FILE]={exposeProperty:"files",matchesTypes:["Files"],getData:function(e){return Array.prototype.slice.call(e.files)}},n[i.URL]={exposeProperty:"urls",matchesTypes:["Url","text/uri-list"],getData:function(e,t){return o(e,t,"").split("\n")}},n[i.TEXT]={exposeProperty:"text",matchesTypes:["Text","text/plain"],getData:function(e,t){return o(e,t,"")}},n);t.createNativeDragSource=function(e){var t=s[e],r=t.exposeProperty,n=t.matchesTypes,i=t.getData;return function(){function e(){var e;this.item=(e={},Object.defineProperty(e,r,{get:function(){return console.warn("Browser doesn't allow reading \""+r+'" until the drop event.'),null},enumerable:!0,configurable:!0}),e)}return e.prototype.mutateItemByReadingDataTransfer=function(e){delete this.item[r],this.item[r]=i(e,n)},e.prototype.canDrag=function(){return!0},e.prototype.beginDrag=function(){return this.item},e.prototype.isDragging=function(e,t){return t===e.getSourceId()},e.prototype.endDrag=function(){},e}()},t.matchNativeItemType=function(e){var t=Array.prototype.slice.call(e.types||[]);return Object.keys(s).filter(function(e){return s[e].matchesTypes.some(function(e){return t.indexOf(e)>-1})})[0]||null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t,r){var i=r.value;if("function"!==typeof i)throw new Error("@autobind decorator can only be applied to methods not: "+("undefined"===typeof i?"undefined":n(i)));var o=!1;return{configurable:!0,get:function(){if(o||this===e.prototype||this.hasOwnProperty(t)||"function"!==typeof i)return i;var r=i.bind(this);return o=!0,Object.defineProperty(this,t,{configurable:!0,get:function(){return r},set:function(e){i=e,delete this[t]}}),o=!1,r},set:function(e){i=e}}}t.default=function(){return 1===arguments.length?function(e){var t=void 0;"undefined"!==typeof Reflect&&"function"===typeof Reflect.ownKeys?t=Reflect.ownKeys(e.prototype):(t=Object.getOwnPropertyNames(e.prototype),"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(e.prototype))));return t.forEach(function(t){if("constructor"!==t){var r=Object.getOwnPropertyDescriptor(e.prototype,t);"function"===typeof r.value&&Object.defineProperty(e.prototype,t,i(e,t,r))}}),e}.apply(void 0,arguments):i.apply(void 0,arguments)}},function(e,t,r){var n=r(114),i=r(203),o=r(833),s=r(834),a=Object.prototype,c=a.hasOwnProperty,l=n(function(e,t){e=Object(e);var r=-1,n=t.length,l=n>2?t[2]:void 0;for(l&&o(t[0],t[1],l)&&(n=1);++r<n;)for(var u=t[r],d=s(u),h=-1,p=d.length;++h<p;){var f=d[h],g=e[f];(void 0===g||i(g,a[f])&&!c.call(e,f))&&(e[f]=u[f])}return e});e.exports=l},function(e,t,r){var n=r(203),i=r(208),o=r(364),s=r(111);e.exports=function(e,t,r){if(!s(r))return!1;var a=typeof t;return!!("number"==a?i(r)&&o(t,r.length):"string"==a&&t in r)&&n(r[t],e)}},function(e,t,r){var n=r(835),i=r(842),o=r(208);e.exports=function(e){return o(e)?n(e,!0):i(e)}},function(e,t,r){var n=r(836),i=r(355),o=r(115),s=r(837),a=r(364),c=r(839),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=o(e),u=!r&&i(e),d=!r&&!u&&s(e),h=!r&&!u&&!d&&c(e),p=r||u||d||h,f=p?n(e.length,String):[],g=f.length;for(var m in e)!t&&!l.call(e,m)||p&&("length"==m||d&&("offset"==m||"parent"==m)||h&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,g))||f.push(m);return f}},function(e,t){e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},function(e,t,r){(function(e){var n=r(113),i=r(838),o=t&&!t.nodeType&&t,s=o&&"object"==typeof e&&e&&!e.nodeType&&e,a=s&&s.exports===o?n.Buffer:void 0,c=(a?a.isBuffer:void 0)||i;e.exports=c}).call(this,r(123)(e))},function(e,t){e.exports=function(){return!1}},function(e,t,r){var n=r(840),i=r(206),o=r(841),s=o&&o.isTypedArray,a=s?i(s):n;e.exports=a},function(e,t,r){var n=r(112),i=r(352),o=r(94),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!s[n(e)]}},function(e,t,r){(function(e){var n=r(350),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,s=o&&o.exports===i&&n.process,a=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=a}).call(this,r(123)(e))},function(e,t,r){var n=r(111),i=r(843),o=r(844),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return o(e);var t=i(e),r=[];for(var a in e)("constructor"!=a||!t&&s.call(e,a))&&r.push(a);return r}},function(e,t){var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return n||((n=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),n}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(1)),s=i(r(2)),a=r(93);var c;r(847),function(e){e[e.Above=0]="Above",e[e.On=1]="On",e[e.Below=2]="Below"}(c||(c={}));class DragDropTreeNodeComponent extends o.Component{constructor(){super(...arguments),this._root=null,this.state={hoverMode:c.On},this._handleDragOver=(e=>{if(this.props.isOver&&this._root){const t=this._root.getBoundingClientRect(),r=(e.clientY-t.top)/t.height;r<1/3?this.state.hoverMode!==c.Above&&this.setState({hoverMode:c.Above}):r<2/3?this.state.hoverMode!==c.On&&this.setState({hoverMode:c.On}):this.state.hoverMode!==c.Below&&this.setState({hoverMode:c.Below})}})}render(){const{isOver:e,isDragging:t,canDrop:r}=this.props,n=this.state.hoverMode,i=s.default("node-drop-target",{above:r&&e&&n===c.Above,on:r&&e&&n===c.On,below:r&&e&&n===c.Below,dragging:t});return o.createElement("div",{className:i,ref:e=>{this._root=e},onDragOver:this._handleDragOver},this.props.children)}}t.DragDropTreeNodeComponent=DragDropTreeNodeComponent,t.DragDropTreeNode=function(){return a.withDropTarget(a.withDragSource(DragDropTreeNodeComponent))}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.default=class SimpleTreeDataProvider{constructor(e){this.onTreeNodeChanged=new n.BeEvent,this._hierarchy=e}getNodesByParentId(e,t){const r=this._hierarchy.get(e);if(!r)return[];if(!t)return[...r];let n;return void 0!==t.size&&0!==t.size&&(n=t.size,n+=t.start?t.start:0),r.slice(t.start,n)}async getNodes(e,t){return this.getNodesByParentId(e?e.id:void 0,t)}async getNodesCount(e){return this.getNodesByParentId(e?e.id:void 0).length}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(32);class BreadcrumbUpdateEvent extends n.UiEvent{}t.BreadcrumbUpdateEvent=BreadcrumbUpdateEvent;t.BreadcrumbPath=class BreadcrumbPath{constructor(e){this._currentNode=void 0,this._breadcrumbUpdateEvent=new BreadcrumbUpdateEvent,this._dataProvider=e}get BreadcrumbUpdateEvent(){return this._breadcrumbUpdateEvent}getDataProvider(){return this._dataProvider}setDataProvider(e){this.BreadcrumbUpdateEvent.emit({dataProvider:e,oldDataProvider:this._dataProvider,currentNode:this._currentNode}),this._dataProvider=e}getCurrentNode(){return this._currentNode}setCurrentNode(e){this.BreadcrumbUpdateEvent.emit({dataProvider:this._dataProvider,oldDataProvider:this._dataProvider,currentNode:e}),this._currentNode=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(32),i=r(366),o=r(66),s=r(35);t.SimpleTableDataProvider=class SimpleTableDataProvider{constructor(e){this.onColumnsChanged=new i.TableDataChangeEvent,this.onRowsChanged=new i.TableDataChangeEvent,this._columns=e,this._items=[],this._rowItemIndices=[],this._secondarySortColumnStack=[]}setItems(e){this._items=e,this._rowItemIndices=[],this.resetRowIndices(),this.onRowsChanged.raiseEvent()}resetRowIndices(){this._rowItemIndices.splice(0);for(let e=0;e<this._items.length;e++)this._rowItemIndices.push(e)}getColumns(){return Promise.resolve(this._columns)}getRowsCount(){return Promise.resolve(this._items.length)}async getRow(e,t){let r=-1;if(t?0<=e&&e<this._items.length&&(r=e):0<=e&&e<this._rowItemIndices.length&&(r=this.getRowIndexFromFilteredRowIndex(e)),0<=r&&r<this._items.length)return this._items[r];throw new Error("Invalid row index")}getRowIndexFromFilteredRowIndex(e){return void 0===e?e:e<0||e>=this._rowItemIndices.length?-1:this._rowItemIndices[e]}async sort(e,t){if(t===n.SortDirection.NoSort)return void this.resetRowIndices();this._secondarySortColumnStack=[],this._secondarySortColumnStack.push(e);const r=this;this._rowItemIndices.sort((n,i)=>r.sortDispatcher(r._items[n],r._items[i],e,t)),delete this._secondarySortColumnStack}sortDispatcher(e,t,r,n){let i=this.sortRows(e,t,r,n);if(0!==i)return i;const o=this._columns[r];return void 0!==o.secondarySortColumn&&o.secondarySortColumn!==r&&this._secondarySortColumnStack.indexOf(o.secondarySortColumn)<0&&(this._secondarySortColumnStack.push(o.secondarySortColumn),i=this.sortDispatcher(e,t,o.secondarySortColumn,n),this._secondarySortColumnStack.pop()),i}getPrimitiveValue(e){let t;const r=e.value;return r.valueFormat===o.PropertyValueFormat.Primitive&&(t=r.value),t}sortRows(e,t,r,i){const o=e.cells[r],a=t.cells[r];let c=0;const l=this._columns[r],u=l.propertyDescription,d=this.getPrimitiveValue(o.record),h=this.getPrimitiveValue(a.record);return d&&h&&u&&(c=s.TypeConverterManager.getConverter(u.typename).sortCompare(d,h,l.sortIgnoreCase)),i===n.SortDirection.Descending&&(c*=-1),c}addRow(e){return this.insertRow(e,-1)}insertRow(e,t){let r=t;return t<0||t>=this._items.length?r=this._items.push(e)-1:this._items.splice(r,0,e),this.resetRowIndices(),this.onRowsChanged.raiseEvent(),r}deleteRow(e,t=!0){const r=this.findRowIndex(e);r>=0&&(this._items.splice(r,1),this.resetRowIndices()),t&&this.onRowsChanged.raiseEvent()}moveRow(e,t){const r=this.findRowIndex(e);return r>=0&&(this.deleteRow(e,!1),t>r&&t--),this.insertRow(e,t)}findRowIndex(e){for(let t=0;t<this._items.length;t++)if(e===this._items[t])return t;return-1}}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(1)),s=i(r(214));r(368);t.Grid=class Grid extends o.Component{constructor(){super(...arguments),this.state={selectedRow:void 0},this._onRowClick=((e,t)=>{this.state.selectedRow===e?this.setState({selectedRow:void 0}):this.setState({selectedRow:e})})}rowGetter(e){return this.props.rows[e]}render(){return o.createElement("div",{className:"react-data-grid-wrapper"},o.createElement(s.default,{columns:this.props.columns,rowGetter:this.rowGetter.bind(this),rowsCount:this.props.rows.length,enableCellSelect:!1,minHeight:500,headerRowHeight:25,rowHeight:25,rowSelection:{showCheckbox:!1,enableShiftSelect:!0,selectBy:{indexes:[this.state.selectedRow]}},onRowClick:this._onRowClick}))}}},function(e,t,r){var n;n=function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){e.exports=r(217)},,function(t,r){t.exports=e},function(e,t,r){e.exports=r(112)()},,,function(e,r){e.exports=t},function(e,t,r){var n;function i(){for(var e,t="",r=0;r<arguments.length;r++)if(e=arguments[r])if("string"===typeof e||"number"===typeof e)t+=" "+e;else if("[object Array]"===Object.prototype.toString.call(e))t+=" "+i.apply(null,e);else if("object"===typeof e)for(var n in e)e.hasOwnProperty(n)&&e[n]&&(t+=" "+n);return t.substr(1)}"undefined"!==typeof e&&e.exports&&(e.exports=i),void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)},function(e,t){"use strict";e.exports={getColumn:function(e,t){return Array.isArray(e)?e[t]:"undefined"!==typeof Immutable?e.get(t):void 0},spliceColumn:function(e,t,r){return Array.isArray(e.columns)?e.columns.splice(t,1,r):"undefined"!==typeof Immutable&&(e.columns=e.columns.splice(t,1,r)),e},getSize:function(e){return Array.isArray(e)?e.length:"undefined"!==typeof Immutable?e.size:void 0},canEdit:function(e,t,r){return!!e&&(null!=e.editable&&"function"===typeof e.editable?!0===r&&e.editable(t):!0===r&&(!!e.editor||!!e.editable))},getValue:function(e,t){return e.toJSON&&e.get?e.get(t):e[t]}}},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var r=this[t];r[2]?e.push("@media "+r[2]+"{"+r[1]+"}"):e.push(r[1])}return e.join("")},e.i=function(t,r){"string"===typeof t&&(t=[[null,t,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];"number"===typeof o&&(n[o]=!0)}for(i=0;i<t.length;i++){var s=t[i];"number"===typeof s[0]&&n[s[0]]||(r&&!s[2]?s[2]=r:r&&(s[2]="("+s[2]+") and ("+r+")"),e.push(s))}},e}},,function(e,t,r){var n={},i=function(e){var t;return function(){return"undefined"===typeof t&&(t=e.apply(this,arguments)),t}},o=i(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),s=i(function(){return document.head||document.getElementsByTagName("head")[0]}),a=null,c=0,l=[];function u(e,t){for(var r=0;r<e.length;r++){var i=e[r],o=n[i.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](i.parts[s]);for(;s<i.parts.length;s++)o.parts.push(g(i.parts[s],t))}else{var a=[];for(s=0;s<i.parts.length;s++)a.push(g(i.parts[s],t));n[i.id]={id:i.id,refs:1,parts:a}}}}function d(e){for(var t=[],r={},n=0;n<e.length;n++){var i=e[n],o=i[0],s={css:i[1],media:i[2],sourceMap:i[3]};r[o]?r[o].parts.push(s):t.push(r[o]={id:o,parts:[s]})}return t}function h(e,t){var r=s(),n=l[l.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),l.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(t)}}function p(e){e.parentNode.removeChild(e);var t=l.indexOf(e);t>=0&&l.splice(t,1)}function f(e){var t=document.createElement("style");return t.type="text/css",h(e,t),t}function g(e,t){var r,n,i;if(t.singleton){var o=c++;r=a||(a=f(t)),n=v.bind(null,r,o,!1),i=v.bind(null,r,o,!0)}else e.sourceMap&&"function"===typeof URL&&"function"===typeof URL.createObjectURL&&"function"===typeof URL.revokeObjectURL&&"function"===typeof Blob&&"function"===typeof btoa?(r=function(e){var t=document.createElement("link");return t.rel="stylesheet",h(e,t),t}(t),n=function(e,t){var r=t.css,n=t.sourceMap;n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var i=new Blob([r],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}.bind(null,r),i=function(){p(r),r.href&&URL.revokeObjectURL(r.href)}):(r=f(t),n=function(e,t){var r=t.css,n=t.media;n&&e.setAttribute("media",n);if(e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}.bind(null,r),i=function(){p(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){"undefined"===typeof(t=t||{}).singleton&&(t.singleton=o()),"undefined"===typeof t.insertAt&&(t.insertAt="bottom");var r=d(e);return u(r,t),function(e){for(var i=[],o=0;o<r.length;o++){var s=r[o];(a=n[s.id]).refs--,i.push(a)}e&&u(d(e),t);for(o=0;o<i.length;o++){var a;if(0===(a=i[o]).refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete n[a.id]}}}};var m,y=(m=[],function(e,t){return m[e]=t,m.filter(Boolean).join("\n")});function v(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=y(t,i);else{var o=document.createTextNode(i),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(o,s[t]):e.appendChild(o)}}},function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};e.exports={selected:o.default.object.isRequired,copied:o.default.object,dragged:o.default.object,onCellClick:o.default.func.isRequired,onCellDoubleClick:o.default.func.isRequired,onCommit:o.default.func.isRequired,onCommitCancel:o.default.func.isRequired,handleDragEnterRow:o.default.func.isRequired,handleTerminateDrag:o.default.func.isRequired,getCellActions:o.default.func}},,,function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};var s={name:o.default.node.isRequired,key:o.default.string.isRequired,width:o.default.number.isRequired,filterable:o.default.bool};e.exports=s},,,function(e,t){"use strict";e.exports=function(e,t){var r={},n=t,i=Array.isArray(n),o=0;for(n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{if((o=n.next()).done)break;s=o.value}var a=s;a in e&&(r[a]=e[a])}return r}},function(e,t,r){e.exports=function(){"use strict";var e=Array.prototype.slice;function t(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function r(e){return s(e)?e:W(e)}function n(e){return a(e)?e:J(e)}function i(e){return c(e)?e:X(e)}function o(e){return s(e)&&!l(e)?e:Y(e)}function s(e){return!(!e||!e[d])}function a(e){return!(!e||!e[h])}function c(e){return!(!e||!e[p])}function l(e){return a(e)||c(e)}function u(e){return!(!e||!e[f])}t(n,r),t(i,r),t(o,r),r.isIterable=s,r.isKeyed=a,r.isIndexed=c,r.isAssociative=l,r.isOrdered=u,r.Keyed=n,r.Indexed=i,r.Set=o;var d="@@__IMMUTABLE_ITERABLE__@@",h="@@__IMMUTABLE_KEYED__@@",p="@@__IMMUTABLE_INDEXED__@@",f="@@__IMMUTABLE_ORDERED__@@",g=5,m=1<<g,y=m-1,v={},_={value:!1},w={value:!1};function S(e){return e.value=!1,e}function b(e){e&&(e.value=!0)}function x(){}function P(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),i=0;i<r;i++)n[i]=e[i+t];return n}function C(e){return void 0===e.size&&(e.size=e.__iterate(M)),e.size}function T(e,t){if("number"!==typeof t){var r=t>>>0;if(""+r!==t||4294967295===r)return NaN;t=r}return t<0?C(e)+t:t}function M(){return!0}function E(e,t,r){return(0===e||void 0!==r&&e<=-r)&&(void 0===t||void 0!==r&&t>=r)}function I(e,t){return R(e,t,0)}function A(e,t){return R(e,t,t)}function R(e,t,r){return void 0===e?r:e<0?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}var O=0,D=1,k=2,F="function"===typeof Symbol&&Symbol.iterator,N="@@iterator",L=F||N;function B(e){this.next=e}function V(e,t,r,n){var i=0===e?t:1===e?r:[t,r];return n?n.value=i:n={value:i,done:!1},n}function U(){return{value:void 0,done:!0}}function z(e){return!!H(e)}function j(e){return e&&"function"===typeof e.next}function G(e){var t=H(e);return t&&t.call(e)}function H(e){var t=e&&(F&&e[F]||e[N]);if("function"===typeof t)return t}function q(e){return e&&"number"===typeof e.length}function W(e){return null===e||void 0===e?oe():s(e)?e.toSeq():function(e){var t=ce(e)||"object"===typeof e&&new te(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}(e)}function J(e){return null===e||void 0===e?oe().toKeyedSeq():s(e)?a(e)?e.toSeq():e.fromEntrySeq():se(e)}function X(e){return null===e||void 0===e?oe():s(e)?a(e)?e.entrySeq():e.toIndexedSeq():ae(e)}function Y(e){return(null===e||void 0===e?oe():s(e)?a(e)?e.entrySeq():e:ae(e)).toSetSeq()}B.prototype.toString=function(){return"[Iterator]"},B.KEYS=O,B.VALUES=D,B.ENTRIES=k,B.prototype.inspect=B.prototype.toSource=function(){return this.toString()},B.prototype[L]=function(){return this},t(W,r),W.of=function(){return W(arguments)},W.prototype.toSeq=function(){return this},W.prototype.toString=function(){return this.__toString("Seq {","}")},W.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},W.prototype.__iterate=function(e,t){return le(this,e,t,!0)},W.prototype.__iterator=function(e,t){return ue(this,e,t,!0)},t(J,W),J.prototype.toKeyedSeq=function(){return this},t(X,W),X.of=function(){return X(arguments)},X.prototype.toIndexedSeq=function(){return this},X.prototype.toString=function(){return this.__toString("Seq [","]")},X.prototype.__iterate=function(e,t){return le(this,e,t,!1)},X.prototype.__iterator=function(e,t){return ue(this,e,t,!1)},t(Y,W),Y.of=function(){return Y(arguments)},Y.prototype.toSetSeq=function(){return this},W.isSeq=ie,W.Keyed=J,W.Set=Y,W.Indexed=X;var K,Z,Q,$="@@__IMMUTABLE_SEQ__@@";function ee(e){this._array=e,this.size=e.length}function te(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function re(e){this._iterable=e,this.size=e.length||e.size}function ne(e){this._iterator=e,this._iteratorCache=[]}function ie(e){return!(!e||!e[$])}function oe(){return K||(K=new ee([]))}function se(e){var t=Array.isArray(e)?new ee(e).fromEntrySeq():j(e)?new ne(e).fromEntrySeq():z(e)?new re(e).fromEntrySeq():"object"===typeof e?new te(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function ae(e){var t=ce(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function ce(e){return q(e)?new ee(e):j(e)?new ne(e):z(e)?new re(e):void 0}function le(e,t,r,n){var i=e._cache;if(i){for(var o=i.length-1,s=0;s<=o;s++){var a=i[r?o-s:s];if(!1===t(a[1],n?a[0]:s,e))return s+1}return s}return e.__iterateUncached(t,r)}function ue(e,t,r,n){var i=e._cache;if(i){var o=i.length-1,s=0;return new B(function(){var e=i[r?o-s:s];return s++>o?{value:void 0,done:!0}:V(t,n?e[0]:s-1,e[1])})}return e.__iteratorUncached(t,r)}function de(e,t){return t?function e(t,r,n,i){return Array.isArray(r)?t.call(i,n,X(r).map(function(n,i){return e(t,n,i,r)})):pe(r)?t.call(i,n,J(r).map(function(n,i){return e(t,n,i,r)})):r}(t,e,"",{"":e}):he(e)}function he(e){return Array.isArray(e)?X(e).map(he).toList():pe(e)?J(e).map(he).toMap():e}function pe(e){return e&&(e.constructor===Object||void 0===e.constructor)}function fe(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if("function"===typeof e.valueOf&&"function"===typeof t.valueOf){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!("function"!==typeof e.equals||"function"!==typeof t.equals||!e.equals(t))}function ge(e,t){if(e===t)return!0;if(!s(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||a(e)!==a(t)||c(e)!==c(t)||u(e)!==u(t))return!1;if(0===e.size&&0===t.size)return!0;var r=!l(e);if(u(e)){var n=e.entries();return t.every(function(e,t){var i=n.next().value;return i&&fe(i[1],e)&&(r||fe(i[0],t))})&&n.next().done}var i=!1;if(void 0===e.size)if(void 0===t.size)"function"===typeof e.cacheResult&&e.cacheResult();else{i=!0;var o=e;e=t,t=o}var d=!0,h=t.__iterate(function(t,n){if(r?!e.has(t):i?!fe(t,e.get(n,v)):!fe(e.get(n,v),t))return d=!1,!1});return d&&e.size===h}function me(e,t){if(!(this instanceof me))return new me(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(Z)return Z;Z=this}}function ye(e,t){if(!e)throw new Error(t)}function ve(e,t,r){if(!(this instanceof ve))return new ve(e,t,r);if(ye(0!==r,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),r=void 0===r?1:Math.abs(r),t<e&&(r=-r),this._start=e,this._end=t,this._step=r,this.size=Math.max(0,Math.ceil((t-e)/r-1)+1),0===this.size){if(Q)return Q;Q=this}}function _e(){throw TypeError("Abstract")}function we(){}function Se(){}function be(){}W.prototype[$]=!0,t(ee,X),ee.prototype.get=function(e,t){return this.has(e)?this._array[T(this,e)]:t},ee.prototype.__iterate=function(e,t){for(var r=this._array,n=r.length-1,i=0;i<=n;i++)if(!1===e(r[t?n-i:i],i,this))return i+1;return i},ee.prototype.__iterator=function(e,t){var r=this._array,n=r.length-1,i=0;return new B(function(){return i>n?{value:void 0,done:!0}:V(e,i,r[t?n-i++:i++])})},t(te,J),te.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},te.prototype.has=function(e){return this._object.hasOwnProperty(e)},te.prototype.__iterate=function(e,t){for(var r=this._object,n=this._keys,i=n.length-1,o=0;o<=i;o++){var s=n[t?i-o:o];if(!1===e(r[s],s,this))return o+1}return o},te.prototype.__iterator=function(e,t){var r=this._object,n=this._keys,i=n.length-1,o=0;return new B(function(){var s=n[t?i-o:o];return o++>i?{value:void 0,done:!0}:V(e,s,r[s])})},te.prototype[f]=!0,t(re,X),re.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var r=this._iterable,n=G(r),i=0;if(j(n))for(var o;!(o=n.next()).done&&!1!==e(o.value,i++,this););return i},re.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var r=this._iterable,n=G(r);if(!j(n))return new B(U);var i=0;return new B(function(){var t=n.next();return t.done?t:V(e,i++,t.value)})},t(ne,X),ne.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var r,n=this._iterator,i=this._iteratorCache,o=0;o<i.length;)if(!1===e(i[o],o++,this))return o;for(;!(r=n.next()).done;){var s=r.value;if(i[o]=s,!1===e(s,o++,this))break}return o},ne.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var r=this._iterator,n=this._iteratorCache,i=0;return new B(function(){if(i>=n.length){var t=r.next();if(t.done)return t;n[i]=t.value}return V(e,i,n[i++])})},t(me,X),me.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},me.prototype.get=function(e,t){return this.has(e)?this._value:t},me.prototype.includes=function(e){return fe(this._value,e)},me.prototype.slice=function(e,t){var r=this.size;return E(e,t,r)?this:new me(this._value,A(t,r)-I(e,r))},me.prototype.reverse=function(){return this},me.prototype.indexOf=function(e){return fe(this._value,e)?0:-1},me.prototype.lastIndexOf=function(e){return fe(this._value,e)?this.size:-1},me.prototype.__iterate=function(e,t){for(var r=0;r<this.size;r++)if(!1===e(this._value,r,this))return r+1;return r},me.prototype.__iterator=function(e,t){var r=this,n=0;return new B(function(){return n<r.size?V(e,n++,r._value):{value:void 0,done:!0}})},me.prototype.equals=function(e){return e instanceof me?fe(this._value,e._value):ge(e)},t(ve,X),ve.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},ve.prototype.get=function(e,t){return this.has(e)?this._start+T(this,e)*this._step:t},ve.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},ve.prototype.slice=function(e,t){return E(e,t,this.size)?this:(e=I(e,this.size),(t=A(t,this.size))<=e?new ve(0,0):new ve(this.get(e,this._end),this.get(t,this._end),this._step))},ve.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step===0){var r=t/this._step;if(r>=0&&r<this.size)return r}return-1},ve.prototype.lastIndexOf=function(e){return this.indexOf(e)},ve.prototype.__iterate=function(e,t){for(var r=this.size-1,n=this._step,i=t?this._start+r*n:this._start,o=0;o<=r;o++){if(!1===e(i,o,this))return o+1;i+=t?-n:n}return o},ve.prototype.__iterator=function(e,t){var r=this.size-1,n=this._step,i=t?this._start+r*n:this._start,o=0;return new B(function(){var s=i;return i+=t?-n:n,o>r?{value:void 0,done:!0}:V(e,o++,s)})},ve.prototype.equals=function(e){return e instanceof ve?this._start===e._start&&this._end===e._end&&this._step===e._step:ge(this,e)},t(_e,r),t(we,_e),t(Se,_e),t(be,_e),_e.Keyed=we,_e.Indexed=Se,_e.Set=be;var xe="function"===typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){var r=65535&(e|=0),n=65535&(t|=0);return r*n+((e>>>16)*n+r*(t>>>16)<<16>>>0)|0};function Pe(e){return e>>>1&1073741824|3221225471&e}function Ce(e){if(!1===e||null===e||void 0===e)return 0;if("function"===typeof e.valueOf&&(!1===(e=e.valueOf())||null===e||void 0===e))return 0;if(!0===e)return 1;var t,r,n=typeof e;if("number"===n){if(e!==e||e===1/0)return 0;var i=0|e;for(i!==e&&(i^=4294967295*e);e>4294967295;)i^=e/=4294967295;return Pe(i)}if("string"===n)return e.length>De?(void 0===(r=Ne[t=e])&&(r=Te(t),Fe===ke&&(Fe=0,Ne={}),Fe++,Ne[t]=r),r):Te(e);if("function"===typeof e.hashCode)return e.hashCode();if("object"===n)return function(e){var t;if(Ae&&void 0!==(t=Me.get(e)))return t;if(void 0!==(t=e[Oe]))return t;if(!Ie){if(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Oe]))return t;if(void 0!==(t=function(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e)))return t}if(t=++Re,1073741824&Re&&(Re=0),Ae)Me.set(e,t);else{if(void 0!==Ee&&!1===Ee(e))throw new Error("Non-extensible objects are not allowed as keys.");if(Ie)Object.defineProperty(e,Oe,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Oe]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Oe]=t}}return t}(e);if("function"===typeof e.toString)return Te(e.toString());throw new Error("Value type "+n+" cannot be hashed.")}function Te(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return Pe(t)}var Me,Ee=Object.isExtensible,Ie=function(){try{return Object.defineProperty({},"@",{}),!0}catch(e){return!1}}(),Ae="function"===typeof WeakMap;Ae&&(Me=new WeakMap);var Re=0,Oe="__immutablehash__";"function"===typeof Symbol&&(Oe=Symbol(Oe));var De=16,ke=255,Fe=0,Ne={};function Le(e){ye(e!==1/0,"Cannot perform this action with an infinite size.")}function Be(e){return null===e||void 0===e?Qe():Ve(e)&&!u(e)?e:Qe().withMutations(function(t){var r=n(e);Le(r.size),r.forEach(function(e,r){return t.set(r,e)})})}function Ve(e){return!(!e||!e[ze])}t(Be,we),Be.of=function(){var t=e.call(arguments,0);return Qe().withMutations(function(e){for(var r=0;r<t.length;r+=2){if(r+1>=t.length)throw new Error("Missing value for key: "+t[r]);e.set(t[r],t[r+1])}})},Be.prototype.toString=function(){return this.__toString("Map {","}")},Be.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},Be.prototype.set=function(e,t){return $e(this,e,t)},Be.prototype.setIn=function(e,t){return this.updateIn(e,v,function(){return t})},Be.prototype.remove=function(e){return $e(this,e,v)},Be.prototype.deleteIn=function(e){return this.updateIn(e,function(){return v})},Be.prototype.update=function(e,t,r){return 1===arguments.length?e(this):this.updateIn([e],t,r)},Be.prototype.updateIn=function(e,t,r){r||(r=t,t=void 0);var n=function e(t,r,n,i){var o=t===v,s=r.next();if(s.done){var a=o?n:t,c=i(a);return c===a?t:c}ye(o||t&&t.set,"invalid keyPath");var l=s.value,u=o?v:t.get(l,v),d=e(u,r,n,i);return d===u?t:d===v?t.remove(l):(o?Qe():t).set(l,d)}(this,rr(e),t,r);return n===v?void 0:n},Be.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Qe()},Be.prototype.merge=function(){return nt(this,void 0,arguments)},Be.prototype.mergeWith=function(t){var r=e.call(arguments,1);return nt(this,t,r)},Be.prototype.mergeIn=function(t){var r=e.call(arguments,1);return this.updateIn(t,Qe(),function(e){return"function"===typeof e.merge?e.merge.apply(e,r):r[r.length-1]})},Be.prototype.mergeDeep=function(){return nt(this,it,arguments)},Be.prototype.mergeDeepWith=function(t){var r=e.call(arguments,1);return nt(this,ot(t),r)},Be.prototype.mergeDeepIn=function(t){var r=e.call(arguments,1);return this.updateIn(t,Qe(),function(e){return"function"===typeof e.mergeDeep?e.mergeDeep.apply(e,r):r[r.length-1]})},Be.prototype.sort=function(e){return It(qt(this,e))},Be.prototype.sortBy=function(e,t){return It(qt(this,t,e))},Be.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},Be.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new x)},Be.prototype.asImmutable=function(){return this.__ensureOwner()},Be.prototype.wasAltered=function(){return this.__altered},Be.prototype.__iterator=function(e,t){return new Xe(this,e,t)},Be.prototype.__iterate=function(e,t){var r=this,n=0;return this._root&&this._root.iterate(function(t){return n++,e(t[1],t[0],r)},t),n},Be.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Ze(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Be.isMap=Ve;var Ue,ze="@@__IMMUTABLE_MAP__@@",je=Be.prototype;function Ge(e,t){this.ownerID=e,this.entries=t}function He(e,t,r){this.ownerID=e,this.bitmap=t,this.nodes=r}function qe(e,t,r){this.ownerID=e,this.count=t,this.nodes=r}function We(e,t,r){this.ownerID=e,this.keyHash=t,this.entries=r}function Je(e,t,r){this.ownerID=e,this.keyHash=t,this.entry=r}function Xe(e,t,r){this._type=t,this._reverse=r,this._stack=e._root&&Ke(e._root)}function Ye(e,t){return V(e,t[0],t[1])}function Ke(e,t){return{node:e,index:0,__prev:t}}function Ze(e,t,r,n){var i=Object.create(je);return i.size=e,i._root=t,i.__ownerID=r,i.__hash=n,i.__altered=!1,i}function Qe(){return Ue||(Ue=Ze(0))}function $e(e,t,r){var n,i;if(e._root){var o=S(_),s=S(w);if(n=et(e._root,e.__ownerID,0,void 0,t,r,o,s),!s.value)return e;i=e.size+(o.value?r===v?-1:1:0)}else{if(r===v)return e;i=1,n=new Ge(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=i,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?Ze(i,n):Qe()}function et(e,t,r,n,i,o,s,a){return e?e.update(t,r,n,i,o,s,a):o===v?e:(b(a),b(s),new Je(t,n,[i,o]))}function tt(e){return e.constructor===Je||e.constructor===We}function rt(e,t,r,n,i){if(e.keyHash===n)return new We(t,n,[e.entry,i]);var o,s=(0===r?e.keyHash:e.keyHash>>>r)&y,a=(0===r?n:n>>>r)&y,c=s===a?[rt(e,t,r+g,n,i)]:(o=new Je(t,n,i),s<a?[e,o]:[o,e]);return new He(t,1<<s|1<<a,c)}function nt(e,t,r){for(var i=[],o=0;o<r.length;o++){var a=r[o],c=n(a);s(a)||(c=c.map(function(e){return de(e)})),i.push(c)}return st(e,t,i)}function it(e,t,r){return e&&e.mergeDeep&&s(t)?e.mergeDeep(t):fe(e,t)?e:t}function ot(e){return function(t,r,n){if(t&&t.mergeDeepWith&&s(r))return t.mergeDeepWith(e,r);var i=e(t,r,n);return fe(t,i)?t:i}}function st(e,t,r){return 0===(r=r.filter(function(e){return 0!==e.size})).length?e:0!==e.size||e.__ownerID||1!==r.length?e.withMutations(function(e){for(var n=t?function(r,n){e.update(n,v,function(e){return e===v?r:t(e,r,n)})}:function(t,r){e.set(r,t)},i=0;i<r.length;i++)r[i].forEach(n)}):e.constructor(r[0])}function at(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function ct(e,t,r,n){var i=n?e:P(e);return i[t]=r,i}je[ze]=!0,je.delete=je.remove,je.removeIn=je.deleteIn,Ge.prototype.get=function(e,t,r,n){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(fe(r,i[o][0]))return i[o][1];return n},Ge.prototype.update=function(e,t,r,n,i,o,s){for(var a=i===v,c=this.entries,l=0,u=c.length;l<u&&!fe(n,c[l][0]);l++);var d=l<u;if(d?c[l][1]===i:a)return this;if(b(s),(a||!d)&&b(o),!a||1!==c.length){if(!d&&!a&&c.length>=lt)return function(e,t,r,n){e||(e=new x);for(var i=new Je(e,Ce(r),[r,n]),o=0;o<t.length;o++){var s=t[o];i=i.update(e,0,void 0,s[0],s[1])}return i}(e,c,n,i);var h=e&&e===this.ownerID,p=h?c:P(c);return d?a?l===u-1?p.pop():p[l]=p.pop():p[l]=[n,i]:p.push([n,i]),h?(this.entries=p,this):new Ge(e,p)}},He.prototype.get=function(e,t,r,n){void 0===t&&(t=Ce(r));var i=1<<((0===e?t:t>>>e)&y),o=this.bitmap;return 0===(o&i)?n:this.nodes[at(o&i-1)].get(e+g,t,r,n)},He.prototype.update=function(e,t,r,n,i,o,s){void 0===r&&(r=Ce(n));var a=(0===t?r:r>>>t)&y,c=1<<a,l=this.bitmap,u=0!==(l&c);if(!u&&i===v)return this;var d=at(l&c-1),h=this.nodes,p=u?h[d]:void 0,f=et(p,e,t+g,r,n,i,o,s);if(f===p)return this;if(!u&&f&&h.length>=ut)return function(e,t,r,n,i){for(var o=0,s=new Array(m),a=0;0!==r;a++,r>>>=1)s[a]=1&r?t[o++]:void 0;return s[n]=i,new qe(e,o+1,s)}(e,h,l,a,f);if(u&&!f&&2===h.length&&tt(h[1^d]))return h[1^d];if(u&&f&&1===h.length&&tt(f))return f;var _=e&&e===this.ownerID,w=u?f?l:l^c:l|c,S=u?f?ct(h,d,f,_):function(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var i=new Array(n),o=0,s=0;s<n;s++)s===t&&(o=1),i[s]=e[s+o];return i}(h,d,_):function(e,t,r,n){var i=e.length+1;if(n&&t+1===i)return e[t]=r,e;for(var o=new Array(i),s=0,a=0;a<i;a++)a===t?(o[a]=r,s=-1):o[a]=e[a+s];return o}(h,d,f,_);return _?(this.bitmap=w,this.nodes=S,this):new He(e,w,S)},qe.prototype.get=function(e,t,r,n){void 0===t&&(t=Ce(r));var i=(0===e?t:t>>>e)&y,o=this.nodes[i];return o?o.get(e+g,t,r,n):n},qe.prototype.update=function(e,t,r,n,i,o,s){void 0===r&&(r=Ce(n));var a=(0===t?r:r>>>t)&y,c=i===v,l=this.nodes,u=l[a];if(c&&!u)return this;var d=et(u,e,t+g,r,n,i,o,s);if(d===u)return this;var h=this.count;if(u){if(!d&&--h<dt)return function(e,t,r,n){for(var i=0,o=0,s=new Array(r),a=0,c=1,l=t.length;a<l;a++,c<<=1){var u=t[a];void 0!==u&&a!==n&&(i|=c,s[o++]=u)}return new He(e,i,s)}(e,l,h,a)}else h++;var p=e&&e===this.ownerID,f=ct(l,a,d,p);return p?(this.count=h,this.nodes=f,this):new qe(e,h,f)},We.prototype.get=function(e,t,r,n){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(fe(r,i[o][0]))return i[o][1];return n},We.prototype.update=function(e,t,r,n,i,o,s){void 0===r&&(r=Ce(n));var a=i===v;if(r!==this.keyHash)return a?this:(b(s),b(o),rt(this,e,t,r,[n,i]));for(var c=this.entries,l=0,u=c.length;l<u&&!fe(n,c[l][0]);l++);var d=l<u;if(d?c[l][1]===i:a)return this;if(b(s),(a||!d)&&b(o),a&&2===u)return new Je(e,this.keyHash,c[1^l]);var h=e&&e===this.ownerID,p=h?c:P(c);return d?a?l===u-1?p.pop():p[l]=p.pop():p[l]=[n,i]:p.push([n,i]),h?(this.entries=p,this):new We(e,this.keyHash,p)},Je.prototype.get=function(e,t,r,n){return fe(r,this.entry[0])?this.entry[1]:n},Je.prototype.update=function(e,t,r,n,i,o,s){var a=i===v,c=fe(n,this.entry[0]);return(c?i===this.entry[1]:a)?this:(b(s),a?void b(o):c?e&&e===this.ownerID?(this.entry[1]=i,this):new Je(e,this.keyHash,[n,i]):(b(o),rt(this,e,t,Ce(n),[n,i])))},Ge.prototype.iterate=We.prototype.iterate=function(e,t){for(var r=this.entries,n=0,i=r.length-1;n<=i;n++)if(!1===e(r[t?i-n:n]))return!1},He.prototype.iterate=qe.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,i=r.length-1;n<=i;n++){var o=r[t?i-n:n];if(o&&!1===o.iterate(e,t))return!1}},Je.prototype.iterate=function(e,t){return e(this.entry)},t(Xe,B),Xe.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var r,n=t.node,i=t.index++;if(n.entry){if(0===i)return Ye(e,n.entry)}else if(n.entries){if(r=n.entries.length-1,i<=r)return Ye(e,n.entries[this._reverse?r-i:i])}else if(r=n.nodes.length-1,i<=r){var o=n.nodes[this._reverse?r-i:i];if(o){if(o.entry)return Ye(e,o.entry);t=this._stack=Ke(o,t)}continue}t=this._stack=this._stack.__prev}return{value:void 0,done:!0}};var lt=m/4,ut=m/2,dt=m/4;function ht(e){var t=bt();if(null===e||void 0===e)return t;if(pt(e))return e;var r=i(e),n=r.size;return 0===n?t:(Le(n),n>0&&n<m?St(0,n,g,null,new mt(r.toArray())):t.withMutations(function(e){e.setSize(n),r.forEach(function(t,r){return e.set(r,t)})}))}function pt(e){return!(!e||!e[ft])}t(ht,Se),ht.of=function(){return this(arguments)},ht.prototype.toString=function(){return this.__toString("List [","]")},ht.prototype.get=function(e,t){if((e=T(this,e))>=0&&e<this.size){var r=Ct(this,e+=this._origin);return r&&r.array[e&y]}return t},ht.prototype.set=function(e,t){return function(e,t,r){if((t=T(e,t))!==t)return e;if(t>=e.size||t<0)return e.withMutations(function(e){t<0?Tt(e,t).set(0,r):Tt(e,0,t+1).set(t,r)});t+=e._origin;var n=e._tail,i=e._root,o=S(w);return t>=Et(e._capacity)?n=xt(n,e.__ownerID,0,t,r,o):i=xt(i,e.__ownerID,e._level,t,r,o),o.value?e.__ownerID?(e._root=i,e._tail=n,e.__hash=void 0,e.__altered=!0,e):St(e._origin,e._capacity,e._level,i,n):e}(this,e,t)},ht.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},ht.prototype.insert=function(e,t){return this.splice(e,0,t)},ht.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=g,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):bt()},ht.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(r){Tt(r,0,t+e.length);for(var n=0;n<e.length;n++)r.set(t+n,e[n])})},ht.prototype.pop=function(){return Tt(this,0,-1)},ht.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){Tt(t,-e.length);for(var r=0;r<e.length;r++)t.set(r,e[r])})},ht.prototype.shift=function(){return Tt(this,1)},ht.prototype.merge=function(){return Mt(this,void 0,arguments)},ht.prototype.mergeWith=function(t){var r=e.call(arguments,1);return Mt(this,t,r)},ht.prototype.mergeDeep=function(){return Mt(this,it,arguments)},ht.prototype.mergeDeepWith=function(t){var r=e.call(arguments,1);return Mt(this,ot(t),r)},ht.prototype.setSize=function(e){return Tt(this,0,e)},ht.prototype.slice=function(e,t){var r=this.size;return E(e,t,r)?this:Tt(this,I(e,r),A(t,r))},ht.prototype.__iterator=function(e,t){var r=0,n=wt(this,t);return new B(function(){var t=n();return t===_t?{value:void 0,done:!0}:V(e,r++,t)})},ht.prototype.__iterate=function(e,t){for(var r,n=0,i=wt(this,t);(r=i())!==_t&&!1!==e(r,n++,this););return n},ht.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?St(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},ht.isList=pt;var ft="@@__IMMUTABLE_LIST__@@",gt=ht.prototype;function mt(e,t){this.array=e,this.ownerID=t}gt[ft]=!0,gt.delete=gt.remove,gt.setIn=je.setIn,gt.deleteIn=gt.removeIn=je.removeIn,gt.update=je.update,gt.updateIn=je.updateIn,gt.mergeIn=je.mergeIn,gt.mergeDeepIn=je.mergeDeepIn,gt.withMutations=je.withMutations,gt.asMutable=je.asMutable,gt.asImmutable=je.asImmutable,gt.wasAltered=je.wasAltered,mt.prototype.removeBefore=function(e,t,r){if(r===t?1<<t:0===this.array.length)return this;var n=r>>>t&y;if(n>=this.array.length)return new mt([],e);var i,o=0===n;if(t>0){var s=this.array[n];if((i=s&&s.removeBefore(e,t-g,r))===s&&o)return this}if(o&&!i)return this;var a=Pt(this,e);if(!o)for(var c=0;c<n;c++)a.array[c]=void 0;return i&&(a.array[n]=i),a},mt.prototype.removeAfter=function(e,t,r){if(r===(t?1<<t:0)||0===this.array.length)return this;var n,i=r-1>>>t&y;if(i>=this.array.length)return this;if(t>0){var o=this.array[i];if((n=o&&o.removeAfter(e,t-g,r))===o&&i===this.array.length-1)return this}var s=Pt(this,e);return s.array.splice(i+1),n&&(s.array[i]=n),s};var yt,vt,_t={};function wt(e,t){var r=e._origin,n=e._capacity,i=Et(n),o=e._tail;return s(e._root,e._level,0);function s(e,a,c){return 0===a?function(e,s){var a=s===i?o&&o.array:e&&e.array,c=s>r?0:r-s,l=n-s;return l>m&&(l=m),function(){if(c===l)return _t;var e=t?--l:c++;return a&&a[e]}}(e,c):function(e,i,o){var a,c=e&&e.array,l=o>r?0:r-o>>i,u=1+(n-o>>i);return u>m&&(u=m),function(){for(;;){if(a){var e=a();if(e!==_t)return e;a=null}if(l===u)return _t;var r=t?--u:l++;a=s(c&&c[r],i-g,o+(r<<i))}}}(e,a,c)}}function St(e,t,r,n,i,o,s){var a=Object.create(gt);return a.size=t-e,a._origin=e,a._capacity=t,a._level=r,a._root=n,a._tail=i,a.__ownerID=o,a.__hash=s,a.__altered=!1,a}function bt(){return yt||(yt=St(0,0,g))}function xt(e,t,r,n,i,o){var s,a=n>>>r&y,c=e&&a<e.array.length;if(!c&&void 0===i)return e;if(r>0){var l=e&&e.array[a],u=xt(l,t,r-g,n,i,o);return u===l?e:((s=Pt(e,t)).array[a]=u,s)}return c&&e.array[a]===i?e:(b(o),s=Pt(e,t),void 0===i&&a===s.array.length-1?s.array.pop():s.array[a]=i,s)}function Pt(e,t){return t&&e&&t===e.ownerID?e:new mt(e?e.array.slice():[],t)}function Ct(e,t){if(t>=Et(e._capacity))return e._tail;if(t<1<<e._level+g){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&y],n-=g;return r}}function Tt(e,t,r){void 0!==t&&(t|=0),void 0!==r&&(r|=0);var n=e.__ownerID||new x,i=e._origin,o=e._capacity,s=i+t,a=void 0===r?o:r<0?o+r:i+r;if(s===i&&a===o)return e;if(s>=a)return e.clear();for(var c=e._level,l=e._root,u=0;s+u<0;)l=new mt(l&&l.array.length?[void 0,l]:[],n),u+=1<<(c+=g);u&&(s+=u,i+=u,a+=u,o+=u);for(var d=Et(o),h=Et(a);h>=1<<c+g;)l=new mt(l&&l.array.length?[l]:[],n),c+=g;var p=e._tail,f=h<d?Ct(e,a-1):h>d?new mt([],n):p;if(p&&h>d&&s<o&&p.array.length){for(var m=l=Pt(l,n),v=c;v>g;v-=g){var _=d>>>v&y;m=m.array[_]=Pt(m.array[_],n)}m.array[d>>>g&y]=p}if(a<o&&(f=f&&f.removeAfter(n,0,a)),s>=h)s-=h,a-=h,c=g,l=null,f=f&&f.removeBefore(n,0,s);else if(s>i||h<d){for(u=0;l;){var w=s>>>c&y;if(w!==h>>>c&y)break;w&&(u+=(1<<c)*w),c-=g,l=l.array[w]}l&&s>i&&(l=l.removeBefore(n,c,s-u)),l&&h<d&&(l=l.removeAfter(n,c,h-u)),u&&(s-=u,a-=u)}return e.__ownerID?(e.size=a-s,e._origin=s,e._capacity=a,e._level=c,e._root=l,e._tail=f,e.__hash=void 0,e.__altered=!0,e):St(s,a,c,l,f)}function Mt(e,t,r){for(var n=[],o=0,a=0;a<r.length;a++){var c=r[a],l=i(c);l.size>o&&(o=l.size),s(c)||(l=l.map(function(e){return de(e)})),n.push(l)}return o>e.size&&(e=e.setSize(o)),st(e,t,n)}function Et(e){return e<m?0:e-1>>>g<<g}function It(e){return null===e||void 0===e?Ot():At(e)?e:Ot().withMutations(function(t){var r=n(e);Le(r.size),r.forEach(function(e,r){return t.set(r,e)})})}function At(e){return Ve(e)&&u(e)}function Rt(e,t,r,n){var i=Object.create(It.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=r,i.__hash=n,i}function Ot(){return vt||(vt=Rt(Qe(),bt()))}function Dt(e,t,r){var n,i,o=e._map,s=e._list,a=o.get(t),c=void 0!==a;if(r===v){if(!c)return e;s.size>=m&&s.size>=2*o.size?(i=s.filter(function(e,t){return void 0!==e&&a!==t}),n=i.toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(n.__ownerID=i.__ownerID=e.__ownerID)):(n=o.remove(t),i=a===s.size-1?s.pop():s.set(a,void 0))}else if(c){if(r===s.get(a)[1])return e;n=o,i=s.set(a,[t,r])}else n=o.set(t,s.size),i=s.set(s.size,[t,r]);return e.__ownerID?(e.size=n.size,e._map=n,e._list=i,e.__hash=void 0,e):Rt(n,i)}function kt(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function Ft(e){this._iter=e,this.size=e.size}function Nt(e){this._iter=e,this.size=e.size}function Lt(e){this._iter=e,this.size=e.size}function Bt(e){var t=$t(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=er,t.__iterateUncached=function(t,r){var n=this;return e.__iterate(function(e,r){return!1!==t(r,e,n)},r)},t.__iteratorUncached=function(t,r){if(t===k){var n=e.__iterator(t,r);return new B(function(){var e=n.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===D?O:D,r)},t}function Vt(e,t,r){var n=$t(e);return n.size=e.size,n.has=function(t){return e.has(t)},n.get=function(n,i){var o=e.get(n,v);return o===v?i:t.call(r,o,n,e)},n.__iterateUncached=function(n,i){var o=this;return e.__iterate(function(e,i,s){return!1!==n(t.call(r,e,i,s),i,o)},i)},n.__iteratorUncached=function(n,i){var o=e.__iterator(k,i);return new B(function(){var i=o.next();if(i.done)return i;var s=i.value,a=s[0];return V(n,a,t.call(r,s[1],a,e),i)})},n}function Ut(e,t){var r=$t(e);return r._iter=e,r.size=e.size,r.reverse=function(){return e},e.flip&&(r.flip=function(){var t=Bt(e);return t.reverse=function(){return e.flip()},t}),r.get=function(r,n){return e.get(t?r:-1-r,n)},r.has=function(r){return e.has(t?r:-1-r)},r.includes=function(t){return e.includes(t)},r.cacheResult=er,r.__iterate=function(t,r){var n=this;return e.__iterate(function(e,r){return t(e,r,n)},!r)},r.__iterator=function(t,r){return e.__iterator(t,!r)},r}function zt(e,t,r,n){var i=$t(e);return n&&(i.has=function(n){var i=e.get(n,v);return i!==v&&!!t.call(r,i,n,e)},i.get=function(n,i){var o=e.get(n,v);return o!==v&&t.call(r,o,n,e)?o:i}),i.__iterateUncached=function(i,o){var s=this,a=0;return e.__iterate(function(e,o,c){if(t.call(r,e,o,c))return a++,i(e,n?o:a-1,s)},o),a},i.__iteratorUncached=function(i,o){var s=e.__iterator(k,o),a=0;return new B(function(){for(;;){var o=s.next();if(o.done)return o;var c=o.value,l=c[0],u=c[1];if(t.call(r,u,l,e))return V(i,n?l:a++,u,o)}})},i}function jt(e,t,r,n){var i=e.size;if(void 0!==t&&(t|=0),void 0!==r&&(r===1/0?r=i:r|=0),E(t,r,i))return e;var o=I(t,i),s=A(r,i);if(o!==o||s!==s)return jt(e.toSeq().cacheResult(),t,r,n);var a,c=s-o;c===c&&(a=c<0?0:c);var l=$t(e);return l.size=0===a?a:e.size&&a||void 0,!n&&ie(e)&&a>=0&&(l.get=function(t,r){return(t=T(this,t))>=0&&t<a?e.get(t+o,r):r}),l.__iterateUncached=function(t,r){var i=this;if(0===a)return 0;if(r)return this.cacheResult().__iterate(t,r);var s=0,c=!0,l=0;return e.__iterate(function(e,r){if(!c||!(c=s++<o))return l++,!1!==t(e,n?r:l-1,i)&&l!==a}),l},l.__iteratorUncached=function(t,r){if(0!==a&&r)return this.cacheResult().__iterator(t,r);var i=0!==a&&e.__iterator(t,r),s=0,c=0;return new B(function(){for(;s++<o;)i.next();if(++c>a)return{value:void 0,done:!0};var e=i.next();return n||t===D?e:V(t,c-1,t===O?void 0:e.value[1],e)})},l}function Gt(e,t,r,n){var i=$t(e);return i.__iterateUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterate(i,o);var a=!0,c=0;return e.__iterate(function(e,o,l){if(!a||!(a=t.call(r,e,o,l)))return c++,i(e,n?o:c-1,s)}),c},i.__iteratorUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterator(i,o);var a=e.__iterator(k,o),c=!0,l=0;return new B(function(){var e,o,u;do{if((e=a.next()).done)return n||i===D?e:V(i,l++,i===O?void 0:e.value[1],e);var d=e.value;o=d[0],u=d[1],c&&(c=t.call(r,u,o,s))}while(c);return i===k?e:V(i,o,u,e)})},i}function Ht(e,t,r){var n=$t(e);return n.__iterateUncached=function(n,i){var o=0,a=!1;return function e(c,l){var u=this;c.__iterate(function(i,c){return(!t||l<t)&&s(i)?e(i,l+1):!1===n(i,r?c:o++,u)&&(a=!0),!a},i)}(e,0),o},n.__iteratorUncached=function(n,i){var o=e.__iterator(n,i),a=[],c=0;return new B(function(){for(;o;){var e=o.next();if(!1===e.done){var l=e.value;if(n===k&&(l=l[1]),t&&!(a.length<t)||!s(l))return r?e:V(n,c++,l,e);a.push(o),o=l.__iterator(n,i)}else o=a.pop()}return{value:void 0,done:!0}})},n}function qt(e,t,r){t||(t=tr);var n=a(e),i=0,o=e.toSeq().map(function(t,n){return[n,t,i++,r?r(t,n,e):t]}).toArray();return o.sort(function(e,r){return t(e[3],r[3])||e[2]-r[2]}).forEach(n?function(e,t){o[t].length=2}:function(e,t){o[t]=e[1]}),n?J(o):c(e)?X(o):Y(o)}function Wt(e,t,r){if(t||(t=tr),r){var n=e.toSeq().map(function(t,n){return[t,r(t,n,e)]}).reduce(function(e,r){return Jt(t,e[1],r[1])?r:e});return n&&n[0]}return e.reduce(function(e,r){return Jt(t,e,r)?r:e})}function Jt(e,t,r){var n=e(r,t);return 0===n&&r!==t&&(void 0===r||null===r||r!==r)||n>0}function Xt(e,t,n){var i=$t(e);return i.size=new ee(n).map(function(e){return e.size}).min(),i.__iterate=function(e,t){for(var r,n=this.__iterator(D,t),i=0;!(r=n.next()).done&&!1!==e(r.value,i++,this););return i},i.__iteratorUncached=function(e,i){var o=n.map(function(e){return e=r(e),G(i?e.reverse():e)}),s=0,a=!1;return new B(function(){var r;return a||(r=o.map(function(e){return e.next()}),a=r.some(function(e){return e.done})),a?{value:void 0,done:!0}:V(e,s++,t.apply(null,r.map(function(e){return e.value})))})},i}function Yt(e,t){return ie(e)?t:e.constructor(t)}function Kt(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function Zt(e){return Le(e.size),C(e)}function Qt(e){return a(e)?n:c(e)?i:o}function $t(e){return Object.create((a(e)?J:c(e)?X:Y).prototype)}function er(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):W.prototype.cacheResult.call(this)}function tr(e,t){return e>t?1:e<t?-1:0}function rr(e){var t=G(e);if(!t){if(!q(e))throw new TypeError("Expected iterable or array-like: "+e);t=G(r(e))}return t}function nr(e,t){var r,n=function(o){if(o instanceof n)return o;if(!(this instanceof n))return new n(o);if(!r){r=!0;var s=Object.keys(e);!function(e,t){try{t.forEach(function(e,t){Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){ye(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}.bind(void 0,e))}catch(e){}}(i,s),i.size=s.length,i._name=t,i._keys=s,i._defaultValues=e}this._map=Be(o)},i=n.prototype=Object.create(ir);return i.constructor=n,n}t(It,Be),It.of=function(){return this(arguments)},It.prototype.toString=function(){return this.__toString("OrderedMap {","}")},It.prototype.get=function(e,t){var r=this._map.get(e);return void 0!==r?this._list.get(r)[1]:t},It.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Ot()},It.prototype.set=function(e,t){return Dt(this,e,t)},It.prototype.remove=function(e){return Dt(this,e,v)},It.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},It.prototype.__iterate=function(e,t){var r=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],r)},t)},It.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},It.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),r=this._list.__ensureOwner(e);return e?Rt(t,r,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=r,this)},It.isOrderedMap=At,It.prototype[f]=!0,It.prototype.delete=It.prototype.remove,t(kt,J),kt.prototype.get=function(e,t){return this._iter.get(e,t)},kt.prototype.has=function(e){return this._iter.has(e)},kt.prototype.valueSeq=function(){return this._iter.valueSeq()},kt.prototype.reverse=function(){var e=this,t=Ut(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},kt.prototype.map=function(e,t){var r=this,n=Vt(this,e,t);return this._useKeys||(n.valueSeq=function(){return r._iter.toSeq().map(e,t)}),n},kt.prototype.__iterate=function(e,t){var r,n=this;return this._iter.__iterate(this._useKeys?function(t,r){return e(t,r,n)}:(r=t?Zt(this):0,function(i){return e(i,t?--r:r++,n)}),t)},kt.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var r=this._iter.__iterator(D,t),n=t?Zt(this):0;return new B(function(){var i=r.next();return i.done?i:V(e,t?--n:n++,i.value,i)})},kt.prototype[f]=!0,t(Ft,X),Ft.prototype.includes=function(e){return this._iter.includes(e)},Ft.prototype.__iterate=function(e,t){var r=this,n=0;return this._iter.__iterate(function(t){return e(t,n++,r)},t)},Ft.prototype.__iterator=function(e,t){var r=this._iter.__iterator(D,t),n=0;return new B(function(){var t=r.next();return t.done?t:V(e,n++,t.value,t)})},t(Nt,Y),Nt.prototype.has=function(e){return this._iter.includes(e)},Nt.prototype.__iterate=function(e,t){var r=this;return this._iter.__iterate(function(t){return e(t,t,r)},t)},Nt.prototype.__iterator=function(e,t){var r=this._iter.__iterator(D,t);return new B(function(){var t=r.next();return t.done?t:V(e,t.value,t.value,t)})},t(Lt,J),Lt.prototype.entrySeq=function(){return this._iter.toSeq()},Lt.prototype.__iterate=function(e,t){var r=this;return this._iter.__iterate(function(t){if(t){Kt(t);var n=s(t);return e(n?t.get(1):t[1],n?t.get(0):t[0],r)}},t)},Lt.prototype.__iterator=function(e,t){var r=this._iter.__iterator(D,t);return new B(function(){for(;;){var t=r.next();if(t.done)return t;var n=t.value;if(n){Kt(n);var i=s(n);return V(e,i?n.get(0):n[0],i?n.get(1):n[1],t)}}})},Ft.prototype.cacheResult=kt.prototype.cacheResult=Nt.prototype.cacheResult=Lt.prototype.cacheResult=er,t(nr,we),nr.prototype.toString=function(){return this.__toString(sr(this)+" {","}")},nr.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},nr.prototype.get=function(e,t){if(!this.has(e))return t;var r=this._defaultValues[e];return this._map?this._map.get(e,r):r},nr.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=this.constructor;return e._empty||(e._empty=or(this,Qe()))},nr.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+sr(this));if(this._map&&!this._map.has(e)){var r=this._defaultValues[e];if(t===r)return this}var n=this._map&&this._map.set(e,t);return this.__ownerID||n===this._map?this:or(this,n)},nr.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:or(this,t)},nr.prototype.wasAltered=function(){return this._map.wasAltered()},nr.prototype.__iterator=function(e,t){var r=this;return n(this._defaultValues).map(function(e,t){return r.get(t)}).__iterator(e,t)},nr.prototype.__iterate=function(e,t){var r=this;return n(this._defaultValues).map(function(e,t){return r.get(t)}).__iterate(e,t)},nr.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?or(this,t,e):(this.__ownerID=e,this._map=t,this)};var ir=nr.prototype;function or(e,t,r){var n=Object.create(Object.getPrototypeOf(e));return n._map=t,n.__ownerID=r,n}function sr(e){return e._name||e.constructor.name||"Record"}function ar(e){return null===e||void 0===e?fr():cr(e)&&!u(e)?e:fr().withMutations(function(t){var r=o(e);Le(r.size),r.forEach(function(e){return t.add(e)})})}function cr(e){return!(!e||!e[ur])}ir.delete=ir.remove,ir.deleteIn=ir.removeIn=je.removeIn,ir.merge=je.merge,ir.mergeWith=je.mergeWith,ir.mergeIn=je.mergeIn,ir.mergeDeep=je.mergeDeep,ir.mergeDeepWith=je.mergeDeepWith,ir.mergeDeepIn=je.mergeDeepIn,ir.setIn=je.setIn,ir.update=je.update,ir.updateIn=je.updateIn,ir.withMutations=je.withMutations,ir.asMutable=je.asMutable,ir.asImmutable=je.asImmutable,t(ar,be),ar.of=function(){return this(arguments)},ar.fromKeys=function(e){return this(n(e).keySeq())},ar.prototype.toString=function(){return this.__toString("Set {","}")},ar.prototype.has=function(e){return this._map.has(e)},ar.prototype.add=function(e){return hr(this,this._map.set(e,!0))},ar.prototype.remove=function(e){return hr(this,this._map.remove(e))},ar.prototype.clear=function(){return hr(this,this._map.clear())},ar.prototype.union=function(){var t=e.call(arguments,0);return 0===(t=t.filter(function(e){return 0!==e.size})).length?this:0!==this.size||this.__ownerID||1!==t.length?this.withMutations(function(e){for(var r=0;r<t.length;r++)o(t[r]).forEach(function(t){return e.add(t)})}):this.constructor(t[0])},ar.prototype.intersect=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map(function(e){return o(e)});var r=this;return this.withMutations(function(e){r.forEach(function(r){t.every(function(e){return e.includes(r)})||e.remove(r)})})},ar.prototype.subtract=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map(function(e){return o(e)});var r=this;return this.withMutations(function(e){r.forEach(function(r){t.some(function(e){return e.includes(r)})&&e.remove(r)})})},ar.prototype.merge=function(){return this.union.apply(this,arguments)},ar.prototype.mergeWith=function(t){var r=e.call(arguments,1);return this.union.apply(this,r)},ar.prototype.sort=function(e){return gr(qt(this,e))},ar.prototype.sortBy=function(e,t){return gr(qt(this,t,e))},ar.prototype.wasAltered=function(){return this._map.wasAltered()},ar.prototype.__iterate=function(e,t){var r=this;return this._map.__iterate(function(t,n){return e(n,n,r)},t)},ar.prototype.__iterator=function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},ar.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},ar.isSet=cr;var lr,ur="@@__IMMUTABLE_SET__@@",dr=ar.prototype;function hr(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function pr(e,t){var r=Object.create(dr);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function fr(){return lr||(lr=pr(Qe()))}function gr(e){return null===e||void 0===e?wr():mr(e)?e:wr().withMutations(function(t){var r=o(e);Le(r.size),r.forEach(function(e){return t.add(e)})})}function mr(e){return cr(e)&&u(e)}dr[ur]=!0,dr.delete=dr.remove,dr.mergeDeep=dr.merge,dr.mergeDeepWith=dr.mergeWith,dr.withMutations=je.withMutations,dr.asMutable=je.asMutable,dr.asImmutable=je.asImmutable,dr.__empty=fr,dr.__make=pr,t(gr,ar),gr.of=function(){return this(arguments)},gr.fromKeys=function(e){return this(n(e).keySeq())},gr.prototype.toString=function(){return this.__toString("OrderedSet {","}")},gr.isOrderedSet=mr;var yr,vr=gr.prototype;function _r(e,t){var r=Object.create(vr);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function wr(){return yr||(yr=_r(Ot()))}function Sr(e){return null===e||void 0===e?Mr():br(e)?e:Mr().unshiftAll(e)}function br(e){return!(!e||!e[Pr])}vr[f]=!0,vr.__empty=wr,vr.__make=_r,t(Sr,Se),Sr.of=function(){return this(arguments)},Sr.prototype.toString=function(){return this.__toString("Stack [","]")},Sr.prototype.get=function(e,t){var r=this._head;for(e=T(this,e);r&&e--;)r=r.next;return r?r.value:t},Sr.prototype.peek=function(){return this._head&&this._head.value},Sr.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,r=arguments.length-1;r>=0;r--)t={value:arguments[r],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):Tr(e,t)},Sr.prototype.pushAll=function(e){if(0===(e=i(e)).size)return this;Le(e.size);var t=this.size,r=this._head;return e.reverse().forEach(function(e){t++,r={value:e,next:r}}),this.__ownerID?(this.size=t,this._head=r,this.__hash=void 0,this.__altered=!0,this):Tr(t,r)},Sr.prototype.pop=function(){return this.slice(1)},Sr.prototype.unshift=function(){return this.push.apply(this,arguments)},Sr.prototype.unshiftAll=function(e){return this.pushAll(e)},Sr.prototype.shift=function(){return this.pop.apply(this,arguments)},Sr.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Mr()},Sr.prototype.slice=function(e,t){if(E(e,t,this.size))return this;var r=I(e,this.size),n=A(t,this.size);if(n!==this.size)return Se.prototype.slice.call(this,e,t);for(var i=this.size-r,o=this._head;r--;)o=o.next;return this.__ownerID?(this.size=i,this._head=o,this.__hash=void 0,this.__altered=!0,this):Tr(i,o)},Sr.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Tr(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Sr.prototype.__iterate=function(e,t){if(t)return this.reverse().__iterate(e);for(var r=0,n=this._head;n&&!1!==e(n.value,r++,this);)n=n.next;return r},Sr.prototype.__iterator=function(e,t){if(t)return this.reverse().__iterator(e);var r=0,n=this._head;return new B(function(){if(n){var t=n.value;return n=n.next,V(e,r++,t)}return{value:void 0,done:!0}})},Sr.isStack=br;var xr,Pr="@@__IMMUTABLE_STACK__@@",Cr=Sr.prototype;function Tr(e,t,r,n){var i=Object.create(Cr);return i.size=e,i._head=t,i.__ownerID=r,i.__hash=n,i.__altered=!1,i}function Mr(){return xr||(xr=Tr(0))}function Er(e,t){var r=function(r){e.prototype[r]=t[r]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}Cr[Pr]=!0,Cr.withMutations=je.withMutations,Cr.asMutable=je.asMutable,Cr.asImmutable=je.asImmutable,Cr.wasAltered=je.wasAltered,r.Iterator=B,Er(r,{toArray:function(){Le(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,r){e[r]=t}),e},toIndexedSeq:function(){return new Ft(this)},toJS:function(){return this.toSeq().map(function(e){return e&&"function"===typeof e.toJS?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&"function"===typeof e.toJSON?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new kt(this,!0)},toMap:function(){return Be(this.toKeyedSeq())},toObject:function(){Le(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e},toOrderedMap:function(){return It(this.toKeyedSeq())},toOrderedSet:function(){return gr(a(this)?this.valueSeq():this)},toSet:function(){return ar(a(this)?this.valueSeq():this)},toSetSeq:function(){return new Nt(this)},toSeq:function(){return c(this)?this.toIndexedSeq():a(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Sr(a(this)?this.valueSeq():this)},toList:function(){return ht(a(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){var t=e.call(arguments,0);return Yt(this,function(e,t){var r=a(e),i=[e].concat(t).map(function(e){return s(e)?r&&(e=n(e)):e=r?se(e):ae(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size});if(0===i.length)return e;if(1===i.length){var o=i[0];if(o===e||r&&a(o)||c(e)&&c(o))return o}var l=new ee(i);return r?l=l.toKeyedSeq():c(e)||(l=l.toSetSeq()),(l=l.flatten(!0)).size=i.reduce(function(e,t){if(void 0!==e){var r=t.size;if(void 0!==r)return e+r}},0),l}(this,t))},includes:function(e){return this.some(function(t){return fe(t,e)})},entries:function(){return this.__iterator(k)},every:function(e,t){Le(this.size);var r=!0;return this.__iterate(function(n,i,o){if(!e.call(t,n,i,o))return r=!1,!1}),r},filter:function(e,t){return Yt(this,zt(this,e,t,!0))},find:function(e,t,r){var n=this.findEntry(e,t);return n?n[1]:r},forEach:function(e,t){return Le(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){Le(this.size),e=void 0!==e?""+e:",";var t="",r=!0;return this.__iterate(function(n){r?r=!1:t+=e,t+=null!==n&&void 0!==n?n.toString():""}),t},keys:function(){return this.__iterator(O)},map:function(e,t){return Yt(this,Vt(this,e,t))},reduce:function(e,t,r){var n,i;return Le(this.size),arguments.length<2?i=!0:n=t,this.__iterate(function(t,o,s){i?(i=!1,n=t):n=e.call(r,n,t,o,s)}),n},reduceRight:function(e,t,r){var n=this.toKeyedSeq().reverse();return n.reduce.apply(n,arguments)},reverse:function(){return Yt(this,Ut(this,!0))},slice:function(e,t){return Yt(this,jt(this,e,t,!0))},some:function(e,t){return!this.every(Dr(e),t)},sort:function(e){return Yt(this,qt(this,e))},values:function(){return this.__iterator(D)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return C(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return function(e,t,r){var n=Be().asMutable();return e.__iterate(function(i,o){n.update(t.call(r,i,o,e),0,function(e){return e+1})}),n.asImmutable()}(this,e,t)},equals:function(e){return ge(this,e)},entrySeq:function(){var e=this;if(e._cache)return new ee(e._cache);var t=e.toSeq().map(Or).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Dr(e),t)},findEntry:function(e,t,r){var n=r;return this.__iterate(function(r,i,o){if(e.call(t,r,i,o))return n=[i,r],!1}),n},findKey:function(e,t){var r=this.findEntry(e,t);return r&&r[0]},findLast:function(e,t,r){return this.toKeyedSeq().reverse().find(e,t,r)},findLastEntry:function(e,t,r){return this.toKeyedSeq().reverse().findEntry(e,t,r)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(){return this.find(M)},flatMap:function(e,t){return Yt(this,function(e,t,r){var n=Qt(e);return e.toSeq().map(function(i,o){return n(t.call(r,i,o,e))}).flatten(!0)}(this,e,t))},flatten:function(e){return Yt(this,Ht(this,e,!0))},fromEntrySeq:function(){return new Lt(this)},get:function(e,t){return this.find(function(t,r){return fe(r,e)},void 0,t)},getIn:function(e,t){for(var r,n=this,i=rr(e);!(r=i.next()).done;){var o=r.value;if((n=n&&n.get?n.get(o,v):v)===v)return t}return n},groupBy:function(e,t){return function(e,t,r){var n=a(e),i=(u(e)?It():Be()).asMutable();e.__iterate(function(o,s){i.update(t.call(r,o,s,e),function(e){return(e=e||[]).push(n?[s,o]:o),e})});var o=Qt(e);return i.map(function(t){return Yt(e,o(t))})}(this,e,t)},has:function(e){return this.get(e,v)!==v},hasIn:function(e){return this.getIn(e,v)!==v},isSubset:function(e){return e="function"===typeof e.includes?e:r(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return(e="function"===typeof e.isSubset?e:r(e)).isSubset(this)},keyOf:function(e){return this.findKey(function(t){return fe(t,e)})},keySeq:function(){return this.toSeq().map(Rr).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return Wt(this,e)},maxBy:function(e,t){return Wt(this,t,e)},min:function(e){return Wt(this,e?kr(e):Lr)},minBy:function(e,t){return Wt(this,t?kr(t):Lr,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return Yt(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return Yt(this,Gt(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Dr(e),t)},sortBy:function(e,t){return Yt(this,qt(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return Yt(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return Yt(this,function(e,t,r){var n=$t(e);return n.__iterateUncached=function(n,i){var o=this;if(i)return this.cacheResult().__iterate(n,i);var s=0;return e.__iterate(function(e,i,a){return t.call(r,e,i,a)&&++s&&n(e,i,o)}),s},n.__iteratorUncached=function(n,i){var o=this;if(i)return this.cacheResult().__iterator(n,i);var s=e.__iterator(k,i),a=!0;return new B(function(){if(!a)return{value:void 0,done:!0};var e=s.next();if(e.done)return e;var i=e.value,c=i[0],l=i[1];return t.call(r,l,c,o)?n===k?e:V(n,c,l,e):(a=!1,{value:void 0,done:!0})})},n}(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Dr(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(e){if(e.size===1/0)return 0;var t=u(e),r=a(e),n=t?1:0;return function(e,t){return t=xe(t,3432918353),t=xe(t<<15|t>>>-15,461845907),t=xe(t<<13|t>>>-13,5),t=xe((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=Pe((t=xe(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(r?t?function(e,t){n=31*n+Br(Ce(e),Ce(t))|0}:function(e,t){n=n+Br(Ce(e),Ce(t))|0}:t?function(e){n=31*n+Ce(e)|0}:function(e){n=n+Ce(e)|0}),n)}(this))}});var Ir=r.prototype;Ir[d]=!0,Ir[L]=Ir.values,Ir.__toJS=Ir.toArray,Ir.__toStringMapper=Fr,Ir.inspect=Ir.toSource=function(){return this.toString()},Ir.chain=Ir.flatMap,Ir.contains=Ir.includes,Er(n,{flip:function(){return Yt(this,Bt(this))},mapEntries:function(e,t){var r=this,n=0;return Yt(this,this.toSeq().map(function(i,o){return e.call(t,[o,i],n++,r)}).fromEntrySeq())},mapKeys:function(e,t){var r=this;return Yt(this,this.toSeq().flip().map(function(n,i){return e.call(t,n,i,r)}).flip())}});var Ar=n.prototype;function Rr(e,t){return t}function Or(e,t){return[t,e]}function Dr(e){return function(){return!e.apply(this,arguments)}}function kr(e){return function(){return-e.apply(this,arguments)}}function Fr(e){return"string"===typeof e?JSON.stringify(e):String(e)}function Nr(){return P(arguments)}function Lr(e,t){return e<t?1:e>t?-1:0}function Br(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}return Ar[h]=!0,Ar[L]=Ir.entries,Ar.__toJS=Ir.toObject,Ar.__toStringMapper=function(e,t){return JSON.stringify(t)+": "+Fr(e)},Er(i,{toKeyedSeq:function(){return new kt(this,!1)},filter:function(e,t){return Yt(this,zt(this,e,t,!1))},findIndex:function(e,t){var r=this.findEntry(e,t);return r?r[0]:-1},indexOf:function(e){var t=this.keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return void 0===t?-1:t},reverse:function(){return Yt(this,Ut(this,!1))},slice:function(e,t){return Yt(this,jt(this,e,t,!1))},splice:function(e,t){var r=arguments.length;if(t=Math.max(0|t,0),0===r||2===r&&!t)return this;e=I(e,e<0?this.count():this.size);var n=this.slice(0,e);return Yt(this,1===r?n:n.concat(P(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var r=this.findLastEntry(e,t);return r?r[0]:-1},first:function(){return this.get(0)},flatten:function(e){return Yt(this,Ht(this,e,!1))},get:function(e,t){return(e=T(this,e))<0||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,r){return r===e},void 0,t)},has:function(e){return(e=T(this,e))>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return Yt(this,function(e,t){var r=$t(e);return r.size=e.size&&2*e.size-1,r.__iterateUncached=function(r,n){var i=this,o=0;return e.__iterate(function(e,n){return(!o||!1!==r(t,o++,i))&&!1!==r(e,o++,i)},n),o},r.__iteratorUncached=function(r,n){var i,o=e.__iterator(D,n),s=0;return new B(function(){return(!i||s%2)&&(i=o.next()).done?i:s%2?V(r,s++,t):V(r,s++,i.value,i)})},r}(this,e))},interleave:function(){var e=[this].concat(P(arguments)),t=Xt(this.toSeq(),X.of,e),r=t.flatten(!0);return t.size&&(r.size=t.size*e.length),Yt(this,r)},keySeq:function(){return ve(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(e,t){return Yt(this,Gt(this,e,t,!1))},zip:function(){return Yt(this,Xt(this,Nr,[this].concat(P(arguments))))},zipWith:function(e){var t=P(arguments);return t[0]=this,Yt(this,Xt(this,e,t))}}),i.prototype[p]=!0,i.prototype[f]=!0,Er(o,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),o.prototype.has=Ir.includes,o.prototype.contains=o.prototype.includes,Er(J,n.prototype),Er(X,i.prototype),Er(Y,o.prototype),Er(we,n.prototype),Er(Se,i.prototype),Er(be,o.prototype),{Iterable:r,Seq:W,Collection:_e,Map:Be,OrderedMap:It,List:ht,Stack:Sr,Set:ar,OrderedSet:gr,Record:nr,Range:ve,Repeat:me,is:fe,fromJS:de}}()},function(e,t,r){var n=r(228);"string"===typeof n&&(n=[[e.id,n,""]]);r(11)(n,{});n.locals&&(e.exports=n.locals)},,,function(e,t){"use strict";e.exports=function(e){return e&&"[object Function]"==={}.toString.call(e)}},,,function(e,t,r){var n=r(227);"string"===typeof n&&(n=[[e.id,n,""]]);r(11)(n,{});n.locals&&(e.exports=n.locals)},function(e,t,r){var n=r(229);"string"===typeof n&&(n=[[e.id,n,""]]);r(11)(n,{});n.locals&&(e.exports=n.locals)},,,,function(e,t,r){"use strict";var n,i=r(231);var o={UpdateActions:(0,((n=i)&&n.__esModule?n:{default:n}).default)({CELL_UPDATE:null,COLUMN_FILL:null,COPY_PASTE:null,CELL_DRAG:null}),DragItemTypes:{Column:"column"},CellExpand:{DOWN_TRIANGLE:String.fromCharCode("9660"),RIGHT_TRIANGLE:String.fromCharCode("9654")}};e.exports=o},function(e,t,r){"use strict";var n=r(70),i=r(194),o=r(8),s=r(33),a=r(72);function c(e){var t=function(e,t){return e.map(function(e){var r=Object.assign({},e);return e.width&&/^([0-9]+)%$/.exec(e.width.toString())&&(r.width=Math.floor(e.width/100*t)),r})}(e.columns,e.totalWidth),r=t.filter(function(e){return e.width}).reduce(function(e,t){return e-t.width},e.totalWidth);r-=s();var n=t.filter(function(e){return e.width}).reduce(function(e,t){return e+t.width},0);return{columns:t=function(e){var t=0;return e.map(function(e){return e.left=t,t+=e.width,e})}(t=function(e,t,r){var n=e.filter(function(e){return!e.width});return e.map(function(e){if(!e.width&&0!==e.width)if(t<=0)e.width=r;else{var i=Math.floor(t/o.getSize(n));e.width=i<r?r:i}return e})}(t,r,e.minColumnWidth)),width:n,totalWidth:e.totalWidth,minColumnWidth:e.minColumnWidth}}e.exports={recalculate:c,resizeColumn:function(e,t,r){var i=o.getColumn(e.columns,t),s=n(e);s.columns=e.columns.slice(0);var a=n(i);return a.width=Math.max(r,s.minColumnWidth),c(s=o.spliceColumn(s,t,a))},sameColumn:i,sameColumns:function(e,t,r){return function(e,t){return a(e)&&a(t)}(e,t)?e===t:function(e,t,r){var n=void 0,i=void 0,s=void 0,a={},c={};if(o.getSize(e)!==o.getSize(t))return!1;for(n=0,i=o.getSize(e);n<i;n++)a[(s=e[n]).key]=s;for(n=0,i=o.getSize(t);n<i;n++){c[(s=t[n]).key]=s;var l=a[s.key];if(void 0===l||!r(l,s))return!1}for(n=0,i=o.getSize(e);n<i;n++)if(void 0===c[(s=e[n]).key])return!1;return!0}(e,t,r)}}},function(e,t){"use strict";var r=void 0;e.exports=function(){if(void 0===r){var e=document.createElement("div");e.style.width="50px",e.style.height="50px",e.style.position="absolute",e.style.top="-200px",e.style.left="-200px";var t=document.createElement("div");t.style.height="100px",t.style.width="100%",e.appendChild(t),document.body.appendChild(e);var n=e.clientWidth;e.style.overflowY="scroll";var i=t.clientWidth;document.body.removeChild(e),r=n-i}return r}},function(e,t,r){var n=r(225);"string"===typeof n&&(n=[[e.id,n,""]]);r(11)(n,{});n.locals&&(e.exports=n.locals)},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=l(r(110)),o=l(r(3)),s=l(r(191)),a=l(r(192)),c=l(r(193));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var d=r(2),h=r(7),p=r(211),f=r(15),g=r(23),m=r(12),y=r(69),v=r(8),_=r(18);r(34);var w=["height","tabIndex","value"],S=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return r=n=u(this,e.call.apply(e,[this].concat(s))),n.state={isCellValueChanging:!1,isLockChanging:!1},n.onCellClick=function(e){var t=n.props.cellMetaData;null!=t&&t.onCellClick&&"function"===typeof t.onCellClick&&t.onCellClick({rowIdx:n.props.rowIdx,idx:n.props.idx},e)},n.onCellFocus=function(){var e=n.props.cellMetaData;null!=e&&e.onCellFocus&&"function"===typeof e.onCellFocus&&e.onCellFocus({rowIdx:n.props.rowIdx,idx:n.props.idx})},n.onCellContextMenu=function(){var e=n.props.cellMetaData;null!=e&&e.onCellContextMenu&&"function"===typeof e.onCellContextMenu&&e.onCellContextMenu({rowIdx:n.props.rowIdx,idx:n.props.idx})},n.onCellDoubleClick=function(e){var t=n.props.cellMetaData;null!=t&&t.onCellDoubleClick&&"function"===typeof t.onCellDoubleClick&&t.onCellDoubleClick({rowIdx:n.props.rowIdx,idx:n.props.idx},e)},n.onCellExpand=function(e){e.stopPropagation();var t=n.props.cellMetaData;null!=t&&null!=t.onCellExpand&&t.onCellExpand({rowIdx:n.props.rowIdx,idx:n.props.idx,rowData:n.props.rowData,expandArgs:n.props.expandableOptions})},n.onCellKeyDown=function(e){n.canExpand()&&"Enter"===e.key&&n.onCellExpand(e)},n.onDeleteSubRow=function(){var e=n.props.cellMetaData;null!=e&&null!=e.onDeleteSubRow&&e.onDeleteSubRow({rowIdx:n.props.rowIdx,idx:n.props.idx,rowData:n.props.rowData,expandArgs:n.props.expandableOptions})},n.onDragHandleDoubleClick=function(e){e.stopPropagation();var t=n.props.cellMetaData;null!=t&&t.onDragHandleDoubleClick&&"function"===typeof t.onDragHandleDoubleClick&&t.onDragHandleDoubleClick({rowIdx:n.props.rowIdx,idx:n.props.idx,rowData:n.getRowData(),e})},n.onDragOver=function(e){e.preventDefault()},n.getStyle=function(){return{position:"absolute",width:n.props.column.width,height:n.props.height,left:n.props.column.left,contain:"layout"}},n.getFormatter=function(){var e=n.props.column;return n.isActive()?d.createElement(p,{rowData:n.getRowData(),rowIdx:n.props.rowIdx,value:n.props.value,idx:n.props.idx,cellMetaData:n.props.cellMetaData,column:e,height:n.props.height}):n.props.column.formatter},n.getRowData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props;return e.rowData.toJSON?e.rowData.toJSON():e.rowData},n.getFormatterDependencies=function(){if("function"===typeof n.props.column.getRowMetaData)return n.props.column.getRowMetaData(n.getRowData(),n.props.column)},n.getCellClass=function(){var e=h(n.props.column.cellClass,"react-grid-Cell",n.props.className,n.props.column.locked?"react-grid-Cell--locked":null),t=h({"row-selected":n.props.isRowSelected,editing:n.isActive(),copied:n.isCopied()||n.wasDraggedOver()||n.isDraggedOverUpwards()||n.isDraggedOverDownwards(),"is-dragged-over-up":n.isDraggedOverUpwards(),"is-dragged-over-down":n.isDraggedOverDownwards(),"was-dragged-over":n.wasDraggedOver(),"cell-tooltip":!!n.props.tooltip,"rdg-child-cell":n.props.expandableOptions&&n.props.expandableOptions.subRowDetails&&n.props.expandableOptions.treeDepth>0,"last-column":n.props.column.isLastColumn});return h(e,t)},n.getUpdateCellClass=function(){return n.props.column.getUpdateCellClass?n.props.column.getUpdateCellClass(n.props.selectedColumn,n.props.column,n.state.isCellValueChanging):""},n.isColumnSelected=function(){var e=n.props.cellMetaData;return null!=e&&(e.selected&&e.selected.idx===n.props.idx)},n.isSelected=function(){var e=n.props.cellMetaData;return null!=e&&(e.selected&&e.selected.rowIdx===n.props.rowIdx&&e.selected.idx===n.props.idx)},n.isActive=function(){var e=n.props.cellMetaData;return null!=e&&(n.isSelected()&&!0===e.selected.active)},n.isCellSelectionChanging=function(e){var t=n.props.cellMetaData;if(null==t)return!1;var r=e.cellMetaData.selected;return!t.selected||!r||(n.props.idx===r.idx||n.props.idx===t.selected.idx)},n.isCellSelectEnabled=function(){var e=n.props.cellMetaData;return null!=e&&e.enableCellSelect},n.hasChangedDependentValues=function(e){var t=n.props.column,r=!1;if(t.getRowMetaData){var o=t.getRowMetaData(n.getRowData(),t),s=e.column,a=s.getRowMetaData(n.getRowData(e),s);r=!i.default.isEqual(o,a)}return r},n.applyUpdateClass=function(){var e=n.getUpdateCellClass();if(null!=e&&""!==e){var t=n.node;t.classList?(t.classList.remove(e),t.classList.add(e)):-1===t.className.indexOf(e)&&(t.className=t.className+" "+e)}},n.setScrollLeft=function(e){var t=n.node;if(t){var r="translate3d("+e+"px, 0px, 0px)";t.style.webkitTransform=r,t.style.transform=r}},n.removeScroll=function(){var e=n.node;e&&(e.style.webkitTransform=null,e.style.transform=null)},n.isCopied=function(){var e=n.props.cellMetaData.copied;return e&&e.rowIdx===n.props.rowIdx&&e.idx===n.props.idx},n.isDraggedOver=function(){var e=n.props.cellMetaData.dragged;return e&&e.overRowIdx===n.props.rowIdx&&e.idx===n.props.idx},n.wasDraggedOver=function(){var e=n.props.cellMetaData.dragged;return e&&(e.overRowIdx<n.props.rowIdx&&n.props.rowIdx<e.rowIdx||e.overRowIdx>n.props.rowIdx&&n.props.rowIdx>e.rowIdx)&&e.idx===n.props.idx},n.isDraggedCellChanging=function(e){var t=n.props.cellMetaData.dragged,r=e.cellMetaData.dragged;return!!t&&(r&&n.props.idx===r.idx||t&&n.props.idx===t.idx)},n.isCopyCellChanging=function(e){var t=n.props.cellMetaData.copied,r=e.cellMetaData.copied;return!!t&&(r&&n.props.idx===r.idx||t&&n.props.idx===t.idx)},n.isDraggedOverUpwards=function(){var e=n.props.cellMetaData.dragged;return!n.isSelected()&&n.isDraggedOver()&&n.props.rowIdx<e.rowIdx},n.isDraggedOverDownwards=function(){var e=n.props.cellMetaData.dragged;return!n.isSelected()&&n.isDraggedOver()&&n.props.rowIdx>e.rowIdx},n.isFocusedOnBody=function(){return null==document.activeElement||document.activeElement.nodeName&&"string"===typeof document.activeElement.nodeName&&"body"===document.activeElement.nodeName.toLowerCase()},n.isFocusedOnCell=function(){return document.activeElement&&-1!==document.activeElement.className.indexOf("react-grid-Cell")},n.checkFocus=function(){if(n.isSelected()&&!n.isActive()){if(n.props.isScrolling&&!n.props.cellMetaData.isScrollingVerticallyWithKeyboard&&!n.props.cellMetaData.isScrollingHorizontallyWithKeyboard)return;var e=n.props.cellMetaData&&n.props.cellMetaData.enableCellAutoFocus,t=n.props.cellMetaData&&n.props.cellMetaData.getDataGridDOMNode?n.props.cellMetaData.getDataGridDOMNode():null;if(n.isFocusedOnCell()||e&&n.isFocusedOnBody()||t&&t.contains(document.activeElement)){var r=n.node;r&&r.focus()}}},n.canEdit=function(){return null!=n.props.column.editor||n.props.column.editable},n.canExpand=function(){return n.props.expandableOptions&&n.props.expandableOptions.canExpand},n.createColumEventCallBack=function(e,t){return function(r){e(r,t)}},n.createCellEventCallBack=function(e,t){return function(r){e(r),t(r)}},n.createEventDTO=function(e,t,r){var i=Object.assign({},e);for(var o in t)if(t.hasOwnProperty(o)){var s=t[s],a={idx:n.props.idx,rowIdx:n.props.rowIdx,rowId:n.props.rowData[n.props.cellMetaData.rowKey],name:o},c=n.createColumEventCallBack(r,a);if(i.hasOwnProperty(o)){var l=i[o];i[o]=n.createCellEventCallBack(l,c)}else i[o]=c}return i},n.getEvents=function(){var e=n.props.column?Object.assign({},n.props.column.events):void 0,t=n.props.cellMetaData?n.props.cellMetaData.onColumnEvent:void 0,r={onClick:n.onCellClick,onFocus:n.onCellFocus,onDoubleClick:n.onCellDoubleClick,onContextMenu:n.onCellContextMenu,onDragOver:n.onDragOver};return e&&t?n.createEventDTO(r,e,t):r},n.getKnownDivProps=function(){return _(n.props,w)},n.renderCellContent=function(e){var t=void 0,r=n.getFormatter();d.isValidElement(r)?(e.dependentValues=n.getFormatterDependencies(),t=d.cloneElement(r,e)):t=g(r)?d.createElement(r,{value:n.props.value,dependentValues:n.getFormatterDependencies()}):d.createElement(y,{value:n.props.value});var i=!!n.props.expandableOptions&&n.props.expandableOptions.field===n.props.column.key,o=n.props.expandableOptions?n.props.expandableOptions.treeDepth:0,s=n.props.expandableOptions&&i?30*n.props.expandableOptions.treeDepth:0,l=void 0,u=void 0;n.canExpand()&&(l=d.createElement(a.default,{expandableOptions:n.props.expandableOptions,onCellExpand:n.onCellExpand}));var h=!!n.props.cellMetaData.onDeleteSubRow;return o>0&&i&&(u=d.createElement(c.default,{treeDepth:o,cellHeight:n.props.height,siblingIndex:n.props.expandableOptions.subRowDetails.siblingIndex,numberSiblings:n.props.expandableOptions.subRowDetails.numberSiblings,onDeleteSubRow:n.onDeleteSubRow,isDeleteSubRowEnabled:h})),d.createElement("div",{className:"react-grid-Cell__value"},u,d.createElement("div",{style:{marginLeft:s}},d.createElement("span",null,t)," ",n.props.cellControls," ",l))},u(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){this.checkFocus()},t.prototype.componentWillReceiveProps=function(e){this.setState({isCellValueChanging:this.props.isCellValueChanging(this.props.value,e.value),isLockChanging:this.props.column.locked!==e.column.locked})},t.prototype.componentDidUpdate=function(){this.checkFocus();var e=this.props.cellMetaData.dragged;e&&!0===e.complete&&this.props.cellMetaData.handleTerminateDrag(),this.state.isCellValueChanging&&null!=this.props.selectedColumn&&this.applyUpdateClass(),this.state.isLockChanging&&!this.props.column.locked&&this.removeScroll()},t.prototype.shouldComponentUpdate=function(e){return this.props.column.width!==e.column.width||this.props.column.left!==e.column.left||this.props.column.cellClass!==e.column.cellClass||this.props.height!==e.height||this.props.rowIdx!==e.rowIdx||this.isCellSelectionChanging(e)||this.isDraggedCellChanging(e)||this.isCopyCellChanging(e)||this.props.isRowSelected!==e.isRowSelected||this.isSelected()||this.props.isCellValueChanging(this.props.value,e.value)||!0===this.props.forceUpdate||this.props.className!==e.className||this.props.expandableOptions!==e.expandableOptions||this.hasChangedDependentValues(e)||this.props.column.locked!==e.column.locked},t.prototype.getCellActions=function(){var e=this.props,t=e.cellMetaData,r=e.column,n=e.rowData;if(t&&t.getCellActions){var i=t.getCellActions(r,n);return i&&i.length?i.map(function(e,t){return d.createElement(s.default,{key:t,action:e,isFirst:0===t})}):null}return null},t.prototype.render=function(){var e=this;if(this.props.column.hidden)return null;var t=this.getStyle(),r=this.getCellClass(),i=this.getCellActions(),o=this.props.children||this.renderCellContent({value:this.props.value,column:this.props.column,rowIdx:this.props.rowIdx,isExpanded:this.props.isExpanded}),s=!this.isActive()&&v.canEdit(this.props.column,this.props.rowData,this.props.cellMetaData.enableCellSelect)?d.createElement("div",{className:"drag-handle",draggable:"true",onDoubleClick:this.onDragHandleDoubleClick},d.createElement("span",{style:{display:"none"}})):null,a=this.getEvents(),c=this.props.tooltip?d.createElement("span",{className:"cell-tooltip-text"},this.props.tooltip):null;return d.createElement("div",n({},this.getKnownDivProps(),{className:r,style:t},a,{ref:function(t){e.node=t}}),i,o,s,c)},t}(d.Component);S.propTypes={rowIdx:o.default.number.isRequired,idx:o.default.number.isRequired,selected:o.default.shape({idx:o.default.number.isRequired}),selectedColumn:o.default.object,height:o.default.number,tabIndex:o.default.number,column:o.default.shape(f).isRequired,value:o.default.oneOfType([o.default.string,o.default.number,o.default.object,o.default.bool]),isExpanded:o.default.bool,isRowSelected:o.default.bool,cellMetaData:o.default.shape(m).isRequired,handleDragStart:o.default.func,className:o.default.string,cellControls:o.default.any,rowData:o.default.object.isRequired,forceUpdate:o.default.bool,expandableOptions:o.default.object.isRequired,isScrolling:o.default.bool.isRequired,tooltip:o.default.string,isCellValueChanging:o.default.func,children:o.default.oneOfType([o.default.arrayOf(o.default.node),o.default.node])},S.defaultProps={tabIndex:0,isExpanded:!1,value:"",isCellValueChanging:function(e,t){return e!==t}},e.exports=S},function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var a=r(2),c=r(6),l=r(7),u=r(15),d=r(206);r(20);var h=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return r=n=s(this,e.call.apply(e,[this].concat(o))),n.state={resizing:!1},n.onDragStart=function(e){n.setState({resizing:!0}),e&&e.dataTransfer&&e.dataTransfer.setData&&e.dataTransfer.setData("text/plain","dummy")},n.onDrag=function(e){var t=n.props.onResize||null;if(t){var r=n.getWidthFromMouseEvent(e);r>0&&t(n.props.column,r)}},n.onDragEnd=function(e){var t=n.getWidthFromMouseEvent(e);n.props.onResizeEnd(n.props.column,t),n.setState({resizing:!1})},n.getWidthFromMouseEvent=function(e){return(e.pageX||e.touches&&e.touches[0]&&e.touches[0].pageX||e.changedTouches&&e.changedTouches[e.changedTouches.length-1].pageX)-c.findDOMNode(n).getBoundingClientRect().left},n.getCell=function(){return a.isValidElement(n.props.renderer)?"string"===typeof n.props.renderer.type?a.cloneElement(n.props.renderer,{height:n.props.height}):a.cloneElement(n.props.renderer,{column:n.props.column,height:n.props.height}):n.props.renderer({column:n.props.column})},n.getStyle=function(){return{width:n.props.column.width,left:n.props.column.left,display:"inline-block",position:"absolute",height:n.props.height,margin:0,textOverflow:"ellipsis",whiteSpace:"nowrap"}},n.setScrollLeft=function(e){var t=c.findDOMNode(n);t.style.webkitTransform="translate3d("+e+"px, 0px, 0px)",t.style.transform="translate3d("+e+"px, 0px, 0px)"},n.removeScroll=function(){var e=c.findDOMNode(n);if(e){e.style.webkitTransform="none",e.style.transform="none"}},s(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){var e=void 0;this.props.column.resizable&&(e=a.createElement(d,{onDrag:this.onDrag,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd}));var t=l({"react-grid-HeaderCell":!0,"react-grid-HeaderCell--resizing":this.state.resizing,"react-grid-HeaderCell--locked":this.props.column.locked});t=l(t,this.props.className,this.props.column.cellClass);var r=this.getCell();return a.createElement("div",{className:t,style:this.getStyle()},r,e)},t}(a.Component);h.propTypes={renderer:o.default.oneOfType([o.default.func,o.default.element]).isRequired,column:o.default.shape(u).isRequired,onResize:o.default.func.isRequired,height:o.default.number.isRequired,onResizeEnd:o.default.func.isRequired,className:o.default.string},h.defaultProps={renderer:function(e){var t="header"===e.column.rowType?e.column.name:"";return a.createElement("div",{className:"widget-HeaderCell__value"},t)}},e.exports=h},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=a(r(202)),o=a(r(62)),s=a(r(3));function a(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function u(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=r(2),h=r(7),p=r(59),f=r(8),g=r(12),m=r(18);r(27);var y=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return u(t,e),t.prototype.render=function(){return d.createElement(p,this.props)},t}(d.Component),v=["height"],_=function(e){function t(){var r,o;c(this,t);for(var s=arguments.length,a=Array(s),u=0;u<s;u++)a[u]=arguments[u];return r=o=l(this,e.call.apply(e,[this].concat(a))),o.handleDragEnter=function(){var e=o.props.cellMetaData.handleDragEnterRow;e&&e(o.props.idx)},o.getSelectedColumn=function(){if(o.props.cellMetaData){var e=o.props.cellMetaData.selected;if(e&&e.idx)return f.getColumn(o.props.columns,e.idx)}},o.getCellRenderer=function(e){var t=o.props.cellRenderer;return o.props.subRowDetails&&o.props.subRowDetails.field===e?y:t},o.getCell=function(e,t,r){var s=o.props.cellRenderer,a=o.props,c=a.colVisibleStart,l=a.colVisibleEnd,u=a.idx,h=a.cellMetaData,p=e.key,f=e.formatter,g=e.locked,m={key:p+"-"+u,idx:t,rowIdx:u,height:o.getRowHeight(),column:e,cellMetaData:h};if((t<c||t>l)&&!g)return d.createElement(i.default,n({ref:function(e){return o[p]=e}},m));var y=o.props,v=y.row,_=y.isSelected,w={ref:function(e){return o[p]=e},value:o.getCellValue(p||t),rowData:v,isRowSelected:_,expandableOptions:o.getExpandableOptions(p),selectedColumn:r,formatter:f,isScrolling:o.props.isScrolling};return d.createElement(s,n({},m,w))},o.getCells=function(){var e=[],t=[],r=o.getSelectedColumn(),n=o.props.columns.size-1;return o.props.columns&&o.props.columns.forEach(function(i,s){s===n&&(i.isLastColumn=!0);var a=o.getCell(i,s,r);i.locked?t.push(a):e.push(a)}),e.concat(t)},o.getRowHeight=function(){var e=o.props.expandedRows||null;if(e&&o.props.idx){var t=e[o.props.idx]||null;if(t)return t.height}return o.props.height},o.getCellValue=function(e){return"select-row"===e?o.props.isSelected:"function"===typeof o.props.row.get?o.props.row.get(e):o.props.row[e]},o.isContextMenuDisplayed=function(){if(o.props.cellMetaData){var e=o.props.cellMetaData.selected;if(e&&e.contextMenuDisplayed&&e.rowIdx===o.props.idx)return!0}return!1},o.getExpandableOptions=function(e){var t=o.props.subRowDetails;return t?{canExpand:t&&t.field===e&&(t.children&&t.children.length>0||!0===t.group),field:t.field,expanded:t&&t.expanded,children:t&&t.children,treeDepth:t?t.treeDepth:0,subRowDetails:t}:{}},o.setScrollLeft=function(e){o.props.columns.forEach(function(t){if(t.locked){if(!o[t.key])return;o[t.key].setScrollLeft(e)}})},o.getKnownDivProps=function(){return m(o.props,v)},o.renderCell=function(e){return"function"===typeof o.props.cellRenderer&&o.props.cellRenderer.call(o,e),d.isValidElement(o.props.cellRenderer)?d.cloneElement(o.props.cellRenderer,e):o.props.cellRenderer(e)},l(o,r)}return u(t,e),t.prototype.shouldComponentUpdate=function(e){return(0,o.default)(e,this.props)},t.prototype.render=function(){var e=h("react-grid-Row","react-grid-Row--"+(this.props.idx%2===0?"even":"odd"),{"row-selected":this.props.isSelected,"row-context-menu":this.isContextMenuDisplayed()},this.props.extraClasses),t={height:this.getRowHeight(this.props),overflow:"hidden",contain:"layout"},r=this.getCells();return d.createElement("div",n({},this.getKnownDivProps(),{className:e,style:t,onDragEnter:this.handleDragEnter}),d.isValidElement(this.props.row)?this.props.row:r)},t}(d.Component);_.displayName="Row",_.propTypes={height:s.default.number.isRequired,columns:s.default.oneOfType([s.default.object,s.default.array]).isRequired,row:s.default.any.isRequired,cellRenderer:s.default.func,cellMetaData:s.default.shape(g),isSelected:s.default.bool,idx:s.default.number.isRequired,expandedRows:s.default.arrayOf(s.default.object),extraClasses:s.default.string,forceUpdate:s.default.bool,subRowDetails:s.default.object,isRowHovered:s.default.bool,colVisibleStart:s.default.number.isRequired,colVisibleEnd:s.default.number.isRequired,colDisplayStart:s.default.number.isRequired,colDisplayEnd:s.default.number.isRequired,isScrolling:s.default.bool.isRequired},_.defaultProps={cellRenderer:p,isSelected:!1,height:35},e.exports=_},function(e,t,r){"use strict";t.__esModule=!0,t.shouldRowUpdate=void 0;var n,i=r(32),o=(n=i)&&n.__esModule?n:{default:n};function s(e){var t=e.cellMetaData.selected;return!(!t||t.rowIdx!==e.idx)}var a=t.shouldRowUpdate=function(e,t){return!o.default.sameColumns(t.columns,e.columns,o.default.sameColumn)||s(t)||s(e)||null!=(r=e.cellMetaData.dragged)&&(r.rowIdx>=0||!0===r.complete)||e.row!==t.row||t.colDisplayStart!==e.colDisplayStart||t.colDisplayEnd!==e.colDisplayEnd||t.colVisibleStart!==e.colVisibleStart||t.colVisibleEnd!==e.colVisibleEnd||function(e){var t=e.cellMetaData.copied;return null!=t&&t.rowIdx===e.idx}(t)||t.isSelected!==e.isSelected||e.height!==t.height||t.isOver!==e.isOver||t.expandedRows!==e.expandedRows||t.canDrop!==e.canDrop||!0===t.forceUpdate||t.extraClasses!==e.extraClasses;var r};t.default=a},function(e,t){"use strict";var r={get:function(e,t){return"function"===typeof e.get?e.get(t):e[t]},isRowSelected:function(e,t,r,n,i){return t&&"[object Array]"===Object.prototype.toString.call(t)?t.indexOf(i)>-1:e&&e.rowKey&&e.values&&"[object Array]"===Object.prototype.toString.call(e.values)?e.values.indexOf(n[e.rowKey])>-1:!(!r||!n||"string"!==typeof r)&&n[r]}};e.exports=r},function(e,t,r){"use strict";t.__esModule=!0,t.SimpleRowsContainer=void 0;var n=o(r(2)),i=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){return n.default.createElement("div",{key:"rows-container"},e.rows)};s.propTypes={width:i.default.number,rows:i.default.array};var a=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,r));return n.plugins=r.window?r.window.ReactDataGridPlugins:window.ReactDataGridPlugins,n.hasContextMenu=n.hasContextMenu.bind(n),n.renderRowsWithContextMenu=n.renderRowsWithContextMenu.bind(n),n.getContextMenuContainer=n.getContextMenuContainer.bind(n),n.state={ContextMenuContainer:n.getContextMenuContainer(r)},n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getContextMenuContainer=function(){if(this.hasContextMenu()){if(!this.plugins)throw new Error("You need to include ReactDataGrid UiPlugins in order to initialise context menu");return this.plugins.Menu.ContextMenuLayer("reactDataGridContextMenu")(s)}},t.prototype.hasContextMenu=function(){return this.props.contextMenu&&n.default.isValidElement(this.props.contextMenu)},t.prototype.renderRowsWithContextMenu=function(){var e=this.state.ContextMenuContainer,t={rowIdx:this.props.rowIdx,idx:this.props.idx},r=n.default.cloneElement(this.props.contextMenu,t);return n.default.createElement("div",null,n.default.createElement(e,this.props),r)},t.prototype.render=function(){return this.hasContextMenu()?this.renderRowsWithContextMenu():n.default.createElement(s,this.props)},t}(n.default.Component);a.propTypes={contextMenu:i.default.element,rowIdx:i.default.number,idx:i.default.number,window:i.default.object},t.default=a,t.SimpleRowsContainer=s},function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var a=r(2);r(76);var c=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=n=s(this,e.call.apply(e,[this].concat(o))),n.handleChange=function(e){n.props.column.onCellChange(n.props.rowIdx,n.props.column.key,n.props.dependentValues,e)},s(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){var e=null!=this.props.value&&this.props.value,t="checkbox"+this.props.rowIdx;return a.createElement("div",{className:"react-grid-checkbox-container checkbox-align",onClick:this.handleChange},a.createElement("input",{className:"react-grid-checkbox",type:"checkbox",name:t,checked:e}),a.createElement("label",{htmlFor:t,className:"react-grid-checkbox-label"}))},t}(a.Component);c.propTypes={value:o.default.bool,rowIdx:o.default.number,column:o.default.shape({key:o.default.string,onCellChange:o.default.func}),dependentValues:o.default.object},e.exports=c},function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};var s=r(2),a=r(6),c=r(15),l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getStyle=function(){return{width:"100%"}},t.prototype.getValue=function(){var e={};return e[this.props.column.key]=this.getInputNode().value,e},t.prototype.getInputNode=function(){var e=a.findDOMNode(this);return"INPUT"===e.tagName?e:e.querySelector("input:not([type=hidden])")},t.prototype.inheritContainerStyles=function(){return!0},t}(s.Component);l.propTypes={onKeyDown:o.default.func.isRequired,value:o.default.any.isRequired,onBlur:o.default.func.isRequired,column:o.default.shape(c).isRequired,commit:o.default.func.isRequired},e.exports=l},function(e,t,r){"use strict";var n=r(2),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){var e=this;return n.createElement("input",{ref:function(t){return e.input=t},type:"text",onBlur:this.props.onBlur,className:"form-control",defaultValue:this.props.value})},t}(r(66));e.exports=i},function(e,t,r){"use strict";t.__esModule=!0;var n=o(r(2)),i=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){return n.default.createElement("div",{className:"react-grid-checkbox-container checkbox-align"},n.default.createElement("input",{className:"react-grid-checkbox",type:"checkbox",name:"select-all-checkbox",id:"select-all-checkbox",ref:e.inputRef,onChange:e.onChange}),n.default.createElement("label",{htmlFor:"select-all-checkbox",className:"react-grid-checkbox-label"}))};s.propTypes={onChange:i.default.func,inputRef:i.default.func},t.default=s},function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};var s=r(2),a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.shouldComponentUpdate=function(e){return e.value!==this.props.value},t.prototype.render=function(){return s.createElement("div",{title:this.props.value},this.props.value)},t}(s.Component);a.propTypes={value:o.default.oneOfType([o.default.string,o.default.number,o.default.object,o.default.bool]).isRequired},e.exports=a},function(e,t){"use strict";e.exports=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}},function(e,t,r){"use strict";var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(19);e.exports={isEmptyArray:r(218),isEmptyObject:r(219),isFunction:r(23),isImmutableCollection:r(220),getMixedTypeValueRetriever:r(222),isColumnsImmutable:r(72),isImmutableMap:r(221),last:function(e){if(null==e)throw new Error("arrayOrCollection is null");if(i.List.isList(e))return e.last();if(Array.isArray(e))return e[e.length-1];throw new Error("Cant get last of: "+("undefined"===typeof e?"undefined":n(e)))}}},function(e,t){"use strict";e.exports=function(e){return"undefined"!==typeof Immutable&&e instanceof Immutable.List}},function(e,t){"use strict";t.__esModule=!0,t.isKeyPrintable=function(e){return e>47&&e<58||32===e||13===e||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223},t.isCtrlKeyHeldDown=function(e){return(!0===e.ctrlKey||!0===e.metaKey)&&"Control"!==e.key}},,function(e,t){"use strict";var r=Object.prototype.hasOwnProperty;e.exports=function(e,t){if(e===t)return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var o=r.bind(t),s=0;s<n.length;s++)if(!o(n[s])||e[n[s]]!==t[n[s]])return!1;return!0}},function(e,t,r){var n=r(226);"string"===typeof n&&(n=[[e.id,n,""]]);r(11)(n,{});n.locals&&(e.exports=n.locals)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){var n;(function(){var r=this,i=r._,o=Array.prototype,s=Object.prototype,a=Function.prototype,c=o.push,l=o.slice,u=s.toString,d=s.hasOwnProperty,h=Array.isArray,p=Object.keys,f=a.bind,g=Object.create,m=function(){},y=function(e){return e instanceof y?e:this instanceof y?void(this._wrapped=e):new y(e)};"undefined"!==typeof e&&e.exports&&(t=e.exports=y),t._=y,y.VERSION="1.8.3";var v=function(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)}}return function(){return e.apply(t,arguments)}},_=function(e,t,r){return null==e?y.identity:y.isFunction(e)?v(e,t,r):y.isObject(e)?y.matcher(e):y.property(e)};y.iteratee=function(e,t){return _(e,t,1/0)};var w=function(e,t){return function(r){var n=arguments.length;if(n<2||null==r)return r;for(var i=1;i<n;i++)for(var o=arguments[i],s=e(o),a=s.length,c=0;c<a;c++){var l=s[c];t&&void 0!==r[l]||(r[l]=o[l])}return r}},S=function(e){if(!y.isObject(e))return{};if(g)return g(e);m.prototype=e;var t=new m;return m.prototype=null,t},b=function(e){return function(t){return null==t?void 0:t[e]}},x=Math.pow(2,53)-1,P=b("length"),C=function(e){var t=P(e);return"number"==typeof t&&t>=0&&t<=x};function T(e){return function(t,r,n,i){r=v(r,i,4);var o=!C(t)&&y.keys(t),s=(o||t).length,a=e>0?0:s-1;return arguments.length<3&&(n=t[o?o[a]:a],a+=e),function(t,r,n,i,o,s){for(;o>=0&&o<s;o+=e){var a=i?i[o]:o;n=r(n,t[a],a,t)}return n}(t,r,n,o,a,s)}}y.each=y.forEach=function(e,t,r){var n,i;if(t=v(t,r),C(e))for(n=0,i=e.length;n<i;n++)t(e[n],n,e);else{var o=y.keys(e);for(n=0,i=o.length;n<i;n++)t(e[o[n]],o[n],e)}return e},y.map=y.collect=function(e,t,r){t=_(t,r);for(var n=!C(e)&&y.keys(e),i=(n||e).length,o=Array(i),s=0;s<i;s++){var a=n?n[s]:s;o[s]=t(e[a],a,e)}return o},y.reduce=y.foldl=y.inject=T(1),y.reduceRight=y.foldr=T(-1),y.find=y.detect=function(e,t,r){var n;if(void 0!==(n=C(e)?y.findIndex(e,t,r):y.findKey(e,t,r))&&-1!==n)return e[n]},y.filter=y.select=function(e,t,r){var n=[];return t=_(t,r),y.each(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n},y.reject=function(e,t,r){return y.filter(e,y.negate(_(t)),r)},y.every=y.all=function(e,t,r){t=_(t,r);for(var n=!C(e)&&y.keys(e),i=(n||e).length,o=0;o<i;o++){var s=n?n[o]:o;if(!t(e[s],s,e))return!1}return!0},y.some=y.any=function(e,t,r){t=_(t,r);for(var n=!C(e)&&y.keys(e),i=(n||e).length,o=0;o<i;o++){var s=n?n[o]:o;if(t(e[s],s,e))return!0}return!1},y.contains=y.includes=y.include=function(e,t,r,n){return C(e)||(e=y.values(e)),("number"!=typeof r||n)&&(r=0),y.indexOf(e,t,r)>=0},y.invoke=function(e,t){var r=l.call(arguments,2),n=y.isFunction(t);return y.map(e,function(e){var i=n?t:e[t];return null==i?i:i.apply(e,r)})},y.pluck=function(e,t){return y.map(e,y.property(t))},y.where=function(e,t){return y.filter(e,y.matcher(t))},y.findWhere=function(e,t){return y.find(e,y.matcher(t))},y.max=function(e,t,r){var n,i,o=-1/0,s=-1/0;if(null==t&&null!=e)for(var a=0,c=(e=C(e)?e:y.values(e)).length;a<c;a++)(n=e[a])>o&&(o=n);else t=_(t,r),y.each(e,function(e,r,n){((i=t(e,r,n))>s||i===-1/0&&o===-1/0)&&(o=e,s=i)});return o},y.min=function(e,t,r){var n,i,o=1/0,s=1/0;if(null==t&&null!=e)for(var a=0,c=(e=C(e)?e:y.values(e)).length;a<c;a++)(n=e[a])<o&&(o=n);else t=_(t,r),y.each(e,function(e,r,n){((i=t(e,r,n))<s||i===1/0&&o===1/0)&&(o=e,s=i)});return o},y.shuffle=function(e){for(var t,r=C(e)?e:y.values(e),n=r.length,i=Array(n),o=0;o<n;o++)(t=y.random(0,o))!==o&&(i[o]=i[t]),i[t]=r[o];return i},y.sample=function(e,t,r){return null==t||r?(C(e)||(e=y.values(e)),e[y.random(e.length-1)]):y.shuffle(e).slice(0,Math.max(0,t))},y.sortBy=function(e,t,r){return t=_(t,r),y.pluck(y.map(e,function(e,r,n){return{value:e,index:r,criteria:t(e,r,n)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return e.index-t.index}),"value")};var M=function(e){return function(t,r,n){var i={};return r=_(r,n),y.each(t,function(n,o){var s=r(n,o,t);e(i,n,s)}),i}};y.groupBy=M(function(e,t,r){y.has(e,r)?e[r].push(t):e[r]=[t]}),y.indexBy=M(function(e,t,r){e[r]=t}),y.countBy=M(function(e,t,r){y.has(e,r)?e[r]++:e[r]=1}),y.toArray=function(e){return e?y.isArray(e)?l.call(e):C(e)?y.map(e,y.identity):y.values(e):[]},y.size=function(e){return null==e?0:C(e)?e.length:y.keys(e).length},y.partition=function(e,t,r){t=_(t,r);var n=[],i=[];return y.each(e,function(e,r,o){(t(e,r,o)?n:i).push(e)}),[n,i]},y.first=y.head=y.take=function(e,t,r){if(null!=e)return null==t||r?e[0]:y.initial(e,e.length-t)},y.initial=function(e,t,r){return l.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))},y.last=function(e,t,r){if(null!=e)return null==t||r?e[e.length-1]:y.rest(e,Math.max(0,e.length-t))},y.rest=y.tail=y.drop=function(e,t,r){return l.call(e,null==t||r?1:t)},y.compact=function(e){return y.filter(e,y.identity)};var E=function(e,t,r,n){for(var i=[],o=0,s=n||0,a=P(e);s<a;s++){var c=e[s];if(C(c)&&(y.isArray(c)||y.isArguments(c))){t||(c=E(c,t,r));var l=0,u=c.length;for(i.length+=u;l<u;)i[o++]=c[l++]}else r||(i[o++]=c)}return i};function I(e){return function(t,r,n){r=_(r,n);for(var i=P(t),o=e>0?0:i-1;o>=0&&o<i;o+=e)if(r(t[o],o,t))return o;return-1}}function A(e,t,r){return function(n,i,o){var s=0,a=P(n);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(r&&o&&a)return n[o=r(n,i)]===i?o:-1;if(i!==i)return(o=t(l.call(n,s,a),y.isNaN))>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&o<a;o+=e)if(n[o]===i)return o;return-1}}y.flatten=function(e,t){return E(e,t,!1)},y.without=function(e){return y.difference(e,l.call(arguments,1))},y.uniq=y.unique=function(e,t,r,n){y.isBoolean(t)||(n=r,r=t,t=!1),null!=r&&(r=_(r,n));for(var i=[],o=[],s=0,a=P(e);s<a;s++){var c=e[s],l=r?r(c,s,e):c;t?(s&&o===l||i.push(c),o=l):r?y.contains(o,l)||(o.push(l),i.push(c)):y.contains(i,c)||i.push(c)}return i},y.union=function(){return y.uniq(E(arguments,!0,!0))},y.intersection=function(e){for(var t=[],r=arguments.length,n=0,i=P(e);n<i;n++){var o=e[n];if(!y.contains(t,o)){for(var s=1;s<r&&y.contains(arguments[s],o);s++);s===r&&t.push(o)}}return t},y.difference=function(e){var t=E(arguments,!0,!0,1);return y.filter(e,function(e){return!y.contains(t,e)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(e){for(var t=e&&y.max(e,P).length||0,r=Array(t),n=0;n<t;n++)r[n]=y.pluck(e,n);return r},y.object=function(e,t){for(var r={},n=0,i=P(e);n<i;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},y.findIndex=I(1),y.findLastIndex=I(-1),y.sortedIndex=function(e,t,r,n){for(var i=(r=_(r,n,1))(t),o=0,s=P(e);o<s;){var a=Math.floor((o+s)/2);r(e[a])<i?o=a+1:s=a}return o},y.indexOf=A(1,y.findIndex,y.sortedIndex),y.lastIndexOf=A(-1,y.findLastIndex),y.range=function(e,t,r){null==t&&(t=e||0,e=0),r=r||1;for(var n=Math.max(Math.ceil((t-e)/r),0),i=Array(n),o=0;o<n;o++,e+=r)i[o]=e;return i};var R=function(e,t,r,n,i){if(!(n instanceof t))return e.apply(r,i);var o=S(e.prototype),s=e.apply(o,i);return y.isObject(s)?s:o};y.bind=function(e,t){if(f&&e.bind===f)return f.apply(e,l.call(arguments,1));if(!y.isFunction(e))throw new TypeError("Bind must be called on a function");var r=l.call(arguments,2),n=function(){return R(e,n,t,this,r.concat(l.call(arguments)))};return n},y.partial=function(e){var t=l.call(arguments,1),r=function(){for(var n=0,i=t.length,o=Array(i),s=0;s<i;s++)o[s]=t[s]===y?arguments[n++]:t[s];for(;n<arguments.length;)o.push(arguments[n++]);return R(e,r,this,this,o)};return r},y.bindAll=function(e){var t,r,n=arguments.length;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)e[r=arguments[t]]=y.bind(e[r],e);return e},y.memoize=function(e,t){var r=function(n){var i=r.cache,o=""+(t?t.apply(this,arguments):n);return y.has(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return r.cache={},r},y.delay=function(e,t){var r=l.call(arguments,2);return setTimeout(function(){return e.apply(null,r)},t)},y.defer=y.partial(y.delay,y,1),y.throttle=function(e,t,r){var n,i,o,s=null,a=0;r||(r={});var c=function(){a=!1===r.leading?0:y.now(),s=null,o=e.apply(n,i),s||(n=i=null)};return function(){var l=y.now();a||!1!==r.leading||(a=l);var u=t-(l-a);return n=this,i=arguments,u<=0||u>t?(s&&(clearTimeout(s),s=null),a=l,o=e.apply(n,i),s||(n=i=null)):s||!1===r.trailing||(s=setTimeout(c,u)),o}},y.debounce=function(e,t,r){var n,i,o,s,a,c=function(){var l=y.now()-s;l<t&&l>=0?n=setTimeout(c,t-l):(n=null,r||(a=e.apply(o,i),n||(o=i=null)))};return function(){o=this,i=arguments,s=y.now();var l=r&&!n;return n||(n=setTimeout(c,t)),l&&(a=e.apply(o,i),o=i=null),a}},y.wrap=function(e,t){return y.partial(t,e)},y.negate=function(e){return function(){return!e.apply(this,arguments)}},y.compose=function(){var e=arguments,t=e.length-1;return function(){for(var r=t,n=e[t].apply(this,arguments);r--;)n=e[r].call(this,n);return n}},y.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},y.before=function(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}},y.once=y.partial(y.before,2);var O=!{toString:null}.propertyIsEnumerable("toString"),D=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function k(e,t){var r=D.length,n=e.constructor,i=y.isFunction(n)&&n.prototype||s,o="constructor";for(y.has(e,o)&&!y.contains(t,o)&&t.push(o);r--;)(o=D[r])in e&&e[o]!==i[o]&&!y.contains(t,o)&&t.push(o)}y.keys=function(e){if(!y.isObject(e))return[];if(p)return p(e);var t=[];for(var r in e)y.has(e,r)&&t.push(r);return O&&k(e,t),t},y.allKeys=function(e){if(!y.isObject(e))return[];var t=[];for(var r in e)t.push(r);return O&&k(e,t),t},y.values=function(e){for(var t=y.keys(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=e[t[i]];return n},y.mapObject=function(e,t,r){t=_(t,r);for(var n,i=y.keys(e),o=i.length,s={},a=0;a<o;a++)s[n=i[a]]=t(e[n],n,e);return s},y.pairs=function(e){for(var t=y.keys(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=[t[i],e[t[i]]];return n},y.invert=function(e){for(var t={},r=y.keys(e),n=0,i=r.length;n<i;n++)t[e[r[n]]]=r[n];return t},y.functions=y.methods=function(e){var t=[];for(var r in e)y.isFunction(e[r])&&t.push(r);return t.sort()},y.extend=w(y.allKeys),y.extendOwn=y.assign=w(y.keys),y.findKey=function(e,t,r){t=_(t,r);for(var n,i=y.keys(e),o=0,s=i.length;o<s;o++)if(t(e[n=i[o]],n,e))return n},y.pick=function(e,t,r){var n,i,o={},s=e;if(null==s)return o;y.isFunction(t)?(i=y.allKeys(s),n=v(t,r)):(i=E(arguments,!1,!1,1),n=function(e,t,r){return t in r},s=Object(s));for(var a=0,c=i.length;a<c;a++){var l=i[a],u=s[l];n(u,l,s)&&(o[l]=u)}return o},y.omit=function(e,t,r){if(y.isFunction(t))t=y.negate(t);else{var n=y.map(E(arguments,!1,!1,1),String);t=function(e,t){return!y.contains(n,t)}}return y.pick(e,t,r)},y.defaults=w(y.allKeys,!0),y.create=function(e,t){var r=S(e);return t&&y.extendOwn(r,t),r},y.clone=function(e){return y.isObject(e)?y.isArray(e)?e.slice():y.extend({},e):e},y.tap=function(e,t){return t(e),e},y.isMatch=function(e,t){var r=y.keys(t),n=r.length;if(null==e)return!n;for(var i=Object(e),o=0;o<n;o++){var s=r[o];if(t[s]!==i[s]||!(s in i))return!1}return!0};var F=function(e,t,r,n){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof y&&(e=e._wrapped),t instanceof y&&(t=t._wrapped);var i=u.call(e);if(i!==u.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e===""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(y.isFunction(s)&&s instanceof s&&y.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}r=r||[],n=n||[];for(var c=r.length;c--;)if(r[c]===e)return n[c]===t;if(r.push(e),n.push(t),o){if((c=e.length)!==t.length)return!1;for(;c--;)if(!F(e[c],t[c],r,n))return!1}else{var l,d=y.keys(e);if(c=d.length,y.keys(t).length!==c)return!1;for(;c--;)if(l=d[c],!y.has(t,l)||!F(e[l],t[l],r,n))return!1}return r.pop(),n.pop(),!0};y.isEqual=function(e,t){return F(e,t)},y.isEmpty=function(e){return null==e||(C(e)&&(y.isArray(e)||y.isString(e)||y.isArguments(e))?0===e.length:0===y.keys(e).length)},y.isElement=function(e){return!(!e||1!==e.nodeType)},y.isArray=h||function(e){return"[object Array]"===u.call(e)},y.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){y["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),y.isArguments(arguments)||(y.isArguments=function(e){return y.has(e,"callee")}),"object"!=typeof Int8Array&&(y.isFunction=function(e){return"function"==typeof e||!1}),y.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},y.isNaN=function(e){return y.isNumber(e)&&e!==+e},y.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===u.call(e)},y.isNull=function(e){return null===e},y.isUndefined=function(e){return void 0===e},y.has=function(e,t){return null!=e&&d.call(e,t)},y.noConflict=function(){return r._=i,this},y.identity=function(e){return e},y.constant=function(e){return function(){return e}},y.noop=function(){},y.property=b,y.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},y.matcher=y.matches=function(e){return e=y.extendOwn({},e),function(t){return y.isMatch(t,e)}},y.times=function(e,t,r){var n=Array(Math.max(0,e));t=v(t,r,1);for(var i=0;i<e;i++)n[i]=t(i);return n},y.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},y.now=Date.now||function(){return(new Date).getTime()};var N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},L=y.invert(N),B=function(e){var t=function(t){return e[t]},r="(?:"+y.keys(e).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(i,t):e}};y.escape=B(N),y.unescape=B(L),y.result=function(e,t,r){var n=null==e?void 0:e[t];return void 0===n&&(n=r),y.isFunction(n)?n.call(e):n};var V=0;y.uniqueId=function(e){var t=++V+"";return e?e+t:t},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\u2028|\u2029/g,G=function(e){return"\\"+z[e]};y.template=function(e,t,r){!t&&r&&(t=r),t=y.defaults({},t,y.templateSettings);var n=RegExp([(t.escape||U).source,(t.interpolate||U).source,(t.evaluate||U).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(n,function(t,r,n,s,a){return o+=e.slice(i,a).replace(j,G),i=a+t.length,r?o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var a=function(e){return s.call(this,e,y)},c=t.variable||"obj";return a.source="function("+c+"){\n"+o+"}",a},y.chain=function(e){var t=y(e);return t._chain=!0,t};var H=function(e,t){return e._chain?y(t).chain():t};y.mixin=function(e){y.each(y.functions(e),function(t){var r=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),H(this,r.apply(y,e))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];y.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==e&&"splice"!==e||0!==r.length||delete r[0],H(this,r)}}),y.each(["concat","join","slice"],function(e){var t=o[e];y.prototype[e]=function(){return H(this,t.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},void 0===(n=function(){return y}.apply(t,[]))||(e.exports=n)}).call(this)},,function(e,t,r){"use strict";var n=r(114),i=r(115),o=r(113);e.exports=function(){function e(e,t,r,n,s,a){a!==o&&i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return r.checkPropTypes=n,r.PropTypes=r,r}},function(e,t){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t){"use strict";function r(e){return function(){return e}}var n=function(){};n.thatReturns=r,n.thatReturnsFalse=r(!1),n.thatReturnsTrue=r(!0),n.thatReturnsNull=r(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(e){return e},e.exports=n},function(e,t,r){"use strict";var n=function(e){};e.exports=function(e,t,r,i,o,s,a,c){if(n(t),!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[r,i,o,s,a,c],d=0;(l=new Error(t.replace(/%s/g,function(){return u[d++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=l(r(3)),o=r(223),s=l(r(75)),a=l(r(64)),c=l(r(207));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var d=r(2),h=r(7),p=r(61),f=r(12),g=r(63);r(26);var m=function(e){function t(){var r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,a=Array(s),l=0;l<s;l++)a[l]=arguments[l];return r=i=u(this,e.call.apply(e,[this].concat(a))),i.state={displayStart:i.props.displayStart,displayEnd:i.props.displayEnd,scrollingTimeout:null},i._currentRowsLength=0,i._currentRowsRange={start:0,end:0},i._scroll={scrollTop:0,scrollLeft:0},i.appendScrollShim=function(){if(!i._scrollShim){var e=i._scrollShimSize(),t=(0,o.createScrollShim)(e);i.canvas.appendChild(t),i._scrollShim=t}i._scheduleRemoveScrollShim()},i._scrollShimSize=function(){return{width:i.props.width,height:i.props.length*i.props.rowHeight}},i._scheduleRemoveScrollShim=function(){i._scheduleRemoveScrollShimTimer&&clearTimeout(i._scheduleRemoveScrollShimTimer),i._scheduleRemoveScrollShimTimer=setTimeout(i._removeScrollShim,200)},i._removeScrollShim=function(){i._scrollShim&&(i._scrollShim.parentNode.removeChild(i._scrollShim),i._scrollShim=void 0)},i.onRows=function(){i._currentRowsRange!=={start:0,end:0}&&(i.props.onRows(i._currentRowsRange),i._currentRowsRange={start:0,end:0})},i.onScroll=function(e){if(i.canvas===e.target){i.appendScrollShim();var t=e.target.scrollLeft,r={scrollTop:e.target.scrollTop,scrollLeft:t};i._scroll=r,i.props.onScroll(r)}},i.getRows=function(e,t){if(i._currentRowsRange={start:e,end:t},Array.isArray(i.props.rowGetter))return i.props.rowGetter.slice(e,t);for(var r=[],n=e;n<t;){var o=i.props.rowGetter(n),s={};i.props.getSubRowDetails&&(s=i.props.getSubRowDetails(o)),r.push({row:o,subRowDetails:s}),n++}return r},i.getScrollbarWidth=function(){return i.canvas.offsetWidth-i.canvas.clientWidth},i.getScroll=function(){var e=i.canvas;return{scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}},i.isRowSelected=function(e,t){if(null!==i.props.selectedRows){var r=i.props.selectedRows.filter(function(e){var r=t.get?t.get(i.props.rowKey):t[i.props.rowKey];return e[i.props.rowKey]===r});return r.length>0&&r[0].isSelected}if(i.props.rowSelection){var n=i.props.rowSelection,o=n.keys,s=n.indexes,a=n.isSelectedKey;return g.isRowSelected(o,s,a,t,e)}return!1},i.setScrollLeft=function(e){if(0!==i._currentRowsLength){if(!i.rows)return;for(var t=0,r=i._currentRowsLength;t<r;t++)if(i.rows[t]){var n=i.getRowByRef(t);n&&n.setScrollLeft&&n.setScrollLeft(e)}}},i.getRowByRef=function(e){var t=i.rows[e].getDecoratedComponentInstance?i.rows[e].getDecoratedComponentInstance(e):null;return t?t.row:i.rows[e]},i.renderRow=function(e){var t=e.row;if(t.__metaData&&t.__metaData.getRowRenderer)return t.__metaData.getRowRenderer(i.props,e.idx);if(t.__metaData&&t.__metaData.isGroup)return d.createElement(c.default,n({},e,t.__metaData,{name:t.name,renderer:i.props.rowGroupRenderer}));var r=i.props.rowRenderer;return"function"===typeof r?d.createElement(r,e):d.isValidElement(i.props.rowRenderer)?d.cloneElement(i.props.rowRenderer,e):void 0},i.renderPlaceholder=function(e,t){return d.createElement("div",{key:e,style:{height:t}},i.props.columns.map(function(e,t){return d.createElement("div",{style:{width:e.width},key:t})}))},u(i,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillMount=function(){this.rows=[],this._currentRowsLength=0,this._currentRowsRange={start:0,end:0},this._scroll={scrollTop:0,scrollLeft:0}},t.prototype.componentDidMount=function(){this.onRows()},t.prototype.componentWillReceiveProps=function(e){e.displayStart===this.state.displayStart&&e.displayEnd===this.state.displayEnd||this.setState({displayStart:e.displayStart,displayEnd:e.displayEnd})},t.prototype.shouldComponentUpdate=function(e,t){return t.displayStart!==this.state.displayStart||t.displayEnd!==this.state.displayEnd||t.scrollingTimeout!==this.state.scrollingTimeout||this.props.scrollToRowIndex!==e.scrollToRowIndex||e.rowsCount!==this.props.rowsCount||e.rowHeight!==this.props.rowHeight||e.columns!==this.props.columns||e.width!==this.props.width||e.height!==this.props.height||e.cellMetaData!==this.props.cellMetaData||this.props.colDisplayStart!==e.colDisplayStart||this.props.colDisplayEnd!==e.colDisplayEnd||this.props.colVisibleStart!==e.colVisibleStart||this.props.colVisibleEnd!==e.colVisibleEnd||!(0,s.default)(e.style,this.props.style)||this.props.isScrolling!==e.isScrolling},t.prototype.componentWillUnmount=function(){this._currentRowsLength=0,this._currentRowsRange={start:0,end:0},this._scroll={scrollTop:0,scrollLeft:0}},t.prototype.componentDidUpdate=function(){0!==this._scroll.scrollTop&&0!==this._scroll.scrollLeft&&this.setScrollLeft(this._scroll.scrollLeft),0!==this.props.scrollToRowIndex&&(this.canvas.scrollTop=Math.min(this.props.scrollToRowIndex*this.props.rowHeight,this.props.rowsCount*this.props.rowHeight-this.props.height)),this.onRows()},t.prototype.render=function(){var e=this,t=this.state,r=t.displayStart,n=t.displayEnd,i=this.props,o=i.rowHeight,s=i.rowsCount,c=this.getRows(r,n).map(function(t,i){return e.renderRow({key:"row-"+(r+i),ref:function(t){return e.rows[i]=t},idx:r+i,visibleStart:e.props.visibleStart,visibleEnd:e.props.visibleEnd,row:t.row,height:o,onMouseOver:e.onMouseOver,columns:e.props.columns,isSelected:e.isRowSelected(r+i,t.row,r,n),expandedRows:e.props.expandedRows,cellMetaData:e.props.cellMetaData,subRowDetails:t.subRowDetails,colVisibleStart:e.props.colVisibleStart,colVisibleEnd:e.props.colVisibleEnd,colDisplayStart:e.props.colDisplayStart,colDisplayEnd:e.props.colDisplayEnd,isScrolling:e.props.isScrolling})});this._currentRowsLength=c.length,r>0&&c.unshift(this.renderPlaceholder("top",r*o)),s-n>0&&c.push(this.renderPlaceholder("bottom",(s-n)*o));var l={position:"absolute",top:0,left:0,overflowX:"auto",overflowY:"scroll",width:this.props.totalWidth,height:this.props.height};return d.createElement("div",{ref:function(t){e.canvas=t},style:l,onScroll:this.onScroll,className:h("react-grid-Canvas",this.props.className,{opaque:this.props.cellMetaData.selected&&this.props.cellMetaData.selected.active})},d.createElement(a.default,{width:this.props.width,rows:c,contextMenu:this.props.contextMenu,rowIdx:this.props.cellMetaData.selected.rowIdx,idx:this.props.cellMetaData.selected.idx}))},t}(d.Component);m.displayName="Canvas",m.propTypes={rowRenderer:i.default.oneOfType([i.default.func,i.default.element]),rowHeight:i.default.number.isRequired,height:i.default.number.isRequired,width:i.default.number,totalWidth:i.default.oneOfType([i.default.number,i.default.string]),style:i.default.string,className:i.default.string,displayStart:i.default.number.isRequired,displayEnd:i.default.number.isRequired,visibleStart:i.default.number.isRequired,visibleEnd:i.default.number.isRequired,colVisibleStart:i.default.number.isRequired,colVisibleEnd:i.default.number.isRequired,colDisplayStart:i.default.number.isRequired,colDisplayEnd:i.default.number.isRequired,rowsCount:i.default.number.isRequired,rowGetter:i.default.oneOfType([i.default.func.isRequired,i.default.array.isRequired]),expandedRows:i.default.array,onRows:i.default.func,onScroll:i.default.func,columns:i.default.oneOfType([i.default.object,i.default.array]).isRequired,cellMetaData:i.default.shape(f).isRequired,selectedRows:i.default.array,rowKey:i.default.string,rowScrollTimeout:i.default.number,scrollToRowIndex:i.default.number,contextMenu:i.default.element,getSubRowDetails:i.default.func,rowSelection:i.default.oneOfType([i.default.shape({indexes:i.default.arrayOf(i.default.number).isRequired}),i.default.shape({isSelectedKey:i.default.string.isRequired}),i.default.shape({keys:i.default.shape({values:i.default.array.isRequired,rowKey:i.default.string.isRequired}).isRequired})]),rowGroupRenderer:i.default.func,isScrolling:i.default.bool,length:i.default.number},m.defaultProps={rowRenderer:p,onRows:function(){},selectedRows:[],rowScrollTimeout:0},e.exports=m},function(e,t,r){"use strict";t.__esModule=!0;var n=a(r(7)),i=a(r(2)),o=a(r(3)),s=a(r(203));function a(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var l=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),a=0;a<o;a++)s[a]=arguments[a];return r=n=c(this,e.call.apply(e,[this].concat(s))),n.state={isMenuOpen:!1},n.onToggleMenu=function(){n.setState(function(e){return{isMenuOpen:!e.isMenuOpen}})},n.onHideMenu=function(){n.setState({isMenuOpen:!1})},n.onGetMenuOptions=function(){return n.props.action.actions.map(function(e,t){return i.default.createElement("span",{key:t,onClick:e.callback},e.text)})},n.isActionMenu=function(){return!n.props.action.callback&&n.props.action.actions&&n.props.action.actions.length},n.onActionButtonBlur=function(){n.isActionMenu()&&n.onHideMenu()},n.onActionIconClick=function(){n.isActionMenu()?n.props.action.actions&&n.props.action.actions.length&&n.onToggleMenu():n.props.action.callback()},c(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){var e=this.isActionMenu(),t=(0,n.default)("rdg-cell-action",{"rdg-cell-action-last":this.props.isFirst}),r=(0,n.default)("rdg-cell-action-button",{"rdg-cell-action-button-toggled":this.state.isMenuOpen});return i.default.createElement("div",{className:t,onMouseLeave:this.onActionButtonBlur},i.default.createElement("div",{className:r,onClick:this.onActionIconClick},i.default.createElement("span",{className:this.props.action.icon})),e&&this.state.isMenuOpen&&i.default.createElement("div",{className:"rdg-cell-action-menu"},this.onGetMenuOptions()))},t}(i.default.Component);l.propTypes={action:o.default.shape(s.default).isRequired,isFirst:o.default.bool.isRequired},t.default=l},function(e,t,r){"use strict";t.__esModule=!0;var n=s(r(2)),i=s(r(3)),o=s(r(31));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,r));n.onCellExpand=function(e){n.setState({expanded:!n.state.expanded}),n.props.onCellExpand(e)};var i=r.expandableOptions&&r.expandableOptions.expanded;return n.state={expanded:i},n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillReceiveProps=function(e){var t=e.expandableOptions&&e.expandableOptions.expanded;this.state.expanded!==t&&this.setState({expanded:t})},t.prototype.render=function(){return n.default.createElement("span",{className:"rdg-cell-expand",onClick:this.onCellExpand},this.state.expanded?o.default.CellExpand.DOWN_TRIANGLE:o.default.CellExpand.RIGHT_TRIANGLE)},t}(n.default.Component);a.propTypes={expandableOptions:i.default.object.isRequired,onCellExpand:i.default.func.isRequired},t.default=a},function(e,t,r){"use strict";t.__esModule=!0;var n=o(r(2)),i=o(r(7));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.treeDepth,r=e.cellHeight,o=e.siblingIndex,s=e.numberSiblings,a=e.onDeleteSubRow,c=e.isDeleteSubRowEnabled,l=e.allowAddChildRow,u=void 0===l||l,d=o===s-1,h=(0,i.default)({"rdg-child-row-action-cross":!0===u||!d},{"rdg-child-row-action-cross-last":!1===u&&(d||1===s)}),p=15*t,f=(r-12)/2;return n.default.createElement("div",null,n.default.createElement("div",{className:h}),c&&n.default.createElement("div",{style:{left:p,top:f,width:12,height:12},className:"rdg-child-row-btn",onClick:a},n.default.createElement("div",{className:"glyphicon glyphicon-remove-sign"})))}},function(e,t,r){"use strict";var n=r(2).isValidElement;e.exports=function(e,t){var r=void 0;for(r in e)if(e.hasOwnProperty(r)){if("function"===typeof e[r]&&"function"===typeof t[r]||n(e[r])&&n(t[r]))continue;if(!t.hasOwnProperty(r)||e[r]!==t[r])return!1}for(r in t)if(t.hasOwnProperty(r)&&!e.hasOwnProperty(r))return!1;return!0}},function(e,t,r){"use strict";var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(3),s=(n=o)&&n.__esModule?n:{default:n};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var c=r(2),l=r(18);r(20);var u=["onDragStart","onDragEnd","onDrag","style"],d=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];return r=n=a(this,e.call.apply(e,[this].concat(o))),n.state={drag:null},n.onMouseDown=function(e){var t=n.props.onDragStart(e);null===t&&0!==e.button||(window.addEventListener("mouseup",n.onMouseUp),window.addEventListener("mousemove",n.onMouseMove),window.addEventListener("touchend",n.onMouseUp),window.addEventListener("touchmove",n.onMouseMove),n.setState({drag:t}))},n.onMouseMove=function(e){null!==n.state.drag&&(e.preventDefault&&e.preventDefault(),n.props.onDrag(e))},n.onMouseUp=function(e){n.cleanUp(),n.props.onDragEnd(e,n.state.drag),n.setState({drag:null})},n.cleanUp=function(){window.removeEventListener("mouseup",n.onMouseUp),window.removeEventListener("mousemove",n.onMouseMove),window.removeEventListener("touchend",n.onMouseUp),window.removeEventListener("touchmove",n.onMouseMove)},n.getKnownDivProps=function(){return l(n.props,u)},a(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillUnmount=function(){this.cleanUp()},t.prototype.render=function(){return c.createElement("div",i({},this.getKnownDivProps(),{onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,className:"react-grid-HeaderCell__draggable"}))},t}(c.Component);d.propTypes={onDragStart:s.default.func,onDragEnd:s.default.func,onDrag:s.default.func,component:s.default.oneOfType([s.default.func,s.default.constructor]),style:s.default.object},d.defaultProps={onDragStart:function(){return!0},onDragEnd:function(){},onDrag:function(){}},e.exports=d},function(e,t,r){"use strict";t.__esModule=!0;var n=s(r(2)),i=s(r(3)),o=s(r(8));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return r.onAddSubRow=r.onAddSubRow.bind(r),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onAddSubRow=function(){this.props.onAddSubRow(this.props.parentRowId)},t.prototype.getFixedColumnsWidth=function(){for(var e=0,t=o.default.getSize(this.props.columns),r=0;r<t;r++){var n=o.default.getColumn(this.props.columns,r);n&&o.default.getValue(n,"locked")&&(e+=o.default.getValue(n,"width"))}return e},t.prototype.render=function(){var e=this,t=this.props,r=t.cellHeight,i=15*t.treeDepth,s=(r-12)/2,a={height:r,borderBottom:"1px solid #dddddd"},c=o.default.getColumn(this.props.columns.filter(function(t){return t.key===e.props.expandColumnKey}),0),l=c?c.left:0;return n.default.createElement("div",{className:"react-grid-Row rdg-add-child-row-container",style:a},n.default.createElement("div",{className:"react-grid-Cell",style:{position:"absolute",height:r,width:"100%",left:l}},n.default.createElement("div",{className:"rdg-empty-child-row",style:{marginLeft:"30px",lineHeight:r+"px"}},n.default.createElement("div",{className:"'rdg-child-row-action-cross rdg-child-row-action-cross-last"}),n.default.createElement("div",{style:{left:i,top:s,width:12,height:12},className:"rdg-child-row-btn",onClick:this.onAddSubRow},n.default.createElement("div",{className:"glyphicon glyphicon-plus-sign"})))))},t}(n.default.Component);a.propTypes={treeDepth:i.default.number.isRequired,cellHeight:i.default.number.isRequired,onAddSubRow:i.default.func.isRequired,parentRowId:i.default.number,columns:i.default.array.isRequired,expandColumnKey:i.default.string.isRequired},t.default=a},function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var a=r(2),c=r(6),l=r(198),u=r(208),d=r(12);r(26);var h=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=n=s(this,e.call.apply(e,[this].concat(o))),n.getStyle=function(){return{overflow:"hidden",outline:0,position:"relative",minHeight:n.props.minHeight}},n._onScroll=function(){void 0!==n._scrollLeft&&(n.header.setScrollLeft(n._scrollLeft),n.viewport&&n.viewport.setScrollLeft(n._scrollLeft))},n.onScroll=function(e){n._scrollLeft!==e.scrollLeft&&(n._scrollLeft=e.scrollLeft,n._onScroll())},n.onHeaderScroll=function(e){var t=e.target.scrollLeft;n._scrollLeft!==t&&(n._scrollLeft=t,n.header.setScrollLeft(t),c.findDOMNode(n.viewport.canvas).scrollLeft=t,n.viewport.canvas.setScrollLeft(t))},s(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){this._scrollLeft=this.viewport?this.viewport.getScroll().scrollLeft:0,this._onScroll()},t.prototype.componentDidUpdate=function(){this._onScroll()},t.prototype.componentWillMount=function(){this._scrollLeft=void 0},t.prototype.componentWillUnmount=function(){this._scrollLeft=void 0},t.prototype.render=function(){var e=this,t=this.props.headerRows||[{ref:function(t){return e.row=t}}],r=this.props.emptyRowsView;return a.createElement("div",{style:this.getStyle(),className:"react-grid-Grid"},a.createElement(l,{ref:function(t){e.header=t},columnMetrics:this.props.columnMetrics,onColumnResize:this.props.onColumnResize,height:this.props.rowHeight,totalWidth:this.props.totalWidth,headerRows:t,sortColumn:this.props.sortColumn,sortDirection:this.props.sortDirection,draggableHeaderCell:this.props.draggableHeaderCell,onSort:this.props.onSort,onHeaderDrop:this.props.onHeaderDrop,onScroll:this.onHeaderScroll,getValidFilterValues:this.props.getValidFilterValues,cellMetaData:this.props.cellMetaData}),this.props.rowsCount>=1||0===this.props.rowsCount&&!this.props.emptyRowsView?a.createElement("div",{ref:function(t){e.viewPortContainer=t},tabIndex:this.props.tabIndex,onKeyDown:this.props.onViewportKeydown,onKeyUp:this.props.onViewportKeyup,onClick:this.props.onViewportClick,onDoubleClick:this.props.onViewportDoubleClick,onDragStart:this.props.onViewportDragStart,onDragEnd:this.props.onViewportDragEnd},a.createElement(u,{ref:function(t){e.viewport=t},rowKey:this.props.rowKey,width:this.props.columnMetrics.width,rowHeight:this.props.rowHeight,rowRenderer:this.props.rowRenderer,rowGetter:this.props.rowGetter,rowsCount:this.props.rowsCount,selectedRows:this.props.selectedRows,expandedRows:this.props.expandedRows,columnMetrics:this.props.columnMetrics,totalWidth:this.props.totalWidth,onScroll:this.onScroll,onRows:this.props.onRows,cellMetaData:this.props.cellMetaData,rowOffsetHeight:this.props.rowOffsetHeight||this.props.rowHeight*t.length,minHeight:this.props.minHeight,rowScrollTimeout:this.props.rowScrollTimeout,scrollToRowIndex:this.props.scrollToRowIndex,contextMenu:this.props.contextMenu,rowSelection:this.props.rowSelection,getSubRowDetails:this.props.getSubRowDetails,rowGroupRenderer:this.props.rowGroupRenderer,overScan:this.props.overScan})):a.createElement("div",{ref:function(t){e.emptyView=t},className:"react-grid-Empty"},a.createElement(r,null)))},t}(a.Component);h.displayName="Grid",h.propTypes={rowGetter:o.default.oneOfType([o.default.array,o.default.func]).isRequired,columns:o.default.oneOfType([o.default.array,o.default.object]),tabIndex:o.default.number,columnMetrics:o.default.object,minHeight:o.default.number,totalWidth:o.default.oneOfType([o.default.number,o.default.string]),headerRows:o.default.oneOfType([o.default.array,o.default.func]),rowHeight:o.default.number,rowRenderer:o.default.oneOfType([o.default.element,o.default.func]),emptyRowsView:o.default.func,expandedRows:o.default.oneOfType([o.default.array,o.default.func]),selectedRows:o.default.oneOfType([o.default.array,o.default.func]),rowSelection:o.default.oneOfType([o.default.shape({indexes:o.default.arrayOf(o.default.number).isRequired}),o.default.shape({isSelectedKey:o.default.string.isRequired}),o.default.shape({keys:o.default.shape({values:o.default.array.isRequired,rowKey:o.default.string.isRequired}).isRequired})]),rowsCount:o.default.number,onRows:o.default.func,sortColumn:o.default.string,sortDirection:o.default.oneOf(["ASC","DESC","NONE"]),rowOffsetHeight:o.default.number.isRequired,onViewportKeydown:o.default.func.isRequired,onViewportKeyup:o.default.func,onViewportDragStart:o.default.func.isRequired,onViewportDragEnd:o.default.func.isRequired,onViewportClick:o.default.func.isRequired,onViewportDoubleClick:o.default.func.isRequired,onColumnResize:o.default.func,onSort:o.default.func,onHeaderDrop:o.default.func,cellMetaData:o.default.shape(d),rowKey:o.default.string.isRequired,rowScrollTimeout:o.default.number,scrollToRowIndex:o.default.number,contextMenu:o.default.element,getSubRowDetails:o.default.func,draggableHeaderCell:o.default.func,getValidFilterValues:o.default.func,rowGroupRenderer:o.default.func,overScan:o.default.object},h.defaultProps={rowHeight:35,minHeight:350,tabIndex:0},e.exports=h},function(e,t,r){"use strict";var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(3),s=(n=o)&&n.__esModule?n:{default:n};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var c=r(2),l=r(6),u=r(7),d=r(70),h=r(32),p=r(8),f=r(200),g=r(33),m=r(18),y=r(12);r(20);var v=["height","onScroll"],_=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];return r=n=a(this,e.call.apply(e,[this].concat(o))),n.state={resizing:null},n.onColumnResize=function(e,t){var r=n.state.resizing||n.props,i=n.getColumnPosition(e);if(null!=i){var o={columnMetrics:d(r.columnMetrics)};o.columnMetrics=h.resizeColumn(o.columnMetrics,i,t),o.columnMetrics.totalWidth<r.columnMetrics.totalWidth&&(o.columnMetrics.totalWidth=r.columnMetrics.totalWidth),o.column=p.getColumn(o.columnMetrics.columns,i),n.setState({resizing:o})}},n.onColumnResizeEnd=function(e,t){var r=n.getColumnPosition(e);null!==r&&n.props.onColumnResize&&n.props.onColumnResize(r,t||e.width)},n.getHeaderRows=function(){var e=n.getColumnMetrics(),t=void 0;n.state.resizing&&(t=n.state.resizing.column);var r=[];return n.props.headerRows.forEach(function(i,o){var s="auto";"filter"===i.rowType&&(s="500px");var a=g()>0?g():0,l=isNaN(n.props.totalWidth-a)?n.props.totalWidth:n.props.totalWidth-a,u={position:"absolute",top:n.getCombinedHeaderHeights(o),left:0,width:l,overflowX:"hidden",minHeight:s};r.push(c.createElement(f,{key:i.ref,ref:function(e){return"filter"===i.rowType?n.filterRow=e:n.row=e},rowType:i.rowType,style:u,onColumnResize:n.onColumnResize,onColumnResizeEnd:n.onColumnResizeEnd,width:e.width,height:i.height||n.props.height,columns:e.columns,resizing:t,draggableHeaderCell:n.props.draggableHeaderCell,filterable:i.filterable,onFilterChange:i.onFilterChange,onHeaderDrop:n.props.onHeaderDrop,sortColumn:n.props.sortColumn,sortDirection:n.props.sortDirection,onSort:n.props.onSort,onScroll:n.props.onScroll,getValidFilterValues:n.props.getValidFilterValues}))}),r},n.getColumnMetrics=function(){return n.state.resizing?n.state.resizing.columnMetrics:n.props.columnMetrics},n.getColumnPosition=function(e){var t=-1;return n.getColumnMetrics().columns.forEach(function(r,n){r.key===e.key&&(t=n)}),-1===t?null:t},n.getCombinedHeaderHeights=function(e){var t=n.props.headerRows.length;"undefined"!==typeof e&&(t=e);for(var r=0,i=0;i<t;i++)r+=n.props.headerRows[i].height||n.props.height;return r},n.getStyle=function(){return{position:"relative",height:n.getCombinedHeaderHeights()}},n.setScrollLeft=function(e){(l.findDOMNode(n.row).scrollLeft=e,n.row.setScrollLeft(e),n.filterRow)&&(l.findDOMNode(n.filterRow).scrollLeft=e,n.filterRow.setScrollLeft(e))},n.getKnownDivProps=function(){return m(n.props,v)},n.onHeaderClick=function(){n.props.cellMetaData.onCellClick({rowIdx:-1,idx:-1})},a(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillReceiveProps=function(){this.setState({resizing:null})},t.prototype.shouldComponentUpdate=function(e,t){return!h.sameColumns(this.props.columnMetrics.columns,e.columnMetrics.columns,h.sameColumn)||this.props.totalWidth!==e.totalWidth||this.props.headerRows.length!==e.headerRows.length||this.state.resizing!==t.resizing||this.props.sortColumn!==e.sortColumn||this.props.sortDirection!==e.sortDirection},t.prototype.render=function(){var e=u({"react-grid-Header":!0,"react-grid-Header--resizing":!!this.state.resizing}),t=this.getHeaderRows();return c.createElement("div",i({},this.getKnownDivProps(),{style:this.getStyle(),className:e,onClick:this.onHeaderClick}),t)},t}(c.Component);_.propTypes={columnMetrics:s.default.shape({width:s.default.number.isRequired,columns:s.default.any}).isRequired,totalWidth:s.default.oneOfType([s.default.number,s.default.string]),height:s.default.number.isRequired,headerRows:s.default.array.isRequired,sortColumn:s.default.string,sortDirection:s.default.oneOf(["ASC","DESC","NONE"]),onSort:s.default.func,onColumnResize:s.default.func,onScroll:s.default.func,onHeaderDrop:s.default.func,draggableHeaderCell:s.default.func,getValidFilterValues:s.default.func,cellMetaData:s.default.shape(y)},e.exports=_},function(e,t){"use strict";e.exports={SORTABLE:0,FILTERABLE:1,NONE:2,CHECKBOX:3}},function(e,t,r){"use strict";var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(3),s=(n=o)&&n.__esModule?n:{default:n};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var c=r(2),l=r(75),u=r(60),d=r(33),h=(r(15),r(8)),p=r(210),f=r(209),g=r(199),m=r(18);r(20);var y={overflow:s.default.string,width:s.default.oneOfType([s.default.number,s.default.string]),height:s.default.number,position:s.default.string},v=["width","height","style","onScroll"],_=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return r=n=a(this,e.call.apply(e,[this].concat(s))),n.getHeaderCellType=function(e){return e.filterable&&n.props.filterable?g.FILTERABLE:e.sortable&&"filter"!==e.rowType?g.SORTABLE:g.NONE},n.getFilterableHeaderCell=function(e){var t=f;return void 0!==e.filterRenderer&&(t=e.filterRenderer),c.createElement(t,i({},n.props,{onChange:n.props.onFilterChange}))},n.getSortableHeaderCell=function(e){var t=n.props.sortColumn===e.key?n.props.sortDirection:p.DEFINE_SORT.NONE,r=void 0!==e.sortDescendingFirst&&e.sortDescendingFirst;return c.createElement(p,{columnKey:e.key,onSort:n.props.onSort,sortDirection:t,sortDescendingFirst:r})},n.getHeaderRenderer=function(e){var t=void 0;if(e.headerRenderer&&!n.props.filterable)t=e.headerRenderer;else switch(n.getHeaderCellType(e)){case g.SORTABLE:t=n.getSortableHeaderCell(e);break;case g.FILTERABLE:t=n.getFilterableHeaderCell(e)}return t},n.getStyle=function(){return{overflow:"hidden",width:"100%",height:n.props.height,position:"absolute"}},n.getCells=function(){for(var e=[],t=[],r=function(r,i){var o=Object.assign({rowType:n.props.rowType},h.getColumn(n.props.columns,r)),s=n.getHeaderRenderer(o);"select-row"===o.key&&"filter"===n.props.rowType&&(s=c.createElement("div",null));var a=o.draggable?n.props.draggableHeaderCell:u,l=c.createElement(a,{ref:function(e){return n.cells[r]=e},key:r,height:n.props.height,column:o,renderer:s,resizing:n.props.resizing===o,onResize:n.props.onColumnResize,onResizeEnd:n.props.onColumnResizeEnd,onHeaderDrop:n.props.onHeaderDrop});o.locked?t.push(l):e.push(l)},i=0,o=h.getSize(n.props.columns);i<o;i++)r(i);return e.concat(t)},n.setScrollLeft=function(e){n.props.columns.forEach(function(t,r){t.locked?n.cells[r].setScrollLeft(e):n.cells[r]&&n.cells[r].removeScroll&&n.cells[r].removeScroll()})},n.getKnownDivProps=function(){return m(n.props,v)},a(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillMount=function(){this.cells=[]},t.prototype.shouldComponentUpdate=function(e){return e.width!==this.props.width||e.height!==this.props.height||e.columns!==this.props.columns||!l(e.style,this.props.style)||this.props.sortColumn!==e.sortColumn||this.props.sortDirection!==e.sortDirection},t.prototype.render=function(){var e={width:this.props.width?this.props.width+d():"100%",height:this.props.height,whiteSpace:"nowrap",overflowX:"hidden",overflowY:"hidden"},t=this.getCells();return c.createElement("div",i({},this.getKnownDivProps(),{className:"react-grid-HeaderRow"}),c.createElement("div",{style:e},t))},t}(c.Component);_.displayName="HeaderRow",_.propTypes={width:s.default.oneOfType([s.default.number,s.default.string]),height:s.default.number.isRequired,columns:s.default.oneOfType([s.default.array,s.default.object]).isRequired,onColumnResize:s.default.func,onSort:s.default.func.isRequired,onColumnResizeEnd:s.default.func,style:s.default.shape(y),sortColumn:s.default.string,sortDirection:s.default.oneOf(Object.keys(p.DEFINE_SORT)),cellRenderer:s.default.func,headerCellRenderer:s.default.func,filterable:s.default.bool,onFilterChange:s.default.func,resizing:s.default.object,onScroll:s.default.func,rowType:s.default.string,draggableHeaderCell:s.default.func,onHeaderDrop:s.default.func},e.exports=_},function(e,t){"use strict";e.exports={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,PauseBreak:19,CapsLock:20,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LeftWindowKey:91,RightWindowKey:92,SelectKey:93,NumPad0:96,NumPad1:97,NumPad2:98,NumPad3:99,NumPad4:100,NumPad5:101,NumPad6:102,NumPad7:103,NumPad8:104,NumPad9:105,Multiply:106,Add:107,Subtract:109,DecimalPoint:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F12:123,NumLock:144,ScrollLock:145,SemiColon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBracket:221,SingleQuote:222}},function(e,t,r){"use strict";t.__esModule=!0,t.OverflowCellComponent=void 0;var n=s(r(2)),i=s(r(3)),o=s(r(213));function s(e){return e&&e.__esModule?e:{default:e}}r(34);var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getStyle=function(){return{position:"absolute",width:this.props.column.width,height:this.props.height,left:this.props.column.left,border:"1px solid #eee"}},t.prototype.render=function(){return n.default.createElement("div",{tabIndex:"-1",style:this.getStyle(),width:"100%",className:"react-grid-Cell"})},t}(n.default.Component);a.isSelected=function(e){var t=e.cellMetaData,r=e.rowIdx,n=e.idx;if(null==t)return!1;var i=t.selected;return i&&i.rowIdx===r&&i.idx===n},a.isScrolling=function(e){return e.cellMetaData.isScrollingHorizontallyWithKeyboard},a.propTypes={rowIdx:i.default.number,idx:i.default.number,height:i.default.number,column:i.default.object,cellMetaData:i.default.object},a.displayName="Cell";var c=a;t.default=(0,o.default)(a),t.OverflowCellComponent=c},function(e,t,r){"use strict";t.__esModule=!0;var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};var s={icon:o.default.string.isRequired,callback:o.default.func,actions:o.default.arrayOf(o.default.shape({text:o.default.string,callback:o.default.func}))};t.default=s},function(e,t,r){"use strict";t.__esModule=!0;var n,i=r(15),o=(n=i)&&n.__esModule?n:{default:n};t.default={ExcelColumn:o.default}},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=c(r(3)),o=c(r(68)),s=c(r(31)),a=r(73);function c(e){return e&&e.__esModule?e:{default:e}}var l=r(2),u=r(197),d=r(65),h=r(63),p=r(8),f=r(201),g=r(23),m=r(32);r(26),r(76),Object.assign||(Object.assign=r(232));var y=function(e){function t(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,r,n));v.call(i);var o={columnMetrics:i.createColumnMetrics(),selectedRows:[],copied:null,expandedRows:[],canFilter:!1,columnFilters:{},sortDirection:null,sortColumn:null,dragged:null,scrollOffset:0,lastRowIdxUiSelected:-1};return r.enableCellSelect?o.selected={rowIdx:0,idx:0}:o.selected={rowIdx:-1,idx:-1},i.state=o,i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillMount=function(){this._mounted=!0},t.prototype.componentDidMount=function(){window.addEventListener?window.addEventListener("resize",this.metricsUpdated):window.attachEvent("resize",this.metricsUpdated),this.metricsUpdated()},t.prototype.componentWillUnmount=function(){this._mounted=!1,window.removeEventListener("resize",this.metricsUpdated)},t.prototype.componentWillReceiveProps=function(e){if(e.columns&&(!m.sameColumns(this.props.columns,e.columns,this.props.columnEquality)||e.minWidth!==this.props.minWidth)){var t=this.createColumnMetrics(e);this.setState({columnMetrics:t})}},t.prototype.render=function(){var e=this,t={rowKey:this.props.rowKey,selected:this.state.selected,dragged:this.state.dragged,hoveredRowIdx:this.state.hoveredRowIdx,onCellClick:this.onCellClick,onCellFocus:this.onCellFocus,onCellContextMenu:this.onCellContextMenu,onCellDoubleClick:this.onCellDoubleClick,onCommit:this.onCellCommit,onCommitCancel:this.setInactive,copied:this.state.copied,handleDragEnterRow:this.handleDragEnter,handleTerminateDrag:this.handleTerminateDrag,enableCellSelect:this.props.enableCellSelect,onColumnEvent:this.onColumnEvent,openCellEditor:this.openCellEditor,onDragHandleDoubleClick:this.onDragHandleDoubleClick,onCellExpand:this.onCellExpand,onRowExpandToggle:this.onRowExpandToggle,onRowHover:this.onRowHover,getDataGridDOMNode:this.getDataGridDOMNode,getCellActions:this.props.getCellActions,onDeleteSubRow:this.props.onDeleteSubRow,onAddSubRow:this.props.onAddSubRow,isScrollingVerticallyWithKeyboard:this.isKeyDown(f.DownArrow)||this.isKeyDown(f.UpArrow),isScrollingHorizontallyWithKeyboard:this.isKeyDown(f.LeftArrow)||this.isKeyDown(f.RightArrow)||this.isKeyDown(f.Tab),enableCellAutoFocus:this.props.enableCellAutoFocus},r=this.renderToolbar(),i=this.props.minWidth||this.gridWidth(),o=i-this.state.scrollOffset;return("undefined"===typeof i||isNaN(i)||0===i)&&(i="100%"),("undefined"===typeof o||isNaN(o)||0===o)&&(o="100%"),l.createElement("div",{className:"react-grid-Container",style:{width:i},ref:function(t){e.grid=t}},r,l.createElement("div",{className:"react-grid-Main"},l.createElement(u,n({ref:function(t){return e.base=t}},this.props,{rowKey:this.props.rowKey,headerRows:this.getHeaderRows(),columnMetrics:this.state.columnMetrics,rowGetter:this.props.rowGetter,rowsCount:this.props.rowsCount,rowHeight:this.props.rowHeight,cellMetaData:t,selectedRows:this.getSelectedRows(),rowSelection:this.getRowSelectionProps(),expandedRows:this.state.expandedRows,rowOffsetHeight:this.getRowOffsetHeight(),sortColumn:this.state.sortColumn,sortDirection:this.state.sortDirection,onSort:this.handleSort,minHeight:this.props.minHeight,totalWidth:o,onViewportKeydown:this.onKeyDown,onViewportKeyup:this.onKeyUp,onViewportDragStart:this.onDragStart,onViewportDragEnd:this.handleDragEnd,onViewportClick:this.deselect,onViewportDoubleClick:this.deselect,onColumnResize:this.onColumnResize,rowScrollTimeout:this.props.rowScrollTimeout,scrollToRowIndex:this.props.scrollToRowIndex,contextMenu:this.props.contextMenu,overScan:this.props.overScan}))))},t}(l.Component);y.displayName="ReactDataGrid",y.propTypes={rowHeight:i.default.number.isRequired,headerRowHeight:i.default.number,headerFiltersHeight:i.default.number,minHeight:i.default.number.isRequired,minWidth:i.default.number,enableRowSelect:i.default.oneOfType([i.default.bool,i.default.string]),onRowUpdated:i.default.func,rowGetter:i.default.func.isRequired,rowsCount:i.default.number.isRequired,toolbar:i.default.element,enableCellSelect:i.default.bool,columns:i.default.oneOfType([i.default.object,i.default.array]).isRequired,onFilter:i.default.func,onCellCopyPaste:i.default.func,onCellsDragged:i.default.func,getCellActions:i.default.func,onAddFilter:i.default.func,onGridSort:i.default.func,onDragHandleDoubleClick:i.default.func,onGridRowsUpdated:i.default.func,onRowSelect:i.default.func,rowKey:i.default.string,rowScrollTimeout:i.default.number,scrollToRowIndex:i.default.number,onClearFilters:i.default.func,contextMenu:i.default.element,cellNavigationMode:i.default.oneOf(["none","loopOverRow","changeRow"]),onCellSelected:i.default.func,onCellDeSelected:i.default.func,onCellExpand:i.default.func,enableDragAndDrop:i.default.bool,tabIndex:i.default.number,onRowExpandToggle:i.default.func,draggableHeaderCell:i.default.func,getValidFilterValues:i.default.func,rowSelection:i.default.shape({enableShiftSelect:i.default.bool,onRowsSelected:i.default.func,onRowsDeselected:i.default.func,showCheckbox:i.default.bool,selectBy:i.default.oneOfType([i.default.shape({indexes:i.default.arrayOf(i.default.number).isRequired}),i.default.shape({isSelectedKey:i.default.string.isRequired}),i.default.shape({keys:i.default.shape({values:i.default.array.isRequired,rowKey:i.default.string.isRequired}).isRequired})]).isRequired}),onRowClick:i.default.func,onRowDoubleClick:i.default.func,onGridKeyUp:i.default.func,onGridKeyDown:i.default.func,rowGroupRenderer:i.default.func,rowActionsCell:i.default.func,onCheckCellIsEditable:i.default.func,overScan:i.default.object,onDeleteSubRow:i.default.func,onAddSubRow:i.default.func,enableCellAutoFocus:i.default.bool,onBeforeEdit:i.default.func,selectAllRenderer:i.default.object,minColumnWidth:i.default.number,columnEquality:i.default.func,onColumnResize:i.default.func},y.defaultProps={enableCellSelect:!1,tabIndex:-1,rowHeight:35,headerFiltersHeight:45,enableRowSelect:!1,minHeight:350,rowKey:"id",rowScrollTimeout:0,scrollToRowIndex:0,cellNavigationMode:"none",overScan:{colsStart:5,colsEnd:5,rowsStart:5,rowsEnd:5},enableCellAutoFocus:!0,onBeforeEdit:function(){},minColumnWidth:80,columnEquality:m.sameColumn};var v=function(){var e=this;this.gridWidth=function(){return e.grid?e.grid.parentElement.offsetWidth:0},this.getTotalWidth=function(){return e._mounted?e.gridWidth():p.getSize(e.props.columns)*e.props.minColumnWidth},this.getColumnMetricsType=function(t){var r=t.totalWidth||e.getTotalWidth(),n={columns:t.columns,totalWidth:r,minColumnWidth:t.minColumnWidth};return m.recalculate(n)},this.getColumn=function(t){var r=e.state.columnMetrics.columns;return Array.isArray(r)?r[t]:"undefined"!==typeof Immutable?r.get(t):void 0},this.getSize=function(){var t=e.state.columnMetrics.columns;return Array.isArray(t)?t.length:"undefined"!==typeof Immutable?t.size:void 0},this.metricsUpdated=function(){var t=e.createColumnMetrics();e.setState({columnMetrics:t})},this.createColumnMetrics=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props,r=e.setupGridColumns(t);return e.getColumnMetricsType({columns:r,minColumnWidth:e.props.minColumnWidth,totalWidth:t.minWidth})},this.onColumnResize=function(t,r){var n=m.resizeColumn(e.state.columnMetrics,t,r);e.setState({columnMetrics:n}),e.props.onColumnResize&&e.props.onColumnResize(t,r)},this.onKeyDown=function(t){if((0,a.isCtrlKeyHeldDown)(t))e.checkAndCall("onPressKeyWithCtrl",t);else if(e.isKeyExplicitlyHandled(t.key)){var r="onPress"+t.key;e.checkAndCall(r,t)}else(0,a.isKeyPrintable)(t.keyCode)&&e.checkAndCall("onPressChar",t);e._keysDown=e._keysDown||{},e._keysDown[t.keyCode]=!0,g(e.props.onGridKeyDown)&&e.props.onGridKeyDown(t)},this.onKeyUp=function(t){e._keysDown=e._keysDown||{},delete e._keysDown[t.keyCode],g(e.props.onGridKeyUp)&&e.props.onGridKeyUp(t)},this.isKeyDown=function(t){return!!e._keysDown&&t in e._keysDown},this.isSingleKeyDown=function(t){return!!e._keysDown&&(t in e._keysDown&&1===Object.keys(e._keysDown).length)},this.checkAndCall=function(t,r){"function"===typeof e[t]&&e[t](r)},this.isKeyExplicitlyHandled=function(t){return"function"===typeof e["onPress"+t]},this.hasSelectedCellChanged=function(t){var r=Object.assign({},e.state.selected);return r.rowIdx!==t.rowIdx||r.idx!==t.idx||!1===r.active},this.onContextMenuHide=function(){document.removeEventListener("click",e.onContextMenuHide);var t=Object.assign({},e.state.selected,{contextMenuDisplayed:!1});e.setState({selected:t})},this.onColumnEvent=function(t,r){var n=r.idx,i=r.name;if(i&&"undefined"!==typeof n){var o=e.getColumn(n);if(o&&o.events&&o.events[i]&&"function"===typeof o.events[i]){var s={idx:n,rowIdx:r.rowIdx,rowId:r.rowId,column:o};o.events[i](t,s)}}},this.onSelect=function(t){if(e.state.selected.rowIdx!==t.rowIdx||e.state.selected.idx!==t.idx||!1===e.state.selected.active){var r=t.idx,n=t.rowIdx;if(e.isCellWithinBounds(t)){var i=e.state.selected;e.setState({selected:t},function(){"function"===typeof e.props.onCellDeSelected&&e.props.onCellDeSelected(i),"function"===typeof e.props.onCellSelected&&e.props.onCellSelected(t)})}else-1===n&&-1===r&&e.setState({selected:{idx:r,rowIdx:n}})}},this.onCellClick=function(t,r){e.onSelect({rowIdx:t.rowIdx,idx:t.idx}),e.props.onRowClick&&"function"===typeof e.props.onRowClick&&e.props.onRowClick(t.rowIdx,e.props.rowGetter(t.rowIdx),e.getColumn(t.idx)),r&&r.stopPropagation()},this.onCellFocus=function(t){e.onSelect(t)},this.onCellContextMenu=function(t){e.onSelect({rowIdx:t.rowIdx,idx:t.idx,contextMenuDisplayed:e.props.contextMenu}),e.props.contextMenu&&document.addEventListener("click",e.onContextMenuHide)},this.onCellDoubleClick=function(t,r){e.onSelect({rowIdx:t.rowIdx,idx:t.idx}),e.props.onRowDoubleClick&&"function"===typeof e.props.onRowDoubleClick&&e.props.onRowDoubleClick(t.rowIdx,e.props.rowGetter(t.rowIdx),e.getColumn(t.idx)),e.setActive(),r&&r.stopPropagation()},this.onPressArrowUp=function(t){e.moveSelectedCell(t,-1,0)},this.onPressArrowDown=function(t){e.moveSelectedCell(t,1,0)},this.onPressArrowLeft=function(t){e.moveSelectedCell(t,0,-1)},this.onPressArrowRight=function(t){e.moveSelectedCell(t,0,1)},this.isFocusedOnCell=function(){return document.activeElement&&document.activeElement.classList&&document.activeElement.classList.contains("react-grid-Cell")},this.isFocusedOnTable=function(){var t=e.getDataGridDOMNode();return t&&t.contains(document.activeElement)},this.exitGrid=function(t,r){e.setState({selected:r},function(){"function"===typeof e.props.onCellDeSelected&&e.props.onCellDeSelected(t)})},this.enterGrid=function(t){e.setState({selected:t},function(){"function"===typeof e.props.onCellSelected&&e.props.onCellSelected(t)})},this.onPressTab=function(t){if(0!==e.props.rowsCount){var r=e.state.selected.idx,n=e.state.selected.rowIdx;if(!0===e.state.selected.active)return e.canExitGrid(t)?void e.moveSelectedCell(t,0,0):void e.moveSelectedCell(t,0,t.shiftKey?-1:1);var i=!0===t.shiftKey;if(e.canExitGrid(t)&&e.isFocusedOnCell()){if(i&&r>=0)return void e.exitGrid({idx:r,rowIdx:n},{idx:-1,rowIdx:n,exitedLeft:!0});if(!i&&r>=0)return void e.exitGrid({idx:r,rowIdx:n},{idx:-1,rowIdx:n})}if(!e.isFocusedOnTable()||e.isFocusedOnCell()||!i||!e.state.selected.exitedLeft)return e.isFocusedOnCell()?void e.moveSelectedCell(t,0,t.shiftKey?-1:1):-1===r?void e.moveSelectedCell(t,-1===n?1:0,i?e.getNbrColumns():1):(e.enterGrid({idx:r,rowIdx:n,changeSomething:!0}),void t.preventDefault());e.enterGrid({idx:r,rowIdx:n})}},this.onPressEnter=function(t){e.setActive(t.key)},this.onPressDelete=function(t){e.setActive(t.key)},this.onPressEscape=function(t){e.setInactive(t.key),e.handleCancelCopy()},this.onPressBackspace=function(t){e.setActive(t.key)},this.onPressChar=function(t){(0,a.isKeyPrintable)(t.keyCode)&&e.setActive(t.keyCode)},this.onPressKeyWithCtrl=function(t){var r=99,n=67,i=86,o=118,s=e.state.selected.rowIdx,a=e.props.rowGetter(s),c=e.state.selected.idx,l=e.getColumn(c);if(p.canEdit(l,a,e.props.enableCellSelect))if(t.keyCode===r||t.keyCode===n){var u=e.getSelectedValue();e.handleCopy({value:u})}else t.keyCode!==o&&t.keyCode!==i||e.handlePaste()},this.onGridRowsUpdated=function(t,r,n,i,o,s){for(var a=[],c=r;c<=n;c++)a.push(e.props.rowGetter(c)[e.props.rowKey]);var l=e.props.rowGetter("COPY_PASTE"===o?s:r),u=l[e.props.rowKey],d=e.props.rowGetter(n)[e.props.rowKey];e.props.onGridRowsUpdated({cellKey:t,fromRow:r,toRow:n,fromRowId:u,toRowId:d,rowIds:a,updated:i,action:o,fromRowData:l})},this.onCellCommit=function(t){var r=Object.assign({},e.state.selected);r.active=!1;var n=e.state.expandedRows;e.setState({selected:r,expandedRows:n}),e.props.onRowUpdated&&e.props.onRowUpdated(t);var i=t.rowIdx;e.props.onGridRowsUpdated&&e.onGridRowsUpdated(t.cellKey,i,i,t.updated,s.default.UpdateActions.CELL_UPDATE)},this.onDragStart=function(t){var r=e.state.selected.idx,n=t&&t.target&&t.target.className;if(r>-1&&n){var i=e.getSelectedValue();e.handleDragStart({idx:e.state.selected.idx,rowIdx:e.state.selected.rowIdx,value:i}),t&&t.dataTransfer&&t.dataTransfer.setData&&(t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",""))}},this.onToggleFilter=function(){e.setState({canFilter:!e.state.canFilter},function(){!1===e.state.canFilter&&e.props.onClearFilters&&e.props.onClearFilters()})},this.onDragHandleDoubleClick=function(t){if(e.props.onDragHandleDoubleClick&&e.props.onDragHandleDoubleClick(t),e.props.onGridRowsUpdated){var r,n=e.getColumn(t.idx).key;e.onGridRowsUpdated(n,t.rowIdx,e.props.rowsCount-1,((r={})[n]=t.rowData[n],r),s.default.UpdateActions.COLUMN_FILL)}},this.onCellExpand=function(t){e.props.onCellExpand&&e.props.onCellExpand(t)},this.onRowExpandToggle=function(t){"function"===typeof e.props.onRowExpandToggle&&e.props.onRowExpandToggle(t)},this.isCellWithinBounds=function(t){var r=t.idx,n=t.rowIdx;return r>=0&&n>=0&&r<p.getSize(e.state.columnMetrics.columns)&&n<e.props.rowsCount},this.handleDragStart=function(t){e.dragEnabled()&&e.isCellWithinBounds(t)&&e.setState({dragged:t})},this.handleDragEnd=function(){if(e.dragEnabled()){var t=e.state,r=t.selected,n=t.dragged,i=e.getColumn(e.state.selected.idx);if(r&&n&&i){var o,a=i.key,c=r.rowIdx<n.overRowIdx?r.rowIdx:n.overRowIdx,l=r.rowIdx>n.overRowIdx?r.rowIdx:n.overRowIdx;if(e.props.onCellsDragged&&e.props.onCellsDragged({cellKey:a,fromRow:c,toRow:l,value:n.value}),e.props.onGridRowsUpdated)e.onGridRowsUpdated(a,c,l,((o={})[a]=n.value,o),s.default.UpdateActions.CELL_DRAG)}e.setState({dragged:{complete:!0}})}},this.handleDragEnter=function(t){if(e.dragEnabled()&&null!=e.state.dragged){var r=e.state.dragged;r.overRowIdx=t,e.setState({dragged:r})}},this.handleTerminateDrag=function(){e.dragEnabled()&&e.setState({dragged:null})},this.handlePaste=function(){if(e.copyPasteEnabled()&&e.state.copied){var t,r=e.state.selected,n=e.getColumn(e.state.selected.idx).key,i=e.state.textToCopy,o=e.state.copied.rowIdx,a=r.rowIdx;if(e.props.onCellCopyPaste&&e.props.onCellCopyPaste({cellKey:n,rowIdx:a,value:i,fromRow:o,toRow:a}),e.props.onGridRowsUpdated)e.onGridRowsUpdated(n,a,a,((t={})[n]=i,t),s.default.UpdateActions.COPY_PASTE,o)}},this.handleCancelCopy=function(){e.setState({copied:null})},this.handleCopy=function(t){if(e.copyPasteEnabled()){var r=t.value,n=e.state.selected,i={idx:n.idx,rowIdx:n.rowIdx};e.setState({textToCopy:r,copied:i})}},this.handleSort=function(t,r){e.setState({sortDirection:r,sortColumn:t},function(){this.props.onGridSort(t,r)})},this.getSelectedRow=function(t,r){var n=t.filter(function(t){return t[e.props.rowKey]===r});if(n.length>0)return n[0]},this.useNewRowSelection=function(){return e.props.rowSelection&&e.props.rowSelection.selectBy},this.handleShiftSelect=function(t){if(e.state.lastRowIdxUiSelected>-1&&e.isSingleKeyDown(f.Shift)){var r=e.props.rowSelection.selectBy,n=r.keys,i=r.indexes,o=r.isSelectedKey;if(h.isRowSelected(n,i,o,e.props.rowGetter(t),t))return!1;var s=!1;if(t>e.state.lastRowIdxUiSelected){for(var a=[],c=e.state.lastRowIdxUiSelected+1;c<=t;c++)a.push({rowIdx:c,row:e.props.rowGetter(c)});"function"===typeof e.props.rowSelection.onRowsSelected&&e.props.rowSelection.onRowsSelected(a),s=!0}else if(t<e.state.lastRowIdxUiSelected){for(var l=[],u=t;u<=e.state.lastRowIdxUiSelected-1;u++)l.push({rowIdx:u,row:e.props.rowGetter(u)});"function"===typeof e.props.rowSelection.onRowsSelected&&e.props.rowSelection.onRowsSelected(l),s=!0}return s&&e.setState({lastRowIdxUiSelected:t}),s}return!1},this.handleNewRowSelect=function(t,r){e.selectAllCheckbox&&!0===e.selectAllCheckbox.checked&&(e.selectAllCheckbox.checked=!1);var n=e.props.rowSelection.selectBy,i=n.keys,o=n.indexes,s=n.isSelectedKey,a=h.isRowSelected(i,o,s,r,t);e.setState({lastRowIdxUiSelected:a?-1:t,selected:{rowIdx:t,idx:0}}),a&&"function"===typeof e.props.rowSelection.onRowsDeselected?e.props.rowSelection.onRowsDeselected([{rowIdx:t,row:r}]):a||"function"!==typeof e.props.rowSelection.onRowsSelected||e.props.rowSelection.onRowsSelected([{rowIdx:t,row:r}])},this.handleRowSelect=function(t,r,n,i){if(i.stopPropagation(),e.useNewRowSelection())!0===e.props.rowSelection.enableShiftSelect&&e.handleShiftSelect(t)||e.handleNewRowSelect(t,n);else{var o="single"===e.props.enableRowSelect?[]:e.state.selectedRows.slice(0),s=e.getSelectedRow(o,n[e.props.rowKey]);s?s.isSelected=!s.isSelected:(n.isSelected=!0,o.push(n)),e.setState({selectedRows:o,selected:{rowIdx:t,idx:0}}),e.props.onRowSelect&&e.props.onRowSelect(o.filter(function(e){return!0===e.isSelected}))}},this.handleCheckboxChange=function(t){var r=void 0;if(r=t.currentTarget instanceof HTMLInputElement&&!0===t.currentTarget.checked,e.useNewRowSelection()){var n=e.props.rowSelection.selectBy,i=n.keys,o=n.indexes,s=n.isSelectedKey;if(r&&"function"===typeof e.props.rowSelection.onRowsSelected){for(var a=[],c=0;c<e.props.rowsCount;c++){var l=e.props.rowGetter(c);h.isRowSelected(i,o,s,l,c)||a.push({rowIdx:c,row:l})}a.length>0&&e.props.rowSelection.onRowsSelected(a)}else if(!r&&"function"===typeof e.props.rowSelection.onRowsDeselected){for(var u=[],d=0;d<e.props.rowsCount;d++){var p=e.props.rowGetter(d);h.isRowSelected(i,o,s,p,d)&&u.push({rowIdx:d,row:p})}u.length>0&&e.props.rowSelection.onRowsDeselected(u)}}else{for(var f=[],g=0;g<e.props.rowsCount;g++){var m=Object.assign({},e.props.rowGetter(g),{isSelected:r});f.push(m)}e.setState({selectedRows:f}),"function"===typeof e.props.onRowSelect&&e.props.onRowSelect(f.filter(function(e){return!0===e.isSelected}))}},this.getScrollOffSet=function(){var t=0;if(e.grid){var r=e.grid.querySelector(".react-grid-Canvas");r&&(t=r.offsetWidth-r.clientWidth)}e.setState({scrollOffset:t})},this.getRowOffsetHeight=function(){var t=0;return e.getHeaderRows().forEach(function(e){return t+=parseFloat(e.height,10)}),t},this.getHeaderRows=function(){var t=[{ref:function(t){return e.row=t},height:e.props.headerRowHeight||e.props.rowHeight,rowType:"header"}];return!0===e.state.canFilter&&t.push({ref:function(t){return e.filterRow=t},filterable:!0,onFilterChange:e.props.onAddFilter,height:e.props.headerFiltersHeight,rowType:"filter"}),t},this.getInitialSelectedRows=function(){for(var t=[],r=0;r<e.props.rowsCount;r++)t.push(!1);return t},this.getRowSelectionProps=function(){return e.props.rowSelection?e.props.rowSelection.selectBy:null},this.getSelectedRows=function(){return e.props.rowSelection?null:e.state.selectedRows.filter(function(e){return!0===e.isSelected})},this.getSelectedValue=function(){var t=e.state.selected.rowIdx,r=e.state.selected.idx,n=e.getColumn(r).key,i=e.props.rowGetter(t);return h.get(i,n)},this.canExitGrid=function(t){var r=e.isAtLastCellInRow(e.getNbrColumns()),n=e.isAtFirstCellInRow(),i=e.isAtLastRow(),o=e.isAtFirstRow(),s=!0===t.shiftKey,a=e.props.cellNavigationMode;if(s){if("none"===a){if(n)return!0}else if("changeRow"===a&&n&&o)return!0}else if("none"===a){if(r)return!0}else if("changeRow"===a&&r&&i)return!0;return!1},this.moveSelectedCell=function(t,r,n){t.preventDefault();var i=void 0,o=void 0,s=e.props.cellNavigationMode;if("none"!==s){var a=e.calculateNextSelectionPosition(s,n,r);o=a.idx,i=a.rowIdx}else i=e.state.selected.rowIdx+r,o=e.state.selected.idx+n;e.scrollToColumn(o),e.onSelect({idx:o,rowIdx:i})},this.getNbrColumns=function(){var t=e.props,r=t.columns;return t.enableRowSelect?r.length+1:r.length},this.getDataGridDOMNode=function(){return e.grid},this.calculateNextSelectionPosition=function(t,r,n){var i=n,o=e.state.selected.idx+r,s=e.getNbrColumns();return r>0?e.isAtLastCellInRow(s)&&("changeRow"===t?(i=e.isAtLastRow()?n:n+1,o=e.isAtLastRow()?o:0):o=0):r<0&&e.isAtFirstCellInRow()&&("changeRow"===t?(i=e.isAtFirstRow()?n:n-1,o=e.isAtFirstRow()?0:s-1):o=s-1),{idx:o,rowIdx:e.state.selected.rowIdx+i}},this.isAtLastCellInRow=function(t){return e.state.selected.idx===t-1},this.isAtLastRow=function(){return e.state.selected.rowIdx===e.props.rowsCount-1},this.isAtFirstCellInRow=function(){return 0===e.state.selected.idx},this.isAtFirstRow=function(){return 0===e.state.selected.rowIdx},this.openCellEditor=function(t,r){var n=e.props.rowGetter(t),i=e.getColumn(r);if(p.canEdit(i,n,e.props.enableCellSelect)){var o={rowIdx:t,idx:r};e.hasSelectedCellChanged(o)?e.setState({selected:o},function(){e.setActive("Enter")}):e.setActive("Enter")}},this.scrollToColumn=function(t){if(e.grid){var r=e.grid.querySelector(".react-grid-Canvas");if(r){for(var n=0,i=0,o=0;o<t;o++){var s=e.getColumn(o);s&&(s.width&&(n+=s.width),s.locked&&(i+=s.width))}var a=e.getColumn(t);if(a){var c=n-i-r.scrollLeft,l=n+a.width-r.scrollLeft;if(c<0)r.scrollLeft+=c;else if(l>r.clientWidth){var u=l-r.clientWidth;r.scrollLeft+=u}}}}},this.deselect=function(){e.setState({selected:{rowIdx:-1,idx:-1}})},this.setActive=function(t){var r=e.state.selected.rowIdx,n=e.props.rowGetter(r),i=e.state.selected.idx,o=e.getColumn(i);if(p.canEdit(o,n,e.props.enableCellSelect)&&!e.isActive()){var s=Object.assign({},e.state.selected,{idx:i,rowIdx:r,active:!0,initialKeyCode:t}),a=!0;if("function"===typeof e.props.onCheckCellIsEditable){var c=Object.assign({},{row:n,column:o},s);a=e.props.onCheckCellIsEditable(c)}!1!==a&&(o.locked?e.setState({selected:s}):e.setState({selected:s},function(){e.scrollToColumn(i)}),e.props.onBeforeEdit(),e.handleCancelCopy())}},this.setInactive=function(){var t=e.state.selected.rowIdx,r=e.props.rowGetter(t),n=e.state.selected.idx,i=e.getColumn(n);if(p.canEdit(i,r,e.props.enableCellSelect)&&e.isActive()){var o=Object.assign({},e.state.selected,{idx:n,rowIdx:t,active:!1});e.setState({selected:o})}},this.isActive=function(){return!0===e.state.selected.active},this.setupGridColumns=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props,r=t.columns;if(e._cachedColumns===r)return e._cachedComputedColumns;e._cachedColumns=r;var n=r.slice(0),i={};if(e.props.rowActionsCell||t.enableRowSelect&&!e.props.rowSelection||t.rowSelection&&!1!==t.rowSelection.showCheckbox){var s=e.props.selectAllRenderer||o.default,a=l.createElement(s,{onChange:e.handleCheckboxChange,inputRef:function(t){return e.selectAllCheckbox=t}}),c="single"===t.enableRowSelect?null:a,u=e.props.rowActionsCell?e.props.rowActionsCell:d,h={key:"select-row",name:"",formatter:l.createElement(u,{rowSelection:e.props.rowSelection}),onCellChange:e.handleRowSelect,filterable:!1,headerRenderer:c,width:60,locked:!0,getRowMetaData:function(e){return e},cellClass:e.props.rowActionsCell?"rdg-row-actions-cell":""};n=(i=n.unshift(h))>0?n:i}return e._cachedComputedColumns=n,e._cachedComputedColumns},this.copyPasteEnabled=function(){return null!==e.props.onCellCopyPaste},this.dragEnabled=function(){return void 0!==e.props.onGridRowsUpdated||void 0!==e.props.onCellsDragged},this.renderToolbar=function(){var t=e.props.toolbar,r={columns:e.props.columns,onToggleFilter:e.onToggleFilter,numberOfRows:e.props.rowsCount};return l.isValidElement(t)?l.cloneElement(t,r):g(t)?l.createElement(t,r):void 0}};e.exports=y},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i=r(2),o=r(195);r(20);var s={position:"absolute",top:0,right:0,width:6,height:"100%"},a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){return i.createElement(o,n({},this.props,{className:"react-grid-HeaderCell__resizeHandle",style:s}))},t}(i.Component);e.exports=a},function(e,t,r){"use strict";t.__esModule=!0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=r(2),o=c(i),s=c(r(3)),a=c(r(71));function c(e){return e&&e.__esModule?e:{default:e}}r(27);var l=r(12),u=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,r));return n.onRowExpandToggle=n.onRowExpandToggle.bind(n),n.onRowExpandClick=n.onRowExpandClick.bind(n),n.setScrollLeft=n.setScrollLeft.bind(n),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onRowExpandToggle=function(e){var t=null==e?!this.props.isExpanded:e,r=this.props.cellMetaData;null!=r&&r.onRowExpandToggle&&"function"===typeof r.onRowExpandToggle&&r.onRowExpandToggle({rowIdx:this.props.idx,shouldExpand:t,columnGroupName:this.props.columnGroupName,name:this.props.name})},t.prototype.onRowExpandClick=function(){this.onRowExpandToggle(!this.props.isExpanded)},t.prototype.setScrollLeft=function(e){this.rowGroupRenderer&&this.rowGroupRenderer.setScrollLeft&&this.rowGroupRenderer.setScrollLeft(e)},t.prototype.render=function(){var e=this,t=a.default.last(this.props.columns),r={width:t.left+t.width};return o.default.createElement("div",{style:r,className:"react-grid-row-group"},o.default.createElement(this.props.renderer,n({ref:function(t){e.rowGroupRenderer=t}},this.props,{onRowExpandClick:this.onRowExpandClick,onRowExpandToggle:this.onRowExpandToggle})))},t}(i.Component);u.propTypes={height:s.default.number.isRequired,columns:s.default.oneOfType([s.default.object,s.default.array]).isRequired,row:s.default.any.isRequired,cellRenderer:s.default.func,cellMetaData:s.default.shape(l),isSelected:s.default.bool,idx:s.default.number.isRequired,expandedRows:s.default.arrayOf(s.default.object),extraClasses:s.default.string,forceUpdate:s.default.bool,subRowDetails:s.default.object,isRowHovered:s.default.bool,colVisibleStart:s.default.number.isRequired,colVisibleEnd:s.default.number.isRequired,colDisplayStart:s.default.number.isRequired,colDisplayEnd:s.default.number.isRequired,isScrolling:s.default.bool.isRequired,columnGroupName:s.default.string.isRequired,isExpanded:s.default.bool.isRequired,treeDepth:s.default.number.isRequired,name:s.default.string.isRequired,renderer:s.default.func};var d=function(e){var t=20*(e.treeDepth||0);return o.default.createElement("div",{style:{height:"50px",border:"1px solid #dddddd",paddingTop:"15px",paddingLeft:"5px"},onKeyDown:function(t){"ArrowLeft"===t.key&&e.onRowExpandToggle(!1),"ArrowRight"===t.key&&e.onRowExpandToggle(!0),"Enter"===t.key&&e.onRowExpandToggle(!e.isExpanded)},tabIndex:0},o.default.createElement("span",{className:"row-expand-icon",style:{float:"left",marginLeft:t,cursor:"pointer"},onClick:e.onRowExpandClick},e.isExpanded?String.fromCharCode("9660"):String.fromCharCode("9658")),o.default.createElement("strong",null,e.columnGroupName,": ",e.name))};d.propTypes={onRowExpandClick:s.default.func.isRequired,onRowExpandToggle:s.default.func.isRequired,isExpanded:s.default.bool.isRequired,treeDepth:s.default.number.isRequired,name:s.default.string.isRequired,columnGroupName:s.default.string.isRequired,hideColumnName:s.default.bool},u.defaultProps={renderer:d},t.default=u},function(e,t,r){"use strict";var n=s(r(3)),i=s(r(8)),o=r(224);function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var c=r(2),l=r(190),u=r(12),d=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=n=a(this,e.call.apply(e,[this].concat(s))),n.state=(0,o.getGridState)(n.props),n.onScroll=function(e){n.updateScroll(e.scrollTop,e.scrollLeft,n.state.height,n.props.rowHeight,n.props.rowsCount),n.props.onScroll&&n.props.onScroll({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft})},n.getScroll=function(){return n.canvas.getScroll()},n.setScrollLeft=function(e){n.canvas.setScrollLeft(e)},n.getDOMNodeOffsetWidth=function(){return n.viewport?n.viewport.offsetWidth:0},n.clearScrollTimer=function(){n.resetScrollStateTimeoutId&&clearTimeout(n.resetScrollStateTimeoutId)},n.resetScrollStateAfterDelay=function(){n.clearScrollTimer(),n.resetScrollStateTimeoutId=setTimeout(n.resetScrollStateAfterDelayCallback,500)},n.resetScrollStateAfterDelayCallback=function(){n.resetScrollStateTimeoutId=null,n.setState({isScrolling:!1})},n.updateScroll=function(e,t,r,i,s,a){n.resetScrollStateAfterDelay();var c=(0,o.getNextScrollState)(n.props,n.getDOMNodeOffsetWidth,e,t,r,i,s,a);n.setState(c)},n.metricsUpdated=function(){var e=n.viewportHeight(),t=n.viewportWidth();e&&n.updateScroll(n.state.scrollTop,n.state.scrollLeft,e,n.props.rowHeight,n.props.rowsCount,t)},n.viewportHeight=function(){return n.viewport?n.viewport.offsetHeight:0},n.viewportWidth=function(){return n.viewport?n.viewport.offsetWidth:0},a(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillReceiveProps=function(e){if(this.props.rowHeight!==e.rowHeight||this.props.minHeight!==e.minHeight){var t=(0,o.getGridState)(e);this.updateScroll(t.scrollTop,t.scrollLeft,t.height,e.rowHeight,e.rowsCount)}else if(i.default.getSize(this.props.columnMetrics.columns)!==i.default.getSize(e.columnMetrics.columns))this.setState((0,o.getGridState)(e));else if(this.props.rowsCount!==e.rowsCount)this.updateScroll(this.state.scrollTop,this.state.scrollLeft,this.state.height,e.rowHeight,e.rowsCount);else if(this.props.rowOffsetHeight!==e.rowOffsetHeight){var r=this.props.rowOffsetHeight-e.rowOffsetHeight;this.updateScroll(this.state.scrollTop,this.state.scrollLeft,this.state.height+r,e.rowHeight,e.rowsCount)}},t.prototype.componentDidMount=function(){window.addEventListener?window.addEventListener("resize",this.metricsUpdated):window.attachEvent("resize",this.metricsUpdated),this.metricsUpdated()},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.metricsUpdated),this.clearScrollTimer()},t.prototype.render=function(){var e=this,t={padding:0,bottom:0,left:0,right:0,overflow:"hidden",position:"absolute",top:this.props.rowOffsetHeight};return c.createElement("div",{className:"react-grid-Viewport",style:t,ref:function(t){e.viewport=t}},c.createElement(l,{ref:function(t){return e.canvas=t},rowKey:this.props.rowKey,totalWidth:this.props.totalWidth,width:this.props.columnMetrics.width,rowGetter:this.props.rowGetter,rowsCount:this.props.rowsCount,selectedRows:this.props.selectedRows,expandedRows:this.props.expandedRows,columns:this.props.columnMetrics.columns,rowRenderer:this.props.rowRenderer,displayStart:this.state.displayStart,displayEnd:this.state.displayEnd,visibleStart:this.state.visibleStart,visibleEnd:this.state.visibleEnd,colVisibleStart:this.state.colVisibleStart,colVisibleEnd:this.state.colVisibleEnd,colDisplayStart:this.state.colDisplayStart,colDisplayEnd:this.state.colDisplayEnd,cellMetaData:this.props.cellMetaData,height:this.state.height,rowHeight:this.props.rowHeight,onScroll:this.onScroll,onRows:this.props.onRows,rowScrollTimeout:this.props.rowScrollTimeout,scrollToRowIndex:this.props.scrollToRowIndex,contextMenu:this.props.contextMenu,rowSelection:this.props.rowSelection,getSubRowDetails:this.props.getSubRowDetails,rowGroupRenderer:this.props.rowGroupRenderer,isScrolling:this.state.isScrolling||!1}))},t}(c.Component);d.displayName="Viewport",d.propTypes={rowOffsetHeight:n.default.number.isRequired,totalWidth:n.default.oneOfType([n.default.number,n.default.string]).isRequired,columnMetrics:n.default.object.isRequired,rowGetter:n.default.oneOfType([n.default.array,n.default.func]).isRequired,selectedRows:n.default.array,rowSelection:n.default.oneOfType([n.default.shape({indexes:n.default.arrayOf(n.default.number).isRequired}),n.default.shape({isSelectedKey:n.default.string.isRequired}),n.default.shape({keys:n.default.shape({values:n.default.array.isRequired,rowKey:n.default.string.isRequired}).isRequired})]),expandedRows:n.default.array,rowRenderer:n.default.oneOfType([n.default.element,n.default.func]),rowsCount:n.default.number.isRequired,rowHeight:n.default.number.isRequired,onRows:n.default.func,onScroll:n.default.func,minHeight:n.default.number,cellMetaData:n.default.shape(u),rowKey:n.default.string.isRequired,rowScrollTimeout:n.default.number,scrollToRowIndex:n.default.number,contextMenu:n.default.element,getSubRowDetails:n.default.func,rowGroupRenderer:n.default.func},d.defaultProps={rowHeight:30},e.exports=d},function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var a=r(2),c=r(15),l=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),c=0;c<i;c++)o[c]=arguments[c];return r=n=s(this,e.call.apply(e,[this].concat(o))),n.state={filterTerm:""},n.handleChange=function(e){var t=e.target.value;n.setState({filterTerm:t}),n.props.onChange({filterTerm:t,column:n.props.column})},n.renderInput=function(){if(!1===n.props.column.filterable)return a.createElement("span",null);var e="header-filter-"+n.props.column.key;return a.createElement("input",{key:e,type:"text",className:"form-control input-sm",placeholder:"Search",value:n.state.filterTerm,onChange:n.handleChange})},s(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){return a.createElement("div",null,a.createElement("div",{className:"form-group"},this.renderInput()))},t}(a.Component);l.propTypes={onChange:o.default.func.isRequired,column:o.default.shape(c)},e.exports=l},function(e,t,r){"use strict";var n,i=r(3),o=(n=i)&&n.__esModule?n:{default:n};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var a=r(2),c=r(7),l={ASC:"ASC",DESC:"DESC",NONE:"NONE"},u=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=n=s(this,e.call.apply(e,[this].concat(o))),n.onClick=function(){var e=void 0,t=n.props,r=t.sortDirection,i=t.sortDescendingFirst;switch(r){default:case null:case void 0:case l.NONE:e=i?l.DESC:l.ASC;break;case l.ASC:e=i?l.NONE:l.DESC;break;case l.DESC:e=i?l.ASC:l.NONE}n.props.onSort(n.props.columnKey,e)},n.getSortByText=function(){return"NONE"===n.props.sortDirection?"":String.fromCharCode({ASC:"9650",DESC:"9660"}[n.props.sortDirection])},s(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){var e=c({"react-grid-HeaderCell-sortable":!0,"react-grid-HeaderCell-sortable--ascending":"ASC"===this.props.sortDirection,"react-grid-HeaderCell-sortable--descending":"DESC"===this.props.sortDirection});return a.createElement("div",{className:e,onClick:this.onClick,style:{cursor:"pointer"}},a.createElement("span",{className:"pull-right"},this.getSortByText()),this.props.column.name)},t}(a.Component);u.propTypes={columnKey:o.default.string.isRequired,column:o.default.shape({name:o.default.node}),onSort:o.default.func.isRequired,sortDirection:o.default.oneOf(Object.keys(l)),sortDescendingFirst:o.default.bool},e.exports=u,e.exports.DEFINE_SORT=l},function(e,t,r){"use strict";var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(3),s=(n=o)&&n.__esModule?n:{default:n},a=r(73);function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var l=r(2),u=r(7),d=r(67),h=r(23);r(26);var p=function(e){function t(){var r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];return r=n=c(this,e.call.apply(e,[this].concat(o))),f.call(n),c(n,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){var e=this.getInputNode();void 0!==e&&(this.setTextInputFocus(),this.getEditor().disableContainerStyles||(e.className+=" editor-main",e.style.height=this.props.height-1+"px"))},t.prototype.componentWillUnmount=function(){this.changeCommitted||this.changeCanceled||this.commit({key:"Enter"})},t.prototype.render=function(){return l.createElement("div",{className:this.getContainerClass(),onBlur:this.handleBlur,onKeyDown:this.onKeyDown,onContextMenu:this.handleRightClick},this.createEditor(),this.renderStatusIcon())},t}(l.Component);p.displayName="EditorContainer",p.propTypes={rowIdx:s.default.number,rowData:s.default.object.isRequired,value:s.default.oneOfType([s.default.string,s.default.number,s.default.object,s.default.bool]).isRequired,cellMetaData:s.default.shape({selected:s.default.object.isRequired,copied:s.default.object,dragged:s.default.object,onCellClick:s.default.func,onCellDoubleClick:s.default.func,onCommitCancel:s.default.func,onCommit:s.default.func}).isRequired,column:s.default.object.isRequired,height:s.default.number.isRequired,onGridKeyDown:s.default.func};var f=function(){var e=this;this.state={isInvalid:!1},this.changeCommitted=!1,this.changeCanceled=!1,this.isKeyExplicitlyHandled=function(t){return h(e["onPress"+t])},this.checkAndCall=function(t,r){h(e[t])&&e[t](r)},this.onKeyDown=function(t){if((0,a.isCtrlKeyHeldDown)(t))e.checkAndCall("onPressKeyWithCtrl",t);else if(e.isKeyExplicitlyHandled(t.key)){var r="onPress"+t.key;e.checkAndCall(r,t)}else(0,a.isKeyPrintable)(t.keyCode)&&e.checkAndCall("onPressChar",t);e._keysDown=e._keysDown||{},e._keysDown[t.keyCode]=!0,h(e.props.onGridKeyDown)&&e.props.onGridKeyDown(t)},this.createEditor=function(){var t=function(t){return e.editor=t},r={ref:t,column:e.props.column,value:e.getInitialValue(),onCommit:e.commit,onCommitCancel:e.commitCancel,rowMetaData:e.getRowMetaData(),rowData:e.props.rowData,height:e.props.height,onBlur:e.commit,onOverrideKeyDown:e.onKeyDown},n=e.props.column.editor;return l.isValidElement(n)?l.cloneElement(n,r):h(n)?l.createElement(n,i({ref:t},r)):l.createElement(d,{ref:t,column:e.props.column,value:e.getInitialValue(),onBlur:e.commit,rowMetaData:e.getRowMetaData(),onKeyDown:function(){},commit:function(){}})},this.onPressEnter=function(){e.commit({key:"Enter"})},this.onPressTab=function(){e.commit({key:"Tab"})},this.onPressEscape=function(t){e.editorIsSelectOpen()?t.stopPropagation():e.commitCancel()},this.onPressArrowDown=function(t){e.editorHasResults()?t.stopPropagation():e.commit(t)},this.onPressArrowUp=function(t){e.editorHasResults()?t.stopPropagation():e.commit(t)},this.onPressArrowLeft=function(t){e.isCaretAtBeginningOfInput()?e.commit(t):t.stopPropagation()},this.onPressArrowRight=function(t){e.isCaretAtEndOfInput()?e.commit(t):t.stopPropagation()},this.editorHasResults=function(){return!!h(e.getEditor().hasResults)&&e.getEditor().hasResults()},this.editorIsSelectOpen=function(){return!!h(e.getEditor().isSelectOpen)&&e.getEditor().isSelectOpen()},this.getRowMetaData=function(){if("function"===typeof e.props.column.getRowMetaData)return e.props.column.getRowMetaData(e.props.rowData,e.props.column)},this.getEditor=function(){return e.editor},this.getInputNode=function(){return e.getEditor().getInputNode()},this.getInitialValue=function(){var t=e.props.cellMetaData.selected.initialKeyCode;return"Delete"===t||"Backspace"===t?"":"Enter"===t?e.props.value:t?String.fromCharCode(t):e.props.value},this.getContainerClass=function(){return u({"has-error":!0===e.state.isInvalid})},this.commit=function(t){var r=t||{},n=e.getEditor().getValue();if(e.isNewValueValid(n)){e.changeCommitted=!0;var i=e.props.column.key;e.props.cellMetaData.onCommit({cellKey:i,rowIdx:e.props.rowIdx,updated:n,key:r.key})}},this.commitCancel=function(){e.changeCanceled=!0,e.props.cellMetaData.onCommitCancel()},this.isNewValueValid=function(t){if(h(e.getEditor().validate)){var r=e.getEditor().validate(t);return e.setState({isInvalid:!r}),r}return!0},this.setCaretAtEndOfInput=function(){var t=e.getInputNode(),r=t.value.length;if(t.setSelectionRange)t.setSelectionRange(r,r);else if(t.createTextRange){var n=t.createTextRange();n.moveStart("character",r),n.collapse(),n.select()}},this.isCaretAtBeginningOfInput=function(){var t=e.getInputNode();return t.selectionStart===t.selectionEnd&&0===t.selectionStart},this.isCaretAtEndOfInput=function(){var t=e.getInputNode();return t.selectionStart===t.value.length},this.isBodyClicked=function(t){return null===e.getRelatedTarget(t)},this.isViewportClicked=function(t){return e.getRelatedTarget(t).className.indexOf("react-grid-Viewport")>-1},this.isClickInsideEditor=function(t){var r=e.getRelatedTarget(t);return t.currentTarget.contains(r)||r.className.indexOf("editing")>-1||r.className.indexOf("react-grid-Cell")>-1},this.getRelatedTarget=function(e){return e.relatedTarget||e.explicitOriginalTarget||document.activeElement},this.handleRightClick=function(e){e.stopPropagation()},this.handleBlur=function(t){t.stopPropagation(),e.isBodyClicked(t)&&e.commit(t),e.isBodyClicked(t)||!e.isViewportClicked(t)&&e.isClickInsideEditor(t)||e.commit(t)},this.setTextInputFocus=function(){var t=e.props.cellMetaData.selected.initialKeyCode,r=e.getInputNode();r.focus(),"INPUT"===r.tagName&&((0,a.isKeyPrintable)(t)?r.select():(r.focus(),r.select()))},this.renderStatusIcon=function(){if(!0===e.state.isInvalid)return l.createElement("span",{className:"glyphicon glyphicon-remove form-control-feedback"})}};e.exports=p},function(e,t,r){"use strict";e.exports={CheckboxEditor:r(65),EditorBase:r(66),SimpleTextEditor:r(67)}},function(e,t,r){"use strict";t.__esModule=!0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=r(2),o=a(i),s=a(r(6));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,t.call(this));return e.checkFocus=e.checkFocus.bind(e),e.state={isScrolling:!1},e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,t),r.prototype.shouldComponentUpdate=function(t){return e.isSelected(this.props)!==e.isSelected(t)},r.prototype.componentWillReceiveProps=function(t){var r=e.isScrolling(t);r&&!this.state.isScrolling&&this.setState({isScrolling:r})},r.prototype.componentDidMount=function(){this.checkFocus()},r.prototype.componentDidUpdate=function(){this.checkFocus()},r.prototype.checkFocus=function(){e.isSelected(this.props)&&this.state.isScrolling&&(this.focus(),this.setState({isScrolling:!1}))},r.prototype.focus=function(){s.default.findDOMNode(this).focus()},r.prototype.render=function(){return o.default.createElement(e,n({},this.props,this.state))},r}(i.Component)}},function(e,t,r){"use strict";e.exports={SimpleCellFormatter:r(69),SelectAll:r(68)}},function(e,t,r){"use strict";var n,i=r(216),o=(n=i)&&n.__esModule?n:{default:n};e.exports={test:{GridPropHelpers:o.default}}},function(e,t){"use strict";for(var r=[],n=0;n<1e3;n++)r.push({id:n,title:"Title "+n,count:1e3*n});e.exports={columns:[{key:"id",name:"ID",width:100},{key:"title",name:"Title",width:100},{key:"count",name:"Count",width:100}],rowGetter:function(e){return r[e]},rowsCount:function(){return r.length},cellMetaData:{selected:{idx:2,rowIdx:3},dragged:null,copied:null}}},function(e,t,r){"use strict";var n=o(r(62)),i=o(r(64));function o(e){return e&&e.__esModule?e:{default:e}}var s=r(205);e.exports=s,e.exports.Row=r(61),e.exports.Cell=r(59),e.exports.HeaderCell=r(60),e.exports.RowComparer=n.default,e.exports.EmptyChildRow=r(196),e.exports.RowsContainer=i.default,e.exports.editors=r(212),e.exports.formatters=r(214),e.exports.utils=r(71),e.exports.shapes=r(204),e.exports._constants=r(31),e.exports._helpers=r(215)},function(e,t){"use strict";e.exports=function(e){return Array.isArray(e)&&0===e.length}},function(e,t){"use strict";e.exports=function(e){return 0===Object.keys(e).length&&e.constructor===Object}},function(e,t,r){"use strict";var n=r(19);e.exports=function(e){return n.Iterable.isIterable(e)}},function(e,t,r){"use strict";var n=r(19);e.exports=n.Map.isMap},function(e,t){"use strict";e.exports=function(e){var t={};return t.getValue=e?function(e,t){return e.get(t)}:function(e,t){return e[t]},t}},function(e,t){"use strict";t.__esModule=!0,t.createScrollShim=function(e){var t=document.createElement("div");return t.classList?t.classList.add("react-grid-ScrollShim"):t.className+=" react-grid-ScrollShim",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width=e.width+"px",t.style.height=e.height+"px",t}},function(e,t,r){"use strict";t.__esModule=!0,t.getRenderedColumnCount=t.getNextScrollState=t.getGridState=void 0;var n,i=r(8),o=(n=i)&&n.__esModule?n:{default:n};var s=Math.min,a=Math.max,c=Math.floor,l=Math.ceil;function u(e,t,r,n){var i=n&&n>0?n:e.columnMetrics.totalWidth;0===i&&(i=t());for(var s=r,a=0;i>0;){var c=o.default.getColumn(e.columnMetrics.columns,s);if(!c)break;a++,s++,i-=c.width}return a}t.getGridState=function(e){var t=o.default.getSize(e.columnMetrics.columns),r=e.minHeight-e.rowOffsetHeight,n=l((e.minHeight-e.rowHeight)/e.rowHeight),i=s(4*n,e.rowsCount);return{displayStart:0,displayEnd:i,visibleStart:0,visibleEnd:i,height:r,scrollTop:0,scrollLeft:0,colVisibleStart:0,colVisibleEnd:t,colDisplayStart:0,colDisplayEnd:t}},t.getNextScrollState=function(e,t,r,n,i,d,h,p){var f=l(i/d),g=a(0,c(r/d)),m=s(g+f,h),y=a(0,g-e.overScan.rowsStart),v=s(m+e.overScan.rowsEnd,h),_=o.default.getSize(e.columnMetrics.columns),w=_>0?a(0,function(e,t){for(var r=t,n=-1;r>=0;)n++,r-=o.default.getColumn(e.columnMetrics.columns,n).width;return n}(e,n)):0,S=u(e,t,w,p),b=0!==S?w+S:_;return{visibleStart:g,visibleEnd:m,displayStart:y,displayEnd:v,height:i,scrollTop:r,scrollLeft:n,colVisibleStart:w,colVisibleEnd:b,colDisplayStart:a(0,w-e.overScan.colsStart),colDisplayEnd:s(b+e.overScan.colsEnd,_),isScrolling:!0}},t.getRenderedColumnCount=u},function(e,t,r){(e.exports=r(9)()).push([e.id,'.react-grid-Cell{background-color:#fff;padding-left:8px;padding-right:8px;border-right:1px solid #eee;border-bottom:1px solid #ddd}.react-grid-Cell:focus{outline:2px solid #66afe9;outline-offset:-2px}.react-grid-Cell--locked:focus{z-index:100}.react-grid-Cell:focus .drag-handle{position:absolute;bottom:-5px;right:-4px;background:#66afe9;width:8px;height:8px;border:1px solid #fff;border-right:0;border-bottom:0;z-index:8;cursor:crosshair;cursor:-webkit-grab}.react-grid-Cell:not(.editing) .react-grid-Cell__value{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.react-grid-Cell:not(.editing):not(.rdg-child-cell) .react-grid-Cell__value{position:relative;top:50%;transform:translateY(-50%)}.rdg-child-cell .react-grid-Cell__value{line-height:35px}.react-grid-Cell.readonly{background-color:#000}.react-grid-Cell.copied{background:rgba(0,0,255,.2)!important}.react-grid-Cell--locked:last-of-type{border-right:1px solid #ddd;box-shadow:none}.react-grid-Cell:hover:focus .drag-handle .glyphicon-arrow-down{display:"block"}.react-grid-Cell.is-dragged-over-down{border-right:1px dashed #000;border-left:1px dashed #000;border-bottom:1px dashed #000}.react-grid-Cell.is-dragged-over-up{border-right:1px dashed #000;border-left:1px dashed #000;border-top:1px dashed #000}.react-grid-Cell.is-dragged-over-up .drag-handle{top:-5px}.react-grid-Cell:hover{background:#eee}.react-grid-cell .form-control-feedback{color:#a94442;position:absolute;top:0;right:10px;z-index:1000000;display:block;width:34px;height:34px}.react-grid-Cell.was-dragged-over{border-right:1px dashed #000;border-left:1px dashed #000}.react-grid-Cell:hover:focus .drag-handle{position:absolute;bottom:-8px;right:-7px;background:#fff;width:16px;height:16px;border:1px solid #66afe9;z-index:8;cursor:crosshair;cursor:-webkit-grab}.react-grid-Row.row-selected .react-grid-Cell{background-color:#dbecfa}.react-grid-Cell.editing{padding:0;overflow:visible!important}.react-grid-Cell--locked.editing{z-index:100}.react-grid-Cell.editing .has-error input{border:2px solid red!important;border-radius:2px!important}.react-grid-Cell__value ul{margin-top:0;margin-bottom:0;display:inline-block}.react-grid-Cell__value .btn-sm{padding:0}.cell-tooltip{position:relative;display:inline-block}.cell-tooltip .cell-tooltip-text{visibility:hidden;width:150px;background-color:#000;color:#fff;text-align:center;border-radius:6px;padding:5px 0;position:absolute;z-index:1;bottom:-150%;left:50%;margin-left:-60px;opacity:1s}.cell-tooltip:hover .cell-tooltip-text{visibility:visible;opacity:.8}.cell-tooltip .cell-tooltip-text:after{content:" ";position:absolute;bottom:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:transparent transparent #000}.react-grid-Canvas.opaque .react-grid-Cell.cell-tooltip:hover .cell-tooltip-text{visibility:hidden}.rdg-cell-expand{top:0;right:20px;position:absolute;cursor:pointer}.rdg-child-row-action-cross-last:before,.rdg-child-row-action-cross:before,rdg-child-row-action-cross-last:after,rdg-child-row-action-cross:after{content:"";position:absolute;background:grey;height:50%}.rdg-child-row-action-cross:before{left:21px;width:1px;height:35px}.rdg-child-row-action-cross-last:before{left:21px;width:1px}.rdg-child-row-action-cross-last:after,.rdg-child-row-action-cross:after{top:50%;left:20px;height:1px;width:15px;content:"";position:absolute;background:grey}.rdg-child-row-action-cross:hover{background:red}.rdg-child-row-btn{position:absolute;cursor:pointer;border:1px solid grey;border-radius:14px;z-index:3;background:#fff}.rdg-child-row-btn div{font-size:12px;text-align:center;line-height:19px;color:grey;height:20px;width:20px;position:absolute;top:60%;left:53%;margin-top:-10px;margin-left:-10px}.rdg-empty-child-row:hover .glyphicon-plus-sign,.rdg-empty-child-row:hover a{color:green}.rdg-child-row-btn .glyphicon-remove-sign:hover{color:red}.last-column .cell-tooltip-text{right:100%;left:0!important}.rdg-cell-action{float:right;height:100%}.rdg-cell-action-last{margin-right:-8px}.rdg-cell-action-button{width:35px;height:100%;text-align:center;position:relative;display:table}.rdg-cell-action-button>span{display:table-cell;vertical-align:middle}.rdg-cell-action-button:hover{background-color:#fff}.rdg-cell-action-button-toggled{background-color:#fff;border-right:1px solid #ccc;border-left:1px solid #ccc}.rdg-cell-action-button-toggled:after{content:"";height:1px;position:absolute;bottom:-1px;left:0;right:0;background:inherit;z-index:10001}.rdg-cell-action-menu{position:absolute;top:100%;right:0;z-index:1000;float:left;min-width:160px;padding:5px 0;font-size:14px;text-align:left;list-style:none;background-color:#fff;-webkit-background-clip:padding-box;background-clip:padding-box;border:1px solid #ccc}.rdg-cell-action-menu>span{display:block;padding:3px 20px;clear:both;font-weight:400;line-height:1.42857143;color:#333;white-space:nowrap}.rdg-cell-action-menu>span:hover{color:#262626;text-decoration:none;background-color:#f5f5f5}',""])},function(e,t,r){(e.exports=r(9)()).push([e.id,'.radio-custom,.react-grid-checkbox{opacity:0;position:absolute}.radio-custom,.radio-custom-label,.react-grid-checkbox,.react-grid-checkbox-label{display:inline-block;vertical-align:middle;cursor:pointer}.radio-custom-label,.react-grid-checkbox-label{position:relative}.radio-custom+.radio-custom-label:before,.react-grid-checkbox+.react-grid-checkbox-label:before{content:"";background:#fff;border:2px solid #ddd;display:inline-block;vertical-align:middle;width:20px;height:20px;text-align:center}.react-grid-checkbox:checked+.react-grid-checkbox-label:before{background:#005295;box-shadow:inset 0 0 0 4px #fff}.radio-custom:focus+.radio-custom-label,.react-grid-checkbox:focus+.react-grid-checkbox-label{outline:1px solid #ddd}.react-grid-HeaderCell input[type=checkbox]{z-index:99999}.react-grid-HeaderCell>.react-grid-checkbox-container{padding:0 10px;height:100%}.react-grid-HeaderCell>.react-grid-checkbox-container>.react-grid-checkbox-label{margin:0;position:relative;top:50%;transform:translateY(-50%)}.radio-custom+.radio-custom-label:before{border-radius:50%}.radio-custom:checked+.radio-custom-label:before{background:#ccc;box-shadow:inset 0 0 0 4px #fff}.checkbox-align{text-align:center}',""])},function(e,t,r){(e.exports=r(9)()).push([e.id,".react-grid-Container{clear:both;margin-top:0;padding:0}.react-grid-Main{background-color:#fff;color:inherit;padding:0;outline:1px solid #e7eaec;clear:both}.react-grid-Grid{border:1px solid #ddd}.react-grid-Canvas,.react-grid-Grid{background-color:#fff}.react-grid-Cell input.editor-main,select.editor-main{display:block;width:100%;height:34px;padding:6px 12px;font-size:14px;line-height:1.42857143;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}input.editor-main:focus,select.editor-main:focus{border-color:#66afe9;border:2px solid #66afe9;background:#eee;border-radius:4px}.react-grid-Cell input.editor-main::-moz-placeholder,select.editor-main::-moz-placeholder{color:#999;opacity:1}.react-grid-Cell input.editor-main:-ms-input-placeholder,select.editor-main:-ms-input-placeholder{color:#999}.react-grid-Cell input.editor-main::-webkit-input-placeholder,select.editor-main::-webkit-input-placeholder{color:#999}.react-grid-Cell input.editor-main[disabled],.react-grid-Cell input.editor-main[readonly],fieldset[disabled] .react-grid-Cell input.editor-main,fieldset[disabled] select.editor-main,select.editor-main[disabled],select.editor-main[readonly]{cursor:not-allowed;background-color:#eee;opacity:1}textarea.react-grid-Cell input.editor-main,textareaselect.editor-main{height:auto}.react-grid-ScrollShim{z-index:10002}",""])},function(e,t,r){(e.exports=r(9)()).push([e.id,".react-grid-Header{box-shadow:0 0 4px 0 #ddd;background:#f9f9f9}.react-grid-Header--resizing{cursor:ew-resize}.react-grid-HeaderCell,.react-grid-HeaderRow{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-grid-HeaderCell{background:#f9f9f9;padding:8px;font-weight:700;border-right:1px solid #ddd;border-bottom:1px solid #ddd}.react-grid-HeaderCell__value{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;position:relative;top:50%;transform:translateY(-50%)}.react-grid-HeaderCell__resizeHandle:hover{cursor:ew-resize;background:#ddd}.react-grid-HeaderCell--locked:last-of-type{box-shadow:none}.react-grid-HeaderCell--resizing .react-grid-HeaderCell__resizeHandle{background:#ddd}.react-grid-HeaderCell__draggable{cursor:col-resize}.rdg-can-drop>.react-grid-HeaderCell{background:#ececec}.react-grid-HeaderCell .Select{max-height:30px;font-size:12px;font-weight:400}.react-grid-HeaderCell .Select-control{max-height:30px;border:1px solid #ccc;color:#555;border-radius:3px}.react-grid-HeaderCell .is-focused:not(.is-open)>.Select-control{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.react-grid-HeaderCell .Select-control .Select-placeholder{line-height:20px;color:#999;padding:4px}.react-grid-HeaderCell .Select-control .Select-input{max-height:28px;padding:4px;margin-left:0}.react-grid-HeaderCell .Select-control .Select-input input{padding:0;height:100%}.react-grid-HeaderCell .Select-control .Select-arrow-zone .Select-arrow{border-color:gray transparent transparent;border-width:4px 4px 2.5px}.react-grid-HeaderCell .Select-control .Select-value{padding:4px;line-height:20px!important}.react-grid-HeaderCell .Select--multi .Select-control .Select-value{padding:0;line-height:16px!important;max-height:20px}.react-grid-HeaderCell .Select--multi .Select-control .Select-value .Select-value-icon,.react-grid-HeaderCell .Select--multi .Select-control .Select-value .Select-value-label{max-height:20px}.react-grid-HeaderCell .Select-control .Select-value .Select-value-label{color:#555!important}.react-grid-HeaderCell .Select-menu-outer .Select-option{padding:4px;line-height:20px}.react-grid-HeaderCell .Select-menu-outer .Select-menu .Select-option.is-focused,.react-grid-HeaderCell .Select-menu-outer .Select-menu .Select-option.is-selected{color:#555}",""])},function(e,t,r){(e.exports=r(9)()).push([e.id,'.react-grid-Row.row-context-menu .react-grid-Cell,.react-grid-Row:hover .react-grid-Cell{background-color:#f9f9f9}.react-grid-Row:hover .rdg-row-index{display:none}.react-grid-Row:hover .rdg-actions-checkbox{display:block}.react-grid-Row:hover .rdg-drag-row-handle{cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;width:12px;height:30px;margin-left:0;background-image:url("data:image/svg+xml;base64, PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjlweCIgaGVpZ2h0PSIyOXB4IiB2aWV3Qm94PSIwIDAgOSAyOSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggMzkgKDMxNjY3KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5kcmFnIGljb248L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iQWN0dWFsaXNhdGlvbi12MiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IkRlc2t0b3AiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNS4wMDAwMDAsIC0yNjIuMDAwMDAwKSIgZmlsbD0iI0Q4RDhEOCI+CiAgICAgICAgICAgIDxnIGlkPSJJbnRlcmFjdGlvbnMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1LjAwMDAwMCwgMjU4LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPGcgaWQ9IlJvdy1Db250cm9scyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDIuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9ImRyYWctaWNvbiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDIuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtMzAiIGN4PSIyIiBjeT0iMiIgcj0iMiI+PC9jaXJjbGU+CiAgICAgICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtMzAiIGN4PSI3IiBjeT0iMiIgcj0iMiI+PC9jaXJjbGU+CiAgICAgICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtMzAiIGN4PSIyIiBjeT0iNyIgcj0iMiI+PC9jaXJjbGU+CiAgICAgICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtMzAiIGN4PSI3IiBjeT0iNyIgcj0iMiI+PC9jaXJjbGU+CiAgICAgICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtMzAiIGN4PSIyIiBjeT0iMTIiIHI9IjIiPjwvY2lyY2xlPgogICAgICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsLTMwIiBjeD0iNyIgY3k9IjEyIiByPSIyIj48L2NpcmNsZT4KICAgICAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBpZD0iT3ZhbC0zMCIgY3g9IjIiIGN5PSIxNyIgcj0iMiI+PC9jaXJjbGU+CiAgICAgICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtMzAiIGN4PSI3IiBjeT0iMTciIHI9IjIiPjwvY2lyY2xlPgogICAgICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsLTMwIiBjeD0iMiIgY3k9IjIyIiByPSIyIj48L2NpcmNsZT4KICAgICAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBpZD0iT3ZhbC0zMCIgY3g9IjciIGN5PSIyMiIgcj0iMiI+PC9jaXJjbGU+CiAgICAgICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtMzAiIGN4PSIyIiBjeT0iMjciIHI9IjIiPjwvY2lyY2xlPgogICAgICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsLTMwIiBjeD0iNyIgY3k9IjI3IiByPSIyIj48L2NpcmNsZT4KICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==");background-repeat:no-repeat}.react-grid-Row.row-selected,.react-grid-Row .row-selected{background-color:#dbecfa}.react-grid-row-group .row-expand-icon:hover{color:#777}.react-grid-row-index{padding:0 18px}.rdg-row-index{display:block;text-align:center}.rdg-row-actions-cell{padding:0}.rdg-actions-checkbox{display:none;text-align:center}.rdg-actions-checkbox.selected{display:block}.rdg-dragging{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.rdg-dragged-row{border-bottom:1px solid #000}',""])},function(e,t,r){"use strict";e.exports=function(e,t,r,n,i,o,s,a){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,n,i,o,s,a],u=0;(c=new Error(t.replace(/%s/g,function(){return l[u++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}}},function(e,t,r){"use strict";var n=r(230);e.exports=function(e){var t,r={};for(t in e instanceof Object&&!Array.isArray(e)||n(!1),e)e.hasOwnProperty(t)&&(r[t]=t);return r}},function(e,t){"use strict";e.exports=Object.assign||function(e,t){for(var r,n,i=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),o=1;o<arguments.length;o++){r=arguments[o],n=Object.keys(Object(r));for(var s=0;s<n.length;s++)i[n[s]]=r[n[s]]}return i}}])},e.exports=n(r(1),r(96))},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(r(1)),s=r(32),a=r(93),c=r(369),l=r(863),u=r(864);function d(e){return class WithDragAndDrop extends o.Component{constructor(){super(...arguments),this.renderRow=((e,t)=>{const r=this.props.renderRow?this.props.renderRow(e,t):o.createElement(c.TableRow,Object.assign({key:e.key},t)),n=u.DragDropRow();return o.createElement(n,Object.assign({key:e.key,dragProps:this.createNodeDragProps(e),dropProps:this.createNodeDropProps(e)},t),r)})}static get displayName(){return`WithDragAndDrop(${s.getDisplayName(e)})`}createTableDropProps(){if(!this.props.dropProps)return{};const{onDropTargetOver:e,onDropTargetDrop:t,canDropTargetDrop:r,objectTypes:n}=this.props.dropProps;return{onDropTargetOver:t=>{e&&(t.dropLocation=this.props.dataProvider,e(t))},onDropTargetDrop:e=>(e.dropLocation=this.props.dataProvider,t?t(e):e),canDropTargetDrop:e=>(e.dropLocation=this.props.dataProvider,!r||r(e)),objectTypes:n}}createNodeDragProps(e){if(!this.props.dragProps)return{};const{onDragSourceBegin:t,onDragSourceEnd:r,objectType:n}=this.props.dragProps;return{onDragSourceBegin:r=>(r.dataObject=e.extendedData,r.parentObject=this.props.dataProvider,t?t(r):r),onDragSourceEnd:e=>{r&&(e.parentObject=this.props.dataProvider,r(e))},objectType:()=>n?"function"===typeof n?n(e.extendedData):n:""}}createNodeDropProps(e){if(!this.props.dropProps)return{};const{onDropTargetOver:t,onDropTargetDrop:r,canDropTargetDrop:n,objectTypes:i}=this.props.dropProps;return{onDropTargetOver:e=>{e.dropLocation=this.props.dataProvider,t&&t(e)},onDropTargetDrop:t=>(t.dropLocation=e.extendedData,r?r(t):t),canDropTargetDrop:t=>(t.dropLocation=e.extendedData,!n||n(t)),objectTypes:i}}render(){const t=this.props,{dragProps:r,dropProps:i,renderNode:s}=t,c=n(t,["dragProps","dropProps","renderNode"]),u=a.withDropTarget(l.TableWrapper);return o.createElement(u,{dropStyle:{height:"100%"},dropProps:this.createTableDropProps()},o.createElement(e,Object.assign({},c,{renderRow:this.renderRow})))}}}t.withDragDrop=d,t.default=d},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(1)),s=r(32),a=i(r(92)),c=r(117),l=r(215);r(857);t.PropertyRenderer=class PropertyRenderer extends o.PureComponent{constructor(){super(...arguments),this._containerRef=o.createRef(),this.state={displayValue:a.default.i18n.translate("UiComponents:general.loading"),width:void 0,isHover:!1},this._onClick=(()=>{this.props.onClick&&this.props.onClick(this.props.propertyRecord,this.props.uniqueKey)}),this._onMouseEnter=(()=>{this.setState({isHover:!this.props.isSelected&&void 0!==this.props.onClick})}),this._onMouseLeave=(()=>{this.setState({isHover:!1})}),this._onEditCommit=(e=>{this.props.onEditCommit&&this.props.onEditCommit(e)}),this._onEditCancel=(()=>{this.props.onEditCancel&&this.props.onEditCancel()})}async updateDisplayValue(e){const t={orientation:this.props.orientation,containerType:c.PropertyContainerType.PropertyPane};let r;r=this.props.propertyValueRendererManager?await this.props.propertyValueRendererManager.render(e.propertyRecord,t):await c.PropertyValueRendererManager.defaultManager.render(e.propertyRecord,t),this.setState({displayValue:r})}afterRender(){if(0!==this.props.orientation||!this._containerRef.current)return;const e=this._containerRef.current.getBoundingClientRect().width;e!==this.state.width&&this.setState({width:e})}getClassName(e){let t=0===e.orientation?"components-property-record--horizontal":"components-property-record--vertical";return this.state.isHover&&(t+=" components--hover"),e.isSelected&&(t+=" components--selected"),e.onClick&&(t+=" components--clickable"),t}componentDidMount(){this.updateDisplayValue(this.props),this.afterRender()}componentDidUpdate(e){e.propertyRecord!==this.props.propertyRecord&&this.updateDisplayValue(this.props),this.state.isHover&&this.props.isSelected&&this.setState({isHover:!1}),this.afterRender()}render(){let e,t;const r=this.props.columnRatio?this.props.columnRatio:.25;let n;return 0===this.props.orientation&&(e=this.props.onColumnRatioChanged?{gridTemplateColumns:`${100*r}% 1px ${100*(1-r)}%`}:{gridTemplateColumns:`${100*r}% ${100*(1-r)}%`},t=this._containerRef),n=this.props.isEditing?o.createElement(l.EditorContainer,{propertyRecord:this.props.propertyRecord,onCommit:this._onEditCommit,onCommitCancel:this._onEditCancel}):this.state.displayValue,o.createElement("div",{ref:t,style:e,className:this.getClassName(this.props),onClick:this._onClick,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},o.createElement("div",{className:"components-property-record-label"},this.props.propertyRecord.property.displayLabel),0===this.props.orientation&&this.props.onColumnRatioChanged?o.createElement(s.ElementSeparator,{movableArea:this.state.width,onRatioChanged:this.props.onColumnRatioChanged,ratio:r,orientation:this.props.orientation}):void 0,o.createElement("div",{className:"components-property-record-value"},n))}}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.JSON=0]="JSON",e[e.Range=1]="Range",e[e.Slider=2]="Slider",e[e.MultilineText=3]="MultilineText",e[e.Icon=4]="Icon",e[e.CheckBoxIcons=5]="CheckBoxIcons",e[e.SuppressUnitLabel=6]="SuppressUnitLabel"}(t.PropertyEditorParamTypes||(t.PropertyEditorParamTypes={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class PropertyRecord{constructor(e,t){this.value=e,this.property=t}copyWithNewValue(e){return new PropertyRecord(e,this.property)}}t.PropertyRecord=PropertyRecord},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(372)),n(r(373)),n(r(374))},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(r(1)),a=o(r(2)),c=i(r(214)),l=c&&c.HeaderCell||(()=>s.createElement(s.Fragment,null)),u=r(93),d=r(862);class HeaderWrapper extends s.Component{render(){const e=this.props,{type:t,item:r,isOver:i,isDragging:o,canDrag:c,canDrop:u}=e,d=n(e,["type","item","isOver","isDragging","canDrag","canDrop"]);let h=0;r&&r.clientOffset&&r.initialClientOffset&&(h=r.clientOffset.x>r.initialClientOffset.x?1:-1);const p=a.default("table-header-drag-drop",{left:u&&!o&&i&&-1===h,right:u&&!o&&i&&1===h,dragging:o});return s.createElement("div",{className:p},s.createElement(l,Object.assign({},d)))}}t.DragDropHeaderCell=class DragDropHeaderCell extends s.Component{render(){const{column:e}=this.props,t=u.withDragSource(u.withDropTarget(HeaderWrapper)),r={onDropTargetDrop:t=>{const r=t.dataObject.key||"",n=t.dataObject.xpos||0,i=e&&e.key||"",o=e&&e.left||0;return t.dataObject={sourceKey:r,targetKey:i,sourceXpos:n,targetXpos:o},t},objectTypes:["Column"]},n={onDragSourceBegin:t=>(t.dataObject={key:e&&e.key||"",xpos:e&&e.left||"",column:e},t),onDragSourceEnd:e=>{const{sourceKey:t,targetKey:r}=e.dataObject;this.props.onHeaderDrop&&this.props.onHeaderDrop(t,r)},objectType:()=>"Column",defaultDragLayer:d.ColumnDragLayer};return s.createElement(t,Object.assign({},this.props,{dragProps:n,dropProps:r,shallow:!1}))}}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1));t.ColumnDragLayer=class ColumnDragLayer extends i.Component{render(){const e=this.props.args,t=e.sourceClientOffset||{x:-1e3,y:-1e3},r=e.initialSourceClientOffset||{x:-1e3,y:-1e3},n=(e.dataObject||{}).column||{},o=n.width||{},s=`translate(${t.x+(n&&n.left)}px, ${r.y}px)`,a={transform:s,WebkitTransform:s,width:o};return i.createElement("div",{className:"column-drag-layer",style:a},n.name)}}},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(r(1));t.TableWrapper=class TableWrapper extends o.Component{render(){const e=this.props,{isOver:t,canDrop:r,item:i,type:s}=e,a=n(e,["isOver","canDrop","item","type"]);return o.createElement("div",Object.assign({className:"react-data-grid-wrapper"},a))}}},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(r(1)),a=o(r(2)),c=r(93);var l;r(865),function(e){e[e.Above=0]="Above",e[e.On=1]="On",e[e.Below=2]="Below"}(l||(l={}));class RowWrapper extends s.Component{constructor(){super(...arguments),this._root=null,this.state={hoverMode:l.Above},this._handleDragOver=(e=>{if(this.props.isOver&&this._root){const t=this._root.getBoundingClientRect(),r=(e.clientY-t.top)/t.height;this.props.canDropOn?r<1/3?this.state.hoverMode!==l.Above&&this.setState({hoverMode:l.Above}):r<2/3?this.state.hoverMode!==l.On&&this.setState({hoverMode:l.On}):this.state.hoverMode!==l.Below&&this.setState({hoverMode:l.Below}):r<.5?this.state.hoverMode!==l.Above&&this.setState({hoverMode:l.Above}):this.state.hoverMode!==l.Below&&this.setState({hoverMode:l.Below})}})}render(){const{isOver:e,isDragging:t,canDrop:r}=this.props,n=this.state.hoverMode,i=a.default("table-drop-target",{above:r&&e&&n===l.Above,on:r&&e&&n===l.On,below:r&&e&&n===l.Below,dragging:t});return s.createElement("div",{className:i,ref:e=>{this._root=e},onDragOver:this._handleDragOver},this.props.children)}}t.DragDropRow=function(){return class DragDropRowComponent extends s.Component{render(){const e=c.withDropTarget(c.withDragSource(RowWrapper)),t=this.props,{dragProps:r,dropProps:i}=t,o=n(t,["dragProps","dropProps"]),{onDropTargetDrop:a,onDropTargetOver:l,canDropTargetDrop:u,objectTypes:d,canDropOn:h}=i,p={onDropTargetDrop:e=>{if("idx"in this.props&&void 0!==this.props.idx&&(e.row=this.props.idx,e.dropRect)){const t=(e.clientOffset.y-e.dropRect.top)/e.dropRect.height;(h&&t>2/3||!h&&t>.5)&&(e.row=this.props.idx+1)}return a?a(e):e},onDropTargetOver:e=>{if("idx"in this.props&&void 0!==this.props.idx&&l){if(e.row=this.props.idx,e.dropRect){const t=(e.clientOffset.y-e.dropRect.top)/e.dropRect.height;(h&&t>2/3||!h&&t>.5)&&(e.row=this.props.idx+1)}l(e)}},canDropTargetDrop:e=>("idx"in this.props&&void 0!==this.props.idx&&(e.row=this.props.idx),!u||u(e)),objectTypes:d},{onDragSourceBegin:f,onDragSourceEnd:g,objectType:m}=r,y={onDragSourceBegin:e=>("idx"in this.props&&void 0!==this.props.idx&&(e.row=this.props.idx),f?f(e):e),onDragSourceEnd:g,objectType:()=>m?"function"===typeof m?m({row:this.props.idx}):m:""};return s.createElement(e,Object.assign({canDropOn:this.props.dropProps&&this.props.dropProps.canDropOn||!1},o,{dropProps:p,dragProps:y,shallow:!1}),this.props.children)}}}},function(e,t,r){},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(0),s=r(213),a=r(365),c=r(195),l=r(196);class BreadcrumbDetails extends i.Component{constructor(e){super(e),this._mounted=!1,this._onModelLoaded=(e=>{this._updateTree(void 0),this.props.onRootNodesLoaded&&this.props.onRootNodesLoaded(e.map(e=>e.payload))}),this._onChildrenLoaded=(e=>{const t=this.props.path.getCurrentNode();if(t){const e=this._tree.node(t.id);this._updateTree(e)}const r=e.getChildren();this.props.onChildrenLoaded&&this.props.onChildrenLoaded(e.payload,l.toNodes(r).map(e=>e.payload))}),this._onModelChanged=(e=>{}),this._onModelReady=(()=>{this._mounted&&this.setState({modelReady:!0})}),this._onTreeNodeChanged=(e=>{o.using(this._tree.pauseRendering(),async()=>{if(e)for(const t of e)if(t){const e=this._tree.node(t.id);e&&(e.assign(BreadcrumbDetails.inspireNodeFromTreeNodeItem(t,BreadcrumbDetails.inspireNodeFromTreeNodeItem.bind(this))),await e.loadChildren())}else await this._tree.reload(),await Promise.all(this._tree.nodes().map(e=>e.loadChildren()))})}),this._treeChange=(()=>{const e=this.props.path.getCurrentNode();this._updateTree(e?this._tree.node(e.id):void 0)}),this._pathChange=(e=>{this._updateTree(e.currentNode?this._tree.node(e.currentNode.id):void 0),c.isTreeDataProviderInterface(e.oldDataProvider)&&e.oldDataProvider.onTreeNodeChanged&&e.oldDataProvider.onTreeNodeChanged.removeListener(this._onTreeNodeChanged),c.isTreeDataProviderInterface(e.dataProvider)&&e.dataProvider.onTreeNodeChanged&&e.dataProvider.onTreeNodeChanged.addListener(this._onTreeNodeChanged)}),this._updateTree=(e=>{if(e&&e.hasOrWillHaveChildren()&&!e.hasLoadedChildren())e.loadChildren();else{const t=(e?l.toNodes(e.getChildren()):this._tree.nodes()).map(e=>e.payload);if(0===t.length){const t=e?l.toNodes(e.getParents()).map(e=>e.payload):[];t.reverse(),t.length>1?this.props.path.setCurrentNode(t[t.length-2]):1===t.length&&this.props.path.setCurrentNode(void 0)}const r=a.BreadcrumbTreeUtils.aliasNodeListToTableDataProvider(t,this.props.columns);this.setState({table:r,childNodes:t})}}),this.renderTable=((e,t,r)=>i.createElement(s.Table,Object.assign({},e,{onRender:this.props.onRender}))),this.state={modelReady:!c.isTreeDataProviderInterface(e.path.getDataProvider())},this._recreateTree()}componentDidMount(){this._mounted=!0,this.props.onRender&&this.props.onRender();const e=this.props.path.getDataProvider(),t=this.props.path.getCurrentNode();this._updateTree(t?this._tree.node(t.id):void 0),c.isTreeDataProviderInterface(e)&&e.onTreeNodeChanged&&e.onTreeNodeChanged.addListener(this._treeChange),this.props.path.BreadcrumbUpdateEvent.addListener(this._pathChange)}componentWillUnmount(){this._mounted=!1,this._tree.removeAllListeners();const e=this.props.path.getDataProvider();c.isTreeDataProviderInterface(e)&&e.onTreeNodeChanged&&e.onTreeNodeChanged.removeListener(this._treeChange),this.props.path.BreadcrumbUpdateEvent.removeListener(this._pathChange)}componentDidUpdate(e){this.props.onRender&&this.props.onRender(),this.props.path.BreadcrumbUpdateEvent.has(this._pathChange)||(this.props.path.BreadcrumbUpdateEvent.addListener(this._pathChange),e.path&&e.path.BreadcrumbUpdateEvent.removeListener(this._pathChange))}_recreateTree(){this._tree=new l.BeInspireTree({dataProvider:this.props.path.getDataProvider(),renderer:this._onModelChanged,mapPayloadToInspireNodeConfig:BreadcrumbDetails.inspireNodeFromTreeNodeItem}),this._tree.on(l.BeInspireTreeEvent.ModelLoaded,this._onModelLoaded),this._tree.on(l.BeInspireTreeEvent.ChildrenLoaded,this._onChildrenLoaded),this._tree.ready.then(this._onModelReady)}shouldComponentUpdate(e,t){if(this.state.modelReady!==t.modelReady)return!0;if(!t.modelReady)return!1;const r=e.path.getCurrentNode(),n=r?this._tree.node(r.id):void 0;return this.props.renderTable!==e.renderTable||this.props.path!==e.path||this.state.table!==t.table||void 0!==n&&n.isDirty()}static inspireNodeFromTreeNodeItem(e,t){const r={id:e.id,text:e.label,itree:{state:{collapsed:!1}}};return e.icon&&(r.itree.icon=e.icon),e.hasChildren?r.children=!0:e.children&&(r.children=e.children.map(e=>t(e,t))),r}render(){const e=this.props.path.getCurrentNode();if(e){const t=this._tree.node(e.id);t&&t.setDirty(!1)}const{childNodes:t}=this.state,r=this.props.renderTable?this.props.renderTable:this.renderTable;return i.createElement("div",{className:"breadcrumb-details"},this.state.table&&t&&r({dataProvider:this.state.table,onRowsSelected:async(e,t)=>{const r=await e.next();if(!r.done){const e=r.value;"_node"in e&&e._node&&e._node.hasChildren&&this.props.path.setCurrentNode(e._node)}return t}},e,t))}}BreadcrumbDetails.defaultProps={columns:[{key:"icon",label:"",icon:!0},{key:"label",label:"Name"},{key:"description",label:"Description"}]},t.BreadcrumbDetails=BreadcrumbDetails},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(149);t.SelectionMode=n.SelectionMode;var i=r(198);t.SelectionHandler=i.SelectionHandler},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(67)),n(r(35)),n(r(869)),n(r(870)),n(r(871)),n(r(872)),n(r(873)),n(r(874)),n(r(367)),n(r(875))},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(92)),o=r(67),s=r(35);let a="",c="";class BooleanTypeConverter extends o.TypeConverter{getLocalizedTrueFalse(){a||(a=i.default.i18n.translate("UiComponents:general.true")),c||(c=i.default.i18n.translate("UiComponents:general.false"))}async convertToString(e){return void 0===e?"":(this.getLocalizedTrueFalse(),e===a||e===c?e:e?a:c)}async convertFromString(e){let t;return this.getLocalizedTrueFalse(),t=0===e.toLocaleLowerCase().localeCompare(a.toLocaleLowerCase())}sortCompare(e,t,r){return!!e===!!t?0:e&&!t?1:-1}get isBooleanType(){return!0}}t.BooleanTypeConverter=BooleanTypeConverter,s.TypeConverterManager.registerConverter("boolean",BooleanTypeConverter),s.TypeConverterManager.registerConverter("bool",BooleanTypeConverter)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(67),i=r(35);class ShortDateTypeConverter extends n.TypeConverter{async convertToString(e){return void 0===e?"":"string"!==typeof e&&e.toDateString?e.toDateString():e.toString()}isDateValid(e){return e instanceof Date&&!isNaN(+e)}async convertFromString(e){if(!e)return;const t=new Date(e);return this.isDateValid(t)?t:void 0}get isLessGreaterType(){return!0}sortCompare(e,t,r){return e.valueOf()-t.valueOf()}isEqualTo(e,t){return e.valueOf()===t.valueOf()}isNotEqualTo(e,t){return e.valueOf()!==t.valueOf()}isLessThan(e,t){return e.valueOf()<t.valueOf()}isLessThanOrEqualTo(e,t){return e.valueOf()<=t.valueOf()}isGreaterThan(e,t){return e.valueOf()>t.valueOf()}isGreaterThanOrEqualTo(e,t){return e.valueOf()>=t.valueOf()}getTimeFormat(){return 0}}t.ShortDateTypeConverter=ShortDateTypeConverter,i.TypeConverterManager.registerConverter("shortdate",ShortDateTypeConverter);class DateTimeTypeConverter extends ShortDateTypeConverter{getTimeFormat(){return 2}}t.DateTimeTypeConverter=DateTimeTypeConverter,i.TypeConverterManager.registerConverter("dateTime",DateTimeTypeConverter)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(67),i=r(35);class EnumTypeConverter extends n.TypeConverter{async convertPropertyToString(e,t){if(void 0===t)return"";if(e.enum){const r=this.getPosition(e.enum.choices,t);if(-1!==r)return e.enum.choices[r].label}return super.convertToString(t)}getPosition(e,t){for(let r=0;r<e.length;++r)if(e[r].value===t)return r;return-1}sortCompare(e,t,r){return isNaN(+e)||isNaN(+t)?i.TypeConverterManager.getConverter("string").sortCompare(e,t,r):+e-+t}}t.EnumTypeConverter=EnumTypeConverter,i.TypeConverterManager.registerConverter("enum",EnumTypeConverter)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(67),i=r(35),o=r(0);class HexadecimalTypeConverter extends n.TypeConverter{async convertToString(e){if(void 0===e)return"";const t=e.toString();return"0x"+t.substring(2,t.length).toUpperCase()}async convertFromString(e){if("0x"!==e.substr(0,2)&&(e="0x"+e),e=o.Id64.fromString(e),o.Id64.isValidId64(e))return e}sortCompare(e,t){return(e=o.Id64.fromString(e))===(t=o.Id64.fromString(t))?0:e>t?1:-1}}t.HexadecimalTypeConverter=HexadecimalTypeConverter,i.TypeConverterManager.registerConverter("hex",HexadecimalTypeConverter),i.TypeConverterManager.registerConverter("hexadecimal",HexadecimalTypeConverter)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(67),i=r(35);class NumericTypeConverterBase extends n.TypeConverter{get isLessGreaterType(){return!0}isLessThan(e,t){return e<t}isLessThanOrEqualTo(e,t){return e<=t}isGreaterThan(e,t){return e>t}isGreaterThanOrEqualTo(e,t){return e>=t}sortCompare(e,t,r){return+e-+t}}t.NumericTypeConverterBase=NumericTypeConverterBase;class FloatTypeConverter extends NumericTypeConverterBase{async convertToString(e){if(void 0===e)return"";let t=e.toString();return"-"!==t&&""!==t&&"-0.0"!==t&&"-0"!==t||(t="0.0"),-1===t.indexOf(".")&&(t+=".0"),t}async convertFromString(e){return parseFloat(e)}}t.FloatTypeConverter=FloatTypeConverter,i.TypeConverterManager.registerConverter("float",FloatTypeConverter),i.TypeConverterManager.registerConverter("double",FloatTypeConverter);class IntTypeConverter extends NumericTypeConverterBase{async convertToString(e){if(void 0===e)return"";let t=e.toString();return"-"!==t&&""!==t&&"-0"!==t||(t="0"),t}async convertFromString(e){return parseInt(e,10)}}t.IntTypeConverter=IntTypeConverter,i.TypeConverterManager.registerConverter("int",IntTypeConverter),i.TypeConverterManager.registerConverter("integer",IntTypeConverter)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(67),i=r(35);class BasePointTypeConverter extends n.TypeConverter{async convertToString(e){if(!e||!Array.isArray(e)||0===e.length)return"";let t=e[0].toString();for(let r=1;r<e.length;r++)t+=", "+e[r];return t}async convertFromString(e){return this.constructPoint(e.split(","))}sortCompare(e,t,r){const n=this.getVectorLength(e),i=this.getVectorLength(t);return n===i?0:void 0===n?-1:void 0===i?1:n-i}}t.BasePointTypeConverter=BasePointTypeConverter;class Point2dTypeConverter extends BasePointTypeConverter{getVectorLength(e){const t=this.constructPoint(e);if(void 0!==t)return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}constructPoint(e){if(2===e.length&&!isNaN(+e[0])&&!isNaN(+e[1]))return{x:+e[0].trim(),y:+e[1].trim()}}}t.Point2dTypeConverter=Point2dTypeConverter,i.TypeConverterManager.registerConverter("point2d",Point2dTypeConverter);class Point3dTypeConverter extends BasePointTypeConverter{getVectorLength(e){const t=this.constructPoint(e);if(void 0!==t)return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))}constructPoint(e){if(!(3!==e.length||isNaN(+e[0])||isNaN(+e[1])||isNaN(+e[2])))return{x:+e[0].trim(),y:+e[1].trim(),z:+e[2].trim()}}}t.Point3dTypeConverter=Point3dTypeConverter,i.TypeConverterManager.registerConverter("point3d",Point3dTypeConverter)},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(876));t.Primitives=i;const o=n(r(877));t.ConvertedPrimitives=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(215)),n(r(370)),n(r(371))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(880)),n(r(376))},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(1)),s=r(881),a=r(376);r(883);const c=i(r(92));var l;!function(e){e[e.ReadyToFilter=0]="ReadyToFilter",e[e.FilteringInProgress=1]="FilteringInProgress",e[e.FilteringFinished=2]="FilteringFinished",e[e.FilteringFinishedWithNoStepping=3]="FilteringFinishedWithNoStepping"}(l=t.InputContext||(t.InputContext={}));t.FilteringInput=class FilteringInput extends o.Component{constructor(e){super(e),this._onSearchButtonClick=(()=>{this.state.searchText&&this.props.onFilterStart(this.state.searchText)}),this._onCancelButtonClick=(()=>{this.setState({context:l.ReadyToFilter,searchText:""}),this.props.onFilterCancel()}),this._onClearButtonClick=(()=>{this.setState({context:l.ReadyToFilter,searchText:""}),this.props.onFilterClear()}),this._onFilterKeyDown=(e=>{e.key===s.Key.Enter&&this.state.searchText&&(this.props.onFilterStart(this.state.searchText),e.stopPropagation())}),this._onInputChanged=(e=>{this.setState({searchText:e.target.value,context:l.ReadyToFilter})}),this.state={searchText:"",context:l.ReadyToFilter}}static getDerivedStateFromProps(e,t){return t.context!==l.FilteringInProgress||e.filteringInProgress?t.context===l.ReadyToFilter&&e.filteringInProgress?{context:l.FilteringInProgress}:null:t.searchText&&e.resultSelectorProps?{context:l.FilteringFinished}:{context:l.FilteringFinishedWithNoStepping}}render(){return o.createElement("div",{className:"filtering-input filtering-input-preload-images",onKeyDown:this._onFilterKeyDown},o.createElement("span",{className:"filtering-input-input"},o.createElement("input",{type:"text",onKeyDown:this._onFilterKeyDown,value:this.state.searchText,onChange:this._onInputChanged}),o.createElement("span",{className:"filtering-input-input-components"},this.state.context===l.FilteringInProgress?o.createElement("div",{className:"filtering-input-loader"},o.createElement("i",null),o.createElement("i",null),o.createElement("i",null),o.createElement("i",null),o.createElement("i",null),o.createElement("i",null)):void 0,this.state.context===l.FilteringFinished?o.createElement(a.ResultSelector,Object.assign({},this.props.resultSelectorProps)):void 0)),this.state.context===l.ReadyToFilter?o.createElement("button",{className:"filtering-input-button",onClick:this._onSearchButtonClick},c.default.i18n.translate("UiComponents:button.label.search")):void 0,this.state.context===l.FilteringInProgress?o.createElement("button",{className:"filtering-input-button",onClick:this._onCancelButtonClick},c.default.i18n.translate("UiComponents:button.label.cancel")):void 0,this.state.context===l.FilteringFinishedWithNoStepping||this.state.context===l.FilteringFinished?o.createElement("button",{className:"filtering-input-clear icon icon-close",onClick:this._onClearButtonClick}):void 0)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Unidentified="Unidentified",e.Alt="Alt",e.AltGraph="AltGraph",e.CapsLock="CapsLock",e.Control="Control",e.Fn="Fn",e.FnLock="FnLock",e.Hyper="Hyper",e.Meta="Meta",e.NumLock="NumLock",e.ScrollLock="ScrollLock",e.Shift="Shift",e.Super="Super",e.Symbol="Symbol",e.SymbolLock="SymbolLock",e.Enter="Enter",e.Tab="Tab",e.ArrowDown="ArrowDown",e.ArrowLeft="ArrowLeft",e.ArrowRight="ArrowRight",e.ArrowUp="ArrowUp",e.End="End",e.Home="Home",e.PageDown="PageDown",e.PageUp="PageUp",e.Backspace="Backspace",e.Clear="Clear",e.Copy="Copy",e.CrSel="CrSel",e.Cut="Cut",e.Delete="Delete",e.EraseEof="EraseEof",e.ExSel="ExSel",e.Insert="Insert",e.Paste="Paste",e.Redo="Redo",e.Undo="Undo",e.Accept="Accept",e.Again="Again",e.Attn="Attn",e.Cancel="Cancel",e.ContextMenu="ContextMenu",e.Escape="Escape",e.Execute="Execute",e.Find="Find",e.Finish="Finish",e.Help="Help",e.Pause="Pause",e.Play="Play",e.Props="Props",e.Select="Select",e.ZoomIn="ZoomIn",e.ZoomOut="ZoomOut",e.BrightnessDown="BrightnessDown",e.BrightnessUp="BrightnessUp",e.Eject="Eject",e.LogOff="LogOff",e.Power="Power",e.PowerOff="PowerOff",e.PrintScreen="PrintScreen",e.Hibernate="Hibernate",e.Standby="Standby",e.WakeUp="WakeUp",e.AllCandidates="AllCandidates",e.Alphanumeric="Alphanumeric",e.CodeInput="CodeInput",e.Compose="Compose",e.Convert="Convert",e.Dead="Dead",e.FinalMode="FinalMode",e.GroupFirst="GroupFirst",e.GroupLast="GroupLast",e.GroupNext="GroupNext",e.GroupPrevious="GroupPrevious",e.ModeChange="ModeChange",e.NextCandidate="NextCandidate",e.NonConvert="NonConvert",e.PreviousCandidate="PreviousCandidate",e.Process="Process",e.SingleCandidate="SingleCandidate",e.HangulMode="HangulMode",e.HanjaMode="HanjaMode",e.JunjaMode="JunjaMode",e.Eisu="Eisu",e.Hankaku="Hankaku",e.Hiragana="Hiragana",e.HiraganaKatakana="HiraganaKatakana",e.KanaMode="KanaMode",e.KanjiMode="KanjiMode",e.Katakana="Katakana",e.Romaji="Romaji",e.Zenkaku="Zenkaku",e.ZenkakuHanaku="ZenkakuHanaku",e.F1="F1",e.F2="F2",e.F3="F3",e.F4="F4",e.F5="F5",e.F6="F6",e.F7="F7",e.F8="F8",e.F9="F9",e.F10="F10",e.F11="F11",e.F12="F12",e.F13="F13",e.F14="F14",e.F15="F15",e.F16="F16",e.F17="F17",e.F18="F18",e.F19="F19",e.F20="F20",e.Soft1="Soft1",e.Soft2="Soft2",e.Soft3="Soft3",e.Soft4="Soft4",e.AppSwitch="AppSwitch",e.Call="Call",e.Camera="Camera",e.CameraFocus="CameraFocus",e.EndCall="EndCall",e.GoBack="GoBack",e.GoHome="GoHome",e.HeadsetHook="HeadsetHook",e.LastNumberRedial="LastNumberRedial",e.Notification="Notification",e.MannerMode="MannerMode",e.VoiceDial="VoiceDial",e.ChannelDown="ChannelDown",e.ChannelUp="ChannelUp",e.MediaFastForward="MediaFastForward",e.MediaPause="MediaPause",e.MediaPlay="MediaPlay",e.MediaPlayPause="MediaPlayPause",e.MediaRecord="MediaRecord",e.MediaRewind="MediaRewind",e.MediaStop="MediaStop",e.MediaTrackNext="MediaTrackNext",e.MediaTrackPrevious="MediaTrackPrevious",e.AudioBalanceLeft="AudioBalanceLeft",e.AudioBalanceRight="AudioBalanceRight",e.AudioBassDown="AudioBassDown",e.AudioBassBoostDown="AudioBassBoostDown",e.AudioBassBoostToggle="AudioBassBoostToggle",e.AudioBassBoostUp="AudioBassBoostUp",e.AudioBassUp="AudioBassUp",e.AudioFaderFront="AudioFaderFront",e.AudioFaderRear="AudioFaderRear",e.AudioSurroundModeNext="AudioSurroundModeNext",e.AudioTrebleDown="AudioTrebleDown",e.AudioTrebleUp="AudioTrebleUp",e.AudioVolumeDown="AudioVolumeDown",e.AudioVolumeMute="AudioVolumeMute",e.AudioVolumeUp="AudioVolumeUp",e.MicrophoneToggle="MicrophoneToggle",e.MicrophoneVolumeDown="MicrophoneVolumeDown",e.MicrophoneVolumeMute="MicrophoneVolumeMute",e.MicrophoneVolumeUp="MicrophoneVolumeUp",e.TV="TV",e.TV3DMode="TV3DMode",e.TVAntennaCable="TVAntennaCable",e.TVAudioDescription="TVAudioDescription",e.TVAudioDescriptionMixDown="TVAudioDescriptionMixDown",e.TVAudioDescriptionMixUp="TVAudioDescriptionMixUp",e.TVContentsMenu="TVContentsMenu",e.TVDataService="TVDataService",e.TVInput="TVInput",e.TVInputComponent1="TVInputComponent1",e.TVInputComponent2="TVInputComponent2",e.TVInputComposite1="TVInputComposite1",e.TVInputComposite2="TVInputComposite2",e.TVInputHDMI1="TVInputHDMI1",e.TVInputHDMI2="TVInputHDMI2",e.TVInputHDMI3="TVInputHDMI3",e.TVInputHDMI4="TVInputHDMI4",e.TVInputVGA1="TVInputVGA1",e.TVMediaContext="TVMediaContext",e.TVNetwork="TVNetwork",e.TVNumberEntry="TVNumberEntry",e.TVPower="TVPower",e.TVRadioService="TVRadioService",e.TVSatellite="TVSatellite",e.TVSatelliteBS="TVSatelliteBS",e.TVSatelliteCS="TVSatelliteCS",e.TVSatelliteToggle="TVSatelliteToggle",e.TVTerrestrialAnalog="TVTerrestrialAnalog",e.TVTerrestrialDigital="TVTerrestrialDigital",e.TVTimer="TVTimer",e.AVRInput="AVRInput",e.AVRPower="AVRPower",e.ColorF0Red="ColorF0Red",e.ColorF1Green="ColorF1Green",e.ColorF2Yellow="ColorF2Yellow",e.ColorF3Blue="ColorF3Blue",e.ColorF4Grey="ColorF4Grey",e.ColorF5Brown="ColorF5Brown",e.ClosedCaptionToggle="ClosedCaptionToggle",e.Dimmer="Dimmer",e.DisplaySwap="DisplaySwap",e.DVR="DVR",e.Exit="Exit",e.FavoriteClear0="FavoriteClear0",e.FavoriteClear1="FavoriteClear1",e.FavoriteClear2="FavoriteClear2",e.FavoriteClear3="FavoriteClear3",e.FavoriteRecall0="FavoriteRecall0",e.FavoriteRecall1="FavoriteRecall1",e.FavoriteRecall2="FavoriteRecall2",e.FavoriteRecall3="FavoriteRecall3",e.FavoriteStore0="FavoriteStore0",e.FavoriteStore1="FavoriteStore1",e.FavoriteStore2="FavoriteStore2",e.FavoriteStore3="FavoriteStore3",e.Guide="Guide",e.GuideNextDay="GuideNextDay",e.GuidePreviousDay="GuidePreviousDay",e.Info="Info",e.InstantReplay="InstantReplay",e.Link="Link",e.ListProgram="ListProgram",e.LiveContent="LiveContent",e.Lock="Lock",e.MediaApps="MediaApps",e.MediaAudioTrack="MediaAudioTrack",e.MediaLast="MediaLast",e.MediaSkipBackward="MediaSkipBackward",e.MediaSkipForward="MediaSkipForward",e.MediaStepBackward="MediaStepBackward",e.MediaStepForward="MediaStepForward",e.MediaTopMenu="MediaTopMenu",e.NavigateIn="NavigateIn",e.NavigateNext="NavigateNext",e.NavigateOut="NavigateOut",e.NavigatePrevious="NavigatePrevious",e.NextFavoriteChannel="NextFavoriteChannel",e.NextUserProfile="NextUserProfile",e.OnDemand="OnDemand",e.Pairing="Pairing",e.PinPDown="PinPDown",e.PinPMove="PinPMove",e.PinPToggle="PinPToggle",e.PinPUp="PinPUp",e.PlaySpeedDown="PlaySpeedDown",e.PlaySpeedReset="PlaySpeedReset",e.PlaySpeedUp="PlaySpeedUp",e.RandomToggle="RandomToggle",e.RcLowBattery="RcLowBattery",e.RecordSpeedNext="RecordSpeedNext",e.RfBypass="RfBypass",e.ScanChannelsToggle="ScanChannelsToggle",e.ScreenModeNext="ScreenModeNext",e.Settings="Settings",e.SplitScreenToggle="SplitScreenToggle",e.STBInput="STBInput",e.STBPower="STBPower",e.Subtitle="Subtitle",e.Teletext="Teletext",e.VideoModeNext="VideoModeNext",e.Wink="Wink",e.ZoomToggle="ZoomToggle",e.SpeechCorrectionList="SpeechCorrectionList",e.SpeechInputToggle="SpeechInputToggle",e.Close="Close",e.New="New",e.Open="Open",e.Print="Print",e.Save="Save",e.SpellCheck="SpellCheck",e.MailForward="MailForward",e.MailReply="MailReply",e.MailSend="MailSend",e.LaunchCalculator="LaunchCalculator",e.LaunchCalendar="LaunchCalendar",e.LaunchContacts="LaunchContacts",e.LaunchMail="LaunchMail",e.LaunchMediaPlayer="LaunchMediaPlayer",e.LaunchMusicPlayer="LaunchMusicPlayer",e.LaunchMyComputer="LaunchMyComputer",e.LaunchPhone="LaunchPhone",e.LaunchScreenSaver="LaunchScreenSaver",e.LaunchSpreadsheet="LaunchSpreadsheet",e.LaunchWebBrowser="LaunchWebBrowser",e.LaunchWebCam="LaunchWebCam",e.LaunchWordProcessor="LaunchWordProcessor",e.LaunchApplication1="LaunchApplication1",e.LaunchApplication2="LaunchApplication2",e.LaunchApplication3="LaunchApplication3",e.LaunchApplication4="LaunchApplication4",e.LaunchApplication5="LaunchApplication5",e.LaunchApplication6="LaunchApplication6",e.LaunchApplication7="LaunchApplication7",e.LaunchApplication8="LaunchApplication8",e.LaunchApplication9="LaunchApplication9",e.LaunchApplication10="LaunchApplication10",e.LaunchApplication11="LaunchApplication11",e.LaunchApplication12="LaunchApplication12",e.LaunchApplication13="LaunchApplication13",e.LaunchApplication14="LaunchApplication14",e.LaunchApplication15="LaunchApplication15",e.LaunchApplication16="LaunchApplication16",e.BrowserBack="BrowserBack",e.BrowserFavorites="BrowserFavorites",e.BrowserForward="BrowserForward",e.BrowserHome="BrowserHome",e.BrowserRefresh="BrowserRefresh",e.BrowserSearch="BrowserSearch",e.BrowserStop="BrowserStop",e.Decimal="Decimal",e.Key11="Key11",e.Key12="Key12",e.Multiply="Multiply",e.Add="Add",e.Divide="Divide",e.Subtract="Subtract",e.Separator="Separator"}(t.Key||(t.Key={}))},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(377)),n(r(885)),n(r(886))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(377);t.SimplePropertyDataProvider=class SimplePropertyDataProvider{constructor(){this.label="",this.categories=[],this.records={},this.onDataChanged=new n.PropertyDataChangeEvent}addCategory(e){const t=this.categories.push(e)-1;return this.records[this.categories[t].name]=[],this.onDataChanged.raiseEvent(),t}findCategoryIndex(e){return this.categories.findIndex(t=>t.name===e.name)}addProperty(e,t){this.records[this.categories[t].name].push(e),this.onDataChanged.raiseEvent()}removeProperty(e,t){const r=this.records[this.categories[t].name].findIndex(t=>t===e);return r>=0&&(this.records[this.categories[t].name].splice(r,1),this.onDataChanged.raiseEvent(),!0)}replaceProperty(e,t,r){const n=this.records[this.categories[t].name].findIndex(t=>t===e);return n>=0&&(this.records[this.categories[t].name].splice(n,1,r),this.onDataChanged.raiseEvent(),!0)}getData(){return Promise.resolve(this)}}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(887);r(889);t.PropertyGrid=class PropertyGrid extends i.Component{constructor(e){super(e),this._isMounted=!1,this.state={categories:[],selectedPropertyKey:void 0,editingPropertyKey:void 0},this._onPropertyDataChanged=(()=>{this.gatherData(this.props.dataProvider)}),this._shouldExpandCategory=(e=>!!e.expand||this.state.categories.some(t=>t.propertyCategory.name===e.name&&t.propertyCategory.expand)),this._onExpansionToggled=(e=>{const t=this.state.categories.findIndex(t=>t.propertyCategory.name===e);if(-1===t)return;const r=[...this.state.categories],n=Object.assign({},r[t],{propertyCategory:Object.assign({},r[t].propertyCategory,{expand:!r[t].propertyCategory.expand})});r[t]=n,this.setState({categories:r})}),this._onPropertyClicked=((e,t)=>{if(!this._isClickSupported())return;let r=this.state.selectedPropertyKey,n=this.state.editingPropertyKey;this.props.isPropertyEditingEnabled&&(n=this.props.isPropertySelectionEnabled?this.state.selectedPropertyKey===t?t:void 0:t),this.props.isPropertySelectionEnabled&&n!==t&&(r=this.state.selectedPropertyKey===t?void 0:t,this.props.onPropertySelectionChanged&&this.props.onPropertySelectionChanged(e)),this.setState({selectedPropertyKey:r,editingPropertyKey:n})}),this._onEditCommit=(async(e,t)=>{this.props.onPropertyUpdated&&(await this.props.onPropertyUpdated(e,t),this.setState({editingPropertyKey:void 0}))}),this._onEditCancel=(()=>{this.setState({editingPropertyKey:void 0})}),this._dataChangesListenerDisposeFunc=this.props.dataProvider.onDataChanged.addListener(this._onPropertyDataChanged)}componentDidMount(){this._isMounted=!0,this.gatherData(this.props.dataProvider)}componentWillUnmount(){this._dataChangesListenerDisposeFunc&&(this._dataChangesListenerDisposeFunc(),this._dataChangesListenerDisposeFunc=void 0),this._isMounted=!1}componentDidUpdate(){this._dataChangesListenerDisposeFunc&&this._dataChangesListenerDisposeFunc(),this._dataChangesListenerDisposeFunc=this.props.dataProvider.onDataChanged.addListener(this._onPropertyDataChanged)}async gatherData(e){const t=await e.getData();if(!this._isMounted)return;const r=new Array;t.categories.map((e,n)=>{const i={propertyCategory:Object.assign({},e,{expand:this._shouldExpandCategory(e)}),propertyCount:t.records[e.name].length,properties:t.records[e.name]};r.push(i)}),this.setState({categories:r})}_isClickSupported(){return!(!this.props.isPropertySelectionEnabled&&!this.props.isPropertyEditingEnabled)}render(){return i.createElement("div",{className:"components-property-grid-wrapper"},i.createElement("div",{className:"components-property-grid"},this.state.categories.map(e=>i.createElement(o.SelectablePropertyBlock,{key:e.propertyCategory.name,category:e.propertyCategory,properties:e.properties,orientation:this.props.orientation,selectedPropertyKey:this.state.selectedPropertyKey,onExpansionToggled:this._onExpansionToggled,onPropertyClicked:this._isClickSupported()?this._onPropertyClicked:void 0,propertyValueRendererManager:this.props.propertyValueRendererManager,editingPropertyKey:this.state.editingPropertyKey,onEditCommit:this._onEditCommit,onEditCancel:this._onEditCancel}))))}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(888),s=r(216);class SelectablePropertyBlock extends i.default.Component{constructor(){super(...arguments),this._initialRatio=.25,this._minRatio=.15,this._maxRatio=.6,this.state={keyMatched:!1,columnRatio:this._initialRatio},this._onRatioChanged=(e=>{e<this._minRatio&&(e=this._minRatio),e>this._maxRatio&&(e=this._maxRatio),this.setState({columnRatio:e})})}shouldComponentUpdate(e,t){return this.props.category!==e.category||this.props.properties!==e.properties||this.props.orientation!==e.orientation||this.props.onExpansionToggled!==e.onExpansionToggled||this.props.onPropertyClicked!==e.onPropertyClicked||this.state.columnRatio!==t.columnRatio||this.props.editingPropertyKey!==e.editingPropertyKey||this.props.selectedPropertyKey!==e.selectedPropertyKey&&(t.keyMatched!==this.state.keyMatched||!!t.keyMatched&&!!this.state.keyMatched)}static doesKeyMatchAnyProperty(e,t){if(!t)return!1;for(const r of e.properties)if(s.getPropertyKey(e.category,r)===t)return!0;return!1}static getDerivedStateFromProps(e){return{keyMatched:SelectablePropertyBlock.doesKeyMatchAnyProperty(e,e.selectedPropertyKey)}}render(){return i.default.createElement(o.PropertyCategoryBlock,{category:this.props.category,onExpansionToggled:this.props.onExpansionToggled},i.default.createElement(s.PropertyList,{category:this.props.category,orientation:this.props.orientation,properties:this.props.properties,selectedPropertyKey:this.props.selectedPropertyKey,onPropertyClicked:this.props.onPropertyClicked,columnRatio:this.state.columnRatio,onColumnChanged:this._onRatioChanged,propertyValueRendererManager:this.props.propertyValueRendererManager,editingPropertyKey:this.props.editingPropertyKey,onEditCommit:this.props.onEditCommit,onEditCancel:this.props.onEditCancel}))}}t.SelectablePropertyBlock=SelectablePropertyBlock},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(32);t.PropertyCategoryBlock=class PropertyCategoryBlock extends i.Component{constructor(){super(...arguments),this._onClick=(()=>{this.toggleExpansion()}),this._onKeyPress=(e=>{" "===e.key&&e.preventDefault()," "!==e.key&&"Enter"!==e.key||this.toggleExpansion()})}toggleExpansion(){this.props.onExpansionToggled&&this.props.onExpansionToggled(this.props.category.name)}render(){return i.createElement(o.ExpandableBlock,{isExpanded:this.props.category.expand,onClick:this._onClick,onKeyPress:this._onKeyPress,title:this.props.category.label},this.props.children)}}},function(e,t,r){},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(891)),n(r(378))},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(1)),o=r(0),s=r(68),a=r(378),c=r(3);t.ViewportComponent=class ViewportComponent extends i.Component{constructor(e,t){super(e,t),this._handleCubeRotationChangeEvent=(e=>{if(this._vp&&s.IModelApp.viewManager.selectedView===this._vp){e.animationTime&&e.animationTime<0&&this._vp.synchWithView(!0);const t=e.rotMatrix;if(this._vp.rotation!==t){const r=this._vp.view.getTargetPoint(),n=t.clone().inverse();if(void 0===n)return;const i=n.multiplyMatrixMatrix(this._vp.view.getRotation()),s=c.Transform.createFixedPointAndMatrix(r,i),a=this._vp.getWorldFrustum();a.multiply(s),e.animationTime&&e.animationTime>0?this._vp.animateFrustumChange(this._vp.getWorldFrustum(),a,o.BeDuration.fromMilliseconds(e.animationTime)):(this._vp.view.setupFromFrustum(a),this._vp.synchWithView(!1))}}}),this._handleStandardRotationChangeEvent=(e=>{this._vp&&s.IModelApp.viewManager.selectedView===this._vp&&(this._vp.view.setRotationAboutPoint(s.ViewState.getStandardViewMatrix(e.standardRotation)),this._vp.synchWithView(!0))}),this._handleViewChanged=(e=>{a.ViewRotationCube.setViewMatrix(e)}),this._handleContextMenu=(e=>(e.preventDefault(),this.props.onContextMenu&&this.props.onContextMenu(e),!1)),this._viewportDiv=i.createRef()}async componentDidMount(){if(!this._viewportDiv.current)throw new Error("Canvas failed to load");const e=await this.props.imodel.views.load(this.props.viewDefinitionId);if(!e)throw new Error("View state failed to load");this._vp=s.ScreenViewport.create(this._viewportDiv.current,e),s.IModelApp.viewManager.addViewport(this._vp),this.props.viewportRef&&this.props.viewportRef(this._vp),a.ViewRotationCube.initialize(),a.ViewRotationCube.cubeRotationChangeEvent.addListener(this._handleCubeRotationChangeEvent,this),a.ViewRotationCube.standardRotationChangeEvent.addListener(this._handleStandardRotationChangeEvent,this),this._vp.onViewChanged.addListener(this._handleViewChanged,this)}componentWillUnmount(){this._vp&&(s.IModelApp.viewManager.dropViewport(this._vp,!0),this._vp.onViewChanged.removeListener(this._handleViewChanged,this)),a.ViewRotationCube.cubeRotationChangeEvent.removeListener(this._handleCubeRotationChangeEvent,this),a.ViewRotationCube.standardRotationChangeEvent.removeListener(this._handleStandardRotationChangeEvent,this)}render(){return i.createElement("div",{ref:this._viewportDiv,style:{height:"100%",width:"100%"},onContextMenu:this._handleContextMenu})}}},,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(898);t.withUnifiedSelection=n.default},function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),o=r(0),s=r(47),a=r(110),c=r(899),l=r(900);t.default=function(e){return class WithUnifiedSelection extends i.Component{static get displayName(){return`WithUnifiedSelection(${c.getDisplayName(e)})`}get selectionHandler(){return this._selectionHandler?this._selectionHandler.selectionHandler:void 0}get imodel(){return this.props.imodel}get rulesetId(){return this.props.rulesetId}componentDidMount(){const e=this.props.imodel,t=this.props.rulesetId;this._selectionHandler=this.props.selectionHandler?this.props.selectionHandler:new ViewportSelectionHandler(e,t)}componentWillUnmount(){this._selectionHandler&&(this._selectionHandler.dispose(),this._selectionHandler=void 0)}componentDidUpdate(){this._selectionHandler&&(this._selectionHandler.imodel=this.props.imodel,this._selectionHandler.rulesetId=this.props.rulesetId)}render(){const t=this.props,{rulesetId:r,selectionHandler:o}=t,s=n(t,["rulesetId","selectionHandler"]);return i.createElement(e,Object.assign({},s))}}};class ViewportSelectionHandler{constructor(e,t){this._isApplyingUnifiedSelection=!1,this._asyncsInProgress=new Set,this.onUnifiedSelectionChanged=(async(e,t)=>{if(e.imodel!==this._imodel)return;if(0!==e.level)return;const r=o.Guid.createValue();this._asyncsInProgress.add(r);const n=t.getSelection(e.imodel,0),i={providerName:e.source,level:e.level},s=await this._selectedElementsProvider.getElementIds(n,i);try{this._isApplyingUnifiedSelection=!0,e.imodel.selectionSet.replace(s)}finally{this._isApplyingUnifiedSelection=!1,this._asyncsInProgress.delete(r)}}),this.onViewportSelectionChanged=(async(e,t,r)=>{if(this._isApplyingUnifiedSelection)return;if(e!==this._imodel)return;if(3===t)return void this._selectionHandler.clearSelection(0);const n=o.Guid.createValue();this._asyncsInProgress.add(n);try{const i=r?await e.elements.getProps(r):[];switch(t){case 0:this._selectionHandler.addToSelection(i,0);break;case 2:this._selectionHandler.replaceSelection(i,0);break;case 1:this._selectionHandler.removeFromSelection(i,0)}}finally{this._asyncsInProgress.delete(n)}}),this._imodel=e,this._rulesetId=t,this._selectionHandler=new a.SelectionHandler(a.Presentation.selection,`Viewport_${u++}`,e,t,this.onUnifiedSelectionChanged),this._imodelSelectionListenerDisposeFunc=e.selectionSet.onChanged.addListener(this.onViewportSelectionChanged),this._selectedElementsProvider=new SelectedElementsProvider(e,t)}dispose(){this._selectionHandler.dispose(),this._imodelSelectionListenerDisposeFunc()}get selectionHandler(){return this._selectionHandler}get imodel(){return this._imodel}set imodel(e){this._imodel=e,this._selectionHandler.imodel=e,this._selectedElementsProvider.connection=e,this._imodelSelectionListenerDisposeFunc(),this._imodelSelectionListenerDisposeFunc=this._imodel.selectionSet.onChanged.addListener(this.onViewportSelectionChanged)}get rulesetId(){return this._rulesetId}set rulesetId(e){this._rulesetId=e,this._selectionHandler.rulesetId=e,this._selectedElementsProvider.rulesetId=e}get hasPendingAsyncs(){return 0!==this._asyncsInProgress.size}}t.ViewportSelectionHandler=ViewportSelectionHandler;class SelectedElementsProvider extends l.default{constructor(e,t){super(e,t,s.DefaultContentDisplayTypes.VIEWPORT)}async getElementIds(e,t){this.keys=e,this.selectionInfo=t;const r=await this.getContent();if(!r)return[];const n=new Array;return r.contentSet.forEach(e=>e.primaryKeys.forEach(e=>n.push(e.id))),n}}let u=1},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(110);let i;t.prioritySortFunction=((e,t)=>e.priority>t.priority?-1:e.priority<t.priority?1:0),t.translate=(async e=>{return i||(i=n.Presentation.i18n.registerNamespace("PresentationComponents")),await i.readFinished,e=`PresentationComponents:${e}`,n.Presentation.i18n.translate(e)}),t.getDisplayName=(e=>e.displayName?e.displayName:e.name?e.name:"Component")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(197),i=r(47),o=r(110),s=r(47);var a;!function(e){e.full=(()=>({descriptor:!0,descriptorConfiguration:!0,size:!0,content:!0}))}(a||(a={}));t.default=class ContentDataProvider{constructor(e,t,r){this.getDefaultContentDescriptor=n.memoize(async()=>await o.Presentation.presentation.getContentDescriptor(this.createRequestOptions(),this._displayType,this.keys,this.selectionInfo)),this.getContentDescriptor=n.memoize(async()=>{const e=await this.getDefaultContentDescriptor();if(e)return this.configureContentDescriptor(e)}),this.getContentSetSize=n.memoize(async()=>{const e=await this.getContentDescriptor();return e?await o.Presentation.presentation.getContentSetSize(this.createRequestOptions(),e,this.keys):0}),this.getContent=n.memoize(async e=>{const t=await this.getContentDescriptor();if(t)return await o.Presentation.presentation.getContent(Object.assign({},this.createRequestOptions(),{paging:e}),t,this.keys)},c),this._rulesetId=t,this._displayType=r,this._connection=e,this._keys=new i.KeySet,this.invalidateCache(a.full())}get displayType(){return this._displayType}get connection(){return this._connection}set connection(e){this._connection!==e&&(this._connection=e,this.invalidateCache(a.full()))}get rulesetId(){return this._rulesetId}set rulesetId(e){this._rulesetId!==e&&(this._rulesetId=e,this.invalidateCache(a.full()))}get keys(){return this._keys}set keys(e){this._keys=e,this.invalidateCache(a.full())}get selectionInfo(){return this._selectionInfo}set selectionInfo(e){this._selectionInfo!==e&&(this._selectionInfo=e,this.invalidateCache(a.full()))}invalidateCache(e){e.descriptor&&this.getDefaultContentDescriptor&&this.getDefaultContentDescriptor.cache.clear(),e.descriptorConfiguration&&this.getContentDescriptor&&this.getContentDescriptor.cache.clear(),e.size&&this.getContentSetSize&&this.getContentSetSize.cache.clear(),e.content&&this.getContent&&this.getContent.cache.clear()}createRequestOptions(){return{imodel:this._connection,rulesetId:this._rulesetId}}configureContentDescriptor(e){const t=e.fields.slice();for(let n=t.length-1;n>=0;--n){const e=t[n];this.shouldExcludeFromDescriptor(e)&&t.splice(n,1)}const r=Object.create(s.Descriptor.prototype);return Object.assign(r,e,s.Descriptor,{fields:t})}shouldExcludeFromDescriptor(e){return this.isFieldHidden(e)}isFieldHidden(e){return!1}};const c=e=>e?`${e.start?e.start:0}/${e.size?e.size:0}`:"0/0"},,,function(e,t,r){},,,function(e,t,r){"use strict";r.r(t);var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){var r;console&&console[e]&&(r=console)[e].apply(r,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(t))}},o=new(function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(t,r)}return e.prototype.init=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||i,this.options=t,this.debug=t.debug},e.prototype.setDebug=function(e){this.debug=e},e.prototype.log=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)},e.prototype.warn=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)},e.prototype.error=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")},e.prototype.deprecate=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)},e.prototype.forward=function(e,t,r,n){return n&&!this.debug?null:("string"===typeof e[0]&&(e[0]=""+r+this.prefix+" "+e[0]),this.logger[t](e))},e.prototype.create=function(t){return new e(this.logger,n({prefix:this.prefix+":"+t+":"},this.options))},e}());var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observers={}}return e.prototype.on=function(e,t){var r=this;e.split(" ").forEach(function(e){r.observers[e]=r.observers[e]||[],r.observers[e].push(t)})},e.prototype.off=function(e,t){var r=this;this.observers[e]&&this.observers[e].forEach(function(){if(t){var n=r.observers[e].indexOf(t);n>-1&&r.observers[e].splice(n,1)}else delete r.observers[e]})},e.prototype.emit=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.observers[e]&&[].concat(this.observers[e]).forEach(function(e){e.apply(void 0,r)});this.observers["*"]&&[].concat(this.observers["*"]).forEach(function(t){var n;t.apply(t,(n=[e]).concat.apply(n,r))})},e}();function a(e){return null==e?"":""+e}function c(e,t,r){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"===typeof e}for(var o="string"!==typeof t?[].concat(t):t.split(".");o.length>1;){if(i())return{};var s=n(o.shift());!e[s]&&r&&(e[s]=new r),e=e[s]}return i()?{}:{obj:e,k:n(o.shift())}}function l(e,t,r){var n=c(e,t,Object);n.obj[n.k]=r}function u(e,t){var r=c(e,t),n=r.obj,i=r.k;if(n)return n[i]}function d(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function p(e){return"string"===typeof e?e.replace(/[&<>"'\/]/g,function(e){return h[e]}):e}var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function g(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}}(e,t))}var m=function(e){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return i.data=r||{},i.options=n,i}return g(t,e),t.prototype.addNamespaces=function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)},t.prototype.removeNamespaces=function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)},t.prototype.getResource=function(e,t,r){var n=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).keySeparator||this.options.keySeparator;void 0===n&&(n=".");var i=[e,t];return r&&"string"!==typeof r&&(i=i.concat(r)),r&&"string"===typeof r&&(i=i.concat(n?r.split(n):r)),e.indexOf(".")>-1&&(i=e.split(".")),u(this.data,i)},t.prototype.addResource=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},o=this.options.keySeparator;void 0===o&&(o=".");var s=[e,t];r&&(s=s.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(n=t,t=(s=e.split("."))[1]),this.addNamespaces(t),l(this.data,s,n),i.silent||this.emit("added",e,t,r,n)},t.prototype.addResources=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var i in r)"string"===typeof r[i]&&this.addResource(e,t,i,r[i],{silent:!0});n.silent||this.emit("added",e,t,r)},t.prototype.addResourceBundle=function(e,t,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},s=[e,t];e.indexOf(".")>-1&&(n=r,r=t,t=(s=e.split("."))[1]),this.addNamespaces(t);var a=u(this.data,s)||{};n?function e(t,r,n){for(var i in r)i in t?"string"===typeof t[i]||t[i]instanceof String||"string"===typeof r[i]||r[i]instanceof String?n&&(t[i]=r[i]):e(t[i],r[i],n):t[i]=r[i];return t}(a,r,i):a=f({},a,r),l(this.data,s,a),o.silent||this.emit("added",e,t,r)},t.prototype.removeResourceBundle=function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)},t.prototype.hasResourceBundle=function(e,t){return void 0!==this.getResource(e,t)},t.prototype.getResourceBundle=function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?f({},this.getResource(e,t)):this.getResource(e,t)},t.prototype.toJSON=function(){return this.data},t}(s),y={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,r,n,i){var o=this;return e.forEach(function(e){o.processors[e]&&(t=o.processors[e].process(t,r,n,i))}),t}},v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function w(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}}(e,t))}var S=function(e){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i,s,a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return i=r,s=a,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector"].forEach(function(e){i[e]&&(s[e]=i[e])}),a.options=n,a.logger=o.create("translator"),a}return w(t,e),t.prototype.changeLanguage=function(e){e&&(this.language=e)},t.prototype.exists=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}},r=this.resolve(e,t);return r&&void 0!==r.res},t.prototype.extractFromKey=function(e,t){var r=t.nsSeparator||this.options.nsSeparator;void 0===r&&(r=":");var n=t.keySeparator||this.options.keySeparator||".",i=t.ns||this.options.defaultNS;if(r&&e.indexOf(r)>-1){var o=e.split(r);(r!==n||r===n&&this.options.ns.indexOf(o[0])>-1)&&(i=o.shift()),e=o.join(n)}return"string"===typeof i&&(i=[i]),{key:e,namespaces:i}},t.prototype.translate=function(e,t){var r=this;if("object"!==("undefined"===typeof t?"undefined":_(t))&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),void 0===e||null===e||""===e)return"";"number"===typeof e&&(e=String(e)),"string"===typeof e&&(e=[e]);var n=t.keySeparator||this.options.keySeparator||".",i=this.extractFromKey(e[e.length-1],t),o=i.key,s=i.namespaces,a=s[s.length-1],c=t.lng||this.language,l=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&"cimode"===c.toLowerCase()){if(l){var u=t.nsSeparator||this.options.nsSeparator;return a+u+o}return o}var d=this.resolve(e,t),h=d&&d.res,p=d&&d.usedKey||o,f=Object.prototype.toString.apply(h),g=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays;if(h&&("string"!==typeof h&&"boolean"!==typeof h&&"number"!==typeof h)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(f)<0&&(!g||"[object Array]"!==f)){if(!t.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,h,t):"key '"+o+" ("+this.language+")' returned an object instead of string.";if(t.keySeparator||this.options.keySeparator){var m="[object Array]"===f?[]:{};for(var y in h)if(Object.prototype.hasOwnProperty.call(h,y)){var w=""+p+n+y;m[y]=this.translate(w,v({},t,{joinArrays:!1,ns:s})),m[y]===w&&(m[y]=h[y])}h=m}}else if(g&&"[object Array]"===f)(h=h.join(g))&&(h=this.extendTranslation(h,e,t));else{var S=!1,b=!1;this.isValidLookup(h)||void 0===t.defaultValue||(S=!0,h=t.defaultValue),this.isValidLookup(h)||(b=!0,h=o);var x=t.defaultValue&&t.defaultValue!==h&&this.options.updateMissing;if(b||S||x){this.logger.log(x?"updateKey":"missingKey",c,a,o,x?t.defaultValue:h);var P=[],C=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&C&&C[0])for(var T=0;T<C.length;T++)P.push(C[T]);else"all"===this.options.saveMissingTo?P=this.languageUtils.toResolveHierarchy(t.lng||this.language):P.push(t.lng||this.language);var M=function(e,n){r.options.missingKeyHandler?r.options.missingKeyHandler(e,a,n,x?t.defaultValue:h,x,t):r.backendConnector&&r.backendConnector.saveMissing&&r.backendConnector.saveMissing(e,a,n,x?t.defaultValue:h,x,t),r.emit("missingKey",e,a,n,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&t.count?P.forEach(function(e){r.pluralResolver.getPluralFormsOfKey(e,o).forEach(function(t){return M([e],t)})}):M(P,o))}h=this.extendTranslation(h,e,t),b&&h===o&&this.options.appendNamespaceToMissingKey&&(h=a+":"+o),b&&this.options.parseMissingKeyHandler&&(h=this.options.parseMissingKeyHandler(h))}return h},t.prototype.extendTranslation=function(e,t,r){var n=this;r.interpolation&&this.interpolator.init(v({},r,{interpolation:v({},this.options.interpolation,r.interpolation)}));var i=r.replace&&"string"!==typeof r.replace?r.replace:r;this.options.interpolation.defaultVariables&&(i=v({},this.options.interpolation.defaultVariables,i)),e=this.interpolator.interpolate(e,i,r.lng||this.language),!1!==r.nest&&(e=this.interpolator.nest(e,function(){return n.translate.apply(n,arguments)},r)),r.interpolation&&this.interpolator.reset();var o=r.postProcess||this.options.postProcess,s="string"===typeof o?[o]:o;return void 0!==e&&null!==e&&s&&s.length&&!1!==r.applyPostProcessor&&(e=y.handle(s,e,t,r,this)),e},t.prototype.resolve=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=void 0,i=void 0;return"string"===typeof e&&(e=[e]),e.forEach(function(e){if(!t.isValidLookup(n)){var o=t.extractFromKey(e,r),s=o.key;i=s;var a=o.namespaces;t.options.fallbackNS&&(a=a.concat(t.options.fallbackNS));var c=void 0!==r.count&&"string"!==typeof r.count,l=void 0!==r.context&&"string"===typeof r.context&&""!==r.context,u=r.lngs?r.lngs:t.languageUtils.toResolveHierarchy(r.lng||t.language);a.forEach(function(e){t.isValidLookup(n)||u.forEach(function(i){if(!t.isValidLookup(n)){var o=s,a=[o],u=void 0;c&&(u=t.pluralResolver.getSuffix(i,r.count)),c&&l&&a.push(o+u),l&&a.push(o+=""+t.options.contextSeparator+r.context),c&&a.push(o+=u);for(var d=void 0;d=a.pop();)t.isValidLookup(n)||(n=t.getResource(i,e,d,r))}})})}}),{res:n,usedKey:i}},t.prototype.isValidLookup=function(e){return void 0!==e&&!(!this.options.returnNull&&null===e)&&!(!this.options.returnEmptyString&&""===e)},t.prototype.getResource=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.resourceStore.getResource(e,t,r,n)},t}(s);function b(e){return e.charAt(0).toUpperCase()+e.slice(1)}var x=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.whitelist=this.options.whitelist||!1,this.logger=o.create("languageUtils")}return e.prototype.getScriptPartFromCode=function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),this.formatLanguageCode(t.join("-")))},e.prototype.getLanguagePartFromCode=function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])},e.prototype.formatLanguageCode=function(e){if("string"===typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],r=e.split("-");return this.options.lowerCaseLng?r=r.map(function(e){return e.toLowerCase()}):2===r.length?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=b(r[1].toLowerCase()))):3===r.length&&(r[0]=r[0].toLowerCase(),2===r[1].length&&(r[1]=r[1].toUpperCase()),"sgn"!==r[0]&&2===r[2].length&&(r[2]=r[2].toUpperCase()),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=b(r[1].toLowerCase())),t.indexOf(r[2].toLowerCase())>-1&&(r[2]=b(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e},e.prototype.isWhitelisted=function(e){return("languageOnly"===this.options.load||this.options.nonExplicitWhitelist)&&(e=this.getLanguagePartFromCode(e)),!this.whitelist||!this.whitelist.length||this.whitelist.indexOf(e)>-1},e.prototype.getFallbackCodes=function(e,t){if(!e)return[];if("string"===typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e.default),r||[]},e.prototype.toResolveHierarchy=function(e,t){var r=this,n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],o=function(e){e&&(r.isWhitelisted(e)?i.push(e):r.logger.warn("rejecting non-whitelisted language code: "+e))};return"string"===typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&o(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&o(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&o(this.getLanguagePartFromCode(e))):"string"===typeof e&&o(this.formatLanguageCode(e)),n.forEach(function(e){i.indexOf(e)<0&&o(r.formatLanguageCode(e))}),i},e}();var P=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","he","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21}],C={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}};var T=function(){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.languageUtils=t,this.options=n,this.logger=o.create("pluralResolver"),this.rules=(r={},P.forEach(function(e){e.lngs.forEach(function(t){r[t]={numbers:e.nr,plurals:C[e.fc]}})}),r)}return e.prototype.addRule=function(e,t){this.rules[e]=t},e.prototype.getRule=function(e){return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]},e.prototype.needsPlural=function(e){var t=this.getRule(e);return t&&t.numbers.length>1},e.prototype.getPluralFormsOfKey=function(e,t){var r=this,n=[],i=this.getRule(e);return i?(i.numbers.forEach(function(i){var o=r.getSuffix(e,i);n.push(""+t+o)}),n):n},e.prototype.getSuffix=function(e,t){var r=this,n=this.getRule(e);if(n){var i=n.noAbs?n.plurals(t):n.plurals(Math.abs(t)),o=n.numbers[i];this.options.simplifyPluralSuffix&&2===n.numbers.length&&1===n.numbers[0]&&(2===o?o="plural":1===o&&(o=""));var s=function(){return r.options.prepend&&o.toString()?r.options.prepend+o.toString():o.toString()};return"v1"===this.options.compatibilityJSON?1===o?"":"number"===typeof o?"_plural_"+o.toString():s():"v2"===this.options.compatibilityJSON||2===n.numbers.length&&1===n.numbers[0]?s():2===n.numbers.length&&1===n.numbers[0]?s():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}return this.logger.warn("no plural rule found for: "+e),""},e}(),M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logger=o.create("interpolator"),this.init(t,!0)}return e.prototype.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments[1]&&(this.options=e,this.format=e.interpolation&&e.interpolation.format||function(e){return e},this.escape=e.interpolation&&e.interpolation.escape||p),e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.prefix=t.prefix?d(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?d(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?d(t.nestingPrefix):t.nestingPrefixEscaped||d("$t("),this.nestingSuffix=t.nestingSuffix?d(t.nestingSuffix):t.nestingSuffixEscaped||d(")"),this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.resetRegExp()},e.prototype.reset=function(){this.options&&this.init(this.options)},e.prototype.resetRegExp=function(){var e=this.prefix+"(.+?)"+this.suffix;this.regexp=new RegExp(e,"g");var t=""+this.prefix+this.unescapePrefix+"(.+?)"+this.unescapeSuffix+this.suffix;this.regexpUnescape=new RegExp(t,"g");var r=this.nestingPrefix+"(.+?)"+this.nestingSuffix;this.nestingRegexp=new RegExp(r,"g")},e.prototype.interpolate=function(e,t,r){var n=this,i=void 0,o=void 0,s=void 0;function c(e){return e.replace(/\$/g,"$$$$")}var l=function(e){if(e.indexOf(n.formatSeparator)<0)return u(t,e);var i=e.split(n.formatSeparator),o=i.shift().trim(),s=i.join(n.formatSeparator).trim();return n.format(u(t,o),s,r)};for(this.resetRegExp(),s=0;(i=this.regexpUnescape.exec(e))&&(o=l(i[1].trim()),e=e.replace(i[0],o),this.regexpUnescape.lastIndex=0,!(++s>=this.maxReplaces)););for(s=0;i=this.regexp.exec(e);){if("string"!==typeof(o=l(i[1].trim()))&&(o=a(o)),!o)if("function"===typeof this.options.missingInterpolationHandler){var d=this.options.missingInterpolationHandler(e,i);o="string"===typeof d?d:""}else this.logger.warn("missed to pass in variable "+i[1]+" for interpolating "+e),o="";if(o=this.escapeValue?c(this.escape(o)):c(o),e=e.replace(i[0],o),this.regexp.lastIndex=0,++s>=this.maxReplaces)break}return e},e.prototype.nest=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=void 0,i=void 0,o=M({},r);function s(e,t){if(e.indexOf(",")<0)return e;var r=e.split(",");e=r.shift();var n=r.join(",");n=(n=this.interpolate(n,o)).replace(/'/g,'"');try{o=JSON.parse(n),t&&(o=M({},t,o))}catch(t){this.logger.error("failed parsing options string in nesting for key "+e,t)}return e}for(o.applyPostProcessor=!1;n=this.nestingRegexp.exec(e);){if((i=t(s.call(this,n[1].trim(),o),o))&&n[0]===e&&"string"!==typeof i)return i;"string"!==typeof i&&(i=a(i)),i||(this.logger.warn("missed to resolve "+n[1]+" for nesting "+e),i=""),e=e.replace(n[0],i),this.regexp.lastIndex=0}return e},e}(),I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},A=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function R(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}}(e,t))}var O=function(e){function t(r,n,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return a.backend=r,a.store=n,a.languageUtils=i.languageUtils,a.options=s,a.logger=o.create("backendConnector"),a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(i,s.backend,s),a}return R(t,e),t.prototype.queueLoad=function(e,t,r){var n=this,i=[],o=[],s=[],a=[];return e.forEach(function(e){var r=!0;t.forEach(function(t){var s=e+"|"+t;n.store.hasResourceBundle(e,t)?n.state[s]=2:n.state[s]<0||(1===n.state[s]?o.indexOf(s)<0&&o.push(s):(n.state[s]=1,r=!1,o.indexOf(s)<0&&o.push(s),i.indexOf(s)<0&&i.push(s),a.indexOf(t)<0&&a.push(t)))}),r||s.push(e)}),(i.length||o.length)&&this.queue.push({pending:o,loaded:{},errors:[],callback:r}),{toLoad:i,pending:o,toLoadLanguages:s,toLoadNamespaces:a}},t.prototype.loaded=function(e,t,r){var n=this,i=e.split("|"),o=A(i,2),s=o[0],a=o[1];t&&this.emit("failedLoading",s,a,t),r&&this.store.addResourceBundle(s,a,r),this.state[e]=t?-1:2,this.queue.forEach(function(r){var i,o,l,u,d,h;i=r.loaded,o=a,u=c(i,[s],Object),d=u.obj,h=u.k,d[h]=d[h]||[],l&&(d[h]=d[h].concat(o)),l||d[h].push(o),function(e,t){for(var r=e.indexOf(t);-1!==r;)e.splice(r,1),r=e.indexOf(t)}(r.pending,e),t&&r.errors.push(t),0!==r.pending.length||r.done||(n.emit("loaded",r.loaded),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())}),this.queue=this.queue.filter(function(e){return!e.done})},t.prototype.read=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:250,s=arguments[5];return e.length?this.backend[r](e,t,function(a,c){a&&c&&n<5?setTimeout(function(){i.read.call(i,e,t,r,n+1,2*o,s)},o):s(a,c)}):s(null,{})},t.prototype.load=function(e,t,r){var n=this;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();var i=I({},this.backend.options,this.options.backend);"string"===typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"===typeof t&&(t=[t]);var o=this.queueLoad(e,t,r);if(!o.toLoad.length)return o.pending.length||r(),null;i.allowMultiLoading&&this.backend.readMulti?this.read(o.toLoadLanguages,o.toLoadNamespaces,"readMulti",null,null,function(e,t){e&&n.logger.warn("loading namespaces "+o.toLoadNamespaces.join(", ")+" for languages "+o.toLoadLanguages.join(", ")+" via multiloading failed",e),!e&&t&&n.logger.log("successfully loaded namespaces "+o.toLoadNamespaces.join(", ")+" for languages "+o.toLoadLanguages.join(", ")+" via multiloading",t),o.toLoad.forEach(function(r){var i=r.split("|"),o=A(i,2),s=o[0],a=o[1],c=u(t,[s,a]);if(c)n.loaded(r,e,c);else{var l="loading namespace "+a+" for language "+s+" via multiloading failed";n.loaded(r,l),n.logger.error(l)}})}):o.toLoad.forEach(function(e){n.loadOne(e)})},t.prototype.reload=function(e,t){var r=this;this.backend||this.logger.warn("No backend was added via i18next.use. Will not load resources.");var n=I({},this.backend.options,this.options.backend);"string"===typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"===typeof t&&(t=[t]),n.allowMultiLoading&&this.backend.readMulti?this.read(e,t,"readMulti",null,null,function(n,i){n&&r.logger.warn("reloading namespaces "+t.join(", ")+" for languages "+e.join(", ")+" via multiloading failed",n),!n&&i&&r.logger.log("successfully reloaded namespaces "+t.join(", ")+" for languages "+e.join(", ")+" via multiloading",i),e.forEach(function(e){t.forEach(function(t){var o=u(i,[e,t]);if(o)r.loaded(e+"|"+t,n,o);else{var s="reloading namespace "+t+" for language "+e+" via multiloading failed";r.loaded(e+"|"+t,s),r.logger.error(s)}})})}):e.forEach(function(e){t.forEach(function(t){r.loadOne(e+"|"+t,"re")})})},t.prototype.loadOne=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.split("|"),i=A(n,2),o=i[0],s=i[1];this.read(o,s,"read",null,null,function(n,i){n&&t.logger.warn(r+"loading namespace "+s+" for language "+o+" failed",n),!n&&i&&t.logger.log(r+"loaded namespace "+s+" for language "+o,i),t.loaded(e,n,i)})},t.prototype.saveMissing=function(e,t,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.backend&&this.backend.create&&this.backend.create(e,t,r,n,null,I({},o,{isUpdate:i})),e&&e[0]&&this.store.addResource(e[0],t,r,n)},t}(s),D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function k(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}}(e,t))}var F=function(e){function t(r,n,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return a.cache=r,a.store=n,a.services=i,a.options=s,a.logger=o.create("cacheConnector"),a.cache&&a.cache.init&&a.cache.init(i,s.cache,s),a}return k(t,e),t.prototype.load=function(e,t,r){var n=this;if(!this.cache)return r&&r();var i=D({},this.cache.options,this.options.cache),o="string"===typeof e?this.services.languageUtils.toResolveHierarchy(e):e;i.enabled?this.cache.load(o,function(e,t){if(e&&n.logger.error("loading languages "+o.join(", ")+" from cache failed",e),t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))for(var s in t[i])if(Object.prototype.hasOwnProperty.call(t[i],s)&&"i18nStamp"!==s){var a=t[i][s];a&&n.store.addResourceBundle(i,s,a)}r&&r()}):r&&r()},t.prototype.save=function(){this.cache&&this.options.cache&&this.options.cache.enabled&&this.cache.save(this.store.data)},t}(s);function N(e){return"string"===typeof e.ns&&(e.ns=[e.ns]),"string"===typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"===typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&e.whitelist.indexOf("cimode")<0&&(e.whitelist=e.whitelist.concat(["cimode"])),e}var L="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function V(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function U(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}}(e,t))}function z(){}var j=new(function(e){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=V(this,e.call(this));if(i.options=N(r),i.services={},i.logger=o,i.modules={external:[]},n&&!i.isInitialized&&!r.isClone){var s;if(!i.options.initImmediate)return s=i.init(r,n),V(i,s);setTimeout(function(){i.init(r,n)},0)}return i}return U(t,e),t.prototype.init=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments[1];function n(e){return e?"function"===typeof e?new e:e:null}if("function"===typeof t&&(r=t,t={}),this.options=B({},{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:function(){},parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};return e[1]&&(t.defaultValue=e[1]),e[2]&&(t.tDescription=e[2]),t},interpolation:{escapeValue:!0,format:function(e,t,r){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",maxReplaces:1e3}},this.options,N(t)),this.format=this.options.interpolation.format,r||(r=z),!this.options.isClone){this.modules.logger?o.init(n(this.modules.logger),this.options):o.init(null,this.options);var i=new x(this.options);this.store=new m(this.options.resources,this.options);var s=this.services;s.logger=o,s.resourceStore=this.store,s.resourceStore.on("added removed",function(e,t){s.cacheConnector.save()}),s.languageUtils=i,s.pluralResolver=new T(i,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),s.interpolator=new E(this.options),s.backendConnector=new O(n(this.modules.backend),s.resourceStore,s,this.options),s.backendConnector.on("*",function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];e.emit.apply(e,[t].concat(n))}),s.backendConnector.on("loaded",function(e){s.cacheConnector.save()}),s.cacheConnector=new F(n(this.modules.cache),s.resourceStore,s,this.options),s.cacheConnector.on("*",function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];e.emit.apply(e,[t].concat(n))}),this.modules.languageDetector&&(s.languageDetector=n(this.modules.languageDetector),s.languageDetector.init(s,this.options.detection,this.options)),this.translator=new S(this.services,this.options),this.translator.on("*",function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];e.emit.apply(e,[t].concat(n))}),this.modules.external.forEach(function(t){t.init&&t.init(e)})}["getResource","addResource","addResources","addResourceBundle","removeResourceBundle","hasResourceBundle","getResourceBundle"].forEach(function(t){e[t]=function(){var r;return(r=e.store)[t].apply(r,arguments)}});var a=function(){e.changeLanguage(e.options.lng,function(t,n){e.isInitialized=!0,e.logger.log("initialized",e.options),e.emit("initialized",e.options),r(t,n)})};return this.options.resources||!this.options.initImmediate?a():setTimeout(a,0),this},t.prototype.loadResources=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;if(this.options.resources)t(null);else{if(this.language&&"cimode"===this.language.toLowerCase())return t();var r=[],n=function(t){t&&e.services.languageUtils.toResolveHierarchy(t).forEach(function(e){r.indexOf(e)<0&&r.push(e)})};if(this.language)n(this.language);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(function(e){return n(e)});this.options.preload&&this.options.preload.forEach(function(e){return n(e)}),this.services.cacheConnector.load(r,this.options.ns,function(){e.services.backendConnector.load(r,e.options.ns,t)})}},t.prototype.reloadResources=function(e,t){e||(e=this.languages),t||(t=this.options.ns),this.services.backendConnector.reload(e,t)},t.prototype.use=function(e){return"backend"===e.type&&(this.modules.backend=e),"cache"===e.type&&(this.modules.cache=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"postProcessor"===e.type&&y.addPostProcessor(e),"3rdParty"===e.type&&this.modules.external.push(e),this},t.prototype.changeLanguage=function(e,t){var r=this,n=function(e){e&&(r.language=e,r.languages=r.services.languageUtils.toResolveHierarchy(e),r.translator.language||r.translator.changeLanguage(e),r.services.languageDetector&&r.services.languageDetector.cacheUserLanguage(e)),r.loadResources(function(n){!function(e,n){r.translator.changeLanguage(n),n&&(r.emit("languageChanged",n),r.logger.log("languageChanged",n)),t&&t(e,function(){return r.t.apply(r,arguments)})}(n,e)})};e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(n):n(e):n(this.services.languageDetector.detect())},t.prototype.getFixedT=function(e,t){var r=this,n=function e(t,n){for(var i=arguments.length,o=Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];var a=B({},n);return"object"!==("undefined"===typeof n?"undefined":L(n))&&(a=r.options.overloadTranslationOptionHandler([t,n].concat(o))),a.lng=a.lng||e.lng,a.lngs=a.lngs||e.lngs,a.ns=a.ns||e.ns,r.t(t,a)};return"string"===typeof e?n.lng=e:n.lngs=e,n.ns=t,n},t.prototype.t=function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)},t.prototype.exists=function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)},t.prototype.setDefaultNamespace=function(e){this.options.defaultNS=e},t.prototype.loadNamespaces=function(e,t){var r=this;if(!this.options.ns)return t&&t();"string"===typeof e&&(e=[e]),e.forEach(function(e){r.options.ns.indexOf(e)<0&&r.options.ns.push(e)}),this.loadResources(t)},t.prototype.loadLanguages=function(e,t){"string"===typeof e&&(e=[e]);var r=this.options.preload||[],n=e.filter(function(e){return r.indexOf(e)<0});if(!n.length)return t();this.options.preload=r.concat(n),this.loadResources(t)},t.prototype.dir=function(e){if(e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr"},t.prototype.createInstance=function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments[1])},t.prototype.cloneInstance=function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z,i=B({},this.options,r,{isClone:!0}),o=new t(i);return["store","services","language"].forEach(function(t){o[t]=e[t]}),o.translator=new S(o.services,o.options),o.translator.on("*",function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];o.emit.apply(o,[e].concat(r))}),o.init(i,n),o.translator.options=o.options,o},t}(s));r.d(t,"changeLanguage",function(){return G}),r.d(t,"cloneInstance",function(){return H}),r.d(t,"createInstance",function(){return q}),r.d(t,"dir",function(){return W}),r.d(t,"exists",function(){return J}),r.d(t,"getFixedT",function(){return X}),r.d(t,"init",function(){return Y}),r.d(t,"loadLanguages",function(){return K}),r.d(t,"loadNamespaces",function(){return Z}),r.d(t,"loadResources",function(){return Q}),r.d(t,"off",function(){return $}),r.d(t,"on",function(){return ee}),r.d(t,"setDefaultNamespace",function(){return te}),r.d(t,"t",function(){return re}),r.d(t,"use",function(){return ne});t.default=j;var G=j.changeLanguage.bind(j),H=j.cloneInstance.bind(j),q=j.createInstance.bind(j),W=j.dir.bind(j),J=j.exists.bind(j),X=j.getFixedT.bind(j),Y=j.init.bind(j),K=j.loadLanguages.bind(j),Z=j.loadNamespaces.bind(j),Q=j.loadResources.bind(j),$=j.off.bind(j),ee=j.on.bind(j),te=j.setDefaultNamespace.bind(j),re=j.t.bind(j),ne=j.use.bind(j)}]]);
//# sourceMappingURL=vendors~main.a1e44f93.chunk.js.map