<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Schemas and Elements in TypeScript - iModelJs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/bundle.css">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/prism.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet"> 
        <link rel='shortcut icon' type='image/x-icon' href='https://imodeljs.github.io/iModelJs-docs-output//overview/imodeljs.ico' /> 
</head>

<body data-site-root=https://imodeljs.github.io/iModelJs-docs-output// class='layout-index '>
    <span id="contentLoader">
        <p>Woah! This page has a great deal of content... Give us a second to load it.</p>
    </span>
    <span id="contentLoaderBackground"></span>
    <div id="flex-wrapper">
        <header id="main-header">
            <div class='row nav-container'>
                <nav id='main-navbar' class="navbar navbar-expand-md navbar-light">
                    
                    <button class="navbar-toggler navbar-toggler-left custom-toggler" type="button" aria-controls="navbarSupportedContent" aria-expanded="false"
                        aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon">
                            <i class='icon icon-menu'></i>
                        </span>
                    </button>
                    <div class="nav-title-container">
                        <a class="navbar-brand " href="https://imodeljs.github.io/iModelJs-docs-output//" class="col-md-3">
                            <img id="site-logo" class="site-logo" src="https://imodeljs.github.io/iModelJs-docs-output//overview/imodeljs.ico" />
                            <h1 id="site-title">iModelJs</h1>
                        </a>
                    </div>
                    <div id='header-tabs' class='col-sm-6 col-md-3 nav-tabs-container'>
                        <nav class="navbar navbar-expand-md navbar-light">
                             <ul class="bwc-tabs-horizontal green"><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output//overview">Overview</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output//getting-started">Getting Started</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output//bis">BIS</a></li><li class="active"><a href="https://imodeljs.github.io/iModelJs-docs-output//learning">Learning</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output//reference">API Reference</a></li></ul> 
                        </nav>
                    </div>                </nav>
            </div>

        </header>
        
<div id='main-wrapper'>
    <div id='table-of-contents'>
        <span class='search-bar'>
          <li>
            <div id='search-container'>
            </div>
          </li>
        </span>
        
        <ul id='main-navigation-list'>
            <html><head></head><body><h3 id="the imodeljs library"><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/" class="table-of-contents-link">The iModelJs Library</a></h3>
        <ul>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/frontend/" class="table-of-contents-link">Frontend</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/backend/" class="table-of-contents-link">Backend</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/common/" class="table-of-contents-link">Common</a></li>
        </ul>
        <hr>
        <p>&#xA0;</p>
        <h3 id="helpful links">Helpful links</h3>
        <ul>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/ecsql" class="table-of-contents-link">ECSQL</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/wireformat" class="table-of-contents-link">Wire Format</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/faq" class="table-of-contents-link">Frequently asked Questions</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/guidelines/" class="table-of-contents-link">Guidelines and Tips</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/glossary" class="table-of-contents-link">iModelJs Glossary</a></li>
        </ul>
        </body></html>
        </ul>    </div>
    <div class='row documentation-main'>
        <article id="main" name="main-content">
            <div class='bread-crumb-label'><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/">learning</a> > <a href="https://imodeljs.github.io/iModelJs-docs-output//learning/backend/">backend</a> > SchemasAndElementsInTypeScript</div>
            <div class="edit-link"><span title="Page edit feature coming soon">Edit this page</span></div>
            <h1 id="schemas and elements in typescript">Schemas and Elements in TypeScript</h1>
<p>A <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-backend/schema/schema'>Schema</a> represents an ECSchema in TypeScript. It is a collection of Entity-based classes. See <a href='https://imodeljs.github.io/iModelJs-docs-output//./bis/intro/modeling-with-bis'>the BIS overview</a> for how ECSchemas are used to model information. ECSchemas define classes for models, elements, and aspects, as well as ECRelationships.</p>
<p>An <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-backend/elements/element'>Element</a> object represents an <em>instance</em> if a bis:Element class when it is read from an iModel. The Element object has properties that correspond to the bis class definition in the schema. An <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-backend/elementaspects/elementaspect'>ElementAspect</a>  object represents an instance of a bis:Aspect in memory.</p>
<p>ECSchemas typically define subclasses of bis:Element, bis:Aspect, and so on. The objects that are loaded into memory are instances of TypeScript/JavaScript classes that match the ECSchema definitions. So, for example, an instance of a bis:GeometricElement3d is an object of the class <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-backend/elements/geometricelement3d'>GeometricElement3d</a>.</p>
<h2 class="h-importing-the-schema"><a id="importing-the-schema" class="heading-anchor" href="#%s"></a>Importing the Schema</h2>
<p>An ECSchema must be imported into an iModel before apps can insert and query instances of the ECClasses that it defines.</p>
<p><em>Example:</em></p>
<pre class="no-line-numbers"><code class="language-typescript">
  // Import the RobotWorld schema into the specified iModel.
  // Also do some one-time bootstrapping of supporting definitions such as Categories.
  public static importSchema(iModelDb: IModelDb) {
    if (iModelDb.containsClass(_schemaNames.Class.Robot))
      return;

    if (iModelDb.isReadonly())
      throw new IModelError(IModelStatus.ReadOnly);

    // Must import the schema. The schema must be installed alongside the app in its
    // assets directory. Note that, for portability, make sure the case of
    // the filename is correct!
    iModelDb.importSchema(path.join(IModelHost.appAssetsDir!, &quot;RobotWorld.ecschema.xml&quot;));

    // This is the right time to create definitions, such as Categories, that will
    // be used with the classes in this schema.
    RobotWorld.bootStrapDefinitions(iModelDb);
  }</code></pre>
<p>ECSchema.xml files must be in the app backend&apos;s install set, as part of its assets.</p>
<p>The app can ensure that the underlying schema is imported by registering an onOpened event handler:</p>
<p><em>Example:</em></p>
<pre class="no-line-numbers"><code class="language-typescript">    // Make sure the RobotWorld schema is in the iModel.
    IModelDb.onOpened.addListener((iModel: IModelDb) =&gt; {
      RobotWorld.importSchema(iModel);
    });</code></pre>
<p>where the schema is:</p>
<pre class="no-line-numbers"><code class="language-xml">&#xFEFF;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;ECSchema schemaName=&quot;RobotWorld&quot; alias=&quot;RobotWorld&quot; version=&quot;01.00.00&quot; xmlns=&quot;http://www.bentley.com/schemas/Bentley.ECXML.3.1&quot;&gt;

    &lt;ECSchemaReference name=&quot;BisCore&quot; version=&quot;01.00&quot; alias=&quot;bis&quot;/&gt;
    &lt;ECSchemaReference name=&quot;ECDbMap&quot; version=&quot;02.00&quot; alias=&quot;ecdbmap&quot;/&gt;

    &lt;ECEntityClass typeName=&quot;Robot&quot; modifier=&quot;Sealed&quot;&gt;
        &lt;BaseClass&gt;bis:SpatialLocationElement&lt;/BaseClass&gt;
        &lt;ECProperty propertyName=&quot;radius&quot; typeName=&quot;double&quot; description=&quot;the girth of the robot&quot; /&gt;
    &lt;/ECEntityClass&gt;

    &lt;ECEntityClass typeName=&quot;Barrier&quot; modifier=&quot;Sealed&quot;&gt;
        &lt;BaseClass&gt;bis:SpatialLocationElement&lt;/BaseClass&gt;
        &lt;ECProperty propertyName=&quot;length&quot; typeName=&quot;double&quot; description=&quot;the length of the barrier&quot; /&gt;
    &lt;/ECEntityClass&gt;

    &lt;!-- A Barrier can optionally have a hole init --&gt;
    &lt;ECEntityClass typeName=&quot;BarrierHoleAspect&quot;&gt;
        &lt;BaseClass&gt;bis:ElementUniqueAspect&lt;/BaseClass&gt;
        &lt;ECCustomAttributes&gt;
            &lt;ClassHasHandler xmlns=&quot;BisCore.01.00&quot;/&gt;
        &lt;/ECCustomAttributes&gt;
        &lt;ECProperty propertyName=&quot;offset&quot; typeName=&quot;double&quot; description=&quot;offset to start of hole&quot;/&gt;
        &lt;ECProperty propertyName=&quot;length&quot; typeName=&quot;double&quot; description=&quot;length of hole&quot;/&gt;
    &lt;/ECEntityClass&gt;

&lt;/ECSchema&gt;
</code></pre>
<h2 class="h-typescript-and-ecschemas-and-ecclasses"><a id="typescript-and-ecschemas-and-ecclasses" class="heading-anchor" href="#%s"></a>TypeScript and ECSchemas and ECClasses</h2>
<p>Once an ECSchema has been imported into an iModel, you can work with Elements, Models, and ElementAspects from that schema without writing TypeScript classes to represent them. A JavaScript class will be generated dynamically to represent each ECClass that you access, if there is no pre-registered TypeScript class to represent it.</p>
<p>You <em>may</em> write a TypeScript Schema class to represent an ECSchema and TypeScript Element-based or ElementAspect-based classes to represent some or all of its ECClasses. The benefit of writing a TypeScript class to represent an ECClass is that you can add hand-coded methods to provide and centralize business logic for applications to use when working with that specific class.</p>
<p><em>Example:</em></p>
<pre class="no-line-numbers"><code class="language-typescript">import { SpatialLocationElement, IModelDb, SpatialCategory } from &quot;@bentley/imodeljs-backend&quot;;
import { GeometryStreamBuilder, GeometryStreamProps } from &quot;@bentley/imodeljs-common&quot;;
import { Point3d, Arc3d } from &quot;@bentley/geometry-core&quot;;
import { RobotWorld } from &quot;./RobotWorldSchema&quot;;

/**
 * An example of defining a subclass of SpatialLocationElement.
 * Normally, you would start writing a class like this by generating the TypeScript class
 * definition from the ecschema. Then, you would then hand-edit it to add methods.
 * In this example, a &quot;robot&quot; is represented as a circle in the X-Y plane.
 */
export class Robot extends SpatialLocationElement {
  //  Define the properties added by this subclass
  public radius: number = 0.1;                     // The girth of the robot

  // Note: Do not redefine the constructor. You must not interfere with the constructor that is
  // already defined by the base Element class.

  // You can provide handy methods for creating new Robots
  public static generateGeometry(radius: number = 0.1): GeometryStreamProps {
    const builder = new GeometryStreamBuilder();  // I know what graphics represent a robot.
    const circle = Arc3d.createXY(Point3d.createZero(), radius);
    builder.appendGeometry(circle);
    return builder.geometryStream;
  }

  public static getCategory(iModel: IModelDb): SpatialCategory {
    return RobotWorld.getCategory(iModel, RobotWorld.Class.Robot);
  }

  // You can write methods to implement business logic that apps can call.
  public someBusinessLogic(): void {
    if ((this.testProperty === &quot;something&quot;) &amp;&amp; this.isPrivate) {
      // ... do something ...
    }
  }
}</code></pre>
<p>Note that the pre-written TypeScript class does not have to define accessors for the properties of the ECClass. The Element base class takes care of that automatically.</p>
<p>Note that you still have to import the underlying ECSchema before attempting to create instances of the ECClasses that it defines.</p>
<h2 class="h-schema-registration"><a id="schema-registration" class="heading-anchor" href="#%s"></a>Schema Registration</h2>
<p>If an app backend wants to use a pre-written TypeScript Schema class, it must register the pre-written schema first.</p>
<p><em>Example:</em></p>
<pre class="no-line-numbers"><code class="language-typescript">    // Register the TypeScript schema classes that I intend to use.
    RobotWorld.registerSchema();</code></pre>
<p>The TypeScript Schema class itself must register all of the classes that it defines. The best practice is for the Schema class to do that in its constructor.</p>
<p><em>Example:</em></p>
<pre class="no-line-numbers"><code class="language-typescript">
// Import all modules that define classes in this schema.
import * as robots from &quot;./RobotElement&quot;;
import * as obstacles from &quot;./BarrierElement&quot;;
// ... other modules ...

/** An example of defining a class that represents a schema.
 * Important: The name of the TypeScript class must match the name of the ECSchema that it represents.
 * Normally, you would use a tool to generate a TypeScript schema class like this from an ECSchema
 * definition. You would then edit the generated TypeScript class to add methods.
 */
export class RobotWorld extends Schema {
  /** An app must call this to register the RobotWorld schema prior to using it. */
  public static registerSchema() {
    // Make sure that this Schema is registered.
    // An app may call this more than once. Make sure that&apos;s harmless.
    if (Schemas.getRegisteredSchema(RobotWorld.name) !== undefined)
      return;

    Schemas.registerSchema(new RobotWorld());
  }

  // Registers all classes of the RobotWorld schema.
  private constructor() {
    super();
    // Register all modules that define classes in this schema.
    // ClassRegistry detects all classes defined by each module and registers them.
    ClassRegistry.registerModule(robots, this);
    ClassRegistry.registerModule(obstacles, this);
    // ... other modules ...
  }

  // ...
</code></pre>

            <p class='last-updated'>Last Updated:
                <span class='date-updated'>24 July, 2018 @ 08:50:23 am -04:00</span>
            </p>

            
            <script type="text/javascript">
            
            </script>        </article>
    </div>
    <div id='inner-table-of-contents'>
        <!--
            - If the page is active
            - Get all headings and subheadings and list them
         -->
        
        
        
        
        <div id='sticky-container' style="top: 76px; position: fixed;">
          <h4 class='heading'>On this page</h4>
            <div id="overview-container" class="clusterize-scroll">
              <ul id='nav' class='right-nav nav flex-column clusterize-content'>
                      <li class='nav-item item '>
                    <a class='title solo-title menu-text' href="#importing-the-schema">Importing the Schema</a>
            </li>
               <li class='nav-item item '>
                    <a class='title solo-title menu-text' href="#typescript-and-ecschemas-and-ecclasses">TypeScript and ECSchemas and ECClasses</a>
            </li>
               <li class='nav-item item '>
                    <a class='title solo-title menu-text' href="#schema-registration">Schema Registration</a>
            </li>
         
              </ul>
            </div>
          </div>
        
    </div>
</div>


    <footer id='main-footer'>
        <div id='footer-content-container'>
           <div class='footer-footer'>
               <p>Copyright 2018 Bentley Systems, Incorporated</p>
            </div>
        </div>
    </footer>
</div>
    <a href="javascript:" id="return-to-top"><i class="icon icon-chevron-up"></i></a>
    <script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/bundle.js" ></script>
</body>

</html>