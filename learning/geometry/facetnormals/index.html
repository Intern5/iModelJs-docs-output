<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Using Surface normals to make coarse facets looks smooth. - iModelJs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/bundle.css">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/prism.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet"> 
        <link rel='shortcut icon' type='image/x-icon' href='https://imodeljs.github.io/iModelJs-docs-output//overview/imodeljs.ico' /> 
</head>

<body data-site-root=https://imodeljs.github.io/iModelJs-docs-output// class='layout-index '>
    <span id="contentLoader">
        <p>Woah! This page has a great deal of content... Give us a second to load it.</p>
    </span>
    <span id="contentLoaderBackground"></span>
    <div id="flex-wrapper">
        <header id="main-header">
            <div class='row nav-container'>
                <nav id='main-navbar' class="navbar navbar-expand-md navbar-light">
                    
                    <button class="navbar-toggler navbar-toggler-left custom-toggler" type="button" aria-controls="navbarSupportedContent" aria-expanded="false"
                        aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon">
                            <i class='icon icon-menu'></i>
                        </span>
                    </button>
                    <div class="nav-title-container">
                        <a class="navbar-brand " href="https://imodeljs.github.io/iModelJs-docs-output//" class="col-md-3">
                            <img id="site-logo" class="site-logo" src="https://imodeljs.github.io/iModelJs-docs-output//overview/imodeljs.ico" />
                            <h1 id="site-title">iModelJs</h1>
                        </a>
                    </div>
                    <div id='header-tabs' class='col-sm-6 col-md-3 nav-tabs-container'>
                        <nav class="navbar navbar-expand-md navbar-light">
                             <ul class="bwc-tabs-horizontal green"><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output//overview">Overview</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output//getting-started">Getting Started</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output//bis">BIS</a></li><li class="active"><a href="https://imodeljs.github.io/iModelJs-docs-output//learning">Learning</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output//reference">API Reference</a></li></ul> 
                        </nav>
                    </div>            </nav>
        </div>
        </header>
        

<div id='main-wrapper'>
    <div id='table-of-contents'>
        <span class='search-bar'>
          <li>
            <div id='search-container'>
            </div>
          </li>
          <script>
            (function() {
              var cx = '000629069474334212860:yxwzhn4umym';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:searchresults-only gname="sitesearch" resultSetSize="7"></gcse:search>
        </span>
        
        <ul id='main-navigation-list'>
            <html><head></head><body><h3 id="the imodeljs library"><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/" class="table-of-contents-link">The iModelJs Library</a></h3>
        <ul>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/frontend/" class="table-of-contents-link">Frontend</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/backend/" class="table-of-contents-link">Backend</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/common/" class="table-of-contents-link">Common</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/geometry/" class="table-of-contents-link">Geometry</a></li>
        </ul>
        <hr>
        <p>&#xA0;</p>
        <h3 id="helpful links">Helpful links</h3>
        <ul>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/ecsql" class="table-of-contents-link">ECSQL</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/wireformat" class="table-of-contents-link">Wire Format</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/faq" class="table-of-contents-link">Frequently asked Questions</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/guidelines/" class="table-of-contents-link">Guidelines and Tips</a></li>
        <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/glossary" class="table-of-contents-link">iModelJs Glossary</a></li>
        </ul>
        </body></html>
        </ul>    </div>
    <div class='row documentation-main'>
        <article id="main" name="main-content">
            <div class='bread-crumb-label'><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/">learning</a> > <a href="https://imodeljs.github.io/iModelJs-docs-output//learning/geometry/">geometry</a> > FacetNormals</div>
            <div class="edit-link"><span title="Page edit feature coming soon">Edit this page</span></div>
            <h1 id="using surface normals to make coarse facets looks smooth.">Using Surface normals to make coarse facets looks smooth.</h1>
<h2 class="h-coarse-facets-on-a-smooth-surface"><a id="coarse-facets-on-a-smooth-surface" class="heading-anchor" href="#%s"></a>Coarse facets on a smooth surface</h2>
<p>Here is a patch of a smooth surface, represented as a 4x6 grid of facets, with all the facet edges drawn:</p>
<p><img src=".././figs/GriddedSurfaceExample/AllEdges.png" alt="&gt;"></p>
<p>Here are two shaded images of the same facets, with the edges <em>not</em> displayed.   Note that on the left, the edges are still clearly visible because of shading differences.  The blockyness of facets is very clear.  But on the right the surface appears much smoother.   Looking closely at the blocky version, each facet has a single gray scale shade throughout.  The edges are clearly visible because of jump from one blocks grayscale to the next. But in the smooth version, the gray scale various smoothly <em>within</em> each block, and does not change at the edge.</p>
<p><img src=".././figs/GriddedSurfaceExample/SideBySideFacetVersusVertexNormals.png" alt="&gt;"></p>
<p>The difference is due to careful use of facet normals -- vectors pointing &quot;out of&quot; the facets.</p>
<p>Here is a closeup showing (a) the entire lower left facet and (b) small parts of neighbors to the right and above.  Also appearing are short yellow lines pointing away from the facets in the corner near the vertices.   Look carefully at the complete lower left facet -- you can see that all 4 of these yellow lines are exactly perpendicular to the plane of the facet.  But the very nearby lines from corners of the neighbor facets are tilted at a slightly different angle because the neighbor facet is in a different plane.</p>
<p><img src=".././figs/GriddedSurfaceExample/ZoomFacetNormal.png" alt="&gt;"></p>
<p>Here is closeup of the same corner for the smoother image.   In this case yellow lines &quot;near each vertex&quot; are parallel <em>with their neighbors at the same vertex</em>, rather than with others far away on the same facet.   This direction is ideally taken from the true analytic original surface (a circular arc rotated around an line).   If the original surface equations are not known, using the average of the 2 or 4 facets also works well.  In either case, graphics software and hardware uses these normals to estimate a smooth variation of light reflecting off the entire facet, producing the vastly improved image quality.</p>
<p><img src=".././figs/GriddedSurfaceExample/ZoomVertexNormal.png" alt="&gt;"></p>
<h2 class="h-introducing-sharp-interior-edges"><a id="introducing-sharp-interior-edges" class="heading-anchor" href="#%s"></a>Introducing sharp interior edges</h2>
<p>Here is the same number of facets, with the same grid structure, but with the upper 4 facets folded down onto a plane that is distinctly different from the rest of the smooth surface.   When the edges are not being drawn, we expect to see the lower part -- the curved part -- appear smoothly as before.   The interior of the flat part is all in a plane, and it should appear flat with a distinct edge at the sharp turn edge where it joins the curved portion.</p>
<p><img src=".././figs/GriddedSurfaceExample/FoldedWithEdges.png" alt="&gt;"></p>
<p>Here are three images without the edges drawn.  From left to right they have:</p>
<ul>
<li>(left) blocky display, with clearly visible breaks between facets</li>
<li>(middle) smooth display throughout.<ul>
<li>This is good in the portions where the original surface was curved</li>
<li>This is <em>not</em> good in at the sharp fold edge.  It appears to be a roll rather than a crisp edge, and the roll seems to continue into the 4 coplanar facets beyond the fold.</li>
</ul>
</li>
<li>(right) correct display that is smooth in the curved section, a crisp fold, and then flat within the coplanar facets.</li>
</ul>
<p><img src=".././figs/GriddedSurfaceExample/FoldedShadingVariants.png" alt="&gt;"></p>
<p>Once again, the display variation is due to how surface normal is presented at each corner of each facet.</p>
<ul>
<li>On the left, each facet&apos;s corners get the normal of that facets own plane, which of course has a significant angle from those other facets at that vertex.</li>
<li>In the middle, all the corners near each vertex get a single average normal from all of the (2 or 4) incident facets.   Within the smooth part this is good.  But at the fold edge, the single normal is not really right for either side.</li>
<li>On the right, the normals are correctly pulled from either the fold plane or the curved surface.   Hence there are multiple distinct normal values <em>at each vertex along the fold</em>.</li>
</ul>
<p><img src=".././figs/GriddedSurfaceExample/FoldedWithNormals.png" alt="&gt;"></p>
<p>This mixing of smooth patches sharing common edges is pervasive in realistic mechanical models.</p>

            <p class='last-updated'>Last Updated:
                <span class='date-updated'>28 August, 2018 @ 08:10:09 pm -04:00</span>
            </p>

            
            <script type="text/javascript">
            
            </script>        </article>
    </div>
    <div id='inner-table-of-contents'>
       <!--  <div id='sticky-container' style="top: 76px; position: fixed;">
  <h4 class='heading'>On this page</h4>
    <div id="overview-container" class="clusterize-scroll">
      <ul id='nav' class='right-nav nav flex-column clusterize-content'>
              <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#coarse-facets-on-a-smooth-surface">Coarse facets on a smooth surface</a>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#introducing-sharp-interior-edges">Introducing sharp interior edges</a>
    </li>
 
      </ul>
    </div>
  </div>

 -->
    </div>
</div>


    <footer id='main-footer'>
        <div id='footer-content-container'>
           <div class='footer-footer'>
               <p>Copyright 2018 Bentley Systems, Incorporated</p>
            </div>
        </div>
    </footer>
</div>
    <a href="javascript:" id="return-to-top"><i class="icon icon-chevron-up"></i></a>
    <script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/bundle.js" ></script>
</body>

</html><script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/monaco-editor/min/vs/loader.js"></script>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/ts-playground.js"></script>
