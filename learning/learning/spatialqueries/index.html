<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bentley Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output/styles/bundle.css">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output/styles/prism.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">

</head>

<body data-site-root=https://imodeljs.github.io/iModelJs-docs-output/ class='indexSeg'>
    <span id="contentLoader"><p>Woah!  This page has a great deal of content...  Give us a second to load it.</p></span>
    <span id="contentLoaderBackground"></span>
    <div id="flex-wrapper">
    <header id="main-header">
        <div class='row no-gutters nav-container'>
            <!-- <div class="col-12"> -->
            
                <nav id='main-navbar' class="navbar navbar-expand-md navbar-light">
                    
                    <button class="navbar-toggler navbar-toggler-left custom-toggler" type="button" aria-controls="navbarSupportedContent" aria-expanded="false"
                        aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon">
                            <i class='icon icon-menu'></i>
                        </span>
                    </button>
                        <div class="col-sm-6 col-md-3 nav-title-container">
                            
                            <a class="navbar-brand segregated" href="https://imodeljs.github.io/iModelJs-docs-output/learning" class="col-md-3">
                                <h1 id='site-title'><i class='icon icon-document'></i>Learning</h1>                                
                            </a>

                        </div>
                        <div id='header-tabs' class='col-sm-6 col-md-3 nav-tabs-container'>
                            <nav class="navbar navbar-expand-md navbar-light">
                                 <ul class="bwc-tabs-horizontal green"><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output/overview">Overview</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output/getting-started">Getting Started</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output/bis">BIS</a></li><li class="active"><a href="https://imodeljs.github.io/iModelJs-docs-output/learning">Learning</a></li><li class=""><a href="https://imodeljs.github.io/iModelJs-docs-output/reference">Reference</a></li></ul> 
                            </nav>
                        </div>                </nav>
            
        </div>
        <!-- </div> -->

    </header>


    <div id='main-wrapper'>
    
            <div id='table-of-contents'>
                <span class='search-bar'>
                  <li>
                    <div id='search-container'>
                    </div>
                  </li>
                </span>
                
                
                <ul id='main-navigation-list'>
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                                    <span class='nav-collection-group' id='learning-nav'>
                                        <li><h3 class='table-of-contents-heading'><a href='https://imodeljs.github.io/iModelJs-docs-output/learning/learning/'>learning</a></h3></li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/changesummaries">Change Summaries</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/ecsql">Ecsql</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/ecsqlparametertypes">Ecsql Parameter Types</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/ecsqlrowformat">Ecsql Row Format</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/glossary">Glossary</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/portability">Portability</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/faq">FAQ</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/leftnav">Left Nav</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link active' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/learning/spatialqueries">Spatial Queries</a>
                                                    </li>
                                        </span>
                        <!-- If DocSites Exist -->
                
                                    <span class='nav-collection-group' id='backend-nav'>
                                        <li><h3 class='table-of-contents-heading'><a href='https://imodeljs.github.io/iModelJs-docs-output/learning/backend/'>backend</a></h3></li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/backend/briefcases">Briefcases</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/backend/changesets">Change Sets</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/backend/concurrencycontrol">Concurrency Control</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/backend/executingecsql">Executing Ecsql</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/backend/imodeldb">I Model Db</a>
                                                    </li>
                                        </span>
                        <!-- If DocSites Exist -->
                
                                    <span class='nav-collection-group' id='frontend-nav'>
                                        <li><h3 class='table-of-contents-heading'><a href='https://imodeljs.github.io/iModelJs-docs-output/learning/frontend/'>frontend</a></h3></li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/frontend/localization">Localization</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/frontend/tools">Tools</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/frontend/executingecsql">Executing Ecsql</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/frontend/views">Views</a>
                                                    </li>
                                        </span>
                        <!-- If DocSites Exist -->
                
                                    <span class='nav-collection-group' id='guidelines-nav'>
                                        <li><h3 class='table-of-contents-heading'><a href='https://imodeljs.github.io/iModelJs-docs-output/learning/guidelines/'>guidelines</a></h3></li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/guidelines/documentation-link-syntax">Documentation Link Syntax</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/guidelines/markdown-intro">Markdown Intro</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/guidelines/npm-scripts-guidelines">Npm Scripts Guidelines</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/guidelines/semantic-versioning-guidelines">Semantic Versioning Guidelines</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/guidelines/tips-for-converting-c">Tips For Converting C</a>
                                                    </li>
                                                    <li>
                                                        <a class='toc-link table-of-contents-link ' href="https://imodeljs.github.io/iModelJs-docs-output/./learning/guidelines/typescript-coding-guidelines">Typescript Coding Guidelines</a>
                                                    </li>
                                        </span>
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                        <!-- If DocSites Exist -->
                
                </ul>
            </div>
            <div class='row documentation-main'>
                <article id="main" name="main-content">
                    <h1 id="spatial queries">Spatial Queries</h1>
<p>ECSQL allows you to use the BisCore.SpatialIndex to include spatial criteria when selecting <a href='https://imodeljs.github.io/iModelJs-docs-output/./reference/imodeljs-backend/biscore/spatialelement'>spatial elements</a>. There are also functions that allow you to include an element&apos;s geometric properties in a where clause.</p>
<p>The <a href='https://imodeljs.github.io/iModelJs-docs-output/./reference/imodeljs-backend/biscore/spatialelement'>spatial elements</a> in an iModel are index by a <a href="https://sqlite.org/rtree.html">spatial index</a>. This indexes elements by area. Each node in the spatial index is conceptually a bounding box, plus the ECInstanceId of an element that is enclosed by it.</p>
<p>ECSQL identifies the spatial index using the name <code>BisCore.SpatialIndex</code>. You can using this name to include the spatial index in ECSQL select statements, to help filter results using spatial criteria. Conceptually, each node has the following properties: ECInstanceId, MinX, MaxX, MinY, MaxY, MinZ, MaxZ. The nodes in the spatial index can be selected by testing their properties directly. Here is an example that is adapted from the <a href="https://sqlite.org/rtree.html">SQLite docs</a>:</p>
<p><code>SELECT ECInstanceId FROM BisCore.SpatialIndex WHERE minX&gt;=-81.08 AND maxX&lt;=-80.58 AND minY&gt;=35.00  AND maxY&lt;=35.44</code></p>
<p>Nodes in the spatial index can also be selected using the special <code>MATCH</code> keyword and one of the builtin rtree functions. The functions for MATCHing rtree nodes are:</p>
<ul>
<li>iModel_spatial_overlap_aabb - select all nodes that overlap a specified <a href='https://imodeljs.github.io/iModelJs-docs-output/./reference/geometry-core/cartesiangeometry/range3dprops'>Range3dProps</a></li>
<li>iModel_rtree</li>
</ul>
<p>Here is a simple example of a spatial query using MATCH:</p>
<p><code>SELECT rt.ECInstanceId FROM BisCore.SpatialIndex rt WHERE (rt.ECInstanceId MATCH iModel_spatial_overlap_aabb(:bbox))</code></p>
<p>The caller would bind the <code>bbox</code> parameter in this example to a range.</p>
<p>The MATCH clause acts like a sub-selection in that it generates a set of ECInstanceIds, which it gathers from the nodes that match the specified criteria.</p>
<p>Often, a spatial query will combine a test on the spatial index with additional filtering criteria in the WHERE clause. As noted in the <a href="https://sqlite.org/rtree.html">SQLite docs</a>, &quot;An R*Tree index does not normally provide the exact answer but merely reduces the set of potential answers from millions to dozens.&quot; The additional filtering criteria are used to refine the answer after the spatial filter has narrowed the possibilities. For example, to select only elements in the specified range that are also in a specified Category:</p>
<p><code>SELECT rt.ECInstanceId FROM BisCore.SpatialIndex rt, BisCore.SpatialElement el WHERE (rt.ECInstanceId MATCH iModel_spatial_overlap_aabb(:bbox)) AND (el.ECInstanceId=rt.ECInstanceId) AND (el.Category = :categoryId)</code></p>
<p><em>Tip:</em> The OR operator should not be used in a WHERE clause that contains a spatial index MATCH.</p>
<h2><a id="geometry-functions" class="heading-anchor" href="#%s"><span>&#x1F517;</span></a>Geometry Functions</h2>
<p>ECSQL has a number of built-in functions that allow you to query on element geometry. The functions are organized here by the kind of object that they operate on.</p>
<h2><a id="xyzprops" class="heading-anchor" href="#%s"><span>&#x1F517;</span></a><a href='https://imodeljs.github.io/iModelJs-docs-output/./reference/geometry-core/cartesiangeometry/xyzprops'>XYZProps</a></h2>
<p>A point in the iModel&apos;s Cartesian coordinate system. If the point represents a location in a 2D model, then the z-coordinate will be zero. All coordinates are in meters.</p>
<p>Functions:</p>
<ul>
<li>iModel_point_value</li>
<li>iModel_point_distance</li>
<li>iModel_point_min_distance_to_bbox</li>
</ul>
<h2><a id="yawpitchroll" class="heading-anchor" href="#%s"><span>&#x1F517;</span></a>YawPitchRoll</h2>
<p>An object that contains Yaw, Pitch, and Roll angles in degrees. If this object represents a rotation in a 2D model, then the pitch and roll members will be zero.</p>
<p>Functions:</p>
<ul>
<li>iModel_angles_value</li>
<li>iModel_angles_maxdiff</li>
</ul>
<h2><a id="range3dprops" class="heading-anchor" href="#%s"><span>&#x1F517;</span></a><a href='https://imodeljs.github.io/iModelJs-docs-output/./reference/geometry-core/cartesiangeometry/range3dprops'>Range3dProps</a></h2>
<p>An object that defines a range.
If the box represents a range in a 3-D model, then the box will have 8 corners and will have width(X), depth(Y), and height(Z).
If the box represents a range in a 2-D model, then the box will still have 8 corners but the z-coordinates will be all be zero, and the height will be zero.
All coordinates are in meters.</p>
<p>Functions:</p>
<ul>
<li>iModel_bbox_value</li>
<li>iModel_bbox_width</li>
<li>iModel_bbox_height</li>
<li>iModel_bbox_depth</li>
<li>iModel_bbox_volume</li>
<li>iModel_bbox_areaxy</li>
<li>iModel_bbox_overlaps</li>
<li>iModel_bbox_contains</li>
<li>iModel_bbox_union</li>
<li>iModel_point_min_distance_to_bbox</li>
</ul>
<h2><a id="placement3dprops" class="heading-anchor" href="#%s"><span>&#x1F517;</span></a>Placement3dProps</h2>
<p>An object that contains an origin and rotation angles, plus a bounding box.
You can obtain an element&apos;s placement by selecting the placement column of the ElementGeom table.</p>
<p>Functions:</p>
<ul>
<li>iModel_placement_origin</li>
<li>iModel_placement_angles</li>
<li>iModel_placement_eabb</li>
<li>iModel_placement_aabb</li>
</ul>
<p><a href="https://imodeljs.github.io/iModelJs-docs-output/learning/learning/leftnav">&#xAB; leftNav</a></p>

                    <p class='last-updated'>Last Updated: 
                        <span class='date-updated'>06 May, 2018 @ 08:17:43 pm -04:00</span>
                    </p>
    
                   
                   <script type="text/javascript">
                   
                   </script>                </article>
            </div>
            <div id='inner-table-of-contents'>
                <!-- 
                    - If the page is active
                    - Get all headings and subheadings and list them
                 -->
                
                
                
                
                  <div id='sticky-container'>
                    <h4 class='heading'>Overview</h4>
                    <div id="overview-container" class="clusterize-scroll">
                      <ul id='nav' class='right-nav nav flex-column clusterize-content'>
                          <li class='nav-item item '>
                        <a class='title solo-title menu-text' href="https://imodeljs.github.io/iModelJs-docs-output/learning/learning/spatialqueries/#geometry-functions">Geometry Functions</a>
                </li>
                   <li class='nav-item item '>
                        <a class='title solo-title menu-text' href="https://imodeljs.github.io/iModelJs-docs-output/learning/learning/spatialqueries/#xyzprops">XYZProps</a>
                </li>
                   <li class='nav-item item '>
                        <a class='title solo-title menu-text' href="https://imodeljs.github.io/iModelJs-docs-output/learning/learning/spatialqueries/#yawpitchroll">YawPitchRoll</a>
                </li>
                   <li class='nav-item item '>
                        <a class='title solo-title menu-text' href="https://imodeljs.github.io/iModelJs-docs-output/learning/learning/spatialqueries/#range3dprops">Range3dProps</a>
                </li>
                   <li class='nav-item item '>
                        <a class='title solo-title menu-text' href="https://imodeljs.github.io/iModelJs-docs-output/learning/learning/spatialqueries/#placement3dprops">Placement3dProps</a>
                </li>
                 
                      </ul>
                    </div>
                  </div>
                
            </div>
        
    </div>
    

       
        <footer id='main-footer'>
            <div id='footer-content-container'>
                   <h1 class='footer-title'><a href='https://imodeljs.github.io/iModelJs-docs-output/'>Bentley Docs</a></h1><ul id='footer-nav'><li class="footer-nav-item footer-home-link "><a class="footer-nav-link" href="https://imodeljs.github.io/iModelJs-docs-output/">Home</a></li><li class="footer-nav-item "><a class="footer-nav-link" href="https://imodeljs.github.io/iModelJs-docs-output/overview">Overview</a><ul class='collection-list'><li><a href='https://imodeljs.github.io/iModelJs-docs-output/overview/overview'>overview</a></li></ul></li><li class="footer-nav-item "><a class="footer-nav-link" href="https://imodeljs.github.io/iModelJs-docs-output/getting-started">Getting Started</a><ul class='collection-list'></ul></li><li class="footer-nav-item active"><a class="footer-nav-link" href="https://imodeljs.github.io/iModelJs-docs-output/learning">Learning</a><ul class='collection-list'><li><a href='https://imodeljs.github.io/iModelJs-docs-output/learning/learning'>learning</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/learning/backend'>backend</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/learning/frontend'>frontend</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/learning/guidelines'>guidelines</a></li></ul></li><li class="footer-nav-item "><a class="footer-nav-link" href="https://imodeljs.github.io/iModelJs-docs-output/bis">BIS</a><ul class='collection-list'><li><a href='https://imodeljs.github.io/iModelJs-docs-output/bis/bis'>bis</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/bis/naming-guidelines'>naming-guidelines</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/bis/domains'>domains</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/bis/intro'>intro</a></li></ul></li><li class="footer-nav-item "><a class="footer-nav-link" href="https://imodeljs.github.io/iModelJs-docs-output/reference">Reference Documentation</a><ul class='collection-list'><li><a href='https://imodeljs.github.io/iModelJs-docs-output/reference/imodeljs-backend'>imodeljs-backend</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/reference/bentleyjs-core'>bentleyjs-core</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/reference/geometry-core'>geometry-core</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/reference/imodeljs-clients'>imodeljs-clients</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/reference/imodeljs-common'>imodeljs-common</a></li><li><a href='https://imodeljs.github.io/iModelJs-docs-output/reference/imodeljs-frontend'>imodeljs-frontend</a></li></ul></li></ul>
    
               <div class='footer-footer'>
                   <p>Copyright 2018 Bentley Systems, Incorporated</p>
                </div>    
            </div>
           
           
           
        </footer>
    </div>
        <a href="javascript:" id="return-to-top"><i class="icon icon-chevron-up"></i></a>
        <script src="https://imodeljs.github.io/iModelJs-docs-output/scripts/bundle.js" ></script>
    </body>
    
    </html>